var P1=Object.defineProperty;var L1=(s,t,n)=>t in s?P1(s,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[t]=n;var z_=(s,t,n)=>L1(s,typeof t!="symbol"?t+"":t,n);import{h as Vr,b as Bm,q as z1,u as B_,i as dp,g as fh,j as za,k as B1,E as R1,A as F1,B as O1,n as N1,o as U1,e as V1,C as z0,D as $1,F as j1,G as q1,T as G1,f as De,c as xe,s as Ot,a as Et,t as ue,r as we,p as Ai,I as qa,z as Js,J as Ir}from"../chunks/disclose-version.B09q5NK9.js";import{y as B0,i as Z1,z as cg,f as ug,A as R0,W as W1,g as pp,x as Ce,w as Be,H as R_,X as H1,Y as Y1,Z as F0,E as O0,B as N0,l as U0,C as V0,v as Ht,q as fp,_ as K1,$ as X1,T as F_,a0 as J1,n as Xd,a1 as Q1,a2 as t2,M as e2,b as i2,D as r2,a3 as ns,a4 as qr,p as Ki,a5 as Pe,o as wt,a6 as jr,a as Xi,t as je,a7 as Ac,a8 as n2,J as Rm,I as $0,a9 as hn}from"../chunks/runtime.AiB-EpK9.js";import{b as wl,p as bt,a as Qp,c as hg,i as zi,l as bi,s as dg,o as qc}from"../chunks/index-client.yN_PnAZr.js";import{s as us,b as Hn,a as Oi,i as Ji}from"../chunks/store.DyWEW9Zt.js";import{w as Dr,r as bm}from"../chunks/index.UF-GcHCI.js";import{s as vi,d as mr,b as oe,a as s2}from"../chunks/misc.C2YFcJK6.js";import{a as O_,c as N_,d as o2,b as a2,e as re,s as bn}from"../chunks/render.BNO8Gvbz.js";let Ec=null;function U_(s){Ec=s}function Ba(s,t){return t}function l2(s,t,n,u){for(var _=[],v=t.length,I=0;I<v;I++)H1(t[I].e,_,!0);var l=v>0&&_.length===0&&n!==null;if(l){var P=n.parentNode;N1(P),P.append(n),u.clear(),Da(s,t[0].prev,t[v-1].next)}Y1(_,()=>{for(var E=0;E<v;E++){var U=t[E];l||(u.delete(U.k),Da(s,U.prev,U.next)),F0(U.e,!l)}})}function Ra(s,t,n,u,_,v=null){var I=s,l={flags:t,items:new Map,first:null};Vr&&Bm();var P=null;B0(()=>{var E=n(),U=Z1(E)?E:E==null?[]:Array.from(E),j=U.length,W=l.flags;let tt=!1;if(Vr){var ct=I.data===z1;ct!==(j===0)&&(I=B_(),dp(I),fh(!1),tt=!0)}if(Vr){for(var pt=null,nt,it=0;it<j;it++){if(za.nodeType===8&&za.data===B1){I=za,tt=!0,fh(!1);break}var It=U[it],_t=u(It,it);nt=j0(za,l,pt,null,It,_t,it,_,W),l.items.set(_t,nt),pt=nt}j>0&&dp(B_())}Vr||c2(U,l,I,_,W,u),v!==null&&(j===0?P?cg(P):P=ug(()=>v(I)):P!==null&&R0(P,()=>{P=null})),tt&&fh(!0)}),Vr&&(I=za)}function c2(s,t,n,u,_,v){var I=s.length,l=t.items,P=t.first,E=P,U=new Set,j=null,W=[],tt=[],ct,pt,nt,it;for(it=0;it<I;it+=1){if(ct=s[it],pt=v(ct,it),nt=l.get(pt),nt===void 0){var It=E?E.e.nodes.start:n;j=j0(It,t,j,j===null?t.first:j.next,ct,pt,it,u,_),l.set(pt,j),W=[],tt=[],E=j.next;continue}if(u2(nt,ct,it),nt.e.f&W1&&cg(nt.e),nt!==E){if(U.has(nt)){if(W.length<tt.length){var _t=tt[0],gt;j=_t.prev;var kt=W[0],Lt=W[W.length-1];for(gt=0;gt<W.length;gt+=1)V_(W[gt],_t,n);for(gt=0;gt<tt.length;gt+=1)U.delete(tt[gt]);Da(t,kt.prev,Lt.next),Da(t,j,kt),Da(t,Lt,_t),E=_t,j=Lt,it-=1,W=[],tt=[]}else U.delete(nt),V_(nt,E,n),Da(t,nt.prev,nt.next),Da(t,nt,j===null?t.first:j.next),Da(t,j,nt),j=nt;continue}for(W=[],tt=[];E!==null&&E.k!==pt;)U.add(E),tt.push(E),E=E.next;if(E===null)continue;nt=E}W.push(nt),j=nt,E=nt.next}const Vt=Array.from(U);for(;E!==null;)Vt.push(E),E=E.next;var Rt=Vt.length;if(Rt>0){var Qt=null;l2(t,Vt,Qt,l)}pp.first=t.first&&t.first.e,pp.last=j&&j.e}function u2(s,t,n,u){Ce(s.v,t),s.i=n}function j0(s,t,n,u,_,v,I,l,P){var E=Ec;try{var U=(P&R1)!==0,j=(P&F1)===0,W=U?j?Be(_):R_(_):_,tt=P&O1?R_(I):I,ct={i:tt,v:W,k:v,a:null,e:null,prev:n,next:u};return Ec=ct,ct.e=ug(()=>l(s,W,tt),Vr),ct.e.prev=n&&n.e,ct.e.next=u&&u.e,n===null?t.first=ct:(n.next=ct,n.e.next=ct.e),u!==null&&(u.prev=ct,u.e.prev=ct.e),ct}finally{Ec=E}}function V_(s,t,n){for(var u=s.next?s.next.e.nodes.start:n,_=t?t.e.nodes.start:n,v=s.e.nodes.start;v!==u;){var I=v.nextSibling;_.before(v),v=I}}function Da(s,t,n){t===null?s.first=n:(t.next=n,t.e.next=n&&n.e),n!==null&&(n.prev=t,n.e.prev=t&&t.e)}function gh(s,t,n,u,_,v){let I=Vr;Vr&&Bm();var l,P,E=null;Vr&&za.nodeType===1&&(E=za,Bm());var U=Vr?za:s,j,W=Ec;B0(()=>{const tt=t()||null;var ct=tt==="svg"?z0:null;if(tt!==l){var pt=Ec;U_(W),j&&(tt===null?R0(j,()=>{j=null,P=null}):tt===P?cg(j):(F0(j),O_(!1))),tt&&tt!==P&&(j=ug(()=>{if(E=Vr?E:ct?document.createElementNS(ct,tt):document.createElement(tt),U1(E,E),u){var nt=Vr?E.firstChild:E.appendChild(V1());Vr&&(nt===null?fh(!1):dp(nt)),u(E,nt)}pp.nodes.end=E,U.before(E)})),l=tt,l&&(P=l),O_(!0),U_(pt)}},O0),I&&(fh(!0),dp(U))}function Fa(s,t,n){N0(()=>{var u=U0(()=>t(s,n==null?void 0:n())||{});if(n&&(u!=null&&u.update)){var _=!1;V0(()=>{var v=n();Ht(v),_&&u.update(v)}),_=!0}if(u!=null&&u.destroy)return()=>u.destroy()})}function h2(s,t){if(t){const n=document.body;s.autofocus=!0,fp(()=>{document.activeElement===n&&s.focus()})}}let $_=!1;function q0(){$_||($_=!0,document.addEventListener("reset",s=>{Promise.resolve().then(()=>{var t;if(!s.defaultPrevented)for(const n of s.target.elements)(t=n.__on_r)==null||t.call(n)})},{capture:!0}))}function G0(s){if(Vr){var t=!1,n=()=>{if(!t){if(t=!0,s.hasAttribute("value")){var u=s.value;Xs(s,"value",null),s.value=u}if(s.hasAttribute("checked")){var _=s.checked;Xs(s,"checked",null),s.checked=_}}};s.__on_r=n,K1(n),q0()}}function Xs(s,t,n){n=n==null?null:n+"";var u=s.__attributes??(s.__attributes={});Vr&&(u[t]=s.getAttribute(t),t==="src"||t==="href"||t==="srcset")||u[t]!==(u[t]=n)&&(t==="loading"&&(s[X1]=n),n===null?s.removeAttribute(t):s.setAttribute(t,n))}function d2(s,t,n){if(t in s){var u=s[t],_=typeof u=="boolean"&&n===""?!0:n;(typeof u!="object"||u!==_)&&(s[t]=_)}else Xs(s,t,n)}function xn(s,t,n,u,_){var v=_.length!==0,I=t||{},l=s.tagName==="OPTION";for(var P in t)P in n||(n[P]=null);v&&!n.class&&(n.class="");var E=j_.get(s.nodeName);E||j_.set(s.nodeName,E=f2(s));var U=s.__attributes??(s.__attributes={}),j=[];for(const nt in n){let it=n[nt];if(l&&nt==="value"&&it==null){s.value=s.__value="",I[nt]=it;continue}var W=I[nt];if(it!==W){I[nt]=it;var tt=nt[0]+nt[1];if(tt!=="$$")if(tt==="on"){const It={},_t="$$"+nt;let gt=nt.slice(2);var ct=q1.includes(gt);if($1(gt)&&(gt=gt.slice(0,-7),It.capture=!0),!ct&&W){if(it!=null)continue;s.removeEventListener(gt,I[_t],It),I[_t]=null}if(it!=null)if(ct)s[`__${gt}`]=it,o2([gt]);else{let kt=function(Lt){I[nt].call(this,Lt)};t?I[_t]=N_(gt,s,kt,It):j.push([nt,it,()=>I[_t]=N_(gt,s,kt,It)])}}else if(it==null)U[nt]=null,s.removeAttribute(nt);else if(nt==="style")s.style.cssText=it+"";else if(nt==="autofocus")h2(s,!!it);else if(nt==="__value"||nt==="value")s.value=s[nt]=s.__value=it;else{var pt=nt;u&&(pt=pt.toLowerCase(),pt=j1[pt]||pt),E.includes(pt)?Vr&&(pt==="src"||pt==="href"||pt==="srcset")||(s[pt]=it):typeof it!="function"&&(v&&pt==="class"&&(it&&(it+=" "),it+=_),Xs(s,pt,it))}}}return t||fp(()=>{if(s.isConnected)for(const[nt,it,It]of j)I[nt]===it&&It()}),I}function yh(s,t,n,u){if(s.tagName.includes("-")){for(var _ in t)_ in n||(n[_]=null);for(_ in n)d2(s,_,n[_]);return n}return xn(s,t,n,s.namespaceURI!==z0,u)}var p2=["width","height"],j_=new Map;function f2(s){for(var t=[],n,u=F_(s);u.constructor.name!=="Element";){n=J1(u);for(var _ in n)n[_].set&&!p2.includes(_)&&t.push(_);u=F_(u)}return t}function Z0(s,t){var n=s.__className,u=W0(t);Vr&&s.getAttribute("class")===u?s.__className=u:(n!==u||Vr&&s.getAttribute("class")!==u)&&(u===""?s.removeAttribute("class"):s.setAttribute("class",u),s.__className=u)}function Pn(s,t){var n=s.__className,u=W0(t);Vr&&s.className===u?s.__className=u:(n!==u||Vr&&s.className!==u)&&(t==null?s.removeAttribute("class"):s.className=u,s.__className=u)}function W0(s){return s??""}function m2(s,t,n){n?s.classList.add(t):s.classList.remove(t)}const H0=typeof window<"u",g2=H0?requestAnimationFrame:Xd,y2=H0?()=>performance.now():()=>Date.now(),ra={tick:s=>g2(s),now:()=>y2(),tasks:new Set};function Y0(s){ra.tasks.forEach(t=>{t.c(s)||(ra.tasks.delete(t),t.f())}),ra.tasks.size!==0&&ra.tick(Y0)}function _2(s){let t;return ra.tasks.size===0&&ra.tick(Y0),{promise:new Promise(n=>{ra.tasks.add(t={c:s,f:n})}),abort(){ra.tasks.delete(t)}}}function jd(s,t){s.dispatchEvent(new CustomEvent(t))}function v2(s){const t=s.split("-");return t.length===1?t[0]:t[0]+t.slice(1).map(n=>n[0].toUpperCase()+n.slice(1)).join("")}function q_(s){const t={},n=s.split(";");for(const u of n){const[_,v]=u.split(":");if(!_||v===void 0)break;const I=v2(_.trim());t[I]=v.trim()}return t}const b2=s=>s;function K0(s,t,n,u){var _=(s&G1)!==0,v="both",I,l=t.inert,P,E;function U(){return I??(I=n()(t,u==null?void 0:u(),{direction:v}))}var j={is_global:_,in(){t.inert=l,E==null||E.abort(),P==null||P.abort(),jd(t,"introstart"),P=Fm(t,U(),E,1,()=>{jd(t,"introend"),P=I=void 0},void 0)},out(ct){E==null||E.abort(),t.inert=!0,jd(t,"outrostart"),E=Fm(t,U(),P,0,()=>{jd(t,"outroend"),E=I=void 0,ct==null||ct()},void 0),E.reset},stop:()=>{P==null||P.abort(),E==null||E.abort()}},W=pp;if((W.transitions??(W.transitions=[])).push(j),a2){let ct=_;if(!ct){for(var tt=W.parent;tt&&tt.f&O0;)for(;(tt=tt.parent)&&!(tt.f&Q1););ct=!tt||(tt.f&t2)!==0}ct&&N0(()=>{U0(()=>j.in())})}}function Fm(s,t,n,u,_,v){var I=u===1;if(e2(t)){var l;return fp(()=>{var _t=t({direction:I?"in":"out"});l=Fm(s,_t,n,u,_,v)}),{abort:()=>l.abort(),deactivate:()=>l.deactivate(),reset:()=>l.reset(),t:_t=>l.t(_t)}}if(n==null||n.deactivate(),!(t!=null&&t.duration))return _==null||_(),{abort:Xd,deactivate:Xd,reset:Xd,t:()=>u};const{delay:P=0,css:E,tick:U,easing:j=b2}=t;var W=ra.now()+P,tt=(n==null?void 0:n.t(W))??1-u,ct=u-tt,pt=t.duration*Math.abs(ct),nt=W+pt,it,It;return E?fp(()=>{var _t=[],gt=Math.ceil(pt/16.666666666666668);if(I&&P>0){let Rt=Math.ceil(P/16.666666666666668),Qt=q_(E(0,1));for(let Ut=0;Ut<Rt;Ut+=1)_t.push(Qt)}for(var kt=0;kt<=gt;kt+=1){var Lt=tt+ct*j(kt/gt),Vt=E(Lt,1-Lt);_t.push(q_(Vt))}it=s.animate(_t,{delay:I?0:P,duration:pt+(I?P:0),easing:"linear",fill:"forwards"}),it.finished.then(()=>{_==null||_(),u===1&&it.cancel()}).catch(Rt=>{if(it.startTime!==null&&it.currentTime!==null)throw Rt})}):(tt===0&&(U==null||U(0,1)),It=_2(_t=>{if(_t>=nt)return U==null||U(u,1-u),_==null||_(),!1;if(_t>=W){var gt=tt+ct*j((_t-W)/pt);U==null||U(gt,1-gt)}return!0})),{abort:()=>{it==null||it.cancel(),It==null||It.abort(),v==null||v()},deactivate:()=>{_=void 0,v=void 0},reset:()=>{u===0&&(U==null||U(1,0))},t:_t=>{var gt=tt+ct*j((_t-W)/pt);return Math.min(1,Math.max(0,gt))}}}function x2(s,t,n,u=n){s.addEventListener(t,n);const _=s.__on_r;_?s.__on_r=()=>{_(),u()}:s.__on_r=u,q0()}function X0(s,t,n){x2(s,"input",()=>{n(G_(s)?Z_(s.value):s.value)}),V0(()=>{var u=t();if(Vr&&s.defaultValue!==s.value){n(s.value);return}G_(s)&&u===Z_(s.value)||s.type==="date"&&!u&&!s.value||(s.value=u??"")})}function G_(s){var t=s.type;return t==="number"||t==="range"}function Z_(s){return s===""?null:+s}function w2(s,t,n){var u=r2(s,t);u&&u.set&&(s[t]=n,i2(()=>{s[t]=null}))}var S2=ue('<div class="left svelte-kic6jv"><!></div> <div class="main svelte-kic6jv"><!></div>',1);function I2(s,t){var l,P;var n=S2(),u=De(n),_=xe(u);vi(_,(l=t.$$slots)==null?void 0:l.left,{},null),we(u);var v=Ot(Ot(u,!0)),I=xe(v);vi(I,(P=t.$$slots)==null?void 0:P.main,{},null),we(v),Et(s,n)}var T2=ue("<div><!></div> <div><!></div>",1);function pg(s,t){var U,j;const n=us(),u=()=>Oi(Om,"$sidebarContents",n),_=()=>Oi(Nm,"$mapContents",n);var v=T2(),I=De(v);wl(I,W=>Hn(Om,W),()=>u());var l=xe(I);vi(l,(U=t.$$slots)==null?void 0:U.sidebar,{},null),we(I);var P=Ot(Ot(I,!0));wl(P,W=>Hn(Nm,W),()=>_());var E=xe(P);vi(E,(j=t.$$slots)==null?void 0:j.map,{},null),we(P),Et(s,v)}let Om=Dr(null),Nm=Dr(null);const J0=Symbol.for("svelte-maplibre");function tf(){return qr(J0)}function k2(s){let t=new WeakMap;return n=>{var I;let u=t.get(n.originalEvent);if(u!==void 0)return u;let v=(I=n.target.queryRenderedFeatures(n.point).find(l=>{var P;return(P=s.get(l.layer.id))==null?void 0:P.interactive}))==null?void 0:I.layer.id;return t.set(n.originalEvent,v),v}}function A2(){let s=new Map;return ns(J0,{map:Dr(null),source:bm(null),layer:bm(null),popupTarget:bm(null),cluster:Dr(),loadedImages:Dr(new Set),minzoom:Dr(0),maxzoom:Dr(24),layerEvent:Dr(null),layerInfo:s,eventTopMost:k2(s)})}var E2=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function C2(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Q0={exports:{}};(function(s,t){(function(n,u){s.exports=u()})(E2,function(){var n,u,_;function v(l,P){if(!n)n=P;else if(!u)u=P;else{var E="var sharedChunk = {}; ("+n+")(sharedChunk); ("+u+")(sharedChunk);",U={};n(U),_=P(U),typeof window<"u"&&(_.workerUrl=window.URL.createObjectURL(new Blob([E],{type:"text/javascript"})))}}v(["exports"],function(l){function P(r,e,o,c){return new(o||(o=Promise))(function(d,m){function y(k){try{S(c.next(k))}catch(C){m(C)}}function b(k){try{S(c.throw(k))}catch(C){m(C)}}function S(k){var C;k.done?d(k.value):(C=k.value,C instanceof o?C:new o(function(L){L(C)})).then(y,b)}S((c=c.apply(r,e||[])).next())})}function E(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}typeof SuppressedError=="function"&&SuppressedError;var U=j;function j(r,e){this.x=r,this.y=e}j.prototype={clone:function(){return new j(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,e){return this.clone()._rotateAround(r,e)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var e=r.x-this.x,o=r.y-this.y;return e*e+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult:function(r){var e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var e=Math.cos(r),o=Math.sin(r),c=o*this.x+e*this.y;return this.x=e*this.x-o*this.y,this.y=c,this},_rotateAround:function(r,e){var o=Math.cos(r),c=Math.sin(r),d=e.y+c*(this.x-e.x)+o*(this.y-e.y);return this.x=e.x+o*(this.x-e.x)-c*(this.y-e.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},j.convert=function(r){return r instanceof j?r:Array.isArray(r)?new j(r[0],r[1]):r};var W=E(U),tt=ct;function ct(r,e,o,c){this.cx=3*r,this.bx=3*(o-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(c-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=e,this.p2x=o,this.p2y=c}ct.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,e){if(e===void 0&&(e=1e-6),r<0)return 0;if(r>1)return 1;for(var o=r,c=0;c<8;c++){var d=this.sampleCurveX(o)-r;if(Math.abs(d)<e)return o;var m=this.sampleCurveDerivativeX(o);if(Math.abs(m)<1e-6)break;o-=d/m}var y=0,b=1;for(o=r,c=0;c<20&&(d=this.sampleCurveX(o),!(Math.abs(d-r)<e));c++)r>d?y=o:b=o,o=.5*(b-y)+y;return o},solve:function(r,e){return this.sampleCurveY(this.solveCurveX(r,e))}};var pt=E(tt);let nt,it;function It(){return nt==null&&(nt=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),nt}function _t(){if(it==null&&(it=!1,It())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let c=0;c<5*5;c++){const d=4*c;e.fillStyle=`rgb(${d},${d+1},${d+2})`,e.fillRect(c%5,Math.floor(c/5),1,1)}const o=e.getImageData(0,0,5,5).data;for(let c=0;c<5*5*4;c++)if(c%4!=3&&o[c]!==c){it=!0;break}}}return it||!1}function gt(r,e,o,c){const d=new pt(r,e,o,c);return function(m){return d.solve(m)}}const kt=gt(.25,.1,.25,1);function Lt(r,e,o){return Math.min(o,Math.max(e,r))}function Vt(r,e,o){const c=o-e,d=((r-e)%c+c)%c+e;return d===e?o:d}function Rt(r,...e){for(const o of e)for(const c in o)r[c]=o[c];return r}let Qt=1;function Ut(r,e,o){const c={};for(const d in r)c[d]=e.call(o||this,r[d],d,r);return c}function me(r,e,o){const c={};for(const d in r)e.call(o||this,r[d],d,r)&&(c[d]=r[d]);return c}function jt(r){return Array.isArray(r)?r.map(jt):typeof r=="object"&&r?Ut(r,jt):r}const Bt={};function ae(r){Bt[r]||(typeof console<"u"&&console.warn(r),Bt[r]=!0)}function he(r,e,o){return(o.y-r.y)*(e.x-r.x)>(e.y-r.y)*(o.x-r.x)}function ve(r){let e=0;for(let o,c,d=0,m=r.length,y=m-1;d<m;y=d++)o=r[d],c=r[y],e+=(c.x-o.x)*(o.y+c.y);return e}function se(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let ne=null;function ie(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const ci="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ti(r,e,o,c,d){return P(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const m=new VideoFrame(r,{timestamp:0});try{const y=m==null?void 0:m.format;if(!y||!y.startsWith("BGR")&&!y.startsWith("RGB"))throw new Error(`Unrecognized format ${y}`);const b=y.startsWith("BGR"),S=new Uint8ClampedArray(c*d*4);if(yield m.copyTo(S,function(k,C,L,B,O){const N=4*Math.max(-C,0),q=(Math.max(0,L)-L)*B*4+N,X=4*B,et=Math.max(0,C),dt=Math.max(0,L);return{rect:{x:et,y:dt,width:Math.min(k.width,C+B)-et,height:Math.min(k.height,L+O)-dt},layout:[{offset:q,stride:X}]}}(r,e,o,c,d)),b)for(let k=0;k<S.length;k+=4){const C=S[k];S[k]=S[k+2],S[k+2]=C}return S}finally{m.close()}})}let mi,di,ke,Xe;const xi={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(r){const e=requestAnimationFrame(r);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(r,e=0){return this.getImageCanvasContext(r).getImageData(-e,-e,r.width+2*e,r.height+2*e)},getImageCanvasContext(r){const e=window.document.createElement("canvas"),o=e.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return e.width=r.width,e.height=r.height,o.drawImage(r,0,0,r.width,r.height),o},resolveURL:r=>(ke||(ke=document.createElement("a")),ke.href=r,ke.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Xe==null&&(Xe=matchMedia("(prefers-reduced-motion: reduce)")),Xe.matches)}},ye={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class Xt extends Error{constructor(e,o,c,d){super(`AJAXError: ${o} (${e}): ${c}`),this.status=e,this.statusText=o,this.url=c,this.body=d}}const ze=se()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,Mi=r=>ye.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))];function en(r,e){const o=new AbortController,c=new Request(r.url,{method:r.method||"GET",body:r.body,credentials:r.credentials,headers:r.headers,cache:r.cache,referrer:ze(),signal:o.signal});let d=!1,m=!1;return r.type==="json"&&c.headers.set("Accept","application/json"),m||fetch(c).then(y=>y.ok?(b=>{(r.type==="arrayBuffer"||r.type==="image"?b.arrayBuffer():r.type==="json"?b.json():b.text()).then(S=>{m||(d=!0,e(null,S,b.headers.get("Cache-Control"),b.headers.get("Expires")))}).catch(S=>{m||e(new Error(S.message))})})(y):y.blob().then(b=>e(new Xt(y.status,y.statusText,r.url,b)))).catch(y=>{y.code!==20&&e(new Error(y.message))}),{cancel:()=>{m=!0,d||o.abort()}}}const lr=function(r,e){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){if(se()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,e);if(!se())return(Mi(r.url)||en)(r,e)}if(!(/^file:/.test(o=r.url)||/^file:/.test(ze())&&!/^\w+:/.test(o))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return en(r,e);if(se()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var o;return function(c,d){const m=new XMLHttpRequest;m.open(c.method||"GET",c.url,!0),c.type!=="arrayBuffer"&&c.type!=="image"||(m.responseType="arraybuffer");for(const y in c.headers)m.setRequestHeader(y,c.headers[y]);return c.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=c.credentials==="include",m.onerror=()=>{d(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let y=m.response;if(c.type==="json")try{y=JSON.parse(m.response)}catch(b){return d(b)}d(null,y,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else{const y=new Blob([m.response],{type:m.getResponseHeader("Content-Type")});d(new Xt(m.status,m.statusText,c.url,y))}},m.send(c.body),{cancel:()=>m.abort()}}(r,e)},wn=function(r,e){return lr(Rt(r,{type:"arrayBuffer"}),e)};function ir(r){if(!r||r.indexOf("://")<=0||r.indexOf("data:image/")===0||r.indexOf("blob:")===0)return!0;const e=new URL(r),o=window.location;return e.protocol===o.protocol&&e.host===o.host}function yr(r,e,o){o[r]&&o[r].indexOf(e)!==-1||(o[r]=o[r]||[],o[r].push(e))}function Pr(r,e,o){if(o&&o[r]){const c=o[r].indexOf(e);c!==-1&&o[r].splice(c,1)}}class rn{constructor(e,o={}){Rt(this,o),this.type=e}}class Gr extends rn{constructor(e,o={}){super("error",Rt({error:e},o))}}class Sn{on(e,o){return this._listeners=this._listeners||{},yr(e,o,this._listeners),this}off(e,o){return Pr(e,o,this._listeners),Pr(e,o,this._oneTimeListeners),this}once(e,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},yr(e,o,this._oneTimeListeners),this):new Promise(c=>this.once(e,c))}fire(e,o){typeof e=="string"&&(e=new rn(e,o||{}));const c=e.type;if(this.listens(c)){e.target=this;const d=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const b of d)b.call(this,e);const m=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const b of m)Pr(c,b,this._oneTimeListeners),b.call(this,e);const y=this._eventedParent;y&&(Rt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(e))}else e instanceof Gr&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,o){return this._eventedParent=e,this._eventedParentData=o,this}}var Tt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ar=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function dn(r,e){const o={};for(const c in r)c!=="ref"&&(o[c]=r[c]);return Ar.forEach(c=>{c in e&&(o[c]=e[c])}),o}function Ei(r,e){if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let o=0;o<r.length;o++)if(!Ei(r[o],e[o]))return!1;return!0}if(typeof r=="object"&&r!==null&&e!==null){if(typeof e!="object"||Object.keys(r).length!==Object.keys(e).length)return!1;for(const o in r)if(!Ei(r[o],e[o]))return!1;return!0}return r===e}const gi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function nn(r,e,o){o.push({command:gi.addSource,args:[r,e[r]]})}function Fs(r,e,o){e.push({command:gi.removeSource,args:[r]}),o[r]=!0}function Zr(r,e,o,c){Fs(r,o,c),nn(r,e,o)}function Za(r,e,o){let c;for(c in r[o])if(Object.prototype.hasOwnProperty.call(r[o],c)&&c!=="data"&&!Ei(r[o][c],e[o][c]))return!1;for(c in e[o])if(Object.prototype.hasOwnProperty.call(e[o],c)&&c!=="data"&&!Ei(r[o][c],e[o][c]))return!1;return!0}function ro(r,e,o,c,d,m){let y;for(y in e=e||{},r=r||{})Object.prototype.hasOwnProperty.call(r,y)&&(Ei(r[y],e[y])||o.push({command:m,args:[c,y,e[y],d]}));for(y in e)Object.prototype.hasOwnProperty.call(e,y)&&!Object.prototype.hasOwnProperty.call(r,y)&&(Ei(r[y],e[y])||o.push({command:m,args:[c,y,e[y],d]}))}function no(r){return r.id}function Mo(r,e){return r[e.id]=e,r}class Gt{constructor(e,o,c,d){this.message=(e?`${e}: `:"")+c,d&&(this.identifier=d),o!=null&&o.__line__&&(this.line=o.__line__)}}function vs(r,...e){for(const o of e)for(const c in o)r[c]=o[c];return r}class cr extends Error{constructor(e,o){super(o),this.message=o,this.key=e}}class Do{constructor(e,o=[]){this.parent=e,this.bindings={};for(const[c,d]of o)this.bindings[c]=d}concat(e){return new Do(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Os={kind:"null"},Wt={kind:"number"},Je={kind:"string"},Re={kind:"boolean"},pn={kind:"color"},bs={kind:"object"},He={kind:"value"},Ns={kind:"collator"},H={kind:"formatted"},z={kind:"padding"},R={kind:"resolvedImage"},V={kind:"variableAnchorOffsetCollection"};function K(r,e){return{kind:"array",itemType:r,N:e}}function J(r){if(r.kind==="array"){const e=J(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const ft=[Os,Wt,Je,Re,pn,H,bs,K(He),z,R,V];function at(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!at(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const o of ft)if(!at(o,e))return null}}return`Expected ${J(r)} but found ${J(e)} instead.`}function rt(r,e){return e.some(o=>o.kind===r.kind)}function ht(r,e){return e.some(o=>o==="null"?r===null:o==="array"?Array.isArray(r):o==="object"?r&&!Array.isArray(r)&&typeof r=="object":o===typeof r)}function At(r,e){return r.kind==="array"&&e.kind==="array"?r.itemType.kind===e.itemType.kind&&typeof r.N=="number":r.kind===e.kind}const Ct=.96422,Pt=.82521,Se=4/29,Le=6/29,de=3*Le*Le,Te=Le*Le*Le,Fe=Math.PI/180,ki=180/Math.PI;function Bi(r){return(r%=360)<0&&(r+=360),r}function yi([r,e,o,c]){let d,m;const y=sn((.2225045*(r=pi(r))+.7168786*(e=pi(e))+.0606169*(o=pi(o)))/1);r===e&&e===o?d=m=y:(d=sn((.4360747*r+.3850649*e+.1430804*o)/Ct),m=sn((.0139322*r+.0971045*e+.7141733*o)/Pt));const b=116*y-16;return[b<0?0:b,500*(d-y),200*(y-m),c]}function pi(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function sn(r){return r>Te?Math.pow(r,1/3):r/de+Se}function $i([r,e,o,c]){let d=(r+16)/116,m=isNaN(e)?d:d+e/500,y=isNaN(o)?d:d-o/200;return d=1*Wr(d),m=Ct*Wr(m),y=Pt*Wr(y),[Er(3.1338561*m-1.6168667*d-.4906146*y),Er(-.9787684*m+1.9161415*d+.033454*y),Er(.0719453*m-.2289914*d+1.4052427*y),c]}function Er(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function Wr(r){return r>Le?r*r*r:de*(r-Se)}function Kn(r){return parseInt(r.padEnd(2,r),16)/255}function Rh(r,e){return aa(e?r/100:r,0,1)}function aa(r,e,o){return Math.min(Math.max(e,r),o)}function la(r){return!r.some(Number.isNaN)}const pf={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Di{constructor(e,o,c,d=1,m=!0){this.r=e,this.g=o,this.b=c,this.a=d,m||(this.r*=d,this.g*=d,this.b*=d,d||this.overwriteGetter("rgb",[e,o,c,d]))}static parse(e){if(e instanceof Di)return e;if(typeof e!="string")return;const o=function(c){if((c=c.toLowerCase().trim())==="transparent")return[0,0,0,0];const d=pf[c];if(d){const[y,b,S]=d;return[y/255,b/255,S/255,1]}if(c.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(c)){const y=c.length<6?1:2;let b=1;return[Kn(c.slice(b,b+=y)),Kn(c.slice(b,b+=y)),Kn(c.slice(b,b+=y)),Kn(c.slice(b,b+y)||"ff")]}if(c.startsWith("rgb")){const y=c.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){const[b,S,k,C,L,B,O,N,q,X,et,dt]=y,ot=[C||" ",O||" ",X].join("");if(ot==="  "||ot==="  /"||ot===",,"||ot===",,,"){const mt=[k,B,q].join(""),vt=mt==="%%%"?100:mt===""?255:0;if(vt){const Dt=[aa(+S/vt,0,1),aa(+L/vt,0,1),aa(+N/vt,0,1),et?Rh(+et,dt):1];if(la(Dt))return Dt}}return}}const m=c.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[y,b,S,k,C,L,B,O,N]=m,q=[S||" ",C||" ",B].join("");if(q==="  "||q==="  /"||q===",,"||q===",,,"){const X=[+b,aa(+k,0,100),aa(+L,0,100),O?Rh(+O,N):1];if(la(X))return function([et,dt,ot,mt]){function vt(Dt){const ee=(Dt+et/30)%12,fe=dt*Math.min(ot,1-ot);return ot-fe*Math.max(-1,Math.min(ee-3,9-ee,1))}return et=Bi(et),dt/=100,ot/=100,[vt(0),vt(8),vt(4),mt]}(X)}}}(e);return o?new Di(...o,!1):void 0}get rgb(){const{r:e,g:o,b:c,a:d}=this,m=d||1/0;return this.overwriteGetter("rgb",[e/m,o/m,c/m,d])}get hcl(){return this.overwriteGetter("hcl",function(e){const[o,c,d,m]=yi(e),y=Math.sqrt(c*c+d*d);return[Math.round(1e4*y)?Bi(Math.atan2(d,c)*ki):NaN,y,o,m]}(this.rgb))}get lab(){return this.overwriteGetter("lab",yi(this.rgb))}overwriteGetter(e,o){return Object.defineProperty(this,e,{value:o}),o}toString(){const[e,o,c,d]=this.rgb;return`rgba(${[e,o,c].map(m=>Math.round(255*m)).join(",")},${d})`}}Di.black=new Di(0,0,0,1),Di.white=new Di(1,1,1,1),Di.transparent=new Di(0,0,0,0),Di.red=new Di(1,0,0,1);class Yc{constructor(e,o,c){this.sensitivity=e?o?"variant":"case":o?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,o){return this.collator.compare(e,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class El{constructor(e,o,c,d,m){this.text=e,this.image=o,this.scale=c,this.fontStack=d,this.textColor=m}}class on{constructor(e){this.sections=e}static fromString(e){return new on([new El(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof on?e:on.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class Bn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Bn)return e;if(typeof e=="number")return new Bn([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const o of e)if(typeof o!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Bn(e)}}toString(){return JSON.stringify(this.values)}}const ff=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Xn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Xn)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let o=0;o<e.length;o+=2){const c=e[o],d=e[o+1];if(typeof c!="string"||!ff.has(c)||!Array.isArray(d)||d.length!==2||typeof d[0]!="number"||typeof d[1]!="number")return}return new Xn(e)}}toString(){return JSON.stringify(this.values)}}class Hr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Hr({name:e,available:!1}):null}}function Cl(r,e,o,c){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof o=="number"&&o>=0&&o<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[r,e,o,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[r,e,o,c]:[r,e,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ca(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof Di||r instanceof Yc||r instanceof on||r instanceof Bn||r instanceof Xn||r instanceof Hr)return!0;if(Array.isArray(r)){for(const e of r)if(!ca(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!ca(r[e]))return!1;return!0}return!1}function rr(r){if(r===null)return Os;if(typeof r=="string")return Je;if(typeof r=="boolean")return Re;if(typeof r=="number")return Wt;if(r instanceof Di)return pn;if(r instanceof Yc)return Ns;if(r instanceof on)return H;if(r instanceof Bn)return z;if(r instanceof Xn)return V;if(r instanceof Hr)return R;if(Array.isArray(r)){const e=r.length;let o;for(const c of r){const d=rr(c);if(o){if(o===d)continue;o=He;break}o=d}return K(o||He,e)}return bs}function wi(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof Di||r instanceof on||r instanceof Bn||r instanceof Xn||r instanceof Hr?r.toString():JSON.stringify(r)}class Po{constructor(e,o){this.type=e,this.value=o}static parse(e,o){if(e.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ca(e[1]))return o.error("invalid value");const c=e[1];let d=rr(c);const m=o.expectedType;return d.kind!=="array"||d.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(d=m),new Po(d,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class ur{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Ml={string:Je,number:Wt,boolean:Re,object:bs};class Jn{constructor(e,o){this.type=e,this.args=o}static parse(e,o){if(e.length<2)return o.error("Expected at least one argument.");let c,d=1;const m=e[0];if(m==="array"){let b,S;if(e.length>2){const k=e[1];if(typeof k!="string"||!(k in Ml)||k==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);b=Ml[k],d++}else b=He;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return o.error('The length argument to "array" must be a positive integer literal',2);S=e[2],d++}c=K(b,S)}else{if(!Ml[m])throw new Error(`Types doesn't contain name = ${m}`);c=Ml[m]}const y=[];for(;d<e.length;d++){const b=o.parse(e[d],d,He);if(!b)return null;y.push(b)}return new Jn(c,y)}evaluate(e){for(let o=0;o<this.args.length;o++){const c=this.args[o].evaluate(e);if(!at(this.type,rr(c)))return c;if(o===this.args.length-1)throw new ur(`Expected value to be of type ${J(this.type)}, but found ${J(rr(c))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Kc={"to-boolean":Re,"to-color":pn,"to-number":Wt,"to-string":Je};class so{constructor(e,o){this.type=e,this.args=o}static parse(e,o){if(e.length<2)return o.error("Expected at least one argument.");const c=e[0];if(!Kc[c])throw new Error(`Can't parse ${c} as it is not part of the known types`);if((c==="to-boolean"||c==="to-string")&&e.length!==2)return o.error("Expected one argument.");const d=Kc[c],m=[];for(let y=1;y<e.length;y++){const b=o.parse(e[y],y,He);if(!b)return null;m.push(b)}return new so(d,m)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let o,c;for(const d of this.args){if(o=d.evaluate(e),c=null,o instanceof Di)return o;if(typeof o=="string"){const m=e.parseColor(o);if(m)return m}else if(Array.isArray(o)&&(c=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:Cl(o[0],o[1],o[2],o[3]),!c))return new Di(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new ur(c||`Could not parse color from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"padding":{let o;for(const c of this.args){o=c.evaluate(e);const d=Bn.parse(o);if(d)return d}throw new ur(`Could not parse padding from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"variableAnchorOffsetCollection":{let o;for(const c of this.args){o=c.evaluate(e);const d=Xn.parse(o);if(d)return d}throw new ur(`Could not parse variableAnchorOffsetCollection from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"number":{let o=null;for(const c of this.args){if(o=c.evaluate(e),o===null)return 0;const d=Number(o);if(!isNaN(d))return d}throw new ur(`Could not convert ${JSON.stringify(o)} to number.`)}case"formatted":return on.fromString(wi(this.args[0].evaluate(e)));case"resolvedImage":return Hr.fromString(wi(this.args[0].evaluate(e)));default:return wi(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Fh=["Unknown","Point","LineString","Polygon"];class Xc{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Fh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let o=this._parseColorCache[e];return o||(o=this._parseColorCache[e]=Di.parse(e)),o}}class Dl{constructor(e,o,c=[],d,m=new Do,y=[]){this.registry=e,this.path=c,this.key=c.map(b=>`[${b}]`).join(""),this.scope=m,this.errors=y,this.expectedType=d,this._isConstant=o}parse(e,o,c,d,m={}){return o?this.concat(o,c,d)._parse(e,m):this._parse(e,m)}_parse(e,o){function c(d,m,y){return y==="assert"?new Jn(m,[d]):y==="coerce"?new so(m,[d]):d}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=e[0];if(typeof d!="string")return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[d];if(m){let y=m.parse(e,this);if(!y)return null;if(this.expectedType){const b=this.expectedType,S=y.type;if(b.kind!=="string"&&b.kind!=="number"&&b.kind!=="boolean"&&b.kind!=="object"&&b.kind!=="array"||S.kind!=="value")if(b.kind!=="color"&&b.kind!=="formatted"&&b.kind!=="resolvedImage"||S.kind!=="value"&&S.kind!=="string")if(b.kind!=="padding"||S.kind!=="value"&&S.kind!=="number"&&S.kind!=="array")if(b.kind!=="variableAnchorOffsetCollection"||S.kind!=="value"&&S.kind!=="array"){if(this.checkSubtype(b,S))return null}else y=c(y,b,o.typeAnnotation||"coerce");else y=c(y,b,o.typeAnnotation||"coerce");else y=c(y,b,o.typeAnnotation||"coerce");else y=c(y,b,o.typeAnnotation||"assert")}if(!(y instanceof Po)&&y.type.kind!=="resolvedImage"&&this._isConstant(y)){const b=new Xc;try{y=new Po(y.type,y.evaluate(b))}catch(S){return this.error(S.message),null}}return y}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,o,c){const d=typeof e=="number"?this.path.concat(e):this.path,m=c?this.scope.concat(c):this.scope;return new Dl(this.registry,this._isConstant,d,o||null,m,this.errors)}error(e,...o){const c=`${this.key}${o.map(d=>`[${d}]`).join("")}`;this.errors.push(new cr(c,e))}checkSubtype(e,o){const c=at(e,o);return c&&this.error(c),c}}class Pl{constructor(e,o,c){this.type=Ns,this.locale=c,this.caseSensitive=e,this.diacriticSensitive=o}static parse(e,o){if(e.length!==2)return o.error("Expected one argument.");const c=e[1];if(typeof c!="object"||Array.isArray(c))return o.error("Collator options argument must be an object.");const d=o.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,Re);if(!d)return null;const m=o.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,Re);if(!m)return null;let y=null;return c.locale&&(y=o.parse(c.locale,1,Je),!y)?null:new Pl(d,m,y)}evaluate(e){return new Yc(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const oo=8192;function Jc(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function Wa(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function Oh(r,e){const o=(180+r[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,d=Math.pow(2,e.z);return[Math.round(o*d*oo),Math.round(c*d*oo)]}function mf(r,e,o){const c=r[0]-e[0],d=r[1]-e[1],m=r[0]-o[0],y=r[1]-o[1];return c*y-m*d==0&&c*m<=0&&d*y<=0}function Qc(r,e){let o=!1;for(let y=0,b=e.length;y<b;y++){const S=e[y];for(let k=0,C=S.length;k<C-1;k++){if(mf(r,S[k],S[k+1]))return!1;(d=S[k])[1]>(c=r)[1]!=(m=S[k+1])[1]>c[1]&&c[0]<(m[0]-d[0])*(c[1]-d[1])/(m[1]-d[1])+d[0]&&(o=!o)}}var c,d,m;return o}function tu(r,e){for(let o=0;o<e.length;o++)if(Qc(r,e[o]))return!0;return!1}function Nh(r,e,o,c){const d=c[0]-o[0],m=c[1]-o[1],y=(r[0]-o[0])*m-d*(r[1]-o[1]),b=(e[0]-o[0])*m-d*(e[1]-o[1]);return y>0&&b<0||y<0&&b>0}function gf(r,e,o){for(const k of o)for(let C=0;C<k.length-1;++C)if((b=[(y=k[C+1])[0]-(m=k[C])[0],y[1]-m[1]])[0]*(S=[(d=e)[0]-(c=r)[0],d[1]-c[1]])[1]-b[1]*S[0]!=0&&Nh(c,d,m,y)&&Nh(m,y,c,d))return!0;var c,d,m,y,b,S;return!1}function Uh(r,e){for(let o=0;o<r.length;++o)if(!Qc(r[o],e))return!1;for(let o=0;o<r.length-1;++o)if(gf(r[o],r[o+1],e))return!1;return!0}function Vh(r,e){for(let o=0;o<e.length;o++)if(Uh(r,e[o]))return!0;return!1}function Ll(r,e,o){const c=[];for(let d=0;d<r.length;d++){const m=[];for(let y=0;y<r[d].length;y++){const b=Oh(r[d][y],o);Jc(e,b),m.push(b)}c.push(m)}return c}function $h(r,e,o){const c=[];for(let d=0;d<r.length;d++){const m=Ll(r[d],e,o);c.push(m)}return c}function jh(r,e,o,c){if(r[0]<o[0]||r[0]>o[2]){const d=.5*c;let m=r[0]-o[0]>d?-c:o[0]-r[0]>d?c:0;m===0&&(m=r[0]-o[2]>d?-c:o[2]-r[0]>d?c:0),r[0]+=m}Jc(e,r)}function eu(r,e,o,c){const d=Math.pow(2,c.z)*oo,m=[c.x*oo,c.y*oo],y=[];for(const b of r)for(const S of b){const k=[S.x+m[0],S.y+m[1]];jh(k,e,o,d),y.push(k)}return y}function iu(r,e,o,c){const d=Math.pow(2,c.z)*oo,m=[c.x*oo,c.y*oo],y=[];for(const S of r){const k=[];for(const C of S){const L=[C.x+m[0],C.y+m[1]];Jc(e,L),k.push(L)}y.push(k)}if(e[2]-e[0]<=d/2){(b=e)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const S of y)for(const k of S)jh(k,e,o,d)}var b;return y}class Lo{constructor(e,o){this.type=Re,this.geojson=e,this.geometries=o}static parse(e,o){if(e.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ca(e[1])){const c=e[1];if(c.type==="FeatureCollection")for(let d=0;d<c.features.length;++d){const m=c.features[d].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Lo(c,c.features[d].geometry)}else if(c.type==="Feature"){const d=c.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new Lo(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new Lo(c,c)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(o,c){const d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],y=o.canonicalID();if(c.type==="Polygon"){const b=Ll(c.coordinates,m,y),S=eu(o.geometry(),d,m,y);if(!Wa(d,m))return!1;for(const k of S)if(!Qc(k,b))return!1}if(c.type==="MultiPolygon"){const b=$h(c.coordinates,m,y),S=eu(o.geometry(),d,m,y);if(!Wa(d,m))return!1;for(const k of S)if(!tu(k,b))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(o,c){const d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],y=o.canonicalID();if(c.type==="Polygon"){const b=Ll(c.coordinates,m,y),S=iu(o.geometry(),d,m,y);if(!Wa(d,m))return!1;for(const k of S)if(!Uh(k,b))return!1}if(c.type==="MultiPolygon"){const b=$h(c.coordinates,m,y),S=iu(o.geometry(),d,m,y);if(!Wa(d,m))return!1;for(const k of S)if(!Vh(k,b))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class zl{constructor(e,o){this.type=o.type,this.name=e,this.boundExpression=o}static parse(e,o){if(e.length!==2||typeof e[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const c=e[1];return o.scope.has(c)?new zl(c,o.scope.get(c)):o.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Qn{constructor(e,o,c,d){this.name=e,this.type=o,this._evaluate=c,this.args=d}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,o){const c=e[0],d=Qn.definitions[c];if(!d)return o.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(d)?d[0]:d.type,y=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,b=y.filter(([k])=>!Array.isArray(k)||k.length===e.length-1);let S=null;for(const[k,C]of b){S=new Dl(o.registry,Bl,o.path,null,o.scope);const L=[];let B=!1;for(let O=1;O<e.length;O++){const N=e[O],q=Array.isArray(k)?k[O-1]:k.type,X=S.parse(N,1+L.length,q);if(!X){B=!0;break}L.push(X)}if(!B)if(Array.isArray(k)&&k.length!==L.length)S.error(`Expected ${k.length} arguments, but found ${L.length} instead.`);else{for(let O=0;O<L.length;O++){const N=Array.isArray(k)?k[O]:k.type,q=L[O];S.concat(O+1).checkSubtype(N,q.type)}if(S.errors.length===0)return new Qn(c,m,C,L)}}if(b.length===1)o.errors.push(...S.errors);else{const k=(b.length?b:y).map(([L])=>{return B=L,Array.isArray(B)?`(${B.map(J).join(", ")})`:`(${J(B.type)}...)`;var B}).join(" | "),C=[];for(let L=1;L<e.length;L++){const B=o.parse(e[L],1+C.length);if(!B)return null;C.push(J(B.type))}o.error(`Expected arguments of type ${k}, but found (${C.join(", ")}) instead.`)}return null}static register(e,o){Qn.definitions=o;for(const c in o)e[c]=Qn}}function Bl(r){if(r instanceof zl)return Bl(r.boundExpression);if(r instanceof Qn&&r.name==="error"||r instanceof Pl||r instanceof Lo)return!1;const e=r instanceof so||r instanceof Jn;let o=!0;return r.eachChild(c=>{o=e?o&&Bl(c):o&&c instanceof Po}),!!o&&Rl(r)&&Fl(r,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Rl(r){if(r instanceof Qn&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof Lo)return!1;let e=!0;return r.eachChild(o=>{e&&!Rl(o)&&(e=!1)}),e}function Ha(r){if(r instanceof Qn&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(o=>{e&&!Ha(o)&&(e=!1)}),e}function Fl(r,e){if(r instanceof Qn&&e.indexOf(r.name)>=0)return!1;let o=!0;return r.eachChild(c=>{o&&!Fl(c,e)&&(o=!1)}),o}function ua(r,e){const o=r.length-1;let c,d,m=0,y=o,b=0;for(;m<=y;)if(b=Math.floor((m+y)/2),c=r[b],d=r[b+1],c<=e){if(b===o||e<d)return b;m=b+1}else{if(!(c>e))throw new ur("Input is not a number.");y=b-1}return 0}class ao{constructor(e,o,c){this.type=e,this.input=o,this.labels=[],this.outputs=[];for(const[d,m]of c)this.labels.push(d),this.outputs.push(m)}static parse(e,o){if(e.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return o.error("Expected an even number of arguments.");const c=o.parse(e[1],1,Wt);if(!c)return null;const d=[];let m=null;o.expectedType&&o.expectedType.kind!=="value"&&(m=o.expectedType);for(let y=1;y<e.length;y+=2){const b=y===1?-1/0:e[y],S=e[y+1],k=y,C=y+1;if(typeof b!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(d.length&&d[d.length-1][0]>=b)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const L=o.parse(S,C,m);if(!L)return null;m=m||L.type,d.push([b,L])}return new ao(m,c,d)}evaluate(e){const o=this.labels,c=this.outputs;if(o.length===1)return c[0].evaluate(e);const d=this.input.evaluate(e);if(d<=o[0])return c[0].evaluate(e);const m=o.length;return d>=o[m-1]?c[m-1].evaluate(e):c[ua(o,d)].evaluate(e)}eachChild(e){e(this.input);for(const o of this.outputs)e(o)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function ui(r,e,o){return r+o*(e-r)}function Ol(r,e,o){return r.map((c,d)=>ui(c,e[d],o))}const Rn={number:ui,color:function(r,e,o,c="rgb"){switch(c){case"rgb":{const[d,m,y,b]=Ol(r.rgb,e.rgb,o);return new Di(d,m,y,b,!1)}case"hcl":{const[d,m,y,b]=r.hcl,[S,k,C,L]=e.hcl;let B,O;if(isNaN(d)||isNaN(S))isNaN(d)?isNaN(S)?B=NaN:(B=S,y!==1&&y!==0||(O=k)):(B=d,C!==1&&C!==0||(O=m));else{let dt=S-d;S>d&&dt>180?dt-=360:S<d&&d-S>180&&(dt+=360),B=d+o*dt}const[N,q,X,et]=function([dt,ot,mt,vt]){return dt=isNaN(dt)?0:dt*Fe,$i([mt,Math.cos(dt)*ot,Math.sin(dt)*ot,vt])}([B,O??ui(m,k,o),ui(y,C,o),ui(b,L,o)]);return new Di(N,q,X,et,!1)}case"lab":{const[d,m,y,b]=$i(Ol(r.lab,e.lab,o));return new Di(d,m,y,b,!1)}}},array:Ol,padding:function(r,e,o){return new Bn(Ol(r.values,e.values,o))},variableAnchorOffsetCollection:function(r,e,o){const c=r.values,d=e.values;if(c.length!==d.length)throw new ur(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${e.toString()}`);const m=[];for(let y=0;y<c.length;y+=2){if(c[y]!==d[y])throw new ur(`Cannot interpolate values containing mismatched anchors. from[${y}]: ${c[y]}, to[${y}]: ${d[y]}`);m.push(c[y]);const[b,S]=c[y+1],[k,C]=d[y+1];m.push([ui(b,k,o),ui(S,C,o)])}return new Xn(m)}};class Fn{constructor(e,o,c,d,m){this.type=e,this.operator=o,this.interpolation=c,this.input=d,this.labels=[],this.outputs=[];for(const[y,b]of m)this.labels.push(y),this.outputs.push(b)}static interpolationFactor(e,o,c,d){let m=0;if(e.name==="exponential")m=ru(o,e.base,c,d);else if(e.name==="linear")m=ru(o,1,c,d);else if(e.name==="cubic-bezier"){const y=e.controlPoints;m=new pt(y[0],y[1],y[2],y[3]).solve(ru(o,1,c,d))}return m}static parse(e,o){let[c,d,m,...y]=e;if(!Array.isArray(d)||d.length===0)return o.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const k=d[1];if(typeof k!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:k}}else{if(d[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const k=d.slice(1);if(k.length!==4||k.some(C=>typeof C!="number"||C<0||C>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:k}}}if(e.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(m=o.parse(m,2,Wt),!m)return null;const b=[];let S=null;c==="interpolate-hcl"||c==="interpolate-lab"?S=pn:o.expectedType&&o.expectedType.kind!=="value"&&(S=o.expectedType);for(let k=0;k<y.length;k+=2){const C=y[k],L=y[k+1],B=k+3,O=k+4;if(typeof C!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(b.length&&b[b.length-1][0]>=C)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',B);const N=o.parse(L,O,S);if(!N)return null;S=S||N.type,b.push([C,N])}return At(S,Wt)||At(S,pn)||At(S,z)||At(S,V)||At(S,K(Wt))?new Fn(S,c,d,m,b):o.error(`Type ${J(S)} is not interpolatable.`)}evaluate(e){const o=this.labels,c=this.outputs;if(o.length===1)return c[0].evaluate(e);const d=this.input.evaluate(e);if(d<=o[0])return c[0].evaluate(e);const m=o.length;if(d>=o[m-1])return c[m-1].evaluate(e);const y=ua(o,d),b=Fn.interpolationFactor(this.interpolation,d,o[y],o[y+1]),S=c[y].evaluate(e),k=c[y+1].evaluate(e);switch(this.operator){case"interpolate":return Rn[this.type.kind](S,k,b);case"interpolate-hcl":return Rn.color(S,k,b,"hcl");case"interpolate-lab":return Rn.color(S,k,b,"lab")}}eachChild(e){e(this.input);for(const o of this.outputs)e(o)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function ru(r,e,o,c){const d=c-o,m=r-o;return d===0?0:e===1?m/d:(Math.pow(e,m)-1)/(Math.pow(e,d)-1)}class Nl{constructor(e,o){this.type=e,this.args=o}static parse(e,o){if(e.length<2)return o.error("Expectected at least one argument.");let c=null;const d=o.expectedType;d&&d.kind!=="value"&&(c=d);const m=[];for(const b of e.slice(1)){const S=o.parse(b,1+m.length,c,void 0,{typeAnnotation:"omit"});if(!S)return null;c=c||S.type,m.push(S)}if(!c)throw new Error("No output type");const y=d&&m.some(b=>at(d,b.type));return new Nl(y?He:c,m)}evaluate(e){let o,c=null,d=0;for(const m of this.args)if(d++,c=m.evaluate(e),c&&c instanceof Hr&&!c.available&&(o||(o=c.name),c=null,d===this.args.length&&(c=o)),c!==null)break;return c}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class Ul{constructor(e,o){this.type=o.type,this.bindings=[].concat(e),this.result=o}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const o of this.bindings)e(o[1]);e(this.result)}static parse(e,o){if(e.length<4)return o.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const c=[];for(let m=1;m<e.length-1;m+=2){const y=e[m];if(typeof y!="string")return o.error(`Expected string, but found ${typeof y} instead.`,m);if(/[^a-zA-Z0-9_]/.test(y))return o.error("Variable names must contain only alphanumeric characters or '_'.",m);const b=o.parse(e[m+1],m+1);if(!b)return null;c.push([y,b])}const d=o.parse(e[e.length-1],e.length-1,o.expectedType,c);return d?new Ul(c,d):null}outputDefined(){return this.result.outputDefined()}}class nu{constructor(e,o,c){this.type=e,this.index=o,this.input=c}static parse(e,o){if(e.length!==3)return o.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const c=o.parse(e[1],1,Wt),d=o.parse(e[2],2,K(o.expectedType||He));return c&&d?new nu(d.type.itemType,c,d):null}evaluate(e){const o=this.index.evaluate(e),c=this.input.evaluate(e);if(o<0)throw new ur(`Array index out of bounds: ${o} < 0.`);if(o>=c.length)throw new ur(`Array index out of bounds: ${o} > ${c.length-1}.`);if(o!==Math.floor(o))throw new ur(`Array index must be an integer, but found ${o} instead.`);return c[o]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class su{constructor(e,o){this.type=Re,this.needle=e,this.haystack=o}static parse(e,o){if(e.length!==3)return o.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const c=o.parse(e[1],1,He),d=o.parse(e[2],2,He);return c&&d?rt(c.type,[Re,Je,Wt,Os,He])?new su(c,d):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${J(c.type)} instead`):null}evaluate(e){const o=this.needle.evaluate(e),c=this.haystack.evaluate(e);if(!c)return!1;if(!ht(o,["boolean","string","number","null"]))throw new ur(`Expected first argument to be of type boolean, string, number or null, but found ${J(rr(o))} instead.`);if(!ht(c,["string","array"]))throw new ur(`Expected second argument to be of type array or string, but found ${J(rr(c))} instead.`);return c.indexOf(o)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Vl{constructor(e,o,c){this.type=Wt,this.needle=e,this.haystack=o,this.fromIndex=c}static parse(e,o){if(e.length<=2||e.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const c=o.parse(e[1],1,He),d=o.parse(e[2],2,He);if(!c||!d)return null;if(!rt(c.type,[Re,Je,Wt,Os,He]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${J(c.type)} instead`);if(e.length===4){const m=o.parse(e[3],3,Wt);return m?new Vl(c,d,m):null}return new Vl(c,d)}evaluate(e){const o=this.needle.evaluate(e),c=this.haystack.evaluate(e);if(!ht(o,["boolean","string","number","null"]))throw new ur(`Expected first argument to be of type boolean, string, number or null, but found ${J(rr(o))} instead.`);if(!ht(c,["string","array"]))throw new ur(`Expected second argument to be of type array or string, but found ${J(rr(c))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(e);return c.indexOf(o,d)}return c.indexOf(o)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class ou{constructor(e,o,c,d,m,y){this.inputType=e,this.type=o,this.input=c,this.cases=d,this.outputs=m,this.otherwise=y}static parse(e,o){if(e.length<5)return o.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return o.error("Expected an even number of arguments.");let c,d;o.expectedType&&o.expectedType.kind!=="value"&&(d=o.expectedType);const m={},y=[];for(let k=2;k<e.length-1;k+=2){let C=e[k];const L=e[k+1];Array.isArray(C)||(C=[C]);const B=o.concat(k);if(C.length===0)return B.error("Expected at least one branch label.");for(const N of C){if(typeof N!="number"&&typeof N!="string")return B.error("Branch labels must be numbers or strings.");if(typeof N=="number"&&Math.abs(N)>Number.MAX_SAFE_INTEGER)return B.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof N=="number"&&Math.floor(N)!==N)return B.error("Numeric branch labels must be integer values.");if(c){if(B.checkSubtype(c,rr(N)))return null}else c=rr(N);if(m[String(N)]!==void 0)return B.error("Branch labels must be unique.");m[String(N)]=y.length}const O=o.parse(L,k,d);if(!O)return null;d=d||O.type,y.push(O)}const b=o.parse(e[1],1,He);if(!b)return null;const S=o.parse(e[e.length-1],e.length-1,d);return S?b.type.kind!=="value"&&o.concat(1).checkSubtype(c,b.type)?null:new ou(c,d,b,m,y,S):null}evaluate(e){const o=this.input.evaluate(e);return(rr(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class au{constructor(e,o,c){this.type=e,this.branches=o,this.otherwise=c}static parse(e,o){if(e.length<4)return o.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return o.error("Expected an odd number of arguments.");let c;o.expectedType&&o.expectedType.kind!=="value"&&(c=o.expectedType);const d=[];for(let y=1;y<e.length-1;y+=2){const b=o.parse(e[y],y,Re);if(!b)return null;const S=o.parse(e[y+1],y+1,c);if(!S)return null;d.push([b,S]),c=c||S.type}const m=o.parse(e[e.length-1],e.length-1,c);if(!m)return null;if(!c)throw new Error("Can't infer output type");return new au(c,d,m)}evaluate(e){for(const[o,c]of this.branches)if(o.evaluate(e))return c.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[o,c]of this.branches)e(o),e(c);e(this.otherwise)}outputDefined(){return this.branches.every(([e,o])=>o.outputDefined())&&this.otherwise.outputDefined()}}class $l{constructor(e,o,c,d){this.type=e,this.input=o,this.beginIndex=c,this.endIndex=d}static parse(e,o){if(e.length<=2||e.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const c=o.parse(e[1],1,He),d=o.parse(e[2],2,Wt);if(!c||!d)return null;if(!rt(c.type,[K(He),Je,He]))return o.error(`Expected first argument to be of type array or string, but found ${J(c.type)} instead`);if(e.length===4){const m=o.parse(e[3],3,Wt);return m?new $l(c.type,c,d,m):null}return new $l(c.type,c,d)}evaluate(e){const o=this.input.evaluate(e),c=this.beginIndex.evaluate(e);if(!ht(o,["string","array"]))throw new ur(`Expected first argument to be of type array or string, but found ${J(rr(o))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(e);return o.slice(c,d)}return o.slice(c)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function qh(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Gh(r,e,o,c){return c.compare(e,o)===0}function ha(r,e,o){const c=r!=="=="&&r!=="!=";return class tv{constructor(m,y,b){this.type=Re,this.lhs=m,this.rhs=y,this.collator=b,this.hasUntypedArgument=m.type.kind==="value"||y.type.kind==="value"}static parse(m,y){if(m.length!==3&&m.length!==4)return y.error("Expected two or three arguments.");const b=m[0];let S=y.parse(m[1],1,He);if(!S)return null;if(!qh(b,S.type))return y.concat(1).error(`"${b}" comparisons are not supported for type '${J(S.type)}'.`);let k=y.parse(m[2],2,He);if(!k)return null;if(!qh(b,k.type))return y.concat(2).error(`"${b}" comparisons are not supported for type '${J(k.type)}'.`);if(S.type.kind!==k.type.kind&&S.type.kind!=="value"&&k.type.kind!=="value")return y.error(`Cannot compare types '${J(S.type)}' and '${J(k.type)}'.`);c&&(S.type.kind==="value"&&k.type.kind!=="value"?S=new Jn(k.type,[S]):S.type.kind!=="value"&&k.type.kind==="value"&&(k=new Jn(S.type,[k])));let C=null;if(m.length===4){if(S.type.kind!=="string"&&k.type.kind!=="string"&&S.type.kind!=="value"&&k.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(C=y.parse(m[3],3,Ns),!C)return null}return new tv(S,k,C)}evaluate(m){const y=this.lhs.evaluate(m),b=this.rhs.evaluate(m);if(c&&this.hasUntypedArgument){const S=rr(y),k=rr(b);if(S.kind!==k.kind||S.kind!=="string"&&S.kind!=="number")throw new ur(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${S.kind}, ${k.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const S=rr(y),k=rr(b);if(S.kind!=="string"||k.kind!=="string")return e(m,y,b)}return this.collator?o(m,y,b,this.collator.evaluate(m)):e(m,y,b)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}}}const yf=ha("==",function(r,e,o){return e===o},Gh),_f=ha("!=",function(r,e,o){return e!==o},function(r,e,o,c){return!Gh(0,e,o,c)}),vf=ha("<",function(r,e,o){return e<o},function(r,e,o,c){return c.compare(e,o)<0}),bf=ha(">",function(r,e,o){return e>o},function(r,e,o,c){return c.compare(e,o)>0}),xf=ha("<=",function(r,e,o){return e<=o},function(r,e,o,c){return c.compare(e,o)<=0}),wf=ha(">=",function(r,e,o){return e>=o},function(r,e,o,c){return c.compare(e,o)>=0});class lu{constructor(e,o,c,d,m){this.type=Je,this.number=e,this.locale=o,this.currency=c,this.minFractionDigits=d,this.maxFractionDigits=m}static parse(e,o){if(e.length!==3)return o.error("Expected two arguments.");const c=o.parse(e[1],1,Wt);if(!c)return null;const d=e[2];if(typeof d!="object"||Array.isArray(d))return o.error("NumberFormat options argument must be an object.");let m=null;if(d.locale&&(m=o.parse(d.locale,1,Je),!m))return null;let y=null;if(d.currency&&(y=o.parse(d.currency,1,Je),!y))return null;let b=null;if(d["min-fraction-digits"]&&(b=o.parse(d["min-fraction-digits"],1,Wt),!b))return null;let S=null;return d["max-fraction-digits"]&&(S=o.parse(d["max-fraction-digits"],1,Wt),!S)?null:new lu(c,m,y,b,S)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class jl{constructor(e){this.type=H,this.sections=e}static parse(e,o){if(e.length<2)return o.error("Expected at least one argument.");const c=e[1];if(!Array.isArray(c)&&typeof c=="object")return o.error("First argument must be an image or text section.");const d=[];let m=!1;for(let y=1;y<=e.length-1;++y){const b=e[y];if(m&&typeof b=="object"&&!Array.isArray(b)){m=!1;let S=null;if(b["font-scale"]&&(S=o.parse(b["font-scale"],1,Wt),!S))return null;let k=null;if(b["text-font"]&&(k=o.parse(b["text-font"],1,K(Je)),!k))return null;let C=null;if(b["text-color"]&&(C=o.parse(b["text-color"],1,pn),!C))return null;const L=d[d.length-1];L.scale=S,L.font=k,L.textColor=C}else{const S=o.parse(e[y],1,He);if(!S)return null;const k=S.type.kind;if(k!=="string"&&k!=="value"&&k!=="null"&&k!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,d.push({content:S,scale:null,font:null,textColor:null})}}return new jl(d)}evaluate(e){return new on(this.sections.map(o=>{const c=o.content.evaluate(e);return rr(c)===R?new El("",c,null,null,null):new El(wi(c),null,o.scale?o.scale.evaluate(e):null,o.font?o.font.evaluate(e).join(","):null,o.textColor?o.textColor.evaluate(e):null)}))}eachChild(e){for(const o of this.sections)e(o.content),o.scale&&e(o.scale),o.font&&e(o.font),o.textColor&&e(o.textColor)}outputDefined(){return!1}}class cu{constructor(e){this.type=R,this.input=e}static parse(e,o){if(e.length!==2)return o.error("Expected two arguments.");const c=o.parse(e[1],1,Je);return c?new cu(c):o.error("No image name provided.")}evaluate(e){const o=this.input.evaluate(e),c=Hr.fromString(o);return c&&e.availableImages&&(c.available=e.availableImages.indexOf(o)>-1),c}eachChild(e){e(this.input)}outputDefined(){return!1}}class uu{constructor(e){this.type=Wt,this.input=e}static parse(e,o){if(e.length!==2)return o.error(`Expected 1 argument, but found ${e.length-1} instead.`);const c=o.parse(e[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${J(c.type)} instead.`):new uu(c):null}evaluate(e){const o=this.input.evaluate(e);if(typeof o=="string"||Array.isArray(o))return o.length;throw new ur(`Expected value to be of type string or array, but found ${J(rr(o))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const da={"==":yf,"!=":_f,">":bf,"<":vf,">=":wf,"<=":xf,array:Jn,at:nu,boolean:Jn,case:au,coalesce:Nl,collator:Pl,format:jl,image:cu,in:su,"index-of":Vl,interpolate:Fn,"interpolate-hcl":Fn,"interpolate-lab":Fn,length:uu,let:Ul,literal:Po,match:ou,number:Jn,"number-format":lu,object:Jn,slice:$l,step:ao,string:Jn,"to-boolean":so,"to-color":so,"to-number":so,"to-string":so,var:zl,within:Lo};function Zh(r,[e,o,c,d]){e=e.evaluate(r),o=o.evaluate(r),c=c.evaluate(r);const m=d?d.evaluate(r):1,y=Cl(e,o,c,m);if(y)throw new ur(y);return new Di(e/255,o/255,c/255,m,!1)}function Wh(r,e){return r in e}function hu(r,e){const o=e[r];return o===void 0?null:o}function zo(r){return{type:r}}function Hh(r){return{result:"success",value:r}}function lo(r){return{result:"error",value:r}}function pa(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function Yh(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function du(r){return!!r.expression&&r.expression.interpolated}function Si(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function nr(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function Sf(r){return r}function hi(r,e){const o=e.type==="color",c=r.stops&&typeof r.stops[0][0]=="object",d=c||!(c||r.property!==void 0),m=r.type||(du(e)?"exponential":"interval");if(o||e.type==="padding"){const C=o?Di.parse:Bn.parse;(r=vs({},r)).stops&&(r.stops=r.stops.map(L=>[L[0],C(L[1])])),r.default=C(r.default?r.default:e.default)}if(r.colorSpace&&(y=r.colorSpace)!=="rgb"&&y!=="hcl"&&y!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var y;let b,S,k;if(m==="exponential")b=Ya;else if(m==="interval")b=Qi;else if(m==="categorical"){b=sr,S=Object.create(null);for(const C of r.stops)S[C[0]]=C[1];k=typeof r.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);b=Kh}if(c){const C={},L=[];for(let N=0;N<r.stops.length;N++){const q=r.stops[N],X=q[0].zoom;C[X]===void 0&&(C[X]={zoom:X,type:r.type,property:r.property,default:r.default,stops:[]},L.push(X)),C[X].stops.push([q[0].value,q[1]])}const B=[];for(const N of L)B.push([C[N].zoom,hi(C[N],e)]);const O={name:"linear"};return{kind:"composite",interpolationType:O,interpolationFactor:Fn.interpolationFactor.bind(void 0,O),zoomStops:B.map(N=>N[0]),evaluate:({zoom:N},q)=>Ya({stops:B,base:r.base},e,N).evaluate(N,q)}}if(d){const C=m==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:Fn.interpolationFactor.bind(void 0,C),zoomStops:r.stops.map(L=>L[0]),evaluate:({zoom:L})=>b(r,e,L,S,k)}}return{kind:"source",evaluate(C,L){const B=L&&L.properties?L.properties[r.property]:void 0;return B===void 0?Bo(r.default,e.default):b(r,e,B,S,k)}}}function Bo(r,e,o){return r!==void 0?r:e!==void 0?e:o!==void 0?o:void 0}function sr(r,e,o,c,d){return Bo(typeof o===d?c[o]:void 0,r.default,e.default)}function Qi(r,e,o){if(Si(o)!=="number")return Bo(r.default,e.default);const c=r.stops.length;if(c===1||o<=r.stops[0][0])return r.stops[0][1];if(o>=r.stops[c-1][0])return r.stops[c-1][1];const d=ua(r.stops.map(m=>m[0]),o);return r.stops[d][1]}function Ya(r,e,o){const c=r.base!==void 0?r.base:1;if(Si(o)!=="number")return Bo(r.default,e.default);const d=r.stops.length;if(d===1||o<=r.stops[0][0])return r.stops[0][1];if(o>=r.stops[d-1][0])return r.stops[d-1][1];const m=ua(r.stops.map(C=>C[0]),o),y=function(C,L,B,O){const N=O-B,q=C-B;return N===0?0:L===1?q/N:(Math.pow(L,q)-1)/(Math.pow(L,N)-1)}(o,c,r.stops[m][0],r.stops[m+1][0]),b=r.stops[m][1],S=r.stops[m+1][1],k=Rn[e.type]||Sf;return typeof b.evaluate=="function"?{evaluate(...C){const L=b.evaluate.apply(void 0,C),B=S.evaluate.apply(void 0,C);if(L!==void 0&&B!==void 0)return k(L,B,y,r.colorSpace)}}:k(b,S,y,r.colorSpace)}function Kh(r,e,o){switch(e.type){case"color":o=Di.parse(o);break;case"formatted":o=on.fromString(o.toString());break;case"resolvedImage":o=Hr.fromString(o.toString());break;case"padding":o=Bn.parse(o);break;default:Si(o)===e.type||e.type==="enum"&&e.values[o]||(o=void 0)}return Bo(o,r.default,e.default)}Qn.register(da,{error:[{kind:"error"},[Je],(r,[e])=>{throw new ur(e.evaluate(r))}],typeof:[Je,[He],(r,[e])=>J(rr(e.evaluate(r)))],"to-rgba":[K(Wt,4),[pn],(r,[e])=>{const[o,c,d,m]=e.evaluate(r).rgb;return[255*o,255*c,255*d,m]}],rgb:[pn,[Wt,Wt,Wt],Zh],rgba:[pn,[Wt,Wt,Wt,Wt],Zh],has:{type:Re,overloads:[[[Je],(r,[e])=>Wh(e.evaluate(r),r.properties())],[[Je,bs],(r,[e,o])=>Wh(e.evaluate(r),o.evaluate(r))]]},get:{type:He,overloads:[[[Je],(r,[e])=>hu(e.evaluate(r),r.properties())],[[Je,bs],(r,[e,o])=>hu(e.evaluate(r),o.evaluate(r))]]},"feature-state":[He,[Je],(r,[e])=>hu(e.evaluate(r),r.featureState||{})],properties:[bs,[],r=>r.properties()],"geometry-type":[Je,[],r=>r.geometryType()],id:[He,[],r=>r.id()],zoom:[Wt,[],r=>r.globals.zoom],"heatmap-density":[Wt,[],r=>r.globals.heatmapDensity||0],"line-progress":[Wt,[],r=>r.globals.lineProgress||0],accumulated:[He,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[Wt,zo(Wt),(r,e)=>{let o=0;for(const c of e)o+=c.evaluate(r);return o}],"*":[Wt,zo(Wt),(r,e)=>{let o=1;for(const c of e)o*=c.evaluate(r);return o}],"-":{type:Wt,overloads:[[[Wt,Wt],(r,[e,o])=>e.evaluate(r)-o.evaluate(r)],[[Wt],(r,[e])=>-e.evaluate(r)]]},"/":[Wt,[Wt,Wt],(r,[e,o])=>e.evaluate(r)/o.evaluate(r)],"%":[Wt,[Wt,Wt],(r,[e,o])=>e.evaluate(r)%o.evaluate(r)],ln2:[Wt,[],()=>Math.LN2],pi:[Wt,[],()=>Math.PI],e:[Wt,[],()=>Math.E],"^":[Wt,[Wt,Wt],(r,[e,o])=>Math.pow(e.evaluate(r),o.evaluate(r))],sqrt:[Wt,[Wt],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[Wt,[Wt],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[Wt,[Wt],(r,[e])=>Math.log(e.evaluate(r))],log2:[Wt,[Wt],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[Wt,[Wt],(r,[e])=>Math.sin(e.evaluate(r))],cos:[Wt,[Wt],(r,[e])=>Math.cos(e.evaluate(r))],tan:[Wt,[Wt],(r,[e])=>Math.tan(e.evaluate(r))],asin:[Wt,[Wt],(r,[e])=>Math.asin(e.evaluate(r))],acos:[Wt,[Wt],(r,[e])=>Math.acos(e.evaluate(r))],atan:[Wt,[Wt],(r,[e])=>Math.atan(e.evaluate(r))],min:[Wt,zo(Wt),(r,e)=>Math.min(...e.map(o=>o.evaluate(r)))],max:[Wt,zo(Wt),(r,e)=>Math.max(...e.map(o=>o.evaluate(r)))],abs:[Wt,[Wt],(r,[e])=>Math.abs(e.evaluate(r))],round:[Wt,[Wt],(r,[e])=>{const o=e.evaluate(r);return o<0?-Math.round(-o):Math.round(o)}],floor:[Wt,[Wt],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[Wt,[Wt],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[Re,[Je,He],(r,[e,o])=>r.properties()[e.value]===o.value],"filter-id-==":[Re,[He],(r,[e])=>r.id()===e.value],"filter-type-==":[Re,[Je],(r,[e])=>r.geometryType()===e.value],"filter-<":[Re,[Je,He],(r,[e,o])=>{const c=r.properties()[e.value],d=o.value;return typeof c==typeof d&&c<d}],"filter-id-<":[Re,[He],(r,[e])=>{const o=r.id(),c=e.value;return typeof o==typeof c&&o<c}],"filter->":[Re,[Je,He],(r,[e,o])=>{const c=r.properties()[e.value],d=o.value;return typeof c==typeof d&&c>d}],"filter-id->":[Re,[He],(r,[e])=>{const o=r.id(),c=e.value;return typeof o==typeof c&&o>c}],"filter-<=":[Re,[Je,He],(r,[e,o])=>{const c=r.properties()[e.value],d=o.value;return typeof c==typeof d&&c<=d}],"filter-id-<=":[Re,[He],(r,[e])=>{const o=r.id(),c=e.value;return typeof o==typeof c&&o<=c}],"filter->=":[Re,[Je,He],(r,[e,o])=>{const c=r.properties()[e.value],d=o.value;return typeof c==typeof d&&c>=d}],"filter-id->=":[Re,[He],(r,[e])=>{const o=r.id(),c=e.value;return typeof o==typeof c&&o>=c}],"filter-has":[Re,[He],(r,[e])=>e.value in r.properties()],"filter-has-id":[Re,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[Re,[K(Je)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[Re,[K(He)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[Re,[Je,K(He)],(r,[e,o])=>o.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[Re,[Je,K(He)],(r,[e,o])=>function(c,d,m,y){for(;m<=y;){const b=m+y>>1;if(d[b]===c)return!0;d[b]>c?y=b-1:m=b+1}return!1}(r.properties()[e.value],o.value,0,o.value.length-1)],all:{type:Re,overloads:[[[Re,Re],(r,[e,o])=>e.evaluate(r)&&o.evaluate(r)],[zo(Re),(r,e)=>{for(const o of e)if(!o.evaluate(r))return!1;return!0}]]},any:{type:Re,overloads:[[[Re,Re],(r,[e,o])=>e.evaluate(r)||o.evaluate(r)],[zo(Re),(r,e)=>{for(const o of e)if(o.evaluate(r))return!0;return!1}]]},"!":[Re,[Re],(r,[e])=>!e.evaluate(r)],"is-supported-script":[Re,[Je],(r,[e])=>{const o=r.globals&&r.globals.isSupportedScript;return!o||o(e.evaluate(r))}],upcase:[Je,[Je],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[Je,[Je],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[Je,zo(He),(r,e)=>e.map(o=>wi(o.evaluate(r))).join("")],"resolved-locale":[Je,[Ns],(r,[e])=>e.evaluate(r).resolvedLocale()]});class pu{constructor(e,o){var c;this.expression=e,this._warningHistory={},this._evaluator=new Xc,this._defaultValue=o?(c=o).type==="color"&&nr(c.default)?new Di(0,0,0,0):c.type==="color"?Di.parse(c.default)||null:c.type==="padding"?Bn.parse(c.default)||null:c.type==="variableAnchorOffsetCollection"?Xn.parse(c.default)||null:c.default===void 0?null:c.default:null,this._enumValues=o&&o.type==="enum"?o.values:null}evaluateWithoutErrorHandling(e,o,c,d,m,y){return this._evaluator.globals=e,this._evaluator.feature=o,this._evaluator.featureState=c,this._evaluator.canonical=d,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)}evaluate(e,o,c,d,m,y){this._evaluator.globals=e,this._evaluator.feature=o||null,this._evaluator.featureState=c||null,this._evaluator.canonical=d,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=y||null;try{const b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new ur(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function ql(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in da}function Gl(r,e){const o=new Dl(da,Bl,[],e?function(d){const m={color:pn,string:Je,number:Wt,enum:Je,boolean:Re,formatted:H,padding:z,resolvedImage:R,variableAnchorOffsetCollection:V};return d.type==="array"?K(m[d.value]||He,d.length):m[d.type]}(e):void 0),c=o.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?Hh(new pu(c,e)):lo(o.errors)}class fu{constructor(e,o){this.kind=e,this._styleExpression=o,this.isStateDependent=e!=="constant"&&!Ha(o.expression)}evaluateWithoutErrorHandling(e,o,c,d,m,y){return this._styleExpression.evaluateWithoutErrorHandling(e,o,c,d,m,y)}evaluate(e,o,c,d,m,y){return this._styleExpression.evaluate(e,o,c,d,m,y)}}class Zl{constructor(e,o,c,d){this.kind=e,this.zoomStops=c,this._styleExpression=o,this.isStateDependent=e!=="camera"&&!Ha(o.expression),this.interpolationType=d}evaluateWithoutErrorHandling(e,o,c,d,m,y){return this._styleExpression.evaluateWithoutErrorHandling(e,o,c,d,m,y)}evaluate(e,o,c,d,m,y){return this._styleExpression.evaluate(e,o,c,d,m,y)}interpolationFactor(e,o,c){return this.interpolationType?Fn.interpolationFactor(this.interpolationType,e,o,c):0}}function mu(r,e){const o=Gl(r,e);if(o.result==="error")return o;const c=o.value.expression,d=Rl(c);if(!d&&!pa(e))return lo([new cr("","data expressions not supported")]);const m=Fl(c,["zoom"]);if(!m&&!Yh(e))return lo([new cr("","zoom expressions not supported")]);const y=Xa(c);return y||m?y instanceof cr?lo([y]):y instanceof Fn&&!du(e)?lo([new cr("",'"interpolate" expressions cannot be used with this property')]):Hh(y?new Zl(d?"camera":"composite",o.value,y.labels,y instanceof Fn?y.interpolation:void 0):new fu(d?"constant":"source",o.value)):lo([new cr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ka{constructor(e,o){this._parameters=e,this._specification=o,vs(this,hi(this._parameters,this._specification))}static deserialize(e){return new Ka(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Xa(r){let e=null;if(r instanceof Ul)e=Xa(r.result);else if(r instanceof Nl){for(const o of r.args)if(e=Xa(o),e)break}else(r instanceof ao||r instanceof Fn)&&r.input instanceof Qn&&r.input.name==="zoom"&&(e=r);return e instanceof cr||r.eachChild(o=>{const c=Xa(o);c instanceof cr?e=c:!e&&c?e=new cr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&c&&e!==c&&(e=new cr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Ja(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!Ja(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const If={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function gu(r){if(r==null)return{filter:()=>!0,needGeometry:!1};Ja(r)||(r=Wl(r));const e=Gl(r,If);if(e.result==="error")throw new Error(e.value.map(o=>`${o.key}: ${o.message}`).join(", "));return{filter:(o,c,d)=>e.value.evaluate(o,c,{},d),needGeometry:Xh(r)}}function Tf(r,e){return r<e?-1:r>e?1:0}function Xh(r){if(!Array.isArray(r))return!1;if(r[0]==="within")return!0;for(let e=1;e<r.length;e++)if(Xh(r[e]))return!0;return!1}function Wl(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?yu(r[1],r[2],"=="):e==="!="?Qa(yu(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?yu(r[1],r[2],e):e==="any"?(o=r.slice(1),["any"].concat(o.map(Wl))):e==="all"?["all"].concat(r.slice(1).map(Wl)):e==="none"?["all"].concat(r.slice(1).map(Wl).map(Qa)):e==="in"?Jh(r[1],r.slice(2)):e==="!in"?Qa(Jh(r[1],r.slice(2))):e==="has"?Qh(r[1]):e==="!has"?Qa(Qh(r[1])):e!=="within"||r;var o}function yu(r,e,o){switch(r){case"$type":return[`filter-type-${o}`,e];case"$id":return[`filter-id-${o}`,e];default:return[`filter-${o}`,r,e]}}function Jh(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(o=>typeof o!=typeof e[0])?["filter-in-large",r,["literal",e.sort(Tf)]]:["filter-in-small",r,["literal",e]]}}function Qh(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function Qa(r){return["!",r]}function Hl(r){const e=typeof r;if(e==="number"||e==="boolean"||e==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let d="[";for(const m of r)d+=`${Hl(m)},`;return`${d}]`}const o=Object.keys(r).sort();let c="{";for(let d=0;d<o.length;d++)c+=`${JSON.stringify(o[d])}:${Hl(r[o[d]])},`;return`${c}}`}function Yl(r){let e="";for(const o of Ar)e+=`/${Hl(r[o])}`;return e}function td(r){const e=r.value;return e?[new Gt(r.key,e,"constants have been deprecated as of v8")]:[]}function hr(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Ro(r){if(Array.isArray(r))return r.map(Ro);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const o in r)e[o]=Ro(r[o]);return e}return hr(r)}function In(r){const e=r.key,o=r.value,c=r.valueSpec||{},d=r.objectElementValidators||{},m=r.style,y=r.styleSpec,b=r.validateSpec;let S=[];const k=Si(o);if(k!=="object")return[new Gt(e,o,`object expected, ${k} found`)];for(const C in o){const L=C.split(".")[0],B=c[L]||c["*"];let O;if(d[L])O=d[L];else if(c[L])O=b;else if(d["*"])O=d["*"];else{if(!c["*"]){S.push(new Gt(e,o[C],`unknown property "${C}"`));continue}O=b}S=S.concat(O({key:(e&&`${e}.`)+C,value:o[C],valueSpec:B,style:m,styleSpec:y,object:o,objectKey:C,validateSpec:b},o))}for(const C in c)d[C]||c[C].required&&c[C].default===void 0&&o[C]===void 0&&S.push(new Gt(e,o,`missing required property "${C}"`));return S}function fa(r){const e=r.value,o=r.valueSpec,c=r.style,d=r.styleSpec,m=r.key,y=r.arrayElementValidator||r.validateSpec;if(Si(e)!=="array")return[new Gt(m,e,`array expected, ${Si(e)} found`)];if(o.length&&e.length!==o.length)return[new Gt(m,e,`array length ${o.length} expected, length ${e.length} found`)];if(o["min-length"]&&e.length<o["min-length"])return[new Gt(m,e,`array length at least ${o["min-length"]} expected, length ${e.length} found`)];let b={type:o.value,values:o.values};d.$version<7&&(b.function=o.function),Si(o.value)==="object"&&(b=o.value);let S=[];for(let k=0;k<e.length;k++)S=S.concat(y({array:e,arrayIndex:k,value:e[k],valueSpec:b,validateSpec:r.validateSpec,style:c,styleSpec:d,key:`${m}[${k}]`}));return S}function tl(r){const e=r.key,o=r.value,c=r.valueSpec;let d=Si(o);return d==="number"&&o!=o&&(d="NaN"),d!=="number"?[new Gt(e,o,`number expected, ${d} found`)]:"minimum"in c&&o<c.minimum?[new Gt(e,o,`${o} is less than the minimum value ${c.minimum}`)]:"maximum"in c&&o>c.maximum?[new Gt(e,o,`${o} is greater than the maximum value ${c.maximum}`)]:[]}function Kl(r){const e=r.valueSpec,o=hr(r.value.type);let c,d,m,y={};const b=o!=="categorical"&&r.value.property===void 0,S=!b,k=Si(r.value.stops)==="array"&&Si(r.value.stops[0])==="array"&&Si(r.value.stops[0][0])==="object",C=In({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(O){if(o==="identity")return[new Gt(O.key,O.value,'identity function may not have a "stops" property')];let N=[];const q=O.value;return N=N.concat(fa({key:O.key,value:q,valueSpec:O.valueSpec,validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:L})),Si(q)==="array"&&q.length===0&&N.push(new Gt(O.key,q,"array must have at least one stop")),N},default:function(O){return O.validateSpec({key:O.key,value:O.value,valueSpec:e,validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec})}}});return o==="identity"&&b&&C.push(new Gt(r.key,r.value,'missing required property "property"')),o==="identity"||r.value.stops||C.push(new Gt(r.key,r.value,'missing required property "stops"')),o==="exponential"&&r.valueSpec.expression&&!du(r.valueSpec)&&C.push(new Gt(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(S&&!pa(r.valueSpec)?C.push(new Gt(r.key,r.value,"property functions not supported")):b&&!Yh(r.valueSpec)&&C.push(new Gt(r.key,r.value,"zoom functions not supported"))),o!=="categorical"&&!k||r.value.property!==void 0||C.push(new Gt(r.key,r.value,'"property" property is required')),C;function L(O){let N=[];const q=O.value,X=O.key;if(Si(q)!=="array")return[new Gt(X,q,`array expected, ${Si(q)} found`)];if(q.length!==2)return[new Gt(X,q,`array length 2 expected, length ${q.length} found`)];if(k){if(Si(q[0])!=="object")return[new Gt(X,q,`object expected, ${Si(q[0])} found`)];if(q[0].zoom===void 0)return[new Gt(X,q,"object stop key must have zoom")];if(q[0].value===void 0)return[new Gt(X,q,"object stop key must have value")];if(m&&m>hr(q[0].zoom))return[new Gt(X,q[0].zoom,"stop zoom values must appear in ascending order")];hr(q[0].zoom)!==m&&(m=hr(q[0].zoom),d=void 0,y={}),N=N.concat(In({key:`${X}[0]`,value:q[0],valueSpec:{zoom:{}},validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec,objectElementValidators:{zoom:tl,value:B}}))}else N=N.concat(B({key:`${X}[0]`,value:q[0],valueSpec:{},validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec},q));return ql(Ro(q[1]))?N.concat([new Gt(`${X}[1]`,q[1],"expressions are not allowed in function stops.")]):N.concat(O.validateSpec({key:`${X}[1]`,value:q[1],valueSpec:e,validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec}))}function B(O,N){const q=Si(O.value),X=hr(O.value),et=O.value!==null?O.value:N;if(c){if(q!==c)return[new Gt(O.key,et,`${q} stop domain type must match previous stop domain type ${c}`)]}else c=q;if(q!=="number"&&q!=="string"&&q!=="boolean")return[new Gt(O.key,et,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&o!=="categorical"){let dt=`number expected, ${q} found`;return pa(e)&&o===void 0&&(dt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Gt(O.key,et,dt)]}return o!=="categorical"||q!=="number"||isFinite(X)&&Math.floor(X)===X?o!=="categorical"&&q==="number"&&d!==void 0&&X<d?[new Gt(O.key,et,"stop domain values must appear in ascending order")]:(d=X,o==="categorical"&&X in y?[new Gt(O.key,et,"stop domain values must be unique")]:(y[X]=!0,[])):[new Gt(O.key,et,`integer expected, found ${X}`)]}}function Fo(r){const e=(r.expressionContext==="property"?mu:Gl)(Ro(r.value),r.valueSpec);if(e.result==="error")return e.value.map(c=>new Gt(`${r.key}${c.key}`,r.value,c.message));const o=e.value.expression||e.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!o.outputDefined())return[new Gt(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!Ha(o))return[new Gt(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!Ha(o))return[new Gt(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!Fl(o,["zoom","feature-state"]))return[new Gt(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!Rl(o))return[new Gt(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function el(r){const e=r.key,o=r.value,c=r.valueSpec,d=[];return Array.isArray(c.values)?c.values.indexOf(hr(o))===-1&&d.push(new Gt(e,o,`expected one of [${c.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(c.values).indexOf(hr(o))===-1&&d.push(new Gt(e,o,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(o)} found`)),d}function ma(r){return Ja(Ro(r.value))?Fo(vs({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ed(r)}function ed(r){const e=r.value,o=r.key;if(Si(e)!=="array")return[new Gt(o,e,`array expected, ${Si(e)} found`)];const c=r.styleSpec;let d,m=[];if(e.length<1)return[new Gt(o,e,"filter array must have at least 1 element")];switch(m=m.concat(el({key:`${o}[0]`,value:e[0],valueSpec:c.filter_operator,style:r.style,styleSpec:r.styleSpec})),hr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&hr(e[1])==="$type"&&m.push(new Gt(o,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&m.push(new Gt(o,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(d=Si(e[1]),d!=="string"&&m.push(new Gt(`${o}[1]`,e[1],`string expected, ${d} found`)));for(let y=2;y<e.length;y++)d=Si(e[y]),hr(e[1])==="$type"?m=m.concat(el({key:`${o}[${y}]`,value:e[y],valueSpec:c.geometry_type,style:r.style,styleSpec:r.styleSpec})):d!=="string"&&d!=="number"&&d!=="boolean"&&m.push(new Gt(`${o}[${y}]`,e[y],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let y=1;y<e.length;y++)m=m.concat(ed({key:`${o}[${y}]`,value:e[y],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":d=Si(e[1]),e.length!==2?m.push(new Gt(o,e,`filter array for "${e[0]}" operator must have 2 elements`)):d!=="string"&&m.push(new Gt(`${o}[1]`,e[1],`string expected, ${d} found`));break;case"within":d=Si(e[1]),e.length!==2?m.push(new Gt(o,e,`filter array for "${e[0]}" operator must have 2 elements`)):d!=="object"&&m.push(new Gt(`${o}[1]`,e[1],`object expected, ${d} found`))}return m}function id(r,e){const o=r.key,c=r.validateSpec,d=r.style,m=r.styleSpec,y=r.value,b=r.objectKey,S=m[`${e}_${r.layerType}`];if(!S)return[];const k=b.match(/^(.*)-transition$/);if(e==="paint"&&k&&S[k[1]]&&S[k[1]].transition)return c({key:o,value:y,valueSpec:m.transition,style:d,styleSpec:m});const C=r.valueSpec||S[b];if(!C)return[new Gt(o,y,`unknown property "${b}"`)];let L;if(Si(y)==="string"&&pa(C)&&!C.tokens&&(L=/^{([^}]+)}$/.exec(y)))return[new Gt(o,y,`"${b}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(L[1])} }\`.`)];const B=[];return r.layerType==="symbol"&&(b==="text-field"&&d&&!d.glyphs&&B.push(new Gt(o,y,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&nr(Ro(y))&&hr(y.type)==="identity"&&B.push(new Gt(o,y,'"text-font" does not support identity functions'))),B.concat(c({key:r.key,value:y,valueSpec:C,style:d,styleSpec:m,expressionContext:"property",propertyType:e,propertyKey:b}))}function rd(r){return id(r,"paint")}function nd(r){return id(r,"layout")}function sd(r){let e=[];const o=r.value,c=r.key,d=r.style,m=r.styleSpec;o.type||o.ref||e.push(new Gt(c,o,'either "type" or "ref" is required'));let y=hr(o.type);const b=hr(o.ref);if(o.id){const S=hr(o.id);for(let k=0;k<r.arrayIndex;k++){const C=d.layers[k];hr(C.id)===S&&e.push(new Gt(c,o.id,`duplicate layer id "${o.id}", previously used at line ${C.id.__line__}`))}}if("ref"in o){let S;["type","source","source-layer","filter","layout"].forEach(k=>{k in o&&e.push(new Gt(c,o[k],`"${k}" is prohibited for ref layers`))}),d.layers.forEach(k=>{hr(k.id)===b&&(S=k)}),S?S.ref?e.push(new Gt(c,o.ref,"ref cannot reference another ref layer")):y=hr(S.type):e.push(new Gt(c,o.ref,`ref layer "${b}" not found`))}else if(y!=="background")if(o.source){const S=d.sources&&d.sources[o.source],k=S&&hr(S.type);S?k==="vector"&&y==="raster"?e.push(new Gt(c,o.source,`layer "${o.id}" requires a raster source`)):k!=="raster-dem"&&y==="hillshade"?e.push(new Gt(c,o.source,`layer "${o.id}" requires a raster-dem source`)):k==="raster"&&y!=="raster"?e.push(new Gt(c,o.source,`layer "${o.id}" requires a vector source`)):k!=="vector"||o["source-layer"]?k==="raster-dem"&&y!=="hillshade"?e.push(new Gt(c,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):y!=="line"||!o.paint||!o.paint["line-gradient"]||k==="geojson"&&S.lineMetrics||e.push(new Gt(c,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Gt(c,o,`layer "${o.id}" must specify a "source-layer"`)):e.push(new Gt(c,o.source,`source "${o.source}" not found`))}else e.push(new Gt(c,o,'missing required property "source"'));return e=e.concat(In({key:c,value:o,valueSpec:m.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${c}.type`,value:o.type,valueSpec:m.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:o,objectKey:"type"}),filter:ma,layout:S=>In({layer:o,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":k=>nd(vs({layerType:y},k))}}),paint:S=>In({layer:o,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":k=>rd(vs({layerType:y},k))}})}})),e}function xs(r){const e=r.value,o=r.key,c=Si(e);return c!=="string"?[new Gt(o,e,`string expected, ${c} found`)]:[]}const il={promoteId:function({key:r,value:e}){if(Si(e)==="string")return xs({key:r,value:e});{const o=[];for(const c in e)o.push(...xs({key:`${r}.${c}`,value:e[c]}));return o}}};function On(r){const e=r.value,o=r.key,c=r.styleSpec,d=r.style,m=r.validateSpec;if(!e.type)return[new Gt(o,e,'"type" is required')];const y=hr(e.type);let b;switch(y){case"vector":case"raster":return b=In({key:o,value:e,valueSpec:c[`source_${y.replace("-","_")}`],style:r.style,styleSpec:c,objectElementValidators:il,validateSpec:m}),b;case"raster-dem":return b=function(S){var k;const C=(k=S.sourceName)!==null&&k!==void 0?k:"",L=S.value,B=S.styleSpec,O=B.source_raster_dem,N=S.style;let q=[];const X=Si(L);if(L===void 0)return q;if(X!=="object")return q.push(new Gt("source_raster_dem",L,`object expected, ${X} found`)),q;const et=hr(L.encoding)==="custom",dt=["redFactor","greenFactor","blueFactor","baseShift"],ot=S.value.encoding?`"${S.value.encoding}"`:"Default";for(const mt in L)!et&&dt.includes(mt)?q.push(new Gt(mt,L[mt],`In "${C}": "${mt}" is only valid when "encoding" is set to "custom". ${ot} encoding found`)):O[mt]?q=q.concat(S.validateSpec({key:mt,value:L[mt],valueSpec:O[mt],validateSpec:S.validateSpec,style:N,styleSpec:B})):q.push(new Gt(mt,L[mt],`unknown property "${mt}"`));return q}({sourceName:o,value:e,style:r.style,styleSpec:c,validateSpec:m}),b;case"geojson":if(b=In({key:o,value:e,valueSpec:c.source_geojson,style:d,styleSpec:c,validateSpec:m,objectElementValidators:il}),e.cluster)for(const S in e.clusterProperties){const[k,C]=e.clusterProperties[S],L=typeof k=="string"?[k,["accumulated"],["get",S]]:k;b.push(...Fo({key:`${o}.${S}.map`,value:C,validateSpec:m,expressionContext:"cluster-map"})),b.push(...Fo({key:`${o}.${S}.reduce`,value:L,validateSpec:m,expressionContext:"cluster-reduce"}))}return b;case"video":return In({key:o,value:e,valueSpec:c.source_video,style:d,validateSpec:m,styleSpec:c});case"image":return In({key:o,value:e,valueSpec:c.source_image,style:d,validateSpec:m,styleSpec:c});case"canvas":return[new Gt(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return el({key:`${o}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:d,validateSpec:m,styleSpec:c})}}function rl(r){const e=r.value,o=r.styleSpec,c=o.light,d=r.style;let m=[];const y=Si(e);if(e===void 0)return m;if(y!=="object")return m=m.concat([new Gt("light",e,`object expected, ${y} found`)]),m;for(const b in e){const S=b.match(/^(.*)-transition$/);m=m.concat(S&&c[S[1]]&&c[S[1]].transition?r.validateSpec({key:b,value:e[b],valueSpec:o.transition,validateSpec:r.validateSpec,style:d,styleSpec:o}):c[b]?r.validateSpec({key:b,value:e[b],valueSpec:c[b],validateSpec:r.validateSpec,style:d,styleSpec:o}):[new Gt(b,e[b],`unknown property "${b}"`)])}return m}function od(r){const e=r.value,o=r.styleSpec,c=o.terrain,d=r.style;let m=[];const y=Si(e);if(e===void 0)return m;if(y!=="object")return m=m.concat([new Gt("terrain",e,`object expected, ${y} found`)]),m;for(const b in e)m=m.concat(c[b]?r.validateSpec({key:b,value:e[b],valueSpec:c[b],validateSpec:r.validateSpec,style:d,styleSpec:o}):[new Gt(b,e[b],`unknown property "${b}"`)]);return m}function ad(r){let e=[];const o=r.value,c=r.key;if(Array.isArray(o)){const d=[],m=[];for(const y in o)o[y].id&&d.includes(o[y].id)&&e.push(new Gt(c,o,`all the sprites' ids must be unique, but ${o[y].id} is duplicated`)),d.push(o[y].id),o[y].url&&m.includes(o[y].url)&&e.push(new Gt(c,o,`all the sprites' URLs must be unique, but ${o[y].url} is duplicated`)),m.push(o[y].url),e=e.concat(In({key:`${c}[${y}]`,value:o[y],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return e}return xs({key:c,value:o})}const ld={"*":()=>[],array:fa,boolean:function(r){const e=r.value,o=r.key,c=Si(e);return c!=="boolean"?[new Gt(o,e,`boolean expected, ${c} found`)]:[]},number:tl,color:function(r){const e=r.key,o=r.value,c=Si(o);return c!=="string"?[new Gt(e,o,`color expected, ${c} found`)]:Di.parse(String(o))?[]:[new Gt(e,o,`color expected, "${o}" found`)]},constants:td,enum:el,filter:ma,function:Kl,layer:sd,object:In,source:On,light:rl,terrain:od,string:xs,formatted:function(r){return xs(r).length===0?[]:Fo(r)},resolvedImage:function(r){return xs(r).length===0?[]:Fo(r)},padding:function(r){const e=r.key,o=r.value;if(Si(o)==="array"){if(o.length<1||o.length>4)return[new Gt(e,o,`padding requires 1 to 4 values; ${o.length} values found`)];const c={type:"number"};let d=[];for(let m=0;m<o.length;m++)d=d.concat(r.validateSpec({key:`${e}[${m}]`,value:o[m],validateSpec:r.validateSpec,valueSpec:c}));return d}return tl({key:e,value:o,valueSpec:{}})},variableAnchorOffsetCollection:function(r){const e=r.key,o=r.value,c=Si(o),d=r.styleSpec;if(c!=="array"||o.length<1||o.length%2!=0)return[new Gt(e,o,"variableAnchorOffsetCollection requires a non-empty array of even length")];let m=[];for(let y=0;y<o.length;y+=2)m=m.concat(el({key:`${e}[${y}]`,value:o[y],valueSpec:d.layout_symbol["text-anchor"]})),m=m.concat(fa({key:`${e}[${y+1}]`,value:o[y+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:d}));return m},sprite:ad};function Us(r){const e=r.value,o=r.valueSpec,c=r.styleSpec;return r.validateSpec=Us,o.expression&&nr(hr(e))?Kl(r):o.expression&&ql(Ro(e))?Fo(r):o.type&&ld[o.type]?ld[o.type](r):In(vs({},r,{valueSpec:o.type?c[o.type]:o}))}function cd(r){const e=r.value,o=r.key,c=xs(r);return c.length||(e.indexOf("{fontstack}")===-1&&c.push(new Gt(o,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&c.push(new Gt(o,e,'"glyphs" url must include a "{range}" token'))),c}function ts(r,e=Tt){let o=[];return o=o.concat(Us({key:"",value:r,valueSpec:e.$root,styleSpec:e,style:r,validateSpec:Us,objectElementValidators:{glyphs:cd,"*":()=>[]}})),r.constants&&(o=o.concat(td({key:"constants",value:r.constants,style:r,styleSpec:e,validateSpec:Us}))),Xl(o)}function Vs(r){return function(e){return r({...e,validateSpec:Us})}}function Xl(r){return[].concat(r).sort((e,o)=>e.line-o.line)}function $s(r){return function(...e){return Xl(r.apply(this,e))}}ts.source=$s(Vs(On)),ts.sprite=$s(Vs(ad)),ts.glyphs=$s(Vs(cd)),ts.light=$s(Vs(rl)),ts.terrain=$s(Vs(od)),ts.layer=$s(Vs(sd)),ts.filter=$s(Vs(ma)),ts.paintProperty=$s(Vs(rd)),ts.layoutProperty=$s(Vs(nd));const js=ts,kf=js.light,_u=js.paintProperty,ud=js.layoutProperty;function Jl(r,e){let o=!1;if(e&&e.length)for(const c of e)r.fire(new Gr(new Error(c.message))),o=!0;return o}class ga{constructor(e,o,c){const d=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const y=new Int32Array(this.arrayBuffer);e=y[0],this.d=(o=y[1])+2*(c=y[2]);for(let S=0;S<this.d*this.d;S++){const k=y[3+S],C=y[3+S+1];d.push(k===C?null:y.subarray(k,C))}const b=y[3+d.length+1];this.keys=y.subarray(y[3+d.length],b),this.bboxes=y.subarray(b),this.insert=this._insertReadonly}else{this.d=o+2*c;for(let y=0;y<this.d*this.d;y++)d.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=e,this.padding=c,this.scale=o/e,this.uid=0;const m=c/o*e;this.min=-m,this.max=e+m}insert(e,o,c,d,m){this._forEachCell(o,c,d,m,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(m)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,o,c,d,m,y){this.cells[m].push(y)}query(e,o,c,d,m){const y=this.min,b=this.max;if(e<=y&&o<=y&&b<=c&&b<=d&&!m)return Array.prototype.slice.call(this.keys);{const S=[];return this._forEachCell(e,o,c,d,this._queryCell,S,{},m),S}}_queryCell(e,o,c,d,m,y,b,S){const k=this.cells[m];if(k!==null){const C=this.keys,L=this.bboxes;for(let B=0;B<k.length;B++){const O=k[B];if(b[O]===void 0){const N=4*O;(S?S(L[N+0],L[N+1],L[N+2],L[N+3]):e<=L[N+2]&&o<=L[N+3]&&c>=L[N+0]&&d>=L[N+1])?(b[O]=!0,y.push(C[O])):b[O]=!1}}}}_forEachCell(e,o,c,d,m,y,b,S){const k=this._convertToCellCoord(e),C=this._convertToCellCoord(o),L=this._convertToCellCoord(c),B=this._convertToCellCoord(d);for(let O=k;O<=L;O++)for(let N=C;N<=B;N++){const q=this.d*N+O;if((!S||S(this._convertFromCellCoord(O),this._convertFromCellCoord(N),this._convertFromCellCoord(O+1),this._convertFromCellCoord(N+1)))&&m.call(this,e,o,c,d,q,y,b,S))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,o=3+this.cells.length+1+1;let c=0;for(let y=0;y<this.cells.length;y++)c+=this.cells[y].length;const d=new Int32Array(o+c+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;let m=o;for(let y=0;y<e.length;y++){const b=e[y];d[3+y]=m,d.set(b,m),m+=b.length}return d[3+e.length]=m,d.set(this.keys,m),m+=this.keys.length,d[3+e.length+1]=m,d.set(this.bboxes,m),m+=this.bboxes.length,d.buffer}static serialize(e,o){const c=e.toArrayBuffer();return o&&o.push(c),{buffer:c}}static deserialize(e){return new ga(e.buffer)}}const qs={};function le(r,e,o={}){if(qs[r])throw new Error(`${r} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:r,writeable:!1}),qs[r]={klass:e,omit:o.omit||[],shallow:o.shallow||[]}}le("Object",Object),le("TransferableGridIndex",ga),le("Color",Di),le("Error",Error),le("AJAXError",Xt),le("ResolvedImage",Hr),le("StylePropertyFunction",Ka),le("StyleExpression",pu,{omit:["_evaluator"]}),le("ZoomDependentExpression",Zl),le("ZoomConstantExpression",fu),le("CompoundExpression",Qn,{omit:["_evaluate"]});for(const r in da)da[r]._classRegistryKey||le(`Expression_${r}`,da[r]);function Ql(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function co(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob)return r;if(Ql(r)||ie(r))return e&&e.push(r),r;if(ArrayBuffer.isView(r)){const o=r;return e&&e.push(o.buffer),o}if(r instanceof ImageData)return e&&e.push(r.data.buffer),r;if(Array.isArray(r)){const o=[];for(const c of r)o.push(co(c,e));return o}if(typeof r=="object"){const o=r.constructor,c=o._classRegistryKey;if(!c)throw new Error("can't serialize object of unregistered class");if(!qs[c])throw new Error(`${c} is not registered.`);const d=o.serialize?o.serialize(r,e):{};if(o.serialize){if(e&&d===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const m in r){if(!r.hasOwnProperty(m)||qs[c].omit.indexOf(m)>=0)continue;const y=r[m];d[m]=qs[c].shallow.indexOf(m)>=0?y:co(y,e)}r instanceof Error&&(d.message=r.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(d.$name=c),d}throw new Error("can't serialize object of type "+typeof r)}function ya(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||Ql(r)||ie(r)||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(ya);if(typeof r=="object"){const e=r.$name||"Object";if(!qs[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:o}=qs[e];if(!o)throw new Error(`can't deserialize unregistered class ${e}`);if(o.deserialize)return o.deserialize(r);const c=Object.create(o.prototype);for(const d of Object.keys(r)){if(d==="$name")continue;const m=r[d];c[d]=qs[e].shallow.indexOf(d)>=0?m:ya(m)}return c}throw new Error("can't deserialize object of type "+typeof r)}class hd{constructor(){this.first=!0}update(e,o){const c=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=o),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=c,!0))}}const te={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function vu(r){for(const e of r)if(xu(e.charCodeAt(0)))return!0;return!1}function bu(r){for(const e of r)if(!Af(e.charCodeAt(0)))return!1;return!0}function Af(r){return!(te.Arabic(r)||te["Arabic Supplement"](r)||te["Arabic Extended-A"](r)||te["Arabic Presentation Forms-A"](r)||te["Arabic Presentation Forms-B"](r))}function xu(r){return!(r!==746&&r!==747&&(r<4352||!(te["Bopomofo Extended"](r)||te.Bopomofo(r)||te["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||te["CJK Compatibility Ideographs"](r)||te["CJK Compatibility"](r)||te["CJK Radicals Supplement"](r)||te["CJK Strokes"](r)||!(!te["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||te["CJK Unified Ideographs Extension A"](r)||te["CJK Unified Ideographs"](r)||te["Enclosed CJK Letters and Months"](r)||te["Hangul Compatibility Jamo"](r)||te["Hangul Jamo Extended-A"](r)||te["Hangul Jamo Extended-B"](r)||te["Hangul Jamo"](r)||te["Hangul Syllables"](r)||te.Hiragana(r)||te["Ideographic Description Characters"](r)||te.Kanbun(r)||te["Kangxi Radicals"](r)||te["Katakana Phonetic Extensions"](r)||te.Katakana(r)&&r!==12540||!(!te["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!te["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||te["Unified Canadian Aboriginal Syllabics"](r)||te["Unified Canadian Aboriginal Syllabics Extended"](r)||te["Vertical Forms"](r)||te["Yijing Hexagram Symbols"](r)||te["Yi Syllables"](r)||te["Yi Radicals"](r))))}function dd(r){return!(xu(r)||function(e){return!!(te["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||te["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||te["Letterlike Symbols"](e)||te["Number Forms"](e)||te["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||te["Control Pictures"](e)&&e!==9251||te["Optical Character Recognition"](e)||te["Enclosed Alphanumerics"](e)||te["Geometric Shapes"](e)||te["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||te["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||te["CJK Symbols and Punctuation"](e)||te.Katakana(e)||te["Private Use Area"](e)||te["CJK Compatibility Forms"](e)||te["Small Form Variants"](e)||te["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(r))}function pd(r){return r>=1424&&r<=2303||te["Arabic Presentation Forms-A"](r)||te["Arabic Presentation Forms-B"](r)}function fd(r,e){return!(!e&&pd(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||te.Khmer(r))}function Ef(r){for(const e of r)if(pd(e.charCodeAt(0)))return!0;return!1}const wu="deferred",Su="loading",Iu="loaded";let Tu=null,Tn="unavailable",uo=null;const nl=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(Tn="error"),Tu&&Tu(r)};function ku(){sl.fire(new rn("pluginStateChange",{pluginStatus:Tn,pluginURL:uo}))}const sl=new Sn,Au=function(){return Tn},md=function(){if(Tn!==wu||!uo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Tn=Su,ku(),uo&&wn({url:uo},r=>{r?nl(r):(Tn=Iu,ku())})},Nn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Tn===Iu||Nn.applyArabicShaping!=null,isLoading:()=>Tn===Su,setState(r){if(!se())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Tn=r.pluginStatus,uo=r.pluginURL},isParsed(){if(!se())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Nn.applyArabicShaping!=null&&Nn.processBidirectionalText!=null&&Nn.processStyledBidirectionalText!=null},getPluginURL(){if(!se())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return uo}};class Wi{constructor(e,o){this.zoom=e,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new hd,this.transition={})}isSupportedScript(e){return function(o,c){for(const d of o)if(!fd(d.charCodeAt(0),c))return!1;return!0}(e,Nn.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,o=e-Math.floor(e),c=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*o}}}class tc{constructor(e,o){this.property=e,this.value=o,this.expression=function(c,d){if(nr(c))return new Ka(c,d);if(ql(c)){const m=mu(c,d);if(m.result==="error")throw new Error(m.value.map(y=>`${y.key}: ${y.message}`).join(", "));return m.value}{let m=c;return d.type==="color"&&typeof c=="string"?m=Di.parse(c):d.type!=="padding"||typeof c!="number"&&!Array.isArray(c)?d.type==="variableAnchorOffsetCollection"&&Array.isArray(c)&&(m=Xn.parse(c)):m=Bn.parse(c),{kind:"constant",evaluate:()=>m}}}(o===void 0?e.specification.default:o,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,o,c){return this.property.possiblyEvaluate(this,e,o,c)}}class Eu{constructor(e){this.property=e,this.value=new tc(e,void 0)}transitioned(e,o){return new yd(this.property,this.value,o,Rt({},e.transition,this.transition),e.now)}untransitioned(){return new yd(this.property,this.value,null,{},0)}}class gd{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return jt(this._values[e].value.value)}setValue(e,o){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Eu(this._values[e].property)),this._values[e].value=new tc(this._values[e].property,o===null?void 0:jt(o))}getTransition(e){return jt(this._values[e].transition)}setTransition(e,o){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Eu(this._values[e].property)),this._values[e].transition=jt(o)||void 0}serialize(){const e={};for(const o of Object.keys(this._values)){const c=this.getValue(o);c!==void 0&&(e[o]=c);const d=this.getTransition(o);d!==void 0&&(e[`${o}-transition`]=d)}return e}transitioned(e,o){const c=new _d(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].transitioned(e,o._values[d]);return c}untransitioned(){const e=new _d(this._properties);for(const o of Object.keys(this._values))e._values[o]=this._values[o].untransitioned();return e}}class yd{constructor(e,o,c,d,m){this.property=e,this.value=o,this.begin=m+d.delay||0,this.end=this.begin+d.duration||0,e.specification.transition&&(d.delay||d.duration)&&(this.prior=c)}possiblyEvaluate(e,o,c){const d=e.now||0,m=this.value.possiblyEvaluate(e,o,c),y=this.prior;if(y){if(d>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(d<this.begin)return y.possiblyEvaluate(e,o,c);{const b=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(e,o,c),m,function(S){if(S<=0)return 0;if(S>=1)return 1;const k=S*S,C=k*S;return 4*(S<.5?C:3*(S-k)+C-.75)}(b))}}return m}}class _d{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,o,c){const d=new ec(this._properties);for(const m of Object.keys(this._values))d._values[m]=this._values[m].possiblyEvaluate(e,o,c);return d}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Cf{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return jt(this._values[e].value)}setValue(e,o){this._values[e]=new tc(this._values[e].property,o===null?void 0:jt(o))}serialize(){const e={};for(const o of Object.keys(this._values)){const c=this.getValue(o);c!==void 0&&(e[o]=c)}return e}possiblyEvaluate(e,o,c){const d=new ec(this._properties);for(const m of Object.keys(this._values))d._values[m]=this._values[m].possiblyEvaluate(e,o,c);return d}}class fn{constructor(e,o,c){this.property=e,this.value=o,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,o,c,d){return this.property.evaluate(this.value,this.parameters,e,o,c,d)}}class ec{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class be{constructor(e){this.specification=e}possiblyEvaluate(e,o){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(o)}interpolate(e,o,c){const d=Rn[this.specification.type];return d?d(e,o,c):e}}class Ae{constructor(e,o){this.specification=e,this.overrides=o}possiblyEvaluate(e,o,c,d){return new fn(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(o,null,{},c,d)}:e.expression,o)}interpolate(e,o,c){if(e.value.kind!=="constant"||o.value.kind!=="constant")return e;if(e.value.value===void 0||o.value.value===void 0)return new fn(this,{kind:"constant",value:void 0},e.parameters);const d=Rn[this.specification.type];if(d){const m=d(e.value.value,o.value.value,c);return new fn(this,{kind:"constant",value:m},e.parameters)}return e}evaluate(e,o,c,d,m,y){return e.kind==="constant"?e.value:e.evaluate(o,c,d,m,y)}}class ol extends Ae{possiblyEvaluate(e,o,c,d){if(e.value===void 0)return new fn(this,{kind:"constant",value:void 0},o);if(e.expression.kind==="constant"){const m=e.expression.evaluate(o,null,{},c,d),y=e.property.specification.type==="resolvedImage"&&typeof m!="string"?m.name:m,b=this._calculate(y,y,y,o);return new fn(this,{kind:"constant",value:b},o)}if(e.expression.kind==="camera"){const m=this._calculate(e.expression.evaluate({zoom:o.zoom-1}),e.expression.evaluate({zoom:o.zoom}),e.expression.evaluate({zoom:o.zoom+1}),o);return new fn(this,{kind:"constant",value:m},o)}return new fn(this,e.expression,o)}evaluate(e,o,c,d,m,y){if(e.kind==="source"){const b=e.evaluate(o,c,d,m,y);return this._calculate(b,b,b,o)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(o.zoom)-1},c,d),e.evaluate({zoom:Math.floor(o.zoom)},c,d),e.evaluate({zoom:Math.floor(o.zoom)+1},c,d),o):e.value}_calculate(e,o,c,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:e,to:o}:{from:c,to:o}}interpolate(e){return e}}class Cu{constructor(e){this.specification=e}possiblyEvaluate(e,o,c,d){if(e.value!==void 0){if(e.expression.kind==="constant"){const m=e.expression.evaluate(o,null,{},c,d);return this._calculate(m,m,m,o)}return this._calculate(e.expression.evaluate(new Wi(Math.floor(o.zoom-1),o)),e.expression.evaluate(new Wi(Math.floor(o.zoom),o)),e.expression.evaluate(new Wi(Math.floor(o.zoom+1),o)),o)}}_calculate(e,o,c,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:e,to:o}:{from:c,to:o}}interpolate(e){return e}}class Mu{constructor(e){this.specification=e}possiblyEvaluate(e,o,c,d){return!!e.expression.evaluate(o,null,{},c,d)}interpolate(){return!1}}class xr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const o in e){const c=e[o];c.specification.overridable&&this.overridableProperties.push(o);const d=this.defaultPropertyValues[o]=new tc(c,void 0),m=this.defaultTransitionablePropertyValues[o]=new Eu(c);this.defaultTransitioningPropertyValues[o]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=d.possiblyEvaluate({})}}}le("DataDrivenProperty",Ae),le("DataConstantProperty",be),le("CrossFadedDataDrivenProperty",ol),le("CrossFadedProperty",Cu),le("ColorRampProperty",Mu);const Du="-transition";class es extends Sn{constructor(e,o){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),o.layout&&(this._unevaluatedLayout=new Cf(o.layout)),o.paint)){this._transitionablePaint=new gd(o.paint);for(const c in e.paint)this.setPaintProperty(c,e.paint[c],{validate:!1});for(const c in e.layout)this.setLayoutProperty(c,e.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ec(o.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,o,c={}){o!=null&&this._validate(ud,`layers.${this.id}.layout.${e}`,e,o,c)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,o):this.visibility=o)}getPaintProperty(e){return e.endsWith(Du)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,o,c={}){if(o!=null&&this._validate(_u,`layers.${this.id}.paint.${e}`,e,o,c))return!1;if(e.endsWith(Du))return this._transitionablePaint.setTransition(e.slice(0,-11),o||void 0),!1;{const d=this._transitionablePaint._values[e],m=d.property.specification["property-type"]==="cross-faded-data-driven",y=d.value.isDataDriven(),b=d.value;this._transitionablePaint.setValue(e,o),this._handleSpecialPaintPropertyUpdate(e);const S=this._transitionablePaint._values[e].value;return S.isDataDriven()||y||m||this._handleOverridablePaintPropertyUpdate(e,b,S)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,o,c){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,o){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,o)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),me(e,(o,c)=>!(o===void 0||c==="layout"&&!Object.keys(o).length||c==="paint"&&!Object.keys(o).length))}_validate(e,o,c,d,m={}){return(!m||m.validate!==!1)&&Jl(this,e.call(js,{key:o,layerType:this.type,objectKey:c,value:d,styleSpec:Tt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const o=this.paint.get(e);if(o instanceof fn&&pa(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}}const vd={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Oo{constructor(e,o){this._structArray=e,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class dr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,o){return e._trim(),o&&(e.isTransferred=!0,o.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const o=Object.create(this.prototype);return o.arrayBuffer=e.arrayBuffer,o.length=e.length,o.capacity=e.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function or(r,e=1){let o=0,c=0;return{members:r.map(d=>{const m=vd[d.type].BYTES_PER_ELEMENT,y=o=_a(o,Math.max(e,m)),b=d.components||1;return c=Math.max(c,m),o+=m*b,{name:d.name,type:d.type,components:b,offset:y}}),size:_a(o,Math.max(c,e)),alignment:e}}function _a(r,e){return Math.ceil(r/e)*e}class al extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,o)}emplace(e,o,c){const d=2*e;return this.int16[d+0]=o,this.int16[d+1]=c,e}}al.prototype.bytesPerElement=4,le("StructArrayLayout2i4",al);class ll extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,o,c)}emplace(e,o,c,d){const m=3*e;return this.int16[m+0]=o,this.int16[m+1]=c,this.int16[m+2]=d,e}}ll.prototype.bytesPerElement=6,le("StructArrayLayout3i6",ll);class No extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,o,c,d)}emplace(e,o,c,d,m){const y=4*e;return this.int16[y+0]=o,this.int16[y+1]=c,this.int16[y+2]=d,this.int16[y+3]=m,e}}No.prototype.bytesPerElement=8,le("StructArrayLayout4i8",No);class Pu extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,c,d,m,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,o,c,d,m,y)}emplace(e,o,c,d,m,y,b){const S=6*e;return this.int16[S+0]=o,this.int16[S+1]=c,this.int16[S+2]=d,this.int16[S+3]=m,this.int16[S+4]=y,this.int16[S+5]=b,e}}Pu.prototype.bytesPerElement=12,le("StructArrayLayout2i4i12",Pu);class Lu extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,c,d,m,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,o,c,d,m,y)}emplace(e,o,c,d,m,y,b){const S=4*e,k=8*e;return this.int16[S+0]=o,this.int16[S+1]=c,this.uint8[k+4]=d,this.uint8[k+5]=m,this.uint8[k+6]=y,this.uint8[k+7]=b,e}}Lu.prototype.bytesPerElement=8,le("StructArrayLayout2i4ub8",Lu);class va extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,o)}emplace(e,o,c){const d=2*e;return this.float32[d+0]=o,this.float32[d+1]=c,e}}va.prototype.bytesPerElement=8,le("StructArrayLayout2f8",va);class zu extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,c,d,m,y,b,S,k,C){const L=this.length;return this.resize(L+1),this.emplace(L,e,o,c,d,m,y,b,S,k,C)}emplace(e,o,c,d,m,y,b,S,k,C,L){const B=10*e;return this.uint16[B+0]=o,this.uint16[B+1]=c,this.uint16[B+2]=d,this.uint16[B+3]=m,this.uint16[B+4]=y,this.uint16[B+5]=b,this.uint16[B+6]=S,this.uint16[B+7]=k,this.uint16[B+8]=C,this.uint16[B+9]=L,e}}zu.prototype.bytesPerElement=20,le("StructArrayLayout10ui20",zu);class Bu extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,c,d,m,y,b,S,k,C,L,B){const O=this.length;return this.resize(O+1),this.emplace(O,e,o,c,d,m,y,b,S,k,C,L,B)}emplace(e,o,c,d,m,y,b,S,k,C,L,B,O){const N=12*e;return this.int16[N+0]=o,this.int16[N+1]=c,this.int16[N+2]=d,this.int16[N+3]=m,this.uint16[N+4]=y,this.uint16[N+5]=b,this.uint16[N+6]=S,this.uint16[N+7]=k,this.int16[N+8]=C,this.int16[N+9]=L,this.int16[N+10]=B,this.int16[N+11]=O,e}}Bu.prototype.bytesPerElement=24,le("StructArrayLayout4i4ui4i24",Bu);class Ii extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,o,c)}emplace(e,o,c,d){const m=3*e;return this.float32[m+0]=o,this.float32[m+1]=c,this.float32[m+2]=d,e}}Ii.prototype.bytesPerElement=12,le("StructArrayLayout3f12",Ii);class f extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.uint32[1*e+0]=o,e}}f.prototype.bytesPerElement=4,le("StructArrayLayout1ul4",f);class i extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,c,d,m,y,b,S,k){const C=this.length;return this.resize(C+1),this.emplace(C,e,o,c,d,m,y,b,S,k)}emplace(e,o,c,d,m,y,b,S,k,C){const L=10*e,B=5*e;return this.int16[L+0]=o,this.int16[L+1]=c,this.int16[L+2]=d,this.int16[L+3]=m,this.int16[L+4]=y,this.int16[L+5]=b,this.uint32[B+3]=S,this.uint16[L+8]=k,this.uint16[L+9]=C,e}}i.prototype.bytesPerElement=20,le("StructArrayLayout6i1ul2ui20",i);class a extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,c,d,m,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,o,c,d,m,y)}emplace(e,o,c,d,m,y,b){const S=6*e;return this.int16[S+0]=o,this.int16[S+1]=c,this.int16[S+2]=d,this.int16[S+3]=m,this.int16[S+4]=y,this.int16[S+5]=b,e}}a.prototype.bytesPerElement=12,le("StructArrayLayout2i2i2i12",a);class h extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,c,d,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,o,c,d,m)}emplace(e,o,c,d,m,y){const b=4*e,S=8*e;return this.float32[b+0]=o,this.float32[b+1]=c,this.float32[b+2]=d,this.int16[S+6]=m,this.int16[S+7]=y,e}}h.prototype.bytesPerElement=16,le("StructArrayLayout2f1f2i16",h);class p extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,o,c,d)}emplace(e,o,c,d,m){const y=12*e,b=3*e;return this.uint8[y+0]=o,this.uint8[y+1]=c,this.float32[b+1]=d,this.float32[b+2]=m,e}}p.prototype.bytesPerElement=12,le("StructArrayLayout2ub2f12",p);class g extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,o,c)}emplace(e,o,c,d){const m=3*e;return this.uint16[m+0]=o,this.uint16[m+1]=c,this.uint16[m+2]=d,e}}g.prototype.bytesPerElement=6,le("StructArrayLayout3ui6",g);class x extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,c,d,m,y,b,S,k,C,L,B,O,N,q,X,et){const dt=this.length;return this.resize(dt+1),this.emplace(dt,e,o,c,d,m,y,b,S,k,C,L,B,O,N,q,X,et)}emplace(e,o,c,d,m,y,b,S,k,C,L,B,O,N,q,X,et,dt){const ot=24*e,mt=12*e,vt=48*e;return this.int16[ot+0]=o,this.int16[ot+1]=c,this.uint16[ot+2]=d,this.uint16[ot+3]=m,this.uint32[mt+2]=y,this.uint32[mt+3]=b,this.uint32[mt+4]=S,this.uint16[ot+10]=k,this.uint16[ot+11]=C,this.uint16[ot+12]=L,this.float32[mt+7]=B,this.float32[mt+8]=O,this.uint8[vt+36]=N,this.uint8[vt+37]=q,this.uint8[vt+38]=X,this.uint32[mt+10]=et,this.int16[ot+22]=dt,e}}x.prototype.bytesPerElement=48,le("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",x);class w extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,c,d,m,y,b,S,k,C,L,B,O,N,q,X,et,dt,ot,mt,vt,Dt,ee,fe,Jt,Kt,qt,ce){const Zt=this.length;return this.resize(Zt+1),this.emplace(Zt,e,o,c,d,m,y,b,S,k,C,L,B,O,N,q,X,et,dt,ot,mt,vt,Dt,ee,fe,Jt,Kt,qt,ce)}emplace(e,o,c,d,m,y,b,S,k,C,L,B,O,N,q,X,et,dt,ot,mt,vt,Dt,ee,fe,Jt,Kt,qt,ce,Zt){const Nt=32*e,Ie=16*e;return this.int16[Nt+0]=o,this.int16[Nt+1]=c,this.int16[Nt+2]=d,this.int16[Nt+3]=m,this.int16[Nt+4]=y,this.int16[Nt+5]=b,this.int16[Nt+6]=S,this.int16[Nt+7]=k,this.uint16[Nt+8]=C,this.uint16[Nt+9]=L,this.uint16[Nt+10]=B,this.uint16[Nt+11]=O,this.uint16[Nt+12]=N,this.uint16[Nt+13]=q,this.uint16[Nt+14]=X,this.uint16[Nt+15]=et,this.uint16[Nt+16]=dt,this.uint16[Nt+17]=ot,this.uint16[Nt+18]=mt,this.uint16[Nt+19]=vt,this.uint16[Nt+20]=Dt,this.uint16[Nt+21]=ee,this.uint16[Nt+22]=fe,this.uint32[Ie+12]=Jt,this.float32[Ie+13]=Kt,this.float32[Ie+14]=qt,this.uint16[Nt+30]=ce,this.uint16[Nt+31]=Zt,e}}w.prototype.bytesPerElement=64,le("StructArrayLayout8i15ui1ul2f2ui64",w);class T extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.float32[1*e+0]=o,e}}T.prototype.bytesPerElement=4,le("StructArrayLayout1f4",T);class A extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,o,c)}emplace(e,o,c,d){const m=3*e;return this.uint16[6*e+0]=o,this.float32[m+1]=c,this.float32[m+2]=d,e}}A.prototype.bytesPerElement=12,le("StructArrayLayout1ui2f12",A);class M extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,o,c)}emplace(e,o,c,d){const m=4*e;return this.uint32[2*e+0]=o,this.uint16[m+2]=c,this.uint16[m+3]=d,e}}M.prototype.bytesPerElement=8,le("StructArrayLayout1ul2ui8",M);class D extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,o)}emplace(e,o,c){const d=2*e;return this.uint16[d+0]=o,this.uint16[d+1]=c,e}}D.prototype.bytesPerElement=4,le("StructArrayLayout2ui4",D);class F extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.uint16[1*e+0]=o,e}}F.prototype.bytesPerElement=2,le("StructArrayLayout1ui2",F);class Z extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,o,c,d)}emplace(e,o,c,d,m){const y=4*e;return this.float32[y+0]=o,this.float32[y+1]=c,this.float32[y+2]=d,this.float32[y+3]=m,e}}Z.prototype.bytesPerElement=16,le("StructArrayLayout4f16",Z);class G extends Oo{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new W(this.anchorPointX,this.anchorPointY)}}G.prototype.size=20;class Y extends i{get(e){return new G(this,e)}}le("CollisionBoxArray",Y);class $ extends Oo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}$.prototype.size=48;class lt extends x{get(e){return new $(this,e)}}le("PlacedSymbolArray",lt);class yt extends Oo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}yt.prototype.size=64;class Q extends w{get(e){return new yt(this,e)}}le("SymbolInstanceArray",Q);class ut extends T{getoffsetX(e){return this.float32[1*e+0]}}le("GlyphOffsetArray",ut);class xt extends ll{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}le("SymbolLineVertexArray",xt);class St extends Oo{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}St.prototype.size=12;class Mt extends A{get(e){return new St(this,e)}}le("TextAnchorOffsetArray",Mt);class Ft extends Oo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Ft.prototype.size=8;class zt extends M{get(e){return new Ft(this,e)}}le("FeatureIndexArray",zt);class $t extends al{}class pe extends al{}class ri extends al{}class Yt extends Pu{}class Ee extends Lu{}class ge extends va{}class Pi extends zu{}class ii extends Bu{}class Ye extends Ii{}class ni extends f{}class _r extends a{}class ji extends p{}class Yr extends g{}class Lr extends D{}const wr=or([{name:"a_pos",components:2,type:"Int16"}],4),{members:Un}=wr;class Hi{constructor(e=[]){this.segments=e}prepareSegment(e,o,c,d){let m=this.segments[this.segments.length-1];return e>Hi.MAX_VERTEX_ARRAY_LENGTH&&ae(`Max vertices per segment is ${Hi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!m||m.vertexLength+e>Hi.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==d)&&(m={vertexOffset:o.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},d!==void 0&&(m.sortKey=d),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const e of this.segments)for(const o in e.vaos)e.vaos[o].destroy()}static simpleSegment(e,o,c,d){return new Hi([{vertexOffset:e,primitiveOffset:o,vertexLength:c,primitiveLength:d,vaos:{},sortKey:0}])}}function ws(r,e){return 256*(r=Lt(Math.floor(r),0,255))+Lt(Math.floor(e),0,255)}Hi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,le("SegmentVector",Hi);const Ss=or([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ho={exports:{}},Uo={exports:{}};Uo.exports=function(r,e){var o,c,d,m,y,b,S,k;for(c=r.length-(o=3&r.length),d=e,y=3432918353,b=461845907,k=0;k<c;)S=255&r.charCodeAt(k)|(255&r.charCodeAt(++k))<<8|(255&r.charCodeAt(++k))<<16|(255&r.charCodeAt(++k))<<24,++k,d=27492+(65535&(m=5*(65535&(d=(d^=S=(65535&(S=(S=(65535&S)*y+(((S>>>16)*y&65535)<<16)&4294967295)<<15|S>>>17))*b+(((S>>>16)*b&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(S=0,o){case 3:S^=(255&r.charCodeAt(k+2))<<16;case 2:S^=(255&r.charCodeAt(k+1))<<8;case 1:d^=S=(65535&(S=(S=(65535&(S^=255&r.charCodeAt(k)))*y+(((S>>>16)*y&65535)<<16)&4294967295)<<15|S>>>17))*b+(((S>>>16)*b&65535)<<16)&4294967295}return d^=r.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0};var ba=Uo.exports,an={exports:{}};an.exports=function(r,e){for(var o,c=r.length,d=e^c,m=0;c>=4;)o=1540483477*(65535&(o=255&r.charCodeAt(m)|(255&r.charCodeAt(++m))<<8|(255&r.charCodeAt(++m))<<16|(255&r.charCodeAt(++m))<<24))+((1540483477*(o>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),c-=4,++m;switch(c){case 3:d^=(255&r.charCodeAt(m+2))<<16;case 2:d^=(255&r.charCodeAt(m+1))<<8;case 1:d=1540483477*(65535&(d^=255&r.charCodeAt(m)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0};var Kr=ba,mn=an.exports;ho.exports=Kr,ho.exports.murmur3=Kr,ho.exports.murmur2=mn;var Vo=E(ho.exports);class vr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,o,c,d){this.ids.push(zr(e)),this.positions.push(o,c,d)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const o=zr(e);let c=0,d=this.ids.length-1;for(;c<d;){const y=c+d>>1;this.ids[y]>=o?d=y:c=y+1}const m=[];for(;this.ids[c]===o;)m.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return m}static serialize(e,o){const c=new Float64Array(e.ids),d=new Uint32Array(e.positions);return kn(c,d,0,c.length-1),o&&o.push(c.buffer,d.buffer),{ids:c,positions:d}}static deserialize(e){const o=new vr;return o.ids=e.ids,o.positions=e.positions,o.indexed=!0,o}}function zr(r){const e=+r;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Vo(String(r))}function kn(r,e,o,c){for(;o<c;){const d=r[o+c>>1];let m=o-1,y=c+1;for(;;){do m++;while(r[m]<d);do y--;while(r[y]>d);if(m>=y)break;br(r,m,y),br(e,3*m,3*y),br(e,3*m+1,3*y+1),br(e,3*m+2,3*y+2)}y-o<c-y?(kn(r,e,o,y),o=y+1):(kn(r,e,y+1,c),c=y)}}function br(r,e,o){const c=r[e];r[e]=r[o],r[o]=c}le("FeaturePositionMap",vr);class $o{constructor(e,o){this.gl=e.gl,this.location=o}}class ic extends $o{constructor(e,o){super(e,o),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class bd extends $o{constructor(e,o){super(e,o),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class xd extends $o{constructor(e,o){super(e,o),this.current=Di.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Mf=new Float32Array(16);function Ru(r){return[ws(255*r.r,255*r.g),ws(255*r.b,255*r.a)]}class Is{constructor(e,o,c){this.value=e,this.uniformNames=o.map(d=>`u_${d}`),this.type=c}setUniform(e,o,c){e.set(c.constantOr(this.value))}getBinding(e,o,c){return this.type==="color"?new xd(e,o):new ic(e,o)}}class jo{constructor(e,o){this.uniformNames=o.map(c=>`u_${c}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=e.tlbr}setUniform(e,o,c,d){const m=d==="u_pattern_to"?this.patternTo:d==="u_pattern_from"?this.patternFrom:d==="u_pixel_ratio_to"?this.pixelRatioTo:d==="u_pixel_ratio_from"?this.pixelRatioFrom:null;m&&e.set(m)}getBinding(e,o,c){return c.substr(0,9)==="u_pattern"?new bd(e,o):new ic(e,o)}}class Ts{constructor(e,o,c,d){this.expression=e,this.type=c,this.maxValue=0,this.paintVertexAttributes=o.map(m=>({name:`a_${m}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,o,c,d,m){const y=this.paintVertexArray.length,b=this.expression.evaluate(new Wi(0),o,{},d,[],m);this.paintVertexArray.resize(e),this._setPaintValue(y,e,b)}updatePaintArray(e,o,c,d){const m=this.expression.evaluate({zoom:0},c,d);this._setPaintValue(e,o,m)}_setPaintValue(e,o,c){if(this.type==="color"){const d=Ru(c);for(let m=e;m<o;m++)this.paintVertexArray.emplace(m,d[0],d[1])}else{for(let d=e;d<o;d++)this.paintVertexArray.emplace(d,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class is{constructor(e,o,c,d,m,y){this.expression=e,this.uniformNames=o.map(b=>`u_${b}_t`),this.type=c,this.useIntegerZoom=d,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=o.map(b=>({name:`a_${b}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(e,o,c,d,m){const y=this.expression.evaluate(new Wi(this.zoom),o,{},d,[],m),b=this.expression.evaluate(new Wi(this.zoom+1),o,{},d,[],m),S=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(S,e,y,b)}updatePaintArray(e,o,c,d){const m=this.expression.evaluate({zoom:this.zoom},c,d),y=this.expression.evaluate({zoom:this.zoom+1},c,d);this._setPaintValue(e,o,m,y)}_setPaintValue(e,o,c,d){if(this.type==="color"){const m=Ru(c),y=Ru(d);for(let b=e;b<o;b++)this.paintVertexArray.emplace(b,m[0],m[1],y[0],y[1])}else{for(let m=e;m<o;m++)this.paintVertexArray.emplace(m,c,d);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(d))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,o){const c=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,d=Lt(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);e.set(d)}getBinding(e,o,c){return new ic(e,o)}}class ks{constructor(e,o,c,d,m,y){this.expression=e,this.type=o,this.useIntegerZoom=c,this.zoom=d,this.layerId=y,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m}populatePaintArray(e,o,c){const d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(d,e,o.patterns&&o.patterns[this.layerId],c)}updatePaintArray(e,o,c,d,m){this._setPaintValues(e,o,c.patterns&&c.patterns[this.layerId],m)}_setPaintValues(e,o,c,d){if(!d||!c)return;const{min:m,mid:y,max:b}=c,S=d[m],k=d[y],C=d[b];if(S&&k&&C)for(let L=e;L<o;L++)this.zoomInPaintVertexArray.emplace(L,k.tl[0],k.tl[1],k.br[0],k.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],k.pixelRatio,S.pixelRatio),this.zoomOutPaintVertexArray.emplace(L,k.tl[0],k.tl[1],k.br[0],k.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],k.pixelRatio,C.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Ss.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Ss.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Fu{constructor(e,o,c){this.binders={},this._buffers=[];const d=[];for(const m in e.paint._values){if(!c(m))continue;const y=e.paint.get(m);if(!(y instanceof fn&&pa(y.property.specification)))continue;const b=Ox(m,e.type),S=y.value,k=y.property.specification.type,C=y.property.useIntegerZoom,L=y.property.specification["property-type"],B=L==="cross-faded"||L==="cross-faded-data-driven";if(S.kind==="constant")this.binders[m]=B?new jo(S.value,b):new Is(S.value,b,k),d.push(`/u_${m}`);else if(S.kind==="source"||B){const O=ty(m,k,"source");this.binders[m]=B?new ks(S,k,C,o,O,e.id):new Ts(S,b,k,O),d.push(`/a_${m}`)}else{const O=ty(m,k,"composite");this.binders[m]=new is(S,b,k,C,o,O),d.push(`/z_${m}`)}}this.cacheKey=d.sort().join("")}getMaxValue(e){const o=this.binders[e];return o instanceof Ts||o instanceof is?o.maxValue:0}populatePaintArrays(e,o,c,d,m){for(const y in this.binders){const b=this.binders[y];(b instanceof Ts||b instanceof is||b instanceof ks)&&b.populatePaintArray(e,o,c,d,m)}}setConstantPatternPositions(e,o){for(const c in this.binders){const d=this.binders[c];d instanceof jo&&d.setConstantPatternPositions(e,o)}}updatePaintArrays(e,o,c,d,m){let y=!1;for(const b in e){const S=o.getPositions(b);for(const k of S){const C=c.feature(k.index);for(const L in this.binders){const B=this.binders[L];if((B instanceof Ts||B instanceof is||B instanceof ks)&&B.expression.isStateDependent===!0){const O=d.paint.get(L);B.expression=O.value,B.updatePaintArray(k.start,k.end,C,e[b],m),y=!0}}}}return y}defines(){const e=[];for(const o in this.binders){const c=this.binders[o];(c instanceof Is||c instanceof jo)&&e.push(...c.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return e}getBinderAttributes(){const e=[];for(const o in this.binders){const c=this.binders[o];if(c instanceof Ts||c instanceof is)for(let d=0;d<c.paintVertexAttributes.length;d++)e.push(c.paintVertexAttributes[d].name);else if(c instanceof ks)for(let d=0;d<Ss.members.length;d++)e.push(Ss.members[d].name)}return e}getBinderUniforms(){const e=[];for(const o in this.binders){const c=this.binders[o];if(c instanceof Is||c instanceof jo||c instanceof is)for(const d of c.uniformNames)e.push(d)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,o){const c=[];for(const d in this.binders){const m=this.binders[d];if(m instanceof Is||m instanceof jo||m instanceof is){for(const y of m.uniformNames)if(o[y]){const b=m.getBinding(e,o[y],y);c.push({name:y,property:d,binding:b})}}}return c}setUniforms(e,o,c,d){for(const{name:m,property:y,binding:b}of o)this.binders[y].setUniform(b,d,c.get(y),m)}updatePaintBuffers(e){this._buffers=[];for(const o in this.binders){const c=this.binders[o];if(e&&c instanceof ks){const d=e.fromScale===2?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(c instanceof Ts||c instanceof is)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}}upload(e){for(const o in this.binders){const c=this.binders[o];(c instanceof Ts||c instanceof is||c instanceof ks)&&c.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const o=this.binders[e];(o instanceof Ts||o instanceof is||o instanceof ks)&&o.destroy()}}}class Gs{constructor(e,o,c=()=>!0){this.programConfigurations={};for(const d of e)this.programConfigurations[d.id]=new Fu(d,o,c);this.needsUpload=!1,this._featureMap=new vr,this._bufferOffset=0}populatePaintArrays(e,o,c,d,m,y){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,o,d,m,y);o.id!==void 0&&this._featureMap.add(o.id,c,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,o,c,d){for(const m of c)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,o,m,d)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Ox(r,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}function ty(r,e,o){const c={color:{source:va,composite:Z},number:{source:T,composite:va}},d=function(m){return{"line-pattern":{source:Pi,composite:Pi},"fill-pattern":{source:Pi,composite:Pi},"fill-extrusion-pattern":{source:Pi,composite:Pi}}[m]}(r);return d&&d[o]||c[e][o]}le("ConstantBinder",Is),le("CrossFadedConstantBinder",jo),le("SourceExpressionBinder",Ts),le("CrossFadedCompositeBinder",ks),le("CompositeExpressionBinder",is),le("ProgramConfiguration",Fu,{omit:["_buffers"]}),le("ProgramConfigurationSet",Gs);const Cr=8192,Df=Math.pow(2,14)-1,ey=-Df-1;function cl(r){const e=Cr/r.extent,o=r.loadGeometry();for(let c=0;c<o.length;c++){const d=o[c];for(let m=0;m<d.length;m++){const y=d[m],b=Math.round(y.x*e),S=Math.round(y.y*e);y.x=Lt(b,ey,Df),y.y=Lt(S,ey,Df),(b<y.x||b>y.x+1||S<y.y||S>y.y+1)&&ae("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return o}function ul(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?cl(r):[]}}function wd(r,e,o,c,d){r.emplaceBack(2*e+(c+1)/2,2*o+(d+1)/2)}class Pf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new pe,this.indexArray=new Yr,this.segments=new Hi,this.programConfigurations=new Gs(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(e,o,c){const d=this.layers[0],m=[];let y=null,b=!1;d.type==="circle"&&(y=d.layout.get("circle-sort-key"),b=!y.isConstant());for(const{feature:S,id:k,index:C,sourceLayerIndex:L}of e){const B=this.layers[0]._featureFilter.needGeometry,O=ul(S,B);if(!this.layers[0]._featureFilter.filter(new Wi(this.zoom),O,c))continue;const N=b?y.evaluate(O,{},c):void 0,q={id:k,properties:S.properties,type:S.type,sourceLayerIndex:L,index:C,geometry:B?O.geometry:cl(S),patterns:{},sortKey:N};m.push(q)}b&&m.sort((S,k)=>S.sortKey-k.sortKey);for(const S of m){const{geometry:k,index:C,sourceLayerIndex:L}=S,B=e[C].feature;this.addFeature(S,k,C,c),o.featureIndex.insert(B,k,C,L,this.index)}}update(e,o,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,o,this.stateDependentLayers,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Un),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,o,c,d){for(const m of o)for(const y of m){const b=y.x,S=y.y;if(b<0||b>=Cr||S<0||S>=Cr)continue;const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),C=k.vertexLength;wd(this.layoutVertexArray,b,S,-1,-1),wd(this.layoutVertexArray,b,S,1,-1),wd(this.layoutVertexArray,b,S,1,1),wd(this.layoutVertexArray,b,S,-1,1),this.indexArray.emplaceBack(C,C+1,C+2),this.indexArray.emplaceBack(C,C+3,C+2),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,{},d)}}function iy(r,e){for(let o=0;o<r.length;o++)if(rc(e,r[o]))return!0;for(let o=0;o<e.length;o++)if(rc(r,e[o]))return!0;return!!Lf(r,e)}function Nx(r,e,o){return!!rc(r,e)||!!zf(e,r,o)}function ry(r,e){if(r.length===1)return sy(e,r[0]);for(let o=0;o<e.length;o++){const c=e[o];for(let d=0;d<c.length;d++)if(rc(r,c[d]))return!0}for(let o=0;o<r.length;o++)if(sy(e,r[o]))return!0;for(let o=0;o<e.length;o++)if(Lf(r,e[o]))return!0;return!1}function Ux(r,e,o){if(r.length>1){if(Lf(r,e))return!0;for(let c=0;c<e.length;c++)if(zf(e[c],r,o))return!0}for(let c=0;c<r.length;c++)if(zf(r[c],e,o))return!0;return!1}function Lf(r,e){if(r.length===0||e.length===0)return!1;for(let o=0;o<r.length-1;o++){const c=r[o],d=r[o+1];for(let m=0;m<e.length-1;m++)if(Vx(c,d,e[m],e[m+1]))return!0}return!1}function Vx(r,e,o,c){return he(r,o,c)!==he(e,o,c)&&he(r,e,o)!==he(r,e,c)}function zf(r,e,o){const c=o*o;if(e.length===1)return r.distSqr(e[0])<c;for(let d=1;d<e.length;d++)if(ny(r,e[d-1],e[d])<c)return!0;return!1}function ny(r,e,o){const c=e.distSqr(o);if(c===0)return r.distSqr(e);const d=((r.x-e.x)*(o.x-e.x)+(r.y-e.y)*(o.y-e.y))/c;return r.distSqr(d<0?e:d>1?o:o.sub(e)._mult(d)._add(e))}function sy(r,e){let o,c,d,m=!1;for(let y=0;y<r.length;y++){o=r[y];for(let b=0,S=o.length-1;b<o.length;S=b++)c=o[b],d=o[S],c.y>e.y!=d.y>e.y&&e.x<(d.x-c.x)*(e.y-c.y)/(d.y-c.y)+c.x&&(m=!m)}return m}function rc(r,e){let o=!1;for(let c=0,d=r.length-1;c<r.length;d=c++){const m=r[c],y=r[d];m.y>e.y!=y.y>e.y&&e.x<(y.x-m.x)*(e.y-m.y)/(y.y-m.y)+m.x&&(o=!o)}return o}function $x(r,e,o){const c=o[0],d=o[2];if(r.x<c.x&&e.x<c.x||r.x>d.x&&e.x>d.x||r.y<c.y&&e.y<c.y||r.y>d.y&&e.y>d.y)return!1;const m=he(r,e,o[0]);return m!==he(r,e,o[1])||m!==he(r,e,o[2])||m!==he(r,e,o[3])}function Ou(r,e,o){const c=e.paint.get(r).value;return c.kind==="constant"?c.value:o.programConfigurations.get(e.id).getMaxValue(r)}function Sd(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Id(r,e,o,c,d){if(!e[0]&&!e[1])return r;const m=W.convert(e)._mult(d);o==="viewport"&&m._rotate(-c);const y=[];for(let b=0;b<r.length;b++)y.push(r[b].sub(m));return y}let oy,ay;le("CircleBucket",Pf,{omit:["layers"]});var jx={get paint(){return ay=ay||new xr({"circle-radius":new Ae(Tt.paint_circle["circle-radius"]),"circle-color":new Ae(Tt.paint_circle["circle-color"]),"circle-blur":new Ae(Tt.paint_circle["circle-blur"]),"circle-opacity":new Ae(Tt.paint_circle["circle-opacity"]),"circle-translate":new be(Tt.paint_circle["circle-translate"]),"circle-translate-anchor":new be(Tt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new be(Tt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new be(Tt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ae(Tt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ae(Tt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ae(Tt.paint_circle["circle-stroke-opacity"])})},get layout(){return oy=oy||new xr({"circle-sort-key":new Ae(Tt.layout_circle["circle-sort-key"])})}},An=1e-6,nc=typeof Float32Array<"u"?Float32Array:Array;function Bf(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function ly(r,e,o){var c=e[0],d=e[1],m=e[2],y=e[3],b=e[4],S=e[5],k=e[6],C=e[7],L=e[8],B=e[9],O=e[10],N=e[11],q=e[12],X=e[13],et=e[14],dt=e[15],ot=o[0],mt=o[1],vt=o[2],Dt=o[3];return r[0]=ot*c+mt*b+vt*L+Dt*q,r[1]=ot*d+mt*S+vt*B+Dt*X,r[2]=ot*m+mt*k+vt*O+Dt*et,r[3]=ot*y+mt*C+vt*N+Dt*dt,r[4]=(ot=o[4])*c+(mt=o[5])*b+(vt=o[6])*L+(Dt=o[7])*q,r[5]=ot*d+mt*S+vt*B+Dt*X,r[6]=ot*m+mt*k+vt*O+Dt*et,r[7]=ot*y+mt*C+vt*N+Dt*dt,r[8]=(ot=o[8])*c+(mt=o[9])*b+(vt=o[10])*L+(Dt=o[11])*q,r[9]=ot*d+mt*S+vt*B+Dt*X,r[10]=ot*m+mt*k+vt*O+Dt*et,r[11]=ot*y+mt*C+vt*N+Dt*dt,r[12]=(ot=o[12])*c+(mt=o[13])*b+(vt=o[14])*L+(Dt=o[15])*q,r[13]=ot*d+mt*S+vt*B+Dt*X,r[14]=ot*m+mt*k+vt*O+Dt*et,r[15]=ot*y+mt*C+vt*N+Dt*dt,r}Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});var Nu,qx=ly;function Td(r,e,o){var c=e[0],d=e[1],m=e[2],y=e[3];return r[0]=o[0]*c+o[4]*d+o[8]*m+o[12]*y,r[1]=o[1]*c+o[5]*d+o[9]*m+o[13]*y,r[2]=o[2]*c+o[6]*d+o[10]*m+o[14]*y,r[3]=o[3]*c+o[7]*d+o[11]*m+o[15]*y,r}Nu=new nc(4),nc!=Float32Array&&(Nu[0]=0,Nu[1]=0,Nu[2]=0,Nu[3]=0);class Gx extends es{constructor(e){super(e,jx)}createBucket(e){return new Pf(e)}queryRadius(e){const o=e;return Ou("circle-radius",this,o)+Ou("circle-stroke-width",this,o)+Sd(this.paint.get("circle-translate"))}queryIntersectsFeature(e,o,c,d,m,y,b,S){const k=Id(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,b),C=this.paint.get("circle-radius").evaluate(o,c)+this.paint.get("circle-stroke-width").evaluate(o,c),L=this.paint.get("circle-pitch-alignment")==="map",B=L?k:function(N,q){return N.map(X=>cy(X,q))}(k,S),O=L?C*b:C;for(const N of d)for(const q of N){const X=L?q:cy(q,S);let et=O;const dt=Td([],[q.x,q.y,0,1],S);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?et*=dt[3]/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(et*=y.cameraToCenterDistance/dt[3]),Nx(B,X,et))return!0}return!1}}function cy(r,e){const o=Td([],[r.x,r.y,0,1],e);return new W(o[0]/o[3],o[1]/o[3])}class uy extends Pf{}let hy;le("HeatmapBucket",uy,{omit:["layers"]});var Zx={get paint(){return hy=hy||new xr({"heatmap-radius":new Ae(Tt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ae(Tt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new be(Tt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Mu(Tt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new be(Tt.paint_heatmap["heatmap-opacity"])})}};function Rf(r,{width:e,height:o},c,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==e*o*c)throw new RangeError(`mismatched image size. expected: ${d.length} but got: ${e*o*c}`)}else d=new Uint8Array(e*o*c);return r.width=e,r.height=o,r.data=d,r}function dy(r,{width:e,height:o},c){if(e===r.width&&o===r.height)return;const d=Rf({},{width:e,height:o},c);Ff(r,d,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,e),height:Math.min(r.height,o)},c),r.width=e,r.height=o,r.data=d.data}function Ff(r,e,o,c,d,m){if(d.width===0||d.height===0)return e;if(d.width>r.width||d.height>r.height||o.x>r.width-d.width||o.y>r.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>e.width||d.height>e.height||c.x>e.width-d.width||c.y>e.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const y=r.data,b=e.data;if(y===b)throw new Error("srcData equals dstData, so image is already copied");for(let S=0;S<d.height;S++){const k=((o.y+S)*r.width+o.x)*m,C=((c.y+S)*e.width+c.x)*m;for(let L=0;L<d.width*m;L++)b[C+L]=y[k+L]}return e}class Uu{constructor(e,o){Rf(this,e,1,o)}resize(e){dy(this,e,1)}clone(){return new Uu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,o,c,d,m){Ff(e,o,c,d,m,1)}}class hs{constructor(e,o){Rf(this,e,4,o)}resize(e){dy(this,e,4)}replace(e,o){o?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new hs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,o,c,d,m){Ff(e,o,c,d,m,4)}}function py(r){const e={},o=r.resolution||256,c=r.clips?r.clips.length:1,d=r.image||new hs({width:o,height:c});if(Math.log(o)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${o}`);const m=(y,b,S)=>{e[r.evaluationKey]=S;const k=r.expression.evaluate(e);d.data[y+b+0]=Math.floor(255*k.r/k.a),d.data[y+b+1]=Math.floor(255*k.g/k.a),d.data[y+b+2]=Math.floor(255*k.b/k.a),d.data[y+b+3]=Math.floor(255*k.a)};if(r.clips)for(let y=0,b=0;y<c;++y,b+=4*o)for(let S=0,k=0;S<o;S++,k+=4){const C=S/(o-1),{start:L,end:B}=r.clips[y];m(b,k,L*(1-C)+B*C)}else for(let y=0,b=0;y<o;y++,b+=4)m(0,b,y/(o-1));return d}le("AlphaImage",Uu),le("RGBAImage",hs);class Wx extends es{createBucket(e){return new uy(e)}constructor(e){super(e,Zx),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=py({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let fy;var Hx={get paint(){return fy=fy||new xr({"hillshade-illumination-direction":new be(Tt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new be(Tt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new be(Tt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new be(Tt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new be(Tt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new be(Tt.paint_hillshade["hillshade-accent-color"])})}};class Yx extends es{constructor(e){super(e,Hx)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Kx=or([{name:"a_pos",components:2,type:"Int16"}],4),{members:Xx}=Kx;var Of={exports:{}};function kd(r,e,o){o=o||2;var c,d,m,y,b,S,k,C=e&&e.length,L=C?e[0]*o:r.length,B=my(r,0,L,o,!0),O=[];if(!B||B.next===B.prev)return O;if(C&&(B=function(q,X,et,dt){var ot,mt,vt,Dt=[];for(ot=0,mt=X.length;ot<mt;ot++)(vt=my(q,X[ot]*dt,ot<mt-1?X[ot+1]*dt:q.length,dt,!1))===vt.next&&(vt.steiner=!0),Dt.push(sw(vt));for(Dt.sort(iw),ot=0;ot<Dt.length;ot++)et=rw(Dt[ot],et);return et}(r,e,B,o)),r.length>80*o){c=m=r[0],d=y=r[1];for(var N=o;N<L;N+=o)(b=r[N])<c&&(c=b),(S=r[N+1])<d&&(d=S),b>m&&(m=b),S>y&&(y=S);k=(k=Math.max(m-c,y-d))!==0?32767/k:0}return Vu(B,O,o,c,d,k,0),O}function my(r,e,o,c,d){var m,y;if(d===Vf(r,e,o,c)>0)for(m=e;m<o;m+=c)y=_y(m,r[m],r[m+1],y);else for(m=o-c;m>=e;m-=c)y=_y(m,r[m],r[m+1],y);return y&&Ad(y,y.next)&&(ju(y),y=y.next),y}function hl(r,e){if(!r)return r;e||(e=r);var o,c=r;do if(o=!1,c.steiner||!Ad(c,c.next)&&Sr(c.prev,c,c.next)!==0)c=c.next;else{if(ju(c),(c=e=c.prev)===c.next)break;o=!0}while(o||c!==e);return e}function Vu(r,e,o,c,d,m,y){if(r){!y&&m&&function(C,L,B,O){var N=C;do N.z===0&&(N.z=Nf(N.x,N.y,L,B,O)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next;while(N!==C);N.prevZ.nextZ=null,N.prevZ=null,function(q){var X,et,dt,ot,mt,vt,Dt,ee,fe=1;do{for(et=q,q=null,mt=null,vt=0;et;){for(vt++,dt=et,Dt=0,X=0;X<fe&&(Dt++,dt=dt.nextZ);X++);for(ee=fe;Dt>0||ee>0&&dt;)Dt!==0&&(ee===0||!dt||et.z<=dt.z)?(ot=et,et=et.nextZ,Dt--):(ot=dt,dt=dt.nextZ,ee--),mt?mt.nextZ=ot:q=ot,ot.prevZ=mt,mt=ot;et=dt}mt.nextZ=null,fe*=2}while(vt>1)}(N)}(r,c,d,m);for(var b,S,k=r;r.prev!==r.next;)if(b=r.prev,S=r.next,m?Qx(r,c,d,m):Jx(r))e.push(b.i/o|0),e.push(r.i/o|0),e.push(S.i/o|0),ju(r),r=S.next,k=S.next;else if((r=S)===k){y?y===1?Vu(r=tw(hl(r),e,o),e,o,c,d,m,2):y===2&&ew(r,e,o,c,d,m):Vu(hl(r),e,o,c,d,m,1);break}}}function Jx(r){var e=r.prev,o=r,c=r.next;if(Sr(e,o,c)>=0)return!1;for(var d=e.x,m=o.x,y=c.x,b=e.y,S=o.y,k=c.y,C=d<m?d<y?d:y:m<y?m:y,L=b<S?b<k?b:k:S<k?S:k,B=d>m?d>y?d:y:m>y?m:y,O=b>S?b>k?b:k:S>k?S:k,N=c.next;N!==e;){if(N.x>=C&&N.x<=B&&N.y>=L&&N.y<=O&&sc(d,b,m,S,y,k,N.x,N.y)&&Sr(N.prev,N,N.next)>=0)return!1;N=N.next}return!0}function Qx(r,e,o,c){var d=r.prev,m=r,y=r.next;if(Sr(d,m,y)>=0)return!1;for(var b=d.x,S=m.x,k=y.x,C=d.y,L=m.y,B=y.y,O=b<S?b<k?b:k:S<k?S:k,N=C<L?C<B?C:B:L<B?L:B,q=b>S?b>k?b:k:S>k?S:k,X=C>L?C>B?C:B:L>B?L:B,et=Nf(O,N,e,o,c),dt=Nf(q,X,e,o,c),ot=r.prevZ,mt=r.nextZ;ot&&ot.z>=et&&mt&&mt.z<=dt;){if(ot.x>=O&&ot.x<=q&&ot.y>=N&&ot.y<=X&&ot!==d&&ot!==y&&sc(b,C,S,L,k,B,ot.x,ot.y)&&Sr(ot.prev,ot,ot.next)>=0||(ot=ot.prevZ,mt.x>=O&&mt.x<=q&&mt.y>=N&&mt.y<=X&&mt!==d&&mt!==y&&sc(b,C,S,L,k,B,mt.x,mt.y)&&Sr(mt.prev,mt,mt.next)>=0))return!1;mt=mt.nextZ}for(;ot&&ot.z>=et;){if(ot.x>=O&&ot.x<=q&&ot.y>=N&&ot.y<=X&&ot!==d&&ot!==y&&sc(b,C,S,L,k,B,ot.x,ot.y)&&Sr(ot.prev,ot,ot.next)>=0)return!1;ot=ot.prevZ}for(;mt&&mt.z<=dt;){if(mt.x>=O&&mt.x<=q&&mt.y>=N&&mt.y<=X&&mt!==d&&mt!==y&&sc(b,C,S,L,k,B,mt.x,mt.y)&&Sr(mt.prev,mt,mt.next)>=0)return!1;mt=mt.nextZ}return!0}function tw(r,e,o){var c=r;do{var d=c.prev,m=c.next.next;!Ad(d,m)&&gy(d,c,c.next,m)&&$u(d,m)&&$u(m,d)&&(e.push(d.i/o|0),e.push(c.i/o|0),e.push(m.i/o|0),ju(c),ju(c.next),c=r=m),c=c.next}while(c!==r);return hl(c)}function ew(r,e,o,c,d,m){var y=r;do{for(var b=y.next.next;b!==y.prev;){if(y.i!==b.i&&ow(y,b)){var S=yy(y,b);return y=hl(y,y.next),S=hl(S,S.next),Vu(y,e,o,c,d,m,0),void Vu(S,e,o,c,d,m,0)}b=b.next}y=y.next}while(y!==r)}function iw(r,e){return r.x-e.x}function rw(r,e){var o=function(d,m){var y,b=m,S=d.x,k=d.y,C=-1/0;do{if(k<=b.y&&k>=b.next.y&&b.next.y!==b.y){var L=b.x+(k-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(L<=S&&L>C&&(C=L,y=b.x<b.next.x?b:b.next,L===S))return y}b=b.next}while(b!==m);if(!y)return null;var B,O=y,N=y.x,q=y.y,X=1/0;b=y;do S>=b.x&&b.x>=N&&S!==b.x&&sc(k<q?S:C,k,N,q,k<q?C:S,k,b.x,b.y)&&(B=Math.abs(k-b.y)/(S-b.x),$u(b,d)&&(B<X||B===X&&(b.x>y.x||b.x===y.x&&nw(y,b)))&&(y=b,X=B)),b=b.next;while(b!==O);return y}(r,e);if(!o)return e;var c=yy(o,r);return hl(c,c.next),hl(o,o.next)}function nw(r,e){return Sr(r.prev,r,e.prev)<0&&Sr(e.next,r,r.next)<0}function Nf(r,e,o,c,d){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-o)*d|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-c)*d|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function sw(r){var e=r,o=r;do(e.x<o.x||e.x===o.x&&e.y<o.y)&&(o=e),e=e.next;while(e!==r);return o}function sc(r,e,o,c,d,m,y,b){return(d-y)*(e-b)>=(r-y)*(m-b)&&(r-y)*(c-b)>=(o-y)*(e-b)&&(o-y)*(m-b)>=(d-y)*(c-b)}function ow(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(o,c){var d=o;do{if(d.i!==o.i&&d.next.i!==o.i&&d.i!==c.i&&d.next.i!==c.i&&gy(d,d.next,o,c))return!0;d=d.next}while(d!==o);return!1}(r,e)&&($u(r,e)&&$u(e,r)&&function(o,c){var d=o,m=!1,y=(o.x+c.x)/2,b=(o.y+c.y)/2;do d.y>b!=d.next.y>b&&d.next.y!==d.y&&y<(d.next.x-d.x)*(b-d.y)/(d.next.y-d.y)+d.x&&(m=!m),d=d.next;while(d!==o);return m}(r,e)&&(Sr(r.prev,r,e.prev)||Sr(r,e.prev,e))||Ad(r,e)&&Sr(r.prev,r,r.next)>0&&Sr(e.prev,e,e.next)>0)}function Sr(r,e,o){return(e.y-r.y)*(o.x-e.x)-(e.x-r.x)*(o.y-e.y)}function Ad(r,e){return r.x===e.x&&r.y===e.y}function gy(r,e,o,c){var d=Cd(Sr(r,e,o)),m=Cd(Sr(r,e,c)),y=Cd(Sr(o,c,r)),b=Cd(Sr(o,c,e));return d!==m&&y!==b||!(d!==0||!Ed(r,o,e))||!(m!==0||!Ed(r,c,e))||!(y!==0||!Ed(o,r,c))||!(b!==0||!Ed(o,e,c))}function Ed(r,e,o){return e.x<=Math.max(r.x,o.x)&&e.x>=Math.min(r.x,o.x)&&e.y<=Math.max(r.y,o.y)&&e.y>=Math.min(r.y,o.y)}function Cd(r){return r>0?1:r<0?-1:0}function $u(r,e){return Sr(r.prev,r,r.next)<0?Sr(r,e,r.next)>=0&&Sr(r,r.prev,e)>=0:Sr(r,e,r.prev)<0||Sr(r,r.next,e)<0}function yy(r,e){var o=new Uf(r.i,r.x,r.y),c=new Uf(e.i,e.x,e.y),d=r.next,m=e.prev;return r.next=e,e.prev=r,o.next=d,d.prev=o,c.next=o,o.prev=c,m.next=c,c.prev=m,c}function _y(r,e,o,c){var d=new Uf(r,e,o);return c?(d.next=c.next,d.prev=c,c.next.prev=d,c.next=d):(d.prev=d,d.next=d),d}function ju(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Uf(r,e,o){this.i=r,this.x=e,this.y=o,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Vf(r,e,o,c){for(var d=0,m=e,y=o-c;m<o;m+=c)d+=(r[y]-r[m])*(r[m+1]+r[y+1]),y=m;return d}Of.exports=kd,Of.exports.default=kd,kd.deviation=function(r,e,o,c){var d=e&&e.length,m=Math.abs(Vf(r,0,d?e[0]*o:r.length,o));if(d)for(var y=0,b=e.length;y<b;y++)m-=Math.abs(Vf(r,e[y]*o,y<b-1?e[y+1]*o:r.length,o));var S=0;for(y=0;y<c.length;y+=3){var k=c[y]*o,C=c[y+1]*o,L=c[y+2]*o;S+=Math.abs((r[k]-r[L])*(r[C+1]-r[k+1])-(r[k]-r[C])*(r[L+1]-r[k+1]))}return m===0&&S===0?0:Math.abs((S-m)/m)},kd.flatten=function(r){for(var e=r[0][0].length,o={vertices:[],holes:[],dimensions:e},c=0,d=0;d<r.length;d++){for(var m=0;m<r[d].length;m++)for(var y=0;y<e;y++)o.vertices.push(r[d][m][y]);d>0&&o.holes.push(c+=r[d-1].length)}return o};var vy=E(Of.exports);function aw(r,e,o,c,d){by(r,e,o,c||r.length-1,d||lw)}function by(r,e,o,c,d){for(;c>o;){if(c-o>600){var m=c-o+1,y=e-o+1,b=Math.log(m),S=.5*Math.exp(2*b/3),k=.5*Math.sqrt(b*S*(m-S)/m)*(y-m/2<0?-1:1);by(r,e,Math.max(o,Math.floor(e-y*S/m+k)),Math.min(c,Math.floor(e+(m-y)*S/m+k)),d)}var C=r[e],L=o,B=c;for(qu(r,o,e),d(r[c],C)>0&&qu(r,o,c);L<B;){for(qu(r,L,B),L++,B--;d(r[L],C)<0;)L++;for(;d(r[B],C)>0;)B--}d(r[o],C)===0?qu(r,o,B):qu(r,++B,c),B<=e&&(o=B+1),e<=B&&(c=B-1)}}function qu(r,e,o){var c=r[e];r[e]=r[o],r[o]=c}function lw(r,e){return r<e?-1:r>e?1:0}function $f(r,e){const o=r.length;if(o<=1)return[r];const c=[];let d,m;for(let y=0;y<o;y++){const b=ve(r[y]);b!==0&&(r[y].area=Math.abs(b),m===void 0&&(m=b<0),m===b<0?(d&&c.push(d),d=[r[y]]):d.push(r[y]))}if(d&&c.push(d),e>1)for(let y=0;y<c.length;y++)c[y].length<=e||(aw(c[y],e,1,c[y].length-1,cw),c[y]=c[y].slice(0,e));return c}function cw(r,e){return e.area-r.area}function jf(r,e,o){const c=o.patternDependencies;let d=!1;for(const m of e){const y=m.paint.get(`${r}-pattern`);y.isConstant()||(d=!0);const b=y.constantOr(null);b&&(d=!0,c[b.to]=!0,c[b.from]=!0)}return d}function qf(r,e,o,c,d){const m=d.patternDependencies;for(const y of e){const b=y.paint.get(`${r}-pattern`).value;if(b.kind!=="constant"){let S=b.evaluate({zoom:c-1},o,{},d.availableImages),k=b.evaluate({zoom:c},o,{},d.availableImages),C=b.evaluate({zoom:c+1},o,{},d.availableImages);S=S&&S.name?S.name:S,k=k&&k.name?k.name:k,C=C&&C.name?C.name:C,m[S]=!0,m[k]=!0,m[C]=!0,o.patterns[y.id]={min:S,mid:k,max:C}}}return o}class Gf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ri,this.indexArray=new Yr,this.indexArray2=new Lr,this.programConfigurations=new Gs(e.layers,e.zoom),this.segments=new Hi,this.segments2=new Hi,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(e,o,c){this.hasPattern=jf("fill",this.layers,o);const d=this.layers[0].layout.get("fill-sort-key"),m=!d.isConstant(),y=[];for(const{feature:b,id:S,index:k,sourceLayerIndex:C}of e){const L=this.layers[0]._featureFilter.needGeometry,B=ul(b,L);if(!this.layers[0]._featureFilter.filter(new Wi(this.zoom),B,c))continue;const O=m?d.evaluate(B,{},c,o.availableImages):void 0,N={id:S,properties:b.properties,type:b.type,sourceLayerIndex:C,index:k,geometry:L?B.geometry:cl(b),patterns:{},sortKey:O};y.push(N)}m&&y.sort((b,S)=>b.sortKey-S.sortKey);for(const b of y){const{geometry:S,index:k,sourceLayerIndex:C}=b;if(this.hasPattern){const L=qf("fill",this.layers,b,this.zoom,o);this.patternFeatures.push(L)}else this.addFeature(b,S,k,c,{});o.featureIndex.insert(e[k].feature,S,k,C,this.index)}}update(e,o,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,o,this.stateDependentLayers,c)}addFeatures(e,o,c){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,o,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Xx),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,o,c,d,m){for(const y of $f(o,500)){let b=0;for(const O of y)b+=O.length;const S=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),k=S.vertexLength,C=[],L=[];for(const O of y){if(O.length===0)continue;O!==y[0]&&L.push(C.length/2);const N=this.segments2.prepareSegment(O.length,this.layoutVertexArray,this.indexArray2),q=N.vertexLength;this.layoutVertexArray.emplaceBack(O[0].x,O[0].y),this.indexArray2.emplaceBack(q+O.length-1,q),C.push(O[0].x),C.push(O[0].y);for(let X=1;X<O.length;X++)this.layoutVertexArray.emplaceBack(O[X].x,O[X].y),this.indexArray2.emplaceBack(q+X-1,q+X),C.push(O[X].x),C.push(O[X].y);N.vertexLength+=O.length,N.primitiveLength+=O.length}const B=vy(C,L);for(let O=0;O<B.length;O+=3)this.indexArray.emplaceBack(k+B[O],k+B[O+1],k+B[O+2]);S.vertexLength+=b,S.primitiveLength+=B.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,m,d)}}let xy,wy;le("FillBucket",Gf,{omit:["layers","patternFeatures"]});var uw={get paint(){return wy=wy||new xr({"fill-antialias":new be(Tt.paint_fill["fill-antialias"]),"fill-opacity":new Ae(Tt.paint_fill["fill-opacity"]),"fill-color":new Ae(Tt.paint_fill["fill-color"]),"fill-outline-color":new Ae(Tt.paint_fill["fill-outline-color"]),"fill-translate":new be(Tt.paint_fill["fill-translate"]),"fill-translate-anchor":new be(Tt.paint_fill["fill-translate-anchor"]),"fill-pattern":new ol(Tt.paint_fill["fill-pattern"])})},get layout(){return xy=xy||new xr({"fill-sort-key":new Ae(Tt.layout_fill["fill-sort-key"])})}};class hw extends es{constructor(e){super(e,uw)}recalculate(e,o){super.recalculate(e,o);const c=this.paint._values["fill-outline-color"];c.value.kind==="constant"&&c.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Gf(e)}queryRadius(){return Sd(this.paint.get("fill-translate"))}queryIntersectsFeature(e,o,c,d,m,y,b){return ry(Id(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,b),d)}isTileClipped(){return!0}}const dw=or([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),pw=or([{name:"a_centroid",components:2,type:"Int16"}],4),{members:fw}=dw;var xa={},mw=U,Sy=oc;function oc(r,e,o,c,d){this.properties={},this.extent=o,this.type=0,this._pbf=r,this._geometry=-1,this._keys=c,this._values=d,r.readFields(gw,this,e)}function gw(r,e,o){r==1?e.id=o.readVarint():r==2?function(c,d){for(var m=c.readVarint()+c.pos;c.pos<m;){var y=d._keys[c.readVarint()],b=d._values[c.readVarint()];d.properties[y]=b}}(o,e):r==3?e.type=o.readVarint():r==4&&(e._geometry=o.pos)}function yw(r){for(var e,o,c=0,d=0,m=r.length,y=m-1;d<m;y=d++)c+=((o=r[y]).x-(e=r[d]).x)*(e.y+o.y);return c}oc.types=["Unknown","Point","LineString","Polygon"],oc.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var e,o=r.readVarint()+r.pos,c=1,d=0,m=0,y=0,b=[];r.pos<o;){if(d<=0){var S=r.readVarint();c=7&S,d=S>>3}if(d--,c===1||c===2)m+=r.readSVarint(),y+=r.readSVarint(),c===1&&(e&&b.push(e),e=[]),e.push(new mw(m,y));else{if(c!==7)throw new Error("unknown command "+c);e&&e.push(e[0].clone())}}return e&&b.push(e),b},oc.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var e=r.readVarint()+r.pos,o=1,c=0,d=0,m=0,y=1/0,b=-1/0,S=1/0,k=-1/0;r.pos<e;){if(c<=0){var C=r.readVarint();o=7&C,c=C>>3}if(c--,o===1||o===2)(d+=r.readSVarint())<y&&(y=d),d>b&&(b=d),(m+=r.readSVarint())<S&&(S=m),m>k&&(k=m);else if(o!==7)throw new Error("unknown command "+o)}return[y,S,b,k]},oc.prototype.toGeoJSON=function(r,e,o){var c,d,m=this.extent*Math.pow(2,o),y=this.extent*r,b=this.extent*e,S=this.loadGeometry(),k=oc.types[this.type];function C(O){for(var N=0;N<O.length;N++){var q=O[N];O[N]=[360*(q.x+y)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(q.y+b)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var L=[];for(c=0;c<S.length;c++)L[c]=S[c][0];C(S=L);break;case 2:for(c=0;c<S.length;c++)C(S[c]);break;case 3:for(S=function(O){var N=O.length;if(N<=1)return[O];for(var q,X,et=[],dt=0;dt<N;dt++){var ot=yw(O[dt]);ot!==0&&(X===void 0&&(X=ot<0),X===ot<0?(q&&et.push(q),q=[O[dt]]):q.push(O[dt]))}return q&&et.push(q),et}(S),c=0;c<S.length;c++)for(d=0;d<S[c].length;d++)C(S[c][d])}S.length===1?S=S[0]:k="Multi"+k;var B={type:"Feature",geometry:{type:k,coordinates:S},properties:this.properties};return"id"in this&&(B.id=this.id),B};var _w=Sy,Iy=Ty;function Ty(r,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(vw,this,e),this.length=this._features.length}function vw(r,e,o){r===15?e.version=o.readVarint():r===1?e.name=o.readString():r===5?e.extent=o.readVarint():r===2?e._features.push(o.pos):r===3?e._keys.push(o.readString()):r===4&&e._values.push(function(c){for(var d=null,m=c.readVarint()+c.pos;c.pos<m;){var y=c.readVarint()>>3;d=y===1?c.readString():y===2?c.readFloat():y===3?c.readDouble():y===4?c.readVarint64():y===5?c.readVarint():y===6?c.readSVarint():y===7?c.readBoolean():null}return d}(o))}Ty.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var e=this._pbf.readVarint()+this._pbf.pos;return new _w(this._pbf,e,this.extent,this._keys,this._values)};var bw=Iy;function xw(r,e,o){if(r===3){var c=new bw(o,o.readVarint()+o.pos);c.length&&(e[c.name]=c)}}xa.VectorTile=function(r,e){this.layers=r.readFields(xw,{},e)},xa.VectorTileFeature=Sy,xa.VectorTileLayer=Iy;const ww=xa.VectorTileFeature.types,Zf=Math.pow(2,13);function Gu(r,e,o,c,d,m,y,b){r.emplaceBack(e,o,2*Math.floor(c*Zf)+y,d*Zf*2,m*Zf*2,Math.round(b))}class Wf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Yt,this.centroidVertexArray=new $t,this.indexArray=new Yr,this.programConfigurations=new Gs(e.layers,e.zoom),this.segments=new Hi,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(e,o,c){this.features=[],this.hasPattern=jf("fill-extrusion",this.layers,o);for(const{feature:d,id:m,index:y,sourceLayerIndex:b}of e){const S=this.layers[0]._featureFilter.needGeometry,k=ul(d,S);if(!this.layers[0]._featureFilter.filter(new Wi(this.zoom),k,c))continue;const C={id:m,sourceLayerIndex:b,index:y,geometry:S?k.geometry:cl(d),properties:d.properties,type:d.type,patterns:{}};this.hasPattern?this.features.push(qf("fill-extrusion",this.layers,C,this.zoom,o)):this.addFeature(C,C.geometry,y,c,{}),o.featureIndex.insert(d,C.geometry,y,b,this.index,!0)}}addFeatures(e,o,c){for(const d of this.features){const{geometry:m}=d;this.addFeature(d,m,d.index,o,c)}}update(e,o,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,o,this.stateDependentLayers,c)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,fw),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,pw.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,o,c,d,m){const y={x:0,y:0,vertexCount:0};for(const b of $f(o,500)){let S=0;for(const N of b)S+=N.length;let k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const N of b){if(N.length===0||Iw(N))continue;let q=0;for(let X=0;X<N.length;X++){const et=N[X];if(X>=1){const dt=N[X-1];if(!Sw(et,dt)){k.vertexLength+4>Hi.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ot=et.sub(dt)._perp()._unit(),mt=dt.dist(et);q+mt>32768&&(q=0),Gu(this.layoutVertexArray,et.x,et.y,ot.x,ot.y,0,0,q),Gu(this.layoutVertexArray,et.x,et.y,ot.x,ot.y,0,1,q),y.x+=2*et.x,y.y+=2*et.y,y.vertexCount+=2,q+=mt,Gu(this.layoutVertexArray,dt.x,dt.y,ot.x,ot.y,0,0,q),Gu(this.layoutVertexArray,dt.x,dt.y,ot.x,ot.y,0,1,q),y.x+=2*dt.x,y.y+=2*dt.y,y.vertexCount+=2;const vt=k.vertexLength;this.indexArray.emplaceBack(vt,vt+2,vt+1),this.indexArray.emplaceBack(vt+1,vt+2,vt+3),k.vertexLength+=4,k.primitiveLength+=2}}}}if(k.vertexLength+S>Hi.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray)),ww[e.type]!=="Polygon")continue;const C=[],L=[],B=k.vertexLength;for(const N of b)if(N.length!==0){N!==b[0]&&L.push(C.length/2);for(let q=0;q<N.length;q++){const X=N[q];Gu(this.layoutVertexArray,X.x,X.y,0,0,1,1,0),y.x+=X.x,y.y+=X.y,y.vertexCount+=1,C.push(X.x),C.push(X.y)}}const O=vy(C,L);for(let N=0;N<O.length;N+=3)this.indexArray.emplaceBack(B+O[N],B+O[N+2],B+O[N+1]);k.primitiveLength+=O.length/3,k.vertexLength+=S}for(let b=0;b<y.vertexCount;b++)this.centroidVertexArray.emplaceBack(Math.floor(y.x/y.vertexCount),Math.floor(y.y/y.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,m,d)}}function Sw(r,e){return r.x===e.x&&(r.x<0||r.x>Cr)||r.y===e.y&&(r.y<0||r.y>Cr)}function Iw(r){return r.every(e=>e.x<0)||r.every(e=>e.x>Cr)||r.every(e=>e.y<0)||r.every(e=>e.y>Cr)}let ky;le("FillExtrusionBucket",Wf,{omit:["layers","features"]});var Tw={get paint(){return ky=ky||new xr({"fill-extrusion-opacity":new be(Tt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ae(Tt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new be(Tt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new be(Tt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ol(Tt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ae(Tt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ae(Tt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new be(Tt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class kw extends es{constructor(e){super(e,Tw)}createBucket(e){return new Wf(e)}queryRadius(){return Sd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,o,c,d,m,y,b,S){const k=Id(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,b),C=this.paint.get("fill-extrusion-height").evaluate(o,c),L=this.paint.get("fill-extrusion-base").evaluate(o,c),B=function(N,q,X,et){const dt=[];for(const ot of N){const mt=[ot.x,ot.y,0,1];Td(mt,mt,q),dt.push(new W(mt[0]/mt[3],mt[1]/mt[3]))}return dt}(k,S),O=function(N,q,X,et){const dt=[],ot=[],mt=et[8]*q,vt=et[9]*q,Dt=et[10]*q,ee=et[11]*q,fe=et[8]*X,Jt=et[9]*X,Kt=et[10]*X,qt=et[11]*X;for(const ce of N){const Zt=[],Nt=[];for(const Ie of ce){const _e=Ie.x,ei=Ie.y,Yi=et[0]*_e+et[4]*ei+et[12],tr=et[1]*_e+et[5]*ei+et[13],Rr=et[2]*_e+et[6]*ei+et[14],rs=et[3]*_e+et[7]*ei+et[15],En=Rr+Dt,Mr=rs+ee,Xr=Yi+fe,cn=tr+Jt,Cn=Rr+Kt,Mn=rs+qt,Fr=new W((Yi+mt)/Mr,(tr+vt)/Mr);Fr.z=En/Mr,Zt.push(Fr);const Or=new W(Xr/Mn,cn/Mn);Or.z=Cn/Mn,Nt.push(Or)}dt.push(Zt),ot.push(Nt)}return[dt,ot]}(d,L,C,S);return function(N,q,X){let et=1/0;ry(X,q)&&(et=Ay(X,q[0]));for(let dt=0;dt<q.length;dt++){const ot=q[dt],mt=N[dt];for(let vt=0;vt<ot.length-1;vt++){const Dt=ot[vt],ee=[Dt,ot[vt+1],mt[vt+1],mt[vt],Dt];iy(X,ee)&&(et=Math.min(et,Ay(X,ee)))}}return et!==1/0&&et}(O[0],O[1],B)}}function Zu(r,e){return r.x*e.x+r.y*e.y}function Ay(r,e){if(r.length===1){let o=0;const c=e[o++];let d;for(;!d||c.equals(d);)if(d=e[o++],!d)return 1/0;for(;o<e.length;o++){const m=e[o],y=r[0],b=d.sub(c),S=m.sub(c),k=y.sub(c),C=Zu(b,b),L=Zu(b,S),B=Zu(S,S),O=Zu(k,b),N=Zu(k,S),q=C*B-L*L,X=(B*O-L*N)/q,et=(C*N-L*O)/q,dt=c.z*(1-X-et)+d.z*X+m.z*et;if(isFinite(dt))return dt}return 1/0}{let o=1/0;for(const c of e)o=Math.min(o,c.z);return o}}const Aw=or([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Ew}=Aw,Cw=or([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Mw}=Cw,Dw=xa.VectorTileFeature.types,Pw=Math.cos(Math.PI/180*37.5),Ey=Math.pow(2,14)/.5;class Hf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new Ee,this.layoutVertexArray2=new ge,this.indexArray=new Yr,this.programConfigurations=new Gs(e.layers,e.zoom),this.segments=new Hi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(e,o,c){this.hasPattern=jf("line",this.layers,o);const d=this.layers[0].layout.get("line-sort-key"),m=!d.isConstant(),y=[];for(const{feature:b,id:S,index:k,sourceLayerIndex:C}of e){const L=this.layers[0]._featureFilter.needGeometry,B=ul(b,L);if(!this.layers[0]._featureFilter.filter(new Wi(this.zoom),B,c))continue;const O=m?d.evaluate(B,{},c):void 0,N={id:S,properties:b.properties,type:b.type,sourceLayerIndex:C,index:k,geometry:L?B.geometry:cl(b),patterns:{},sortKey:O};y.push(N)}m&&y.sort((b,S)=>b.sortKey-S.sortKey);for(const b of y){const{geometry:S,index:k,sourceLayerIndex:C}=b;if(this.hasPattern){const L=qf("line",this.layers,b,this.zoom,o);this.patternFeatures.push(L)}else this.addFeature(b,S,k,c,{});o.featureIndex.insert(e[k].feature,S,k,C,this.index)}}update(e,o,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,o,this.stateDependentLayers,c)}addFeatures(e,o,c){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,o,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Mw)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ew),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,o,c,d,m){const y=this.layers[0].layout,b=y.get("line-join").evaluate(e,{}),S=y.get("line-cap"),k=y.get("line-miter-limit"),C=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const L of o)this.addLine(L,e,b,S,k,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,m,d)}addLine(e,o,c,d,m,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let et=0;et<e.length-1;et++)this.totalDistance+=e[et].dist(e[et+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const b=Dw[o.type]==="Polygon";let S=e.length;for(;S>=2&&e[S-1].equals(e[S-2]);)S--;let k=0;for(;k<S-1&&e[k].equals(e[k+1]);)k++;if(S<(b?3:2))return;c==="bevel"&&(m=1.05);const C=this.overscaling<=16?15*Cr/(512*this.overscaling):0,L=this.segments.prepareSegment(10*S,this.layoutVertexArray,this.indexArray);let B,O,N,q,X;this.e1=this.e2=-1,b&&(B=e[S-2],X=e[k].sub(B)._unit()._perp());for(let et=k;et<S;et++){if(N=et===S-1?b?e[k+1]:void 0:e[et+1],N&&e[et].equals(N))continue;X&&(q=X),B&&(O=B),B=e[et],X=N?N.sub(B)._unit()._perp():q,q=q||X;let dt=q.add(X);dt.x===0&&dt.y===0||dt._unit();const ot=q.x*X.x+q.y*X.y,mt=dt.x*X.x+dt.y*X.y,vt=mt!==0?1/mt:1/0,Dt=2*Math.sqrt(2-2*mt),ee=mt<Pw&&O&&N,fe=q.x*X.y-q.y*X.x>0;if(ee&&et>k){const qt=B.dist(O);if(qt>2*C){const ce=B.sub(B.sub(O)._mult(C/qt)._round());this.updateDistance(O,ce),this.addCurrentVertex(ce,q,0,0,L),O=ce}}const Jt=O&&N;let Kt=Jt?c:b?"butt":d;if(Jt&&Kt==="round"&&(vt<y?Kt="miter":vt<=2&&(Kt="fakeround")),Kt==="miter"&&vt>m&&(Kt="bevel"),Kt==="bevel"&&(vt>2&&(Kt="flipbevel"),vt<m&&(Kt="miter")),O&&this.updateDistance(O,B),Kt==="miter")dt._mult(vt),this.addCurrentVertex(B,dt,0,0,L);else if(Kt==="flipbevel"){if(vt>100)dt=X.mult(-1);else{const qt=vt*q.add(X).mag()/q.sub(X).mag();dt._perp()._mult(qt*(fe?-1:1))}this.addCurrentVertex(B,dt,0,0,L),this.addCurrentVertex(B,dt.mult(-1),0,0,L)}else if(Kt==="bevel"||Kt==="fakeround"){const qt=-Math.sqrt(vt*vt-1),ce=fe?qt:0,Zt=fe?0:qt;if(O&&this.addCurrentVertex(B,q,ce,Zt,L),Kt==="fakeround"){const Nt=Math.round(180*Dt/Math.PI/20);for(let Ie=1;Ie<Nt;Ie++){let _e=Ie/Nt;if(_e!==.5){const Yi=_e-.5;_e+=_e*Yi*(_e-1)*((1.0904+ot*(ot*(3.55645-1.43519*ot)-3.2452))*Yi*Yi+(.848013+ot*(.215638*ot-1.06021)))}const ei=X.sub(q)._mult(_e)._add(q)._unit()._mult(fe?-1:1);this.addHalfVertex(B,ei.x,ei.y,!1,fe,0,L)}}N&&this.addCurrentVertex(B,X,-ce,-Zt,L)}else if(Kt==="butt")this.addCurrentVertex(B,dt,0,0,L);else if(Kt==="square"){const qt=O?1:-1;this.addCurrentVertex(B,dt,qt,qt,L)}else Kt==="round"&&(O&&(this.addCurrentVertex(B,q,0,0,L),this.addCurrentVertex(B,q,1,1,L,!0)),N&&(this.addCurrentVertex(B,X,-1,-1,L,!0),this.addCurrentVertex(B,X,0,0,L)));if(ee&&et<S-1){const qt=B.dist(N);if(qt>2*C){const ce=B.add(N.sub(B)._mult(C/qt)._round());this.updateDistance(B,ce),this.addCurrentVertex(ce,X,0,0,L),B=ce}}}}addCurrentVertex(e,o,c,d,m,y=!1){const b=o.y*d-o.x,S=-o.y-o.x*d;this.addHalfVertex(e,o.x+o.y*c,o.y-o.x*c,y,!1,c,m),this.addHalfVertex(e,b,S,y,!0,-d,m),this.distance>Ey/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,o,c,d,m,y))}addHalfVertex({x:e,y:o},c,d,m,y,b,S){const k=.5*(this.lineClips?this.scaledDistance*(Ey-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(o<<1)+(y?1:0),Math.round(63*c)+128,Math.round(63*d)+128,1+(b===0?0:b<0?-1:1)|(63&k)<<2,k>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const C=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,C),S.primitiveLength++),y?this.e2=C:this.e1=C}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,o){this.distance+=e.dist(o),this.updateScaledDistance()}}let Cy,My;le("LineBucket",Hf,{omit:["layers","patternFeatures"]});var Dy={get paint(){return My=My||new xr({"line-opacity":new Ae(Tt.paint_line["line-opacity"]),"line-color":new Ae(Tt.paint_line["line-color"]),"line-translate":new be(Tt.paint_line["line-translate"]),"line-translate-anchor":new be(Tt.paint_line["line-translate-anchor"]),"line-width":new Ae(Tt.paint_line["line-width"]),"line-gap-width":new Ae(Tt.paint_line["line-gap-width"]),"line-offset":new Ae(Tt.paint_line["line-offset"]),"line-blur":new Ae(Tt.paint_line["line-blur"]),"line-dasharray":new Cu(Tt.paint_line["line-dasharray"]),"line-pattern":new ol(Tt.paint_line["line-pattern"]),"line-gradient":new Mu(Tt.paint_line["line-gradient"])})},get layout(){return Cy=Cy||new xr({"line-cap":new be(Tt.layout_line["line-cap"]),"line-join":new Ae(Tt.layout_line["line-join"]),"line-miter-limit":new be(Tt.layout_line["line-miter-limit"]),"line-round-limit":new be(Tt.layout_line["line-round-limit"]),"line-sort-key":new Ae(Tt.layout_line["line-sort-key"])})}};class Lw extends Ae{possiblyEvaluate(e,o){return o=new Wi(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,zoomHistory:o.zoomHistory,transition:o.transition}),super.possiblyEvaluate(e,o)}evaluate(e,o,c,d){return o=Rt({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(e,o,c,d)}}let Md;class zw extends es{constructor(e){super(e,Dy),this.gradientVersion=0,Md||(Md=new Lw(Dy.paint.properties["line-width"].specification),Md.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const o=this.gradientExpression();this.stepInterpolant=!!function(c){return c._styleExpression!==void 0}(o)&&o._styleExpression.expression instanceof ao,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,o){super.recalculate(e,o),this.paint._values["line-floorwidth"]=Md.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Hf(e)}queryRadius(e){const o=e,c=Py(Ou("line-width",this,o),Ou("line-gap-width",this,o)),d=Ou("line-offset",this,o);return c/2+Math.abs(d)+Sd(this.paint.get("line-translate"))}queryIntersectsFeature(e,o,c,d,m,y,b){const S=Id(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,b),k=b/2*Py(this.paint.get("line-width").evaluate(o,c),this.paint.get("line-gap-width").evaluate(o,c)),C=this.paint.get("line-offset").evaluate(o,c);return C&&(d=function(L,B){const O=[];for(let N=0;N<L.length;N++){const q=L[N],X=[];for(let et=0;et<q.length;et++){const dt=q[et-1],ot=q[et],mt=q[et+1],vt=et===0?new W(0,0):ot.sub(dt)._unit()._perp(),Dt=et===q.length-1?new W(0,0):mt.sub(ot)._unit()._perp(),ee=vt._add(Dt)._unit(),fe=ee.x*Dt.x+ee.y*Dt.y;fe!==0&&ee._mult(1/fe),X.push(ee._mult(B)._add(ot))}O.push(X)}return O}(d,C*b)),function(L,B,O){for(let N=0;N<B.length;N++){const q=B[N];if(L.length>=3){for(let X=0;X<q.length;X++)if(rc(L,q[X]))return!0}if(Ux(L,q,O))return!0}return!1}(S,d,k)}isTileClipped(){return!0}}function Py(r,e){return e>0?e+2*r:r}const Bw=or([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Rw=or([{name:"a_projected_pos",components:3,type:"Float32"}],4);or([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Fw=or([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);or([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ly=or([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Ow=or([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Nw(r,e,o){return r.sections.forEach(c=>{c.text=function(d,m,y){const b=m.layout.get("text-transform").evaluate(y,{});return b==="uppercase"?d=d.toLocaleUpperCase():b==="lowercase"&&(d=d.toLocaleLowerCase()),Nn.applyArabicShaping&&(d=Nn.applyArabicShaping(d)),d}(c.text,e,o)}),r}or([{name:"triangle",components:3,type:"Uint16"}]),or([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),or([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),or([{type:"Float32",name:"offsetX"}]),or([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),or([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Wu={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Br=24,zy=Ri,By=function(r,e,o,c,d){var m,y,b=8*d-c-1,S=(1<<b)-1,k=S>>1,C=-7,L=d-1,B=-1,O=r[e+L];for(L+=B,m=O&(1<<-C)-1,O>>=-C,C+=b;C>0;m=256*m+r[e+L],L+=B,C-=8);for(y=m&(1<<-C)-1,m>>=-C,C+=c;C>0;y=256*y+r[e+L],L+=B,C-=8);if(m===0)m=1-k;else{if(m===S)return y?NaN:1/0*(O?-1:1);y+=Math.pow(2,c),m-=k}return(O?-1:1)*y*Math.pow(2,m-c)},Ry=function(r,e,o,c,d,m){var y,b,S,k=8*m-d-1,C=(1<<k)-1,L=C>>1,B=d===23?Math.pow(2,-24)-Math.pow(2,-77):0,O=0,N=1,q=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(b=isNaN(e)?1:0,y=C):(y=Math.floor(Math.log(e)/Math.LN2),e*(S=Math.pow(2,-y))<1&&(y--,S*=2),(e+=y+L>=1?B/S:B*Math.pow(2,1-L))*S>=2&&(y++,S/=2),y+L>=C?(b=0,y=C):y+L>=1?(b=(e*S-1)*Math.pow(2,d),y+=L):(b=e*Math.pow(2,L-1)*Math.pow(2,d),y=0));d>=8;r[o+O]=255&b,O+=N,b/=256,d-=8);for(y=y<<d|b,k+=d;k>0;r[o+O]=255&y,O+=N,y/=256,k-=8);r[o+O-N]|=128*q};function Ri(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}Ri.Varint=0,Ri.Fixed64=1,Ri.Bytes=2,Ri.Fixed32=5;var Yf=4294967296,Fy=1/Yf,Oy=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function qo(r){return r.type===Ri.Bytes?r.readVarint()+r.pos:r.pos+1}function ac(r,e,o){return o?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function Ny(r,e,o){var c=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));o.realloc(c);for(var d=o.pos-1;d>=r;d--)o.buf[d+c]=o.buf[d]}function Uw(r,e){for(var o=0;o<r.length;o++)e.writeVarint(r[o])}function Vw(r,e){for(var o=0;o<r.length;o++)e.writeSVarint(r[o])}function $w(r,e){for(var o=0;o<r.length;o++)e.writeFloat(r[o])}function jw(r,e){for(var o=0;o<r.length;o++)e.writeDouble(r[o])}function qw(r,e){for(var o=0;o<r.length;o++)e.writeBoolean(r[o])}function Gw(r,e){for(var o=0;o<r.length;o++)e.writeFixed32(r[o])}function Zw(r,e){for(var o=0;o<r.length;o++)e.writeSFixed32(r[o])}function Ww(r,e){for(var o=0;o<r.length;o++)e.writeFixed64(r[o])}function Hw(r,e){for(var o=0;o<r.length;o++)e.writeSFixed64(r[o])}function Dd(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+16777216*r[e+3]}function lc(r,e,o){r[o]=e,r[o+1]=e>>>8,r[o+2]=e>>>16,r[o+3]=e>>>24}function Uy(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+(r[e+3]<<24)}Ri.prototype={destroy:function(){this.buf=null},readFields:function(r,e,o){for(o=o||this.length;this.pos<o;){var c=this.readVarint(),d=c>>3,m=this.pos;this.type=7&c,r(d,e,this),this.pos===m&&this.skip(c)}return e},readMessage:function(r,e){return this.readFields(r,e,this.readVarint()+this.pos)},readFixed32:function(){var r=Dd(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=Uy(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=Dd(this.buf,this.pos)+Dd(this.buf,this.pos+4)*Yf;return this.pos+=8,r},readSFixed64:function(){var r=Dd(this.buf,this.pos)+Uy(this.buf,this.pos+4)*Yf;return this.pos+=8,r},readFloat:function(){var r=By(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=By(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var e,o,c=this.buf;return e=127&(o=c[this.pos++]),o<128?e:(e|=(127&(o=c[this.pos++]))<<7,o<128?e:(e|=(127&(o=c[this.pos++]))<<14,o<128?e:(e|=(127&(o=c[this.pos++]))<<21,o<128?e:function(d,m,y){var b,S,k=y.buf;if(b=(112&(S=k[y.pos++]))>>4,S<128||(b|=(127&(S=k[y.pos++]))<<3,S<128)||(b|=(127&(S=k[y.pos++]))<<10,S<128)||(b|=(127&(S=k[y.pos++]))<<17,S<128)||(b|=(127&(S=k[y.pos++]))<<24,S<128)||(b|=(1&(S=k[y.pos++]))<<31,S<128))return ac(d,b,m);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(o=c[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&Oy?function(o,c,d){return Oy.decode(o.subarray(c,d))}(this.buf,e,r):function(o,c,d){for(var m="",y=c;y<d;){var b,S,k,C=o[y],L=null,B=C>239?4:C>223?3:C>191?2:1;if(y+B>d)break;B===1?C<128&&(L=C):B===2?(192&(b=o[y+1]))==128&&(L=(31&C)<<6|63&b)<=127&&(L=null):B===3?(S=o[y+2],(192&(b=o[y+1]))==128&&(192&S)==128&&((L=(15&C)<<12|(63&b)<<6|63&S)<=2047||L>=55296&&L<=57343)&&(L=null)):B===4&&(S=o[y+2],k=o[y+3],(192&(b=o[y+1]))==128&&(192&S)==128&&(192&k)==128&&((L=(15&C)<<18|(63&b)<<12|(63&S)<<6|63&k)<=65535||L>=1114112)&&(L=null)),L===null?(L=65533,B=1):L>65535&&(L-=65536,m+=String.fromCharCode(L>>>10&1023|55296),L=56320|1023&L),m+=String.fromCharCode(L),y+=B}return m}(this.buf,e,r)},readBytes:function(){var r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e},readPackedVarint:function(r,e){if(this.type!==Ri.Bytes)return r.push(this.readVarint(e));var o=qo(this);for(r=r||[];this.pos<o;)r.push(this.readVarint(e));return r},readPackedSVarint:function(r){if(this.type!==Ri.Bytes)return r.push(this.readSVarint());var e=qo(this);for(r=r||[];this.pos<e;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==Ri.Bytes)return r.push(this.readBoolean());var e=qo(this);for(r=r||[];this.pos<e;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==Ri.Bytes)return r.push(this.readFloat());var e=qo(this);for(r=r||[];this.pos<e;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==Ri.Bytes)return r.push(this.readDouble());var e=qo(this);for(r=r||[];this.pos<e;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==Ri.Bytes)return r.push(this.readFixed32());var e=qo(this);for(r=r||[];this.pos<e;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==Ri.Bytes)return r.push(this.readSFixed32());var e=qo(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==Ri.Bytes)return r.push(this.readFixed64());var e=qo(this);for(r=r||[];this.pos<e;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==Ri.Bytes)return r.push(this.readSFixed64());var e=qo(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed64());return r},skip:function(r){var e=7&r;if(e===Ri.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ri.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ri.Fixed32)this.pos+=4;else{if(e!==Ri.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(r,e){this.writeVarint(r<<3|e)},realloc:function(r){for(var e=this.length||16;e<this.pos+r;)e*=2;if(e!==this.length){var o=new Uint8Array(e);o.set(this.buf),this.buf=o,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),lc(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),lc(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),lc(this.buf,-1&r,this.pos),lc(this.buf,Math.floor(r*Fy),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),lc(this.buf,-1&r,this.pos),lc(this.buf,Math.floor(r*Fy),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(e,o){var c,d;if(e>=0?(c=e%4294967296|0,d=e/4294967296|0):(d=~(-e/4294967296),4294967295^(c=~(-e%4294967296))?c=c+1|0:(c=0,d=d+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),function(m,y,b){b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,b.buf[b.pos]=127&(m>>>=7)}(c,0,o),function(m,y){var b=(7&m)<<4;y.buf[y.pos++]|=b|((m>>>=3)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m)))))}(d,o)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var e=this.pos;this.pos=function(c,d,m){for(var y,b,S=0;S<d.length;S++){if((y=d.charCodeAt(S))>55295&&y<57344){if(!b){y>56319||S+1===d.length?(c[m++]=239,c[m++]=191,c[m++]=189):b=y;continue}if(y<56320){c[m++]=239,c[m++]=191,c[m++]=189,b=y;continue}y=b-55296<<10|y-56320|65536,b=null}else b&&(c[m++]=239,c[m++]=191,c[m++]=189,b=null);y<128?c[m++]=y:(y<2048?c[m++]=y>>6|192:(y<65536?c[m++]=y>>12|224:(c[m++]=y>>18|240,c[m++]=y>>12&63|128),c[m++]=y>>6&63|128),c[m++]=63&y|128)}return m}(this.buf,r,this.pos);var o=this.pos-e;o>=128&&Ny(e,o,this),this.pos=e-1,this.writeVarint(o),this.pos+=o},writeFloat:function(r){this.realloc(4),Ry(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),Ry(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var e=r.length;this.writeVarint(e),this.realloc(e);for(var o=0;o<e;o++)this.buf[this.pos++]=r[o]},writeRawMessage:function(r,e){this.pos++;var o=this.pos;r(e,this);var c=this.pos-o;c>=128&&Ny(o,c,this),this.pos=o-1,this.writeVarint(c),this.pos+=c},writeMessage:function(r,e,o){this.writeTag(r,Ri.Bytes),this.writeRawMessage(e,o)},writePackedVarint:function(r,e){e.length&&this.writeMessage(r,Uw,e)},writePackedSVarint:function(r,e){e.length&&this.writeMessage(r,Vw,e)},writePackedBoolean:function(r,e){e.length&&this.writeMessage(r,qw,e)},writePackedFloat:function(r,e){e.length&&this.writeMessage(r,$w,e)},writePackedDouble:function(r,e){e.length&&this.writeMessage(r,jw,e)},writePackedFixed32:function(r,e){e.length&&this.writeMessage(r,Gw,e)},writePackedSFixed32:function(r,e){e.length&&this.writeMessage(r,Zw,e)},writePackedFixed64:function(r,e){e.length&&this.writeMessage(r,Ww,e)},writePackedSFixed64:function(r,e){e.length&&this.writeMessage(r,Hw,e)},writeBytesField:function(r,e){this.writeTag(r,Ri.Bytes),this.writeBytes(e)},writeFixed32Field:function(r,e){this.writeTag(r,Ri.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(r,e){this.writeTag(r,Ri.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(r,e){this.writeTag(r,Ri.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(r,e){this.writeTag(r,Ri.Fixed64),this.writeSFixed64(e)},writeVarintField:function(r,e){this.writeTag(r,Ri.Varint),this.writeVarint(e)},writeSVarintField:function(r,e){this.writeTag(r,Ri.Varint),this.writeSVarint(e)},writeStringField:function(r,e){this.writeTag(r,Ri.Bytes),this.writeString(e)},writeFloatField:function(r,e){this.writeTag(r,Ri.Fixed32),this.writeFloat(e)},writeDoubleField:function(r,e){this.writeTag(r,Ri.Fixed64),this.writeDouble(e)},writeBooleanField:function(r,e){this.writeVarintField(r,!!e)}};var Kf=E(zy);const Xf=3;function Yw(r,e,o){r===1&&o.readMessage(Kw,e)}function Kw(r,e,o){if(r===3){const{id:c,bitmap:d,width:m,height:y,left:b,top:S,advance:k}=o.readMessage(Xw,{});e.push({id:c,bitmap:new Uu({width:m+2*Xf,height:y+2*Xf},d),metrics:{width:m,height:y,left:b,top:S,advance:k}})}}function Xw(r,e,o){r===1?e.id=o.readVarint():r===2?e.bitmap=o.readBytes():r===3?e.width=o.readVarint():r===4?e.height=o.readVarint():r===5?e.left=o.readSVarint():r===6?e.top=o.readSVarint():r===7&&(e.advance=o.readVarint())}const Vy=Xf;function $y(r){let e=0,o=0;for(const y of r)e+=y.w*y.h,o=Math.max(o,y.w);r.sort((y,b)=>b.h-y.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),o),h:1/0}];let d=0,m=0;for(const y of r)for(let b=c.length-1;b>=0;b--){const S=c[b];if(!(y.w>S.w||y.h>S.h)){if(y.x=S.x,y.y=S.y,m=Math.max(m,y.y+y.h),d=Math.max(d,y.x+y.w),y.w===S.w&&y.h===S.h){const k=c.pop();b<c.length&&(c[b]=k)}else y.h===S.h?(S.x+=y.w,S.w-=y.w):y.w===S.w?(S.y+=y.h,S.h-=y.h):(c.push({x:S.x+y.w,y:S.y,w:S.w-y.w,h:y.h}),S.y+=y.h,S.h-=y.h);break}}return{w:d,h:m,fill:e/(d*m)||0}}const Vn=1;class Jf{constructor(e,{pixelRatio:o,version:c,stretchX:d,stretchY:m,content:y}){this.paddedRect=e,this.pixelRatio=o,this.stretchX=d,this.stretchY=m,this.content=y,this.version=c}get tl(){return[this.paddedRect.x+Vn,this.paddedRect.y+Vn]}get br(){return[this.paddedRect.x+this.paddedRect.w-Vn,this.paddedRect.y+this.paddedRect.h-Vn]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Vn)/this.pixelRatio,(this.paddedRect.h-2*Vn)/this.pixelRatio]}}class jy{constructor(e,o){const c={},d={};this.haveRenderCallbacks=[];const m=[];this.addImages(e,c,m),this.addImages(o,d,m);const{w:y,h:b}=$y(m),S=new hs({width:y||1,height:b||1});for(const k in e){const C=e[k],L=c[k].paddedRect;hs.copy(C.data,S,{x:0,y:0},{x:L.x+Vn,y:L.y+Vn},C.data)}for(const k in o){const C=o[k],L=d[k].paddedRect,B=L.x+Vn,O=L.y+Vn,N=C.data.width,q=C.data.height;hs.copy(C.data,S,{x:0,y:0},{x:B,y:O},C.data),hs.copy(C.data,S,{x:0,y:q-1},{x:B,y:O-1},{width:N,height:1}),hs.copy(C.data,S,{x:0,y:0},{x:B,y:O+q},{width:N,height:1}),hs.copy(C.data,S,{x:N-1,y:0},{x:B-1,y:O},{width:1,height:q}),hs.copy(C.data,S,{x:0,y:0},{x:B+N,y:O},{width:1,height:q})}this.image=S,this.iconPositions=c,this.patternPositions=d}addImages(e,o,c){for(const d in e){const m=e[d],y={x:0,y:0,w:m.data.width+2*Vn,h:m.data.height+2*Vn};c.push(y),o[d]=new Jf(y,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(e,o){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in e.updatedImages)this.patchUpdatedImage(this.iconPositions[c],e.getImage(c),o),this.patchUpdatedImage(this.patternPositions[c],e.getImage(c),o)}patchUpdatedImage(e,o,c){if(!e||!o||e.version===o.version)return;e.version=o.version;const[d,m]=e.tl;c.update(o.data,void 0,{x:d,y:m})}}var wa;le("ImagePosition",Jf),le("ImageAtlas",jy),l.ai=void 0,(wa=l.ai||(l.ai={}))[wa.none=0]="none",wa[wa.horizontal=1]="horizontal",wa[wa.vertical=2]="vertical",wa[wa.horizontalOnly=3]="horizontalOnly";const Hu=-17;class Yu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,o){const c=new Yu;return c.scale=e||1,c.fontStack=o,c}static forImage(e){const o=new Yu;return o.imageName=e,o}}class cc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,o){const c=new cc;for(let d=0;d<e.sections.length;d++){const m=e.sections[d];m.image?c.addImageSection(m):c.addTextSection(m,o)}return c}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let o="";for(let c=0;c<e.length;c++){const d=e.charCodeAt(c+1)||null,m=e.charCodeAt(c-1)||null;o+=d&&dd(d)&&!Wu[e[c+1]]||m&&dd(m)&&!Wu[e[c-1]]||!Wu[e[c]]?e[c]:Wu[e[c]]}return o}(this.text)}trim(){let e=0;for(let c=0;c<this.text.length&&Ld[this.text.charCodeAt(c)];c++)e++;let o=this.text.length;for(let c=this.text.length-1;c>=0&&c>=e&&Ld[this.text.charCodeAt(c)];c--)o--;this.text=this.text.substring(e,o),this.sectionIndex=this.sectionIndex.slice(e,o)}substring(e,o){const c=new cc;return c.text=this.text.substring(e,o),c.sectionIndex=this.sectionIndex.slice(e,o),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,o)=>Math.max(e,this.sections[o].scale),0)}addTextSection(e,o){this.text+=e.text,this.sections.push(Yu.forText(e.scale,e.fontStack||o));const c=this.sections.length-1;for(let d=0;d<e.text.length;++d)this.sectionIndex.push(c)}addImageSection(e){const o=e.image?e.image.name:"";if(o.length===0)return void ae("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(Yu.forImage(o)),this.sectionIndex.push(this.sections.length-1)):ae("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Pd(r,e,o,c,d,m,y,b,S,k,C,L,B,O,N,q){const X=cc.fromFeature(r,d);let et;L===l.ai.vertical&&X.verticalizePunctuation();const{processBidirectionalText:dt,processStyledBidirectionalText:ot}=Nn;if(dt&&X.sections.length===1){et=[];const Dt=dt(X.toString(),Qf(X,k,m,e,c,O,N));for(const ee of Dt){const fe=new cc;fe.text=ee,fe.sections=X.sections;for(let Jt=0;Jt<ee.length;Jt++)fe.sectionIndex.push(0);et.push(fe)}}else if(ot){et=[];const Dt=ot(X.text,X.sectionIndex,Qf(X,k,m,e,c,O,N));for(const ee of Dt){const fe=new cc;fe.text=ee[0],fe.sectionIndex=ee[1],fe.sections=X.sections,et.push(fe)}}else et=function(Dt,ee){const fe=[],Jt=Dt.text;let Kt=0;for(const qt of ee)fe.push(Dt.substring(Kt,qt)),Kt=qt;return Kt<Jt.length&&fe.push(Dt.substring(Kt,Jt.length)),fe}(X,Qf(X,k,m,e,c,O,N));const mt=[],vt={positionedLines:mt,text:X.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:L,iconsInText:!1,verticalizable:!1};return function(Dt,ee,fe,Jt,Kt,qt,ce,Zt,Nt,Ie,_e,ei){let Yi=0,tr=Hu,Rr=0,rs=0;const En=Zt==="right"?1:Zt==="left"?0:.5;let Mr=0;for(const Fr of Kt){Fr.trim();const Or=Fr.getMaxScale(),gn=(Or-1)*Br,Dn={positionedGlyphs:[],lineOffset:0};Dt.positionedLines[Mr]=Dn;const yn=Dn.positionedGlyphs;let $n=0;if(!Fr.length()){tr+=qt,++Mr;continue}for(let Nr=0;Nr<Fr.length();Nr++){const oi=Fr.getSection(Nr),_n=Fr.getSectionIndex(Nr),un=Fr.getCharCode(Nr);let Ur=0,As=null,Zs=null,Ws=null,Go=Br;const Es=!(Nt===l.ai.horizontal||!_e&&!xu(un)||_e&&(Ld[un]||(Xr=un,te.Arabic(Xr)||te["Arabic Supplement"](Xr)||te["Arabic Extended-A"](Xr)||te["Arabic Presentation Forms-A"](Xr)||te["Arabic Presentation Forms-B"](Xr))));if(oi.imageName){const ps=Jt[oi.imageName];if(!ps)continue;Ws=oi.imageName,Dt.iconsInText=Dt.iconsInText||!0,Zs=ps.paddedRect;const qn=ps.displaySize;oi.scale=oi.scale*Br/ei,As={width:qn[0],height:qn[1],left:Vn,top:-Vy,advance:Es?qn[1]:qn[0]},Ur=gn+(Br-qn[1]*oi.scale),Go=As.advance;const Zo=Es?qn[0]*oi.scale-Br*Or:qn[1]*oi.scale-Br*Or;Zo>0&&Zo>$n&&($n=Zo)}else{const ps=fe[oi.fontStack],qn=ps&&ps[un];if(qn&&qn.rect)Zs=qn.rect,As=qn.metrics;else{const Zo=ee[oi.fontStack],th=Zo&&Zo[un];if(!th)continue;As=th.metrics}Ur=(Or-oi.scale)*Br}Es?(Dt.verticalizable=!0,yn.push({glyph:un,imageName:Ws,x:Yi,y:tr+Ur,vertical:Es,scale:oi.scale,fontStack:oi.fontStack,sectionIndex:_n,metrics:As,rect:Zs}),Yi+=Go*oi.scale+Ie):(yn.push({glyph:un,imageName:Ws,x:Yi,y:tr+Ur,vertical:Es,scale:oi.scale,fontStack:oi.fontStack,sectionIndex:_n,metrics:As,rect:Zs}),Yi+=As.advance*oi.scale+Ie)}yn.length!==0&&(Rr=Math.max(Yi-Ie,Rr),t1(yn,0,yn.length-1,En,$n)),Yi=0;const jn=qt*Or+$n;Dn.lineOffset=Math.max($n,gn),tr+=jn,rs=Math.max(jn,rs),++Mr}var Xr;const cn=tr-Hu,{horizontalAlign:Cn,verticalAlign:Mn}=tm(ce);(function(Fr,Or,gn,Dn,yn,$n,jn,Nr,oi){const _n=(Or-gn)*yn;let un=0;un=$n!==jn?-Nr*Dn-Hu:(-Dn*oi+.5)*jn;for(const Ur of Fr)for(const As of Ur.positionedGlyphs)As.x+=_n,As.y+=un})(Dt.positionedLines,En,Cn,Mn,Rr,rs,qt,cn,Kt.length),Dt.top+=-Mn*cn,Dt.bottom=Dt.top+cn,Dt.left+=-Cn*Rr,Dt.right=Dt.left+Rr}(vt,e,o,c,et,y,b,S,L,k,B,q),!function(Dt){for(const ee of Dt)if(ee.positionedGlyphs.length!==0)return!1;return!0}(mt)&&vt}const Ld={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Jw={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function qy(r,e,o,c,d,m){if(e.imageName){const y=c[e.imageName];return y?y.displaySize[0]*e.scale*Br/m+d:0}{const y=o[e.fontStack],b=y&&y[r];return b?b.metrics.advance*e.scale+d:0}}function Gy(r,e,o,c){const d=Math.pow(r-e,2);return c?r<e?d/2:2*d:d+Math.abs(o)*o}function Qw(r,e,o){let c=0;return r===10&&(c-=1e4),o&&(c+=150),r!==40&&r!==65288||(c+=50),e!==41&&e!==65289||(c+=50),c}function Zy(r,e,o,c,d,m){let y=null,b=Gy(e,o,d,m);for(const S of c){const k=Gy(e-S.x,o,d,m)+S.badness;k<=b&&(y=S,b=k)}return{index:r,x:e,priorBreak:y,badness:b}}function Wy(r){return r?Wy(r.priorBreak).concat(r.index):[]}function Qf(r,e,o,c,d,m,y){if(m!=="point")return[];if(!r)return[];const b=[],S=function(B,O,N,q,X,et){let dt=0;for(let ot=0;ot<B.length();ot++){const mt=B.getSection(ot);dt+=qy(B.getCharCode(ot),mt,q,X,O,et)}return dt/Math.max(1,Math.ceil(dt/N))}(r,e,o,c,d,y),k=r.text.indexOf("​")>=0;let C=0;for(let B=0;B<r.length();B++){const O=r.getSection(B),N=r.getCharCode(B);if(Ld[N]||(C+=qy(N,O,c,d,e,y)),B<r.length()-1){const q=!((L=N)<11904||!(te["Bopomofo Extended"](L)||te.Bopomofo(L)||te["CJK Compatibility Forms"](L)||te["CJK Compatibility Ideographs"](L)||te["CJK Compatibility"](L)||te["CJK Radicals Supplement"](L)||te["CJK Strokes"](L)||te["CJK Symbols and Punctuation"](L)||te["CJK Unified Ideographs Extension A"](L)||te["CJK Unified Ideographs"](L)||te["Enclosed CJK Letters and Months"](L)||te["Halfwidth and Fullwidth Forms"](L)||te.Hiragana(L)||te["Ideographic Description Characters"](L)||te["Kangxi Radicals"](L)||te["Katakana Phonetic Extensions"](L)||te.Katakana(L)||te["Vertical Forms"](L)||te["Yi Radicals"](L)||te["Yi Syllables"](L)));(Jw[N]||q||O.imageName)&&b.push(Zy(B+1,C,S,b,Qw(N,r.getCharCode(B+1),q&&k),!1))}}var L;return Wy(Zy(r.length(),C,S,b,0,!0))}function tm(r){let e=.5,o=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:e,verticalAlign:o}}function t1(r,e,o,c,d){if(!c&&!d)return;const m=r[o],y=(r[o].x+m.metrics.advance*m.scale)*c;for(let b=e;b<=o;b++)r[b].x-=y,r[b].y+=d}function e1(r,e,o){const{horizontalAlign:c,verticalAlign:d}=tm(o),m=e[0]-r.displaySize[0]*c,y=e[1]-r.displaySize[1]*d;return{image:r,top:y,bottom:y+r.displaySize[1],left:m,right:m+r.displaySize[0]}}function Hy(r,e,o,c,d,m){const y=r.image;let b;if(y.content){const X=y.content,et=y.pixelRatio||1;b=[X[0]/et,X[1]/et,y.displaySize[0]-X[2]/et,y.displaySize[1]-X[3]/et]}const S=e.left*m,k=e.right*m;let C,L,B,O;o==="width"||o==="both"?(O=d[0]+S-c[3],L=d[0]+k+c[1]):(O=d[0]+(S+k-y.displaySize[0])/2,L=O+y.displaySize[0]);const N=e.top*m,q=e.bottom*m;return o==="height"||o==="both"?(C=d[1]+N-c[0],B=d[1]+q+c[2]):(C=d[1]+(N+q-y.displaySize[1])/2,B=C+y.displaySize[1]),{image:y,top:C,right:L,bottom:B,left:O,collisionPadding:b}}const Ku=255,po=128,Sa=Ku*po;function Yy(r,e){const{expression:o}=e;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new Wi(r+1))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:d}=o;let m=0;for(;m<c.length&&c[m]<=r;)m++;m=Math.max(0,m-1);let y=m;for(;y<c.length&&c[y]<r+1;)y++;y=Math.min(c.length-1,y);const b=c[m],S=c[y];return o.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:S,interpolationType:d}:{kind:"camera",minZoom:b,maxZoom:S,minSize:o.evaluate(new Wi(b)),maxSize:o.evaluate(new Wi(S)),interpolationType:d}}}function em(r,e,o){let c="never";const d=r.get(e);return d?c=d:r.get(o)&&(c="always"),c}const i1=xa.VectorTileFeature.types,r1=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function zd(r,e,o,c,d,m,y,b,S,k,C,L,B){const O=b?Math.min(Sa,Math.round(b[0])):0,N=b?Math.min(Sa,Math.round(b[1])):0;r.emplaceBack(e,o,Math.round(32*c),Math.round(32*d),m,y,(O<<1)+(S?1:0),N,16*k,16*C,256*L,256*B)}function im(r,e,o){r.emplaceBack(e.x,e.y,o),r.emplaceBack(e.x,e.y,o),r.emplaceBack(e.x,e.y,o),r.emplaceBack(e.x,e.y,o)}function n1(r){for(const e of r.sections)if(Ef(e.text))return!0;return!1}class rm{constructor(e){this.layoutVertexArray=new ii,this.indexArray=new Yr,this.programConfigurations=e,this.segments=new Hi,this.dynamicLayoutVertexArray=new Ye,this.opacityVertexArray=new ni,this.hasVisibleVertices=!1,this.placedSymbolArray=new lt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,o,c,d){this.isEmpty()||(c&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Bw.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Rw.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,r1,!0),this.opacityVertexBuffer.itemSize=1),(c||d)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}le("SymbolBuffers",rm);class nm{constructor(e,o,c){this.layoutVertexArray=new e,this.layoutAttributes=o,this.indexArray=new c,this.segments=new Hi,this.collisionVertexArray=new ji}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Fw.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}le("CollisionBuffers",nm);class uc{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(y=>y.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Bf([]),this.placementViewportMatrix=Bf([]);const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Yy(this.zoom,o["text-size"]),this.iconSizeData=Yy(this.zoom,o["icon-size"]);const c=this.layers[0].layout,d=c.get("symbol-sort-key"),m=c.get("symbol-z-order");this.canOverlap=em(c,"text-overlap","text-allow-overlap")!=="never"||em(c,"icon-overlap","icon-allow-overlap")!=="never"||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&!d.isConstant(),this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,c.get("symbol-placement")==="point"&&(this.writingModes=c.get("text-writing-mode").map(y=>l.ai[y])),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=e.sourceID}createArrays(){this.text=new rm(new Gs(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new rm(new Gs(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new ut,this.lineVertexArray=new xt,this.symbolInstances=new Q,this.textAnchorOffsets=new Mt}calculateGlyphDependencies(e,o,c,d,m){for(let y=0;y<e.length;y++)if(o[e.charCodeAt(y)]=!0,(c||d)&&m){const b=Wu[e.charAt(y)];b&&(o[b.charCodeAt(0)]=!0)}}populate(e,o,c){const d=this.layers[0],m=d.layout,y=m.get("text-font"),b=m.get("text-field"),S=m.get("icon-image"),k=(b.value.kind!=="constant"||b.value.value instanceof on&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),C=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,L=m.get("symbol-sort-key");if(this.features=[],!k&&!C)return;const B=o.iconDependencies,O=o.glyphDependencies,N=o.availableImages,q=new Wi(this.zoom);for(const{feature:X,id:et,index:dt,sourceLayerIndex:ot}of e){const mt=d._featureFilter.needGeometry,vt=ul(X,mt);if(!d._featureFilter.filter(q,vt,c))continue;let Dt,ee;if(mt||(vt.geometry=cl(X)),k){const Jt=d.getValueAndResolveTokens("text-field",vt,c,N),Kt=on.factory(Jt);n1(Kt)&&(this.hasRTLText=!0),(!this.hasRTLText||Au()==="unavailable"||this.hasRTLText&&Nn.isParsed())&&(Dt=Nw(Kt,d,vt))}if(C){const Jt=d.getValueAndResolveTokens("icon-image",vt,c,N);ee=Jt instanceof Hr?Jt:Hr.fromString(Jt)}if(!Dt&&!ee)continue;const fe=this.sortFeaturesByKey?L.evaluate(vt,{},c):void 0;if(this.features.push({id:et,text:Dt,icon:ee,index:dt,sourceLayerIndex:ot,geometry:vt.geometry,properties:X.properties,type:i1[X.type],sortKey:fe}),ee&&(B[ee.name]=!0),Dt){const Jt=y.evaluate(vt,{},c).join(","),Kt=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(l.ai.vertical)>=0;for(const qt of Dt.sections)if(qt.image)B[qt.image.name]=!0;else{const ce=vu(Dt.toString()),Zt=qt.fontStack||Jt,Nt=O[Zt]=O[Zt]||{};this.calculateGlyphDependencies(qt.text,Nt,Kt,this.allowVerticalPlacement,ce)}}}m.get("symbol-placement")==="line"&&(this.features=function(X){const et={},dt={},ot=[];let mt=0;function vt(Jt){ot.push(X[Jt]),mt++}function Dt(Jt,Kt,qt){const ce=dt[Jt];return delete dt[Jt],dt[Kt]=ce,ot[ce].geometry[0].pop(),ot[ce].geometry[0]=ot[ce].geometry[0].concat(qt[0]),ce}function ee(Jt,Kt,qt){const ce=et[Kt];return delete et[Kt],et[Jt]=ce,ot[ce].geometry[0].shift(),ot[ce].geometry[0]=qt[0].concat(ot[ce].geometry[0]),ce}function fe(Jt,Kt,qt){const ce=qt?Kt[0][Kt[0].length-1]:Kt[0][0];return`${Jt}:${ce.x}:${ce.y}`}for(let Jt=0;Jt<X.length;Jt++){const Kt=X[Jt],qt=Kt.geometry,ce=Kt.text?Kt.text.toString():null;if(!ce){vt(Jt);continue}const Zt=fe(ce,qt),Nt=fe(ce,qt,!0);if(Zt in dt&&Nt in et&&dt[Zt]!==et[Nt]){const Ie=ee(Zt,Nt,qt),_e=Dt(Zt,Nt,ot[Ie].geometry);delete et[Zt],delete dt[Nt],dt[fe(ce,ot[_e].geometry,!0)]=_e,ot[Ie].geometry=null}else Zt in dt?Dt(Zt,Nt,qt):Nt in et?ee(Zt,Nt,qt):(vt(Jt),et[Zt]=mt-1,dt[Nt]=mt-1)}return ot.filter(Jt=>Jt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((X,et)=>X.sortKey-et.sortKey)}update(e,o,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,o,this.layers,c),this.icon.programConfigurations.updatePaintArrays(e,o,this.layers,c))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,o){const c=this.lineVertexArray.length;if(e.segment!==void 0){let d=e.dist(o[e.segment+1]),m=e.dist(o[e.segment]);const y={};for(let b=e.segment+1;b<o.length;b++)y[b]={x:o[b].x,y:o[b].y,tileUnitDistanceFromAnchor:d},b<o.length-1&&(d+=o[b+1].dist(o[b]));for(let b=e.segment||0;b>=0;b--)y[b]={x:o[b].x,y:o[b].y,tileUnitDistanceFromAnchor:m},b>0&&(m+=o[b-1].dist(o[b]));for(let b=0;b<o.length;b++){const S=y[b];this.lineVertexArray.emplaceBack(S.x,S.y,S.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(e,o,c,d,m,y,b,S,k,C,L,B){const O=e.indexArray,N=e.layoutVertexArray,q=e.segments.prepareSegment(4*o.length,N,O,this.canOverlap?y.sortKey:void 0),X=this.glyphOffsetArray.length,et=q.vertexLength,dt=this.allowVerticalPlacement&&b===l.ai.vertical?Math.PI/2:0,ot=y.text&&y.text.sections;for(let mt=0;mt<o.length;mt++){const{tl:vt,tr:Dt,bl:ee,br:fe,tex:Jt,pixelOffsetTL:Kt,pixelOffsetBR:qt,minFontScaleX:ce,minFontScaleY:Zt,glyphOffset:Nt,isSDF:Ie,sectionIndex:_e}=o[mt],ei=q.vertexLength,Yi=Nt[1];zd(N,S.x,S.y,vt.x,Yi+vt.y,Jt.x,Jt.y,c,Ie,Kt.x,Kt.y,ce,Zt),zd(N,S.x,S.y,Dt.x,Yi+Dt.y,Jt.x+Jt.w,Jt.y,c,Ie,qt.x,Kt.y,ce,Zt),zd(N,S.x,S.y,ee.x,Yi+ee.y,Jt.x,Jt.y+Jt.h,c,Ie,Kt.x,qt.y,ce,Zt),zd(N,S.x,S.y,fe.x,Yi+fe.y,Jt.x+Jt.w,Jt.y+Jt.h,c,Ie,qt.x,qt.y,ce,Zt),im(e.dynamicLayoutVertexArray,S,dt),O.emplaceBack(ei,ei+1,ei+2),O.emplaceBack(ei+1,ei+2,ei+3),q.vertexLength+=4,q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Nt[0]),mt!==o.length-1&&_e===o[mt+1].sectionIndex||e.programConfigurations.populatePaintArrays(N.length,y,y.index,{},B,ot&&ot[_e])}e.placedSymbolArray.emplaceBack(S.x,S.y,X,this.glyphOffsetArray.length-X,et,k,C,S.segment,c?c[0]:0,c?c[1]:0,d[0],d[1],b,0,!1,0,L)}_addCollisionDebugVertex(e,o,c,d,m,y){return o.emplaceBack(0,0),e.emplaceBack(c.x,c.y,d,m,Math.round(y.x),Math.round(y.y))}addCollisionDebugVertices(e,o,c,d,m,y,b){const S=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),k=S.vertexLength,C=m.layoutVertexArray,L=m.collisionVertexArray,B=b.anchorX,O=b.anchorY;this._addCollisionDebugVertex(C,L,y,B,O,new W(e,o)),this._addCollisionDebugVertex(C,L,y,B,O,new W(c,o)),this._addCollisionDebugVertex(C,L,y,B,O,new W(c,d)),this._addCollisionDebugVertex(C,L,y,B,O,new W(e,d)),S.vertexLength+=4;const N=m.indexArray;N.emplaceBack(k,k+1),N.emplaceBack(k+1,k+2),N.emplaceBack(k+2,k+3),N.emplaceBack(k+3,k),S.primitiveLength+=4}addDebugCollisionBoxes(e,o,c,d){for(let m=e;m<o;m++){const y=this.collisionBoxArray.get(m);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,d?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,c)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new nm(_r,Ly.members,Lr),this.iconCollisionBox=new nm(_r,Ly.members,Lr);for(let e=0;e<this.symbolInstances.length;e++){const o=this.symbolInstances.get(e);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}}_deserializeCollisionBoxesForSymbol(e,o,c,d,m,y,b,S,k){const C={};for(let L=o;L<c;L++){const B=e.get(L);C.textBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},C.textFeatureIndex=B.featureIndex;break}for(let L=d;L<m;L++){const B=e.get(L);C.verticalTextBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},C.verticalTextFeatureIndex=B.featureIndex;break}for(let L=y;L<b;L++){const B=e.get(L);C.iconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},C.iconFeatureIndex=B.featureIndex;break}for(let L=S;L<k;L++){const B=e.get(L);C.verticalIconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},C.verticalIconFeatureIndex=B.featureIndex;break}return C}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const c=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,o){const c=e.placedSymbolArray.get(o),d=c.vertexStartIndex+4*c.numGlyphs;for(let m=c.vertexStartIndex;m<d;m+=4)e.indexArray.emplaceBack(m,m+1,m+2),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(e),c=Math.cos(e),d=[],m=[],y=[];for(let b=0;b<this.symbolInstances.length;++b){y.push(b);const S=this.symbolInstances.get(b);d.push(0|Math.round(o*S.anchorX+c*S.anchorY)),m.push(S.featureIndex)}return y.sort((b,S)=>d[b]-d[S]||m[S]-m[b]),y}addToSortKeyRanges(e,o){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===o?c.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const c=this.symbolInstances.get(o);this.featureSortOrder.push(c.featureIndex),[c.rightJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.leftJustifiedTextSymbolIndex].forEach((d,m,y)=>{d>=0&&y.indexOf(d)===m&&this.addIndicesForPlacedSymbol(this.text,d)}),c.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,c.verticalPlacedTextSymbolIndex),c.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.placedIconSymbolIndex),c.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Ky,Xy;le("SymbolBucket",uc,{omit:["layers","collisionBoxArray","features","compareText"]}),uc.MAX_GLYPHS=65535,uc.addDynamicAttributes=im;var sm={get paint(){return Xy=Xy||new xr({"icon-opacity":new Ae(Tt.paint_symbol["icon-opacity"]),"icon-color":new Ae(Tt.paint_symbol["icon-color"]),"icon-halo-color":new Ae(Tt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ae(Tt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ae(Tt.paint_symbol["icon-halo-blur"]),"icon-translate":new be(Tt.paint_symbol["icon-translate"]),"icon-translate-anchor":new be(Tt.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ae(Tt.paint_symbol["text-opacity"]),"text-color":new Ae(Tt.paint_symbol["text-color"],{runtimeType:pn,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new Ae(Tt.paint_symbol["text-halo-color"]),"text-halo-width":new Ae(Tt.paint_symbol["text-halo-width"]),"text-halo-blur":new Ae(Tt.paint_symbol["text-halo-blur"]),"text-translate":new be(Tt.paint_symbol["text-translate"]),"text-translate-anchor":new be(Tt.paint_symbol["text-translate-anchor"])})},get layout(){return Ky=Ky||new xr({"symbol-placement":new be(Tt.layout_symbol["symbol-placement"]),"symbol-spacing":new be(Tt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new be(Tt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ae(Tt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new be(Tt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new be(Tt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new be(Tt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new be(Tt.layout_symbol["icon-ignore-placement"]),"icon-optional":new be(Tt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new be(Tt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ae(Tt.layout_symbol["icon-size"]),"icon-text-fit":new be(Tt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new be(Tt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ae(Tt.layout_symbol["icon-image"]),"icon-rotate":new Ae(Tt.layout_symbol["icon-rotate"]),"icon-padding":new Ae(Tt.layout_symbol["icon-padding"]),"icon-keep-upright":new be(Tt.layout_symbol["icon-keep-upright"]),"icon-offset":new Ae(Tt.layout_symbol["icon-offset"]),"icon-anchor":new Ae(Tt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new be(Tt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new be(Tt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new be(Tt.layout_symbol["text-rotation-alignment"]),"text-field":new Ae(Tt.layout_symbol["text-field"]),"text-font":new Ae(Tt.layout_symbol["text-font"]),"text-size":new Ae(Tt.layout_symbol["text-size"]),"text-max-width":new Ae(Tt.layout_symbol["text-max-width"]),"text-line-height":new be(Tt.layout_symbol["text-line-height"]),"text-letter-spacing":new Ae(Tt.layout_symbol["text-letter-spacing"]),"text-justify":new Ae(Tt.layout_symbol["text-justify"]),"text-radial-offset":new Ae(Tt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new be(Tt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ae(Tt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ae(Tt.layout_symbol["text-anchor"]),"text-max-angle":new be(Tt.layout_symbol["text-max-angle"]),"text-writing-mode":new be(Tt.layout_symbol["text-writing-mode"]),"text-rotate":new Ae(Tt.layout_symbol["text-rotate"]),"text-padding":new be(Tt.layout_symbol["text-padding"]),"text-keep-upright":new be(Tt.layout_symbol["text-keep-upright"]),"text-transform":new Ae(Tt.layout_symbol["text-transform"]),"text-offset":new Ae(Tt.layout_symbol["text-offset"]),"text-allow-overlap":new be(Tt.layout_symbol["text-allow-overlap"]),"text-overlap":new be(Tt.layout_symbol["text-overlap"]),"text-ignore-placement":new be(Tt.layout_symbol["text-ignore-placement"]),"text-optional":new be(Tt.layout_symbol["text-optional"])})}};class Jy{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Os,this.defaultValue=e}evaluate(e){if(e.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(e.formattedSection))return o.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}le("FormatSectionOverride",Jy,{omit:["defaultValue"]});class Bd extends es{constructor(e){super(e,sm)}recalculate(e,o){if(super.recalculate(e,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const c=this.layout.get("text-writing-mode");if(c){const d=[];for(const m of c)d.indexOf(m)<0&&d.push(m);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,o,c,d){const m=this.layout.get(e).evaluate(o,{},c,d),y=this._unevaluatedLayout._values[e];return y.isDataDriven()||ql(y.value)||!m?m:function(b,S){return S.replace(/{([^{}]+)}/g,(k,C)=>b&&C in b?String(b[C]):"")}(o.properties,m)}createBucket(e){return new uc(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of sm.paint.overridableProperties){if(!Bd.hasPaintOverride(this.layout,e))continue;const o=this.paint.get(e),c=new Jy(o),d=new pu(c,o.property.specification);let m=null;m=o.value.kind==="constant"||o.value.kind==="source"?new fu("source",d):new Zl("composite",d,o.value.zoomStops),this.paint._values[e]=new fn(o.property,m,o.parameters)}}_handleOverridablePaintPropertyUpdate(e,o,c){return!(!this.layout||o.isDataDriven()||c.isDataDriven())&&Bd.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,o){const c=e.get("text-field"),d=sm.paint.properties[o];let m=!1;const y=b=>{for(const S of b)if(d.overrides&&d.overrides.hasOverride(S))return void(m=!0)};if(c.value.kind==="constant"&&c.value.value instanceof on)y(c.value.value.sections);else if(c.value.kind==="source"){const b=k=>{m||(k instanceof Po&&rr(k.value)===H?y(k.value.sections):k instanceof jl?y(k.sections):k.eachChild(b))},S=c.value;S._styleExpression&&b(S._styleExpression.expression)}return m}}let Qy;var s1={get paint(){return Qy=Qy||new xr({"background-color":new be(Tt.paint_background["background-color"]),"background-pattern":new Cu(Tt.paint_background["background-pattern"]),"background-opacity":new be(Tt.paint_background["background-opacity"])})}};class o1 extends es{constructor(e){super(e,s1)}}let t_;var a1={get paint(){return t_=t_||new xr({"raster-opacity":new be(Tt.paint_raster["raster-opacity"]),"raster-hue-rotate":new be(Tt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new be(Tt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new be(Tt.paint_raster["raster-brightness-max"]),"raster-saturation":new be(Tt.paint_raster["raster-saturation"]),"raster-contrast":new be(Tt.paint_raster["raster-contrast"]),"raster-resampling":new be(Tt.paint_raster["raster-resampling"]),"raster-fade-duration":new be(Tt.paint_raster["raster-fade-duration"])})}};class l1 extends es{constructor(e){super(e,a1)}}class c1 extends es{constructor(e){super(e,{}),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class u1{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const om=63710088e-1;class Ia{constructor(e,o){if(isNaN(e)||isNaN(o))throw new Error(`Invalid LngLat object: (${e}, ${o})`);if(this.lng=+e,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ia(Vt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const o=Math.PI/180,c=this.lat*o,d=e.lat*o,m=Math.sin(c)*Math.sin(d)+Math.cos(c)*Math.cos(d)*Math.cos((e.lng-this.lng)*o);return om*Math.acos(Math.min(m,1))}static convert(e){if(e instanceof Ia)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Ia(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Ia(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const e_=2*Math.PI*om;function i_(r){return e_*Math.cos(r*Math.PI/180)}function r_(r){return(180+r)/360}function n_(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function s_(r,e){return r/i_(e)}function o_(r){return 360*r-180}function am(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}class Rd{constructor(e,o,c=0){this.x=+e,this.y=+o,this.z=+c}static fromLngLat(e,o=0){const c=Ia.convert(e);return new Rd(r_(c.lng),n_(c.lat),s_(o,c.lat))}toLngLat(){return new Ia(o_(this.x),am(this.y))}toAltitude(){return this.z*i_(am(this.y))}meterInMercatorCoordinateUnits(){return 1/e_*(e=am(this.y),1/Math.cos(e*Math.PI/180));var e}}function a_(r,e,o){var c=2*Math.PI*6378137/256/Math.pow(2,o);return[r*c-2*Math.PI*6378137/2,e*c-2*Math.PI*6378137/2]}class lm{constructor(e,o,c){if(e<0||e>25||c<0||c>=Math.pow(2,e)||o<0||o>=Math.pow(2,e))throw new Error(`x=${o}, y=${c}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=o,this.y=c,this.key=Xu(0,e,e,o,c)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,o,c){const d=(y=this.y,b=this.z,S=a_(256*(m=this.x),256*(y=Math.pow(2,b)-y-1),b),k=a_(256*(m+1),256*(y+1),b),S[0]+","+S[1]+","+k[0]+","+k[1]);var m,y,b,S,k;const C=function(L,B,O){let N,q="";for(let X=L;X>0;X--)N=1<<X-1,q+=(B&N?1:0)+(O&N?2:0);return q}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(c==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,o>1?"@2x":"").replace(/{quadkey}/g,C).replace(/{bbox-epsg-3857}/g,d)}isChildOf(e){const o=this.z-e.z;return o>0&&e.x===this.x>>o&&e.y===this.y>>o}getTilePoint(e){const o=Math.pow(2,this.z);return new W((e.x*o-this.x)*Cr,(e.y*o-this.y)*Cr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class l_{constructor(e,o){this.wrap=e,this.canonical=o,this.key=Xu(e,o.z,o.z,o.x,o.y)}}class ds{constructor(e,o,c,d,m){if(e<c)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${c}`);this.overscaledZ=e,this.wrap=o,this.canonical=new lm(c,+d,+m),this.key=Xu(o,e,c,d,m)}clone(){return new ds(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-e;return e>this.canonical.z?new ds(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ds(e,this.wrap,e,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(e,o){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-e;return e>this.canonical.z?Xu(this.wrap*+o,e,this.canonical.z,this.canonical.x,this.canonical.y):Xu(this.wrap*+o,e,e,this.canonical.x>>c,this.canonical.y>>c)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const o=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>o&&e.canonical.y===this.canonical.y>>o}children(e){if(this.overscaledZ>=e)return[new ds(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,c=2*this.canonical.x,d=2*this.canonical.y;return[new ds(o,this.wrap,o,c,d),new ds(o,this.wrap,o,c+1,d),new ds(o,this.wrap,o,c,d+1),new ds(o,this.wrap,o,c+1,d+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ds(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ds(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new l_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Rd(e.x-this.wrap,e.y))}}function Xu(r,e,o,c,d){(r*=2)<0&&(r=-1*r-1);const m=1<<o;return(m*m*r+m*d+c).toString(36)+o.toString(36)+e.toString(36)}le("CanonicalTileID",lm),le("OverscaledTileID",ds,{omit:["posMatrix"]});class c_{constructor(e,o,c,d=1,m=1,y=1,b=0){if(this.uid=e,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(c&&!["mapbox","terrarium","custom"].includes(c))return void ae(`"${c}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=o.height;const S=this.dim=o.height-2;switch(this.data=new Uint32Array(o.data.buffer),c){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=d,this.greenFactor=m,this.blueFactor=y,this.baseShift=b;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let k=0;k<S;k++)this.data[this._idx(-1,k)]=this.data[this._idx(0,k)],this.data[this._idx(S,k)]=this.data[this._idx(S-1,k)],this.data[this._idx(k,-1)]=this.data[this._idx(k,0)],this.data[this._idx(k,S)]=this.data[this._idx(k,S-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(S,-1)]=this.data[this._idx(S-1,0)],this.data[this._idx(-1,S)]=this.data[this._idx(0,S-1)],this.data[this._idx(S,S)]=this.data[this._idx(S-1,S-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let k=0;k<S;k++)for(let C=0;C<S;C++){const L=this.get(k,C);L>this.max&&(this.max=L),L<this.min&&(this.min=L)}}get(e,o){const c=new Uint8Array(this.data.buffer),d=4*this._idx(e,o);return this.unpack(c[d],c[d+1],c[d+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,o){if(e<-1||e>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(e+1)}unpack(e,o,c){return e*this.redFactor+o*this.greenFactor+c*this.blueFactor-this.baseShift}getPixels(){return new hs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,o,c){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let d=o*this.dim,m=o*this.dim+this.dim,y=c*this.dim,b=c*this.dim+this.dim;switch(o){case-1:d=m-1;break;case 1:m=d+1}switch(c){case-1:y=b-1;break;case 1:b=y+1}const S=-o*this.dim,k=-c*this.dim;for(let C=y;C<b;C++)for(let L=d;L<m;L++)this.data[this._idx(L,C)]=e.data[this._idx(L+S,C+k)]}}le("DEMData",c_);class u_{constructor(e){this._stringToNumber={},this._numberToString=[];for(let o=0;o<e.length;o++){const c=e[o];this._stringToNumber[c]=o,this._numberToString[o]=c}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class h_{constructor(e,o,c,d,m){this.type="Feature",this._vectorTileFeature=e,e._z=o,e._x=c,e._y=d,this.properties=e.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(e[o]=this[o]);return e}}class d_{constructor(e,o){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ga(Cr,16,0),this.grid3D=new ga(Cr,16,0),this.featureIndexArray=new zt,this.promoteId=o}insert(e,o,c,d,m,y){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,d,m);const S=y?this.grid3D:this.grid;for(let k=0;k<o.length;k++){const C=o[k],L=[1/0,1/0,-1/0,-1/0];for(let B=0;B<C.length;B++){const O=C[B];L[0]=Math.min(L[0],O.x),L[1]=Math.min(L[1],O.y),L[2]=Math.max(L[2],O.x),L[3]=Math.max(L[3],O.y)}L[0]<Cr&&L[1]<Cr&&L[2]>=0&&L[3]>=0&&S.insert(b,L[0],L[1],L[2],L[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new xa.VectorTile(new Kf(this.rawTileData)).layers,this.sourceLayerCoder=new u_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,o,c,d){this.loadVTLayers();const m=e.params||{},y=Cr/e.tileSize/e.scale,b=gu(m.filter),S=e.queryGeometry,k=e.queryPadding*y,C=f_(S),L=this.grid.query(C.minX-k,C.minY-k,C.maxX+k,C.maxY+k),B=f_(e.cameraQueryGeometry),O=this.grid3D.query(B.minX-k,B.minY-k,B.maxX+k,B.maxY+k,(X,et,dt,ot)=>function(mt,vt,Dt,ee,fe){for(const Kt of mt)if(vt<=Kt.x&&Dt<=Kt.y&&ee>=Kt.x&&fe>=Kt.y)return!0;const Jt=[new W(vt,Dt),new W(vt,fe),new W(ee,fe),new W(ee,Dt)];if(mt.length>2){for(const Kt of Jt)if(rc(mt,Kt))return!0}for(let Kt=0;Kt<mt.length-1;Kt++)if($x(mt[Kt],mt[Kt+1],Jt))return!0;return!1}(e.cameraQueryGeometry,X-k,et-k,dt+k,ot+k));for(const X of O)L.push(X);L.sort(h1);const N={};let q;for(let X=0;X<L.length;X++){const et=L[X];if(et===q)continue;q=et;const dt=this.featureIndexArray.get(et);let ot=null;this.loadMatchingFeature(N,dt.bucketIndex,dt.sourceLayerIndex,dt.featureIndex,b,m.layers,m.availableImages,o,c,d,(mt,vt,Dt)=>(ot||(ot=cl(mt)),vt.queryIntersectsFeature(S,mt,Dt,ot,this.z,e.transform,y,e.pixelPosMatrix)))}return N}loadMatchingFeature(e,o,c,d,m,y,b,S,k,C,L){const B=this.bucketLayerIDs[o];if(y&&!function(X,et){for(let dt=0;dt<X.length;dt++)if(et.indexOf(X[dt])>=0)return!0;return!1}(y,B))return;const O=this.sourceLayerCoder.decode(c),N=this.vtLayers[O].feature(d);if(m.needGeometry){const X=ul(N,!0);if(!m.filter(new Wi(this.tileID.overscaledZ),X,this.tileID.canonical))return}else if(!m.filter(new Wi(this.tileID.overscaledZ),N))return;const q=this.getId(N,O);for(let X=0;X<B.length;X++){const et=B[X];if(y&&y.indexOf(et)<0)continue;const dt=S[et];if(!dt)continue;let ot={};q&&C&&(ot=C.getState(dt.sourceLayer||"_geojsonTileLayer",q));const mt=Rt({},k[et]);mt.paint=p_(mt.paint,dt.paint,N,ot,b),mt.layout=p_(mt.layout,dt.layout,N,ot,b);const vt=!L||L(N,dt,ot);if(!vt)continue;const Dt=new h_(N,this.z,this.x,this.y,q);Dt.layer=mt;let ee=e[et];ee===void 0&&(ee=e[et]=[]),ee.push({featureIndex:d,feature:Dt,intersectionZ:vt})}}lookupSymbolFeatures(e,o,c,d,m,y,b,S){const k={};this.loadVTLayers();const C=gu(m);for(const L of e)this.loadMatchingFeature(k,c,d,L,C,y,b,S,o);return k}hasLayer(e){for(const o of this.bucketLayerIDs)for(const c of o)if(e===c)return!0;return!1}getId(e,o){let c=e.id;return this.promoteId&&(c=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]],typeof c=="boolean"&&(c=Number(c))),c}}function p_(r,e,o,c,d){return Ut(r,(m,y)=>{const b=e instanceof ec?e.get(y):null;return b&&b.evaluate?b.evaluate(o,c,d):b})}function f_(r){let e=1/0,o=1/0,c=-1/0,d=-1/0;for(const m of r)e=Math.min(e,m.x),o=Math.min(o,m.y),c=Math.max(c,m.x),d=Math.max(d,m.y);return{minX:e,minY:o,maxX:c,maxY:d}}function h1(r,e){return e-r}function m_(r,e,o,c,d){const m=[];for(let y=0;y<r.length;y++){const b=r[y];let S;for(let k=0;k<b.length-1;k++){let C=b[k],L=b[k+1];C.x<e&&L.x<e||(C.x<e?C=new W(e,C.y+(e-C.x)/(L.x-C.x)*(L.y-C.y))._round():L.x<e&&(L=new W(e,C.y+(e-C.x)/(L.x-C.x)*(L.y-C.y))._round()),C.y<o&&L.y<o||(C.y<o?C=new W(C.x+(o-C.y)/(L.y-C.y)*(L.x-C.x),o)._round():L.y<o&&(L=new W(C.x+(o-C.y)/(L.y-C.y)*(L.x-C.x),o)._round()),C.x>=c&&L.x>=c||(C.x>=c?C=new W(c,C.y+(c-C.x)/(L.x-C.x)*(L.y-C.y))._round():L.x>=c&&(L=new W(c,C.y+(c-C.x)/(L.x-C.x)*(L.y-C.y))._round()),C.y>=d&&L.y>=d||(C.y>=d?C=new W(C.x+(d-C.y)/(L.y-C.y)*(L.x-C.x),d)._round():L.y>=d&&(L=new W(C.x+(d-C.y)/(L.y-C.y)*(L.x-C.x),d)._round()),S&&C.equals(S[S.length-1])||(S=[C],m.push(S)),S.push(L)))))}}return m}le("FeatureIndex",d_,{omit:["rawTileData","sourceLayerCoder"]});class Ta extends W{constructor(e,o,c,d){super(e,o),this.angle=c,d!==void 0&&(this.segment=d)}clone(){return new Ta(this.x,this.y,this.angle,this.segment)}}function g_(r,e,o,c,d){if(e.segment===void 0||o===0)return!0;let m=e,y=e.segment+1,b=0;for(;b>-o/2;){if(y--,y<0)return!1;b-=r[y].dist(m),m=r[y]}b+=r[y].dist(r[y+1]),y++;const S=[];let k=0;for(;b<o/2;){const C=r[y],L=r[y+1];if(!L)return!1;let B=r[y-1].angleTo(C)-C.angleTo(L);for(B=Math.abs((B+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:b,angleDelta:B}),k+=B;b-S[0].distance>c;)k-=S.shift().angleDelta;if(k>d)return!1;y++,b+=C.dist(L)}return!0}function y_(r){let e=0;for(let o=0;o<r.length-1;o++)e+=r[o].dist(r[o+1]);return e}function __(r,e,o){return r?.6*e*o:0}function v_(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function d1(r,e,o,c,d,m){const y=__(o,d,m),b=v_(o,c)*m;let S=0;const k=y_(r)/2;for(let C=0;C<r.length-1;C++){const L=r[C],B=r[C+1],O=L.dist(B);if(S+O>k){const N=(k-S)/O,q=Rn.number(L.x,B.x,N),X=Rn.number(L.y,B.y,N),et=new Ta(q,X,B.angleTo(L),C);return et._round(),!y||g_(r,et,b,y,e)?et:void 0}S+=O}}function p1(r,e,o,c,d,m,y,b,S){const k=__(c,m,y),C=v_(c,d),L=C*y,B=r[0].x===0||r[0].x===S||r[0].y===0||r[0].y===S;return e-L<e/4&&(e=L+e/4),b_(r,B?e/2*b%e:(C/2+2*m)*y*b%e,e,k,o,L,B,!1,S)}function b_(r,e,o,c,d,m,y,b,S){const k=m/2,C=y_(r);let L=0,B=e-o,O=[];for(let N=0;N<r.length-1;N++){const q=r[N],X=r[N+1],et=q.dist(X),dt=X.angleTo(q);for(;B+o<L+et;){B+=o;const ot=(B-L)/et,mt=Rn.number(q.x,X.x,ot),vt=Rn.number(q.y,X.y,ot);if(mt>=0&&mt<S&&vt>=0&&vt<S&&B-k>=0&&B+k<=C){const Dt=new Ta(mt,vt,dt,N);Dt._round(),c&&!g_(r,Dt,m,c,d)||O.push(Dt)}}L+=et}return b||O.length||y||(O=b_(r,L/2,o,c,d,m,y,!0,S)),O}le("Anchor",Ta);const hc=Vn;function x_(r,e,o,c){const d=[],m=r.image,y=m.pixelRatio,b=m.paddedRect.w-2*hc,S=m.paddedRect.h-2*hc,k=r.right-r.left,C=r.bottom-r.top,L=m.stretchX||[[0,b]],B=m.stretchY||[[0,S]],O=(qt,ce)=>qt+ce[1]-ce[0],N=L.reduce(O,0),q=B.reduce(O,0),X=b-N,et=S-q;let dt=0,ot=N,mt=0,vt=q,Dt=0,ee=X,fe=0,Jt=et;if(m.content&&c){const qt=m.content;dt=Fd(L,0,qt[0]),mt=Fd(B,0,qt[1]),ot=Fd(L,qt[0],qt[2]),vt=Fd(B,qt[1],qt[3]),Dt=qt[0]-dt,fe=qt[1]-mt,ee=qt[2]-qt[0]-ot,Jt=qt[3]-qt[1]-vt}const Kt=(qt,ce,Zt,Nt)=>{const Ie=Od(qt.stretch-dt,ot,k,r.left),_e=Nd(qt.fixed-Dt,ee,qt.stretch,N),ei=Od(ce.stretch-mt,vt,C,r.top),Yi=Nd(ce.fixed-fe,Jt,ce.stretch,q),tr=Od(Zt.stretch-dt,ot,k,r.left),Rr=Nd(Zt.fixed-Dt,ee,Zt.stretch,N),rs=Od(Nt.stretch-mt,vt,C,r.top),En=Nd(Nt.fixed-fe,Jt,Nt.stretch,q),Mr=new W(Ie,ei),Xr=new W(tr,ei),cn=new W(tr,rs),Cn=new W(Ie,rs),Mn=new W(_e/y,Yi/y),Fr=new W(Rr/y,En/y),Or=e*Math.PI/180;if(Or){const yn=Math.sin(Or),$n=Math.cos(Or),jn=[$n,-yn,yn,$n];Mr._matMult(jn),Xr._matMult(jn),Cn._matMult(jn),cn._matMult(jn)}const gn=qt.stretch+qt.fixed,Dn=ce.stretch+ce.fixed;return{tl:Mr,tr:Xr,bl:Cn,br:cn,tex:{x:m.paddedRect.x+hc+gn,y:m.paddedRect.y+hc+Dn,w:Zt.stretch+Zt.fixed-gn,h:Nt.stretch+Nt.fixed-Dn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Mn,pixelOffsetBR:Fr,minFontScaleX:ee/y/k,minFontScaleY:Jt/y/C,isSDF:o}};if(c&&(m.stretchX||m.stretchY)){const qt=w_(L,X,N),ce=w_(B,et,q);for(let Zt=0;Zt<qt.length-1;Zt++){const Nt=qt[Zt],Ie=qt[Zt+1];for(let _e=0;_e<ce.length-1;_e++)d.push(Kt(Nt,ce[_e],Ie,ce[_e+1]))}}else d.push(Kt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:S+1}));return d}function Fd(r,e,o){let c=0;for(const d of r)c+=Math.max(e,Math.min(o,d[1]))-Math.max(e,Math.min(o,d[0]));return c}function w_(r,e,o){const c=[{fixed:-hc,stretch:0}];for(const[d,m]of r){const y=c[c.length-1];c.push({fixed:d-y.stretch,stretch:y.stretch}),c.push({fixed:d-y.stretch,stretch:y.stretch+(m-d)})}return c.push({fixed:e+hc,stretch:o}),c}function Od(r,e,o,c){return r/e*o+c}function Nd(r,e,o,c){return r-e*o/c}class Ud{constructor(e,o,c,d,m,y,b,S,k,C){if(this.boxStartIndex=e.length,k){let L=y.top,B=y.bottom;const O=y.collisionPadding;O&&(L-=O[1],B+=O[3]);let N=B-L;N>0&&(N=Math.max(10,N),this.circleDiameter=N)}else{let L=y.top*b-S[0],B=y.bottom*b+S[2],O=y.left*b-S[3],N=y.right*b+S[1];const q=y.collisionPadding;if(q&&(O-=q[0]*b,L-=q[1]*b,N+=q[2]*b,B+=q[3]*b),C){const X=new W(O,L),et=new W(N,L),dt=new W(O,B),ot=new W(N,B),mt=C*Math.PI/180;X._rotate(mt),et._rotate(mt),dt._rotate(mt),ot._rotate(mt),O=Math.min(X.x,et.x,dt.x,ot.x),N=Math.max(X.x,et.x,dt.x,ot.x),L=Math.min(X.y,et.y,dt.y,ot.y),B=Math.max(X.y,et.y,dt.y,ot.y)}e.emplaceBack(o.x,o.y,O,L,N,B,c,d,m)}this.boxEndIndex=e.length}}class f1{constructor(e=[],o=m1){if(this.data=e,this.length=this.data.length,this.compare=o,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:o,compare:c}=this,d=o[e];for(;e>0;){const m=e-1>>1,y=o[m];if(c(d,y)>=0)break;o[e]=y,e=m}o[e]=d}_down(e){const{data:o,compare:c}=this,d=this.length>>1,m=o[e];for(;e<d;){let y=1+(e<<1),b=o[y];const S=y+1;if(S<this.length&&c(o[S],b)<0&&(y=S,b=o[S]),c(b,m)>=0)break;o[e]=b,e=y}o[e]=m}}function m1(r,e){return r<e?-1:r>e?1:0}function g1(r,e=1,o=!1){let c=1/0,d=1/0,m=-1/0,y=-1/0;const b=r[0];for(let O=0;O<b.length;O++){const N=b[O];(!O||N.x<c)&&(c=N.x),(!O||N.y<d)&&(d=N.y),(!O||N.x>m)&&(m=N.x),(!O||N.y>y)&&(y=N.y)}const S=Math.min(m-c,y-d);let k=S/2;const C=new f1([],y1);if(S===0)return new W(c,d);for(let O=c;O<m;O+=S)for(let N=d;N<y;N+=S)C.push(new dc(O+k,N+k,k,r));let L=function(O){let N=0,q=0,X=0;const et=O[0];for(let dt=0,ot=et.length,mt=ot-1;dt<ot;mt=dt++){const vt=et[dt],Dt=et[mt],ee=vt.x*Dt.y-Dt.x*vt.y;q+=(vt.x+Dt.x)*ee,X+=(vt.y+Dt.y)*ee,N+=3*ee}return new dc(q/N,X/N,0,O)}(r),B=C.length;for(;C.length;){const O=C.pop();(O.d>L.d||!L.d)&&(L=O,o&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,B)),O.max-L.d<=e||(k=O.h/2,C.push(new dc(O.p.x-k,O.p.y-k,k,r)),C.push(new dc(O.p.x+k,O.p.y-k,k,r)),C.push(new dc(O.p.x-k,O.p.y+k,k,r)),C.push(new dc(O.p.x+k,O.p.y+k,k,r)),B+=4)}return o&&(console.log(`num probes: ${B}`),console.log(`best distance: ${L.d}`)),L.p}function y1(r,e){return e.max-r.max}function dc(r,e,o,c){this.p=new W(r,e),this.h=o,this.d=function(d,m){let y=!1,b=1/0;for(let S=0;S<m.length;S++){const k=m[S];for(let C=0,L=k.length,B=L-1;C<L;B=C++){const O=k[C],N=k[B];O.y>d.y!=N.y>d.y&&d.x<(N.x-O.x)*(d.y-O.y)/(N.y-O.y)+O.x&&(y=!y),b=Math.min(b,ny(d,O,N))}}return(y?1:-1)*Math.sqrt(b)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}var ln;l.aq=void 0,(ln=l.aq||(l.aq={}))[ln.center=1]="center",ln[ln.left=2]="left",ln[ln.right=3]="right",ln[ln.top=4]="top",ln[ln.bottom=5]="bottom",ln[ln["top-left"]=6]="top-left",ln[ln["top-right"]=7]="top-right",ln[ln["bottom-left"]=8]="bottom-left",ln[ln["bottom-right"]=9]="bottom-right";const ka=7,cm=Number.POSITIVE_INFINITY;function S_(r,e){return e[1]!==cm?function(o,c,d){let m=0,y=0;switch(c=Math.abs(c),d=Math.abs(d),o){case"top-right":case"top-left":case"top":y=d-ka;break;case"bottom-right":case"bottom-left":case"bottom":y=-d+ka}switch(o){case"top-right":case"bottom-right":case"right":m=-c;break;case"top-left":case"bottom-left":case"left":m=c}return[m,y]}(r,e[0],e[1]):function(o,c){let d=0,m=0;c<0&&(c=0);const y=c/Math.SQRT2;switch(o){case"top-right":case"top-left":m=y-ka;break;case"bottom-right":case"bottom-left":m=-y+ka;break;case"bottom":m=-c+ka;break;case"top":m=c-ka}switch(o){case"top-right":case"bottom-right":d=-y;break;case"top-left":case"bottom-left":d=y;break;case"left":d=c;break;case"right":d=-c}return[d,m]}(r,e[0])}function I_(r,e,o){var c;const d=r.layout,m=(c=d.get("text-variable-anchor-offset"))===null||c===void 0?void 0:c.evaluate(e,{},o);if(m){const b=m.values,S=[];for(let k=0;k<b.length;k+=2){const C=S[k]=b[k],L=b[k+1].map(B=>B*Br);C.startsWith("top")?L[1]-=ka:C.startsWith("bottom")&&(L[1]+=ka),S[k+1]=L}return new Xn(S)}const y=d.get("text-variable-anchor");if(y){let b;b=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[d.get("text-radial-offset").evaluate(e,{},o)*Br,cm]:d.get("text-offset").evaluate(e,{},o).map(k=>k*Br);const S=[];for(const k of y)S.push(k,S_(k,b));return new Xn(S)}return null}function um(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function _1(r,e,o,c,d,m,y,b,S,k,C){let L=m.textMaxSize.evaluate(e,{});L===void 0&&(L=y);const B=r.layers[0].layout,O=B.get("icon-offset").evaluate(e,{},C),N=k_(o.horizontal),q=y/24,X=r.tilePixelRatio*q,et=r.tilePixelRatio*L/24,dt=r.tilePixelRatio*b,ot=r.tilePixelRatio*B.get("symbol-spacing"),mt=B.get("text-padding")*r.tilePixelRatio,vt=function(Nt,Ie,_e,ei=1){const Yi=Nt.get("icon-padding").evaluate(Ie,{},_e),tr=Yi&&Yi.values;return[tr[0]*ei,tr[1]*ei,tr[2]*ei,tr[3]*ei]}(B,e,C,r.tilePixelRatio),Dt=B.get("text-max-angle")/180*Math.PI,ee=B.get("text-rotation-alignment")!=="viewport"&&B.get("symbol-placement")!=="point",fe=B.get("icon-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",Jt=B.get("symbol-placement"),Kt=ot/2,qt=B.get("icon-text-fit");let ce;c&&qt!=="none"&&(r.allowVerticalPlacement&&o.vertical&&(ce=Hy(c,o.vertical,qt,B.get("icon-text-fit-padding"),O,q)),N&&(c=Hy(c,N,qt,B.get("icon-text-fit-padding"),O,q)));const Zt=(Nt,Ie)=>{Ie.x<0||Ie.x>=Cr||Ie.y<0||Ie.y>=Cr||function(_e,ei,Yi,tr,Rr,rs,En,Mr,Xr,cn,Cn,Mn,Fr,Or,gn,Dn,yn,$n,jn,Nr,oi,_n,un,Ur,As){const Zs=_e.addToLineVertexArray(ei,Yi);let Ws,Go,Es,ps,qn=0,Zo=0,th=0,M_=0,_m=-1,vm=-1;const Wo={};let D_=Vo("");if(_e.allowVerticalPlacement&&tr.vertical){const vn=Mr.layout.get("text-rotate").evaluate(oi,{},Ur)+90;Es=new Ud(Xr,ei,cn,Cn,Mn,tr.vertical,Fr,Or,gn,vn),En&&(ps=new Ud(Xr,ei,cn,Cn,Mn,En,yn,$n,gn,vn))}if(Rr){const vn=Mr.layout.get("icon-rotate").evaluate(oi,{}),fs=Mr.layout.get("icon-text-fit")!=="none",dl=x_(Rr,vn,un,fs),Ys=En?x_(En,vn,un,fs):void 0;Go=new Ud(Xr,ei,cn,Cn,Mn,Rr,yn,$n,!1,vn),qn=4*dl.length;const pl=_e.iconSizeData;let fo=null;pl.kind==="source"?(fo=[po*Mr.layout.get("icon-size").evaluate(oi,{})],fo[0]>Sa&&ae(`${_e.layerIds[0]}: Value for "icon-size" is >= ${Ku}. Reduce your "icon-size".`)):pl.kind==="composite"&&(fo=[po*_n.compositeIconSizes[0].evaluate(oi,{},Ur),po*_n.compositeIconSizes[1].evaluate(oi,{},Ur)],(fo[0]>Sa||fo[1]>Sa)&&ae(`${_e.layerIds[0]}: Value for "icon-size" is >= ${Ku}. Reduce your "icon-size".`)),_e.addSymbols(_e.icon,dl,fo,Nr,jn,oi,l.ai.none,ei,Zs.lineStartIndex,Zs.lineLength,-1,Ur),_m=_e.icon.placedSymbolArray.length-1,Ys&&(Zo=4*Ys.length,_e.addSymbols(_e.icon,Ys,fo,Nr,jn,oi,l.ai.vertical,ei,Zs.lineStartIndex,Zs.lineLength,-1,Ur),vm=_e.icon.placedSymbolArray.length-1)}const P_=Object.keys(tr.horizontal);for(const vn of P_){const fs=tr.horizontal[vn];if(!Ws){D_=Vo(fs.text);const Ys=Mr.layout.get("text-rotate").evaluate(oi,{},Ur);Ws=new Ud(Xr,ei,cn,Cn,Mn,fs,Fr,Or,gn,Ys)}const dl=fs.positionedLines.length===1;if(th+=T_(_e,ei,fs,rs,Mr,gn,oi,Dn,Zs,tr.vertical?l.ai.horizontal:l.ai.horizontalOnly,dl?P_:[vn],Wo,_m,_n,Ur),dl)break}tr.vertical&&(M_+=T_(_e,ei,tr.vertical,rs,Mr,gn,oi,Dn,Zs,l.ai.vertical,["vertical"],Wo,vm,_n,Ur));const x1=Ws?Ws.boxStartIndex:_e.collisionBoxArray.length,w1=Ws?Ws.boxEndIndex:_e.collisionBoxArray.length,S1=Es?Es.boxStartIndex:_e.collisionBoxArray.length,I1=Es?Es.boxEndIndex:_e.collisionBoxArray.length,T1=Go?Go.boxStartIndex:_e.collisionBoxArray.length,k1=Go?Go.boxEndIndex:_e.collisionBoxArray.length,A1=ps?ps.boxStartIndex:_e.collisionBoxArray.length,E1=ps?ps.boxEndIndex:_e.collisionBoxArray.length;let Hs=-1;const $d=(vn,fs)=>vn&&vn.circleDiameter?Math.max(vn.circleDiameter,fs):fs;Hs=$d(Ws,Hs),Hs=$d(Es,Hs),Hs=$d(Go,Hs),Hs=$d(ps,Hs);const L_=Hs>-1?1:0;L_&&(Hs*=As/Br),_e.glyphOffsetArray.length>=uc.MAX_GLYPHS&&ae("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),oi.sortKey!==void 0&&_e.addToSortKeyRanges(_e.symbolInstances.length,oi.sortKey);const C1=I_(Mr,oi,Ur),[M1,D1]=function(vn,fs){const dl=vn.length,Ys=fs==null?void 0:fs.values;if((Ys==null?void 0:Ys.length)>0)for(let pl=0;pl<Ys.length;pl+=2){const fo=Ys[pl+1];vn.emplaceBack(l.aq[Ys[pl]],fo[0],fo[1])}return[dl,vn.length]}(_e.textAnchorOffsets,C1);_e.symbolInstances.emplaceBack(ei.x,ei.y,Wo.right>=0?Wo.right:-1,Wo.center>=0?Wo.center:-1,Wo.left>=0?Wo.left:-1,Wo.vertical||-1,_m,vm,D_,x1,w1,S1,I1,T1,k1,A1,E1,cn,th,M_,qn,Zo,L_,0,Fr,Hs,M1,D1)}(r,Ie,Nt,o,c,d,ce,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,X,[mt,mt,mt,mt],ee,S,dt,vt,fe,O,e,m,k,C,y)};if(Jt==="line")for(const Nt of m_(e.geometry,0,0,Cr,Cr)){const Ie=p1(Nt,ot,Dt,o.vertical||N,c,24,et,r.overscaling,Cr);for(const _e of Ie)N&&v1(r,N.text,Kt,_e)||Zt(Nt,_e)}else if(Jt==="line-center"){for(const Nt of e.geometry)if(Nt.length>1){const Ie=d1(Nt,Dt,o.vertical||N,c,24,et);Ie&&Zt(Nt,Ie)}}else if(e.type==="Polygon")for(const Nt of $f(e.geometry,0)){const Ie=g1(Nt,16);Zt(Nt[0],new Ta(Ie.x,Ie.y,0))}else if(e.type==="LineString")for(const Nt of e.geometry)Zt(Nt,new Ta(Nt[0].x,Nt[0].y,0));else if(e.type==="Point")for(const Nt of e.geometry)for(const Ie of Nt)Zt([Ie],new Ta(Ie.x,Ie.y,0))}function T_(r,e,o,c,d,m,y,b,S,k,C,L,B,O,N){const q=function(dt,ot,mt,vt,Dt,ee,fe,Jt){const Kt=vt.layout.get("text-rotate").evaluate(ee,{})*Math.PI/180,qt=[];for(const ce of ot.positionedLines)for(const Zt of ce.positionedGlyphs){if(!Zt.rect)continue;const Nt=Zt.rect||{};let Ie=Vy+1,_e=!0,ei=1,Yi=0;const tr=(Dt||Jt)&&Zt.vertical,Rr=Zt.metrics.advance*Zt.scale/2;if(Jt&&ot.verticalizable&&(Yi=ce.lineOffset/2-(Zt.imageName?-(Br-Zt.metrics.width*Zt.scale)/2:(Zt.scale-1)*Br)),Zt.imageName){const Nr=fe[Zt.imageName];_e=Nr.sdf,ei=Nr.pixelRatio,Ie=Vn/ei}const rs=Dt?[Zt.x+Rr,Zt.y]:[0,0];let En=Dt?[0,0]:[Zt.x+Rr+mt[0],Zt.y+mt[1]-Yi],Mr=[0,0];tr&&(Mr=En,En=[0,0]);const Xr=Zt.metrics.isDoubleResolution?2:1,cn=(Zt.metrics.left-Ie)*Zt.scale-Rr+En[0],Cn=(-Zt.metrics.top-Ie)*Zt.scale+En[1],Mn=cn+Nt.w/Xr*Zt.scale/ei,Fr=Cn+Nt.h/Xr*Zt.scale/ei,Or=new W(cn,Cn),gn=new W(Mn,Cn),Dn=new W(cn,Fr),yn=new W(Mn,Fr);if(tr){const Nr=new W(-Rr,Rr-Hu),oi=-Math.PI/2,_n=Br/2-Rr,un=new W(5-Hu-_n,-(Zt.imageName?_n:0)),Ur=new W(...Mr);Or._rotateAround(oi,Nr)._add(un)._add(Ur),gn._rotateAround(oi,Nr)._add(un)._add(Ur),Dn._rotateAround(oi,Nr)._add(un)._add(Ur),yn._rotateAround(oi,Nr)._add(un)._add(Ur)}if(Kt){const Nr=Math.sin(Kt),oi=Math.cos(Kt),_n=[oi,-Nr,Nr,oi];Or._matMult(_n),gn._matMult(_n),Dn._matMult(_n),yn._matMult(_n)}const $n=new W(0,0),jn=new W(0,0);qt.push({tl:Or,tr:gn,bl:Dn,br:yn,tex:Nt,writingMode:ot.writingMode,glyphOffset:rs,sectionIndex:Zt.sectionIndex,isSDF:_e,pixelOffsetTL:$n,pixelOffsetBR:jn,minFontScaleX:0,minFontScaleY:0})}return qt}(0,o,b,d,m,y,c,r.allowVerticalPlacement),X=r.textSizeData;let et=null;X.kind==="source"?(et=[po*d.layout.get("text-size").evaluate(y,{})],et[0]>Sa&&ae(`${r.layerIds[0]}: Value for "text-size" is >= ${Ku}. Reduce your "text-size".`)):X.kind==="composite"&&(et=[po*O.compositeTextSizes[0].evaluate(y,{},N),po*O.compositeTextSizes[1].evaluate(y,{},N)],(et[0]>Sa||et[1]>Sa)&&ae(`${r.layerIds[0]}: Value for "text-size" is >= ${Ku}. Reduce your "text-size".`)),r.addSymbols(r.text,q,et,b,m,y,k,e,S.lineStartIndex,S.lineLength,B,N);for(const dt of C)L[dt]=r.text.placedSymbolArray.length-1;return 4*q.length}function k_(r){for(const e in r)return r[e];return null}function v1(r,e,o,c){const d=r.compareText;if(e in d){const m=d[e];for(let y=m.length-1;y>=0;y--)if(c.dist(m[y])<o)return!0}else d[e]=[];return d[e].push(c),!1}const A_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class hm{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,c]=new Uint8Array(e,0,2);if(o!==219)throw new Error("Data does not appear to be in a KDBush format.");const d=c>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);const m=A_[15&c];if(!m)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(e,2,1),[b]=new Uint32Array(e,4,1);return new hm(b,y,m,e)}constructor(e,o=64,c=Float64Array,d){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=c,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const m=A_.indexOf(this.ArrayType),y=2*e*this.ArrayType.BYTES_PER_ELEMENT,b=e*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-b%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${c}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+S,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+y+b+S),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+S,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=e)}add(e,o){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=e,this.coords[this._pos++]=o,c}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return dm(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,o,c,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:y,nodeSize:b}=this,S=[0,m.length-1,0],k=[];for(;S.length;){const C=S.pop()||0,L=S.pop()||0,B=S.pop()||0;if(L-B<=b){for(let X=B;X<=L;X++){const et=y[2*X],dt=y[2*X+1];et>=e&&et<=c&&dt>=o&&dt<=d&&k.push(m[X])}continue}const O=B+L>>1,N=y[2*O],q=y[2*O+1];N>=e&&N<=c&&q>=o&&q<=d&&k.push(m[O]),(C===0?e<=N:o<=q)&&(S.push(B),S.push(O-1),S.push(1-C)),(C===0?c>=N:d>=q)&&(S.push(O+1),S.push(L),S.push(1-C))}return k}within(e,o,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:m,nodeSize:y}=this,b=[0,d.length-1,0],S=[],k=c*c;for(;b.length;){const C=b.pop()||0,L=b.pop()||0,B=b.pop()||0;if(L-B<=y){for(let X=B;X<=L;X++)C_(m[2*X],m[2*X+1],e,o)<=k&&S.push(d[X]);continue}const O=B+L>>1,N=m[2*O],q=m[2*O+1];C_(N,q,e,o)<=k&&S.push(d[O]),(C===0?e-c<=N:o-c<=q)&&(b.push(B),b.push(O-1),b.push(1-C)),(C===0?e+c>=N:o+c>=q)&&(b.push(O+1),b.push(L),b.push(1-C))}return S}}function dm(r,e,o,c,d,m){if(d-c<=o)return;const y=c+d>>1;E_(r,e,y,c,d,m),dm(r,e,o,c,y-1,1-m),dm(r,e,o,y+1,d,1-m)}function E_(r,e,o,c,d,m){for(;d>c;){if(d-c>600){const k=d-c+1,C=o-c+1,L=Math.log(k),B=.5*Math.exp(2*L/3),O=.5*Math.sqrt(L*B*(k-B)/k)*(C-k/2<0?-1:1);E_(r,e,o,Math.max(c,Math.floor(o-C*B/k+O)),Math.min(d,Math.floor(o+(k-C)*B/k+O)),m)}const y=e[2*o+m];let b=c,S=d;for(Ju(r,e,c,o),e[2*d+m]>y&&Ju(r,e,c,d);b<S;){for(Ju(r,e,b,S),b++,S--;e[2*b+m]<y;)b++;for(;e[2*S+m]>y;)S--}e[2*c+m]===y?Ju(r,e,c,S):(S++,Ju(r,e,S,d)),S<=o&&(c=S+1),o<=S&&(d=S-1)}}function Ju(r,e,o,c){pm(r,o,c),pm(e,2*o,2*c),pm(e,2*o+1,2*c+1)}function pm(r,e,o){const c=r[e];r[e]=r[o],r[o]=c}function C_(r,e,o,c){const d=r-o,m=e-c;return d*d+m*m}var fm;l.bh=void 0,(fm=l.bh||(l.bh={})).create="create",fm.load="load",fm.fullLoad="fullLoad";let Vd=null,Qu=[];const mm=1e3/60,gm="loadTime",ym="fullLoadTime",b1={mark(r){performance.mark(r)},frame(r){const e=r;Vd!=null&&Qu.push(e-Vd),Vd=e},clearMetrics(){Vd=null,Qu=[],performance.clearMeasures(gm),performance.clearMeasures(ym);for(const r in l.bh)performance.clearMarks(l.bh[r])},getPerformanceMetrics(){performance.measure(gm,l.bh.create,l.bh.load),performance.measure(ym,l.bh.create,l.bh.fullLoad);const r=performance.getEntriesByName(gm)[0].duration,e=performance.getEntriesByName(ym)[0].duration,o=Qu.length,c=1/(Qu.reduce((m,y)=>m+y,0)/o/1e3),d=Qu.filter(m=>m>mm).reduce((m,y)=>m+(y-mm)/mm,0);return{loadTime:r,fullLoadTime:e,fps:c,percentDroppedFrames:d/(o+d)*100,totalFrames:o}}};l.$=function(r,e,o){var c,d,m,y,b,S,k,C,L,B,O,N,q=o[0],X=o[1],et=o[2];return e===r?(r[12]=e[0]*q+e[4]*X+e[8]*et+e[12],r[13]=e[1]*q+e[5]*X+e[9]*et+e[13],r[14]=e[2]*q+e[6]*X+e[10]*et+e[14],r[15]=e[3]*q+e[7]*X+e[11]*et+e[15]):(d=e[1],m=e[2],y=e[3],b=e[4],S=e[5],k=e[6],C=e[7],L=e[8],B=e[9],O=e[10],N=e[11],r[0]=c=e[0],r[1]=d,r[2]=m,r[3]=y,r[4]=b,r[5]=S,r[6]=k,r[7]=C,r[8]=L,r[9]=B,r[10]=O,r[11]=N,r[12]=c*q+b*X+L*et+e[12],r[13]=d*q+S*X+B*et+e[13],r[14]=m*q+k*X+O*et+e[14],r[15]=y*q+C*X+N*et+e[15]),r},l.A=nc,l.B=Rn,l.C=class{constructor(r,e,o){this.receive=c=>{const d=c.data,m=d.id;if(m&&(!d.targetMapId||this.mapId===d.targetMapId))if(d.type==="<cancel>"){delete this.tasks[m];const y=this.cancelCallbacks[m];delete this.cancelCallbacks[m],y&&y()}else se()||d.mustQueue?(this.tasks[m]=d,this.taskQueue.push(m),this.invoker.trigger()):this.processTask(m,d)},this.process=()=>{if(!this.taskQueue.length)return;const c=this.taskQueue.shift(),d=this.tasks[c];delete this.tasks[c],this.taskQueue.length&&this.invoker.trigger(),d&&this.processTask(c,d)},this.target=r,this.parent=e,this.mapId=o,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new u1(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=se()?r:window}send(r,e,o,c,d=!1){const m=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(this.callbacks[m]=o);const y=[],b={id:m,type:r,hasCallback:!!o,targetMapId:c,mustQueue:d,sourceMapId:this.mapId,data:co(e,y)};return this.target.postMessage(b,{transfer:y}),{cancel:()=>{o&&delete this.callbacks[m],this.target.postMessage({id:m,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}processTask(r,e){if(e.type==="<response>"){const o=this.callbacks[r];delete this.callbacks[r],o&&(e.error?o(ya(e.error)):o(null,ya(e.data)))}else{let o=!1;const c=[],d=e.hasCallback?(b,S)=>{o=!0,delete this.cancelCallbacks[r];const k={id:r,type:"<response>",sourceMapId:this.mapId,error:b?co(b):null,data:co(S,c)};this.target.postMessage(k,{transfer:c})}:b=>{o=!0};let m=null;const y=ya(e.data);if(this.parent[e.type])m=this.parent[e.type](e.sourceMapId,y,d);else if("getWorkerSource"in this.parent){const b=e.type.split(".");m=this.parent.getWorkerSource(e.sourceMapId,b[0],y.source)[b[1]](y,d)}else d(new Error(`Could not find function ${e.type}`));!o&&m&&m.cancel&&(this.cancelCallbacks[r]=m.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.D=be,l.E=Sn,l.F=function(r,e){const o={};for(let c=0;c<e.length;c++){const d=e[c];d in r&&(o[d]=r[d])}return o},l.G=r_,l.H=n_,l.I=Jf,l.J=It,l.K=_t,l.L=Ia,l.M=ti,l.N=Cr,l.O=ds,l.P=W,l.Q=or,l.R=hs,l.S=Hi,l.T=gd,l.U=Rd,l.V=class extends No{},l.W=lm,l.X=function(r,e){const o=window.document.createElement("video");o.muted=!0,o.onloadstart=function(){e(null,o)};for(let c=0;c<r.length;c++){const d=window.document.createElement("source");ir(r[c])||(o.crossOrigin="Anonymous"),d.src=r[c],o.appendChild(d)}return{cancel:()=>{}}},l.Y=Gt,l.Z=function(){var r=new nc(16);return nc!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},l._=P,l.a=ie,l.a$=class extends F{},l.a0=function(r,e,o){var c=o[0],d=o[1],m=o[2];return r[0]=e[0]*c,r[1]=e[1]*c,r[2]=e[2]*c,r[3]=e[3]*c,r[4]=e[4]*d,r[5]=e[5]*d,r[6]=e[6]*d,r[7]=e[7]*d,r[8]=e[8]*m,r[9]=e[9]*m,r[10]=e[10]*m,r[11]=e[11]*m,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},l.a1=ly,l.a2=function(){return Qt++},l.a3=Y,l.a4=uc,l.a5=function(){Nn.isLoading()||Nn.isLoaded()||Au()!=="deferred"||md()},l.a6=gu,l.a7=ul,l.a8=Wi,l.a9=h_,l.aA=nl,l.aB=function(r){r=r.slice();const e=Object.create(null);for(let o=0;o<r.length;o++)e[r[o].id]=r[o];for(let o=0;o<r.length;o++)"ref"in r[o]&&(r[o]=dn(r[o],e[r[o].ref]));return r},l.aC=function(r){if(r.type==="custom")return new c1(r);switch(r.type){case"background":return new o1(r);case"circle":return new Gx(r);case"fill":return new hw(r);case"fill-extrusion":return new kw(r);case"heatmap":return new Wx(r);case"hillshade":return new Yx(r);case"line":return new zw(r);case"raster":return new l1(r);case"symbol":return new Bd(r)}},l.aD=jt,l.aE=function(r,e){if(!r)return[{command:gi.setStyle,args:[e]}];let o=[];try{if(!Ei(r.version,e.version))return[{command:gi.setStyle,args:[e]}];Ei(r.center,e.center)||o.push({command:gi.setCenter,args:[e.center]}),Ei(r.zoom,e.zoom)||o.push({command:gi.setZoom,args:[e.zoom]}),Ei(r.bearing,e.bearing)||o.push({command:gi.setBearing,args:[e.bearing]}),Ei(r.pitch,e.pitch)||o.push({command:gi.setPitch,args:[e.pitch]}),Ei(r.sprite,e.sprite)||o.push({command:gi.setSprite,args:[e.sprite]}),Ei(r.glyphs,e.glyphs)||o.push({command:gi.setGlyphs,args:[e.glyphs]}),Ei(r.transition,e.transition)||o.push({command:gi.setTransition,args:[e.transition]}),Ei(r.light,e.light)||o.push({command:gi.setLight,args:[e.light]});const c={},d=[];(function(y,b,S,k){let C;for(C in b=b||{},y=y||{})Object.prototype.hasOwnProperty.call(y,C)&&(Object.prototype.hasOwnProperty.call(b,C)||Fs(C,S,k));for(C in b)Object.prototype.hasOwnProperty.call(b,C)&&(Object.prototype.hasOwnProperty.call(y,C)?Ei(y[C],b[C])||(y[C].type==="geojson"&&b[C].type==="geojson"&&Za(y,b,C)?S.push({command:gi.setGeoJSONSourceData,args:[C,b[C].data]}):Zr(C,b,S,k)):nn(C,b,S))})(r.sources,e.sources,d,c);const m=[];r.layers&&r.layers.forEach(y=>{c[y.source]?o.push({command:gi.removeLayer,args:[y.id]}):m.push(y)}),o=o.concat(d),function(y,b,S){b=b||[];const k=(y=y||[]).map(no),C=b.map(no),L=y.reduce(Mo,{}),B=b.reduce(Mo,{}),O=k.slice(),N=Object.create(null);let q,X,et,dt,ot,mt,vt;for(q=0,X=0;q<k.length;q++)et=k[q],Object.prototype.hasOwnProperty.call(B,et)?X++:(S.push({command:gi.removeLayer,args:[et]}),O.splice(O.indexOf(et,X),1));for(q=0,X=0;q<C.length;q++)et=C[C.length-1-q],O[O.length-1-q]!==et&&(Object.prototype.hasOwnProperty.call(L,et)?(S.push({command:gi.removeLayer,args:[et]}),O.splice(O.lastIndexOf(et,O.length-X),1)):X++,mt=O[O.length-q],S.push({command:gi.addLayer,args:[B[et],mt]}),O.splice(O.length-q,0,et),N[et]=!0);for(q=0;q<C.length;q++)if(et=C[q],dt=L[et],ot=B[et],!N[et]&&!Ei(dt,ot))if(Ei(dt.source,ot.source)&&Ei(dt["source-layer"],ot["source-layer"])&&Ei(dt.type,ot.type)){for(vt in ro(dt.layout,ot.layout,S,et,null,gi.setLayoutProperty),ro(dt.paint,ot.paint,S,et,null,gi.setPaintProperty),Ei(dt.filter,ot.filter)||S.push({command:gi.setFilter,args:[et,ot.filter]}),Ei(dt.minzoom,ot.minzoom)&&Ei(dt.maxzoom,ot.maxzoom)||S.push({command:gi.setLayerZoomRange,args:[et,ot.minzoom,ot.maxzoom]}),dt)Object.prototype.hasOwnProperty.call(dt,vt)&&vt!=="layout"&&vt!=="paint"&&vt!=="filter"&&vt!=="metadata"&&vt!=="minzoom"&&vt!=="maxzoom"&&(vt.indexOf("paint.")===0?ro(dt[vt],ot[vt],S,et,vt.slice(6),gi.setPaintProperty):Ei(dt[vt],ot[vt])||S.push({command:gi.setLayerProperty,args:[et,vt,ot[vt]]}));for(vt in ot)Object.prototype.hasOwnProperty.call(ot,vt)&&!Object.prototype.hasOwnProperty.call(dt,vt)&&vt!=="layout"&&vt!=="paint"&&vt!=="filter"&&vt!=="metadata"&&vt!=="minzoom"&&vt!=="maxzoom"&&(vt.indexOf("paint.")===0?ro(dt[vt],ot[vt],S,et,vt.slice(6),gi.setPaintProperty):Ei(dt[vt],ot[vt])||S.push({command:gi.setLayerProperty,args:[et,vt,ot[vt]]}))}else S.push({command:gi.removeLayer,args:[et]}),mt=O[O.lastIndexOf(et)+1],S.push({command:gi.addLayer,args:[ot,mt]})}(m,e.layers,o)}catch(c){console.warn("Unable to compute style diff:",c),o=[{command:gi.setStyle,args:[e]}]}return o},l.aF=function(r){const e=[],o=r.id;return o===void 0&&e.push({message:`layers.${o}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${o}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),e},l.aG=function r(e,o){if(Array.isArray(e)){if(!Array.isArray(o)||e.length!==o.length)return!1;for(let c=0;c<e.length;c++)if(!r(e[c],o[c]))return!1;return!0}if(typeof e=="object"&&e!==null&&o!==null){if(typeof o!="object"||Object.keys(e).length!==Object.keys(o).length)return!1;for(const c in e)if(!r(e[c],o[c]))return!1;return!0}return e===o},l.aH=Ut,l.aI=me,l.aJ=sl,l.aK=function(r){return r({pluginStatus:Tn,pluginURL:uo}),sl.on("pluginStateChange",r),r},l.aL=class extends $o{constructor(r,e){super(r,e),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},l.aM=ic,l.aN=class extends $o{constructor(r,e){super(r,e),this.current=Mf}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let e=1;e<16;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},l.aO=bd,l.aP=class extends $o{constructor(r,e){super(r,e),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},l.aQ=class extends $o{constructor(r,e){super(r,e),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},l.aR=xd,l.aS=function(r,e,o,c,d,m,y){var b=1/(e-o),S=1/(c-d),k=1/(m-y);return r[0]=-2*b,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*S,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*k,r[11]=0,r[12]=(e+o)*b,r[13]=(d+c)*S,r[14]=(y+m)*k,r[15]=1,r},l.aT=Di,l.aU=qx,l.aV=class extends h{},l.aW=Ow,l.aX=class extends g{},l.aY=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},l.aZ=py,l.a_=$t,l.aa=function(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,c,d,m)=>{const y=d||m;return e[c]=!y||y.toLowerCase(),""}),e["max-age"]){const o=parseInt(e["max-age"],10);isNaN(o)?delete e["max-age"]:e["max-age"]=o}return e},l.ab=function(r,e){const o=[];for(const c in r)c in e||o.push(c);return o},l.ac=function(r){if(ne==null){const e=r.navigator?r.navigator.userAgent:null;ne=!!r.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return ne},l.ad=Lt,l.ae=function(r,e,o){var c=Math.sin(o),d=Math.cos(o),m=e[0],y=e[1],b=e[2],S=e[3],k=e[4],C=e[5],L=e[6],B=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=m*d+k*c,r[1]=y*d+C*c,r[2]=b*d+L*c,r[3]=S*d+B*c,r[4]=k*d-m*c,r[5]=C*d-y*c,r[6]=L*d-b*c,r[7]=B*d-S*c,r},l.af=function(r){var e=new nc(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e},l.ag=Td,l.ah=function(r,e){let o=0,c=0;if(r.kind==="constant")c=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:d,minZoom:m,maxZoom:y}=r,b=d?Lt(Fn.interpolationFactor(d,e,m,y),0,1):0;r.kind==="camera"?c=Rn.number(r.minSize,r.maxSize,b):o=b}return{uSizeT:o,uSize:c}},l.aj=function(r,{uSize:e,uSizeT:o},{lowerSize:c,upperSize:d}){return r.kind==="source"?c/po:r.kind==="composite"?Rn.number(c/po,d/po,o):e},l.ak=im,l.al=function(r,e,o,c){const d=e.y-r.y,m=e.x-r.x,y=c.y-o.y,b=c.x-o.x,S=y*m-b*d;if(S===0)return null;const k=(b*(r.y-o.y)-y*(r.x-o.x))/S;return new W(r.x+k*m,r.y+k*d)},l.am=m_,l.an=iy,l.ao=Bf,l.ap=Br,l.ar=em,l.as=function(r,e){var o=e[0],c=e[1],d=e[2],m=e[3],y=e[4],b=e[5],S=e[6],k=e[7],C=e[8],L=e[9],B=e[10],O=e[11],N=e[12],q=e[13],X=e[14],et=e[15],dt=o*b-c*y,ot=o*S-d*y,mt=o*k-m*y,vt=c*S-d*b,Dt=c*k-m*b,ee=d*k-m*S,fe=C*q-L*N,Jt=C*X-B*N,Kt=C*et-O*N,qt=L*X-B*q,ce=L*et-O*q,Zt=B*et-O*X,Nt=dt*Zt-ot*ce+mt*qt+vt*Kt-Dt*Jt+ee*fe;return Nt?(r[0]=(b*Zt-S*ce+k*qt)*(Nt=1/Nt),r[1]=(d*ce-c*Zt-m*qt)*Nt,r[2]=(q*ee-X*Dt+et*vt)*Nt,r[3]=(B*Dt-L*ee-O*vt)*Nt,r[4]=(S*Kt-y*Zt-k*Jt)*Nt,r[5]=(o*Zt-d*Kt+m*Jt)*Nt,r[6]=(X*mt-N*ee-et*ot)*Nt,r[7]=(C*ee-B*mt+O*ot)*Nt,r[8]=(y*ce-b*Kt+k*fe)*Nt,r[9]=(c*Kt-o*ce-m*fe)*Nt,r[10]=(N*Dt-q*mt+et*dt)*Nt,r[11]=(L*mt-C*Dt-O*dt)*Nt,r[12]=(b*Jt-y*qt-S*fe)*Nt,r[13]=(o*qt-c*Jt+d*fe)*Nt,r[14]=(q*ot-N*vt-X*dt)*Nt,r[15]=(C*vt-L*ot+B*dt)*Nt,r):null},l.at=um,l.au=tm,l.av=hm,l.aw=function(){const r={},e=Tt.$version;for(const o in Tt.$root){const c=Tt.$root[o];if(c.required){let d=null;d=o==="version"?e:c.type==="array"?[]:{},d!=null&&(r[o]=d)}}return r},l.ax=gi,l.ay=hd,l.az=ze,l.b=function(r,e){const o=new Blob([new Uint8Array(r)],{type:"image/png"});createImageBitmap(o).then(c=>{e(null,c)}).catch(c=>{e(new Error(`Could not load image because of ${c.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},l.b0=Yr,l.b1=function(r,e){var o=r[0],c=r[1],d=r[2],m=r[3],y=r[4],b=r[5],S=r[6],k=r[7],C=r[8],L=r[9],B=r[10],O=r[11],N=r[12],q=r[13],X=r[14],et=r[15],dt=e[0],ot=e[1],mt=e[2],vt=e[3],Dt=e[4],ee=e[5],fe=e[6],Jt=e[7],Kt=e[8],qt=e[9],ce=e[10],Zt=e[11],Nt=e[12],Ie=e[13],_e=e[14],ei=e[15];return Math.abs(o-dt)<=An*Math.max(1,Math.abs(o),Math.abs(dt))&&Math.abs(c-ot)<=An*Math.max(1,Math.abs(c),Math.abs(ot))&&Math.abs(d-mt)<=An*Math.max(1,Math.abs(d),Math.abs(mt))&&Math.abs(m-vt)<=An*Math.max(1,Math.abs(m),Math.abs(vt))&&Math.abs(y-Dt)<=An*Math.max(1,Math.abs(y),Math.abs(Dt))&&Math.abs(b-ee)<=An*Math.max(1,Math.abs(b),Math.abs(ee))&&Math.abs(S-fe)<=An*Math.max(1,Math.abs(S),Math.abs(fe))&&Math.abs(k-Jt)<=An*Math.max(1,Math.abs(k),Math.abs(Jt))&&Math.abs(C-Kt)<=An*Math.max(1,Math.abs(C),Math.abs(Kt))&&Math.abs(L-qt)<=An*Math.max(1,Math.abs(L),Math.abs(qt))&&Math.abs(B-ce)<=An*Math.max(1,Math.abs(B),Math.abs(ce))&&Math.abs(O-Zt)<=An*Math.max(1,Math.abs(O),Math.abs(Zt))&&Math.abs(N-Nt)<=An*Math.max(1,Math.abs(N),Math.abs(Nt))&&Math.abs(q-Ie)<=An*Math.max(1,Math.abs(q),Math.abs(Ie))&&Math.abs(X-_e)<=An*Math.max(1,Math.abs(X),Math.abs(_e))&&Math.abs(et-ei)<=An*Math.max(1,Math.abs(et),Math.abs(ei))},l.b2=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},l.b3=function(r,e,o){return r[0]=e[0]*o[0],r[1]=e[1]*o[1],r[2]=e[2]*o[2],r[3]=e[3]*o[3],r},l.b4=function(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]},l.b5=Vt,l.b6=l_,l.b7=s_,l.b8=function(r,e,o,c,d){var m,y=1/Math.tan(e/2);return r[0]=y/o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=y,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,d!=null&&d!==1/0?(r[10]=(d+c)*(m=1/(c-d)),r[14]=2*d*c*m):(r[10]=-1,r[14]=-2*c),r},l.b9=function(r,e,o){var c=Math.sin(o),d=Math.cos(o),m=e[4],y=e[5],b=e[6],S=e[7],k=e[8],C=e[9],L=e[10],B=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=m*d+k*c,r[5]=y*d+C*c,r[6]=b*d+L*c,r[7]=S*d+B*c,r[8]=k*d-m*c,r[9]=C*d-y*c,r[10]=L*d-b*c,r[11]=B*d-S*c,r},l.bA=U,l.bB=zy,l.bC=Gl,l.bD=Nn,l.ba=gt,l.bb=kt,l.bc=function(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},l.bd=class extends ll{},l.be=om,l.bf=o_,l.bg=b1,l.bi=Xt,l.bj=function(r,e,o=!1){if(Tn===wu||Tn===Su||Tn===Iu)throw new Error("setRTLTextPlugin cannot be called multiple times.");uo=xi.resolveURL(r),Tn=wu,Tu=e,ku(),o||md()},l.bk=Au,l.bl=function(r,e){const o={};for(let d=0;d<r.length;d++){const m=e&&e[r[d].id]||Yl(r[d]);e&&(e[r[d].id]=m);let y=o[m];y||(y=o[m]=[]),y.push(r[d])}const c=[];for(const d in o)c.push(o[d]);return c},l.bm=le,l.bn=u_,l.bo=d_,l.bp=jy,l.bq=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=Cr/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const e=r.bucket.layers[0],o=e.layout,c=e._unevaluatedLayout._values,d={layoutIconSize:c["icon-size"].possiblyEvaluate(new Wi(r.bucket.zoom+1),r.canonical),layoutTextSize:c["text-size"].possiblyEvaluate(new Wi(r.bucket.zoom+1),r.canonical),textMaxSize:c["text-size"].possiblyEvaluate(new Wi(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:k,maxZoom:C}=r.bucket.textSizeData;d.compositeTextSizes=[c["text-size"].possiblyEvaluate(new Wi(k),r.canonical),c["text-size"].possiblyEvaluate(new Wi(C),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:k,maxZoom:C}=r.bucket.iconSizeData;d.compositeIconSizes=[c["icon-size"].possiblyEvaluate(new Wi(k),r.canonical),c["icon-size"].possiblyEvaluate(new Wi(C),r.canonical)]}const m=o.get("text-line-height")*Br,y=o.get("text-rotation-alignment")!=="viewport"&&o.get("symbol-placement")!=="point",b=o.get("text-keep-upright"),S=o.get("text-size");for(const k of r.bucket.features){const C=o.get("text-font").evaluate(k,{},r.canonical).join(","),L=S.evaluate(k,{},r.canonical),B=d.layoutTextSize.evaluate(k,{},r.canonical),O=d.layoutIconSize.evaluate(k,{},r.canonical),N={horizontal:{},vertical:void 0},q=k.text;let X,et=[0,0];if(q){const mt=q.toString(),vt=o.get("text-letter-spacing").evaluate(k,{},r.canonical)*Br,Dt=bu(mt)?vt:0,ee=o.get("text-anchor").evaluate(k,{},r.canonical),fe=I_(e,k,r.canonical);if(!fe){const Zt=o.get("text-radial-offset").evaluate(k,{},r.canonical);et=Zt?S_(ee,[Zt*Br,cm]):o.get("text-offset").evaluate(k,{},r.canonical).map(Nt=>Nt*Br)}let Jt=y?"center":o.get("text-justify").evaluate(k,{},r.canonical);const Kt=o.get("symbol-placement"),qt=Kt==="point"?o.get("text-max-width").evaluate(k,{},r.canonical)*Br:0,ce=()=>{r.bucket.allowVerticalPlacement&&vu(mt)&&(N.vertical=Pd(q,r.glyphMap,r.glyphPositions,r.imagePositions,C,qt,m,ee,"left",Dt,et,l.ai.vertical,!0,Kt,B,L))};if(!y&&fe){const Zt=new Set;if(Jt==="auto")for(let Ie=0;Ie<fe.values.length;Ie+=2)Zt.add(um(fe.values[Ie]));else Zt.add(Jt);let Nt=!1;for(const Ie of Zt)if(!N.horizontal[Ie])if(Nt)N.horizontal[Ie]=N.horizontal[0];else{const _e=Pd(q,r.glyphMap,r.glyphPositions,r.imagePositions,C,qt,m,"center",Ie,Dt,et,l.ai.horizontal,!1,Kt,B,L);_e&&(N.horizontal[Ie]=_e,Nt=_e.positionedLines.length===1)}ce()}else{Jt==="auto"&&(Jt=um(ee));const Zt=Pd(q,r.glyphMap,r.glyphPositions,r.imagePositions,C,qt,m,ee,Jt,Dt,et,l.ai.horizontal,!1,Kt,B,L);Zt&&(N.horizontal[Jt]=Zt),ce(),vu(mt)&&y&&b&&(N.vertical=Pd(q,r.glyphMap,r.glyphPositions,r.imagePositions,C,qt,m,ee,Jt,Dt,et,l.ai.vertical,!1,Kt,B,L))}}let dt=!1;if(k.icon&&k.icon.name){const mt=r.imageMap[k.icon.name];mt&&(X=e1(r.imagePositions[k.icon.name],o.get("icon-offset").evaluate(k,{},r.canonical),o.get("icon-anchor").evaluate(k,{},r.canonical)),dt=!!mt.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=dt:r.bucket.sdfIcons!==dt&&ae("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(mt.pixelRatio!==r.bucket.pixelRatio||o.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const ot=k_(N.horizontal)||N.vertical;r.bucket.iconsInText=!!ot&&ot.iconsInText,(ot||X)&&_1(r.bucket,k,N,X,r.imageMap,d,B,O,et,dt,r.canonical)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},l.br=Hf,l.bs=Gf,l.bt=Wf,l.bu=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},l.bv=Kf,l.bw=xa,l.bx=function(r,e,o,c,d){return P(this,void 0,void 0,function*(){if(_t())try{return yield ti(r,e,o,c,d)}catch{}return function(m,y,b,S,k){const C=m.width,L=m.height;mi&&di||(mi=new OffscreenCanvas(C,L),di=mi.getContext("2d",{willReadFrequently:!0})),mi.width=C,mi.height=L,di.drawImage(m,0,0,C,L);const B=di.getImageData(y,b,S,k);return di.clearRect(0,0,C,L),B.data}(r,e,o,c,d)})},l.by=c_,l.bz=E,l.c=ye,l.d=function(r,e){const o=new Image;o.onload=()=>{e(null,o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame(()=>{o.src=ci})},o.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const c=new Blob([new Uint8Array(r)],{type:"image/png"});o.src=r.byteLength?URL.createObjectURL(c):ci},l.e=Rt,l.f=function(r,e){return lr(Rt(r,{type:"json"}),e)},l.g=Mi,l.h=xi,l.i=se,l.j=Gr,l.k=rn,l.l=wn,l.m=lr,l.n=function(r){return new Kf(r).readFields(Yw,[])},l.o=function(r,e,o){if(!r.length)return o(null,[]);let c=r.length;const d=new Array(r.length);let m=null;r.forEach((y,b)=>{e(y,(S,k)=>{S&&(m=S),d[b]=k,--c==0&&o(m,d)})})},l.p=$y,l.q=Uu,l.r=xr,l.s=ir,l.t=kf,l.u=te,l.v=Tt,l.w=ae,l.x=Jl,l.y=js,l.z=function([r,e,o]){return e+=90,e*=Math.PI/180,o*=Math.PI/180,{x:r*Math.cos(e)*Math.sin(o),y:r*Math.sin(e)*Math.sin(o),z:r*Math.cos(o)}}}),v(["./shared"],function(l){class P{constructor(z){this.keyCache={},z&&this.replace(z)}replace(z){this._layerConfigs={},this._layers={},this.update(z,[])}update(z,R){for(const K of z){this._layerConfigs[K.id]=K;const J=this._layers[K.id]=l.aC(K);J._featureFilter=l.a6(J.filter),this.keyCache[K.id]&&delete this.keyCache[K.id]}for(const K of R)delete this.keyCache[K],delete this._layerConfigs[K],delete this._layers[K];this.familiesBySource={};const V=l.bl(Object.values(this._layerConfigs),this.keyCache);for(const K of V){const J=K.map(Ct=>this._layers[Ct.id]),ft=J[0];if(ft.visibility==="none")continue;const at=ft.source||"";let rt=this.familiesBySource[at];rt||(rt=this.familiesBySource[at]={});const ht=ft.sourceLayer||"_geojsonTileLayer";let At=rt[ht];At||(At=rt[ht]=[]),At.push(J)}}}class E{constructor(z){const R={},V=[];for(const at in z){const rt=z[at],ht=R[at]={};for(const At in rt){const Ct=rt[+At];if(!Ct||Ct.bitmap.width===0||Ct.bitmap.height===0)continue;const Pt={x:0,y:0,w:Ct.bitmap.width+2,h:Ct.bitmap.height+2};V.push(Pt),ht[At]={rect:Pt,metrics:Ct.metrics}}}const{w:K,h:J}=l.p(V),ft=new l.q({width:K||1,height:J||1});for(const at in z){const rt=z[at];for(const ht in rt){const At=rt[+ht];if(!At||At.bitmap.width===0||At.bitmap.height===0)continue;const Ct=R[at][ht].rect;l.q.copy(At.bitmap,ft,{x:0,y:0},{x:Ct.x+1,y:Ct.y+1},At.bitmap)}}this.image=ft,this.positions=R}}l.bm("GlyphAtlas",E);class U{constructor(z){this.tileID=new l.O(z.tileID.overscaledZ,z.tileID.wrap,z.tileID.canonical.z,z.tileID.canonical.x,z.tileID.canonical.y),this.uid=z.uid,this.zoom=z.zoom,this.pixelRatio=z.pixelRatio,this.tileSize=z.tileSize,this.source=z.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=z.showCollisionBoxes,this.collectResourceTiming=!!z.collectResourceTiming,this.returnDependencies=!!z.returnDependencies,this.promoteId=z.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(z,R,V,K,J){this.status="parsing",this.data=z,this.collisionBoxArray=new l.a3;const ft=new l.bn(Object.keys(z.layers).sort()),at=new l.bo(this.tileID,this.promoteId);at.bucketLayerIDs=[];const rt={},ht={featureIndex:at,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:V},At=R.familiesBySource[this.source];for(const yi in At){const pi=z.layers[yi];if(!pi)continue;pi.version===1&&l.w(`Vector tile source "${this.source}" layer "${yi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const sn=ft.encode(yi),$i=[];for(let Er=0;Er<pi.length;Er++){const Wr=pi.feature(Er),Kn=at.getId(Wr,yi);$i.push({feature:Wr,id:Kn,index:Er,sourceLayerIndex:sn})}for(const Er of At[yi]){const Wr=Er[0];Wr.source!==this.source&&l.w(`layer.source = ${Wr.source} does not equal this.source = ${this.source}`),Wr.minzoom&&this.zoom<Math.floor(Wr.minzoom)||Wr.maxzoom&&this.zoom>=Wr.maxzoom||Wr.visibility!=="none"&&(j(Er,this.zoom,V),(rt[Wr.id]=Wr.createBucket({index:at.bucketLayerIDs.length,layers:Er,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:sn,sourceID:this.source})).populate($i,ht,this.tileID.canonical),at.bucketLayerIDs.push(Er.map(Kn=>Kn.id)))}}let Ct,Pt,Se,Le;const de=l.aH(ht.glyphDependencies,yi=>Object.keys(yi).map(Number));this.inFlightDependencies.forEach(yi=>yi==null?void 0:yi.cancel()),this.inFlightDependencies=[];const Te=++this.dependencySentinel;Object.keys(de).length?this.inFlightDependencies.push(K.send("getGlyphs",{uid:this.uid,stacks:de,source:this.source,tileID:this.tileID,type:"glyphs"},(yi,pi)=>{Te===this.dependencySentinel&&(Ct||(Ct=yi,Pt=pi,Bi.call(this)))})):Pt={};const Fe=Object.keys(ht.iconDependencies);Fe.length?this.inFlightDependencies.push(K.send("getImages",{icons:Fe,source:this.source,tileID:this.tileID,type:"icons"},(yi,pi)=>{Te===this.dependencySentinel&&(Ct||(Ct=yi,Se=pi,Bi.call(this)))})):Se={};const ki=Object.keys(ht.patternDependencies);function Bi(){if(Ct)return J(Ct);if(Pt&&Se&&Le){const yi=new E(Pt),pi=new l.bp(Se,Le);for(const sn in rt){const $i=rt[sn];$i instanceof l.a4?(j($i.layers,this.zoom,V),l.bq({bucket:$i,glyphMap:Pt,glyphPositions:yi.positions,imageMap:Se,imagePositions:pi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):$i.hasPattern&&($i instanceof l.br||$i instanceof l.bs||$i instanceof l.bt)&&(j($i.layers,this.zoom,V),$i.addFeatures(ht,this.tileID.canonical,pi.patternPositions))}this.status="done",J(null,{buckets:Object.values(rt).filter(sn=>!sn.isEmpty()),featureIndex:at,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:yi.image,imageAtlas:pi,glyphMap:this.returnDependencies?Pt:null,iconMap:this.returnDependencies?Se:null,glyphPositions:this.returnDependencies?yi.positions:null})}}ki.length?this.inFlightDependencies.push(K.send("getImages",{icons:ki,source:this.source,tileID:this.tileID,type:"patterns"},(yi,pi)=>{Te===this.dependencySentinel&&(Ct||(Ct=yi,Le=pi,Bi.call(this)))})):Le={},Bi.call(this)}}function j(H,z,R){const V=new l.a8(z);for(const K of H)K.recalculate(V,R)}function W(H,z){const R=l.l(H.request,(V,K,J,ft)=>{if(V)z(V);else if(K)try{const at=new l.bw.VectorTile(new l.bv(K));z(null,{vectorTile:at,rawData:K,cacheControl:J,expires:ft})}catch(at){const rt=new Uint8Array(K);let ht=`Unable to parse the tile at ${H.request.url}, `;ht+=rt[0]===31&&rt[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${at.messge}`,z(new Error(ht))}});return()=>{R.cancel(),z()}}class tt{constructor(z,R,V,K){this.actor=z,this.layerIndex=R,this.availableImages=V,this.loadVectorData=K||W,this.fetching={},this.loading={},this.loaded={}}loadTile(z,R){const V=z.uid;this.loading||(this.loading={});const K=!!(z&&z.request&&z.request.collectResourceTiming)&&new l.bu(z.request),J=this.loading[V]=new U(z);J.abort=this.loadVectorData(z,(ft,at)=>{if(delete this.loading[V],ft||!at)return J.status="done",this.loaded[V]=J,R(ft);const rt=at.rawData,ht={};at.expires&&(ht.expires=at.expires),at.cacheControl&&(ht.cacheControl=at.cacheControl);const At={};if(K){const Ct=K.finish();Ct&&(At.resourceTiming=JSON.parse(JSON.stringify(Ct)))}J.vectorTile=at.vectorTile,J.parse(at.vectorTile,this.layerIndex,this.availableImages,this.actor,(Ct,Pt)=>{if(delete this.fetching[V],Ct||!Pt)return R(Ct);R(null,l.e({rawTileData:rt.slice(0)},Pt,ht,At))}),this.loaded=this.loaded||{},this.loaded[V]=J,this.fetching[V]={rawTileData:rt,cacheControl:ht,resourceTiming:At}})}reloadTile(z,R){const V=this.loaded,K=z.uid;if(V&&V[K]){const J=V[K];J.showCollisionBoxes=z.showCollisionBoxes,J.status==="parsing"?J.parse(J.vectorTile,this.layerIndex,this.availableImages,this.actor,(ft,at)=>{if(ft||!at)return R(ft,at);let rt;if(this.fetching[K]){const{rawTileData:ht,cacheControl:At,resourceTiming:Ct}=this.fetching[K];delete this.fetching[K],rt=l.e({rawTileData:ht.slice(0)},at,At,Ct)}else rt=at;R(null,rt)}):J.status==="done"&&(J.vectorTile?J.parse(J.vectorTile,this.layerIndex,this.availableImages,this.actor,R):R())}}abortTile(z,R){const V=this.loading,K=z.uid;V&&V[K]&&V[K].abort&&(V[K].abort(),delete V[K]),R()}removeTile(z,R){const V=this.loaded,K=z.uid;V&&V[K]&&delete V[K],R()}}class ct{constructor(){this.loaded={}}loadTile(z,R){return l._(this,void 0,void 0,function*(){const{uid:V,encoding:K,rawImageData:J,redFactor:ft,greenFactor:at,blueFactor:rt,baseShift:ht}=z,At=J.width+2,Ct=J.height+2,Pt=l.a(J)?new l.R({width:At,height:Ct},yield l.bx(J,-1,-1,At,Ct)):J,Se=new l.by(V,Pt,K,ft,at,rt,ht);this.loaded=this.loaded||{},this.loaded[V]=Se,R(null,Se)})}removeTile(z){const R=this.loaded,V=z.uid;R&&R[V]&&delete R[V]}}function pt(H,z){if(H.length!==0){nt(H[0],z);for(var R=1;R<H.length;R++)nt(H[R],!z)}}function nt(H,z){for(var R=0,V=0,K=0,J=H.length,ft=J-1;K<J;ft=K++){var at=(H[K][0]-H[ft][0])*(H[ft][1]+H[K][1]),rt=R+at;V+=Math.abs(R)>=Math.abs(at)?R-rt+at:at-rt+R,R=rt}R+V>=0!=!!z&&H.reverse()}var it=l.bz(function H(z,R){var V,K=z&&z.type;if(K==="FeatureCollection")for(V=0;V<z.features.length;V++)H(z.features[V],R);else if(K==="GeometryCollection")for(V=0;V<z.geometries.length;V++)H(z.geometries[V],R);else if(K==="Feature")H(z.geometry,R);else if(K==="Polygon")pt(z.coordinates,R);else if(K==="MultiPolygon")for(V=0;V<z.coordinates.length;V++)pt(z.coordinates[V],R);return z});const It=l.bw.VectorTileFeature.prototype.toGeoJSON;var _t={exports:{}},gt=l.bA,kt=l.bw.VectorTileFeature,Lt=Vt;function Vt(H,z){this.options=z||{},this.features=H,this.length=H.length}function Rt(H,z){this.id=typeof H.id=="number"?H.id:void 0,this.type=H.type,this.rawGeometry=H.type===1?[H.geometry]:H.geometry,this.properties=H.tags,this.extent=z||4096}Vt.prototype.feature=function(H){return new Rt(this.features[H],this.options.extent)},Rt.prototype.loadGeometry=function(){var H=this.rawGeometry;this.geometry=[];for(var z=0;z<H.length;z++){for(var R=H[z],V=[],K=0;K<R.length;K++)V.push(new gt(R[K][0],R[K][1]));this.geometry.push(V)}return this.geometry},Rt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var H=this.geometry,z=1/0,R=-1/0,V=1/0,K=-1/0,J=0;J<H.length;J++)for(var ft=H[J],at=0;at<ft.length;at++){var rt=ft[at];z=Math.min(z,rt.x),R=Math.max(R,rt.x),V=Math.min(V,rt.y),K=Math.max(K,rt.y)}return[z,V,R,K]},Rt.prototype.toGeoJSON=kt.prototype.toGeoJSON;var Qt=l.bB,Ut=Lt;function me(H){var z=new Qt;return function(R,V){for(var K in R.layers)V.writeMessage(3,jt,R.layers[K])}(H,z),z.finish()}function jt(H,z){var R;z.writeVarintField(15,H.version||1),z.writeStringField(1,H.name||""),z.writeVarintField(5,H.extent||4096);var V={keys:[],values:[],keycache:{},valuecache:{}};for(R=0;R<H.length;R++)V.feature=H.feature(R),z.writeMessage(2,Bt,V);var K=V.keys;for(R=0;R<K.length;R++)z.writeStringField(3,K[R]);var J=V.values;for(R=0;R<J.length;R++)z.writeMessage(4,ne,J[R])}function Bt(H,z){var R=H.feature;R.id!==void 0&&z.writeVarintField(1,R.id),z.writeMessage(2,ae,H),z.writeVarintField(3,R.type),z.writeMessage(4,se,R)}function ae(H,z){var R=H.feature,V=H.keys,K=H.values,J=H.keycache,ft=H.valuecache;for(var at in R.properties){var rt=R.properties[at],ht=J[at];if(rt!==null){ht===void 0&&(V.push(at),J[at]=ht=V.length-1),z.writeVarint(ht);var At=typeof rt;At!=="string"&&At!=="boolean"&&At!=="number"&&(rt=JSON.stringify(rt));var Ct=At+":"+rt,Pt=ft[Ct];Pt===void 0&&(K.push(rt),ft[Ct]=Pt=K.length-1),z.writeVarint(Pt)}}}function he(H,z){return(z<<3)+(7&H)}function ve(H){return H<<1^H>>31}function se(H,z){for(var R=H.loadGeometry(),V=H.type,K=0,J=0,ft=R.length,at=0;at<ft;at++){var rt=R[at],ht=1;V===1&&(ht=rt.length),z.writeVarint(he(1,ht));for(var At=V===3?rt.length-1:rt.length,Ct=0;Ct<At;Ct++){Ct===1&&V!==1&&z.writeVarint(he(2,At-1));var Pt=rt[Ct].x-K,Se=rt[Ct].y-J;z.writeVarint(ve(Pt)),z.writeVarint(ve(Se)),K+=Pt,J+=Se}V===3&&z.writeVarint(he(7,1))}}function ne(H,z){var R=typeof H;R==="string"?z.writeStringField(1,H):R==="boolean"?z.writeBooleanField(7,H):R==="number"&&(H%1!=0?z.writeDoubleField(3,H):H<0?z.writeSVarintField(6,H):z.writeVarintField(5,H))}_t.exports=me,_t.exports.fromVectorTileJs=me,_t.exports.fromGeojsonVt=function(H,z){z=z||{};var R={};for(var V in H)R[V]=new Ut(H[V].features,z),R[V].name=V,R[V].version=z.version,R[V].extent=z.extent;return me({layers:R})},_t.exports.GeoJSONWrapper=Ut;var ie=l.bz(_t.exports);const ci={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:H=>H},ti=Math.fround||(mi=new Float32Array(1),H=>(mi[0]=+H,mi[0]));var mi;const di=3,ke=5,Xe=6;class xi{constructor(z){this.options=Object.assign(Object.create(ci),z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(z){const{log:R,minZoom:V,maxZoom:K}=this.options;R&&console.time("total time");const J=`prepare ${z.length} points`;R&&console.time(J),this.points=z;const ft=[];for(let rt=0;rt<z.length;rt++){const ht=z[rt];if(!ht.geometry)continue;const[At,Ct]=ht.geometry.coordinates,Pt=ti(ze(At)),Se=ti(Mi(Ct));ft.push(Pt,Se,1/0,rt,-1,1),this.options.reduce&&ft.push(0)}let at=this.trees[K+1]=this._createTree(ft);R&&console.timeEnd(J);for(let rt=K;rt>=V;rt--){const ht=+Date.now();at=this.trees[rt]=this._createTree(this._cluster(at,rt)),R&&console.log("z%d: %d clusters in %dms",rt,at.numItems,+Date.now()-ht)}return R&&console.timeEnd("total time"),this}getClusters(z,R){let V=((z[0]+180)%360+360)%360-180;const K=Math.max(-90,Math.min(90,z[1]));let J=z[2]===180?180:((z[2]+180)%360+360)%360-180;const ft=Math.max(-90,Math.min(90,z[3]));if(z[2]-z[0]>=360)V=-180,J=180;else if(V>J){const Ct=this.getClusters([V,K,180,ft],R),Pt=this.getClusters([-180,K,J,ft],R);return Ct.concat(Pt)}const at=this.trees[this._limitZoom(R)],rt=at.range(ze(V),Mi(ft),ze(J),Mi(K)),ht=at.data,At=[];for(const Ct of rt){const Pt=this.stride*Ct;At.push(ht[Pt+ke]>1?ye(ht,Pt,this.clusterProps):this.points[ht[Pt+di]])}return At}getChildren(z){const R=this._getOriginId(z),V=this._getOriginZoom(z),K="No cluster with the specified id.",J=this.trees[V];if(!J)throw new Error(K);const ft=J.data;if(R*this.stride>=ft.length)throw new Error(K);const at=this.options.radius/(this.options.extent*Math.pow(2,V-1)),rt=J.within(ft[R*this.stride],ft[R*this.stride+1],at),ht=[];for(const At of rt){const Ct=At*this.stride;ft[Ct+4]===z&&ht.push(ft[Ct+ke]>1?ye(ft,Ct,this.clusterProps):this.points[ft[Ct+di]])}if(ht.length===0)throw new Error(K);return ht}getLeaves(z,R,V){const K=[];return this._appendLeaves(K,z,R=R||10,V=V||0,0),K}getTile(z,R,V){const K=this.trees[this._limitZoom(z)],J=Math.pow(2,z),{extent:ft,radius:at}=this.options,rt=at/ft,ht=(V-rt)/J,At=(V+1+rt)/J,Ct={features:[]};return this._addTileFeatures(K.range((R-rt)/J,ht,(R+1+rt)/J,At),K.data,R,V,J,Ct),R===0&&this._addTileFeatures(K.range(1-rt/J,ht,1,At),K.data,J,V,J,Ct),R===J-1&&this._addTileFeatures(K.range(0,ht,rt/J,At),K.data,-1,V,J,Ct),Ct.features.length?Ct:null}getClusterExpansionZoom(z){let R=this._getOriginZoom(z)-1;for(;R<=this.options.maxZoom;){const V=this.getChildren(z);if(R++,V.length!==1)break;z=V[0].properties.cluster_id}return R}_appendLeaves(z,R,V,K,J){const ft=this.getChildren(R);for(const at of ft){const rt=at.properties;if(rt&&rt.cluster?J+rt.point_count<=K?J+=rt.point_count:J=this._appendLeaves(z,rt.cluster_id,V,K,J):J<K?J++:z.push(at),z.length===V)break}return J}_createTree(z){const R=new l.av(z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let V=0;V<z.length;V+=this.stride)R.add(z[V],z[V+1]);return R.finish(),R.data=z,R}_addTileFeatures(z,R,V,K,J,ft){for(const at of z){const rt=at*this.stride,ht=R[rt+ke]>1;let At,Ct,Pt;if(ht)At=Xt(R,rt,this.clusterProps),Ct=R[rt],Pt=R[rt+1];else{const de=this.points[R[rt+di]];At=de.properties;const[Te,Fe]=de.geometry.coordinates;Ct=ze(Te),Pt=Mi(Fe)}const Se={type:1,geometry:[[Math.round(this.options.extent*(Ct*J-V)),Math.round(this.options.extent*(Pt*J-K))]],tags:At};let Le;Le=ht||this.options.generateId?R[rt+di]:this.points[R[rt+di]].id,Le!==void 0&&(Se.id=Le),ft.features.push(Se)}}_limitZoom(z){return Math.max(this.options.minZoom,Math.min(Math.floor(+z),this.options.maxZoom+1))}_cluster(z,R){const{radius:V,extent:K,reduce:J,minPoints:ft}=this.options,at=V/(K*Math.pow(2,R)),rt=z.data,ht=[],At=this.stride;for(let Ct=0;Ct<rt.length;Ct+=At){if(rt[Ct+2]<=R)continue;rt[Ct+2]=R;const Pt=rt[Ct],Se=rt[Ct+1],Le=z.within(rt[Ct],rt[Ct+1],at),de=rt[Ct+ke];let Te=de;for(const Fe of Le){const ki=Fe*At;rt[ki+2]>R&&(Te+=rt[ki+ke])}if(Te>de&&Te>=ft){let Fe,ki=Pt*de,Bi=Se*de,yi=-1;const pi=((Ct/At|0)<<5)+(R+1)+this.points.length;for(const sn of Le){const $i=sn*At;if(rt[$i+2]<=R)continue;rt[$i+2]=R;const Er=rt[$i+ke];ki+=rt[$i]*Er,Bi+=rt[$i+1]*Er,rt[$i+4]=pi,J&&(Fe||(Fe=this._map(rt,Ct,!0),yi=this.clusterProps.length,this.clusterProps.push(Fe)),J(Fe,this._map(rt,$i)))}rt[Ct+4]=pi,ht.push(ki/Te,Bi/Te,1/0,pi,-1,Te),J&&ht.push(yi)}else{for(let Fe=0;Fe<At;Fe++)ht.push(rt[Ct+Fe]);if(Te>1)for(const Fe of Le){const ki=Fe*At;if(!(rt[ki+2]<=R)){rt[ki+2]=R;for(let Bi=0;Bi<At;Bi++)ht.push(rt[ki+Bi])}}}}return ht}_getOriginId(z){return z-this.points.length>>5}_getOriginZoom(z){return(z-this.points.length)%32}_map(z,R,V){if(z[R+ke]>1){const ft=this.clusterProps[z[R+Xe]];return V?Object.assign({},ft):ft}const K=this.points[z[R+di]].properties,J=this.options.map(K);return V&&J===K?Object.assign({},J):J}}function ye(H,z,R){return{type:"Feature",id:H[z+di],properties:Xt(H,z,R),geometry:{type:"Point",coordinates:[(V=H[z],360*(V-.5)),en(H[z+1])]}};var V}function Xt(H,z,R){const V=H[z+ke],K=V>=1e4?`${Math.round(V/1e3)}k`:V>=1e3?Math.round(V/100)/10+"k":V,J=H[z+Xe],ft=J===-1?{}:Object.assign({},R[J]);return Object.assign(ft,{cluster:!0,cluster_id:H[z+di],point_count:V,point_count_abbreviated:K})}function ze(H){return H/360+.5}function Mi(H){const z=Math.sin(H*Math.PI/180),R=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return R<0?0:R>1?1:R}function en(H){const z=(180-360*H)*Math.PI/180;return 360*Math.atan(Math.exp(z))/Math.PI-90}function lr(H,z,R,V){for(var K,J=V,ft=R-z>>1,at=R-z,rt=H[z],ht=H[z+1],At=H[R],Ct=H[R+1],Pt=z+3;Pt<R;Pt+=3){var Se=wn(H[Pt],H[Pt+1],rt,ht,At,Ct);if(Se>J)K=Pt,J=Se;else if(Se===J){var Le=Math.abs(Pt-ft);Le<at&&(K=Pt,at=Le)}}J>V&&(K-z>3&&lr(H,z,K,V),H[K+2]=J,R-K>3&&lr(H,K,R,V))}function wn(H,z,R,V,K,J){var ft=K-R,at=J-V;if(ft!==0||at!==0){var rt=((H-R)*ft+(z-V)*at)/(ft*ft+at*at);rt>1?(R=K,V=J):rt>0&&(R+=ft*rt,V+=at*rt)}return(ft=H-R)*ft+(at=z-V)*at}function ir(H,z,R,V){var K={id:H===void 0?null:H,type:z,geometry:R,tags:V,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(J){var ft=J.geometry,at=J.type;if(at==="Point"||at==="MultiPoint"||at==="LineString")yr(J,ft);else if(at==="Polygon"||at==="MultiLineString")for(var rt=0;rt<ft.length;rt++)yr(J,ft[rt]);else if(at==="MultiPolygon")for(rt=0;rt<ft.length;rt++)for(var ht=0;ht<ft[rt].length;ht++)yr(J,ft[rt][ht])}(K),K}function yr(H,z){for(var R=0;R<z.length;R+=3)H.minX=Math.min(H.minX,z[R]),H.minY=Math.min(H.minY,z[R+1]),H.maxX=Math.max(H.maxX,z[R]),H.maxY=Math.max(H.maxY,z[R+1])}function Pr(H,z,R,V){if(z.geometry){var K=z.geometry.coordinates,J=z.geometry.type,ft=Math.pow(R.tolerance/((1<<R.maxZoom)*R.extent),2),at=[],rt=z.id;if(R.promoteId?rt=z.properties[R.promoteId]:R.generateId&&(rt=V||0),J==="Point")rn(K,at);else if(J==="MultiPoint")for(var ht=0;ht<K.length;ht++)rn(K[ht],at);else if(J==="LineString")Gr(K,at,ft,!1);else if(J==="MultiLineString"){if(R.lineMetrics){for(ht=0;ht<K.length;ht++)Gr(K[ht],at=[],ft,!1),H.push(ir(rt,"LineString",at,z.properties));return}Sn(K,at,ft,!1)}else if(J==="Polygon")Sn(K,at,ft,!0);else{if(J!=="MultiPolygon"){if(J==="GeometryCollection"){for(ht=0;ht<z.geometry.geometries.length;ht++)Pr(H,{id:rt,geometry:z.geometry.geometries[ht],properties:z.properties},R,V);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ht=0;ht<K.length;ht++){var At=[];Sn(K[ht],At,ft,!0),at.push(At)}}H.push(ir(rt,J,at,z.properties))}}function rn(H,z){z.push(Tt(H[0])),z.push(Ar(H[1])),z.push(0)}function Gr(H,z,R,V){for(var K,J,ft=0,at=0;at<H.length;at++){var rt=Tt(H[at][0]),ht=Ar(H[at][1]);z.push(rt),z.push(ht),z.push(0),at>0&&(ft+=V?(K*ht-rt*J)/2:Math.sqrt(Math.pow(rt-K,2)+Math.pow(ht-J,2))),K=rt,J=ht}var At=z.length-3;z[2]=1,lr(z,0,At,R),z[At+2]=1,z.size=Math.abs(ft),z.start=0,z.end=z.size}function Sn(H,z,R,V){for(var K=0;K<H.length;K++){var J=[];Gr(H[K],J,R,V),z.push(J)}}function Tt(H){return H/360+.5}function Ar(H){var z=Math.sin(H*Math.PI/180),R=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return R<0?0:R>1?1:R}function dn(H,z,R,V,K,J,ft,at){if(V/=z,J>=(R/=z)&&ft<V)return H;if(ft<R||J>=V)return null;for(var rt=[],ht=0;ht<H.length;ht++){var At=H[ht],Ct=At.geometry,Pt=At.type,Se=K===0?At.minX:At.minY,Le=K===0?At.maxX:At.maxY;if(Se>=R&&Le<V)rt.push(At);else if(!(Le<R||Se>=V)){var de=[];if(Pt==="Point"||Pt==="MultiPoint")Ei(Ct,de,R,V,K);else if(Pt==="LineString")gi(Ct,de,R,V,K,!1,at.lineMetrics);else if(Pt==="MultiLineString")Fs(Ct,de,R,V,K,!1);else if(Pt==="Polygon")Fs(Ct,de,R,V,K,!0);else if(Pt==="MultiPolygon")for(var Te=0;Te<Ct.length;Te++){var Fe=[];Fs(Ct[Te],Fe,R,V,K,!0),Fe.length&&de.push(Fe)}if(de.length){if(at.lineMetrics&&Pt==="LineString"){for(Te=0;Te<de.length;Te++)rt.push(ir(At.id,Pt,de[Te],At.tags));continue}Pt!=="LineString"&&Pt!=="MultiLineString"||(de.length===1?(Pt="LineString",de=de[0]):Pt="MultiLineString"),Pt!=="Point"&&Pt!=="MultiPoint"||(Pt=de.length===3?"Point":"MultiPoint"),rt.push(ir(At.id,Pt,de,At.tags))}}}return rt.length?rt:null}function Ei(H,z,R,V,K){for(var J=0;J<H.length;J+=3){var ft=H[J+K];ft>=R&&ft<=V&&(z.push(H[J]),z.push(H[J+1]),z.push(H[J+2]))}}function gi(H,z,R,V,K,J,ft){for(var at,rt,ht=nn(H),At=K===0?Za:ro,Ct=H.start,Pt=0;Pt<H.length-3;Pt+=3){var Se=H[Pt],Le=H[Pt+1],de=H[Pt+2],Te=H[Pt+3],Fe=H[Pt+4],ki=K===0?Se:Le,Bi=K===0?Te:Fe,yi=!1;ft&&(at=Math.sqrt(Math.pow(Se-Te,2)+Math.pow(Le-Fe,2))),ki<R?Bi>R&&(rt=At(ht,Se,Le,Te,Fe,R),ft&&(ht.start=Ct+at*rt)):ki>V?Bi<V&&(rt=At(ht,Se,Le,Te,Fe,V),ft&&(ht.start=Ct+at*rt)):Zr(ht,Se,Le,de),Bi<R&&ki>=R&&(rt=At(ht,Se,Le,Te,Fe,R),yi=!0),Bi>V&&ki<=V&&(rt=At(ht,Se,Le,Te,Fe,V),yi=!0),!J&&yi&&(ft&&(ht.end=Ct+at*rt),z.push(ht),ht=nn(H)),ft&&(Ct+=at)}var pi=H.length-3;Se=H[pi],Le=H[pi+1],de=H[pi+2],(ki=K===0?Se:Le)>=R&&ki<=V&&Zr(ht,Se,Le,de),pi=ht.length-3,J&&pi>=3&&(ht[pi]!==ht[0]||ht[pi+1]!==ht[1])&&Zr(ht,ht[0],ht[1],ht[2]),ht.length&&z.push(ht)}function nn(H){var z=[];return z.size=H.size,z.start=H.start,z.end=H.end,z}function Fs(H,z,R,V,K,J){for(var ft=0;ft<H.length;ft++)gi(H[ft],z,R,V,K,J,!1)}function Zr(H,z,R,V){H.push(z),H.push(R),H.push(V)}function Za(H,z,R,V,K,J){var ft=(J-z)/(V-z);return H.push(J),H.push(R+(K-R)*ft),H.push(1),ft}function ro(H,z,R,V,K,J){var ft=(J-R)/(K-R);return H.push(z+(V-z)*ft),H.push(J),H.push(1),ft}function no(H,z){for(var R=[],V=0;V<H.length;V++){var K,J=H[V],ft=J.type;if(ft==="Point"||ft==="MultiPoint"||ft==="LineString")K=Mo(J.geometry,z);else if(ft==="MultiLineString"||ft==="Polygon"){K=[];for(var at=0;at<J.geometry.length;at++)K.push(Mo(J.geometry[at],z))}else if(ft==="MultiPolygon")for(K=[],at=0;at<J.geometry.length;at++){for(var rt=[],ht=0;ht<J.geometry[at].length;ht++)rt.push(Mo(J.geometry[at][ht],z));K.push(rt)}R.push(ir(J.id,ft,K,J.tags))}return R}function Mo(H,z){var R=[];R.size=H.size,H.start!==void 0&&(R.start=H.start,R.end=H.end);for(var V=0;V<H.length;V+=3)R.push(H[V]+z,H[V+1],H[V+2]);return R}function Gt(H,z){if(H.transformed)return H;var R,V,K,J=1<<H.z,ft=H.x,at=H.y;for(R=0;R<H.features.length;R++){var rt=H.features[R],ht=rt.geometry,At=rt.type;if(rt.geometry=[],At===1)for(V=0;V<ht.length;V+=2)rt.geometry.push(vs(ht[V],ht[V+1],z,J,ft,at));else for(V=0;V<ht.length;V++){var Ct=[];for(K=0;K<ht[V].length;K+=2)Ct.push(vs(ht[V][K],ht[V][K+1],z,J,ft,at));rt.geometry.push(Ct)}}return H.transformed=!0,H}function vs(H,z,R,V,K,J){return[Math.round(R*(H*V-K)),Math.round(R*(z*V-J))]}function cr(H,z,R,V,K){for(var J=z===K.maxZoom?0:K.tolerance/((1<<z)*K.extent),ft={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:R,y:V,z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},at=0;at<H.length;at++){ft.numFeatures++,Do(ft,H[at],J,K);var rt=H[at].minX,ht=H[at].minY,At=H[at].maxX,Ct=H[at].maxY;rt<ft.minX&&(ft.minX=rt),ht<ft.minY&&(ft.minY=ht),At>ft.maxX&&(ft.maxX=At),Ct>ft.maxY&&(ft.maxY=Ct)}return ft}function Do(H,z,R,V){var K=z.geometry,J=z.type,ft=[];if(J==="Point"||J==="MultiPoint")for(var at=0;at<K.length;at+=3)ft.push(K[at]),ft.push(K[at+1]),H.numPoints++,H.numSimplified++;else if(J==="LineString")Os(ft,K,H,R,!1,!1);else if(J==="MultiLineString"||J==="Polygon")for(at=0;at<K.length;at++)Os(ft,K[at],H,R,J==="Polygon",at===0);else if(J==="MultiPolygon")for(var rt=0;rt<K.length;rt++){var ht=K[rt];for(at=0;at<ht.length;at++)Os(ft,ht[at],H,R,!0,at===0)}if(ft.length){var At=z.tags||null;if(J==="LineString"&&V.lineMetrics){for(var Ct in At={},z.tags)At[Ct]=z.tags[Ct];At.mapbox_clip_start=K.start/K.size,At.mapbox_clip_end=K.end/K.size}var Pt={geometry:ft,type:J==="Polygon"||J==="MultiPolygon"?3:J==="LineString"||J==="MultiLineString"?2:1,tags:At};z.id!==null&&(Pt.id=z.id),H.features.push(Pt)}}function Os(H,z,R,V,K,J){var ft=V*V;if(V>0&&z.size<(K?ft:V))R.numPoints+=z.length/3;else{for(var at=[],rt=0;rt<z.length;rt+=3)(V===0||z[rt+2]>ft)&&(R.numSimplified++,at.push(z[rt]),at.push(z[rt+1])),R.numPoints++;K&&function(ht,At){for(var Ct=0,Pt=0,Se=ht.length,Le=Se-2;Pt<Se;Le=Pt,Pt+=2)Ct+=(ht[Pt]-ht[Le])*(ht[Pt+1]+ht[Le+1]);if(Ct>0===At)for(Pt=0,Se=ht.length;Pt<Se/2;Pt+=2){var de=ht[Pt],Te=ht[Pt+1];ht[Pt]=ht[Se-2-Pt],ht[Pt+1]=ht[Se-1-Pt],ht[Se-2-Pt]=de,ht[Se-1-Pt]=Te}}(at,J),H.push(at)}}function Wt(H,z){var R=(z=this.options=function(K,J){for(var ft in J)K[ft]=J[ft];return K}(Object.create(this.options),z)).debug;if(R&&console.time("preprocess data"),z.maxZoom<0||z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(z.promoteId&&z.generateId)throw new Error("promoteId and generateId cannot be used together.");var V=function(K,J){var ft=[];if(K.type==="FeatureCollection")for(var at=0;at<K.features.length;at++)Pr(ft,K.features[at],J,at);else Pr(ft,K.type==="Feature"?K:{geometry:K},J);return ft}(H,z);this.tiles={},this.tileCoords=[],R&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",z.indexMaxZoom,z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),V=function(K,J){var ft=J.buffer/J.extent,at=K,rt=dn(K,1,-1-ft,ft,0,-1,2,J),ht=dn(K,1,1-ft,2+ft,0,-1,2,J);return(rt||ht)&&(at=dn(K,1,-ft,1+ft,0,-1,2,J)||[],rt&&(at=no(rt,1).concat(at)),ht&&(at=at.concat(no(ht,-1)))),at}(V,z),V.length&&this.splitTile(V,0,0,0),R&&(V.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Je(H,z,R){return 32*((1<<H)*R+z)+H}function Re(H,z){return z?H.properties[z]:H.id}function pn(H,z){if(H==null)return!0;if(H.type==="Feature")return Re(H,z)!=null;if(H.type==="FeatureCollection"){const R=new Set;for(const V of H.features){const K=Re(V,z);if(K==null||R.has(K))return!1;R.add(K)}return!0}return!1}function bs(H,z){const R=new Map;if(H!=null)if(H.type==="Feature")R.set(Re(H,z),H);else for(const V of H.features)R.set(Re(V,z),V);return R}Wt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Wt.prototype.splitTile=function(H,z,R,V,K,J,ft){for(var at=[H,z,R,V],rt=this.options,ht=rt.debug;at.length;){V=at.pop(),R=at.pop(),z=at.pop(),H=at.pop();var At=1<<z,Ct=Je(z,R,V),Pt=this.tiles[Ct];if(!Pt&&(ht>1&&console.time("creation"),Pt=this.tiles[Ct]=cr(H,z,R,V,rt),this.tileCoords.push({z,x:R,y:V}),ht)){ht>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",z,R,V,Pt.numFeatures,Pt.numPoints,Pt.numSimplified),console.timeEnd("creation"));var Se="z"+z;this.stats[Se]=(this.stats[Se]||0)+1,this.total++}if(Pt.source=H,K){if(z===rt.maxZoom||z===K)continue;var Le=1<<K-z;if(R!==Math.floor(J/Le)||V!==Math.floor(ft/Le))continue}else if(z===rt.indexMaxZoom||Pt.numPoints<=rt.indexMaxPoints)continue;if(Pt.source=null,H.length!==0){ht>1&&console.time("clipping");var de,Te,Fe,ki,Bi,yi,pi=.5*rt.buffer/rt.extent,sn=.5-pi,$i=.5+pi,Er=1+pi;de=Te=Fe=ki=null,Bi=dn(H,At,R-pi,R+$i,0,Pt.minX,Pt.maxX,rt),yi=dn(H,At,R+sn,R+Er,0,Pt.minX,Pt.maxX,rt),H=null,Bi&&(de=dn(Bi,At,V-pi,V+$i,1,Pt.minY,Pt.maxY,rt),Te=dn(Bi,At,V+sn,V+Er,1,Pt.minY,Pt.maxY,rt),Bi=null),yi&&(Fe=dn(yi,At,V-pi,V+$i,1,Pt.minY,Pt.maxY,rt),ki=dn(yi,At,V+sn,V+Er,1,Pt.minY,Pt.maxY,rt),yi=null),ht>1&&console.timeEnd("clipping"),at.push(de||[],z+1,2*R,2*V),at.push(Te||[],z+1,2*R,2*V+1),at.push(Fe||[],z+1,2*R+1,2*V),at.push(ki||[],z+1,2*R+1,2*V+1)}}},Wt.prototype.getTile=function(H,z,R){var V=this.options,K=V.extent,J=V.debug;if(H<0||H>24)return null;var ft=1<<H,at=Je(H,z=(z%ft+ft)%ft,R);if(this.tiles[at])return Gt(this.tiles[at],K);J>1&&console.log("drilling down to z%d-%d-%d",H,z,R);for(var rt,ht=H,At=z,Ct=R;!rt&&ht>0;)ht--,At=Math.floor(At/2),Ct=Math.floor(Ct/2),rt=this.tiles[Je(ht,At,Ct)];return rt&&rt.source?(J>1&&console.log("found parent tile z%d-%d-%d",ht,At,Ct),J>1&&console.time("drilling down"),this.splitTile(rt.source,ht,At,Ct,H,z,R),J>1&&console.timeEnd("drilling down"),this.tiles[at]?Gt(this.tiles[at],K):null):null};class He extends tt{constructor(z,R,V,K){super(z,R,V),this._dataUpdateable=new Map,this.loadGeoJSON=(J,ft)=>{const{promoteId:at}=J;if(J.request)return l.f(J.request,(rt,ht,At,Ct)=>{this._dataUpdateable=pn(ht,at)?bs(ht,at):void 0,ft(rt,ht,At,Ct)});if(typeof J.data=="string")try{const rt=JSON.parse(J.data);this._dataUpdateable=pn(rt,at)?bs(rt,at):void 0,ft(null,rt)}catch{ft(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`))}else J.dataDiff?this._dataUpdateable?(function(rt,ht,At){var Ct,Pt,Se,Le;if(ht.removeAll&&rt.clear(),ht.remove)for(const de of ht.remove)rt.delete(de);if(ht.add)for(const de of ht.add){const Te=Re(de,At);Te!=null&&rt.set(Te,de)}if(ht.update)for(const de of ht.update){let Te=rt.get(de.id);if(Te==null)continue;const Fe=!de.removeAllProperties&&(((Ct=de.removeProperties)===null||Ct===void 0?void 0:Ct.length)>0||((Pt=de.addOrUpdateProperties)===null||Pt===void 0?void 0:Pt.length)>0);if((de.newGeometry||de.removeAllProperties||Fe)&&(Te=Object.assign({},Te),rt.set(de.id,Te),Fe&&(Te.properties=Object.assign({},Te.properties))),de.newGeometry&&(Te.geometry=de.newGeometry),de.removeAllProperties)Te.properties={};else if(((Se=de.removeProperties)===null||Se===void 0?void 0:Se.length)>0)for(const ki of de.removeProperties)Object.prototype.hasOwnProperty.call(Te.properties,ki)&&delete Te.properties[ki];if(((Le=de.addOrUpdateProperties)===null||Le===void 0?void 0:Le.length)>0)for(const{key:ki,value:Bi}of de.addOrUpdateProperties)Te.properties[ki]=Bi}}(this._dataUpdateable,J.dataDiff,at),ft(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):ft(new Error(`Cannot update existing geojson data in ${J.source}`)):ft(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,K&&(this.loadGeoJSON=K)}loadGeoJSONTile(z,R){const V=z.tileID.canonical;if(!this._geoJSONIndex)return R(null,null);const K=this._geoJSONIndex.getTile(V.z,V.x,V.y);if(!K)return R(null,null);const J=new class{constructor(at){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.N,this.length=at.length,this._features=at}feature(at){return new class{constructor(rt){this._feature=rt,this.extent=l.N,this.type=rt.type,this.properties=rt.tags,"id"in rt&&!isNaN(rt.id)&&(this.id=parseInt(rt.id,10))}loadGeometry(){if(this._feature.type===1){const rt=[];for(const ht of this._feature.geometry)rt.push([new l.P(ht[0],ht[1])]);return rt}{const rt=[];for(const ht of this._feature.geometry){const At=[];for(const Ct of ht)At.push(new l.P(Ct[0],Ct[1]));rt.push(At)}return rt}}toGeoJSON(rt,ht,At){return It.call(this,rt,ht,At)}}(this._features[at])}}(K.features);let ft=ie(J);ft.byteOffset===0&&ft.byteLength===ft.buffer.byteLength||(ft=new Uint8Array(ft)),R(null,{vectorTile:J,rawData:ft.buffer})}loadData(z,R){var V;(V=this._pendingRequest)===null||V===void 0||V.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const K=!!(z&&z.request&&z.request.collectResourceTiming)&&new l.bu(z.request);this._pendingCallback=R,this._pendingRequest=this.loadGeoJSON(z,(J,ft)=>{if(delete this._pendingCallback,delete this._pendingRequest,J||!ft)return R(J);if(typeof ft!="object")return R(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`));{it(ft,!0);try{if(z.filter){const rt=l.bC(z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(rt.result==="error")throw new Error(rt.value.map(At=>`${At.key}: ${At.message}`).join(", "));ft={type:"FeatureCollection",features:ft.features.filter(At=>rt.value.evaluate({zoom:0},At))}}this._geoJSONIndex=z.cluster?new xi(function({superclusterOptions:rt,clusterProperties:ht}){if(!ht||!rt)return rt;const At={},Ct={},Pt={accumulated:null,zoom:0},Se={properties:null},Le=Object.keys(ht);for(const de of Le){const[Te,Fe]=ht[de],ki=l.bC(Fe),Bi=l.bC(typeof Te=="string"?[Te,["accumulated"],["get",de]]:Te);At[de]=ki.value,Ct[de]=Bi.value}return rt.map=de=>{Se.properties=de;const Te={};for(const Fe of Le)Te[Fe]=At[Fe].evaluate(Pt,Se);return Te},rt.reduce=(de,Te)=>{Se.properties=Te;for(const Fe of Le)Pt.accumulated=de[Fe],de[Fe]=Ct[Fe].evaluate(Pt,Se)},rt}(z)).load(ft.features):function(rt,ht){return new Wt(rt,ht)}(ft,z.geojsonVtOptions)}catch(rt){return R(rt)}this.loaded={};const at={};if(K){const rt=K.finish();rt&&(at.resourceTiming={},at.resourceTiming[z.source]=JSON.parse(JSON.stringify(rt)))}R(null,at)}})}reloadTile(z,R){const V=this.loaded;return V&&V[z.uid]?super.reloadTile(z,R):this.loadTile(z,R)}removeSource(z,R){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),R()}getClusterExpansionZoom(z,R){try{R(null,this._geoJSONIndex.getClusterExpansionZoom(z.clusterId))}catch(V){R(V)}}getClusterChildren(z,R){try{R(null,this._geoJSONIndex.getChildren(z.clusterId))}catch(V){R(V)}}getClusterLeaves(z,R){try{R(null,this._geoJSONIndex.getLeaves(z.clusterId,z.limit,z.offset))}catch(V){R(V)}}}class Ns{constructor(z){this.self=z,this.actor=new l.C(z,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:tt,geojson:He},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(R,V)=>{if(this.workerSourceTypes[R])throw new Error(`Worker source with name "${R}" already registered.`);this.workerSourceTypes[R]=V},this.self.registerRTLTextPlugin=R=>{if(l.bD.isParsed())throw new Error("RTL text plugin already registered.");l.bD.applyArabicShaping=R.applyArabicShaping,l.bD.processBidirectionalText=R.processBidirectionalText,l.bD.processStyledBidirectionalText=R.processStyledBidirectionalText}}setReferrer(z,R){this.referrer=R}setImages(z,R,V){this.availableImages[z]=R;for(const K in this.workerSources[z]){const J=this.workerSources[z][K];for(const ft in J)J[ft].availableImages=R}V()}setLayers(z,R,V){this.getLayerIndex(z).replace(R),V()}updateLayers(z,R,V){this.getLayerIndex(z).update(R.layers,R.removedIds),V()}loadTile(z,R,V){this.getWorkerSource(z,R.type,R.source).loadTile(R,V)}loadDEMTile(z,R,V){this.getDEMWorkerSource(z,R.source).loadTile(R,V)}reloadTile(z,R,V){this.getWorkerSource(z,R.type,R.source).reloadTile(R,V)}abortTile(z,R,V){this.getWorkerSource(z,R.type,R.source).abortTile(R,V)}removeTile(z,R,V){this.getWorkerSource(z,R.type,R.source).removeTile(R,V)}removeDEMTile(z,R){this.getDEMWorkerSource(z,R.source).removeTile(R)}removeSource(z,R,V){if(!this.workerSources[z]||!this.workerSources[z][R.type]||!this.workerSources[z][R.type][R.source])return;const K=this.workerSources[z][R.type][R.source];delete this.workerSources[z][R.type][R.source],K.removeSource!==void 0?K.removeSource(R,V):V()}loadWorkerSource(z,R,V){try{this.self.importScripts(R.url),V()}catch(K){V(K.toString())}}syncRTLPluginState(z,R,V){try{l.bD.setState(R);const K=l.bD.getPluginURL();if(l.bD.isLoaded()&&!l.bD.isParsed()&&K!=null){this.self.importScripts(K);const J=l.bD.isParsed();V(J?void 0:new Error(`RTL Text Plugin failed to import scripts from ${K}`),J)}}catch(K){V(K.toString())}}getAvailableImages(z){let R=this.availableImages[z];return R||(R=[]),R}getLayerIndex(z){let R=this.layerIndexes[z];return R||(R=this.layerIndexes[z]=new P),R}getWorkerSource(z,R,V){return this.workerSources[z]||(this.workerSources[z]={}),this.workerSources[z][R]||(this.workerSources[z][R]={}),this.workerSources[z][R][V]||(this.workerSources[z][R][V]=new this.workerSourceTypes[R]({send:(K,J,ft)=>{this.actor.send(K,J,ft,z)}},this.getLayerIndex(z),this.getAvailableImages(z))),this.workerSources[z][R][V]}getDEMWorkerSource(z,R){return this.demWorkerSources[z]||(this.demWorkerSources[z]={}),this.demWorkerSources[z][R]||(this.demWorkerSources[z][R]=new ct),this.demWorkerSources[z][R]}}return l.i()&&(self.worker=new Ns(self)),Ns}),v(["./shared"],function(l){var P="3.6.2";class E{static testProp(i){if(!E.docStyle)return i[0];for(let a=0;a<i.length;a++)if(i[a]in E.docStyle)return i[a];return i[0]}static create(i,a,h){const p=window.document.createElement(i);return a!==void 0&&(p.className=a),h&&h.appendChild(p),p}static createNS(i,a){return window.document.createElementNS(i,a)}static disableDrag(){E.docStyle&&E.selectProp&&(E.userSelect=E.docStyle[E.selectProp],E.docStyle[E.selectProp]="none")}static enableDrag(){E.docStyle&&E.selectProp&&(E.docStyle[E.selectProp]=E.userSelect)}static setTransform(i,a){i.style[E.transformProp]=a}static addEventListener(i,a,h,p={}){i.addEventListener(a,h,"passive"in p?p:p.capture)}static removeEventListener(i,a,h,p={}){i.removeEventListener(a,h,"passive"in p?p:p.capture)}static suppressClickInternal(i){i.preventDefault(),i.stopPropagation(),window.removeEventListener("click",E.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",E.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",E.suppressClickInternal,!0)},0)}static mousePos(i,a){const h=i.getBoundingClientRect();return new l.P(a.clientX-h.left-i.clientLeft,a.clientY-h.top-i.clientTop)}static touchPos(i,a){const h=i.getBoundingClientRect(),p=[];for(let g=0;g<a.length;g++)p.push(new l.P(a[g].clientX-h.left-i.clientLeft,a[g].clientY-h.top-i.clientTop));return p}static mouseButton(i){return i.button}static remove(i){i.parentNode&&i.parentNode.removeChild(i)}}E.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,E.selectProp=E.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),E.transformProp=E.testProp(["transform","WebkitTransform"]);const U={supported:!1,testSupport:function(f){!tt&&W&&(ct?pt(f):j=f)}};let j,W,tt=!1,ct=!1;function pt(f){const i=f.createTexture();f.bindTexture(f.TEXTURE_2D,i);try{if(f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,W),f.isContextLost())return;U.supported=!0}catch{}f.deleteTexture(i),tt=!0}var nt,it;typeof document<"u"&&(W=document.createElement("img"),W.onload=function(){j&&pt(j),j=null,ct=!0},W.onerror=function(){tt=!0,j=null},W.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(f){let i,a,h,p;f.resetRequestQueue=()=>{i=[],a=0,h=0,p={}},f.addThrottleControl=A=>{const M=h++;return p[M]=A,M},f.removeThrottleControl=A=>{delete p[A],w()},f.getImage=(A,M,D=!0)=>{U.supported&&(A.headers||(A.headers={}),A.headers.accept="image/webp,*/*");const F={requestParameters:A,supportImageRefresh:D,callback:M,cancelled:!1,completed:!1,cancel:()=>{F.completed||F.cancelled||(F.cancelled=!0,F.innerRequest&&(F.innerRequest.cancel(),a--),w())}};return i.push(F),w(),F};const g=A=>{const{requestParameters:M,supportImageRefresh:D,callback:F}=A;return l.e(M,{type:"image"}),(D!==!1||l.i()||l.g(M.url)||M.headers&&!Object.keys(M.headers).reduce((Z,G)=>Z&&G==="accept",!0)?l.m:T)(M,(Z,G,Y,$)=>{x(A,F,Z,G,Y,$)})},x=(A,M,D,F,Z,G)=>{D?M(D):F instanceof HTMLImageElement||l.a(F)?M(null,F):F&&((Y,$)=>{typeof createImageBitmap=="function"?l.b(Y,$):l.d(Y,$)})(F,(Y,$)=>{Y!=null?M(Y):$!=null&&M(null,$,{cacheControl:Z,expires:G})}),A.cancelled||(A.completed=!0,a--,w())},w=()=>{const A=(()=>{const M=Object.keys(p);let D=!1;if(M.length>0){for(const F of M)if(D=p[F](),D)break}return D})()?l.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let M=a;M<A&&i.length>0;M++){const D=i.shift();if(D.cancelled){M--;continue}const F=g(D);a++,D.innerRequest=F}},T=(A,M)=>{const D=new Image,F=A.url;let Z=!1;const G=A.credentials;return G&&G==="include"?D.crossOrigin="use-credentials":(G&&G==="same-origin"||!l.s(F))&&(D.crossOrigin="anonymous"),D.fetchPriority="high",D.onload=()=>{M(null,D),D.onerror=D.onload=null},D.onerror=()=>{Z||M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),D.onerror=D.onload=null},D.src=F,{cancel:()=>{Z=!0,D.src=""}}}}(nt||(nt={})),nt.resetRequestQueue(),function(f){f.Glyphs="Glyphs",f.Image="Image",f.Source="Source",f.SpriteImage="SpriteImage",f.SpriteJSON="SpriteJSON",f.Style="Style",f.Tile="Tile",f.Unknown="Unknown"}(it||(it={}));class It{constructor(i){this._transformRequestFn=i}transformRequest(i,a){return this._transformRequestFn&&this._transformRequestFn(i,a)||{url:i}}normalizeSpriteURL(i,a,h){const p=function(g){const x=g.match(_t);if(!x)throw new Error(`Unable to parse URL "${g}"`);return{protocol:x[1],authority:x[2],path:x[3]||"/",params:x[4]?x[4].split("&"):[]}}(i);return p.path+=`${a}${h}`,function(g){const x=g.params.length?`?${g.params.join("&")}`:"";return`${g.protocol}://${g.authority}${g.path}${x}`}(p)}setTransformRequest(i){this._transformRequestFn=i}}const _t=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function gt(f){var i=new l.A(3);return i[0]=f[0],i[1]=f[1],i[2]=f[2],i}var kt,Lt=function(f,i,a){return f[0]=i[0]-a[0],f[1]=i[1]-a[1],f[2]=i[2]-a[2],f};kt=new l.A(3),l.A!=Float32Array&&(kt[0]=0,kt[1]=0,kt[2]=0);var Vt=function(f){var i=f[0],a=f[1];return i*i+a*a};function Rt(f){const i=[];if(typeof f=="string")i.push({id:"default",url:f});else if(f&&f.length>0){const a=[];for(const{id:h,url:p}of f){const g=`${h}${p}`;a.indexOf(g)===-1&&(a.push(g),i.push({id:h,url:p}))}}return i}function Qt(f,i,a,h,p){if(h)return void f(h);if(p!==Object.values(i).length||p!==Object.values(a).length)return;const g={};for(const x in i){g[x]={};const w=l.h.getImageCanvasContext(a[x]),T=i[x];for(const A in T){const{width:M,height:D,x:F,y:Z,sdf:G,pixelRatio:Y,stretchX:$,stretchY:lt,content:yt}=T[A];g[x][A]={data:null,pixelRatio:Y,sdf:G,stretchX:$,stretchY:lt,content:yt,spriteData:{width:M,height:D,x:F,y:Z,context:w}}}}f(null,g)}(function(){var f=new l.A(2);l.A!=Float32Array&&(f[0]=0,f[1]=0)})();class Ut{constructor(i,a,h,p){this.context=i,this.format=h,this.texture=i.gl.createTexture(),this.update(a,p)}update(i,a,h){const{width:p,height:g}=i,x=!(this.size&&this.size[0]===p&&this.size[1]===g||h),{context:w}=this,{gl:T}=w;if(this.useMipmap=!!(a&&a.useMipmap),T.bindTexture(T.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!a||a.premultiply!==!1)),x)this.size=[p,g],i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||l.a(i)?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,i):T.texImage2D(T.TEXTURE_2D,0,this.format,p,g,0,this.format,T.UNSIGNED_BYTE,i.data);else{const{x:A,y:M}=h||{x:0,y:0};i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||l.a(i)?T.texSubImage2D(T.TEXTURE_2D,0,A,M,T.RGBA,T.UNSIGNED_BYTE,i):T.texSubImage2D(T.TEXTURE_2D,0,A,M,p,g,T.RGBA,T.UNSIGNED_BYTE,i.data)}this.useMipmap&&this.isSizePowerOfTwo()&&T.generateMipmap(T.TEXTURE_2D)}bind(i,a,h){const{context:p}=this,{gl:g}=p;g.bindTexture(g.TEXTURE_2D,this.texture),h!==g.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(h=g.LINEAR),i!==this.filter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,i),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,h||i),this.filter=i),a!==this.wrap&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,a),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}function me(f){const{userImage:i}=f;return!!(i&&i.render&&i.render())&&(f.data.replace(new Uint8Array(i.data.buffer)),!0)}class jt extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:a,callback:h}of this.requestors)this._notify(a,h);this.requestors=[]}}getImage(i){const a=this.images[i];if(a&&!a.data&&a.spriteData){const h=a.spriteData;a.data=new l.R({width:h.width,height:h.height},h.context.getImageData(h.x,h.y,h.width,h.height).data),a.spriteData=null}return a}addImage(i,a){if(this.images[i])throw new Error(`Image id ${i} already exist, use updateImage instead`);this._validate(i,a)&&(this.images[i]=a)}_validate(i,a){let h=!0;const p=a.data||a.spriteData;return this._validateStretch(a.stretchX,p&&p.width)||(this.fire(new l.j(new Error(`Image "${i}" has invalid "stretchX" value`))),h=!1),this._validateStretch(a.stretchY,p&&p.height)||(this.fire(new l.j(new Error(`Image "${i}" has invalid "stretchY" value`))),h=!1),this._validateContent(a.content,a)||(this.fire(new l.j(new Error(`Image "${i}" has invalid "content" value`))),h=!1),h}_validateStretch(i,a){if(!i)return!0;let h=0;for(const p of i){if(p[0]<h||p[1]<p[0]||a<p[1])return!1;h=p[1]}return!0}_validateContent(i,a){if(!i)return!0;if(i.length!==4)return!1;const h=a.spriteData,p=h&&h.width||a.data.width,g=h&&h.height||a.data.height;return!(i[0]<0||p<i[0]||i[1]<0||g<i[1]||i[2]<0||p<i[2]||i[3]<0||g<i[3]||i[2]<i[0]||i[3]<i[1])}updateImage(i,a,h=!0){const p=this.getImage(i);if(h&&(p.data.width!==a.data.width||p.data.height!==a.data.height))throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=p.version+1,this.images[i]=a,this.updatedImages[i]=!0}removeImage(i){const a=this.images[i];delete this.images[i],delete this.patterns[i],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i,a){let h=!0;if(!this.isLoaded())for(const p of i)this.images[p]||(h=!1);this.isLoaded()||h?this._notify(i,a):this.requestors.push({ids:i,callback:a})}_notify(i,a){const h={};for(const p of i){let g=this.getImage(p);g||(this.fire(new l.k("styleimagemissing",{id:p})),g=this.getImage(p)),g?h[p]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,hasRenderCallback:!!(g.userImage&&g.userImage.render)}:l.w(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}a(null,h)}getPixelSize(){const{width:i,height:a}=this.atlasImage;return{width:i,height:a}}getPattern(i){const a=this.patterns[i],h=this.getImage(i);if(!h)return null;if(a&&a.position.version===h.version)return a.position;if(a)a.position.version=h.version;else{const p={w:h.data.width+2,h:h.data.height+2,x:0,y:0},g=new l.I(p,h);this.patterns[i]={bin:p,position:g}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const a=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Ut(i,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const g in this.patterns)i.push(this.patterns[g].bin);const{w:a,h}=l.p(i),p=this.atlasImage;p.resize({width:a||1,height:h||1});for(const g in this.patterns){const{bin:x}=this.patterns[g],w=x.x+1,T=x.y+1,A=this.getImage(g).data,M=A.width,D=A.height;l.R.copy(A,p,{x:0,y:0},{x:w,y:T},{width:M,height:D}),l.R.copy(A,p,{x:0,y:D-1},{x:w,y:T-1},{width:M,height:1}),l.R.copy(A,p,{x:0,y:0},{x:w,y:T+D},{width:M,height:1}),l.R.copy(A,p,{x:M-1,y:0},{x:w-1,y:T},{width:1,height:D}),l.R.copy(A,p,{x:0,y:0},{x:w+M,y:T},{width:1,height:D})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const a of i){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const h=this.getImage(a);h||l.w(`Image with ID: "${a}" was not found`),me(h)&&this.updateImage(a,h)}}}const Bt=1e20;function ae(f,i,a,h,p,g,x,w,T){for(let A=i;A<i+h;A++)he(f,a*g+A,g,p,x,w,T);for(let A=a;A<a+p;A++)he(f,A*g+i,1,h,x,w,T)}function he(f,i,a,h,p,g,x){g[0]=0,x[0]=-Bt,x[1]=Bt,p[0]=f[i];for(let w=1,T=0,A=0;w<h;w++){p[w]=f[i+w*a];const M=w*w;do{const D=g[T];A=(p[w]-p[D]+M-D*D)/(w-D)/2}while(A<=x[T]&&--T>-1);T++,g[T]=w,x[T]=A,x[T+1]=Bt}for(let w=0,T=0;w<h;w++){for(;x[T+1]<w;)T++;const A=g[T],M=w-A;f[i+w*a]=p[A]+M*M}}class ve{constructor(i,a){this.requestManager=i,this.localIdeographFontFamily=a,this.entries={}}setURL(i){this.url=i}getGlyphs(i,a){const h=[];for(const p in i)for(const g of i[p])h.push({stack:p,id:g});l.o(h,({stack:p,id:g},x)=>{let w=this.entries[p];w||(w=this.entries[p]={glyphs:{},requests:{},ranges:{}});let T=w.glyphs[g];if(T!==void 0)return void x(null,{stack:p,id:g,glyph:T});if(T=this._tinySDF(w,p,g),T)return w.glyphs[g]=T,void x(null,{stack:p,id:g,glyph:T});const A=Math.floor(g/256);if(256*A>65535)return void x(new Error("glyphs > 65535 not supported"));if(w.ranges[A])return void x(null,{stack:p,id:g,glyph:T});if(!this.url)return void x(new Error("glyphsUrl is not set"));let M=w.requests[A];M||(M=w.requests[A]=[],ve.loadGlyphRange(p,A,this.url,this.requestManager,(D,F)=>{if(F){for(const Z in F)this._doesCharSupportLocalGlyph(+Z)||(w.glyphs[+Z]=F[+Z]);w.ranges[A]=!0}for(const Z of M)Z(D,F);delete w.requests[A]})),M.push((D,F)=>{D?x(D):F&&x(null,{stack:p,id:g,glyph:F[g]||null})})},(p,g)=>{if(p)a(p);else if(g){const x={};for(const{stack:w,id:T,glyph:A}of g)(x[w]||(x[w]={}))[T]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics};a(null,x)}})}_doesCharSupportLocalGlyph(i){return!!this.localIdeographFontFamily&&(l.u["CJK Unified Ideographs"](i)||l.u["Hangul Syllables"](i)||l.u.Hiragana(i)||l.u.Katakana(i))}_tinySDF(i,a,h){const p=this.localIdeographFontFamily;if(!p||!this._doesCharSupportLocalGlyph(h))return;let g=i.tinySDF;if(!g){let w="400";/bold/i.test(a)?w="900":/medium/i.test(a)?w="500":/light/i.test(a)&&(w="200"),g=i.tinySDF=new ve.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:p,fontWeight:w})}const x=g.draw(String.fromCharCode(h));return{id:h,bitmap:new l.q({width:x.width||60,height:x.height||60},x.data),metrics:{width:x.glyphWidth/2||24,height:x.glyphHeight/2||24,left:x.glyphLeft/2+.5||0,top:x.glyphTop/2-27.5||-8,advance:x.glyphAdvance/2||24,isDoubleResolution:!0}}}}ve.loadGlyphRange=function(f,i,a,h,p){const g=256*i,x=g+255,w=h.transformRequest(a.replace("{fontstack}",f).replace("{range}",`${g}-${x}`),it.Glyphs);l.l(w,(T,A)=>{if(T)p(T);else if(A){const M={};for(const D of l.n(A))M[D.id]=D;p(null,M)}})},ve.TinySDF=class{constructor({fontSize:f=24,buffer:i=3,radius:a=8,cutoff:h=.25,fontFamily:p="sans-serif",fontWeight:g="normal",fontStyle:x="normal"}={}){this.buffer=i,this.cutoff=h,this.radius=a;const w=this.size=f+4*i,T=this._createCanvas(w),A=this.ctx=T.getContext("2d",{willReadFrequently:!0});A.font=`${x} ${g} ${f}px ${p}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(f){const i=document.createElement("canvas");return i.width=i.height=f,i}draw(f){const{width:i,actualBoundingBoxAscent:a,actualBoundingBoxDescent:h,actualBoundingBoxLeft:p,actualBoundingBoxRight:g}=this.ctx.measureText(f),x=Math.ceil(a),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-p))),T=Math.min(this.size-this.buffer,x+Math.ceil(h)),A=w+2*this.buffer,M=T+2*this.buffer,D=Math.max(A*M,0),F=new Uint8ClampedArray(D),Z={data:F,width:A,height:M,glyphWidth:w,glyphHeight:T,glyphTop:x,glyphLeft:0,glyphAdvance:i};if(w===0||T===0)return Z;const{ctx:G,buffer:Y,gridInner:$,gridOuter:lt}=this;G.clearRect(Y,Y,w,T),G.fillText(f,Y,Y+x);const yt=G.getImageData(Y,Y,w,T);lt.fill(Bt,0,D),$.fill(0,0,D);for(let Q=0;Q<T;Q++)for(let ut=0;ut<w;ut++){const xt=yt.data[4*(Q*w+ut)+3]/255;if(xt===0)continue;const St=(Q+Y)*A+ut+Y;if(xt===1)lt[St]=0,$[St]=Bt;else{const Mt=.5-xt;lt[St]=Mt>0?Mt*Mt:0,$[St]=Mt<0?Mt*Mt:0}}ae(lt,0,0,A,M,A,this.f,this.v,this.z),ae($,Y,Y,w,T,A,this.f,this.v,this.z);for(let Q=0;Q<D;Q++){const ut=Math.sqrt(lt[Q])-Math.sqrt($[Q]);F[Q]=Math.round(255-255*(ut/this.radius+this.cutoff))}return Z}};class se{constructor(){this.specification=l.v.light.position}possiblyEvaluate(i,a){return l.z(i.expression.evaluate(a))}interpolate(i,a,h){return{x:l.B.number(i.x,a.x,h),y:l.B.number(i.y,a.y,h),z:l.B.number(i.z,a.z,h)}}}let ne;class ie extends l.E{constructor(i){super(),ne=ne||new l.r({anchor:new l.D(l.v.light.anchor),position:new se,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.T(ne),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,a={}){if(!this._validate(l.t,i,a))for(const h in i){const p=i[h];h.endsWith("-transition")?this._transitionable.setTransition(h.slice(0,-11),p):this._transitionable.setValue(h,p)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,a,h){return(!h||h.validate!==!1)&&l.x(this,i.call(l.y,l.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:l.v})))}}class ci{constructor(i,a){this.width=i,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(i,a){const h=i.join(",")+String(a);return this.dashEntry[h]||(this.dashEntry[h]=this.addDash(i,a)),this.dashEntry[h]}getDashRanges(i,a,h){const p=[];let g=i.length%2==1?-i[i.length-1]*h:0,x=i[0]*h,w=!0;p.push({left:g,right:x,isDash:w,zeroLength:i[0]===0});let T=i[0];for(let A=1;A<i.length;A++){w=!w;const M=i[A];g=T*h,T+=M,x=T*h,p.push({left:g,right:x,isDash:w,zeroLength:M===0})}return p}addRoundDash(i,a,h){const p=a/2;for(let g=-h;g<=h;g++){const x=this.width*(this.nextRow+h+g);let w=0,T=i[w];for(let A=0;A<this.width;A++){A/T.right>1&&(T=i[++w]);const M=Math.abs(A-T.left),D=Math.abs(A-T.right),F=Math.min(M,D);let Z;const G=g/h*(p+1);if(T.isDash){const Y=p-Math.abs(G);Z=Math.sqrt(F*F+Y*Y)}else Z=p-Math.sqrt(F*F+G*G);this.data[x+A]=Math.max(0,Math.min(255,Z+128))}}}addRegularDash(i){for(let w=i.length-1;w>=0;--w){const T=i[w],A=i[w+1];T.zeroLength?i.splice(w,1):A&&A.isDash===T.isDash&&(A.left=T.left,i.splice(w,1))}const a=i[0],h=i[i.length-1];a.isDash===h.isDash&&(a.left=h.left-this.width,h.right=a.right+this.width);const p=this.width*this.nextRow;let g=0,x=i[g];for(let w=0;w<this.width;w++){w/x.right>1&&(x=i[++g]);const T=Math.abs(w-x.left),A=Math.abs(w-x.right),M=Math.min(T,A);this.data[p+w]=Math.max(0,Math.min(255,(x.isDash?M:-M)+128))}}addDash(i,a){const h=a?7:0,p=2*h+1;if(this.nextRow+p>this.height)return l.w("LineAtlas out of space"),null;let g=0;for(let w=0;w<i.length;w++)g+=i[w];if(g!==0){const w=this.width/g,T=this.getDashRanges(i,this.width,w);a?this.addRoundDash(T,w,h):this.addRegularDash(T)}const x={y:(this.nextRow+h+.5)/this.height,height:2*h/this.height,width:g};return this.nextRow+=p,this.dirty=!0,x}bind(i){const a=i.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}class ti{constructor(i,a,h){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=h;const p=this.workerPool.acquire(h);for(let g=0;g<p.length;g++){const x=new l.C(p[g],a,h);x.name=`Worker ${g}`,this.actors.push(x)}if(!this.actors.length)throw new Error("No actors found")}broadcast(i,a,h){l.o(this.actors,(p,g)=>{p.send(i,a,g)},h=h||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(i=!0){this.actors.forEach(a=>{a.remove()}),this.actors=[],i&&this.workerPool.release(this.id)}}function mi(f,i,a){const h=function(p,g){if(p)return a(p);if(g){const x=l.F(l.e(g,f),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);g.vector_layers&&(x.vectorLayers=g.vector_layers,x.vectorLayerIds=x.vectorLayers.map(w=>w.id)),a(null,x)}};return f.url?l.f(i.transformRequest(f.url,it.Source),h):l.h.frame(()=>h(null,f))}class di{constructor(i,a){i&&(a?this.setSouthWest(i).setNorthEast(a):Array.isArray(i)&&(i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1])))}setNorthEast(i){return this._ne=i instanceof l.L?new l.L(i.lng,i.lat):l.L.convert(i),this}setSouthWest(i){return this._sw=i instanceof l.L?new l.L(i.lng,i.lat):l.L.convert(i),this}extend(i){const a=this._sw,h=this._ne;let p,g;if(i instanceof l.L)p=i,g=i;else{if(!(i instanceof di))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(di.convert(i)):this.extend(l.L.convert(i)):i&&("lng"in i||"lon"in i)&&"lat"in i?this.extend(l.L.convert(i)):this;if(p=i._sw,g=i._ne,!p||!g)return this}return a||h?(a.lng=Math.min(p.lng,a.lng),a.lat=Math.min(p.lat,a.lat),h.lng=Math.max(g.lng,h.lng),h.lat=Math.max(g.lat,h.lat)):(this._sw=new l.L(p.lng,p.lat),this._ne=new l.L(g.lng,g.lat)),this}getCenter(){return new l.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.L(this.getWest(),this.getNorth())}getSouthEast(){return new l.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:a,lat:h}=l.L.convert(i);let p=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&p}static convert(i){return i instanceof di?i:i&&new di(i)}static fromLngLat(i,a=0){const h=360*a/40075017,p=h/Math.cos(Math.PI/180*i.lat);return new di(new l.L(i.lng-p,i.lat-h),new l.L(i.lng+p,i.lat+h))}}class ke{constructor(i,a,h){this.bounds=di.convert(this.validateBounds(i)),this.minzoom=a||0,this.maxzoom=h||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const a=Math.pow(2,i.z),h=Math.floor(l.G(this.bounds.getWest())*a),p=Math.floor(l.H(this.bounds.getNorth())*a),g=Math.ceil(l.G(this.bounds.getEast())*a),x=Math.ceil(l.H(this.bounds.getSouth())*a);return i.x>=h&&i.x<g&&i.y>=p&&i.y<x}}class Xe extends l.E{constructor(i,a,h,p){if(super(),this.load=()=>{this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=mi(this._options,this.map._requestManager,(g,x)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),g?this.fire(new l.j(g)):x&&(l.e(this,x),x.bounds&&(this.tileBounds=new ke(x.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>l.e({},this._options),this.id=i,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.F(a,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p)}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}setSourceProperty(i){this._tileJSONRequest&&this._tileJSONRequest.cancel(),i(),this.load()}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}setUrl(i){return this.setSourceProperty(()=>{this.url=i,this._options.url=i}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(i,a){const h=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(h,it.Tile),uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function g(x,w){return delete i.request,i.aborted?a(null):x&&x.status!==404?a(x):(w&&w.resourceTiming&&(i.resourceTiming=w.resourceTiming),this.map._refreshExpiredTiles&&w&&i.setExpiryData(w),i.loadVectorData(w,this.map.painter),a(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}p.request.collectResourceTiming=this._collectResourceTiming,i.actor&&i.state!=="expired"?i.state==="loading"?i.reloadCallback=a:i.request=i.actor.send("reloadTile",p,g.bind(this)):(i.actor=this.dispatcher.getActor(),i.request=i.actor.send("loadTile",p,g.bind(this)))}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id},void 0)}unloadTile(i){i.unloadVectorData(),i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class xi extends l.E{constructor(i,a,h,p){super(),this.id=i,this.dispatcher=h,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},a),l.e(this,l.F(a,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=mi(this._options,this.map._requestManager,(i,a)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new l.j(i)):a&&(l.e(this,a),a.bounds&&(this.tileBounds=new ke(a.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(i){this._tileJSONRequest&&this._tileJSONRequest.cancel(),i(),this.load()}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}serialize(){return l.e({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,a){const h=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);i.request=nt.getImage(this.map._requestManager.transformRequest(h,it.Tile),(p,g,x)=>{if(delete i.request,i.aborted)i.state="unloaded",a(null);else if(p)i.state="errored",a(p);else if(g){this.map._refreshExpiredTiles&&x&&i.setExpiryData(x);const w=this.map.painter.context,T=w.gl;i.texture=this.map.painter.getTileTexture(g.width),i.texture?i.texture.update(g,{useMipmap:!0}):(i.texture=new Ut(w,g,T.RGBA,{useMipmap:!0}),i.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST),w.extTextureFilterAnisotropic&&T.texParameterf(T.TEXTURE_2D,w.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,w.extTextureFilterAnisotropicMax)),i.state="loaded",a(null)}},this.map._refreshExpiredTiles)}abortTile(i,a){i.request&&(i.request.cancel(),delete i.request),a()}unloadTile(i,a){i.texture&&this.map.painter.saveTileTexture(i.texture),a()}hasTransition(){return!1}}class ye extends xi{constructor(i,a,h,p){super(i,a,h,p),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(i,a){const h=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p=this.map._requestManager.transformRequest(h,it.Tile);function g(x,w){x&&(i.state="errored",a(x)),w&&(i.dem=w,i.needsHillshadePrepare=!0,i.needsTerrainPrepare=!0,i.state="loaded",a(null))}i.neighboringTiles=this._getNeighboringTiles(i.tileID),i.request=nt.getImage(p,(x,w,T)=>l._(this,void 0,void 0,function*(){if(delete i.request,i.aborted)i.state="unloaded",a(null);else if(x)i.state="errored",a(x);else if(w){this.map._refreshExpiredTiles&&i.setExpiryData(T);const A=l.a(w)&&l.J()?w:yield function(D){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.K()){const F=D.width+2,Z=D.height+2;try{return new l.R({width:F,height:Z},yield l.M(D,-1,-1,F,Z))}catch{}}return l.h.getImageData(D,1)})}(w),M={uid:i.uid,coord:i.tileID,source:this.id,rawImageData:A,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};i.actor&&i.state!=="expired"||(i.actor=this.dispatcher.getActor(),i.actor.send("loadDEMTile",M,g))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(i){const a=i.canonical,h=Math.pow(2,a.z),p=(a.x-1+h)%h,g=a.x===0?i.wrap-1:i.wrap,x=(a.x+1+h)%h,w=a.x+1===h?i.wrap+1:i.wrap,T={};return T[new l.O(i.overscaledZ,g,a.z,p,a.y).key]={backfilled:!1},T[new l.O(i.overscaledZ,w,a.z,x,a.y).key]={backfilled:!1},a.y>0&&(T[new l.O(i.overscaledZ,g,a.z,p,a.y-1).key]={backfilled:!1},T[new l.O(i.overscaledZ,i.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},T[new l.O(i.overscaledZ,w,a.z,x,a.y-1).key]={backfilled:!1}),a.y+1<h&&(T[new l.O(i.overscaledZ,g,a.z,p,a.y+1).key]={backfilled:!1},T[new l.O(i.overscaledZ,i.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},T[new l.O(i.overscaledZ,w,a.z,x,a.y+1).key]={backfilled:!1}),T}unloadTile(i){i.demTexture&&this.map.painter.saveTileTexture(i.demTexture),i.fbo&&(i.fbo.destroy(),delete i.fbo),i.dem&&delete i.dem,delete i.neighboringTiles,i.state="unloaded",i.actor&&i.actor.send("removeDEMTile",{uid:i.uid,source:this.id})}}class Xt extends l.E{constructor(i,a,h,p){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>l.e({},this._options,{type:this.type,data:this._data}),this.id=i,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=h.getActor(),this.setEventedParent(p),this._data=a.data,this._options=l.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const g=l.N/this.tileSize;this.workerOptions=l.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(a.buffer!==void 0?a.buffer:128)*g,tolerance:(a.tolerance!==void 0?a.tolerance:.375)*g,extent:l.N,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:a.clusterMaxZoom!==void 0?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:l.N,radius:(a.clusterRadius||50)*g,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(i){this.map=i,this.load()}setData(i){return this._data=i,this._updateWorkerData(),this}updateData(i){return this._updateWorkerData(i),this}setClusterOptions(i){return this.workerOptions.cluster=i.cluster,i&&(i.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=i.clusterRadius),i.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=i.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(i,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:i,source:this.id},a),this}getClusterChildren(i,a){return this.actor.send("geojson.getClusterChildren",{clusterId:i,source:this.id},a),this}getClusterLeaves(i,a,h,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:i,limit:a,offset:h},p),this}_updateWorkerData(i){const a=l.e({},this.workerOptions);i?a.dataDiff=i:typeof this._data=="string"?(a.request=this.map._requestManager.transformRequest(l.h.resolveURL(this._data),it.Source),a.request.collectResourceTiming=this._collectResourceTiming):a.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,a,(h,p)=>{if(this._pendingLoads--,this._removed||p&&p.abandoned)return void this.fire(new l.k("dataabort",{dataType:"source"}));let g=null;if(p&&p.resourceTiming&&p.resourceTiming[this.id]&&(g=p.resourceTiming[this.id].slice(0)),h)return void this.fire(new l.j(h));const x={dataType:"source"};this._collectResourceTiming&&g&&g.length>0&&l.e(x,{resourceTiming:g}),this.fire(new l.k("data",Object.assign(Object.assign({},x),{sourceDataType:"metadata"}))),this.fire(new l.k("data",Object.assign(Object.assign({},x),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(i,a){const h=i.actor?"reloadTile":"loadTile";i.actor=this.actor;const p={type:this.type,uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};i.request=this.actor.send(h,p,(g,x)=>(delete i.request,i.unloadVectorData(),i.aborted?a(null):g?a(g):(i.loadVectorData(x,this.map.painter,h==="reloadTile"),a(null))))}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.aborted=!0}unloadTile(i){i.unloadVectorData(),this.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var ze=l.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Mi extends l.E{constructor(i,a,h,p){super(),this.load=(g,x)=>{this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=nt.getImage(this.map._requestManager.transformRequest(this.url,it.Image),(w,T)=>{this._request=null,this._loaded=!0,w?this.fire(new l.j(w)):T&&(this.image=T,g&&(this.coordinates=g),x&&x(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const g=this.map.painter.context,x=g.gl;this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,ze.members)),this.boundsSegments||(this.boundsSegments=l.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Ut(g,this.image,x.RGBA),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE));let w=!1;for(const T in this.tiles){const A=this.tiles[T];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,w=!0)}w&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=i,this.dispatcher=h,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(p),this.options=a}loaded(){return this._loaded}updateImage(i){return i.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=i.url,this.load(i.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(i){this.coordinates=i;const a=i.map(l.U.fromLngLat);this.tileID=function(p){let g=1/0,x=1/0,w=-1/0,T=-1/0;for(const F of p)g=Math.min(g,F.x),x=Math.min(x,F.y),w=Math.max(w,F.x),T=Math.max(T,F.y);const A=Math.max(w-g,T-x),M=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),D=Math.pow(2,M);return new l.W(M,Math.floor((g+w)/2*D),Math.floor((x+T)/2*D))}(a),this.minzoom=this.maxzoom=this.tileID.z;const h=a.map(p=>this.tileID.getTilePoint(p)._round());return this._boundsArray=new l.V,this._boundsArray.emplaceBack(h[0].x,h[0].y,0,0),this._boundsArray.emplaceBack(h[1].x,h[1].y,l.N,0),this._boundsArray.emplaceBack(h[3].x,h[3].y,0,l.N),this._boundsArray.emplaceBack(h[2].x,h[2].y,l.N,l.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(i,a){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},a(null)):(i.state="errored",a(null))}hasTransition(){return!1}}class en extends Mi{constructor(i,a,h,p){super(i,a,h,p),this.load=()=>{this._loaded=!1;const g=this.options;this.urls=[];for(const x of g.urls)this.urls.push(this.map._requestManager.transformRequest(x,it.Source).url);l.X(this.urls,(x,w)=>{this._loaded=!0,x?this.fire(new l.j(x)):w&&(this.video=w,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const g=this.map.painter.context,x=g.gl;this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,ze.members)),this.boundsSegments||(this.boundsSegments=l.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE),x.texSubImage2D(x.TEXTURE_2D,0,0,0,x.RGBA,x.UNSIGNED_BYTE,this.video)):(this.texture=new Ut(g,this.video,x.RGBA),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE));let w=!1;for(const T in this.tiles){const A=this.tiles[T];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,w=!0)}w&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=a}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(i){if(this.video){const a=this.video.seekable;i<a.start(0)||i>a.end(0)?this.fire(new l.j(new l.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=i}}getVideo(){return this.video}onAdd(i){this.map||(this.map=i,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class lr extends Mi{constructor(i,a,h,p){super(i,a,h,p),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const x=this.map.painter.context,w=x.gl;this.boundsBuffer||(this.boundsBuffer=x.createVertexBuffer(this._boundsArray,ze.members)),this.boundsSegments||(this.boundsSegments=l.S.simpleSegment(0,0,4,2)),this.texture?(g||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Ut(x,this.canvas,w.RGBA,{premultiply:!0});let T=!1;for(const A in this.tiles){const M=this.tiles[A];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture,T=!0)}T&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(x=>typeof x!="number"))||this.fire(new l.j(new l.Y(`sources.${i}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.j(new l.Y(`sources.${i}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new l.j(new l.Y(`sources.${i}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new l.j(new l.Y(`sources.${i}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.j(new l.Y(`sources.${i}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}getCanvas(){return this.canvas}onAdd(i){this.map=i,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const i of[this.canvas.width,this.canvas.height])if(isNaN(i)||i<=0)return!0;return!1}}const wn={},ir=f=>{switch(f){case"geojson":return Xt;case"image":return Mi;case"raster":return xi;case"raster-dem":return ye;case"vector":return Xe;case"video":return en;case"canvas":return lr}return wn[f]};function yr(f,i){const a=l.Z();return l.$(a,a,[1,1,0]),l.a0(a,a,[.5*f.width,.5*f.height,1]),l.a1(a,a,f.calculatePosMatrix(i.toUnwrapped()))}function Pr(f,i,a,h,p,g){const x=function(D,F,Z){if(D)for(const G of D){const Y=F[G];if(Y&&Y.source===Z&&Y.type==="fill-extrusion")return!0}else for(const G in F){const Y=F[G];if(Y.source===Z&&Y.type==="fill-extrusion")return!0}return!1}(p&&p.layers,i,f.id),w=g.maxPitchScaleFactor(),T=f.tilesIn(h,w,x);T.sort(rn);const A=[];for(const D of T)A.push({wrappedTileID:D.tileID.wrapped().key,queryResults:D.tile.queryRenderedFeatures(i,a,f._state,D.queryGeometry,D.cameraQueryGeometry,D.scale,p,g,w,yr(f.transform,D.tileID))});const M=function(D){const F={},Z={};for(const G of D){const Y=G.queryResults,$=G.wrappedTileID,lt=Z[$]=Z[$]||{};for(const yt in Y){const Q=Y[yt],ut=lt[yt]=lt[yt]||{},xt=F[yt]=F[yt]||[];for(const St of Q)ut[St.featureIndex]||(ut[St.featureIndex]=!0,xt.push(St))}}return F}(A);for(const D in M)M[D].forEach(F=>{const Z=F.feature,G=f.getFeatureState(Z.layer["source-layer"],Z.id);Z.source=Z.layer.source,Z.layer["source-layer"]&&(Z.sourceLayer=Z.layer["source-layer"]),Z.state=G});return M}function rn(f,i){const a=f.tileID,h=i.tileID;return a.overscaledZ-h.overscaledZ||a.canonical.y-h.canonical.y||a.wrap-h.wrap||a.canonical.x-h.canonical.x}class Gr{constructor(i,a){this.timeAdded=0,this.fadeEndTime=0,this.tileID=i,this.uid=l.a2(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(i){const a=i+this.timeAdded;a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(i){this.demTexture&&i.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(i,a,h){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(p,g){const x={};if(!g)return x;for(const w of p){const T=w.layerIds.map(A=>g.getLayer(A)).filter(Boolean);if(T.length!==0){w.layers=T,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(A=>T.filter(M=>M.id===A)[0]));for(const A of T)x[A.id]=w}}return x}(i.buckets,a.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const g=this.buckets[p];if(g instanceof l.a4){if(this.hasSymbolBuckets=!0,!h)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const g=this.buckets[p];if(g instanceof l.a4&&g.hasRTLText){this.hasRTLText=!0,l.a5();break}}this.queryPadding=0;for(const p in this.buckets){const g=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(p).queryRadius(g))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage)}else this.collisionBoxArray=new l.a3}unloadVectorData(){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(i){return this.buckets[i.id]}upload(i){for(const h in this.buckets){const p=this.buckets[h];p.uploadPending()&&p.upload(i)}const a=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ut(i,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ut(i,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,a,h,p,g,x,w,T,A,M){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:g,scale:x,tileSize:this.tileSize,pixelPosMatrix:M,transform:T,params:w,queryPadding:this.queryPadding*A},i,a,h):{}}querySourceFeatures(i,a){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const p=h.loadVTLayers(),g=a&&a.sourceLayer?a.sourceLayer:"",x=p._geojsonTileLayer||p[g];if(!x)return;const w=l.a6(a&&a.filter),{z:T,x:A,y:M}=this.tileID.canonical,D={z:T,x:A,y:M};for(let F=0;F<x.length;F++){const Z=x.feature(F);if(w.needGeometry){const $=l.a7(Z,!0);if(!w.filter(new l.a8(this.tileID.overscaledZ),$,this.tileID.canonical))continue}else if(!w.filter(new l.a8(this.tileID.overscaledZ),Z))continue;const G=h.getId(Z,g),Y=new l.a9(Z,T,A,M,G);Y.tile=D,i.push(Y)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const a=this.expirationTime;if(i.cacheControl){const h=l.aa(i.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const h=Date.now();let p=!1;if(this.expirationTime>h)p=!1;else if(a)if(this.expirationTime<a)p=!0;else{const g=this.expirationTime-a;g?this.expirationTime=h+Math.max(g,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(i,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(i).length===0)return;const h=this.latestFeatureIndex.loadVTLayers();for(const p in this.buckets){if(!a.style.hasLayer(p))continue;const g=this.buckets[p],x=g.layers[0].sourceLayer||"_geojsonTileLayer",w=h[x],T=i[x];if(!w||!T||Object.keys(T).length===0)continue;g.update(T,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});const A=a&&a.style&&a.style.getLayer(p);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<l.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=l.h.now()+i}setDependencies(i,a){const h={};for(const p of a)h[p]=!0;this.dependencies[i]=h}hasDependency(i,a){for(const h of i){const p=this.dependencies[h];if(p){for(const g of a)if(p[g])return!0}}return!1}}class Sn{constructor(i,a){this.max=i,this.onRemove=a,this.reset()}reset(){for(const i in this.data)for(const a of this.data[i])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(i,a,h){const p=i.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const g={value:a,timeout:void 0};if(h!==void 0&&(g.timeout=setTimeout(()=>{this.remove(i,g)},h)),this.data[p].push(g),this.order.push(p),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const a=this.data[i].shift();return a.timeout&&clearTimeout(a.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),a.value}getByKey(i){const a=this.data[i];return a?a[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,a){if(!this.has(i))return this;const h=i.wrapped().key,p=a===void 0?0:this.data[h].indexOf(a),g=this.data[h][p];return this.data[h].splice(p,1),g.timeout&&clearTimeout(g.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(g.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(i){const a=[];for(const h in this.data)for(const p of this.data[h])i(p.value)||a.push(p);for(const h of a)this.remove(h.value.tileID,h)}}class Tt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,a,h){const p=String(a);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][p]=this.stateChanges[i][p]||{},l.e(this.stateChanges[i][p],h),this.deletedStates[i]===null){this.deletedStates[i]={};for(const g in this.state[i])g!==p&&(this.deletedStates[i][g]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][p]===null){this.deletedStates[i][p]={};for(const g in this.state[i][p])h[g]||(this.deletedStates[i][p][g]=null)}else for(const g in h)this.deletedStates[i]&&this.deletedStates[i][p]&&this.deletedStates[i][p][g]===null&&delete this.deletedStates[i][p][g]}removeFeatureState(i,a,h){if(this.deletedStates[i]===null)return;const p=String(a);if(this.deletedStates[i]=this.deletedStates[i]||{},h&&a!==void 0)this.deletedStates[i][p]!==null&&(this.deletedStates[i][p]=this.deletedStates[i][p]||{},this.deletedStates[i][p][h]=null);else if(a!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][p])for(h in this.deletedStates[i][p]={},this.stateChanges[i][p])this.deletedStates[i][p][h]=null;else this.deletedStates[i][p]=null;else this.deletedStates[i]=null}getState(i,a){const h=String(a),p=l.e({},(this.state[i]||{})[h],(this.stateChanges[i]||{})[h]);if(this.deletedStates[i]===null)return{};if(this.deletedStates[i]){const g=this.deletedStates[i][a];if(g===null)return{};for(const x in g)delete p[x]}return p}initializeTileState(i,a){i.setFeatureState(this.state,a)}coalesceChanges(i,a){const h={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const g={};for(const x in this.stateChanges[p])this.state[p][x]||(this.state[p][x]={}),l.e(this.state[p][x],this.stateChanges[p][x]),g[x]=this.state[p][x];h[p]=g}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const g={};if(this.deletedStates[p]===null)for(const x in this.state[p])g[x]={},this.state[p][x]={};else for(const x in this.deletedStates[p]){if(this.deletedStates[p][x]===null)this.state[p][x]={};else for(const w of Object.keys(this.deletedStates[p][x]))delete this.state[p][x][w];g[x]=this.state[p][x]}h[p]=h[p]||{},l.e(h[p],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(const p in i)i[p].setFeatureState(h,a)}}class Ar extends l.E{constructor(i,a,h){super(),this.id=i,this.dispatcher=h,this.on("data",p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((p,g,x,w)=>{const T=new(ir(g.type))(p,g,x,w);if(T.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${T.id}`);return T})(i,a,h,this),this._tiles={},this._cache=new Sn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Tt,this._didEmitContent=!1,this._updated=!1}onAdd(i){this.map=i,this._maxTileCacheSize=i?i._maxTileCacheSize:null,this._maxTileCacheZoomLevels=i?i._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(i)}onRemove(i){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(i)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const i in this._tiles){const a=this._tiles[i];if(a.state!=="loaded"&&a.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(i,a){return this._source.loadTile(i,a)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i,()=>{})}_abortTile(i){this._source.abortTile&&this._source.abortTile(i,()=>{}),this._source.fire(new l.k("dataabort",{tile:i,coord:i.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const h=this._tiles[a];h.upload(i),h.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(i=>i.tileID).sort(dn).map(i=>i.key)}getRenderableIds(i){const a=[];for(const h in this._tiles)this._isIdRenderable(h,i)&&a.push(this._tiles[h]);return i?a.sort((h,p)=>{const g=h.tileID,x=p.tileID,w=new l.P(g.canonical.x,g.canonical.y)._rotate(this.transform.angle),T=new l.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle);return g.overscaledZ-x.overscaledZ||T.y-w.y||T.x-w.x}).map(h=>h.tileID.key):a.map(h=>h.tileID).sort(dn).map(h=>h.key)}hasRenderableParent(i){const a=this.findLoadedParent(i,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(i,a){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(a||!this._tiles[i].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(i,"reloading")}}_reloadTile(i,a){const h=this._tiles[i];h&&(h.state!=="loading"&&(h.state=a),this._loadTile(h,this._tileLoaded.bind(this,h,i,a)))}_tileLoaded(i,a,h,p){if(p)return i.state="errored",void(p.status!==404?this._source.fire(new l.j(p,{tile:i})):this.update(this.transform,this.terrain));i.timeAdded=l.h.now(),h==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(a,i),this.getSource().type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),i.aborted||this._source.fire(new l.k("data",{dataType:"source",tile:i,coord:i.tileID}))}_backfillDEM(i){const a=this.getRenderableIds();for(let p=0;p<a.length;p++){const g=a[p];if(i.neighboringTiles&&i.neighboringTiles[g]){const x=this.getTileByID(g);h(i,x),h(x,i)}}function h(p,g){p.needsHillshadePrepare=!0,p.needsTerrainPrepare=!0;let x=g.tileID.canonical.x-p.tileID.canonical.x;const w=g.tileID.canonical.y-p.tileID.canonical.y,T=Math.pow(2,p.tileID.canonical.z),A=g.tileID.key;x===0&&w===0||Math.abs(w)>1||(Math.abs(x)>1&&(Math.abs(x+T)===1?x+=T:Math.abs(x-T)===1&&(x-=T)),g.dem&&p.dem&&(p.dem.backfillBorder(g.dem,x,w),p.neighboringTiles&&p.neighboringTiles[A]&&(p.neighboringTiles[A].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,a,h,p){for(const g in this._tiles){let x=this._tiles[g];if(p[g]||!x.hasData()||x.tileID.overscaledZ<=a||x.tileID.overscaledZ>h)continue;let w=x.tileID;for(;x&&x.tileID.overscaledZ>a+1;){const A=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[A.key],x&&x.hasData()&&(w=A)}let T=w;for(;T.overscaledZ>a;)if(T=T.scaledTo(T.overscaledZ-1),i[T.key]){p[w.key]=w;break}}}findLoadedParent(i,a){if(i.key in this._loadedParentTiles){const h=this._loadedParentTiles[i.key];return h&&h.tileID.overscaledZ>=a?h:null}for(let h=i.overscaledZ-1;h>=a;h--){const p=i.scaledTo(h),g=this._getLoadedTile(p);if(g)return g}}_getLoadedTile(i){const a=this._tiles[i.key];return a&&a.hasData()?a:this._cache.getByKey(i.wrapped().key)}updateCacheSize(i){const a=Math.ceil(i.width/this._source.tileSize)+1,h=Math.ceil(i.height/this._source.tileSize)+1,p=Math.floor(a*h*(this._maxTileCacheZoomLevels===null?l.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(g)}handleWrapJump(i){const a=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,a){const h={};for(const p in this._tiles){const g=this._tiles[p];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+a),h[g.tileID.key]=g}this._tiles=h;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(p,this._tiles[p])}}update(i,a){if(this.transform=i,this.terrain=a,!this._sourceLoaded||this._paused)return;let h;this.updateCacheSize(i),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new l.O(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y)):(h=i.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a}),this._source.hasTile&&(h=h.filter(M=>this._source.hasTile(M)))):h=[];const p=i.coveringZoomLevel(this._source),g=Math.max(p-Ar.maxOverzooming,this._source.minzoom),x=Math.max(p+Ar.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const M={};for(const D of h)if(D.canonical.z>this._source.minzoom){const F=D.scaledTo(D.canonical.z-1);M[F.key]=F;const Z=D.scaledTo(Math.max(this._source.minzoom,Math.min(D.canonical.z,5)));M[Z.key]=Z}h=h.concat(Object.values(M))}const w=h.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,w&&this.fire(new l.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const T=this._updateRetainedTiles(h,p);if(Ei(this._source.type)){const M={},D={},F=Object.keys(T),Z=l.h.now();for(const G of F){const Y=T[G],$=this._tiles[G];if(!$||$.fadeEndTime!==0&&$.fadeEndTime<=Z)continue;const lt=this.findLoadedParent(Y,g);lt&&(this._addTile(lt.tileID),M[lt.tileID.key]=lt.tileID),D[G]=Y}this._retainLoadedChildren(D,p,x,T);for(const G in M)T[G]||(this._coveredTiles[G]=!0,T[G]=M[G]);if(a){const G={},Y={};for(const $ of h)this._tiles[$.key].hasData()?G[$.key]=$:Y[$.key]=$;for(const $ in Y){const lt=Y[$].children(this._source.maxzoom);this._tiles[lt[0].key]&&this._tiles[lt[1].key]&&this._tiles[lt[2].key]&&this._tiles[lt[3].key]&&(G[lt[0].key]=T[lt[0].key]=lt[0],G[lt[1].key]=T[lt[1].key]=lt[1],G[lt[2].key]=T[lt[2].key]=lt[2],G[lt[3].key]=T[lt[3].key]=lt[3],delete Y[$])}for(const $ in Y){const lt=this.findLoadedParent(Y[$],this._source.minzoom);if(lt){G[lt.tileID.key]=T[lt.tileID.key]=lt.tileID;for(const yt in G)G[yt].isChildOf(lt.tileID)&&delete G[yt]}}for(const $ in this._tiles)G[$]||(this._coveredTiles[$]=!0)}}for(const M in T)this._tiles[M].clearFadeHold();const A=l.ab(this._tiles,T);for(const M of A){const D=this._tiles[M];D.hasSymbolBuckets&&!D.holdingForFade()?D.setHoldDuration(this.map._fadeDuration):D.hasSymbolBuckets&&!D.symbolFadeFinished()||this._removeTile(M)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(i)}_updateRetainedTiles(i,a){const h={},p={},g=Math.max(a-Ar.maxOverzooming,this._source.minzoom),x=Math.max(a+Ar.maxUnderzooming,this._source.minzoom),w={};for(const T of i){const A=this._addTile(T);h[T.key]=T,A.hasData()||a<this._source.maxzoom&&(w[T.key]=T)}this._retainLoadedChildren(w,a,x,h);for(const T of i){let A=this._tiles[T.key];if(A.hasData())continue;if(a+1>this._source.maxzoom){const D=T.children(this._source.maxzoom)[0],F=this.getTile(D);if(F&&F.hasData()){h[D.key]=D;continue}}else{const D=T.children(this._source.maxzoom);if(h[D[0].key]&&h[D[1].key]&&h[D[2].key]&&h[D[3].key])continue}let M=A.wasRequested();for(let D=T.overscaledZ-1;D>=g;--D){const F=T.scaledTo(D);if(p[F.key])break;if(p[F.key]=!0,A=this.getTile(F),!A&&M&&(A=this._addTile(F)),A){const Z=A.hasData();if((M||Z)&&(h[F.key]=F),M=A.wasRequested(),Z)break}}}return h}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const a=[];let h,p=this._tiles[i].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){h=this._loadedParentTiles[p.key];break}a.push(p.key);const g=p.scaledTo(p.overscaledZ-1);if(h=this._getLoadedTile(g),h)break;p=g}for(const g of a)this._loadedParentTiles[g]=h}}_addTile(i){let a=this._tiles[i.key];if(a)return a;a=this._cache.getAndRemove(i),a&&(this._setTileReloadTimer(i.key,a),a.tileID=i,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,a)));const h=a;return a||(a=new Gr(i,this._source.tileSize*i.overscaleFactor()),this._loadTile(a,this._tileLoaded.bind(this,a,i.key,a.state))),a.uses++,this._tiles[i.key]=a,h||this._source.fire(new l.k("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(i,a){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const h=a.getExpiryTimeout();h&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},h))}_removeTile(i){const a=this._tiles[i];a&&(a.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(i);this._cache.reset()}tilesIn(i,a,h){const p=[],g=this.transform;if(!g)return p;const x=h?g.getCameraQueryGeometry(i):i,w=i.map(G=>g.pointCoordinate(G,this.terrain)),T=x.map(G=>g.pointCoordinate(G,this.terrain)),A=this.getIds();let M=1/0,D=1/0,F=-1/0,Z=-1/0;for(const G of T)M=Math.min(M,G.x),D=Math.min(D,G.y),F=Math.max(F,G.x),Z=Math.max(Z,G.y);for(let G=0;G<A.length;G++){const Y=this._tiles[A[G]];if(Y.holdingForFade())continue;const $=Y.tileID,lt=Math.pow(2,g.zoom-Y.tileID.overscaledZ),yt=a*Y.queryPadding*l.N/Y.tileSize/lt,Q=[$.getTilePoint(new l.U(M,D)),$.getTilePoint(new l.U(F,Z))];if(Q[0].x-yt<l.N&&Q[0].y-yt<l.N&&Q[1].x+yt>=0&&Q[1].y+yt>=0){const ut=w.map(St=>$.getTilePoint(St)),xt=T.map(St=>$.getTilePoint(St));p.push({tile:Y,tileID:$,queryGeometry:ut,cameraQueryGeometry:xt,scale:lt})}}return p}getVisibleCoordinates(i){const a=this.getRenderableIds(i).map(h=>this._tiles[h].tileID);for(const h of a)h.posMatrix=this.transform.calculatePosMatrix(h.toUnwrapped());return a}hasTransition(){if(this._source.hasTransition())return!0;if(Ei(this._source.type)){const i=l.h.now();for(const a in this._tiles)if(this._tiles[a].fadeEndTime>=i)return!0}return!1}setFeatureState(i,a,h){this._state.updateState(i=i||"_geojsonTileLayer",a,h)}removeFeatureState(i,a,h){this._state.removeFeatureState(i=i||"_geojsonTileLayer",a,h)}getFeatureState(i,a){return this._state.getState(i=i||"_geojsonTileLayer",a)}setDependencies(i,a,h){const p=this._tiles[i];p&&p.setDependencies(a,h)}reloadTilesForDependencies(i,a){for(const h in this._tiles)this._tiles[h].hasDependency(i,a)&&this._reloadTile(h,"reloading");this._cache.filter(h=>!h.hasDependency(i,a))}}function dn(f,i){const a=Math.abs(2*f.wrap)-+(f.wrap<0),h=Math.abs(2*i.wrap)-+(i.wrap<0);return f.overscaledZ-i.overscaledZ||h-a||i.canonical.y-f.canonical.y||i.canonical.x-f.canonical.x}function Ei(f){return f==="raster"||f==="image"||f==="video"}Ar.maxOverzooming=10,Ar.maxUnderzooming=3;const gi="mapboxgl_preloaded_worker_pool";class nn{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<nn.workerCount;)this.workers.push(new Worker(l.c.WORKER_URL));return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[gi]}numActive(){return Object.keys(this.active).length}}const Fs=Math.floor(l.h.hardwareConcurrency/2);let Zr;function Za(){return Zr||(Zr=new nn),Zr}nn.workerCount=l.ac(globalThis)?Math.max(Math.min(Fs,3),1):1;class ro{constructor(i,a){this.reset(i,a)}reset(i,a){this.points=i||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=l.ad(i,0,1);let a=1,h=this._distances[a];const p=i*this.paddedLength+this.padding;for(;h<p&&a<this._distances.length;)h=this._distances[++a];const g=a-1,x=this._distances[g],w=h-x,T=w>0?(p-x)/w:0;return this.points[g].mult(1-T).add(this.points[a].mult(T))}}function no(f,i){let a=!0;return f==="always"||f!=="never"&&i!=="never"||(a=!1),a}class Mo{constructor(i,a,h){const p=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(i/h),this.yCellCount=Math.ceil(a/h);for(let x=0;x<this.xCellCount*this.yCellCount;x++)p.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=a,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,a,h,p,g){this._forEachCell(a,h,p,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(g)}insertCircle(i,a,h,p){this._forEachCell(a-p,h-p,a+p,h+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(a),this.circles.push(h),this.circles.push(p)}_insertBoxCell(i,a,h,p,g,x){this.boxCells[g].push(x)}_insertCircleCell(i,a,h,p,g,x){this.circleCells[g].push(x)}_query(i,a,h,p,g,x,w){if(h<0||i>this.width||p<0||a>this.height)return[];const T=[];if(i<=0&&a<=0&&this.width<=h&&this.height<=p){if(g)return[{key:null,x1:i,y1:a,x2:h,y2:p}];for(let A=0;A<this.boxKeys.length;A++)T.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const M=this.circles[3*A],D=this.circles[3*A+1],F=this.circles[3*A+2];T.push({key:this.circleKeys[A],x1:M-F,y1:D-F,x2:M+F,y2:D+F})}}else this._forEachCell(i,a,h,p,this._queryCell,T,{hitTest:g,overlapMode:x,seenUids:{box:{},circle:{}}},w);return T}query(i,a,h,p){return this._query(i,a,h,p,!1,null)}hitTest(i,a,h,p,g,x){return this._query(i,a,h,p,!0,g,x).length>0}hitTestCircle(i,a,h,p,g){const x=i-h,w=i+h,T=a-h,A=a+h;if(w<0||x>this.width||A<0||T>this.height)return!1;const M=[];return this._forEachCell(x,T,w,A,this._queryCellCircle,M,{hitTest:!0,overlapMode:p,circle:{x:i,y:a,radius:h},seenUids:{box:{},circle:{}}},g),M.length>0}_queryCell(i,a,h,p,g,x,w,T){const{seenUids:A,hitTest:M,overlapMode:D}=w,F=this.boxCells[g];if(F!==null){const G=this.bboxes;for(const Y of F)if(!A.box[Y]){A.box[Y]=!0;const $=4*Y,lt=this.boxKeys[Y];if(i<=G[$+2]&&a<=G[$+3]&&h>=G[$+0]&&p>=G[$+1]&&(!T||T(lt))&&(!M||!no(D,lt.overlapMode))&&(x.push({key:lt,x1:G[$],y1:G[$+1],x2:G[$+2],y2:G[$+3]}),M))return!0}}const Z=this.circleCells[g];if(Z!==null){const G=this.circles;for(const Y of Z)if(!A.circle[Y]){A.circle[Y]=!0;const $=3*Y,lt=this.circleKeys[Y];if(this._circleAndRectCollide(G[$],G[$+1],G[$+2],i,a,h,p)&&(!T||T(lt))&&(!M||!no(D,lt.overlapMode))){const yt=G[$],Q=G[$+1],ut=G[$+2];if(x.push({key:lt,x1:yt-ut,y1:Q-ut,x2:yt+ut,y2:Q+ut}),M)return!0}}}return!1}_queryCellCircle(i,a,h,p,g,x,w,T){const{circle:A,seenUids:M,overlapMode:D}=w,F=this.boxCells[g];if(F!==null){const G=this.bboxes;for(const Y of F)if(!M.box[Y]){M.box[Y]=!0;const $=4*Y,lt=this.boxKeys[Y];if(this._circleAndRectCollide(A.x,A.y,A.radius,G[$+0],G[$+1],G[$+2],G[$+3])&&(!T||T(lt))&&!no(D,lt.overlapMode))return x.push(!0),!0}}const Z=this.circleCells[g];if(Z!==null){const G=this.circles;for(const Y of Z)if(!M.circle[Y]){M.circle[Y]=!0;const $=3*Y,lt=this.circleKeys[Y];if(this._circlesCollide(G[$],G[$+1],G[$+2],A.x,A.y,A.radius)&&(!T||T(lt))&&!no(D,lt.overlapMode))return x.push(!0),!0}}}_forEachCell(i,a,h,p,g,x,w,T){const A=this._convertToXCellCoord(i),M=this._convertToYCellCoord(a),D=this._convertToXCellCoord(h),F=this._convertToYCellCoord(p);for(let Z=A;Z<=D;Z++)for(let G=M;G<=F;G++)if(g.call(this,i,a,h,p,this.xCellCount*G+Z,x,w,T))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,a,h,p,g,x){const w=p-i,T=g-a,A=h+x;return A*A>w*w+T*T}_circleAndRectCollide(i,a,h,p,g,x,w){const T=(x-p)/2,A=Math.abs(i-(p+T));if(A>T+h)return!1;const M=(w-g)/2,D=Math.abs(a-(g+M));if(D>M+h)return!1;if(A<=T||D<=M)return!0;const F=A-T,Z=D-M;return F*F+Z*Z<=h*h}}function Gt(f,i,a,h,p){const g=l.Z();return i?(l.a0(g,g,[1/p,1/p,1]),a||l.ae(g,g,h.angle)):l.a1(g,h.labelPlaneMatrix,f),g}function vs(f,i,a,h,p){if(i){const g=l.af(f);return l.a0(g,g,[p,p,1]),a||l.ae(g,g,-h.angle),g}return h.glCoordMatrix}function cr(f,i,a){let h;a?(h=[f.x,f.y,a(f.x,f.y),1],l.ag(h,h,i)):(h=[f.x,f.y,0,1],K(h,h,i));const p=h[3];return{point:new l.P(h[0]/p,h[1]/p),signedDistanceFromCamera:p}}function Do(f,i){return .5+f/i*.5}function Os(f,i){const a=f[0]/f[3],h=f[1]/f[3];return a>=-i[0]&&a<=i[0]&&h>=-i[1]&&h<=i[1]}function Wt(f,i,a,h,p,g,x,w,T,A){const M=h?f.textSizeData:f.iconSizeData,D=l.ah(M,a.transform.zoom),F=[256/a.width*2+1,256/a.height*2+1],Z=h?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;Z.clear();const G=f.lineVertexArray,Y=h?f.text.placedSymbolArray:f.icon.placedSymbolArray,$=a.transform.width/a.transform.height;let lt=!1;for(let yt=0;yt<Y.length;yt++){const Q=Y.get(yt);if(Q.hidden||Q.writingMode===l.ai.vertical&&!lt){V(Q.numGlyphs,Z);continue}let ut;if(lt=!1,A?(ut=[Q.anchorX,Q.anchorY,A(Q.anchorX,Q.anchorY),1],l.ag(ut,ut,i)):(ut=[Q.anchorX,Q.anchorY,0,1],K(ut,ut,i)),!Os(ut,F)){V(Q.numGlyphs,Z);continue}const xt=Do(a.transform.cameraToCenterDistance,ut[3]),St=l.aj(M,D,Q),Mt=x?St/xt:St*xt,Ft=new l.P(Q.anchorX,Q.anchorY),zt=cr(Ft,p,A).point,$t={projections:{},offsets:{}},pe=pn(Q,Mt,!1,w,i,p,g,f.glyphOffsetArray,G,Z,zt,Ft,$t,$,T,A);lt=pe.useVertical,(pe.notEnoughRoom||lt||pe.needsFlipping&&pn(Q,Mt,!0,w,i,p,g,f.glyphOffsetArray,G,Z,zt,Ft,$t,$,T,A).notEnoughRoom)&&V(Q.numGlyphs,Z)}h?f.text.dynamicLayoutVertexBuffer.updateData(Z):f.icon.dynamicLayoutVertexBuffer.updateData(Z)}function Je(f,i,a,h,p,g,x,w,T,A,M,D,F){const Z=w.glyphStartIndex+w.numGlyphs,G=w.lineStartIndex,Y=w.lineStartIndex+w.lineLength,$=i.getoffsetX(w.glyphStartIndex),lt=i.getoffsetX(Z-1),yt=z(f*$,a,h,p,g,x,w.segment,G,Y,T,A,M,D,F);if(!yt)return null;const Q=z(f*lt,a,h,p,g,x,w.segment,G,Y,T,A,M,D,F);return Q?{first:yt,last:Q}:null}function Re(f,i,a,h){return f===l.ai.horizontal&&Math.abs(a.y-i.y)>Math.abs(a.x-i.x)*h?{useVertical:!0}:(f===l.ai.vertical?i.y<a.y:i.x>a.x)?{needsFlipping:!0}:null}function pn(f,i,a,h,p,g,x,w,T,A,M,D,F,Z,G,Y){const $=i/24,lt=f.lineOffsetX*$,yt=f.lineOffsetY*$;let Q;if(f.numGlyphs>1){const ut=f.glyphStartIndex+f.numGlyphs,xt=f.lineStartIndex,St=f.lineStartIndex+f.lineLength,Mt=Je($,w,lt,yt,a,M,D,f,T,g,F,G,Y);if(!Mt)return{notEnoughRoom:!0};const Ft=cr(Mt.first.point,x,Y).point,zt=cr(Mt.last.point,x,Y).point;if(h&&!a){const $t=Re(f.writingMode,Ft,zt,Z);if($t)return $t}Q=[Mt.first];for(let $t=f.glyphStartIndex+1;$t<ut-1;$t++)Q.push(z($*w.getoffsetX($t),lt,yt,a,M,D,f.segment,xt,St,T,g,F,G,Y));Q.push(Mt.last)}else{if(h&&!a){const xt=cr(D,p,Y).point,St=f.lineStartIndex+f.segment+1,Mt=new l.P(T.getx(St),T.gety(St)),Ft=cr(Mt,p,Y),zt=Ft.signedDistanceFromCamera>0?Ft.point:bs(D,Mt,xt,1,p,Y),$t=Re(f.writingMode,xt,zt,Z);if($t)return $t}const ut=z($*w.getoffsetX(f.glyphStartIndex),lt,yt,a,M,D,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,T,g,F,G,Y);if(!ut)return{notEnoughRoom:!0};Q=[ut]}for(const ut of Q)l.ak(A,ut.point,ut.angle);return{}}function bs(f,i,a,h,p,g){const x=cr(f.add(f.sub(i)._unit()),p,g).point,w=a.sub(x);return a.add(w._mult(h/w.mag()))}function He(f,i){const{projectionCache:a,lineVertexArray:h,labelPlaneMatrix:p,tileAnchorPoint:g,distanceFromAnchor:x,getElevation:w,previousVertex:T,direction:A,absOffsetX:M}=i;if(a.projections[f])return a.projections[f];const D=new l.P(h.getx(f),h.gety(f)),F=cr(D,p,w);if(F.signedDistanceFromCamera>0)return a.projections[f]=F.point,F.point;const Z=f-A;return bs(x===0?g:new l.P(h.getx(Z),h.gety(Z)),D,T,M-x+1,p,w)}function Ns(f,i,a){return f._unit()._perp()._mult(i*a)}function H(f,i,a,h,p,g,x,w){const{projectionCache:T,direction:A}=w;if(T.offsets[f])return T.offsets[f];const M=a.add(i);if(f+A<h||f+A>=p)return T.offsets[f]=M,M;const D=He(f+A,w),F=Ns(D.sub(a),x,A),Z=a.add(F),G=D.add(F);return T.offsets[f]=l.al(g,M,Z,G)||M,T.offsets[f]}function z(f,i,a,h,p,g,x,w,T,A,M,D,F,Z){const G=h?f-i:f+i;let Y=G>0?1:-1,$=0;h&&(Y*=-1,$=Math.PI),Y<0&&($+=Math.PI);let lt,yt,Q=Y>0?w+x:w+x+1,ut=p,xt=p,St=0,Mt=0;const Ft=Math.abs(G),zt=[];let $t;for(;St+Mt<=Ft;){if(Q+=Y,Q<w||Q>=T)return null;St+=Mt,xt=ut,yt=lt;const Yt={projectionCache:D,lineVertexArray:A,labelPlaneMatrix:M,tileAnchorPoint:g,distanceFromAnchor:St,getElevation:Z,previousVertex:xt,direction:Y,absOffsetX:Ft};if(ut=He(Q,Yt),a===0)zt.push(xt),$t=ut.sub(xt);else{let Ee;const ge=ut.sub(xt);Ee=ge.mag()===0?Ns(He(Q+Y,Yt).sub(ut),a,Y):Ns(ge,a,Y),yt||(yt=xt.add(Ee)),lt=H(Q,Ee,ut,w,T,yt,a,Yt),zt.push(yt),$t=lt.sub(yt)}Mt=$t.mag()}const pe=$t._mult((Ft-St)/Mt)._add(yt||xt),ri=$+Math.atan2(ut.y-xt.y,ut.x-xt.x);return zt.push(pe),{point:pe,angle:F?ri:0,path:zt}}const R=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function V(f,i){for(let a=0;a<f;a++){const h=i.length;i.resize(h+4),i.float32.set(R,3*h)}}function K(f,i,a){const h=i[0],p=i[1];return f[0]=a[0]*h+a[4]*p+a[12],f[1]=a[1]*h+a[5]*p+a[13],f[3]=a[3]*h+a[7]*p+a[15],f}const J=100;class ft{constructor(i,a=new Mo(i.width+200,i.height+200,25),h=new Mo(i.width+200,i.height+200,25)){this.transform=i,this.grid=a,this.ignoredGrid=h,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+J,this.screenBottomBoundary=i.height+J,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(i,a,h,p,g,x){const w=this.projectAndGetPerspectiveRatio(p,i.anchorPointX,i.anchorPointY,x),T=h*w.perspectiveRatio,A=i.x1*T+w.point.x,M=i.y1*T+w.point.y,D=i.x2*T+w.point.x,F=i.y2*T+w.point.y;return!this.isInsideGrid(A,M,D,F)||a!=="always"&&this.grid.hitTest(A,M,D,F,a,g)||w.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[A,M,D,F],offscreen:this.isOffscreen(A,M,D,F)}}placeCollisionCircles(i,a,h,p,g,x,w,T,A,M,D,F,Z,G){const Y=[],$=new l.P(a.anchorX,a.anchorY),lt=cr($,x,G),yt=Do(this.transform.cameraToCenterDistance,lt.signedDistanceFromCamera),Q=(M?g/yt:g*yt)/l.ap,ut=cr($,w,G).point,xt=Je(Q,p,a.lineOffsetX*Q,a.lineOffsetY*Q,!1,ut,$,a,h,w,{projections:{},offsets:{}},!1,G);let St=!1,Mt=!1,Ft=!0;if(xt){const zt=.5*F*yt+Z,$t=new l.P(-100,-100),pe=new l.P(this.screenRightBoundary,this.screenBottomBoundary),ri=new ro,Yt=xt.first,Ee=xt.last;let ge=[];for(let Ye=Yt.path.length-1;Ye>=1;Ye--)ge.push(Yt.path[Ye]);for(let Ye=1;Ye<Ee.path.length;Ye++)ge.push(Ee.path[Ye]);const Pi=2.5*zt;if(T){const Ye=ge.map(ni=>cr(ni,T,G));ge=Ye.some(ni=>ni.signedDistanceFromCamera<=0)?[]:Ye.map(ni=>ni.point)}let ii=[];if(ge.length>0){const Ye=ge[0].clone(),ni=ge[0].clone();for(let _r=1;_r<ge.length;_r++)Ye.x=Math.min(Ye.x,ge[_r].x),Ye.y=Math.min(Ye.y,ge[_r].y),ni.x=Math.max(ni.x,ge[_r].x),ni.y=Math.max(ni.y,ge[_r].y);ii=Ye.x>=$t.x&&ni.x<=pe.x&&Ye.y>=$t.y&&ni.y<=pe.y?[ge]:ni.x<$t.x||Ye.x>pe.x||ni.y<$t.y||Ye.y>pe.y?[]:l.am([ge],$t.x,$t.y,pe.x,pe.y)}for(const Ye of ii){ri.reset(Ye,.25*zt);let ni=0;ni=ri.length<=.5*zt?1:Math.ceil(ri.paddedLength/Pi)+1;for(let _r=0;_r<ni;_r++){const ji=_r/Math.max(ni-1,1),Yr=ri.lerp(ji),Lr=Yr.x+J,wr=Yr.y+J;Y.push(Lr,wr,zt,0);const Un=Lr-zt,Hi=wr-zt,ws=Lr+zt,Ss=wr+zt;if(Ft=Ft&&this.isOffscreen(Un,Hi,ws,Ss),Mt=Mt||this.isInsideGrid(Un,Hi,ws,Ss),i!=="always"&&this.grid.hitTestCircle(Lr,wr,zt,i,D)&&(St=!0,!A))return{circles:[],offscreen:!1,collisionDetected:St}}}}return{circles:!A&&St||!Mt||yt<this.perspectiveRatioCutoff?[]:Y,offscreen:Ft,collisionDetected:St}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let h=1/0,p=1/0,g=-1/0,x=-1/0;for(const M of i){const D=new l.P(M.x+J,M.y+J);h=Math.min(h,D.x),p=Math.min(p,D.y),g=Math.max(g,D.x),x=Math.max(x,D.y),a.push(D)}const w=this.grid.query(h,p,g,x).concat(this.ignoredGrid.query(h,p,g,x)),T={},A={};for(const M of w){const D=M.key;if(T[D.bucketInstanceId]===void 0&&(T[D.bucketInstanceId]={}),T[D.bucketInstanceId][D.featureIndex])continue;const F=[new l.P(M.x1,M.y1),new l.P(M.x2,M.y1),new l.P(M.x2,M.y2),new l.P(M.x1,M.y2)];l.an(a,F)&&(T[D.bucketInstanceId][D.featureIndex]=!0,A[D.bucketInstanceId]===void 0&&(A[D.bucketInstanceId]=[]),A[D.bucketInstanceId].push(D.featureIndex))}return A}insertCollisionBox(i,a,h,p,g,x){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:g,collisionGroupID:x,overlapMode:a},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,a,h,p,g,x){const w=h?this.ignoredGrid:this.grid,T={bucketInstanceId:p,featureIndex:g,collisionGroupID:x,overlapMode:a};for(let A=0;A<i.length;A+=4)w.insertCircle(T,i[A],i[A+1],i[A+2])}projectAndGetPerspectiveRatio(i,a,h,p){let g;return p?(g=[a,h,p(a,h),1],l.ag(g,g,i)):(g=[a,h,0,1],K(g,g,i)),{point:new l.P((g[0]/g[3]+1)/2*this.transform.width+J,(-g[1]/g[3]+1)/2*this.transform.height+J),perspectiveRatio:.5+this.transform.cameraToCenterDistance/g[3]*.5}}isOffscreen(i,a,h,p){return h<J||i>=this.screenRightBoundary||p<J||a>this.screenBottomBoundary}isInsideGrid(i,a,h,p){return h>=0&&i<this.gridRightBoundary&&p>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const i=l.ao([]);return l.$(i,i,[-100,-100,0]),i}}function at(f,i,a){return i*(l.N/(f.tileSize*Math.pow(2,a-f.tileID.overscaledZ)))}class rt{constructor(i,a,h,p){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?a:-a))):p&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class ht{constructor(i,a,h,p,g){this.text=new rt(i?i.text:null,a,h,g),this.icon=new rt(i?i.icon:null,a,p,g)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class At{constructor(i,a,h){this.text=i,this.icon=a,this.skipFade=h}}class Ct{constructor(){this.invProjMatrix=l.Z(),this.viewportMatrix=l.Z(),this.circles=[]}}class Pt{constructor(i,a,h,p,g){this.bucketInstanceId=i,this.featureIndex=a,this.sourceLayerIndex=h,this.bucketIndex=p,this.tileID=g}}class Se{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const a=++this.maxGroupID;this.collisionGroups[i]={ID:a,predicate:h=>h.collisionGroupID===a}}return this.collisionGroups[i]}}function Le(f,i,a,h,p){const{horizontalAlign:g,verticalAlign:x}=l.au(f);return new l.P(-(g-.5)*i+h[0]*p,-(x-.5)*a+h[1]*p)}function de(f,i,a,h,p,g){const{x1:x,x2:w,y1:T,y2:A,anchorPointX:M,anchorPointY:D}=f,F=new l.P(i,a);return h&&F._rotate(p?g:-g),{x1:x+F.x,y1:T+F.y,x2:w+F.x,y2:A+F.y,anchorPointX:M,anchorPointY:D}}class Te{constructor(i,a,h,p,g){this.transform=i.clone(),this.terrain=a,this.collisionIndex=new ft(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new Se(p),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,a,h,p){const g=h.getBucket(a),x=h.latestFeatureIndex;if(!g||!x||a.id!==g.layerIds[0])return;const w=h.collisionBoxArray,T=g.layers[0].layout,A=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),M=h.tileSize/l.N,D=this.transform.calculatePosMatrix(h.tileID.toUnwrapped()),F=T.get("text-pitch-alignment")==="map",Z=T.get("text-rotation-alignment")==="map",G=at(h,1,this.transform.zoom),Y=Gt(D,F,Z,this.transform,G);let $=null;if(F){const yt=vs(D,F,Z,this.transform,G);$=l.a1([],this.transform.labelPlaneMatrix,yt)}this.retainedQueryData[g.bucketInstanceId]=new Pt(g.bucketInstanceId,x,g.sourceLayerIndex,g.index,h.tileID);const lt={bucket:g,layout:T,posMatrix:D,textLabelPlaneMatrix:Y,labelToScreenMatrix:$,scale:A,textPixelRatio:M,holdingForFade:h.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:l.ah(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(p)for(const yt of g.sortKeyRanges){const{sortKey:Q,symbolInstanceStart:ut,symbolInstanceEnd:xt}=yt;i.push({sortKey:Q,symbolInstanceStart:ut,symbolInstanceEnd:xt,parameters:lt})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:lt})}attemptAnchorPlacement(i,a,h,p,g,x,w,T,A,M,D,F,Z,G,Y,$){const lt=l.aq[i.textAnchor],yt=[i.textOffset0,i.textOffset1],Q=Le(lt,h,p,yt,g),ut=this.collisionIndex.placeCollisionBox(de(a,Q.x,Q.y,x,w,this.transform.angle),D,T,A,M.predicate,$);if((!Y||this.collisionIndex.placeCollisionBox(de(Y,Q.x,Q.y,x,w,this.transform.angle),D,T,A,M.predicate,$).box.length!==0)&&ut.box.length>0){let xt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID].text&&(xt=this.prevPlacement.variableOffsets[F.crossTileID].anchor),F.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[F.crossTileID]={textOffset:yt,width:h,height:p,anchor:lt,textBoxScale:g,prevAnchor:xt},this.markUsedJustification(Z,lt,F,G),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,G,F),this.placedOrientations[F.crossTileID]=G),{shift:Q,placedGlyphBoxes:ut}}}placeLayerBucketPart(i,a,h){const{bucket:p,layout:g,posMatrix:x,textLabelPlaneMatrix:w,labelToScreenMatrix:T,textPixelRatio:A,holdingForFade:M,collisionBoxArray:D,partiallyEvaluatedTextSize:F,collisionGroup:Z}=i.parameters,G=g.get("text-optional"),Y=g.get("icon-optional"),$=l.ar(g,"text-overlap","text-allow-overlap"),lt=$==="always",yt=l.ar(g,"icon-overlap","icon-allow-overlap"),Q=yt==="always",ut=g.get("text-rotation-alignment")==="map",xt=g.get("text-pitch-alignment")==="map",St=g.get("icon-text-fit")!=="none",Mt=g.get("symbol-z-order")==="viewport-y",Ft=lt&&(Q||!p.hasIconData()||Y),zt=Q&&(lt||!p.hasTextData()||G);!p.collisionArrays&&D&&p.deserializeCollisionBoxes(D);const $t=this.retainedQueryData[p.bucketInstanceId].tileID,pe=this.terrain?(Yt,Ee)=>this.terrain.getElevation($t,Yt,Ee):null,ri=(Yt,Ee)=>{var ge,Pi;if(a[Yt.crossTileID])return;if(M)return void(this.placements[Yt.crossTileID]=new At(!1,!1,!1));let ii=!1,Ye=!1,ni=!0,_r=null,ji={box:null,offscreen:null},Yr={box:null,offscreen:null},Lr=null,wr=null,Un=null,Hi=0,ws=0,Ss=0;Ee.textFeatureIndex?Hi=Ee.textFeatureIndex:Yt.useRuntimeCollisionCircles&&(Hi=Yt.featureIndex),Ee.verticalTextFeatureIndex&&(ws=Ee.verticalTextFeatureIndex);const ho=Ee.textBox;if(ho){const an=vr=>{let zr=l.ai.horizontal;if(p.allowVerticalPlacement&&!vr&&this.prevPlacement){const kn=this.prevPlacement.placedOrientations[Yt.crossTileID];kn&&(this.placedOrientations[Yt.crossTileID]=kn,zr=kn,this.markUsedOrientation(p,zr,Yt))}return zr},Kr=(vr,zr)=>{if(p.allowVerticalPlacement&&Yt.numVerticalGlyphVertices>0&&Ee.verticalTextBox){for(const kn of p.writingModes)if(kn===l.ai.vertical?(ji=zr(),Yr=ji):ji=vr(),ji&&ji.box&&ji.box.length)break}else ji=vr()},mn=Yt.textAnchorOffsetStartIndex,Vo=Yt.textAnchorOffsetEndIndex;if(Vo===mn){const vr=(zr,kn)=>{const br=this.collisionIndex.placeCollisionBox(zr,$,A,x,Z.predicate,pe);return br&&br.box&&br.box.length&&(this.markUsedOrientation(p,kn,Yt),this.placedOrientations[Yt.crossTileID]=kn),br};Kr(()=>vr(ho,l.ai.horizontal),()=>{const zr=Ee.verticalTextBox;return p.allowVerticalPlacement&&Yt.numVerticalGlyphVertices>0&&zr?vr(zr,l.ai.vertical):{box:null,offscreen:null}}),an(ji&&ji.box&&ji.box.length)}else{let vr=l.aq[(Pi=(ge=this.prevPlacement)===null||ge===void 0?void 0:ge.variableOffsets[Yt.crossTileID])===null||Pi===void 0?void 0:Pi.anchor];const zr=(br,$o,ic)=>{const bd=br.x2-br.x1,xd=br.y2-br.y1,Mf=Yt.textBoxScale,Ru=St&&yt==="never"?$o:null;let Is={box:[],offscreen:!1},jo=$==="never"?1:2,Ts="never";vr&&jo++;for(let is=0;is<jo;is++){for(let ks=mn;ks<Vo;ks++){const Fu=p.textAnchorOffsets.get(ks);if(vr&&Fu.textAnchor!==vr)continue;const Gs=this.attemptAnchorPlacement(Fu,br,bd,xd,Mf,ut,xt,A,x,Z,Ts,Yt,p,ic,Ru,pe);if(Gs&&(Is=Gs.placedGlyphBoxes,Is&&Is.box&&Is.box.length))return ii=!0,_r=Gs.shift,Is}vr?vr=null:Ts=$}return Is};Kr(()=>zr(ho,Ee.iconBox,l.ai.horizontal),()=>{const br=Ee.verticalTextBox;return p.allowVerticalPlacement&&!(ji&&ji.box&&ji.box.length)&&Yt.numVerticalGlyphVertices>0&&br?zr(br,Ee.verticalIconBox,l.ai.vertical):{box:null,offscreen:null}}),ji&&(ii=ji.box,ni=ji.offscreen);const kn=an(ji&&ji.box);if(!ii&&this.prevPlacement){const br=this.prevPlacement.variableOffsets[Yt.crossTileID];br&&(this.variableOffsets[Yt.crossTileID]=br,this.markUsedJustification(p,br.anchor,Yt,kn))}}}if(Lr=ji,ii=Lr&&Lr.box&&Lr.box.length>0,ni=Lr&&Lr.offscreen,Yt.useRuntimeCollisionCircles){const an=p.text.placedSymbolArray.get(Yt.centerJustifiedTextSymbolIndex),Kr=l.aj(p.textSizeData,F,an),mn=g.get("text-padding");wr=this.collisionIndex.placeCollisionCircles($,an,p.lineVertexArray,p.glyphOffsetArray,Kr,x,w,T,h,xt,Z.predicate,Yt.collisionCircleDiameter,mn,pe),wr.circles.length&&wr.collisionDetected&&!h&&l.w("Collisions detected, but collision boxes are not shown"),ii=lt||wr.circles.length>0&&!wr.collisionDetected,ni=ni&&wr.offscreen}if(Ee.iconFeatureIndex&&(Ss=Ee.iconFeatureIndex),Ee.iconBox){const an=Kr=>{const mn=St&&_r?de(Kr,_r.x,_r.y,ut,xt,this.transform.angle):Kr;return this.collisionIndex.placeCollisionBox(mn,yt,A,x,Z.predicate,pe)};Yr&&Yr.box&&Yr.box.length&&Ee.verticalIconBox?(Un=an(Ee.verticalIconBox),Ye=Un.box.length>0):(Un=an(Ee.iconBox),Ye=Un.box.length>0),ni=ni&&Un.offscreen}const Uo=G||Yt.numHorizontalGlyphVertices===0&&Yt.numVerticalGlyphVertices===0,ba=Y||Yt.numIconVertices===0;if(Uo||ba?ba?Uo||(Ye=Ye&&ii):ii=Ye&&ii:Ye=ii=Ye&&ii,ii&&Lr&&Lr.box&&this.collisionIndex.insertCollisionBox(Lr.box,$,g.get("text-ignore-placement"),p.bucketInstanceId,Yr&&Yr.box&&ws?ws:Hi,Z.ID),Ye&&Un&&this.collisionIndex.insertCollisionBox(Un.box,yt,g.get("icon-ignore-placement"),p.bucketInstanceId,Ss,Z.ID),wr&&(ii&&this.collisionIndex.insertCollisionCircles(wr.circles,$,g.get("text-ignore-placement"),p.bucketInstanceId,Hi,Z.ID),h)){const an=p.bucketInstanceId;let Kr=this.collisionCircleArrays[an];Kr===void 0&&(Kr=this.collisionCircleArrays[an]=new Ct);for(let mn=0;mn<wr.circles.length;mn+=4)Kr.circles.push(wr.circles[mn+0]),Kr.circles.push(wr.circles[mn+1]),Kr.circles.push(wr.circles[mn+2]),Kr.circles.push(wr.collisionDetected?1:0)}if(Yt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(p.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Yt.crossTileID]=new At(ii||Ft,Ye||zt,ni||p.justReloaded),a[Yt.crossTileID]=!0};if(Mt){if(i.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Yt=p.getSortedSymbolIndexes(this.transform.angle);for(let Ee=Yt.length-1;Ee>=0;--Ee){const ge=Yt[Ee];ri(p.symbolInstances.get(ge),p.collisionArrays[ge])}}else for(let Yt=i.symbolInstanceStart;Yt<i.symbolInstanceEnd;Yt++)ri(p.symbolInstances.get(Yt),p.collisionArrays[Yt]);if(h&&p.bucketInstanceId in this.collisionCircleArrays){const Yt=this.collisionCircleArrays[p.bucketInstanceId];l.as(Yt.invProjMatrix,x),Yt.viewportMatrix=this.collisionIndex.getViewportMatrix()}p.justReloaded=!1}markUsedJustification(i,a,h,p){let g;g=p===l.ai.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[l.at(a)];const x=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];for(const w of x)w>=0&&(i.text.placedSymbolArray.get(w).crossTileID=g>=0&&w!==g?0:h.crossTileID)}markUsedOrientation(i,a,h){const p=a===l.ai.horizontal||a===l.ai.horizontalOnly?a:0,g=a===l.ai.vertical?a:0,x=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];for(const w of x)i.text.placedSymbolArray.get(w).placedOrientation=p;h.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=g)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let h=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const p=a?a.symbolFadeChange(i):1,g=a?a.opacities:{},x=a?a.variableOffsets:{},w=a?a.placedOrientations:{};for(const T in this.placements){const A=this.placements[T],M=g[T];M?(this.opacities[T]=new ht(M,p,A.text,A.icon),h=h||A.text!==M.text.placed||A.icon!==M.icon.placed):(this.opacities[T]=new ht(null,p,A.text,A.icon,A.skipFade),h=h||A.text||A.icon)}for(const T in g){const A=g[T];if(!this.opacities[T]){const M=new ht(A,p,!1,!1);M.isHidden()||(this.opacities[T]=M,h=h||A.text.placed||A.icon.placed)}}for(const T in x)this.variableOffsets[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.variableOffsets[T]=x[T]);for(const T in w)this.placedOrientations[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.placedOrientations[T]=w[T]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");h?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:i)}updateLayerOpacities(i,a){const h={};for(const p of a){const g=p.getBucket(i);g&&p.latestFeatureIndex&&i.id===g.layerIds[0]&&this.updateBucketOpacities(g,h,p.collisionBoxArray)}}updateBucketOpacities(i,a,h){i.hasTextData()&&(i.text.opacityVertexArray.clear(),i.text.hasVisibleVertices=!1),i.hasIconData()&&(i.icon.opacityVertexArray.clear(),i.icon.hasVisibleVertices=!1),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const p=i.layers[0],g=p.layout,x=new ht(null,0,!1,!1,!0),w=g.get("text-allow-overlap"),T=g.get("icon-allow-overlap"),A=p._unevaluatedLayout.hasValue("text-variable-anchor")||p._unevaluatedLayout.hasValue("text-variable-anchor-offset"),M=g.get("text-rotation-alignment")==="map",D=g.get("text-pitch-alignment")==="map",F=g.get("icon-text-fit")!=="none",Z=new ht(null,0,w&&(T||!i.hasIconData()||g.get("icon-optional")),T&&(w||!i.hasTextData()||g.get("text-optional")),!0);!i.collisionArrays&&h&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(h);const G=(Y,$,lt)=>{for(let yt=0;yt<$/4;yt++)Y.opacityVertexArray.emplaceBack(lt);Y.hasVisibleVertices=Y.hasVisibleVertices||lt!==Kn};for(let Y=0;Y<i.symbolInstances.length;Y++){const $=i.symbolInstances.get(Y),{numHorizontalGlyphVertices:lt,numVerticalGlyphVertices:yt,crossTileID:Q}=$;let ut=this.opacities[Q];a[Q]?ut=x:ut||(ut=Z,this.opacities[Q]=ut),a[Q]=!0;const xt=$.numIconVertices>0,St=this.placedOrientations[$.crossTileID],Mt=St===l.ai.vertical,Ft=St===l.ai.horizontal||St===l.ai.horizontalOnly;if(lt>0||yt>0){const zt=Wr(ut.text);G(i.text,lt,Mt?Kn:zt),G(i.text,yt,Ft?Kn:zt);const $t=ut.text.isHidden();[$.rightJustifiedTextSymbolIndex,$.centerJustifiedTextSymbolIndex,$.leftJustifiedTextSymbolIndex].forEach(Yt=>{Yt>=0&&(i.text.placedSymbolArray.get(Yt).hidden=$t||Mt?1:0)}),$.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get($.verticalPlacedTextSymbolIndex).hidden=$t||Ft?1:0);const pe=this.variableOffsets[$.crossTileID];pe&&this.markUsedJustification(i,pe.anchor,$,St);const ri=this.placedOrientations[$.crossTileID];ri&&(this.markUsedJustification(i,"left",$,ri),this.markUsedOrientation(i,ri,$))}if(xt){const zt=Wr(ut.icon),$t=!(F&&$.verticalPlacedIconSymbolIndex&&Mt);$.placedIconSymbolIndex>=0&&(G(i.icon,$.numIconVertices,$t?zt:Kn),i.icon.placedSymbolArray.get($.placedIconSymbolIndex).hidden=ut.icon.isHidden()),$.verticalPlacedIconSymbolIndex>=0&&(G(i.icon,$.numVerticalIconVertices,$t?Kn:zt),i.icon.placedSymbolArray.get($.verticalPlacedIconSymbolIndex).hidden=ut.icon.isHidden())}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const zt=i.collisionArrays[Y];if(zt){let $t=new l.P(0,0);if(zt.textBox||zt.verticalTextBox){let ri=!0;if(A){const Yt=this.variableOffsets[Q];Yt?($t=Le(Yt.anchor,Yt.width,Yt.height,Yt.textOffset,Yt.textBoxScale),M&&$t._rotate(D?this.transform.angle:-this.transform.angle)):ri=!1}zt.textBox&&Fe(i.textCollisionBox.collisionVertexArray,ut.text.placed,!ri||Mt,$t.x,$t.y),zt.verticalTextBox&&Fe(i.textCollisionBox.collisionVertexArray,ut.text.placed,!ri||Ft,$t.x,$t.y)}const pe=!!(!Ft&&zt.verticalIconBox);zt.iconBox&&Fe(i.iconCollisionBox.collisionVertexArray,ut.icon.placed,pe,F?$t.x:0,F?$t.y:0),zt.verticalIconBox&&Fe(i.iconCollisionBox.collisionVertexArray,ut.icon.placed,!pe,F?$t.x:0,F?$t.y:0)}}}if(i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.text.opacityVertexArray.length!==i.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${i.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${i.text.layoutVertexArray.length}) / 4`);if(i.icon.opacityVertexArray.length!==i.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${i.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${i.icon.layoutVertexArray.length}) / 4`);if(i.bucketInstanceId in this.collisionCircleArrays){const Y=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=Y.invProjMatrix,i.placementViewportMatrix=Y.viewportMatrix,i.collisionCircleArray=Y.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,a){const h=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*h>i}setStale(){this.stale=!0}}function Fe(f,i,a,h,p){f.emplaceBack(i?1:0,a?1:0,h||0,p||0),f.emplaceBack(i?1:0,a?1:0,h||0,p||0),f.emplaceBack(i?1:0,a?1:0,h||0,p||0),f.emplaceBack(i?1:0,a?1:0,h||0,p||0)}const ki=Math.pow(2,25),Bi=Math.pow(2,24),yi=Math.pow(2,17),pi=Math.pow(2,16),sn=Math.pow(2,9),$i=Math.pow(2,8),Er=Math.pow(2,1);function Wr(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const i=f.placed?1:0,a=Math.floor(127*f.opacity);return a*ki+i*Bi+a*yi+i*pi+a*sn+i*$i+a*Er+i}const Kn=0;class Rh{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&!i.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,a,h,p,g){const x=this._bucketParts;for(;this._currentTileIndex<i.length;)if(a.getBucketParts(x,p,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort((w,T)=>w.sortKey-T.sortKey));this._currentPartIndex<x.length;)if(a.placeLayerBucketPart(x[this._currentPartIndex],this._seenCrossTileIDs,h),this._currentPartIndex++,g())return!0;return!1}}class aa{constructor(i,a,h,p,g,x,w,T){this.placement=new Te(i,a,x,w,T),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(i,a,h){const p=l.h.now(),g=()=>!this._forceFullPlacement&&l.h.now()-p>2;for(;this._currentPlacementIndex>=0;){const x=a[i[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(x.type==="symbol"&&(!x.minzoom||x.minzoom<=w)&&(!x.maxzoom||x.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new Rh(x)),this._inProgressLayer.continuePlacement(h[x.source],this.placement,this._showCollisionBoxes,x,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const la=512/l.N/2;class pf{constructor(i,a,h){this.tileID=i,this.bucketInstanceId=h,this._symbolsByKey={};const p=new Map;for(let g=0;g<a.length;g++){const x=a.get(g),w=x.key,T=p.get(w);T?T.push(x):p.set(w,[x])}for(const[g,x]of p){const w={positions:x.map(T=>({x:Math.floor(T.anchorX*la),y:Math.floor(T.anchorY*la)})),crossTileIDs:x.map(T=>T.crossTileID)};if(w.positions.length>128){const T=new l.av(w.positions.length,16,Uint16Array);for(const{x:A,y:M}of w.positions)T.add(A,M);T.finish(),delete w.positions,w.index=T}this._symbolsByKey[g]=w}}getScaledCoordinates(i,a){const{x:h,y:p,z:g}=this.tileID.canonical,{x,y:w,z:T}=a.canonical,A=la/Math.pow(2,T-g),M=(w*l.N+i.anchorY)*A,D=p*l.N*la;return{x:Math.floor((x*l.N+i.anchorX)*A-h*l.N*la),y:Math.floor(M-D)}}findMatches(i,a,h){const p=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let g=0;g<i.length;g++){const x=i.get(g);if(x.crossTileID)continue;const w=this._symbolsByKey[x.key];if(!w)continue;const T=this.getScaledCoordinates(x,a);if(w.index){const A=w.index.range(T.x-p,T.y-p,T.x+p,T.y+p).sort();for(const M of A){const D=w.crossTileIDs[M];if(!h[D]){h[D]=!0,x.crossTileID=D;break}}}else if(w.positions)for(let A=0;A<w.positions.length;A++){const M=w.positions[A],D=w.crossTileIDs[A];if(Math.abs(M.x-T.x)<=p&&Math.abs(M.y-T.y)<=p&&!h[D]){h[D]=!0,x.crossTileID=D;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:i})=>i)}}class Di{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Yc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const a=Math.round((i-this.lng)/360);if(a!==0)for(const h in this.indexes){const p=this.indexes[h],g={};for(const x in p){const w=p[x];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+a),g[w.tileID.key]=w}this.indexes[h]=g}this.lng=i}addBucket(i,a,h){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let g=0;g<a.symbolInstances.length;g++)a.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const p=this.usedCrossTileIDs[i.overscaledZ];for(const g in this.indexes){const x=this.indexes[g];if(Number(g)>i.overscaledZ)for(const w in x){const T=x[w];T.tileID.isChildOf(i)&&T.findMatches(a.symbolInstances,i,p)}else{const w=x[i.scaledTo(Number(g)).key];w&&w.findMatches(a.symbolInstances,i,p)}}for(let g=0;g<a.symbolInstances.length;g++){const x=a.symbolInstances.get(g);x.crossTileID||(x.crossTileID=h.generate(),p[x.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new pf(i,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(i,a){for(const h of a.getCrossTileIDsLists())for(const p of h)delete this.usedCrossTileIDs[i][p]}removeStaleBuckets(i){let a=!1;for(const h in this.indexes){const p=this.indexes[h];for(const g in p)i[p[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,p[g]),delete p[g],a=!0)}return a}}class El{constructor(){this.layerIndexes={},this.crossTileIDs=new Di,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,a,h){let p=this.layerIndexes[i.id];p===void 0&&(p=this.layerIndexes[i.id]=new Yc);let g=!1;const x={};p.handleWrapJump(h);for(const w of a){const T=w.getBucket(i);T&&i.id===T.layerIds[0]&&(T.bucketInstanceId||(T.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(w.tileID,T,this.crossTileIDs)&&(g=!0),x[T.bucketInstanceId]=!0)}return p.removeStaleBuckets(x)&&(g=!0),g}pruneUnusedLayers(i){const a={};i.forEach(h=>{a[h]=!0});for(const h in this.layerIndexes)a[h]||delete this.layerIndexes[h]}}const on=(f,i)=>l.x(f,i&&i.filter(a=>a.identifier!=="source.canvas")),Bn=l.F(l.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),ff=l.F(l.ax,["setCenter","setZoom","setBearing","setPitch"]),Xn=l.aw();class Hr extends l.E{constructor(i,a={}){super(),this.map=i,this.dispatcher=new ti(Za(),this,i._getMapId()),this.imageManager=new jt,this.imageManager.setEventedParent(this),this.glyphManager=new ve(i._requestManager,a.localIdeographFontFamily),this.lineAtlas=new ci(256,512),this.crossTileSymbolIndex=new El,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.az());const h=this;this._rtlTextPluginCallback=Hr.registerForPluginStateChange(p=>{h.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:p.pluginStatus,pluginURL:p.pluginURL},(g,x)=>{if(l.aA(g),x&&x.every(w=>w))for(const w in h.sourceCaches){const T=h.sourceCaches[w].getSource().type;T!=="vector"&&T!=="geojson"||h.sourceCaches[w].reload()}})}),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const g=this.sourceCaches[p.sourceId];if(!g)return;const x=g.getSource();if(x&&x.vectorLayerIds)for(const w in this._layers){const T=this._layers[w];T.source===x.id&&this._validateLayer(T)}})}loadURL(i,a={},h){this.fire(new l.k("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;const p=this.map._requestManager.transformRequest(i,it.Style);this._request=l.f(p,(g,x)=>{this._request=null,g?this.fire(new l.j(g)):x&&this._load(x,a,h)})}loadJSON(i,a={},h){this.fire(new l.k("dataloading",{dataType:"style"})),this._request=l.h.frame(()=>{this._request=null,a.validate=a.validate!==!1,this._load(i,a,h)})}loadEmpty(){this.fire(new l.k("dataloading",{dataType:"style"})),this._load(Xn,{validate:!1})}_load(i,a,h){var p;const g=a.transformStyle?a.transformStyle(h,i):i;if(!a.validate||!on(this,l.y(g))){this._loaded=!0,this.stylesheet=g;for(const x in g.sources)this.addSource(x,g.sources[x],{validate:!1});g.sprite?this._loadSprite(g.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(g.glyphs),this._createLayers(),this.light=new ie(this.stylesheet.light),this.map.setTerrain((p=this.stylesheet.terrain)!==null&&p!==void 0?p:null),this.fire(new l.k("data",{dataType:"style"})),this.fire(new l.k("style.load"))}}_createLayers(){const i=l.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",i),this._order=i.map(a=>a.id),this._layers={},this._serializedLayers=null;for(const a of i){const h=l.aC(a);h.setEventedParent(this,{layer:{id:a.id}}),this._layers[a.id]=h}}_loadSprite(i,a=!1,h=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(p,g,x,w){const T=Rt(p),A=T.length,M=x>1?"@2x":"",D={},F={},Z={};for(const{id:G,url:Y}of T){const $=g.transformRequest(g.normalizeSpriteURL(Y,M,".json"),it.SpriteJSON),lt=`${G}_${$.url}`;D[lt]=l.f($,(ut,xt)=>{delete D[lt],F[G]=xt,Qt(w,F,Z,ut,A)});const yt=g.transformRequest(g.normalizeSpriteURL(Y,M,".png"),it.SpriteImage),Q=`${G}_${yt.url}`;D[Q]=nt.getImage(yt,(ut,xt)=>{delete D[Q],Z[G]=xt,Qt(w,F,Z,ut,A)})}return{cancel(){for(const G of Object.values(D))G.cancel()}}}(i,this.map._requestManager,this.map.getPixelRatio(),(p,g)=>{if(this._spriteRequest=null,p)this.fire(new l.j(p));else if(g)for(const x in g){this._spritesImagesIds[x]=[];const w=this._spritesImagesIds[x]?this._spritesImagesIds[x].filter(T=>!(T in g)):[];for(const T of w)this.imageManager.removeImage(T),this._changedImages[T]=!0;for(const T in g[x]){const A=x==="default"?T:`${x}:${T}`;this._spritesImagesIds[x].push(A),A in this.imageManager.images?this.imageManager.updateImage(A,g[x][T],!1):this.imageManager.addImage(A,g[x][T]),a&&(this._changedImages[A]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"})),h&&h(p)})}_unloadSprite(){for(const i of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(i),this._changedImages[i]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}_validateLayer(i){const a=this.sourceCaches[i.source];if(!a)return;const h=i.sourceLayer;if(!h)return;const p=a.getSource();(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(h)===-1)&&this.fire(new l.j(new Error(`Source layer "${h}" does not exist on source "${p.id}" as specified by style layer "${i.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this.sourceCaches)if(!this.sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(i){const a=this._serializedAllLayers();if(!i||i.length===0)return Object.values(a);const h=[];for(const p of i)a[p]&&h.push(a[p]);return h}_serializedAllLayers(){let i=this._serializedLayers;if(i)return i;i=this._serializedLayers={};const a=Object.keys(this._layers);for(const h of a){const p=this._layers[h];p.type!=="custom"&&(i[h]=p.serialize())}return i}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const i in this.sourceCaches)if(this.sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(i){if(!this._loaded)return;const a=this._changed;if(this._changed){const p=Object.keys(this._updatedLayers),g=Object.keys(this._removedLayers);(p.length||g.length)&&this._updateWorkerLayers(p,g);for(const x in this._updatedSources){const w=this._updatedSources[x];if(w==="reload")this._reloadSource(x);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(x)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const x in this._updatedPaintProps)this._layers[x].updateTransitions(i);this.light.updateTransitions(i),this._resetUpdates()}const h={};for(const p in this.sourceCaches){const g=this.sourceCaches[p];h[p]=g.used,g.used=!1}for(const p of this._order){const g=this._layers[p];g.recalculate(i,this._availableImages),!g.isHidden(i.zoom)&&g.source&&(this.sourceCaches[g.source].used=!0)}for(const p in h){const g=this.sourceCaches[p];h[p]!==g.used&&g.fire(new l.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:p}))}this.light.recalculate(i),this.z=i.zoom,a&&this.fire(new l.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const a in this.sourceCaches)this.sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const i in this.sourceCaches)this.sourceCaches[i].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(i,a){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(i),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(i,a={}){this._checkLoaded();const h=this.serialize();if(i=a.transformStyle?a.transformStyle(h,i):i,on(this,l.y(i)))return!1;(i=l.aD(i)).layers=l.aB(i.layers);const p=l.aE(h,i).filter(x=>!(x.command in ff));if(p.length===0)return!1;const g=p.filter(x=>!(x.command in Bn));if(g.length>0)throw new Error(`Unimplemented: ${g.map(x=>x.command).join(", ")}.`);for(const x of p)x.command!=="setTransition"&&this[x.command].apply(this,x.args);return this.stylesheet=i,this._serializedLayers=null,!0}addImage(i,a){if(this.getImage(i))return this.fire(new l.j(new Error(`An image named "${i}" already exists.`)));this.imageManager.addImage(i,a),this._afterImageUpdated(i)}updateImage(i,a){this.imageManager.updateImage(i,a)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){if(!this.getImage(i))return this.fire(new l.j(new Error(`An image named "${i}" does not exist.`)));this.imageManager.removeImage(i),this._afterImageUpdated(i)}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(i,a,h={}){if(this._checkLoaded(),this.sourceCaches[i]!==void 0)throw new Error(`Source "${i}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(l.y.source,`sources.${i}`,a,null,h))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const p=this.sourceCaches[i]=new Ar(i,a,this.dispatcher);p.style=this,p.setEventedParent(this,()=>({isSourceLoaded:p.loaded(),source:p.serialize(),sourceId:i})),p.onAdd(this.map),this._changed=!0}removeSource(i){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error("There is no source with this ID");for(const h in this._layers)if(this._layers[h].source===i)return this.fire(new l.j(new Error(`Source "${i}" cannot be removed while layer "${h}" is using it.`)));const a=this.sourceCaches[i];delete this.sourceCaches[i],delete this._updatedSources[i],a.fire(new l.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:i})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(i,a){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error(`There is no source with this ID=${i}`);const h=this.sourceCaches[i].getSource();if(h.type!=="geojson")throw new Error(`geojsonSource.type is ${h.type}, which is !== 'geojson`);h.setData(a),this._changed=!0}getSource(i){return this.sourceCaches[i]&&this.sourceCaches[i].getSource()}addLayer(i,a,h={}){this._checkLoaded();const p=i.id;if(this.getLayer(p))return void this.fire(new l.j(new Error(`Layer "${p}" already exists on this map.`)));let g;if(i.type==="custom"){if(on(this,l.aF(i)))return;g=l.aC(i)}else{if("source"in i&&typeof i.source=="object"&&(this.addSource(p,i.source),i=l.aD(i),i=l.e(i,{source:p})),this._validate(l.y.layer,`layers.${p}`,i,{arrayIndex:-1},h))return;g=l.aC(i),this._validateLayer(g),g.setEventedParent(this,{layer:{id:p}})}const x=a?this._order.indexOf(a):this._order.length;if(a&&x===-1)this.fire(new l.j(new Error(`Cannot add layer "${p}" before non-existing layer "${a}".`)));else{if(this._order.splice(x,0,p),this._layerOrderChanged=!0,this._layers[p]=g,this._removedLayers[p]&&g.source&&g.type!=="custom"){const w=this._removedLayers[p];delete this._removedLayers[p],w.type!==g.type?this._updatedSources[g.source]="clear":(this._updatedSources[g.source]="reload",this.sourceCaches[g.source].pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map)}}moveLayer(i,a){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new l.j(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===a)return;const h=this._order.indexOf(i);this._order.splice(h,1);const p=a?this._order.indexOf(a):this._order.length;a&&p===-1?this.fire(new l.j(new Error(`Cannot move layer "${i}" before non-existing layer "${a}".`))):(this._order.splice(p,0,i),this._layerOrderChanged=!0)}removeLayer(i){this._checkLoaded();const a=this._layers[i];if(!a)return void this.fire(new l.j(new Error(`Cannot remove non-existing layer "${i}".`)));a.setEventedParent(null);const h=this._order.indexOf(i);this._order.splice(h,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=a,delete this._layers[i],this._serializedLayers&&delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],a.onRemove&&a.onRemove(this.map)}getLayer(i){return this._layers[i]}getLayersOrder(){return[...this._order]}hasLayer(i){return i in this._layers}setLayerZoomRange(i,a,h){this._checkLoaded();const p=this.getLayer(i);p?p.minzoom===a&&p.maxzoom===h||(a!=null&&(p.minzoom=a),h!=null&&(p.maxzoom=h),this._updateLayer(p)):this.fire(new l.j(new Error(`Cannot set the zoom range of non-existing layer "${i}".`)))}setFilter(i,a,h={}){this._checkLoaded();const p=this.getLayer(i);if(p){if(!l.aG(p.filter,a))return a==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(l.y.filter,`layers.${p.id}.filter`,a,null,h)||(p.filter=l.aD(a),this._updateLayer(p)))}else this.fire(new l.j(new Error(`Cannot filter non-existing layer "${i}".`)))}getFilter(i){return l.aD(this.getLayer(i).filter)}setLayoutProperty(i,a,h,p={}){this._checkLoaded();const g=this.getLayer(i);g?l.aG(g.getLayoutProperty(a),h)||(g.setLayoutProperty(a,h,p),this._updateLayer(g)):this.fire(new l.j(new Error(`Cannot style non-existing layer "${i}".`)))}getLayoutProperty(i,a){const h=this.getLayer(i);if(h)return h.getLayoutProperty(a);this.fire(new l.j(new Error(`Cannot get style of non-existing layer "${i}".`)))}setPaintProperty(i,a,h,p={}){this._checkLoaded();const g=this.getLayer(i);g?l.aG(g.getPaintProperty(a),h)||(g.setPaintProperty(a,h,p)&&this._updateLayer(g),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new l.j(new Error(`Cannot style non-existing layer "${i}".`)))}getPaintProperty(i,a){return this.getLayer(i).getPaintProperty(a)}setFeatureState(i,a){this._checkLoaded();const h=i.source,p=i.sourceLayer,g=this.sourceCaches[h];if(g===void 0)return void this.fire(new l.j(new Error(`The source '${h}' does not exist in the map's style.`)));const x=g.getSource().type;x==="geojson"&&p?this.fire(new l.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):x!=="vector"||p?(i.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),g.setFeatureState(p,i.id,a)):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(i,a){this._checkLoaded();const h=i.source,p=this.sourceCaches[h];if(p===void 0)return void this.fire(new l.j(new Error(`The source '${h}' does not exist in the map's style.`)));const g=p.getSource().type,x=g==="vector"?i.sourceLayer:void 0;g!=="vector"||x?a&&typeof i.id!="string"&&typeof i.id!="number"?this.fire(new l.j(new Error("A feature id is required to remove its specific state property."))):p.removeFeatureState(x,i.id,a):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(i){this._checkLoaded();const a=i.source,h=i.sourceLayer,p=this.sourceCaches[a];if(p!==void 0)return p.getSource().type!=="vector"||h?(i.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),p.getFeatureState(h,i.id)):void this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.j(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const i=l.aH(this.sourceCaches,g=>g.serialize()),a=this._serializeByIds(this._order),h=this.map.getTerrain()||void 0,p=this.stylesheet;return l.aI({version:p.version,name:p.name,metadata:p.metadata,light:p.light,center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch,sprite:p.sprite,glyphs:p.glyphs,transition:p.transition,sources:i,layers:a,terrain:h},g=>g!==void 0)}_updateLayer(i){this._updatedLayers[i.id]=!0,i.source&&!this._updatedSources[i.source]&&this.sourceCaches[i.source].getSource().type!=="raster"&&(this._updatedSources[i.source]="reload",this.sourceCaches[i.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(i){const a=x=>this._layers[x].type==="fill-extrusion",h={},p=[];for(let x=this._order.length-1;x>=0;x--){const w=this._order[x];if(a(w)){h[w]=x;for(const T of i){const A=T[w];if(A)for(const M of A)p.push(M)}}}p.sort((x,w)=>w.intersectionZ-x.intersectionZ);const g=[];for(let x=this._order.length-1;x>=0;x--){const w=this._order[x];if(a(w))for(let T=p.length-1;T>=0;T--){const A=p[T].feature;if(h[A.layer.id]<x)break;g.push(A),p.pop()}else for(const T of i){const A=T[w];if(A)for(const M of A)g.push(M.feature)}}return g}queryRenderedFeatures(i,a,h){a&&a.filter&&this._validate(l.y.filter,"queryRenderedFeatures.filter",a.filter,null,a);const p={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new l.j(new Error("parameters.layers must be an Array."))),[];for(const w of a.layers){const T=this._layers[w];if(!T)return this.fire(new l.j(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];p[T.source]=!0}}const g=[];a.availableImages=this._availableImages;const x=this._serializedAllLayers();for(const w in this.sourceCaches)a.layers&&!p[w]||g.push(Pr(this.sourceCaches[w],this._layers,x,i,a,h));return this.placement&&g.push(function(w,T,A,M,D,F,Z){const G={},Y=F.queryRenderedSymbols(M),$=[];for(const lt of Object.keys(Y).map(Number))$.push(Z[lt]);$.sort(rn);for(const lt of $){const yt=lt.featureIndex.lookupSymbolFeatures(Y[lt.bucketInstanceId],T,lt.bucketIndex,lt.sourceLayerIndex,D.filter,D.layers,D.availableImages,w);for(const Q in yt){const ut=G[Q]=G[Q]||[],xt=yt[Q];xt.sort((St,Mt)=>{const Ft=lt.featureSortOrder;if(Ft){const zt=Ft.indexOf(St.featureIndex);return Ft.indexOf(Mt.featureIndex)-zt}return Mt.featureIndex-St.featureIndex});for(const St of xt)ut.push(St)}}for(const lt in G)G[lt].forEach(yt=>{const Q=yt.feature,ut=A[w[lt].source].getFeatureState(Q.layer["source-layer"],Q.id);Q.source=Q.layer.source,Q.layer["source-layer"]&&(Q.sourceLayer=Q.layer["source-layer"]),Q.state=ut});return G}(this._layers,x,this.sourceCaches,i,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(i,a){a&&a.filter&&this._validate(l.y.filter,"querySourceFeatures.filter",a.filter,null,a);const h=this.sourceCaches[i];return h?function(p,g){const x=p.getRenderableIds().map(A=>p.getTileByID(A)),w=[],T={};for(let A=0;A<x.length;A++){const M=x[A],D=M.tileID.canonical.key;T[D]||(T[D]=!0,M.querySourceFeatures(w,g))}return w}(h,a):[]}addSourceType(i,a,h){return ir(i)?h(new Error(`A source type called "${i}" already exists.`)):(((p,g)=>{wn[p]=g})(i,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:a.workerSourceURL},h):h(null,null))}getLight(){return this.light.getLight()}setLight(i,a={}){this._checkLoaded();const h=this.light.getLight();let p=!1;for(const x in i)if(!l.aG(i[x],h[x])){p=!0;break}if(!p)return;const g={now:l.h.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(i,a),this.light.updateTransitions(g)}_validate(i,a,h,p,g={}){return(!g||g.validate!==!1)&&on(this,i.call(l.y,l.e({key:a,style:this.serialize(),value:h,styleSpec:l.v},p)))}_remove(i=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.sourceCaches){const h=this.sourceCaches[a];h.setEventedParent(null),h.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(i)}_clearSource(i){this.sourceCaches[i].clearTiles()}_reloadSource(i){this.sourceCaches[i].resume(),this.sourceCaches[i].reload()}_updateSources(i){for(const a in this.sourceCaches)this.sourceCaches[a].update(i,this.map.terrain)}_generateCollisionBoxes(){for(const i in this.sourceCaches)this._reloadSource(i)}_updatePlacement(i,a,h,p,g=!1){let x=!1,w=!1;const T={};for(const A of this._order){const M=this._layers[A];if(M.type!=="symbol")continue;if(!T[M.source]){const F=this.sourceCaches[M.source];T[M.source]=F.getRenderableIds(!0).map(Z=>F.getTileByID(Z)).sort((Z,G)=>G.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(G.tileID)?-1:1))}const D=this.crossTileSymbolIndex.addLayer(M,T[M.source],i.center.lng);x=x||D}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((g=g||this._layerOrderChanged||h===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.h.now(),i.zoom))&&(this.pauseablePlacement=new aa(i,this.map.terrain,this._order,g,a,h,p,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,T),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.h.now()),w=!0),x&&this.pauseablePlacement.placement.setStale()),w||x)for(const A of this._order){const M=this._layers[A];M.type==="symbol"&&this.placement.updateLayerOpacities(M,T[M.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.h.now())}_releaseSymbolFadeTiles(){for(const i in this.sourceCaches)this.sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,a,h){this.imageManager.getImages(a.icons,h),this._updateTilesForChangedImages();const p=this.sourceCaches[a.source];p&&p.setDependencies(a.tileID.key,a.type,a.icons)}getGlyphs(i,a,h){this.glyphManager.getGlyphs(a.stacks,h);const p=this.sourceCaches[a.source];p&&p.setDependencies(a.tileID.key,a.type,[""])}getResource(i,a,h){return l.m(a,h)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(i,a={}){this._checkLoaded(),i&&this._validate(l.y.glyphs,"glyphs",i,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=i,this.glyphManager.entries={},this.glyphManager.setURL(i))}addSprite(i,a,h={},p){this._checkLoaded();const g=[{id:i,url:a}],x=[...Rt(this.stylesheet.sprite),...g];this._validate(l.y.sprite,"sprite",x,null,h)||(this.stylesheet.sprite=x,this._loadSprite(g,!0,p))}removeSprite(i){this._checkLoaded();const a=Rt(this.stylesheet.sprite);if(a.find(h=>h.id===i)){if(this._spritesImagesIds[i])for(const h of this._spritesImagesIds[i])this.imageManager.removeImage(h),this._changedImages[h]=!0;a.splice(a.findIndex(h=>h.id===i),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[i],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}else this.fire(new l.j(new Error(`Sprite "${i}" doesn't exists on this map.`)))}getSprite(){return Rt(this.stylesheet.sprite)}setSprite(i,a={},h){this._checkLoaded(),i&&this._validate(l.y.sprite,"sprite",i,null,a)||(this.stylesheet.sprite=i,i?this._loadSprite(i,!0,h):(this._unloadSprite(),h&&h(null)))}}Hr.registerForPluginStateChange=l.aK;var Cl=l.Q([{name:"a_pos",type:"Int16",components:2}]),ca="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const rr={prelude:wi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:wi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:wi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:wi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:wi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:wi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:wi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:wi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:wi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:wi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:wi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:wi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:wi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:wi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:wi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:wi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:wi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:wi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:wi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:wi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:wi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:wi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:wi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:wi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:wi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:wi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:wi("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",ca),terrainDepth:wi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",ca),terrainCoords:wi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",ca)};function wi(f,i){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=i.match(/attribute ([\w]+) ([\w]+)/g),p=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=i.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=g?g.concat(p):p,w={};return{fragmentSource:f=f.replace(a,(T,A,M,D,F)=>(w[F]=!0,A==="define"?`
#ifndef HAS_UNIFORM_u_${F}
varying ${M} ${D} ${F};
#else
uniform ${M} ${D} u_${F};
#endif
`:`
#ifdef HAS_UNIFORM_u_${F}
    ${M} ${D} ${F} = u_${F};
#endif
`)),vertexSource:i=i.replace(a,(T,A,M,D,F)=>{const Z=D==="float"?"vec2":"vec4",G=F.match(/color/)?"color":Z;return w[F]?A==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${M} ${Z} a_${F};
varying ${M} ${D} ${F};
#else
uniform ${M} ${D} u_${F};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${M} ${D} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${G}(a_${F}, u_${F}_t);
#else
    ${M} ${D} ${F} = u_${F};
#endif
`:A==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${M} ${Z} a_${F};
#else
uniform ${M} ${D} u_${F};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${M} ${D} ${F} = a_${F};
#else
    ${M} ${D} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${M} ${D} ${F} = unpack_mix_${G}(a_${F}, u_${F}_t);
#else
    ${M} ${D} ${F} = u_${F};
#endif
`}),staticAttributes:h,staticUniforms:x}}class Po{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(i,a,h,p,g,x,w,T,A){this.context=i;let M=this.boundPaintVertexBuffers.length!==p.length;for(let D=0;!M&&D<p.length;D++)this.boundPaintVertexBuffers[D]!==p[D]&&(M=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==h||M||this.boundIndexBuffer!==g||this.boundVertexOffset!==x||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==T||this.boundDynamicVertexBuffer3!==A?this.freshBind(a,h,p,g,x,w,T,A):(i.bindVertexArray.set(this.vao),w&&w.bind(),g&&g.dynamicDraw&&g.bind(),T&&T.bind(),A&&A.bind())}freshBind(i,a,h,p,g,x,w,T){const A=i.numAttributes,M=this.context,D=M.gl;this.vao&&this.destroy(),this.vao=M.createVertexArray(),M.bindVertexArray.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=p,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=x,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=T,a.enableAttributes(D,i);for(const F of h)F.enableAttributes(D,i);x&&x.enableAttributes(D,i),w&&w.enableAttributes(D,i),T&&T.enableAttributes(D,i),a.bind(),a.setVertexAttribPointers(D,i,g);for(const F of h)F.bind(),F.setVertexAttribPointers(D,i,g);x&&(x.bind(),x.setVertexAttribPointers(D,i,g)),p&&p.bind(),w&&(w.bind(),w.setVertexAttribPointers(D,i,g)),T&&(T.bind(),T.setVertexAttribPointers(D,i,g)),M.currentNumAttributes=A}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function ur(f){const i=[];for(let a=0;a<f.length;a++){if(f[a]===null)continue;const h=f[a].split(" ");i.push(h.pop())}return i}class Ml{constructor(i,a,h,p,g,x){const w=i.gl;this.program=w.createProgram();const T=ur(a.staticAttributes),A=h?h.getBinderAttributes():[],M=T.concat(A),D=rr.prelude.staticUniforms?ur(rr.prelude.staticUniforms):[],F=a.staticUniforms?ur(a.staticUniforms):[],Z=h?h.getBinderUniforms():[],G=D.concat(F).concat(Z),Y=[];for(const St of G)Y.indexOf(St)<0&&Y.push(St);const $=h?h.defines():[];g&&$.push("#define OVERDRAW_INSPECTOR;"),x&&$.push("#define TERRAIN3D;");const lt=$.concat(rr.prelude.fragmentSource,a.fragmentSource).join(`
`),yt=$.concat(rr.prelude.vertexSource,a.vertexSource).join(`
`),Q=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(Q,lt),w.compileShader(Q),!w.getShaderParameter(Q,w.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${w.getShaderInfoLog(Q)}`);w.attachShader(this.program,Q);const ut=w.createShader(w.VERTEX_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(ut,yt),w.compileShader(ut),!w.getShaderParameter(ut,w.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${w.getShaderInfoLog(ut)}`);w.attachShader(this.program,ut),this.attributes={};const xt={};this.numAttributes=M.length;for(let St=0;St<this.numAttributes;St++)M[St]&&(w.bindAttribLocation(this.program,St,M[St]),this.attributes[M[St]]=St);if(w.linkProgram(this.program),!w.getProgramParameter(this.program,w.LINK_STATUS))throw new Error(`Program failed to link: ${w.getProgramInfoLog(this.program)}`);w.deleteShader(ut),w.deleteShader(Q);for(let St=0;St<Y.length;St++){const Mt=Y[St];if(Mt&&!xt[Mt]){const Ft=w.getUniformLocation(this.program,Mt);Ft&&(xt[Mt]=Ft)}}this.fixedUniforms=p(i,xt),this.terrainUniforms=((St,Mt)=>({u_depth:new l.aL(St,Mt.u_depth),u_terrain:new l.aL(St,Mt.u_terrain),u_terrain_dim:new l.aM(St,Mt.u_terrain_dim),u_terrain_matrix:new l.aN(St,Mt.u_terrain_matrix),u_terrain_unpack:new l.aO(St,Mt.u_terrain_unpack),u_terrain_exaggeration:new l.aM(St,Mt.u_terrain_exaggeration)}))(i,xt),this.binderUniforms=h?h.getUniforms(i,xt):[]}draw(i,a,h,p,g,x,w,T,A,M,D,F,Z,G,Y,$,lt,yt){const Q=i.gl;if(this.failedToCreate)return;if(i.program.set(this.program),i.setDepthMode(h),i.setStencilMode(p),i.setColorMode(g),i.setCullFace(x),T){i.activeTexture.set(Q.TEXTURE2),Q.bindTexture(Q.TEXTURE_2D,T.depthTexture),i.activeTexture.set(Q.TEXTURE3),Q.bindTexture(Q.TEXTURE_2D,T.texture);for(const xt in this.terrainUniforms)this.terrainUniforms[xt].set(T[xt])}for(const xt in this.fixedUniforms)this.fixedUniforms[xt].set(w[xt]);Y&&Y.setUniforms(i,this.binderUniforms,Z,{zoom:G});let ut=0;switch(a){case Q.LINES:ut=2;break;case Q.TRIANGLES:ut=3;break;case Q.LINE_STRIP:ut=1}for(const xt of F.get()){const St=xt.vaos||(xt.vaos={});(St[A]||(St[A]=new Po)).bind(i,this,M,Y?Y.getPaintVertexBuffers():[],D,xt.vertexOffset,$,lt,yt),Q.drawElements(a,xt.primitiveLength*ut,Q.UNSIGNED_SHORT,xt.primitiveOffset*ut*2)}}}function Jn(f,i,a){const h=1/at(a,1,i.transform.tileZoom),p=Math.pow(2,a.tileID.overscaledZ),g=a.tileSize*Math.pow(2,i.transform.tileZoom)/p,x=g*(a.tileID.canonical.x+a.tileID.wrap*p),w=g*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[h,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[x>>16,w>>16],u_pixel_coord_lower:[65535&x,65535&w]}}const Kc=(f,i,a,h)=>{const p=i.style.light,g=p.properties.get("position"),x=[g.x,g.y,g.z],w=function(){var A=new l.A(9);return l.A!=Float32Array&&(A[1]=0,A[2]=0,A[3]=0,A[5]=0,A[6]=0,A[7]=0),A[0]=1,A[4]=1,A[8]=1,A}();p.properties.get("anchor")==="viewport"&&function(A,M){var D=Math.sin(M),F=Math.cos(M);A[0]=F,A[1]=D,A[2]=0,A[3]=-D,A[4]=F,A[5]=0,A[6]=0,A[7]=0,A[8]=1}(w,-i.transform.angle),function(A,M,D){var F=M[0],Z=M[1],G=M[2];A[0]=F*D[0]+Z*D[3]+G*D[6],A[1]=F*D[1]+Z*D[4]+G*D[7],A[2]=F*D[2]+Z*D[5]+G*D[8]}(x,x,w);const T=p.properties.get("color");return{u_matrix:f,u_lightpos:x,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[T.r,T.g,T.b],u_vertical_gradient:+a,u_opacity:h}},so=(f,i,a,h,p,g,x)=>l.e(Kc(f,i,a,h),Jn(g,i,x),{u_height_factor:-Math.pow(2,p.overscaledZ)/x.tileSize/8}),Fh=f=>({u_matrix:f}),Xc=(f,i,a,h)=>l.e(Fh(f),Jn(a,i,h)),Dl=(f,i)=>({u_matrix:f,u_world:i}),Pl=(f,i,a,h,p)=>l.e(Xc(f,i,a,h),{u_world:p}),oo=(f,i,a,h)=>{const p=f.transform;let g,x;if(h.paint.get("circle-pitch-alignment")==="map"){const w=at(a,1,p.zoom);g=!0,x=[w,w]}else g=!1,x=p.pixelsToGLUnits;return{u_camera_to_center_distance:p.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_matrix:f.translatePosMatrix(i.posMatrix,a,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_pitch_with_map:+g,u_device_pixel_ratio:f.pixelRatio,u_extrude_scale:x}},Jc=(f,i,a)=>{const h=at(a,1,i.zoom),p=Math.pow(2,i.zoom-a.tileID.overscaledZ),g=a.tileID.overscaleFactor();return{u_matrix:f,u_camera_to_center_distance:i.cameraToCenterDistance,u_pixels_to_tile_units:h,u_extrude_scale:[i.pixelsToGLUnits[0]/(h*p),i.pixelsToGLUnits[1]/(h*p)],u_overscale_factor:g}},Wa=(f,i,a=1)=>({u_matrix:f,u_color:i,u_overlay:0,u_overlay_scale:a}),Oh=f=>({u_matrix:f}),mf=(f,i,a,h)=>({u_matrix:f,u_extrude_scale:at(i,1,a),u_intensity:h});function Qc(f,i){const a=Math.pow(2,i.canonical.z),h=i.canonical.y;return[new l.U(0,h/a).toLngLat().lat,new l.U(0,(h+1)/a).toLngLat().lat]}const tu=(f,i,a,h)=>{const p=f.transform;return{u_matrix:Ll(f,i,a,h),u_ratio:1/at(i,1,p.zoom),u_device_pixel_ratio:f.pixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Nh=(f,i,a,h,p)=>l.e(tu(f,i,a,p),{u_image:0,u_image_height:h}),gf=(f,i,a,h,p)=>{const g=f.transform,x=Vh(i,g);return{u_matrix:Ll(f,i,a,p),u_texsize:i.imageAtlasTexture.size,u_ratio:1/at(i,1,g.zoom),u_device_pixel_ratio:f.pixelRatio,u_image:0,u_scale:[x,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Uh=(f,i,a,h,p,g)=>{const x=f.lineAtlas,w=Vh(i,f.transform),T=a.layout.get("line-cap")==="round",A=x.getDash(h.from,T),M=x.getDash(h.to,T),D=A.width*p.fromScale,F=M.width*p.toScale;return l.e(tu(f,i,a,g),{u_patternscale_a:[w/D,-A.height/2],u_patternscale_b:[w/F,-M.height/2],u_sdfgamma:x.width/(256*Math.min(D,F)*f.pixelRatio)/2,u_image:0,u_tex_y_a:A.y,u_tex_y_b:M.y,u_mix:p.t})};function Vh(f,i){return 1/at(f,1,i.tileZoom)}function Ll(f,i,a,h){return f.translatePosMatrix(h?h.posMatrix:i.tileID.posMatrix,i,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const $h=(f,i,a,h,p)=>{return{u_matrix:f,u_tl_parent:i,u_scale_parent:a,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*p.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:p.paint.get("raster-brightness-min"),u_brightness_high:p.paint.get("raster-brightness-max"),u_saturation_factor:(x=p.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(g=p.paint.get("raster-contrast"),g>0?1/(1-g):1+g),u_spin_weights:jh(p.paint.get("raster-hue-rotate"))};var g,x};function jh(f){f*=Math.PI/180;const i=Math.sin(f),a=Math.cos(f);return[(2*a+1)/3,(-Math.sqrt(3)*i-a+1)/3,(Math.sqrt(3)*i-a+1)/3]}const eu=(f,i,a,h,p,g,x,w,T,A)=>{const M=p.transform;return{u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:M.cameraToCenterDistance,u_pitch:M.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:M.width/M.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:g,u_label_plane_matrix:x,u_coord_matrix:w,u_is_text:+T,u_pitch_with_map:+h,u_texsize:A,u_texture:0}},iu=(f,i,a,h,p,g,x,w,T,A,M)=>{const D=p.transform;return l.e(eu(f,i,a,h,p,g,x,w,T,A),{u_gamma_scale:h?Math.cos(D._pitch)*D.cameraToCenterDistance:1,u_device_pixel_ratio:p.pixelRatio,u_is_halo:+M})},Lo=(f,i,a,h,p,g,x,w,T,A)=>l.e(iu(f,i,a,h,p,g,x,w,!0,T,!0),{u_texsize_icon:A,u_texture_icon:1}),zl=(f,i,a)=>({u_matrix:f,u_opacity:i,u_color:a}),Qn=(f,i,a,h,p,g)=>l.e(function(x,w,T,A){const M=T.imageManager.getPattern(x.from.toString()),D=T.imageManager.getPattern(x.to.toString()),{width:F,height:Z}=T.imageManager.getPixelSize(),G=Math.pow(2,A.tileID.overscaledZ),Y=A.tileSize*Math.pow(2,T.transform.tileZoom)/G,$=Y*(A.tileID.canonical.x+A.tileID.wrap*G),lt=Y*A.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:M.tl,u_pattern_br_a:M.br,u_pattern_tl_b:D.tl,u_pattern_br_b:D.br,u_texsize:[F,Z],u_mix:w.t,u_pattern_size_a:M.displaySize,u_pattern_size_b:D.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/at(A,1,T.transform.tileZoom),u_pixel_coord_upper:[$>>16,lt>>16],u_pixel_coord_lower:[65535&$,65535&lt]}}(h,g,a,p),{u_matrix:f,u_opacity:i}),Bl={fillExtrusion:(f,i)=>({u_matrix:new l.aN(f,i.u_matrix),u_lightpos:new l.aP(f,i.u_lightpos),u_lightintensity:new l.aM(f,i.u_lightintensity),u_lightcolor:new l.aP(f,i.u_lightcolor),u_vertical_gradient:new l.aM(f,i.u_vertical_gradient),u_opacity:new l.aM(f,i.u_opacity)}),fillExtrusionPattern:(f,i)=>({u_matrix:new l.aN(f,i.u_matrix),u_lightpos:new l.aP(f,i.u_lightpos),u_lightintensity:new l.aM(f,i.u_lightintensity),u_lightcolor:new l.aP(f,i.u_lightcolor),u_vertical_gradient:new l.aM(f,i.u_vertical_gradient),u_height_factor:new l.aM(f,i.u_height_factor),u_image:new l.aL(f,i.u_image),u_texsize:new l.aQ(f,i.u_texsize),u_pixel_coord_upper:new l.aQ(f,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.aQ(f,i.u_pixel_coord_lower),u_scale:new l.aP(f,i.u_scale),u_fade:new l.aM(f,i.u_fade),u_opacity:new l.aM(f,i.u_opacity)}),fill:(f,i)=>({u_matrix:new l.aN(f,i.u_matrix)}),fillPattern:(f,i)=>({u_matrix:new l.aN(f,i.u_matrix),u_image:new l.aL(f,i.u_image),u_texsize:new l.aQ(f,i.u_texsize),u_pixel_coord_upper:new l.aQ(f,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.aQ(f,i.u_pixel_coord_lower),u_scale:new l.aP(f,i.u_scale),u_fade:new l.aM(f,i.u_fade)}),fillOutline:(f,i)=>({u_matrix:new l.aN(f,i.u_matrix),u_world:new l.aQ(f,i.u_world)}),fillOutlinePattern:(f,i)=>({u_matrix:new l.aN(f,i.u_matrix),u_world:new l.aQ(f,i.u_world),u_image:new l.aL(f,i.u_image),u_texsize:new l.aQ(f,i.u_texsize),u_pixel_coord_upper:new l.aQ(f,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.aQ(f,i.u_pixel_coord_lower),u_scale:new l.aP(f,i.u_scale),u_fade:new l.aM(f,i.u_fade)}),circle:(f,i)=>({u_camera_to_center_distance:new l.aM(f,i.u_camera_to_center_distance),u_scale_with_map:new l.aL(f,i.u_scale_with_map),u_pitch_with_map:new l.aL(f,i.u_pitch_with_map),u_extrude_scale:new l.aQ(f,i.u_extrude_scale),u_device_pixel_ratio:new l.aM(f,i.u_device_pixel_ratio),u_matrix:new l.aN(f,i.u_matrix)}),collisionBox:(f,i)=>({u_matrix:new l.aN(f,i.u_matrix),u_camera_to_center_distance:new l.aM(f,i.u_camera_to_center_distance),u_pixels_to_tile_units:new l.aM(f,i.u_pixels_to_tile_units),u_extrude_scale:new l.aQ(f,i.u_extrude_scale),u_overscale_factor:new l.aM(f,i.u_overscale_factor)}),collisionCircle:(f,i)=>({u_matrix:new l.aN(f,i.u_matrix),u_inv_matrix:new l.aN(f,i.u_inv_matrix),u_camera_to_center_distance:new l.aM(f,i.u_camera_to_center_distance),u_viewport_size:new l.aQ(f,i.u_viewport_size)}),debug:(f,i)=>({u_color:new l.aR(f,i.u_color),u_matrix:new l.aN(f,i.u_matrix),u_overlay:new l.aL(f,i.u_overlay),u_overlay_scale:new l.aM(f,i.u_overlay_scale)}),clippingMask:(f,i)=>({u_matrix:new l.aN(f,i.u_matrix)}),heatmap:(f,i)=>({u_extrude_scale:new l.aM(f,i.u_extrude_scale),u_intensity:new l.aM(f,i.u_intensity),u_matrix:new l.aN(f,i.u_matrix)}),heatmapTexture:(f,i)=>({u_matrix:new l.aN(f,i.u_matrix),u_world:new l.aQ(f,i.u_world),u_image:new l.aL(f,i.u_image),u_color_ramp:new l.aL(f,i.u_color_ramp),u_opacity:new l.aM(f,i.u_opacity)}),hillshade:(f,i)=>({u_matrix:new l.aN(f,i.u_matrix),u_image:new l.aL(f,i.u_image),u_latrange:new l.aQ(f,i.u_latrange),u_light:new l.aQ(f,i.u_light),u_shadow:new l.aR(f,i.u_shadow),u_highlight:new l.aR(f,i.u_highlight),u_accent:new l.aR(f,i.u_accent)}),hillshadePrepare:(f,i)=>({u_matrix:new l.aN(f,i.u_matrix),u_image:new l.aL(f,i.u_image),u_dimension:new l.aQ(f,i.u_dimension),u_zoom:new l.aM(f,i.u_zoom),u_unpack:new l.aO(f,i.u_unpack)}),line:(f,i)=>({u_matrix:new l.aN(f,i.u_matrix),u_ratio:new l.aM(f,i.u_ratio),u_device_pixel_ratio:new l.aM(f,i.u_device_pixel_ratio),u_units_to_pixels:new l.aQ(f,i.u_units_to_pixels)}),lineGradient:(f,i)=>({u_matrix:new l.aN(f,i.u_matrix),u_ratio:new l.aM(f,i.u_ratio),u_device_pixel_ratio:new l.aM(f,i.u_device_pixel_ratio),u_units_to_pixels:new l.aQ(f,i.u_units_to_pixels),u_image:new l.aL(f,i.u_image),u_image_height:new l.aM(f,i.u_image_height)}),linePattern:(f,i)=>({u_matrix:new l.aN(f,i.u_matrix),u_texsize:new l.aQ(f,i.u_texsize),u_ratio:new l.aM(f,i.u_ratio),u_device_pixel_ratio:new l.aM(f,i.u_device_pixel_ratio),u_image:new l.aL(f,i.u_image),u_units_to_pixels:new l.aQ(f,i.u_units_to_pixels),u_scale:new l.aP(f,i.u_scale),u_fade:new l.aM(f,i.u_fade)}),lineSDF:(f,i)=>({u_matrix:new l.aN(f,i.u_matrix),u_ratio:new l.aM(f,i.u_ratio),u_device_pixel_ratio:new l.aM(f,i.u_device_pixel_ratio),u_units_to_pixels:new l.aQ(f,i.u_units_to_pixels),u_patternscale_a:new l.aQ(f,i.u_patternscale_a),u_patternscale_b:new l.aQ(f,i.u_patternscale_b),u_sdfgamma:new l.aM(f,i.u_sdfgamma),u_image:new l.aL(f,i.u_image),u_tex_y_a:new l.aM(f,i.u_tex_y_a),u_tex_y_b:new l.aM(f,i.u_tex_y_b),u_mix:new l.aM(f,i.u_mix)}),raster:(f,i)=>({u_matrix:new l.aN(f,i.u_matrix),u_tl_parent:new l.aQ(f,i.u_tl_parent),u_scale_parent:new l.aM(f,i.u_scale_parent),u_buffer_scale:new l.aM(f,i.u_buffer_scale),u_fade_t:new l.aM(f,i.u_fade_t),u_opacity:new l.aM(f,i.u_opacity),u_image0:new l.aL(f,i.u_image0),u_image1:new l.aL(f,i.u_image1),u_brightness_low:new l.aM(f,i.u_brightness_low),u_brightness_high:new l.aM(f,i.u_brightness_high),u_saturation_factor:new l.aM(f,i.u_saturation_factor),u_contrast_factor:new l.aM(f,i.u_contrast_factor),u_spin_weights:new l.aP(f,i.u_spin_weights)}),symbolIcon:(f,i)=>({u_is_size_zoom_constant:new l.aL(f,i.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aL(f,i.u_is_size_feature_constant),u_size_t:new l.aM(f,i.u_size_t),u_size:new l.aM(f,i.u_size),u_camera_to_center_distance:new l.aM(f,i.u_camera_to_center_distance),u_pitch:new l.aM(f,i.u_pitch),u_rotate_symbol:new l.aL(f,i.u_rotate_symbol),u_aspect_ratio:new l.aM(f,i.u_aspect_ratio),u_fade_change:new l.aM(f,i.u_fade_change),u_matrix:new l.aN(f,i.u_matrix),u_label_plane_matrix:new l.aN(f,i.u_label_plane_matrix),u_coord_matrix:new l.aN(f,i.u_coord_matrix),u_is_text:new l.aL(f,i.u_is_text),u_pitch_with_map:new l.aL(f,i.u_pitch_with_map),u_texsize:new l.aQ(f,i.u_texsize),u_texture:new l.aL(f,i.u_texture)}),symbolSDF:(f,i)=>({u_is_size_zoom_constant:new l.aL(f,i.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aL(f,i.u_is_size_feature_constant),u_size_t:new l.aM(f,i.u_size_t),u_size:new l.aM(f,i.u_size),u_camera_to_center_distance:new l.aM(f,i.u_camera_to_center_distance),u_pitch:new l.aM(f,i.u_pitch),u_rotate_symbol:new l.aL(f,i.u_rotate_symbol),u_aspect_ratio:new l.aM(f,i.u_aspect_ratio),u_fade_change:new l.aM(f,i.u_fade_change),u_matrix:new l.aN(f,i.u_matrix),u_label_plane_matrix:new l.aN(f,i.u_label_plane_matrix),u_coord_matrix:new l.aN(f,i.u_coord_matrix),u_is_text:new l.aL(f,i.u_is_text),u_pitch_with_map:new l.aL(f,i.u_pitch_with_map),u_texsize:new l.aQ(f,i.u_texsize),u_texture:new l.aL(f,i.u_texture),u_gamma_scale:new l.aM(f,i.u_gamma_scale),u_device_pixel_ratio:new l.aM(f,i.u_device_pixel_ratio),u_is_halo:new l.aL(f,i.u_is_halo)}),symbolTextAndIcon:(f,i)=>({u_is_size_zoom_constant:new l.aL(f,i.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aL(f,i.u_is_size_feature_constant),u_size_t:new l.aM(f,i.u_size_t),u_size:new l.aM(f,i.u_size),u_camera_to_center_distance:new l.aM(f,i.u_camera_to_center_distance),u_pitch:new l.aM(f,i.u_pitch),u_rotate_symbol:new l.aL(f,i.u_rotate_symbol),u_aspect_ratio:new l.aM(f,i.u_aspect_ratio),u_fade_change:new l.aM(f,i.u_fade_change),u_matrix:new l.aN(f,i.u_matrix),u_label_plane_matrix:new l.aN(f,i.u_label_plane_matrix),u_coord_matrix:new l.aN(f,i.u_coord_matrix),u_is_text:new l.aL(f,i.u_is_text),u_pitch_with_map:new l.aL(f,i.u_pitch_with_map),u_texsize:new l.aQ(f,i.u_texsize),u_texsize_icon:new l.aQ(f,i.u_texsize_icon),u_texture:new l.aL(f,i.u_texture),u_texture_icon:new l.aL(f,i.u_texture_icon),u_gamma_scale:new l.aM(f,i.u_gamma_scale),u_device_pixel_ratio:new l.aM(f,i.u_device_pixel_ratio),u_is_halo:new l.aL(f,i.u_is_halo)}),background:(f,i)=>({u_matrix:new l.aN(f,i.u_matrix),u_opacity:new l.aM(f,i.u_opacity),u_color:new l.aR(f,i.u_color)}),backgroundPattern:(f,i)=>({u_matrix:new l.aN(f,i.u_matrix),u_opacity:new l.aM(f,i.u_opacity),u_image:new l.aL(f,i.u_image),u_pattern_tl_a:new l.aQ(f,i.u_pattern_tl_a),u_pattern_br_a:new l.aQ(f,i.u_pattern_br_a),u_pattern_tl_b:new l.aQ(f,i.u_pattern_tl_b),u_pattern_br_b:new l.aQ(f,i.u_pattern_br_b),u_texsize:new l.aQ(f,i.u_texsize),u_mix:new l.aM(f,i.u_mix),u_pattern_size_a:new l.aQ(f,i.u_pattern_size_a),u_pattern_size_b:new l.aQ(f,i.u_pattern_size_b),u_scale_a:new l.aM(f,i.u_scale_a),u_scale_b:new l.aM(f,i.u_scale_b),u_pixel_coord_upper:new l.aQ(f,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.aQ(f,i.u_pixel_coord_lower),u_tile_units_to_pixels:new l.aM(f,i.u_tile_units_to_pixels)}),terrain:(f,i)=>({u_matrix:new l.aN(f,i.u_matrix),u_texture:new l.aL(f,i.u_texture),u_ele_delta:new l.aM(f,i.u_ele_delta)}),terrainDepth:(f,i)=>({u_matrix:new l.aN(f,i.u_matrix),u_ele_delta:new l.aM(f,i.u_ele_delta)}),terrainCoords:(f,i)=>({u_matrix:new l.aN(f,i.u_matrix),u_texture:new l.aL(f,i.u_texture),u_terrain_coords_id:new l.aM(f,i.u_terrain_coords_id),u_ele_delta:new l.aM(f,i.u_ele_delta)})};class Rl{constructor(i,a,h){this.context=i;const p=i.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ha={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Fl{constructor(i,a,h,p){this.length=a.length,this.attributes=h,this.itemSize=a.bytesPerElement,this.dynamicDraw=p,this.context=i;const g=i.gl;this.buffer=g.createBuffer(),i.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){if(i.length!==this.length)throw new Error(`Length of new data is ${i.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,a){for(let h=0;h<this.attributes.length;h++){const p=a.attributes[this.attributes[h].name];p!==void 0&&i.enableVertexAttribArray(p)}}setVertexAttribPointers(i,a,h){for(let p=0;p<this.attributes.length;p++){const g=this.attributes[p],x=a.attributes[g.name];x!==void 0&&i.vertexAttribPointer(x,g.components,i[Ha[g.type]],!1,this.itemSize,g.offset+this.itemSize*(h||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ua=new WeakMap;function ao(f){var i;if(ua.has(f))return ua.get(f);{const a=(i=f.getParameter(f.VERSION))===null||i===void 0?void 0:i.startsWith("WebGL 2.0");return ua.set(f,a),a}}class ui{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ol extends ui{getDefault(){return l.aT.transparent}set(i){const a=this.current;(i.r!==a.r||i.g!==a.g||i.b!==a.b||i.a!==a.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Rn extends ui{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class Fn extends ui{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class ru extends ui{getDefault(){return[!0,!0,!0,!0]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||i[2]!==a[2]||i[3]!==a[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Nl extends ui{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class Ul extends ui{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class nu extends ui{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const a=this.current;(i.func!==a.func||i.ref!==a.ref||i.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class su extends ui{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||i[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class Vl extends ui{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;i?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=i,this.dirty=!1}}class ou extends ui{getDefault(){return[0,1]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class au extends ui{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;i?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=i,this.dirty=!1}}class $l extends ui{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class qh extends ui{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;i?a.enable(a.BLEND):a.disable(a.BLEND),this.current=i,this.dirty=!1}}class Gh extends ui{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class ha extends ui{getDefault(){return l.aT.transparent}set(i){const a=this.current;(i.r!==a.r||i.g!==a.g||i.b!==a.b||i.a!==a.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class yf extends ui{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class _f extends ui{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;i?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=i,this.dirty=!1}}class vf extends ui{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class bf extends ui{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class xf extends ui{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class wf extends ui{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class lu extends ui{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||i[2]!==a[2]||i[3]!==a[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class jl extends ui{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class cu extends ui{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class uu extends ui{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class da extends ui{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Zh extends ui{getDefault(){return null}set(i){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Wh extends ui{getDefault(){return null}set(i){var a;if(i===this.current&&!this.dirty)return;const h=this.gl;ao(h)?h.bindVertexArray(i):(a=h.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(i),this.current=i,this.dirty=!1}}class hu extends ui{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class zo extends ui{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class Hh extends ui{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class lo extends ui{constructor(i,a){super(i),this.context=i,this.parent=a}getDefault(){return null}}class pa extends lo{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Yh extends lo{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class du extends lo{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Si{constructor(i,a,h,p,g){this.context=i,this.width=a,this.height=h;const x=i.gl,w=this.framebuffer=x.createFramebuffer();if(this.colorAttachment=new pa(i,w),p)this.depthAttachment=g?new du(i,w):new Yh(i,w);else if(g)throw new Error("Stencil cannot be setted without depth");if(x.checkFramebufferStatus(x.FRAMEBUFFER)!==x.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const i=this.context.gl,a=this.colorAttachment.get();if(a&&i.deleteTexture(a),this.depthAttachment){const h=this.depthAttachment.get();h&&i.deleteRenderbuffer(h)}i.deleteFramebuffer(this.framebuffer)}}class nr{constructor(i,a,h){this.blendFunction=i,this.blendColor=a,this.mask=h}}nr.Replace=[1,0],nr.disabled=new nr(nr.Replace,l.aT.transparent,[!1,!1,!1,!1]),nr.unblended=new nr(nr.Replace,l.aT.transparent,[!0,!0,!0,!0]),nr.alphaBlended=new nr([1,771],l.aT.transparent,[!0,!0,!0,!0]);class Sf{constructor(i){var a,h;if(this.gl=i,this.clearColor=new Ol(this),this.clearDepth=new Rn(this),this.clearStencil=new Fn(this),this.colorMask=new ru(this),this.depthMask=new Nl(this),this.stencilMask=new Ul(this),this.stencilFunc=new nu(this),this.stencilOp=new su(this),this.stencilTest=new Vl(this),this.depthRange=new ou(this),this.depthTest=new au(this),this.depthFunc=new $l(this),this.blend=new qh(this),this.blendFunc=new Gh(this),this.blendColor=new ha(this),this.blendEquation=new yf(this),this.cullFace=new _f(this),this.cullFaceSide=new vf(this),this.frontFace=new bf(this),this.program=new xf(this),this.activeTexture=new wf(this),this.viewport=new lu(this),this.bindFramebuffer=new jl(this),this.bindRenderbuffer=new cu(this),this.bindTexture=new uu(this),this.bindVertexBuffer=new da(this),this.bindElementBuffer=new Zh(this),this.bindVertexArray=new Wh(this),this.pixelStoreUnpack=new hu(this),this.pixelStoreUnpackPremultiplyAlpha=new zo(this),this.pixelStoreUnpackFlipY=new Hh(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),ao(i)){this.HALF_FLOAT=i.HALF_FLOAT;const p=i.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=i.RGBA16F)!==null&&a!==void 0?a:p==null?void 0:p.RGBA16F_EXT,this.RGB16F=(h=i.RGB16F)!==null&&h!==void 0?h:p==null?void 0:p.RGB16F_EXT,i.getExtension("EXT_color_buffer_float")}else{i.getExtension("EXT_color_buffer_half_float"),i.getExtension("OES_texture_half_float_linear");const p=i.getExtension("OES_texture_half_float");this.HALF_FLOAT=p==null?void 0:p.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,a){return new Rl(this,i,a)}createVertexBuffer(i,a,h){return new Fl(this,i,a,h)}createRenderbuffer(i,a,h){const p=this.gl,g=p.createRenderbuffer();return this.bindRenderbuffer.set(g),p.renderbufferStorage(p.RENDERBUFFER,i,a,h),this.bindRenderbuffer.set(null),g}createFramebuffer(i,a,h,p){return new Si(this,i,a,h,p)}clear({color:i,depth:a,stencil:h}){const p=this.gl;let g=0;i&&(g|=p.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(g|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),h!==void 0&&(g|=p.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),p.clear(g)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){l.aG(i.blendFunction,nr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}createVertexArray(){var i;return ao(this.gl)?this.gl.createVertexArray():(i=this.gl.getExtension("OES_vertex_array_object"))===null||i===void 0?void 0:i.createVertexArrayOES()}deleteVertexArray(i){var a;return ao(this.gl)?this.gl.deleteVertexArray(i):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(i)}unbindVAO(){this.bindVertexArray.set(null)}}class hi{constructor(i,a,h){this.func=i,this.mask=a,this.range=h}}hi.ReadOnly=!1,hi.ReadWrite=!0,hi.disabled=new hi(519,hi.ReadOnly,[0,1]);const Bo=7680;class sr{constructor(i,a,h,p,g,x){this.test=i,this.ref=a,this.mask=h,this.fail=p,this.depthFail=g,this.pass=x}}sr.disabled=new sr({func:519,mask:0},0,0,Bo,Bo,Bo);class Qi{constructor(i,a,h){this.enable=i,this.mode=a,this.frontFace=h}}let Ya;function Kh(f,i,a,h,p,g,x){const w=f.context,T=w.gl,A=f.useProgram("collisionBox"),M=[];let D=0,F=0;for(let Q=0;Q<h.length;Q++){const ut=h[Q],xt=i.getTile(ut),St=xt.getBucket(a);if(!St)continue;let Mt=ut.posMatrix;p[0]===0&&p[1]===0||(Mt=f.translatePosMatrix(ut.posMatrix,xt,p,g));const Ft=x?St.textCollisionBox:St.iconCollisionBox,zt=St.collisionCircleArray;if(zt.length>0){const $t=l.Z(),pe=Mt;l.aU($t,St.placementInvProjMatrix,f.transform.glCoordMatrix),l.aU($t,$t,St.placementViewportMatrix),M.push({circleArray:zt,circleOffset:F,transform:pe,invTransform:$t,coord:ut}),D+=zt.length/4,F=D}Ft&&A.draw(w,T.LINES,hi.disabled,sr.disabled,f.colorModeForRenderPass(),Qi.disabled,Jc(Mt,f.transform,xt),f.style.map.terrain&&f.style.map.terrain.getTerrainData(ut),a.id,Ft.layoutVertexBuffer,Ft.indexBuffer,Ft.segments,null,f.transform.zoom,null,null,Ft.collisionVertexBuffer)}if(!x||!M.length)return;const Z=f.useProgram("collisionCircle"),G=new l.aV;G.resize(4*D),G._trim();let Y=0;for(const Q of M)for(let ut=0;ut<Q.circleArray.length/4;ut++){const xt=4*ut,St=Q.circleArray[xt+0],Mt=Q.circleArray[xt+1],Ft=Q.circleArray[xt+2],zt=Q.circleArray[xt+3];G.emplace(Y++,St,Mt,Ft,zt,0),G.emplace(Y++,St,Mt,Ft,zt,1),G.emplace(Y++,St,Mt,Ft,zt,2),G.emplace(Y++,St,Mt,Ft,zt,3)}(!Ya||Ya.length<2*D)&&(Ya=function(Q){const ut=2*Q,xt=new l.aX;xt.resize(ut),xt._trim();for(let St=0;St<ut;St++){const Mt=6*St;xt.uint16[Mt+0]=4*St+0,xt.uint16[Mt+1]=4*St+1,xt.uint16[Mt+2]=4*St+2,xt.uint16[Mt+3]=4*St+2,xt.uint16[Mt+4]=4*St+3,xt.uint16[Mt+5]=4*St+0}return xt}(D));const $=w.createIndexBuffer(Ya,!0),lt=w.createVertexBuffer(G,l.aW.members,!0);for(const Q of M){const ut={u_matrix:Q.transform,u_inv_matrix:Q.invTransform,u_camera_to_center_distance:(yt=f.transform).cameraToCenterDistance,u_viewport_size:[yt.width,yt.height]};Z.draw(w,T.TRIANGLES,hi.disabled,sr.disabled,f.colorModeForRenderPass(),Qi.disabled,ut,f.style.map.terrain&&f.style.map.terrain.getTerrainData(Q.coord),a.id,lt,$,l.S.simpleSegment(0,2*Q.circleOffset,Q.circleArray.length,Q.circleArray.length/2),null,f.transform.zoom,null,null,null)}var yt;lt.destroy(),$.destroy()}Qi.disabled=new Qi(!1,1029,2305),Qi.backCCW=new Qi(!0,1029,2305);const pu=l.ao(new Float32Array(16));function ql(f,i,a,h,p,g){const{horizontalAlign:x,verticalAlign:w}=l.au(f);return new l.P((-(x-.5)*i/p+h[0])*g,(-(w-.5)*a/p+h[1])*g)}function Gl(f,i,a,h,p,g,x,w,T,A,M){const D=f.text.placedSymbolArray,F=f.text.dynamicLayoutVertexArray,Z=f.icon.dynamicLayoutVertexArray,G={};F.clear();for(let Y=0;Y<D.length;Y++){const $=D.get(Y),lt=$.hidden||!$.crossTileID||f.allowVerticalPlacement&&!$.placedOrientation?null:h[$.crossTileID];if(lt){const yt=new l.P($.anchorX,$.anchorY),Q=cr(yt,a?x:g,M),ut=Do(p.cameraToCenterDistance,Q.signedDistanceFromCamera);let xt=l.aj(f.textSizeData,T,$)*ut/l.ap;a&&(xt*=f.tilePixelRatio/w);const{width:St,height:Mt,anchor:Ft,textOffset:zt,textBoxScale:$t}=lt,pe=ql(Ft,St,Mt,zt,$t,xt),ri=a?cr(yt.add(pe),g,M).point:Q.point.add(i?pe.rotate(-p.angle):pe),Yt=f.allowVerticalPlacement&&$.placedOrientation===l.ai.vertical?Math.PI/2:0;for(let Ee=0;Ee<$.numGlyphs;Ee++)l.ak(F,ri,Yt);A&&$.associatedIconIndex>=0&&(G[$.associatedIconIndex]={shiftedAnchor:ri,angle:Yt})}else V($.numGlyphs,F)}if(A){Z.clear();const Y=f.icon.placedSymbolArray;for(let $=0;$<Y.length;$++){const lt=Y.get($);if(lt.hidden)V(lt.numGlyphs,Z);else{const yt=G[$];if(yt)for(let Q=0;Q<lt.numGlyphs;Q++)l.ak(Z,yt.shiftedAnchor,yt.angle);else V(lt.numGlyphs,Z)}}f.icon.dynamicLayoutVertexBuffer.updateData(Z)}f.text.dynamicLayoutVertexBuffer.updateData(F)}function fu(f,i,a){return a.iconsInText&&i?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function Zl(f,i,a,h,p,g,x,w,T,A,M,D){const F=f.context,Z=F.gl,G=f.transform,Y=w==="map",$=T==="map",lt=w!=="viewport"&&a.layout.get("symbol-placement")!=="point",yt=Y&&!$&&!lt,Q=!a.layout.get("symbol-sort-key").isConstant();let ut=!1;const xt=f.depthModeForSublayer(0,hi.ReadOnly),St=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Mt=[];for(const Ft of h){const zt=i.getTile(Ft),$t=zt.getBucket(a);if(!$t)continue;const pe=p?$t.text:$t.icon;if(!pe||!pe.segments.get().length||!pe.hasVisibleVertices)continue;const ri=pe.programConfigurations.get(a.id),Yt=p||$t.sdfIcons,Ee=p?$t.textSizeData:$t.iconSizeData,ge=$||G.pitch!==0,Pi=f.useProgram(fu(Yt,p,$t),ri),ii=l.ah(Ee,G.zoom),Ye=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Ft);let ni,_r,ji,Yr,Lr=[0,0],wr=null;if(p)_r=zt.glyphAtlasTexture,ji=Z.LINEAR,ni=zt.glyphAtlasTexture.size,$t.iconsInText&&(Lr=zt.imageAtlasTexture.size,wr=zt.imageAtlasTexture,Yr=ge||f.options.rotating||f.options.zooming||Ee.kind==="composite"||Ee.kind==="camera"?Z.LINEAR:Z.NEAREST);else{const vr=a.layout.get("icon-size").constantOr(0)!==1||$t.iconsNeedLinear;_r=zt.imageAtlasTexture,ji=Yt||f.options.rotating||f.options.zooming||vr||ge?Z.LINEAR:Z.NEAREST,ni=zt.imageAtlasTexture.size}const Un=at(zt,1,f.transform.zoom),Hi=Gt(Ft.posMatrix,$,Y,f.transform,Un),ws=vs(Ft.posMatrix,$,Y,f.transform,Un),Ss=St&&$t.hasTextData(),ho=a.layout.get("icon-text-fit")!=="none"&&Ss&&$t.hasIconData();if(lt){const vr=f.style.map.terrain?(kn,br)=>f.style.map.terrain.getElevation(Ft,kn,br):null,zr=a.layout.get("text-rotation-alignment")==="map";Wt($t,Ft.posMatrix,f,p,Hi,ws,$,A,zr,vr)}const Uo=f.translatePosMatrix(Ft.posMatrix,zt,g,x),ba=lt||p&&St||ho?pu:Hi,an=f.translatePosMatrix(ws,zt,g,x,!0),Kr=Yt&&a.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let mn;mn=Yt?$t.iconsInText?Lo(Ee.kind,ii,yt,$,f,Uo,ba,an,ni,Lr):iu(Ee.kind,ii,yt,$,f,Uo,ba,an,p,ni,!0):eu(Ee.kind,ii,yt,$,f,Uo,ba,an,p,ni);const Vo={program:Pi,buffers:pe,uniformValues:mn,atlasTexture:_r,atlasTextureIcon:wr,atlasInterpolation:ji,atlasInterpolationIcon:Yr,isSDF:Yt,hasHalo:Kr};if(Q&&$t.canOverlap){ut=!0;const vr=pe.segments.get();for(const zr of vr)Mt.push({segments:new l.S([zr]),sortKey:zr.sortKey,state:Vo,terrainData:Ye})}else Mt.push({segments:pe.segments,sortKey:0,state:Vo,terrainData:Ye})}ut&&Mt.sort((Ft,zt)=>Ft.sortKey-zt.sortKey);for(const Ft of Mt){const zt=Ft.state;if(F.activeTexture.set(Z.TEXTURE0),zt.atlasTexture.bind(zt.atlasInterpolation,Z.CLAMP_TO_EDGE),zt.atlasTextureIcon&&(F.activeTexture.set(Z.TEXTURE1),zt.atlasTextureIcon&&zt.atlasTextureIcon.bind(zt.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),zt.isSDF){const $t=zt.uniformValues;zt.hasHalo&&($t.u_is_halo=1,mu(zt.buffers,Ft.segments,a,f,zt.program,xt,M,D,$t,Ft.terrainData)),$t.u_is_halo=0}mu(zt.buffers,Ft.segments,a,f,zt.program,xt,M,D,zt.uniformValues,Ft.terrainData)}}function mu(f,i,a,h,p,g,x,w,T,A){const M=h.context;p.draw(M,M.gl.TRIANGLES,g,x,w,Qi.disabled,T,A,a.id,f.layoutVertexBuffer,f.indexBuffer,i,a.paint,h.transform.zoom,f.programConfigurations.get(a.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function Ka(f,i,a,h,p){if(!a||!h||!h.imageAtlas)return;const g=h.imageAtlas.patternPositions;let x=g[a.to.toString()],w=g[a.from.toString()];if(!x&&w&&(x=w),!w&&x&&(w=x),!x||!w){const T=p.getPaintProperty(i);x=g[T],w=g[T]}x&&w&&f.setConstantPatternPositions(x,w)}function Xa(f,i,a,h,p,g,x){const w=f.context.gl,T="fill-pattern",A=a.paint.get(T),M=A&&A.constantOr(1),D=a.getCrossfadeParameters();let F,Z,G,Y,$;x?(Z=M&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=w.LINES):(Z=M?"fillPattern":"fill",F=w.TRIANGLES);const lt=A.constantOr(null);for(const yt of h){const Q=i.getTile(yt);if(M&&!Q.patternsLoaded())continue;const ut=Q.getBucket(a);if(!ut)continue;const xt=ut.programConfigurations.get(a.id),St=f.useProgram(Z,xt),Mt=f.style.map.terrain&&f.style.map.terrain.getTerrainData(yt);M&&(f.context.activeTexture.set(w.TEXTURE0),Q.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),xt.updatePaintBuffers(D)),Ka(xt,T,lt,Q,a);const Ft=Mt?yt:null,zt=f.translatePosMatrix(Ft?Ft.posMatrix:yt.posMatrix,Q,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(x){Y=ut.indexBuffer2,$=ut.segments2;const $t=[w.drawingBufferWidth,w.drawingBufferHeight];G=Z==="fillOutlinePattern"&&M?Pl(zt,f,D,Q,$t):Dl(zt,$t)}else Y=ut.indexBuffer,$=ut.segments,G=M?Xc(zt,f,D,Q):Fh(zt);St.draw(f.context,F,p,f.stencilModeForClipping(yt),g,Qi.disabled,G,Mt,a.id,ut.layoutVertexBuffer,Y,$,a.paint,f.transform.zoom,xt)}}function Ja(f,i,a,h,p,g,x){const w=f.context,T=w.gl,A="fill-extrusion-pattern",M=a.paint.get(A),D=M.constantOr(1),F=a.getCrossfadeParameters(),Z=a.paint.get("fill-extrusion-opacity"),G=M.constantOr(null);for(const Y of h){const $=i.getTile(Y),lt=$.getBucket(a);if(!lt)continue;const yt=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Y),Q=lt.programConfigurations.get(a.id),ut=f.useProgram(D?"fillExtrusionPattern":"fillExtrusion",Q);D&&(f.context.activeTexture.set(T.TEXTURE0),$.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),Q.updatePaintBuffers(F)),Ka(Q,A,G,$,a);const xt=f.translatePosMatrix(Y.posMatrix,$,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),St=a.paint.get("fill-extrusion-vertical-gradient"),Mt=D?so(xt,f,St,Z,Y,F,$):Kc(xt,f,St,Z);ut.draw(w,w.gl.TRIANGLES,p,g,x,Qi.backCCW,Mt,yt,a.id,lt.layoutVertexBuffer,lt.indexBuffer,lt.segments,a.paint,f.transform.zoom,Q,f.style.map.terrain&&lt.centroidVertexBuffer)}}function If(f,i,a,h,p,g,x){const w=f.context,T=w.gl,A=a.fbo;if(!A)return;const M=f.useProgram("hillshade"),D=f.style.map.terrain&&f.style.map.terrain.getTerrainData(i);w.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,A.colorAttachment.get()),M.draw(w,T.TRIANGLES,p,g,x,Qi.disabled,((F,Z,G,Y)=>{const $=G.paint.get("hillshade-shadow-color"),lt=G.paint.get("hillshade-highlight-color"),yt=G.paint.get("hillshade-accent-color");let Q=G.paint.get("hillshade-illumination-direction")*(Math.PI/180);G.paint.get("hillshade-illumination-anchor")==="viewport"&&(Q-=F.transform.angle);const ut=!F.options.moving;return{u_matrix:Y?Y.posMatrix:F.transform.calculatePosMatrix(Z.tileID.toUnwrapped(),ut),u_image:0,u_latrange:Qc(0,Z.tileID),u_light:[G.paint.get("hillshade-exaggeration"),Q],u_shadow:$,u_highlight:lt,u_accent:yt}})(f,a,h,D?i:null),D,h.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}function gu(f,i,a,h,p,g){const x=f.context,w=x.gl,T=i.dem;if(T&&T.data){const A=T.dim,M=T.stride,D=T.getPixels();if(x.activeTexture.set(w.TEXTURE1),x.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||f.getTileTexture(M),i.demTexture){const Z=i.demTexture;Z.update(D,{premultiply:!1}),Z.bind(w.NEAREST,w.CLAMP_TO_EDGE)}else i.demTexture=new Ut(x,D,w.RGBA,{premultiply:!1}),i.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);x.activeTexture.set(w.TEXTURE0);let F=i.fbo;if(!F){const Z=new Ut(x,{width:A,height:A,data:null},w.RGBA);Z.bind(w.LINEAR,w.CLAMP_TO_EDGE),F=i.fbo=x.createFramebuffer(A,A,!0,!1),F.colorAttachment.set(Z.texture)}x.bindFramebuffer.set(F.framebuffer),x.viewport.set([0,0,A,A]),f.useProgram("hillshadePrepare").draw(x,w.TRIANGLES,h,p,g,Qi.disabled,((Z,G)=>{const Y=G.stride,$=l.Z();return l.aS($,0,l.N,-l.N,0,0,1),l.$($,$,[0,-l.N,0]),{u_matrix:$,u_image:1,u_dimension:[Y,Y],u_zoom:Z.overscaledZ,u_unpack:G.getUnpackVector()}})(i.tileID,T),null,a.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments),i.needsHillshadePrepare=!1}}function Tf(f,i,a,h,p,g){const x=h.paint.get("raster-fade-duration");if(!g&&x>0){const w=l.h.now(),T=(w-f.timeAdded)/x,A=i?(w-i.timeAdded)/x:-1,M=a.getSource(),D=p.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),F=!i||Math.abs(i.tileID.overscaledZ-D)>Math.abs(f.tileID.overscaledZ-D),Z=F&&f.refreshedUponExpiration?1:l.ad(F?T:1-A,0,1);return f.refreshedUponExpiration&&T>=1&&(f.refreshedUponExpiration=!1),i?{opacity:1,mix:1-Z}:{opacity:Z,mix:0}}return{opacity:1,mix:0}}const Xh=new l.aT(1,0,0,1),Wl=new l.aT(0,1,0,1),yu=new l.aT(0,0,1,1),Jh=new l.aT(1,0,1,1),Qh=new l.aT(0,1,1,1);function Qa(f,i,a,h){Yl(f,0,i+a/2,f.transform.width,a,h)}function Hl(f,i,a,h){Yl(f,i-a/2,0,a,f.transform.height,h)}function Yl(f,i,a,h,p,g){const x=f.context,w=x.gl;w.enable(w.SCISSOR_TEST),w.scissor(i*f.pixelRatio,a*f.pixelRatio,h*f.pixelRatio,p*f.pixelRatio),x.clear({color:g}),w.disable(w.SCISSOR_TEST)}function td(f,i,a){const h=f.context,p=h.gl,g=a.posMatrix,x=f.useProgram("debug"),w=hi.disabled,T=sr.disabled,A=f.colorModeForRenderPass(),M="$debug",D=f.style.map.terrain&&f.style.map.terrain.getTerrainData(a);h.activeTexture.set(p.TEXTURE0);const F=i.getTileByID(a.key).latestRawTileData,Z=Math.floor((F&&F.byteLength||0)/1024),G=i.getTile(a).tileSize,Y=512/Math.min(G,512)*(a.overscaledZ/f.transform.zoom)*.5;let $=a.canonical.toString();a.overscaledZ!==a.canonical.z&&($+=` => ${a.overscaledZ}`),function(lt,yt){lt.initDebugOverlayCanvas();const Q=lt.debugOverlayCanvas,ut=lt.context.gl,xt=lt.debugOverlayCanvas.getContext("2d");xt.clearRect(0,0,Q.width,Q.height),xt.shadowColor="white",xt.shadowBlur=2,xt.lineWidth=1.5,xt.strokeStyle="white",xt.textBaseline="top",xt.font="bold 36px Open Sans, sans-serif",xt.fillText(yt,5,5),xt.strokeText(yt,5,5),lt.debugOverlayTexture.update(Q),lt.debugOverlayTexture.bind(ut.LINEAR,ut.CLAMP_TO_EDGE)}(f,`${$} ${Z}kB`),x.draw(h,p.TRIANGLES,w,T,nr.alphaBlended,Qi.disabled,Wa(g,l.aT.transparent,Y),null,M,f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments),x.draw(h,p.LINE_STRIP,w,T,A,Qi.disabled,Wa(g,l.aT.red),D,M,f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments)}function hr(f,i,a){const h=f.context,p=h.gl,g=f.colorModeForRenderPass(),x=new hi(p.LEQUAL,hi.ReadWrite,f.depthRangeFor3D),w=f.useProgram("terrain"),T=i.getTerrainMesh();h.bindFramebuffer.set(null),h.viewport.set([0,0,f.width,f.height]);for(const A of a){const M=f.renderToTexture.getTexture(A),D=i.getTerrainData(A.tileID);h.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,M.texture);const F={u_matrix:f.transform.calculatePosMatrix(A.tileID.toUnwrapped()),u_texture:0,u_ele_delta:i.getMeshFrameDelta(f.transform.zoom)};w.draw(h,p.TRIANGLES,x,sr.disabled,g,Qi.backCCW,F,D,"terrain",T.vertexBuffer,T.indexBuffer,T.segments)}}class Ro{constructor(i,a){this.context=new Sf(i),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.Z(),renderTime:0},this.setup(),this.numSublayers=Ar.maxUnderzooming+Ar.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new El}resize(i,a,h){if(this.width=Math.floor(i*h),this.height=Math.floor(a*h),this.pixelRatio=h,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style._order)this.style._layers[p].resize()}setup(){const i=this.context,a=new l.a_;a.emplaceBack(0,0),a.emplaceBack(l.N,0),a.emplaceBack(0,l.N),a.emplaceBack(l.N,l.N),this.tileExtentBuffer=i.createVertexBuffer(a,Cl.members),this.tileExtentSegments=l.S.simpleSegment(0,0,4,2);const h=new l.a_;h.emplaceBack(0,0),h.emplaceBack(l.N,0),h.emplaceBack(0,l.N),h.emplaceBack(l.N,l.N),this.debugBuffer=i.createVertexBuffer(h,Cl.members),this.debugSegments=l.S.simpleSegment(0,0,4,5);const p=new l.V;p.emplaceBack(0,0,0,0),p.emplaceBack(l.N,0,l.N,0),p.emplaceBack(0,l.N,0,l.N),p.emplaceBack(l.N,l.N,l.N,l.N),this.rasterBoundsBuffer=i.createVertexBuffer(p,ze.members),this.rasterBoundsSegments=l.S.simpleSegment(0,0,4,2);const g=new l.a_;g.emplaceBack(0,0),g.emplaceBack(1,0),g.emplaceBack(0,1),g.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(g,Cl.members),this.viewportSegments=l.S.simpleSegment(0,0,4,2);const x=new l.a$;x.emplaceBack(0),x.emplaceBack(1),x.emplaceBack(3),x.emplaceBack(2),x.emplaceBack(0),this.tileBorderIndexBuffer=i.createIndexBuffer(x);const w=new l.b0;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(w);const T=this.context.gl;this.stencilClearMode=new sr({func:T.ALWAYS,mask:0},0,255,T.ZERO,T.ZERO,T.ZERO)}clearStencil(){const i=this.context,a=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const h=l.Z();l.aS(h,0,this.width,this.height,0,0,1),l.a0(h,h,[a.drawingBufferWidth,a.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(i,a.TRIANGLES,hi.disabled,this.stencilClearMode,nr.disabled,Qi.disabled,Oh(h),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(i,a){if(this.currentStencilSource===i.source||!i.isTileClipped()||!a||!a.length)return;this.currentStencilSource=i.source;const h=this.context,p=h.gl;this.nextStencilID+a.length>256&&this.clearStencil(),h.setColorMode(nr.disabled),h.setDepthMode(hi.disabled);const g=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const x of a){const w=this._tileClippingMaskIDs[x.key]=this.nextStencilID++,T=this.style.map.terrain&&this.style.map.terrain.getTerrainData(x);g.draw(h,p.TRIANGLES,hi.disabled,new sr({func:p.ALWAYS,mask:0},w,255,p.KEEP,p.KEEP,p.REPLACE),nr.disabled,Qi.disabled,Oh(x.posMatrix),T,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,a=this.context.gl;return new sr({func:a.NOTEQUAL,mask:255},i,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(i){const a=this.context.gl;return new sr({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(i){const a=this.context.gl,h=i.sort((x,w)=>w.overscaledZ-x.overscaledZ),p=h[h.length-1].overscaledZ,g=h[0].overscaledZ-p+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const x={};for(let w=0;w<g;w++)x[w+p]=new sr({func:a.GEQUAL,mask:255},w+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=g,[x,h]}return[{[p]:sr.disabled},h]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new nr([i.CONSTANT_COLOR,i.ONE],new l.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?nr.unblended:nr.alphaBlended}depthModeForSublayer(i,a,h){if(!this.opaquePassEnabledForLayer())return hi.disabled;const p=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new hi(h||this.context.gl.LEQUAL,a,[p,p])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,a){this.style=i,this.options=a,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(l.h.now()),this.imageManager.beginFrame();const h=this.style._order,p=this.style.sourceCaches,g={},x={},w={};for(const T in p){const A=p[T];A.used&&A.prepare(this.context),g[T]=A.getVisibleCoordinates(),x[T]=g[T].slice().reverse(),w[T]=A.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let T=0;T<h.length;T++)if(this.style._layers[h[T]].is3D()){this.opaquePassCutoff=T;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const T=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!l.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||T.length)&&(l.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(A,M){const D=A.context,F=D.gl,Z=nr.unblended,G=new hi(F.LEQUAL,hi.ReadWrite,[0,1]),Y=M.getTerrainMesh(),$=M.sourceCache.getRenderableTiles(),lt=A.useProgram("terrainDepth");D.bindFramebuffer.set(M.getFramebuffer("depth").framebuffer),D.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),D.clear({color:l.aT.transparent,depth:1});for(const yt of $){const Q=M.getTerrainData(yt.tileID),ut={u_matrix:A.transform.calculatePosMatrix(yt.tileID.toUnwrapped()),u_ele_delta:M.getMeshFrameDelta(A.transform.zoom)};lt.draw(D,F.TRIANGLES,G,sr.disabled,Z,Qi.backCCW,ut,Q,"terrain",Y.vertexBuffer,Y.indexBuffer,Y.segments)}D.bindFramebuffer.set(null),D.viewport.set([0,0,A.width,A.height])}(this,this.style.map.terrain),function(A,M){const D=A.context,F=D.gl,Z=nr.unblended,G=new hi(F.LEQUAL,hi.ReadWrite,[0,1]),Y=M.getTerrainMesh(),$=M.getCoordsTexture(),lt=M.sourceCache.getRenderableTiles(),yt=A.useProgram("terrainCoords");D.bindFramebuffer.set(M.getFramebuffer("coords").framebuffer),D.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),D.clear({color:l.aT.transparent,depth:1}),M.coordsIndex=[];for(const Q of lt){const ut=M.getTerrainData(Q.tileID);D.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,$.texture);const xt={u_matrix:A.transform.calculatePosMatrix(Q.tileID.toUnwrapped()),u_terrain_coords_id:(255-M.coordsIndex.length)/255,u_texture:0,u_ele_delta:M.getMeshFrameDelta(A.transform.zoom)};yt.draw(D,F.TRIANGLES,G,sr.disabled,Z,Qi.backCCW,xt,ut,"terrain",Y.vertexBuffer,Y.indexBuffer,Y.segments),M.coordsIndex.push(Q.tileID.key)}D.bindFramebuffer.set(null),D.viewport.set([0,0,A.width,A.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const T of h){const A=this.style._layers[T];if(!A.hasOffscreenPass()||A.isHidden(this.transform.zoom))continue;const M=x[A.source];(A.type==="custom"||M.length)&&this.renderLayer(this,p[A.source],A,M)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?l.aT.black:l.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(i._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){const T=this.style._layers[h[this.currentLayer]],A=p[T.source],M=g[T.source];this._renderTileClippingMasks(T,M),this.renderLayer(this,A,T,M)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){const T=this.style._layers[h[this.currentLayer]],A=p[T.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(T))continue;const M=(T.type==="symbol"?w:x)[T.source];this._renderTileClippingMasks(T,g[T.source]),this.renderLayer(this,A,T,M)}if(this.options.showTileBoundaries){const T=function(A,M){let D=null;const F=Object.values(A._layers).flatMap($=>$.source&&!$.isHidden(M)?[A.sourceCaches[$.source]]:[]),Z=F.filter($=>$.getSource().type==="vector"),G=F.filter($=>$.getSource().type!=="vector"),Y=$=>{(!D||D.getSource().maxzoom<$.getSource().maxzoom)&&(D=$)};return Z.forEach($=>Y($)),D||G.forEach($=>Y($)),D}(this.style,this.transform.zoom);T&&function(A,M,D){for(let F=0;F<D.length;F++)td(A,M,D[F])}(this,T,T.getVisibleCoordinates())}this.options.showPadding&&function(T){const A=T.transform.padding;Qa(T,T.transform.height-(A.top||0),3,Xh),Qa(T,A.bottom||0,3,Wl),Hl(T,A.left||0,3,yu),Hl(T,T.transform.width-(A.right||0),3,Jh);const M=T.transform.centerPoint;(function(D,F,Z,G){Yl(D,F-1,Z-10,2,20,G),Yl(D,F-10,Z-1,20,2,G)})(T,M.x,T.transform.height-M.y,Qh)}(this),this.context.setDefault()}renderLayer(i,a,h,p){if(!h.isHidden(this.transform.zoom)&&(h.type==="background"||h.type==="custom"||(p||[]).length))switch(this.id=h.id,h.type){case"symbol":(function(g,x,w,T,A){if(g.renderPass!=="translucent")return;const M=sr.disabled,D=g.colorModeForRenderPass();(w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(F,Z,G,Y,$,lt,yt){const Q=Z.transform,ut=$==="map",xt=lt==="map";for(const St of F){const Mt=Y.getTile(St),Ft=Mt.getBucket(G);if(!Ft||!Ft.text||!Ft.text.segments.get().length)continue;const zt=l.ah(Ft.textSizeData,Q.zoom),$t=at(Mt,1,Z.transform.zoom),pe=Gt(St.posMatrix,xt,ut,Z.transform,$t),ri=G.layout.get("icon-text-fit")!=="none"&&Ft.hasIconData();if(zt){const Yt=Math.pow(2,Q.zoom-Mt.tileID.overscaledZ);Gl(Ft,ut,xt,yt,Q,pe,St.posMatrix,Yt,zt,ri,Z.style.map.terrain?(Ee,ge)=>Z.style.map.terrain.getElevation(St,Ee,ge):null)}}}(T,g,w,x,w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),A),w.paint.get("icon-opacity").constantOr(1)!==0&&Zl(g,x,w,T,!1,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),w.layout.get("icon-rotation-alignment"),w.layout.get("icon-pitch-alignment"),w.layout.get("icon-keep-upright"),M,D),w.paint.get("text-opacity").constantOr(1)!==0&&Zl(g,x,w,T,!0,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.layout.get("text-keep-upright"),M,D),x.map.showCollisionBoxes&&(Kh(g,x,w,T,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),!0),Kh(g,x,w,T,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),!1))})(i,a,h,p,this.style.placement.variableOffsets);break;case"circle":(function(g,x,w,T){if(g.renderPass!=="translucent")return;const A=w.paint.get("circle-opacity"),M=w.paint.get("circle-stroke-width"),D=w.paint.get("circle-stroke-opacity"),F=!w.layout.get("circle-sort-key").isConstant();if(A.constantOr(1)===0&&(M.constantOr(1)===0||D.constantOr(1)===0))return;const Z=g.context,G=Z.gl,Y=g.depthModeForSublayer(0,hi.ReadOnly),$=sr.disabled,lt=g.colorModeForRenderPass(),yt=[];for(let Q=0;Q<T.length;Q++){const ut=T[Q],xt=x.getTile(ut),St=xt.getBucket(w);if(!St)continue;const Mt=St.programConfigurations.get(w.id),Ft=g.useProgram("circle",Mt),zt=St.layoutVertexBuffer,$t=St.indexBuffer,pe=g.style.map.terrain&&g.style.map.terrain.getTerrainData(ut),ri={programConfiguration:Mt,program:Ft,layoutVertexBuffer:zt,indexBuffer:$t,uniformValues:oo(g,ut,xt,w),terrainData:pe};if(F){const Yt=St.segments.get();for(const Ee of Yt)yt.push({segments:new l.S([Ee]),sortKey:Ee.sortKey,state:ri})}else yt.push({segments:St.segments,sortKey:0,state:ri})}F&&yt.sort((Q,ut)=>Q.sortKey-ut.sortKey);for(const Q of yt){const{programConfiguration:ut,program:xt,layoutVertexBuffer:St,indexBuffer:Mt,uniformValues:Ft,terrainData:zt}=Q.state;xt.draw(Z,G.TRIANGLES,Y,$,lt,Qi.disabled,Ft,zt,w.id,St,Mt,Q.segments,w.paint,g.transform.zoom,ut)}})(i,a,h,p);break;case"heatmap":(function(g,x,w,T){if(w.paint.get("heatmap-opacity")!==0)if(g.renderPass==="offscreen"){const A=g.context,M=A.gl,D=sr.disabled,F=new nr([M.ONE,M.ONE],l.aT.transparent,[!0,!0,!0,!0]);(function(Z,G,Y){const $=Z.gl;Z.activeTexture.set($.TEXTURE1),Z.viewport.set([0,0,G.width/4,G.height/4]);let lt=Y.heatmapFbo;if(lt)$.bindTexture($.TEXTURE_2D,lt.colorAttachment.get()),Z.bindFramebuffer.set(lt.framebuffer);else{const yt=$.createTexture();$.bindTexture($.TEXTURE_2D,yt),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MIN_FILTER,$.LINEAR),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MAG_FILTER,$.LINEAR),lt=Y.heatmapFbo=Z.createFramebuffer(G.width/4,G.height/4,!1,!1),function(Q,ut,xt,St){var Mt,Ft;const zt=Q.gl,$t=(Mt=Q.HALF_FLOAT)!==null&&Mt!==void 0?Mt:zt.UNSIGNED_BYTE,pe=(Ft=Q.RGBA16F)!==null&&Ft!==void 0?Ft:zt.RGBA;zt.texImage2D(zt.TEXTURE_2D,0,pe,ut.width/4,ut.height/4,0,zt.RGBA,$t,null),St.colorAttachment.set(xt)}(Z,G,yt,lt)}})(A,g,w),A.clear({color:l.aT.transparent});for(let Z=0;Z<T.length;Z++){const G=T[Z];if(x.hasRenderableParent(G))continue;const Y=x.getTile(G),$=Y.getBucket(w);if(!$)continue;const lt=$.programConfigurations.get(w.id),yt=g.useProgram("heatmap",lt),{zoom:Q}=g.transform;yt.draw(A,M.TRIANGLES,hi.disabled,D,F,Qi.disabled,mf(G.posMatrix,Y,Q,w.paint.get("heatmap-intensity")),null,w.id,$.layoutVertexBuffer,$.indexBuffer,$.segments,w.paint,g.transform.zoom,lt)}A.viewport.set([0,0,g.width,g.height])}else g.renderPass==="translucent"&&(g.context.setColorMode(g.colorModeForRenderPass()),function(A,M){const D=A.context,F=D.gl,Z=M.heatmapFbo;if(!Z)return;D.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,Z.colorAttachment.get()),D.activeTexture.set(F.TEXTURE1);let G=M.colorRampTexture;G||(G=M.colorRampTexture=new Ut(D,M.colorRamp,F.RGBA)),G.bind(F.LINEAR,F.CLAMP_TO_EDGE),A.useProgram("heatmapTexture").draw(D,F.TRIANGLES,hi.disabled,sr.disabled,A.colorModeForRenderPass(),Qi.disabled,((Y,$,lt,yt)=>{const Q=l.Z();l.aS(Q,0,Y.width,Y.height,0,0,1);const ut=Y.context.gl;return{u_matrix:Q,u_world:[ut.drawingBufferWidth,ut.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:$.paint.get("heatmap-opacity")}})(A,M),null,M.id,A.viewportBuffer,A.quadTriangleIndexBuffer,A.viewportSegments,M.paint,A.transform.zoom)}(g,w))})(i,a,h,p);break;case"line":(function(g,x,w,T){if(g.renderPass!=="translucent")return;const A=w.paint.get("line-opacity"),M=w.paint.get("line-width");if(A.constantOr(1)===0||M.constantOr(1)===0)return;const D=g.depthModeForSublayer(0,hi.ReadOnly),F=g.colorModeForRenderPass(),Z=w.paint.get("line-dasharray"),G=w.paint.get("line-pattern"),Y=G.constantOr(1),$=w.paint.get("line-gradient"),lt=w.getCrossfadeParameters(),yt=Y?"linePattern":Z?"lineSDF":$?"lineGradient":"line",Q=g.context,ut=Q.gl;let xt=!0;for(const St of T){const Mt=x.getTile(St);if(Y&&!Mt.patternsLoaded())continue;const Ft=Mt.getBucket(w);if(!Ft)continue;const zt=Ft.programConfigurations.get(w.id),$t=g.context.program.get(),pe=g.useProgram(yt,zt),ri=xt||pe.program!==$t,Yt=g.style.map.terrain&&g.style.map.terrain.getTerrainData(St),Ee=G.constantOr(null);if(Ee&&Mt.imageAtlas){const ii=Mt.imageAtlas,Ye=ii.patternPositions[Ee.to.toString()],ni=ii.patternPositions[Ee.from.toString()];Ye&&ni&&zt.setConstantPatternPositions(Ye,ni)}const ge=Yt?St:null,Pi=Y?gf(g,Mt,w,lt,ge):Z?Uh(g,Mt,w,Z,lt,ge):$?Nh(g,Mt,w,Ft.lineClipsArray.length,ge):tu(g,Mt,w,ge);if(Y)Q.activeTexture.set(ut.TEXTURE0),Mt.imageAtlasTexture.bind(ut.LINEAR,ut.CLAMP_TO_EDGE),zt.updatePaintBuffers(lt);else if(Z&&(ri||g.lineAtlas.dirty))Q.activeTexture.set(ut.TEXTURE0),g.lineAtlas.bind(Q);else if($){const ii=Ft.gradients[w.id];let Ye=ii.texture;if(w.gradientVersion!==ii.version){let ni=256;if(w.stepInterpolant){const _r=x.getSource().maxzoom,ji=St.canonical.z===_r?Math.ceil(1<<g.transform.maxZoom-St.canonical.z):1;ni=l.ad(l.aY(Ft.maxLineLength/l.N*1024*ji),256,Q.maxTextureSize)}ii.gradient=l.aZ({expression:w.gradientExpression(),evaluationKey:"lineProgress",resolution:ni,image:ii.gradient||void 0,clips:Ft.lineClipsArray}),ii.texture?ii.texture.update(ii.gradient):ii.texture=new Ut(Q,ii.gradient,ut.RGBA),ii.version=w.gradientVersion,Ye=ii.texture}Q.activeTexture.set(ut.TEXTURE0),Ye.bind(w.stepInterpolant?ut.NEAREST:ut.LINEAR,ut.CLAMP_TO_EDGE)}pe.draw(Q,ut.TRIANGLES,D,g.stencilModeForClipping(St),F,Qi.disabled,Pi,Yt,w.id,Ft.layoutVertexBuffer,Ft.indexBuffer,Ft.segments,w.paint,g.transform.zoom,zt,Ft.layoutVertexBuffer2),xt=!1}})(i,a,h,p);break;case"fill":(function(g,x,w,T){const A=w.paint.get("fill-color"),M=w.paint.get("fill-opacity");if(M.constantOr(1)===0)return;const D=g.colorModeForRenderPass(),F=w.paint.get("fill-pattern"),Z=g.opaquePassEnabledForLayer()&&!F.constantOr(1)&&A.constantOr(l.aT.transparent).a===1&&M.constantOr(0)===1?"opaque":"translucent";if(g.renderPass===Z){const G=g.depthModeForSublayer(1,g.renderPass==="opaque"?hi.ReadWrite:hi.ReadOnly);Xa(g,x,w,T,G,D,!1)}if(g.renderPass==="translucent"&&w.paint.get("fill-antialias")){const G=g.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,hi.ReadOnly);Xa(g,x,w,T,G,D,!0)}})(i,a,h,p);break;case"fill-extrusion":(function(g,x,w,T){const A=w.paint.get("fill-extrusion-opacity");if(A!==0&&g.renderPass==="translucent"){const M=new hi(g.context.gl.LEQUAL,hi.ReadWrite,g.depthRangeFor3D);if(A!==1||w.paint.get("fill-extrusion-pattern").constantOr(1))Ja(g,x,w,T,M,sr.disabled,nr.disabled),Ja(g,x,w,T,M,g.stencilModeFor3D(),g.colorModeForRenderPass());else{const D=g.colorModeForRenderPass();Ja(g,x,w,T,M,sr.disabled,D)}}})(i,a,h,p);break;case"hillshade":(function(g,x,w,T){if(g.renderPass!=="offscreen"&&g.renderPass!=="translucent")return;const A=g.context,M=g.depthModeForSublayer(0,hi.ReadOnly),D=g.colorModeForRenderPass(),[F,Z]=g.renderPass==="translucent"?g.stencilConfigForOverlap(T):[{},T];for(const G of Z){const Y=x.getTile(G);Y.needsHillshadePrepare!==void 0&&Y.needsHillshadePrepare&&g.renderPass==="offscreen"?gu(g,Y,w,M,sr.disabled,D):g.renderPass==="translucent"&&If(g,G,Y,w,M,F[G.overscaledZ],D)}A.viewport.set([0,0,g.width,g.height])})(i,a,h,p);break;case"raster":(function(g,x,w,T){if(g.renderPass!=="translucent"||w.paint.get("raster-opacity")===0||!T.length)return;const A=g.context,M=A.gl,D=x.getSource(),F=g.useProgram("raster"),Z=g.colorModeForRenderPass(),[G,Y]=D instanceof Mi?[{},T]:g.stencilConfigForOverlap(T),$=Y[Y.length-1].overscaledZ,lt=!g.options.moving;for(const yt of Y){const Q=g.depthModeForSublayer(yt.overscaledZ-$,w.paint.get("raster-opacity")===1?hi.ReadWrite:hi.ReadOnly,M.LESS),ut=x.getTile(yt);ut.registerFadeDuration(w.paint.get("raster-fade-duration"));const xt=x.findLoadedParent(yt,0),St=Tf(ut,xt,x,w,g.transform,g.style.map.terrain);let Mt,Ft;const zt=w.paint.get("raster-resampling")==="nearest"?M.NEAREST:M.LINEAR;A.activeTexture.set(M.TEXTURE0),ut.texture.bind(zt,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),A.activeTexture.set(M.TEXTURE1),xt?(xt.texture.bind(zt,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),Mt=Math.pow(2,xt.tileID.overscaledZ-ut.tileID.overscaledZ),Ft=[ut.tileID.canonical.x*Mt%1,ut.tileID.canonical.y*Mt%1]):ut.texture.bind(zt,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST);const $t=g.style.map.terrain&&g.style.map.terrain.getTerrainData(yt),pe=$t?yt:null,ri=pe?pe.posMatrix:g.transform.calculatePosMatrix(yt.toUnwrapped(),lt),Yt=$h(ri,Ft||[0,0],Mt||1,St,w);D instanceof Mi?F.draw(A,M.TRIANGLES,Q,sr.disabled,Z,Qi.disabled,Yt,$t,w.id,D.boundsBuffer,g.quadTriangleIndexBuffer,D.boundsSegments):F.draw(A,M.TRIANGLES,Q,G[yt.overscaledZ],Z,Qi.disabled,Yt,$t,w.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments)}})(i,a,h,p);break;case"background":(function(g,x,w,T){const A=w.paint.get("background-color"),M=w.paint.get("background-opacity");if(M===0)return;const D=g.context,F=D.gl,Z=g.transform,G=Z.tileSize,Y=w.paint.get("background-pattern");if(g.isPatternMissing(Y))return;const $=!Y&&A.a===1&&M===1&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==$)return;const lt=sr.disabled,yt=g.depthModeForSublayer(0,$==="opaque"?hi.ReadWrite:hi.ReadOnly),Q=g.colorModeForRenderPass(),ut=g.useProgram(Y?"backgroundPattern":"background"),xt=T||Z.coveringTiles({tileSize:G,terrain:g.style.map.terrain});Y&&(D.activeTexture.set(F.TEXTURE0),g.imageManager.bind(g.context));const St=w.getCrossfadeParameters();for(const Mt of xt){const Ft=T?Mt.posMatrix:g.transform.calculatePosMatrix(Mt.toUnwrapped()),zt=Y?Qn(Ft,M,g,Y,{tileID:Mt,tileSize:G},St):zl(Ft,M,A),$t=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Mt);ut.draw(D,F.TRIANGLES,yt,lt,Q,Qi.disabled,zt,$t,w.id,g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}})(i,0,h,p);break;case"custom":(function(g,x,w){const T=g.context,A=w.implementation;if(g.renderPass==="offscreen"){const M=A.prerender;M&&(g.setCustomLayerDefaults(),T.setColorMode(g.colorModeForRenderPass()),M.call(A,T.gl,g.transform.customLayerMatrix()),T.setDirty(),g.setBaseState())}else if(g.renderPass==="translucent"){g.setCustomLayerDefaults(),T.setColorMode(g.colorModeForRenderPass()),T.setStencilMode(sr.disabled);const M=A.renderingMode==="3d"?new hi(g.context.gl.LEQUAL,hi.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,hi.ReadOnly);T.setDepthMode(M),A.render(T.gl,g.transform.customLayerMatrix()),T.setDirty(),g.setBaseState(),T.bindFramebuffer.set(null)}})(i,0,h)}}translatePosMatrix(i,a,h,p,g){if(!h[0]&&!h[1])return i;const x=g?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(x){const A=Math.sin(x),M=Math.cos(x);h=[h[0]*M-h[1]*A,h[0]*A+h[1]*M]}const w=[g?h[0]:at(a,h[0],this.transform.zoom),g?h[1]:at(a,h[1],this.transform.zoom),0],T=new Float32Array(16);return l.$(T,i,w),T}saveTileTexture(i){const a=this._tileTextures[i.size[0]];a?a.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const a=this._tileTextures[i];return a&&a.length>0?a.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;const a=this.imageManager.getPattern(i.from.toString()),h=this.imageManager.getPattern(i.to.toString());return!a||!h}useProgram(i,a){this.cache=this.cache||{};const h=i+(a?a.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[h]||(this.cache[h]=new Ml(this.context,rr[i],a,Bl[i],this._showOverdrawInspector,this.style.map.terrain)),this.cache[h]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Ut(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:i,drawingBufferHeight:a}=this.context.gl;return this.width!==i||this.height!==a}}class In{constructor(i,a){this.points=i,this.planes=a}static fromInvProjectionMatrix(i,a,h){const p=Math.pow(2,h),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const T=1/(w=l.ag([],w,i))[3]/a*p;return l.b3(w,w,[T,T,1/w[3],T])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const T=function(F,Z){var G=Z[0],Y=Z[1],$=Z[2],lt=G*G+Y*Y+$*$;return lt>0&&(lt=1/Math.sqrt(lt)),F[0]=Z[0]*lt,F[1]=Z[1]*lt,F[2]=Z[2]*lt,F}([],function(F,Z,G){var Y=Z[0],$=Z[1],lt=Z[2],yt=G[0],Q=G[1],ut=G[2];return F[0]=$*ut-lt*Q,F[1]=lt*yt-Y*ut,F[2]=Y*Q-$*yt,F}([],Lt([],g[w[0]],g[w[1]]),Lt([],g[w[2]],g[w[1]]))),A=-((M=T)[0]*(D=g[w[1]])[0]+M[1]*D[1]+M[2]*D[2]);var M,D;return T.concat(A)});return new In(g,x)}}class fa{constructor(i,a){this.min=i,this.max=a,this.center=function(h,p,g){return h[0]=.5*p[0],h[1]=.5*p[1],h[2]=.5*p[2],h}([],function(h,p,g){return h[0]=p[0]+g[0],h[1]=p[1]+g[1],h[2]=p[2]+g[2],h}([],this.min,this.max))}quadrant(i){const a=[i%2==0,i<2],h=gt(this.min),p=gt(this.max);for(let g=0;g<a.length;g++)h[g]=a[g]?this.min[g]:this.center[g],p[g]=a[g]?this.center[g]:this.max[g];return p[2]=this.max[2],new fa(h,p)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}intersects(i){const a=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let h=!0;for(let p=0;p<i.planes.length;p++){const g=i.planes[p];let x=0;for(let w=0;w<a.length;w++)l.b4(g,a[w])>=0&&x++;if(x===0)return 0;x!==a.length&&(h=!1)}if(h)return 2;for(let p=0;p<3;p++){let g=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let w=0;w<i.points.length;w++){const T=i.points[w][p]-this.min[p];g=Math.min(g,T),x=Math.max(x,T)}if(x<0||g>this.max[p]-this.min[p])return 0}return 1}}class tl{constructor(i=0,a=0,h=0,p=0){if(isNaN(i)||i<0||isNaN(a)||a<0||isNaN(h)||h<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=a,this.left=h,this.right=p}interpolate(i,a,h){return a.top!=null&&i.top!=null&&(this.top=l.B.number(i.top,a.top,h)),a.bottom!=null&&i.bottom!=null&&(this.bottom=l.B.number(i.bottom,a.bottom,h)),a.left!=null&&i.left!=null&&(this.left=l.B.number(i.left,a.left,h)),a.right!=null&&i.right!=null&&(this.right=l.B.number(i.right,a.right,h)),this}getCenter(i,a){const h=l.ad((this.left+i-this.right)/2,0,i),p=l.ad((this.top+a-this.bottom)/2,0,a);return new l.P(h,p)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new tl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Kl{constructor(i,a,h,p,g){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=g===void 0||!!g,this._minZoom=i||0,this._maxZoom=a||22,this._minPitch=h??0,this._maxPitch=p??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new tl,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const i=new Kl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return i.apply(this),i}apply(i){this.tileSize=i.tileSize,this.latRange=i.latRange,this.width=i.width,this.height=i.height,this._center=i._center,this._elevation=i._elevation,this._minEleveationForCurrentTile=i._minEleveationForCurrentTile,this.zoom=i.zoom,this.angle=i.angle,this._fov=i._fov,this._pitch=i._pitch,this._unmodified=i._unmodified,this._edgeInsets=i._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(i){const a=-l.b5(i,-180,180)*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=function(){var h=new l.A(4);return l.A!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h}(),function(h,p,g){var x=p[0],w=p[1],T=p[2],A=p[3],M=Math.sin(g),D=Math.cos(g);h[0]=x*D+T*M,h[1]=w*D+A*M,h[2]=x*-M+T*D,h[3]=w*-M+A*D}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const a=l.ad(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(i){const a=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this.tileZoom=Math.max(0,Math.floor(a)),this.scale=this.zoomScale(a),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(i){i!==this._elevation&&(this._elevation=i,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,a,h){this._unmodified=!1,this._edgeInsets.interpolate(i,a,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const a=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(i){const a=[new l.b6(0,i)];if(this._renderWorldCopies){const h=this.pointCoordinate(new l.P(0,0)),p=this.pointCoordinate(new l.P(this.width,0)),g=this.pointCoordinate(new l.P(this.width,this.height)),x=this.pointCoordinate(new l.P(0,this.height)),w=Math.floor(Math.min(h.x,p.x,g.x,x.x)),T=Math.floor(Math.max(h.x,p.x,g.x,x.x)),A=1;for(let M=w-A;M<=T+A;M++)M!==0&&a.push(new l.b6(M,i))}return a}coveringTiles(i){var a,h;let p=this.coveringZoomLevel(i);const g=p;if(i.minzoom!==void 0&&p<i.minzoom)return[];i.maxzoom!==void 0&&p>i.maxzoom&&(p=i.maxzoom);const x=this.pointCoordinate(this.getCameraPoint()),w=l.U.fromLngLat(this.center),T=Math.pow(2,p),A=[T*x.x,T*x.y,0],M=[T*w.x,T*w.y,0],D=In.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,p);let F=i.minzoom||0;!i.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(F=p);const Z=i.terrain?2/Math.min(this.tileSize,i.tileSize)*this.tileSize:3,G=Q=>({aabb:new fa([Q*T,0,0],[(Q+1)*T,T,0]),zoom:0,x:0,y:0,wrap:Q,fullyVisible:!1}),Y=[],$=[],lt=p,yt=i.reparseOverscaled?g:p;if(this._renderWorldCopies)for(let Q=1;Q<=3;Q++)Y.push(G(-Q)),Y.push(G(Q));for(Y.push(G(0));Y.length>0;){const Q=Y.pop(),ut=Q.x,xt=Q.y;let St=Q.fullyVisible;if(!St){const pe=Q.aabb.intersects(D);if(pe===0)continue;St=pe===2}const Mt=i.terrain?A:M,Ft=Q.aabb.distanceX(Mt),zt=Q.aabb.distanceY(Mt),$t=Math.max(Math.abs(Ft),Math.abs(zt));if(Q.zoom===lt||$t>Z+(1<<lt-Q.zoom)-2&&Q.zoom>=F){const pe=lt-Q.zoom,ri=A[0]-.5-(ut<<pe),Yt=A[1]-.5-(xt<<pe);$.push({tileID:new l.O(Q.zoom===lt?yt:Q.zoom,Q.wrap,Q.zoom,ut,xt),distanceSq:Vt([M[0]-.5-ut,M[1]-.5-xt]),tileDistanceToCamera:Math.sqrt(ri*ri+Yt*Yt)})}else for(let pe=0;pe<4;pe++){const ri=(ut<<1)+pe%2,Yt=(xt<<1)+(pe>>1),Ee=Q.zoom+1;let ge=Q.aabb.quadrant(pe);if(i.terrain){const Pi=new l.O(Ee,Q.wrap,Ee,ri,Yt),ii=i.terrain.getMinMaxElevation(Pi),Ye=(a=ii.minElevation)!==null&&a!==void 0?a:this.elevation,ni=(h=ii.maxElevation)!==null&&h!==void 0?h:this.elevation;ge=new fa([ge.min[0],ge.min[1],Ye],[ge.max[0],ge.max[1],ni])}Y.push({aabb:ge,zoom:Ee,x:ri,y:Yt,wrap:Q.wrap,fullyVisible:St})}}return $.sort((Q,ut)=>Q.distanceSq-ut.distanceSq).map(Q=>Q.tileID)}resize(i,a){this.width=i,this.height=a,this.pixelsToGLUnits=[2/i,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const a=l.ad(i.lat,-this.maxValidLatitude,this.maxValidLatitude);return new l.P(l.G(i.lng)*this.worldSize,l.H(a)*this.worldSize)}unproject(i){return new l.U(i.x/this.worldSize,i.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(i){const a=this.pointLocation(this.centerPoint,i),h=i.getElevationForLngLatZoom(a,this.tileZoom);if(!(this.elevation-h))return;const p=this.getCameraPosition(),g=l.U.fromLngLat(p.lngLat,p.altitude),x=l.U.fromLngLat(a,h),w=g.x-x.x,T=g.y-x.y,A=g.z-x.z,M=Math.sqrt(w*w+T*T+A*A),D=this.scaleZoom(this.cameraToCenterDistance/M/this.tileSize);this._elevation=h,this._center=a,this.zoom=D}setLocationAtPoint(i,a){const h=this.pointCoordinate(a),p=this.pointCoordinate(this.centerPoint),g=this.locationCoordinate(i),x=new l.U(g.x-(h.x-p.x),g.y-(h.y-p.y));this.center=this.coordinateLocation(x),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(i,a){return a?this.coordinatePoint(this.locationCoordinate(i),a.getElevationForLngLatZoom(i,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(i))}pointLocation(i,a){return this.coordinateLocation(this.pointCoordinate(i,a))}locationCoordinate(i){return l.U.fromLngLat(i)}coordinateLocation(i){return i&&i.toLngLat()}pointCoordinate(i,a){if(a){const F=a.pointCoordinate(i);if(F!=null)return F}const h=[i.x,i.y,0,1],p=[i.x,i.y,1,1];l.ag(h,h,this.pixelMatrixInverse),l.ag(p,p,this.pixelMatrixInverse);const g=h[3],x=p[3],w=h[1]/g,T=p[1]/x,A=h[2]/g,M=p[2]/x,D=A===M?0:(0-A)/(M-A);return new l.U(l.B.number(h[0]/g,p[0]/x,D)/this.worldSize,l.B.number(w,T,D)/this.worldSize)}coordinatePoint(i,a=0,h=this.pixelMatrix){const p=[i.x*this.worldSize,i.y*this.worldSize,a,1];return l.ag(p,p,h),new l.P(p[0]/p[3],p[1]/p[3])}getBounds(){const i=Math.max(0,this.height/2-this.getHorizon());return new di().extend(this.pointLocation(new l.P(0,i))).extend(this.pointLocation(new l.P(this.width,i))).extend(this.pointLocation(new l.P(this.width,this.height))).extend(this.pointLocation(new l.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new di([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(i){i?(this.lngRange=[i.getWest(),i.getEast()],this.latRange=[i.getSouth(),i.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(i,a=!1){const h=i.key,p=a?this._alignedPosMatrixCache:this._posMatrixCache;if(p[h])return p[h];const g=i.canonical,x=this.worldSize/this.zoomScale(g.z),w=g.x+Math.pow(2,g.z)*i.wrap,T=l.ao(new Float64Array(16));return l.$(T,T,[w*x,g.y*x,0]),l.a0(T,T,[x/l.N,x/l.N,1]),l.a1(T,a?this.alignedProjMatrix:this.projMatrix,T),p[h]=new Float32Array(T),p[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let i,a,h,p,g=-90,x=90,w=-180,T=180;const A=this.size,M=this._unmodified;if(this.latRange){const Z=this.latRange;g=l.H(Z[1])*this.worldSize,x=l.H(Z[0])*this.worldSize,i=x-g<A.y?A.y/(x-g):0}if(this.lngRange){const Z=this.lngRange;w=l.b5(l.G(Z[0])*this.worldSize,0,this.worldSize),T=l.b5(l.G(Z[1])*this.worldSize,0,this.worldSize),T<w&&(T+=this.worldSize),a=T-w<A.x?A.x/(T-w):0}const D=this.point,F=Math.max(a||0,i||0);if(F)return this.center=this.unproject(new l.P(a?(T+w)/2:D.x,i?(x+g)/2:D.y)),this.zoom+=this.scaleZoom(F),this._unmodified=M,void(this._constraining=!1);if(this.latRange){const Z=D.y,G=A.y/2;Z-G<g&&(p=g+G),Z+G>x&&(p=x-G)}if(this.lngRange){const Z=(w+T)/2,G=l.b5(D.x,Z-this.worldSize/2,Z+this.worldSize/2),Y=A.x/2;G-Y<w&&(h=w+Y),G+Y>T&&(h=T-Y)}h===void 0&&p===void 0||(this.center=this.unproject(new l.P(h!==void 0?h:D.x,p!==void 0?p:D.y)).wrap()),this._unmodified=M,this._constraining=!1}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,a=this.point.x,h=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.b7(1,this.center.lat)*this.worldSize;let p=l.ao(new Float64Array(16));l.a0(p,p,[this.width/2,-this.height/2,1]),l.$(p,p,[1,-1,0]),this.labelPlaneMatrix=p,p=l.ao(new Float64Array(16)),l.a0(p,p,[1,-1,1]),l.$(p,p,[-1,-1,0]),l.a0(p,p,[2/this.width,2/this.height,1]),this.glCoordMatrix=p;const g=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),x=Math.min(this.elevation,this._minEleveationForCurrentTile),w=g-x*this._pixelPerMeter/Math.cos(this._pitch),T=x<0?w:g,A=Math.PI/2+this._pitch,M=this._fov*(.5+i.y/this.height),D=Math.sin(M)*T/Math.sin(l.ad(Math.PI-A-M,.01,Math.PI-.01)),F=this.getHorizon(),Z=2*Math.atan(F/this.cameraToCenterDistance)*(.5+i.y/(2*F)),G=Math.sin(Z)*T/Math.sin(l.ad(Math.PI-A-Z,.01,Math.PI-.01)),Y=Math.min(D,G),$=1.01*(Math.cos(Math.PI/2-this._pitch)*Y+T),lt=this.height/50;p=new Float64Array(16),l.b8(p,this._fov,this.width/this.height,lt,$),p[8]=2*-i.x/this.width,p[9]=2*i.y/this.height,l.a0(p,p,[1,-1,1]),l.$(p,p,[0,0,-this.cameraToCenterDistance]),l.b9(p,p,this._pitch),l.ae(p,p,this.angle),l.$(p,p,[-a,-h,0]),this.mercatorMatrix=l.a0([],p,[this.worldSize,this.worldSize,this.worldSize]),l.a0(p,p,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.a1(new Float64Array(16),this.labelPlaneMatrix,p),l.$(p,p,[0,0,-this.elevation]),this.projMatrix=p,this.invProjMatrix=l.as([],p),this.pixelMatrix3D=l.a1(new Float64Array(16),this.labelPlaneMatrix,p);const yt=this.width%2/2,Q=this.height%2/2,ut=Math.cos(this.angle),xt=Math.sin(this.angle),St=a-Math.round(a)+ut*yt+xt*Q,Mt=h-Math.round(h)+ut*Q+xt*yt,Ft=new Float64Array(p);if(l.$(Ft,Ft,[St>.5?St-1:St,Mt>.5?Mt-1:Mt,0]),this.alignedProjMatrix=Ft,p=l.as(new Float64Array(16),this.pixelMatrix),!p)throw new Error("failed to invert matrix");this.pixelMatrixInverse=p,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const i=this.pointCoordinate(new l.P(0,0)),a=[i.x*this.worldSize,i.y*this.worldSize,0,1];return l.ag(a,a,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(0,i))}getCameraQueryGeometry(i){const a=this.getCameraPoint();if(i.length===1)return[i[0],a];{let h=a.x,p=a.y,g=a.x,x=a.y;for(const w of i)h=Math.min(h,w.x),p=Math.min(p,w.y),g=Math.max(g,w.x),x=Math.max(x,w.y);return[new l.P(h,p),new l.P(g,p),new l.P(g,x),new l.P(h,x),new l.P(h,p)]}}}function Fo(f,i){let a,h=!1,p=null,g=null;const x=()=>{p=null,h&&(f.apply(g,a),p=setTimeout(x,i),h=!1)};return(...w)=>(h=!0,g=this,a=w,p||x(),p)}class el{constructor(i){this._getCurrentHash=()=>{const a=window.location.hash.replace("#","");if(this._hashName){let h;return a.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(h=p)}),(h&&h[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{const a=this._getCurrentHash();if(a.length>=3&&!a.some(h=>isNaN(h))){const h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:h,pitch:+(a[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const a=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,a)}catch{}},this._updateHash=Fo(this._updateHashUnthrottled,300),this._hashName=i&&encodeURIComponent(i)}addTo(i){return this._map=i,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(i){const a=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,p=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,p),x=Math.round(a.lng*g)/g,w=Math.round(a.lat*g)/g,T=this._map.getBearing(),A=this._map.getPitch();let M="";if(M+=i?`/${x}/${w}/${h}`:`${h}/${w}/${x}`,(T||A)&&(M+="/"+Math.round(10*T)/10),A&&(M+=`/${Math.round(A)}`),this._hashName){const D=this._hashName;let F=!1;const Z=window.location.hash.slice(1).split("&").map(G=>{const Y=G.split("=")[0];return Y===D?(F=!0,`${Y}=${M}`):G}).filter(G=>G);return F||Z.push(`${D}=${M}`),`#${Z.join("&")}`}return`#${M}`}}const ma={linearity:.3,easing:l.ba(0,0,.3,1)},ed=l.e({deceleration:2500,maxSpeed:1400},ma),id=l.e({deceleration:20,maxSpeed:1400},ma),rd=l.e({deceleration:1e3,maxSpeed:360},ma),nd=l.e({deceleration:1e3,maxSpeed:90},ma);class sd{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.h.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,a=l.h.now();for(;i.length>0&&a-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)a.zoom+=g.zoomDelta||0,a.bearing+=g.bearingDelta||0,a.pitch+=g.pitchDelta||0,g.panDelta&&a.pan._add(g.panDelta),g.around&&(a.around=g.around),g.pinchAround&&(a.pinchAround=g.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(a.pan.mag()){const g=il(a.pan.mag(),h,l.e({},ed,i||{}));p.offset=a.pan.mult(g.amount/a.pan.mag()),p.center=this._map.transform.center,xs(p,g)}if(a.zoom){const g=il(a.zoom,h,id);p.zoom=this._map.transform.zoom+g.amount,xs(p,g)}if(a.bearing){const g=il(a.bearing,h,rd);p.bearing=this._map.transform.bearing+l.ad(g.amount,-179,179),xs(p,g)}if(a.pitch){const g=il(a.pitch,h,nd);p.pitch=this._map.transform.pitch+g.amount,xs(p,g)}if(p.zoom||p.bearing){const g=a.pinchAround===void 0?a.around:a.pinchAround;p.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),l.e(p,{noMoveStart:!0})}}function xs(f,i){(!f.duration||f.duration<i.duration)&&(f.duration=i.duration,f.easing=i.easing)}function il(f,i,a){const{maxSpeed:h,linearity:p,deceleration:g}=a,x=l.ad(f*p/(i/1e3),-h,h),w=Math.abs(x)/(g*p);return{easing:a.easing,duration:1e3*w,amount:x*(w/2)}}class On extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,a,h,p={}){const g=E.mousePos(a.getCanvasContainer(),h),x=a.unproject(g);super(i,l.e({point:g,lngLat:x,originalEvent:h},p)),this._defaultPrevented=!1,this.target=a}}class rl extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,a,h){const p=i==="touchend"?h.changedTouches:h.touches,g=E.touchPos(a.getCanvasContainer(),p),x=g.map(T=>a.unproject(T)),w=g.reduce((T,A,M,D)=>T.add(A.div(D.length)),new l.P(0,0));super(i,{points:g,point:w,lngLats:x,lngLat:a.unproject(w),originalEvent:h}),this._defaultPrevented=!1}}class od extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,a,h){super(i,{originalEvent:h}),this._defaultPrevented=!1}}class ad{constructor(i,a){this._map=i,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(i){return this._firePreventable(new od(i.type,this._map,i))}mousedown(i,a){return this._mousedownPos=a,this._firePreventable(new On(i.type,this._map,i))}mouseup(i){this._map.fire(new On(i.type,this._map,i))}click(i,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new On(i.type,this._map,i))}dblclick(i){return this._firePreventable(new On(i.type,this._map,i))}mouseover(i){this._map.fire(new On(i.type,this._map,i))}mouseout(i){this._map.fire(new On(i.type,this._map,i))}touchstart(i){return this._firePreventable(new rl(i.type,this._map,i))}touchmove(i){this._map.fire(new rl(i.type,this._map,i))}touchend(i){this._map.fire(new rl(i.type,this._map,i))}touchcancel(i){this._map.fire(new rl(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ld{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(i){this._map.fire(new On(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new On("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._ignoreContextMenu||this._map.fire(new On(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Us{constructor(i){this._map=i}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(i){return this.transform.pointLocation(l.P.convert(i),this._map.terrain)}}class cd{constructor(i,a){this._map=i,this._tr=new Us(i),this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,a){this.isEnabled()&&i.shiftKey&&i.button===0&&(E.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(i,a){if(!this._active)return;const h=a;if(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)return;const p=this._startPos;this._lastPos=h,this._box||(this._box=E.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",i));const g=Math.min(p.x,h.x),x=Math.max(p.x,h.x),w=Math.min(p.y,h.y),T=Math.max(p.y,h.y);E.setTransform(this._box,`translate(${g}px,${w}px)`),this._box.style.width=x-g+"px",this._box.style.height=T-w+"px"}mouseupWindow(i,a){if(!this._active||i.button!==0)return;const h=this._startPos,p=a;if(this.reset(),E.suppressClick(),h.x!==p.x||h.y!==p.y)return this._map.fire(new l.k("boxzoomend",{originalEvent:i})),{cameraAnimation:g=>g.fitScreenCoordinates(h,p,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",i)}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(E.remove(this._box),this._box=null),E.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(i,a){return this._map.fire(new l.k(i,{originalEvent:a}))}}function ts(f,i){if(f.length!==i.length)throw new Error(`The number of touches and points are not equal - touches ${f.length}, points ${i.length}`);const a={};for(let h=0;h<f.length;h++)a[f[h].identifier]=i[h];return a}class Vs{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(i,a,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=i.timeStamp),h.length===this.numTouches&&(this.centroid=function(p){const g=new l.P(0,0);for(const x of p)g._add(x);return g.div(p.length)}(a),this.touches=ts(h,a)))}touchmove(i,a,h){if(this.aborted||!this.centroid)return;const p=ts(h,a);for(const g in this.touches){const x=p[g];(!x||x.dist(this.touches[g])>30)&&(this.aborted=!0)}}touchend(i,a,h){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class Xl{constructor(i){this.singleTap=new Vs(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(i,a,h){this.singleTap.touchstart(i,a,h)}touchmove(i,a,h){this.singleTap.touchmove(i,a,h)}touchend(i,a,h){const p=this.singleTap.touchend(i,a,h);if(p){const g=i.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(p)<30;if(g&&x||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class $s{constructor(i){this._tr=new Us(i),this._zoomIn=new Xl({numTouches:1,numTaps:2}),this._zoomOut=new Xl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,a,h){this._zoomIn.touchstart(i,a,h),this._zoomOut.touchstart(i,a,h)}touchmove(i,a,h){this._zoomIn.touchmove(i,a,h),this._zoomOut.touchmove(i,a,h)}touchend(i,a,h){const p=this._zoomIn.touchend(i,a,h),g=this._zoomOut.touchend(i,a,h),x=this._tr;return p?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:x.zoom+1,around:x.unproject(p)},{originalEvent:i})}):g?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:x.zoom-1,around:x.unproject(g)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class js{constructor(i){this._enabled=!!i.enable,this._moveStateManager=i.moveStateManager,this._clickTolerance=i.clickTolerance||1,this._moveFunction=i.move,this._activateOnStart=!!i.activateOnStart,i.assignEvents(this),this.reset()}reset(i){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(i)}_move(...i){const a=this._moveFunction(...i);if(a.bearingDelta||a.pitchDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(i,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(i)&&(this._moveStateManager.startMove(i),this._lastPoint=a.length?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(i,a){if(!this.isEnabled())return;const h=this._lastPoint;if(!h)return;if(i.preventDefault(),!this._moveStateManager.isValidMoveEvent(i))return void this.reset(i);const p=a.length?a[0]:a;return!this._moved&&p.dist(h)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=p,this._move(h,p))}dragEnd(i){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(i)&&(this._moved&&E.suppressClick(),this.reset(i))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const kf={0:1,2:2};class _u{constructor(i){this._correctEvent=i.checkCorrectEvent}startMove(i){const a=E.mouseButton(i);this._eventButton=a}endMove(i){delete this._eventButton}isValidStartEvent(i){return this._correctEvent(i)}isValidMoveEvent(i){return!function(a,h){const p=kf[h];return a.buttons===void 0||(a.buttons&p)!==p}(i,this._eventButton)}isValidEndEvent(i){return E.mouseButton(i)===this._eventButton}}class ud{constructor(){this._firstTouch=void 0}_isOneFingerTouch(i){return i.targetTouches.length===1}_isSameTouchEvent(i){return i.targetTouches[0].identifier===this._firstTouch}startMove(i){this._firstTouch=i.targetTouches[0].identifier}endMove(i){delete this._firstTouch}isValidStartEvent(i){return this._isOneFingerTouch(i)}isValidMoveEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}isValidEndEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}}const Jl=f=>{f.mousedown=f.dragStart,f.mousemoveWindow=f.dragMove,f.mouseup=f.dragEnd,f.contextmenu=function(i){i.preventDefault()}},ga=({enable:f,clickTolerance:i,bearingDegreesPerPixelMoved:a=.8})=>{const h=new _u({checkCorrectEvent:p=>E.mouseButton(p)===0&&p.ctrlKey||E.mouseButton(p)===2});return new js({clickTolerance:i,move:(p,g)=>({bearingDelta:(g.x-p.x)*a}),moveStateManager:h,enable:f,assignEvents:Jl})},qs=({enable:f,clickTolerance:i,pitchDegreesPerPixelMoved:a=-.5})=>{const h=new _u({checkCorrectEvent:p=>E.mouseButton(p)===0&&p.ctrlKey||E.mouseButton(p)===2});return new js({clickTolerance:i,move:(p,g)=>({pitchDelta:(g.y-p.y)*a}),moveStateManager:h,enable:f,assignEvents:Jl})};class le{constructor(i,a){this._minTouches=i.cooperativeGestures?2:1,this._clickTolerance=i.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(i,a,h){return this._calculateTransform(i,a,h)}touchmove(i,a,h){if(this._map._cooperativeGestures&&(this._minTouches===2&&h.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(i,!1,h.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(h.length<this._minTouches))return i.preventDefault(),this._calculateTransform(i,a,h)}touchend(i,a,h){this._calculateTransform(i,a,h),this._active&&h.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,a,h){h.length>0&&(this._active=!0);const p=ts(h,a),g=new l.P(0,0),x=new l.P(0,0);let w=0;for(const A in p){const M=p[A],D=this._touches[A];D&&(g._add(M),x._add(M.sub(D)),w++,p[A]=M)}if(this._touches=p,w<this._minTouches||!x.mag())return;const T=x.div(w);return this._sum._add(T),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(w),panDelta:T}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ql{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(i,a,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([a[0],a[1]]))}touchmove(i,a,h){if(!this._firstTwoTouches)return;i.preventDefault();const[p,g]=this._firstTwoTouches,x=co(h,a,p),w=co(h,a,g);if(!x||!w)return;const T=this._aroundCenter?null:x.add(w).div(2);return this._move([x,w],T,i)}touchend(i,a,h){if(!this._firstTwoTouches)return;const[p,g]=this._firstTwoTouches,x=co(h,a,p),w=co(h,a,g);x&&w||(this._active&&E.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function co(f,i,a){for(let h=0;h<f.length;h++)if(f[h].identifier===a)return i[h]}function ya(f,i){return Math.log(f/i)/Math.LN2}class hd extends Ql{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,a){const h=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(ya(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ya(this._distance,h),pinchAround:a}}}function te(f,i){return 180*f.angleWith(i)/Math.PI}class vu extends Ql{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,a){const h=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:te(this._vector,h),pinchAround:a}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const a=25/(Math.PI*this._minDiameter)*360,h=te(i,this._startVector);return Math.abs(h)<a}}function bu(f){return Math.abs(f.y)>Math.abs(f.x)}class Af extends Ql{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(i,a,h){super.touchstart(i,a,h),this._currentTouchCount=h.length}_start(i){this._lastPoints=i,bu(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,a,h){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const p=i[0].sub(this._lastPoints[0]),g=i[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(p,g,h.timeStamp),this._valid?(this._lastPoints=i,this._active=!0,{pitchDelta:(p.y+g.y)/2*-.5}):void 0}gestureBeginsVertically(i,a,h){if(this._valid!==void 0)return this._valid;const p=i.mag()>=2,g=a.mag()>=2;if(!p&&!g)return;if(!p||!g)return this._firstMove===void 0&&(this._firstMove=h),h-this._firstMove<100&&void 0;const x=i.y>0==a.y>0;return bu(i)&&bu(a)&&x}}const xu={panStep:100,bearingStep:15,pitchStep:10};class dd{constructor(i){this._tr=new Us(i);const a=xu;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let a=0,h=0,p=0,g=0,x=0;switch(i.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:i.shiftKey?h=-1:(i.preventDefault(),g=-1);break;case 39:i.shiftKey?h=1:(i.preventDefault(),g=1);break;case 38:i.shiftKey?p=1:(i.preventDefault(),x=-1);break;case 40:i.shiftKey?p=-1:(i.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(h=0,p=0),{cameraAnimation:w=>{const T=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:pd,zoom:a?Math.round(T.zoom)+a*(i.shiftKey?2:1):T.zoom,bearing:T.bearing+h*this._bearingStep,pitch:T.pitch+p*this._pitchStep,offset:[-g*this._panStep,-x*this._panStep],center:T.center},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function pd(f){return f*(2-f)}const fd=4.000244140625;class Ef{constructor(i,a){this._onTimeout=h=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(h)},this._map=i,this._tr=new Us(i),this._el=i.getCanvasContainer(),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!i[this._map._metaKey])return;i.preventDefault()}let a=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const h=l.h.now(),p=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,a!==0&&a%fd==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(p*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),i.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=i,this._delta-=a,this._active||this._start(i)),i.preventDefault()}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=E.mousePos(this._el,i),h=this._tr;this._around=l.L.convert(this._aroundCenter?h.center:h.unproject(a)),this._aroundPoint=h.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._tr.transform;if(this._delta!==0){const w=this._type==="wheel"&&Math.abs(this._delta)>fd?this._wheelZoomRate:this._defaultZoomRate;let T=2/(1+Math.exp(-Math.abs(this._delta*w)));this._delta<0&&T!==0&&(T=1/T);const A=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):i.scale;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(A*T))),this._type==="wheel"&&(this._startZoom=i.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom=="number"?this._targetZoom:i.zoom,h=this._startZoom,p=this._easing;let g,x=!1;if(this._type==="wheel"&&h&&p){const w=Math.min((l.h.now()-this._lastWheelEventTime)/200,1),T=p(w);g=l.B.number(h,a,T),w<1?this._frameId||(this._frameId=!0):x=!0}else g=a,x=!0;return this._active=!0,x&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!x,zoomDelta:g-i.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let a=l.bb;if(this._prevEase){const h=this._prevEase,p=(l.h.now()-h.start)/h.duration,g=h.easing(p+.01)-h.easing(p),x=.27/Math.sqrt(g*g+1e-4)*.01,w=Math.sqrt(.0729-x*x);a=l.ba(x,w,.25,1)}return this._prevEase={start:l.h.now(),duration:i,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class wu{constructor(i,a){this._clickZoom=i,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Su{constructor(i){this._tr=new Us(i),this.reset()}reset(){this._active=!1}dblclick(i,a){return i.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:this._tr.zoom+(i.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Iu{constructor(){this._tap=new Xl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(i,a,h){if(!this._swipePoint)if(this._tapTime){const p=a[0],g=i.timeStamp-this._tapTime<500,x=this._tapPoint.dist(p)<30;g&&x?h.length>0&&(this._swipePoint=p,this._swipeTouch=h[0].identifier):this.reset()}else this._tap.touchstart(i,a,h)}touchmove(i,a,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const p=a[0],g=p.y-this._swipePoint.y;return this._swipePoint=p,i.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(i,a,h)}touchend(i,a,h){if(this._tapTime)this._swipePoint&&h.length===0&&this.reset();else{const p=this._tap.touchend(i,a,h);p&&(this._tapTime=i.timeStamp,this._tapPoint=p)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Tu{constructor(i,a,h){this._el=i,this._mousePan=a,this._touchPan=h}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Tn{constructor(i,a,h){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=a,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class uo{constructor(i,a,h,p){this._el=i,this._touchZoom=a,this._touchRotate=h,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const nl=f=>f.zoom||f.drag||f.pitch||f.rotate;class ku extends l.k{}function sl(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class Au{constructor(i,a){this.handleWindowEvent=p=>{this.handleEvent(p,`${p.type}Window`)},this.handleEvent=(p,g)=>{if(p.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const x=p.type==="renderFrame"?void 0:p,w={needsRenderFrame:!1},T={},A={},M=p.touches,D=M?this._getMapTouches(M):void 0,F=D?E.touchPos(this._el,D):E.mousePos(this._el,p);for(const{handlerName:Y,handler:$,allowed:lt}of this._handlers){if(!$.isEnabled())continue;let yt;this._blockedByActive(A,lt,Y)?$.reset():$[g||p.type]&&(yt=$[g||p.type](p,F,D),this.mergeHandlerResult(w,T,yt,Y,x),yt&&yt.needsRenderFrame&&this._triggerRenderFrame()),(yt||$.isActive())&&(A[Y]=$)}const Z={};for(const Y in this._previousActiveHandlers)A[Y]||(Z[Y]=x);this._previousActiveHandlers=A,(Object.keys(Z).length||sl(w))&&(this._changes.push([w,T,Z]),this._triggerRenderFrame()),(Object.keys(A).length||sl(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:G}=w;G&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],G(this._map))},this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new sd(i),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,g,x]of this._listeners)E.addEventListener(p,g,p===document?this.handleWindowEvent:this.handleEvent,x)}destroy(){for(const[i,a,h]of this._listeners)E.removeEventListener(i,a,i===document?this.handleWindowEvent:this.handleEvent,h)}_addDefaultHandlers(i){const a=this._map,h=a.getCanvasContainer();this._add("mapEvent",new ad(a,i));const p=a.boxZoom=new cd(a,i);this._add("boxZoom",p),i.interactive&&i.boxZoom&&p.enable();const g=new $s(a),x=new Su(a);a.doubleClickZoom=new wu(x,g),this._add("tapZoom",g),this._add("clickZoom",x),i.interactive&&i.doubleClickZoom&&a.doubleClickZoom.enable();const w=new Iu;this._add("tapDragZoom",w);const T=a.touchPitch=new Af(a);this._add("touchPitch",T),i.interactive&&i.touchPitch&&a.touchPitch.enable(i.touchPitch);const A=ga(i),M=qs(i);a.dragRotate=new Tn(i,A,M),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",M,["mouseRotate"]),i.interactive&&i.dragRotate&&a.dragRotate.enable();const D=(({enable:lt,clickTolerance:yt})=>{const Q=new _u({checkCorrectEvent:ut=>E.mouseButton(ut)===0&&!ut.ctrlKey});return new js({clickTolerance:yt,move:(ut,xt)=>({around:xt,panDelta:xt.sub(ut)}),activateOnStart:!0,moveStateManager:Q,enable:lt,assignEvents:Jl})})(i),F=new le(i,a);a.dragPan=new Tu(h,D,F),this._add("mousePan",D),this._add("touchPan",F,["touchZoom","touchRotate"]),i.interactive&&i.dragPan&&a.dragPan.enable(i.dragPan);const Z=new vu,G=new hd;a.touchZoomRotate=new uo(h,G,Z,w),this._add("touchRotate",Z,["touchPan","touchZoom"]),this._add("touchZoom",G,["touchPan","touchRotate"]),i.interactive&&i.touchZoomRotate&&a.touchZoomRotate.enable(i.touchZoomRotate);const Y=a.scrollZoom=new Ef(a,()=>this._triggerRenderFrame());this._add("scrollZoom",Y,["mousePan"]),i.interactive&&i.scrollZoom&&a.scrollZoom.enable(i.scrollZoom);const $=a.keyboard=new dd(a);this._add("keyboard",$),i.interactive&&i.keyboard&&a.keyboard.enable(),this._add("blockableMapEvent",new ld(a))}_add(i,a,h){this._handlers.push({handlerName:i,handler:a,allowed:h}),this._handlersById[i]=a}stop(i){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!nl(this._eventsInProgress)||this.isZooming()}_blockedByActive(i,a,h){for(const p in i)if(p!==h&&(!a||a.indexOf(p)<0))return!0;return!1}_getMapTouches(i){const a=[];for(const h of i)this._el.contains(h.target)&&a.push(h);return a}mergeHandlerResult(i,a,h,p,g){if(!h)return;l.e(i,h);const x={handlerName:p,originalEvent:h.originalEvent||g};h.zoomDelta!==void 0&&(a.zoom=x),h.panDelta!==void 0&&(a.drag=x),h.pitchDelta!==void 0&&(a.pitch=x),h.bearingDelta!==void 0&&(a.rotate=x)}_applyChanges(){const i={},a={},h={};for(const[p,g,x]of this._changes)p.panDelta&&(i.panDelta=(i.panDelta||new l.P(0,0))._add(p.panDelta)),p.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(i.around=p.around),p.pinchAround!==void 0&&(i.pinchAround=p.pinchAround),p.noInertia&&(i.noInertia=p.noInertia),l.e(a,g),l.e(h,x);this._updateMapTransform(i,a,h),this._changes=[]}_updateMapTransform(i,a,h){const p=this._map,g=p._getTransformForUpdate(),x=p.terrain;if(!(sl(i)||x&&this._terrainMovement))return this._fireEvents(a,h,!0);let{panDelta:w,zoomDelta:T,bearingDelta:A,pitchDelta:M,around:D,pinchAround:F}=i;F!==void 0&&(D=F),p._stop(!0),D=D||p.transform.centerPoint;const Z=g.pointLocation(w?D.sub(w):D);A&&(g.bearing+=A),M&&(g.pitch+=M),T&&(g.zoom+=T),x?this._terrainMovement||!a.drag&&!a.zoom?a.drag&&this._terrainMovement?g.center=g.pointLocation(g.centerPoint.sub(w)):g.setLocationAtPoint(Z,D):(this._terrainMovement=!0,this._map._elevationFreeze=!0,g.setLocationAtPoint(Z,D),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,g.recalculateZoom(p.terrain)})):g.setLocationAtPoint(Z,D),p._applyUpdatedTransform(g),this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(a,h,!0)}_fireEvents(i,a,h){const p=nl(this._eventsInProgress),g=nl(i),x={};for(const M in i){const{originalEvent:D}=i[M];this._eventsInProgress[M]||(x[`${M}start`]=D),this._eventsInProgress[M]=i[M]}!p&&g&&this._fireEvent("movestart",g.originalEvent);for(const M in x)this._fireEvent(M,x[M]);g&&this._fireEvent("move",g.originalEvent);for(const M in i){const{originalEvent:D}=i[M];this._fireEvent(M,D)}const w={};let T;for(const M in this._eventsInProgress){const{handlerName:D,originalEvent:F}=this._eventsInProgress[M];this._handlersById[D].isActive()||(delete this._eventsInProgress[M],T=a[D]||F,w[`${M}end`]=T)}for(const M in w)this._fireEvent(M,w[M]);const A=nl(this._eventsInProgress);if(h&&(p||g)&&!A){this._updatingCamera=!0;const M=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),D=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;!M||!M.essential&&l.h.prefersReducedMotion?(this._map.fire(new l.k("moveend",{originalEvent:T})),D(this._map.getBearing())&&this._map.resetNorth()):(D(M.bearing||this._map.getBearing())&&(M.bearing=0),M.freezeElevation=!0,this._map.easeTo(M,{originalEvent:T})),this._updatingCamera=!1}}_fireEvent(i,a){this._map.fire(new l.k(i,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{delete this._frameId,this.handleEvent(new ku("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class md extends l.E{constructor(i,a){super(),this._renderFrameCallback=()=>{const h=Math.min((l.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=a.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new l.L(this.transform.center.lng,this.transform.center.lat)}setCenter(i,a){return this.jumpTo({center:i},a)}panBy(i,a,h){return i=l.P.convert(i).mult(-1),this.panTo(this.transform.center,l.e({offset:i},a),h)}panTo(i,a,h){return this.easeTo(l.e({center:i},a),h)}getZoom(){return this.transform.zoom}setZoom(i,a){return this.jumpTo({zoom:i},a),this}zoomTo(i,a,h){return this.easeTo(l.e({zoom:i},a),h)}zoomIn(i,a){return this.zoomTo(this.getZoom()+1,i,a),this}zoomOut(i,a){return this.zoomTo(this.getZoom()-1,i,a),this}getBearing(){return this.transform.bearing}setBearing(i,a){return this.jumpTo({bearing:i},a),this}getPadding(){return this.transform.padding}setPadding(i,a){return this.jumpTo({padding:i},a),this}rotateTo(i,a,h){return this.easeTo(l.e({bearing:i},a),h)}resetNorth(i,a){return this.rotateTo(0,l.e({duration:1e3},i),a),this}resetNorthPitch(i,a){return this.easeTo(l.e({bearing:0,pitch:0,duration:1e3},i),a),this}snapToNorth(i,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,a):this}getPitch(){return this.transform.pitch}setPitch(i,a){return this.jumpTo({pitch:i},a),this}cameraForBounds(i,a){i=di.convert(i);const h=a&&a.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),h,a)}_cameraForBoxAndBearing(i,a,h,p){const g={top:0,bottom:0,right:0,left:0};if(typeof(p=l.e({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},p)).padding=="number"){const xt=p.padding;p.padding={top:xt,bottom:xt,right:xt,left:xt}}p.padding=l.e(g,p.padding);const x=this.transform,w=x.padding,T=x.project(l.L.convert(i)),A=x.project(l.L.convert(a)),M=T.rotate(-h*Math.PI/180),D=A.rotate(-h*Math.PI/180),F=new l.P(Math.max(M.x,D.x),Math.max(M.y,D.y)),Z=new l.P(Math.min(M.x,D.x),Math.min(M.y,D.y)),G=F.sub(Z),Y=(x.width-(w.left+w.right+p.padding.left+p.padding.right))/G.x,$=(x.height-(w.top+w.bottom+p.padding.top+p.padding.bottom))/G.y;if($<0||Y<0)return void l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const lt=Math.min(x.scaleZoom(x.scale*Math.min(Y,$)),p.maxZoom),yt=l.P.convert(p.offset),Q=new l.P((p.padding.left-p.padding.right)/2,(p.padding.top-p.padding.bottom)/2).rotate(h*Math.PI/180),ut=yt.add(Q).mult(x.scale/x.zoomScale(lt));return{center:x.unproject(T.add(A).div(2).sub(ut)),zoom:lt,bearing:h}}fitBounds(i,a,h){return this._fitInternal(this.cameraForBounds(i,a),a,h)}fitScreenCoordinates(i,a,h,p,g){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.P.convert(i)),this.transform.pointLocation(l.P.convert(a)),h,p),p,g)}_fitInternal(i,a,h){return i?(delete(a=l.e(i,a)).padding,a.linear?this.easeTo(a,h):this.flyTo(a,h)):this}jumpTo(i,a){this.stop();const h=this._getTransformForUpdate();let p=!1,g=!1,x=!1;return"zoom"in i&&h.zoom!==+i.zoom&&(p=!0,h.zoom=+i.zoom),i.center!==void 0&&(h.center=l.L.convert(i.center)),"bearing"in i&&h.bearing!==+i.bearing&&(g=!0,h.bearing=+i.bearing),"pitch"in i&&h.pitch!==+i.pitch&&(x=!0,h.pitch=+i.pitch),i.padding==null||h.isPaddingEqual(i.padding)||(h.padding=i.padding),this._applyUpdatedTransform(h),this.fire(new l.k("movestart",a)).fire(new l.k("move",a)),p&&this.fire(new l.k("zoomstart",a)).fire(new l.k("zoom",a)).fire(new l.k("zoomend",a)),g&&this.fire(new l.k("rotatestart",a)).fire(new l.k("rotate",a)).fire(new l.k("rotateend",a)),x&&this.fire(new l.k("pitchstart",a)).fire(new l.k("pitch",a)).fire(new l.k("pitchend",a)),this.fire(new l.k("moveend",a))}calculateCameraOptionsFromTo(i,a,h,p=0){const g=l.U.fromLngLat(i,a),x=l.U.fromLngLat(h,p),w=x.x-g.x,T=x.y-g.y,A=x.z-g.z,M=Math.hypot(w,T,A);if(M===0)throw new Error("Can't calculate camera options with same From and To");const D=Math.hypot(w,T),F=this.transform.scaleZoom(this.transform.cameraToCenterDistance/M/this.transform.tileSize),Z=180*Math.atan2(w,-T)/Math.PI;let G=180*Math.acos(D/M)/Math.PI;return G=A<0?90-G:90+G,{center:x.toLngLat(),zoom:F,pitch:G,bearing:Z}}easeTo(i,a){this._stop(!1,i.easeId),((i=l.e({offset:[0,0],duration:500,easing:l.bb},i)).animate===!1||!i.essential&&l.h.prefersReducedMotion)&&(i.duration=0);const h=this._getTransformForUpdate(),p=this.getZoom(),g=this.getBearing(),x=this.getPitch(),w=this.getPadding(),T="zoom"in i?+i.zoom:p,A="bearing"in i?this._normalizeBearing(i.bearing,g):g,M="pitch"in i?+i.pitch:x,D="padding"in i?i.padding:h.padding,F=l.P.convert(i.offset);let Z=h.centerPoint.add(F);const G=h.pointLocation(Z),Y=l.L.convert(i.center||G);this._normalizeCenter(Y);const $=h.project(G),lt=h.project(Y).sub($),yt=h.zoomScale(T-p);let Q,ut;i.around&&(Q=l.L.convert(i.around),ut=h.locationPoint(Q));const xt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||T!==p,this._rotating=this._rotating||g!==A,this._pitching=this._pitching||M!==x,this._padding=!h.isPaddingEqual(D),this._easeId=i.easeId,this._prepareEase(a,i.noMoveStart,xt),this.terrain&&this._prepareElevation(Y),this._ease(St=>{if(this._zooming&&(h.zoom=l.B.number(p,T,St)),this._rotating&&(h.bearing=l.B.number(g,A,St)),this._pitching&&(h.pitch=l.B.number(x,M,St)),this._padding&&(h.interpolatePadding(w,D,St),Z=h.centerPoint.add(F)),this.terrain&&!i.freezeElevation&&this._updateElevation(St),Q)h.setLocationAtPoint(Q,ut);else{const Mt=h.zoomScale(h.zoom-p),Ft=T>p?Math.min(2,yt):Math.max(.5,yt),zt=Math.pow(Ft,1-St),$t=h.unproject($.add(lt.mult(St*zt)).mult(Mt));h.setLocationAtPoint(h.renderWorldCopies?$t.wrap():$t,Z)}this._applyUpdatedTransform(h),this._fireMoveEvents(a)},St=>{this.terrain&&this._finalizeElevation(),this._afterEase(a,St)},i),this}_prepareEase(i,a,h={}){this._moving=!0,a||h.moving||this.fire(new l.k("movestart",i)),this._zooming&&!h.zooming&&this.fire(new l.k("zoomstart",i)),this._rotating&&!h.rotating&&this.fire(new l.k("rotatestart",i)),this._pitching&&!h.pitching&&this.fire(new l.k("pitchstart",i))}_prepareElevation(i){this._elevationCenter=i,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(i){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(i<1&&a!==this._elevationTarget){const h=this._elevationTarget-this._elevationStart;this._elevationStart+=i*(h-(a-(h*i+this._elevationStart))/(1-i)),this._elevationTarget=a}this.transform.elevation=l.B.number(this._elevationStart,this._elevationTarget,i)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(i){if(!this.transformCameraUpdate)return;const a=i.clone(),{center:h,zoom:p,pitch:g,bearing:x,elevation:w}=this.transformCameraUpdate(a);h&&(a.center=h),p!==void 0&&(a.zoom=p),g!==void 0&&(a.pitch=g),x!==void 0&&(a.bearing=x),w!==void 0&&(a.elevation=w),this.transform.apply(a)}_fireMoveEvents(i){this.fire(new l.k("move",i)),this._zooming&&this.fire(new l.k("zoom",i)),this._rotating&&this.fire(new l.k("rotate",i)),this._pitching&&this.fire(new l.k("pitch",i))}_afterEase(i,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;const h=this._zooming,p=this._rotating,g=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,h&&this.fire(new l.k("zoomend",i)),p&&this.fire(new l.k("rotateend",i)),g&&this.fire(new l.k("pitchend",i)),this.fire(new l.k("moveend",i))}flyTo(i,a){if(!i.essential&&l.h.prefersReducedMotion){const ge=l.F(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ge,a)}this.stop(),i=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.bb},i);const h=this._getTransformForUpdate(),p=this.getZoom(),g=this.getBearing(),x=this.getPitch(),w=this.getPadding(),T="zoom"in i?l.ad(+i.zoom,h.minZoom,h.maxZoom):p,A="bearing"in i?this._normalizeBearing(i.bearing,g):g,M="pitch"in i?+i.pitch:x,D="padding"in i?i.padding:h.padding,F=h.zoomScale(T-p),Z=l.P.convert(i.offset);let G=h.centerPoint.add(Z);const Y=h.pointLocation(G),$=l.L.convert(i.center||Y);this._normalizeCenter($);const lt=h.project(Y),yt=h.project($).sub(lt);let Q=i.curve;const ut=Math.max(h.width,h.height),xt=ut/F,St=yt.mag();if("minZoom"in i){const ge=l.ad(Math.min(i.minZoom,p,T),h.minZoom,h.maxZoom),Pi=ut/h.zoomScale(ge-p);Q=Math.sqrt(Pi/St*2)}const Mt=Q*Q;function Ft(ge){const Pi=(xt*xt-ut*ut+(ge?-1:1)*Mt*Mt*St*St)/(2*(ge?xt:ut)*Mt*St);return Math.log(Math.sqrt(Pi*Pi+1)-Pi)}function zt(ge){return(Math.exp(ge)-Math.exp(-ge))/2}function $t(ge){return(Math.exp(ge)+Math.exp(-ge))/2}const pe=Ft(!1);let ri=function(ge){return $t(pe)/$t(pe+Q*ge)},Yt=function(ge){return ut*(($t(pe)*(zt(Pi=pe+Q*ge)/$t(Pi))-zt(pe))/Mt)/St;var Pi},Ee=(Ft(!0)-pe)/Q;if(Math.abs(St)<1e-6||!isFinite(Ee)){if(Math.abs(ut-xt)<1e-6)return this.easeTo(i,a);const ge=xt<ut?-1:1;Ee=Math.abs(Math.log(xt/ut))/Q,Yt=function(){return 0},ri=function(Pi){return Math.exp(ge*Q*Pi)}}return i.duration="duration"in i?+i.duration:1e3*Ee/("screenSpeed"in i?+i.screenSpeed/Q:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0),this._zooming=!0,this._rotating=g!==A,this._pitching=M!==x,this._padding=!h.isPaddingEqual(D),this._prepareEase(a,!1),this.terrain&&this._prepareElevation($),this._ease(ge=>{const Pi=ge*Ee,ii=1/ri(Pi);h.zoom=ge===1?T:p+h.scaleZoom(ii),this._rotating&&(h.bearing=l.B.number(g,A,ge)),this._pitching&&(h.pitch=l.B.number(x,M,ge)),this._padding&&(h.interpolatePadding(w,D,ge),G=h.centerPoint.add(Z)),this.terrain&&!i.freezeElevation&&this._updateElevation(ge);const Ye=ge===1?$:h.unproject(lt.add(yt.mult(Yt(Pi))).mult(ii));h.setLocationAtPoint(h.renderWorldCopies?Ye.wrap():Ye,G),this._applyUpdatedTransform(h),this._fireMoveEvents(a)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(a)},i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const h=this._onEaseEnd;delete this._onEaseEnd,h.call(this,a)}if(!i){const h=this.handlers;h&&h.stop(!1)}return this}_ease(i,a,h){h.animate===!1||h.duration===0?(i(1),a()):(this._easeStart=l.h.now(),this._easeOptions=h,this._onEaseFrame=i,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(i,a){i=l.b5(i,-180,180);const h=Math.abs(i-a);return Math.abs(i-360-a)<h&&(i-=360),Math.abs(i+360-a)<h&&(i+=360),i}_normalizeCenter(i){const a=this.transform;if(!a.renderWorldCopies||a.lngRange)return;const h=i.lng-a.center.lng;i.lng+=h>180?-360:h<-180?360:0}queryTerrainElevation(i){return this.terrain?this.terrain.getElevationForLngLatZoom(l.L.convert(i),this.transform.tileZoom)-this.transform.elevation:null}}class Nn{constructor(i={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=i}getDefaultPosition(){return"bottom-right"}onAdd(i){return this._map=i,this._compact=this.options&&this.options.compact,this._container=E.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=E.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=E.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){E.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(i,a){const h=this._map._getUIString(`AttributionControl.${a}`);i.title=h,i.setAttribute("aria-label",h)}_updateAttributions(){if(!this._map.style)return;let i=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=i.concat(this.options.customAttribution.map(p=>typeof p!="string"?"":p)):typeof this.options.customAttribution=="string"&&i.push(this.options.customAttribution)),this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const a=this._map.style.sourceCaches;for(const p in a){const g=a[p];if(g.used||g.usedForTerrain){const x=g.getSource();x.attribution&&i.indexOf(x.attribution)<0&&i.push(x.attribution)}}i=i.filter(p=>String(p).trim()),i.sort((p,g)=>p.length-g.length),i=i.filter((p,g)=>{for(let x=g+1;x<i.length;x++)if(i[x].indexOf(p)>=0)return!1;return!0});const h=i.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,i.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Wi{constructor(i={}){this._updateCompact=()=>{const a=this._container.children;if(a.length){const h=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&h.classList.add("maplibregl-compact"):h.classList.remove("maplibregl-compact")}},this.options=i}getDefaultPosition(){return"bottom-left"}onAdd(i){this._map=i,this._compact=this.options&&this.options.compact,this._container=E.create("div","maplibregl-ctrl");const a=E.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){E.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class tc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const a=++this._id;return this._queue.push({callback:i,id:a,cancelled:!1}),a}remove(i){const a=this._currentlyRunning,h=a?this._queue.concat(a):this._queue;for(const p of h)if(p.id===i)return void(p.cancelled=!0)}run(i=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const h of a)if(!h.cancelled&&(h.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Eu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var gd=l.Q([{name:"a_pos3d",type:"Int16",components:3}]);class yd extends l.E{constructor(i){super(),this.sourceCache=i,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,i.usedForTerrain=!0,i.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(i,a){this.sourceCache.update(i,a),this._renderableTilesKeys=[];const h={};for(const p of i.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a}))h[p.key]=!0,this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.posMatrix=new Float64Array(16),l.aS(p.posMatrix,0,l.N,0,l.N,0,1),this._tiles[p.key]=new Gr(p,this.tileSize));for(const p in this._tiles)h[p]||delete this._tiles[p]}freeRtt(i){for(const a in this._tiles){const h=this._tiles[a];(!i||h.tileID.equals(i)||h.tileID.isChildOf(i)||i.isChildOf(h.tileID))&&(h.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(i=>this.getTileByID(i))}getTileByID(i){return this._tiles[i]}getTerrainCoords(i){const a={};for(const h of this._renderableTilesKeys){const p=this._tiles[h].tileID;if(p.canonical.equals(i.canonical)){const g=i.clone();g.posMatrix=new Float64Array(16),l.aS(g.posMatrix,0,l.N,0,l.N,0,1),a[h]=g}else if(p.canonical.isChildOf(i.canonical)){const g=i.clone();g.posMatrix=new Float64Array(16);const x=p.canonical.z-i.canonical.z,w=p.canonical.x-(p.canonical.x>>x<<x),T=p.canonical.y-(p.canonical.y>>x<<x),A=l.N>>x;l.aS(g.posMatrix,0,A,0,A,0,1),l.$(g.posMatrix,g.posMatrix,[-w*A,-T*A,0]),a[h]=g}else if(i.canonical.isChildOf(p.canonical)){const g=i.clone();g.posMatrix=new Float64Array(16);const x=i.canonical.z-p.canonical.z,w=i.canonical.x-(i.canonical.x>>x<<x),T=i.canonical.y-(i.canonical.y>>x<<x),A=l.N>>x;l.aS(g.posMatrix,0,l.N,0,l.N,0,1),l.$(g.posMatrix,g.posMatrix,[w*A,T*A,0]),l.a0(g.posMatrix,g.posMatrix,[1/2**x,1/2**x,0]),a[h]=g}}return a}getSourceTile(i,a){const h=this.sourceCache._source;let p=i.overscaledZ-this.deltaZoom;if(p>h.maxzoom&&(p=h.maxzoom),p<h.minzoom)return null;this._sourceTileCache[i.key]||(this._sourceTileCache[i.key]=i.scaledTo(p).key);let g=this.sourceCache.getTileByID(this._sourceTileCache[i.key]);if((!g||!g.dem)&&a)for(;p>=h.minzoom&&(!g||!g.dem);)g=this.sourceCache.getTileByID(i.scaledTo(p--).key);return g}tilesAfterTime(i=Date.now()){return Object.values(this._tiles).filter(a=>a.timeAdded>=i)}}class _d{constructor(i,a,h){this.painter=i,this.sourceCache=new yd(a),this.options=h,this.exaggeration=typeof h.exaggeration=="number"?h.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(i,a,h,p=l.N){var g;if(!(a>=0&&a<p&&h>=0&&h<p))return 0;const x=this.getTerrainData(i),w=(g=x.tile)===null||g===void 0?void 0:g.dem;if(!w)return 0;const T=function(G,Y,$){var lt=Y[0],yt=Y[1];return G[0]=$[0]*lt+$[4]*yt+$[12],G[1]=$[1]*lt+$[5]*yt+$[13],G}([],[a/p*l.N,h/p*l.N],x.u_terrain_matrix),A=[T[0]*w.dim,T[1]*w.dim],M=Math.floor(A[0]),D=Math.floor(A[1]),F=A[0]-M,Z=A[1]-D;return w.get(M,D)*(1-F)*(1-Z)+w.get(M+1,D)*F*(1-Z)+w.get(M,D+1)*(1-F)*Z+w.get(M+1,D+1)*F*Z}getElevationForLngLatZoom(i,a){const{tileID:h,mercatorX:p,mercatorY:g}=this._getOverscaledTileIDFromLngLatZoom(i,a);return this.getElevation(h,p%l.N,g%l.N,l.N)}getElevation(i,a,h,p=l.N){return this.getDEMElevation(i,a,h,p)*this.exaggeration}getTerrainData(i){if(!this._emptyDemTexture){const p=this.painter.context,g=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Ut(p,g,p.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Ut(p,new l.R({width:1,height:1}),p.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.ao([])}const a=this.sourceCache.getSourceTile(i,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const p=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new Ut(p,a.dem.getPixels(),p.gl.RGBA,{premultiply:!1}),a.demTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const h=a&&a+a.tileID.key+i.key;if(h&&!this._demMatrixCache[h]){const p=this.sourceCache.sourceCache._source.maxzoom;let g=i.canonical.z-a.tileID.canonical.z;i.overscaledZ>i.canonical.z&&(i.canonical.z>=p?g=i.canonical.z-p:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const x=i.canonical.x-(i.canonical.x>>g<<g),w=i.canonical.y-(i.canonical.y>>g<<g),T=l.bc(new Float64Array(16),[1/(l.N<<g),1/(l.N<<g),0]);l.$(T,T,[x*l.N,w*l.N,0]),this._demMatrixCache[i.key]={matrix:T,coord:i}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:h?this._demMatrixCache[i.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(i){const a=this.painter,h=a.width/devicePixelRatio,p=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===h&&this._fbo.height===p||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Ut(a.context,{width:h,height:p,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Ut(a.context,{width:h,height:p,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(h,p,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,h,p))),this._fbo.colorAttachment.set(i==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const i=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let g=0,x=0;g<this._coordsTextureSize;g++)for(let w=0;w<this._coordsTextureSize;w++,x+=4)a[x+0]=255&w,a[x+1]=255&g,a[x+2]=w>>8<<4|g>>8,a[x+3]=0;const h=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),p=new Ut(i,h,i.gl.RGBA,{premultiply:!1});return p.bind(i.gl.NEAREST,i.gl.CLAMP_TO_EDGE),this._coordsTexture=p,p}pointCoordinate(i){const a=new Uint8Array(4),h=this.painter.context,p=h.gl;h.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),p.readPixels(i.x,this.painter.height/devicePixelRatio-i.y-1,1,1,p.RGBA,p.UNSIGNED_BYTE,a),h.bindFramebuffer.set(null);const g=a[0]+(a[2]>>4<<8),x=a[1]+((15&a[2])<<8),w=this.coordsIndex[255-a[3]],T=w&&this.sourceCache.getTileByID(w);if(!T)return null;const A=this._coordsTextureSize,M=(1<<T.tileID.canonical.z)*A;return new l.U(this._allowMercatorOverflow(i,(T.tileID.canonical.x*A+g)/M),(T.tileID.canonical.y*A+x)/M,this.getElevation(T.tileID,g,x,A))}getTerrainMesh(){if(this._mesh)return this._mesh;const i=this.painter.context,a=new l.bd,h=new l.b0,p=this.meshSize,g=l.N/p,x=p*p;for(let D=0;D<=p;D++)for(let F=0;F<=p;F++)a.emplaceBack(F*g,D*g,0);for(let D=0;D<x;D+=p+1)for(let F=0;F<p;F++)h.emplaceBack(F+D,p+F+D+1,p+F+D+2),h.emplaceBack(F+D,p+F+D+2,F+D+1);const w=a.length,T=w+2*(p+1);for(const D of[0,1])for(let F=0;F<=p;F++)for(const Z of[0,1])a.emplaceBack(F*g,D*l.N,Z);for(let D=0;D<2*p;D+=2)h.emplaceBack(T+D,T+D+1,T+D+3),h.emplaceBack(T+D,T+D+3,T+D+2),h.emplaceBack(w+D,w+D+3,w+D+1),h.emplaceBack(w+D,w+D+2,w+D+3);const A=a.length,M=A+2*(p+1);for(const D of[0,1])for(let F=0;F<=p;F++)for(const Z of[0,1])a.emplaceBack(D*l.N,F*g,Z);for(let D=0;D<2*p;D+=2)h.emplaceBack(A+D,A+D+1,A+D+3),h.emplaceBack(A+D,A+D+3,A+D+2),h.emplaceBack(M+D,M+D+3,M+D+1),h.emplaceBack(M+D,M+D+2,M+D+3);return this._mesh={indexBuffer:i.createIndexBuffer(h),vertexBuffer:i.createVertexBuffer(a,gd.members),segments:l.S.simpleSegment(0,0,a.length,h.length)},this._mesh}getMeshFrameDelta(i){return 2*Math.PI*l.be/Math.pow(2,i)/5}getMinTileElevationForLngLatZoom(i,a){var h;const{tileID:p}=this._getOverscaledTileIDFromLngLatZoom(i,a);return(h=this.getMinMaxElevation(p).minElevation)!==null&&h!==void 0?h:0}getMinMaxElevation(i){const a=this.getTerrainData(i).tile,h={minElevation:null,maxElevation:null};return a&&a.dem&&(h.minElevation=a.dem.min*this.exaggeration,h.maxElevation=a.dem.max*this.exaggeration),h}_getOverscaledTileIDFromLngLatZoom(i,a){const h=l.U.fromLngLat(i.wrap()),p=(1<<a)*l.N,g=h.x*p,x=h.y*p,w=Math.floor(g/l.N),T=Math.floor(x/l.N);return{tileID:new l.O(a,0,a,w,T),mercatorX:g,mercatorY:x}}_allowMercatorOverflow(i,a){const h=i.x<this.painter.width/2;let p=l.bf(a);const g=this.painter.transform.center.lng;return h&&Math.sign(p)>0&&Math.sign(g)<0||!h&&Math.sign(p)<0&&Math.sign(g)>0?(p=360*Math.sign(g)+p,l.G(p)):a}}class Cf{constructor(i,a,h){this._context=i,this._size=a,this._tileSize=h,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const i of this._objects)i.texture.destroy(),i.fbo.destroy()}_createObject(i){const a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),h=new Ut(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return h.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(h.texture),{id:i,fbo:a,texture:h,stamp:-1,inUse:!1}}getObjectForId(i){return this._objects[i]}useObject(i){i.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(a=>i.id!==a),this._recentlyUsed.push(i.id)}stampObject(i){i.stamp=++this._stamp}getOrCreateFreeObject(){for(const a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const i=this._createObject(this._objects.length);return this._objects.push(i),i}freeObject(i){i.inUse=!1}freeAllObjects(){for(const i of this._objects)this.freeObject(i)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(i=>!i.inUse)===!1}}const fn={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class ec{constructor(i,a){this.painter=i,this.terrain=a,this.pool=new Cf(i.context,30,a.sourceCache.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(i){return this.pool.getObjectForId(i.rtt[this._stacks.length-1].id).texture}prepareForRender(i,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=i._order.filter(h=>!i._layers[h].isHidden(a)),this._coordsDescendingInv={};for(const h in i.sourceCaches){this._coordsDescendingInv[h]={};const p=i.sourceCaches[h].getVisibleCoordinates();for(const g of p){const x=this.terrain.sourceCache.getTerrainCoords(g);for(const w in x)this._coordsDescendingInv[h][w]||(this._coordsDescendingInv[h][w]=[]),this._coordsDescendingInv[h][w].push(x[w])}}this._coordsDescendingInvStr={};for(const h of i._order){const p=i._layers[h],g=p.source;if(fn[p.type]&&!this._coordsDescendingInvStr[g]){this._coordsDescendingInvStr[g]={};for(const x in this._coordsDescendingInv[g])this._coordsDescendingInvStr[g][x]=this._coordsDescendingInv[g][x].map(w=>w.key).sort().join()}}for(const h of this._renderableTiles)for(const p in this._coordsDescendingInvStr){const g=this._coordsDescendingInvStr[p][h.tileID.key];g&&g!==h.rttCoords[p]&&(h.rtt=[])}}renderLayer(i){if(i.isHidden(this.painter.transform.zoom))return!1;const a=i.type,h=this.painter,p=this._renderableLayerIds[this._renderableLayerIds.length-1]===i.id;if(fn[a]&&(this._prevType&&fn[this._prevType]||this._stacks.push([]),this._prevType=a,this._stacks[this._stacks.length-1].push(i.id),!p))return!0;if(fn[this._prevType]||fn[a]&&p){this._prevType=a;const g=this._stacks.length-1,x=this._stacks[g]||[];for(const w of this._renderableTiles){if(this.pool.isFull()&&(hr(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(w),w.rtt[g]){const A=this.pool.getObjectForId(w.rtt[g].id);if(A.stamp===w.rtt[g].stamp){this.pool.useObject(A);continue}}const T=this.pool.getOrCreateFreeObject();this.pool.useObject(T),this.pool.stampObject(T),w.rtt[g]={id:T.id,stamp:T.stamp},h.context.bindFramebuffer.set(T.fbo.framebuffer),h.context.clear({color:l.aT.transparent,stencil:0}),h.currentStencilSource=void 0;for(let A=0;A<x.length;A++){const M=h.style._layers[x[A]],D=M.source?this._coordsDescendingInv[M.source][w.tileID.key]:[w.tileID];h.context.viewport.set([0,0,T.fbo.width,T.fbo.height]),h._renderTileClippingMasks(M,D),h.renderLayer(h,h.style.sourceCaches[M.source],M,D),M.source&&(w.rttCoords[M.source]=this._coordsDescendingInvStr[M.source][w.tileID.key])}}return hr(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),fn[a]}return!1}}const be=P,Ae={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},ol=f=>{f.touchstart=f.dragStart,f.touchmoveWindow=f.dragMove,f.touchend=f.dragEnd},Cu={showCompass:!0,showZoom:!0,visualizePitch:!1};class Mu{constructor(i,a,h=!1){this.mousedown=x=>{this.startMouse(l.e({},x,{ctrlKey:!0,preventDefault:()=>x.preventDefault()}),E.mousePos(this.element,x)),E.addEventListener(window,"mousemove",this.mousemove),E.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=x=>{this.moveMouse(x,E.mousePos(this.element,x))},this.mouseup=x=>{this.mouseRotate.dragEnd(x),this.mousePitch&&this.mousePitch.dragEnd(x),this.offTemp()},this.touchstart=x=>{x.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=E.touchPos(this.element,x.targetTouches)[0],this.startTouch(x,this._startPos),E.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),E.addEventListener(window,"touchend",this.touchend))},this.touchmove=x=>{x.targetTouches.length!==1?this.reset():(this._lastPos=E.touchPos(this.element,x.targetTouches)[0],this.moveTouch(x,this._lastPos))},this.touchend=x=>{x.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const p=i.dragRotate._mouseRotate.getClickTolerance(),g=i.dragRotate._mousePitch.getClickTolerance();this.element=a,this.mouseRotate=ga({clickTolerance:p,enable:!0}),this.touchRotate=(({enable:x,clickTolerance:w,bearingDegreesPerPixelMoved:T=.8})=>{const A=new ud;return new js({clickTolerance:w,move:(M,D)=>({bearingDelta:(D.x-M.x)*T}),moveStateManager:A,enable:x,assignEvents:ol})})({clickTolerance:p,enable:!0}),this.map=i,h&&(this.mousePitch=qs({clickTolerance:g,enable:!0}),this.touchPitch=(({enable:x,clickTolerance:w,pitchDegreesPerPixelMoved:T=-.5})=>{const A=new ud;return new js({clickTolerance:w,move:(M,D)=>({pitchDelta:(D.y-M.y)*T}),moveStateManager:A,enable:x,assignEvents:ol})})({clickTolerance:g,enable:!0})),E.addEventListener(a,"mousedown",this.mousedown),E.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),E.addEventListener(a,"touchcancel",this.reset)}startMouse(i,a){this.mouseRotate.dragStart(i,a),this.mousePitch&&this.mousePitch.dragStart(i,a),E.disableDrag()}startTouch(i,a){this.touchRotate.dragStart(i,a),this.touchPitch&&this.touchPitch.dragStart(i,a),E.disableDrag()}moveMouse(i,a){const h=this.map,{bearingDelta:p}=this.mouseRotate.dragMove(i,a)||{};if(p&&h.setBearing(h.getBearing()+p),this.mousePitch){const{pitchDelta:g}=this.mousePitch.dragMove(i,a)||{};g&&h.setPitch(h.getPitch()+g)}}moveTouch(i,a){const h=this.map,{bearingDelta:p}=this.touchRotate.dragMove(i,a)||{};if(p&&h.setBearing(h.getBearing()+p),this.touchPitch){const{pitchDelta:g}=this.touchPitch.dragMove(i,a)||{};g&&h.setPitch(h.getPitch()+g)}}off(){const i=this.element;E.removeEventListener(i,"mousedown",this.mousedown),E.removeEventListener(i,"touchstart",this.touchstart,{passive:!1}),E.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),E.removeEventListener(window,"touchend",this.touchend),E.removeEventListener(i,"touchcancel",this.reset),this.offTemp()}offTemp(){E.enableDrag(),E.removeEventListener(window,"mousemove",this.mousemove),E.removeEventListener(window,"mouseup",this.mouseup),E.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),E.removeEventListener(window,"touchend",this.touchend)}}let xr;function Du(f,i,a){if(f=new l.L(f.lng,f.lat),i){const h=new l.L(f.lng-360,f.lat),p=new l.L(f.lng+360,f.lat),g=a.locationPoint(f).distSqr(i);a.locationPoint(h).distSqr(i)<g?f=h:a.locationPoint(p).distSqr(i)<g&&(f=p)}for(;Math.abs(f.lng-a.center.lng)>180;){const h=a.locationPoint(f);if(h.x>=0&&h.y>=0&&h.x<=a.width&&h.y<=a.height)break;f.lng>a.center.lng?f.lng-=360:f.lng+=360}return f}const es={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function vd(f,i,a){const h=f.classList;for(const p in es)h.remove(`maplibregl-${a}-anchor-${p}`);h.add(`maplibregl-${a}-anchor-${i}`)}class Oo extends l.E{constructor(i){if(super(),this._onKeyPress=a=>{const h=a.code,p=a.charCode||a.keyCode;h!=="Space"&&h!=="Enter"&&p!==32&&p!==13||this.togglePopup()},this._onMapClick=a=>{const h=a.originalEvent.target,p=this._element;this._popup&&(h===p||p.contains(h))&&this.togglePopup()},this._update=a=>{if(!this._map)return;const h=this._map.loaded()&&!this._map.isMoving();((a==null?void 0:a.type)==="terrain"||(a==null?void 0:a.type)==="render"&&!h)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=Du(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(p=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let g="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?g="rotateX(0deg)":this._pitchAlignment==="map"&&(g=`rotateX(${this._map.getPitch()}deg)`),a&&a.type!=="moveend"||(this._pos=this._pos.round()),E.setTransform(this._element,`${es[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${g} ${p}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const x=this._map.unproject(this._pos),w=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=x.distanceTo(this._lngLat)>20*w?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=a=>{if(!this._isDragging){const h=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.k("dragstart"))),this.fire(new l.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.k("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment!=="auto"?i.pitchAlignment:this._rotationAlignment,i&&i.element)this._element=i.element,this._offset=l.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=E.create("div"),this._element.setAttribute("aria-label","Map marker");const a=E.createNS("http://www.w3.org/2000/svg","svg"),h=41,p=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${h}px`),a.setAttributeNS(null,"width",`${p}px`),a.setAttributeNS(null,"viewBox",`0 0 ${p} ${h}`);const g=E.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"stroke","none"),g.setAttributeNS(null,"stroke-width","1"),g.setAttributeNS(null,"fill","none"),g.setAttributeNS(null,"fill-rule","evenodd");const x=E.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"fill-rule","nonzero");const w=E.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const T=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const lt of T){const yt=E.createNS("http://www.w3.org/2000/svg","ellipse");yt.setAttributeNS(null,"opacity","0.04"),yt.setAttributeNS(null,"cx","10.5"),yt.setAttributeNS(null,"cy","5.80029008"),yt.setAttributeNS(null,"rx",lt.rx),yt.setAttributeNS(null,"ry",lt.ry),w.appendChild(yt)}const A=E.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill",this._color);const M=E.createNS("http://www.w3.org/2000/svg","path");M.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),A.appendChild(M);const D=E.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"opacity","0.25"),D.setAttributeNS(null,"fill","#000000");const F=E.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),D.appendChild(F);const Z=E.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Z.setAttributeNS(null,"fill","#FFFFFF");const G=E.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Y=E.createNS("http://www.w3.org/2000/svg","circle");Y.setAttributeNS(null,"fill","#000000"),Y.setAttributeNS(null,"opacity","0.25"),Y.setAttributeNS(null,"cx","5.5"),Y.setAttributeNS(null,"cy","5.5"),Y.setAttributeNS(null,"r","5.4999962");const $=E.createNS("http://www.w3.org/2000/svg","circle");$.setAttributeNS(null,"fill","#FFFFFF"),$.setAttributeNS(null,"cx","5.5"),$.setAttributeNS(null,"cy","5.5"),$.setAttributeNS(null,"r","5.4999962"),G.appendChild(Y),G.appendChild($),x.appendChild(w),x.appendChild(A),x.appendChild(D),x.appendChild(Z),x.appendChild(G),a.appendChild(x),a.setAttributeNS(null,"height",h*this._scale+"px"),a.setAttributeNS(null,"width",p*this._scale+"px"),this._element.appendChild(a),this._offset=l.P.convert(i&&i.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",a=>{a.preventDefault()}),this._element.addEventListener("mousedown",a=>{a.preventDefault()}),vd(this._element,this._anchor,"marker"),i&&i.className)for(const a of i.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(i){return this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._update),i.on("moveend",this._update),i.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),E.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=l.L.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const p=Math.abs(13.5)/Math.SQRT2;i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?i.remove():i.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(i){return this._offset=l.P.convert(i),this._update(),this}addClassName(i){this._element.classList.add(i)}removeClassName(i){this._element.classList.remove(i)}toggleClassName(i){return this._element.classList.toggle(i)}setDraggable(i){return this._draggable=!!i,this._map&&(i?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i&&i!=="auto"?i:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const dr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let or=0,_a=!1;const al={maxWidth:100,unit:"metric"};function ll(f,i,a){const h=a&&a.maxWidth||100,p=f._container.clientHeight/2,g=f.unproject([0,p]),x=f.unproject([h,p]),w=g.distanceTo(x);if(a&&a.unit==="imperial"){const T=3.2808*w;T>5280?No(i,h,T/5280,f._getUIString("ScaleControl.Miles")):No(i,h,T,f._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?No(i,h,w/1852,f._getUIString("ScaleControl.NauticalMiles")):w>=1e3?No(i,h,w/1e3,f._getUIString("ScaleControl.Kilometers")):No(i,h,w,f._getUIString("ScaleControl.Meters"))}function No(f,i,a,h){const p=function(g){const x=Math.pow(10,`${Math.floor(g)}`.length-1);let w=g/x;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:function(T){const A=Math.pow(10,Math.ceil(-Math.log(T)/Math.LN10));return Math.round(T*A)/A}(w),x*w}(a);f.style.width=i*(p/a)+"px",f.innerHTML=`${p}&nbsp;${h}`}const Pu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Lu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function va(f){if(f){if(typeof f=="number"){const i=Math.round(Math.abs(f)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,f),"top-left":new l.P(i,i),"top-right":new l.P(-i,i),bottom:new l.P(0,-f),"bottom-left":new l.P(i,-i),"bottom-right":new l.P(-i,-i),left:new l.P(f,0),right:new l.P(-f,0)}}if(f instanceof l.P||Array.isArray(f)){const i=l.P.convert(f);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:l.P.convert(f.center||[0,0]),top:l.P.convert(f.top||[0,0]),"top-left":l.P.convert(f["top-left"]||[0,0]),"top-right":l.P.convert(f["top-right"]||[0,0]),bottom:l.P.convert(f.bottom||[0,0]),"bottom-left":l.P.convert(f["bottom-left"]||[0,0]),"bottom-right":l.P.convert(f["bottom-right"]||[0,0]),left:l.P.convert(f.left||[0,0]),right:l.P.convert(f.right||[0,0])}}return va(new l.P(0,0))}const zu={extend:(f,...i)=>l.e(f,...i),run(f){f()},logToElement(f,i=!1,a="log"){const h=window.document.getElementById(a);h&&(i&&(h.innerHTML=""),h.innerHTML+=`<br>${f}`)}},Bu=P;class Ii{static get version(){return Bu}static get workerCount(){return nn.workerCount}static set workerCount(i){nn.workerCount=i}static get maxParallelImageRequests(){return l.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(i){l.c.MAX_PARALLEL_IMAGE_REQUESTS=i}static get workerUrl(){return l.c.WORKER_URL}static set workerUrl(i){l.c.WORKER_URL=i}static addProtocol(i,a){l.c.REGISTERED_PROTOCOLS[i]=a}static removeProtocol(i){delete l.c.REGISTERED_PROTOCOLS[i]}}return Ii.Map=class extends md{constructor(f){if(l.bg.mark(l.bh.create),(f=l.e({},Ae,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Kl(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),{bearingSnap:f.bearingSnap}),this._cooperativeGesturesOnWheel=i=>{this._onCooperativeGesture(i,i[this._metaKey],1)},this._contextLost=i=>{i.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.k("webglcontextlost",{originalEvent:i}))},this._contextRestored=i=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.k("webglcontextrestored",{originalEvent:i}))},this._onMapScroll=i=>{if(i.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=f.interactive,this._cooperativeGestures=f.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=f.maxTileCacheSize,this._maxTileCacheZoomLevels=f.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._crossSourceCollisions=f.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=f.collectResourceTiming,this._renderTaskQueue=new tc,this._controls=[],this._mapId=l.a2(),this._locale=l.e({},Eu,f.locale),this._clickTolerance=f.clickTolerance,this._overridePixelRatio=f.pixelRatio,this._maxCanvasSize=f.maxCanvasSize,this.transformCameraUpdate=f.transformCameraUpdate,this._imageQueueHandle=nt.addThrottleControl(()=>this.isMoving()),this._requestManager=new It(f.transformRequest),typeof f.container=="string"){if(this._container=document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(f.maxBounds&&this.setMaxBounds(f.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let i=!1;const a=Fo(h=>{this._trackResize&&!this._removed&&this.resize(h)._update()},50);this._resizeObserver=new ResizeObserver(h=>{i?a(h):i=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Au(this,f),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=f.hash&&new el(typeof f.hash=="string"&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,l.e({},f.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=f.localIdeographFontFamily,this._validateStyle=f.validateStyle,f.style&&this.setStyle(f.style,{localIdeographFontFamily:f.localIdeographFontFamily}),f.attributionControl&&this.addControl(new Nn({customAttribution:f.customAttribution})),f.maplibreLogo&&this.addControl(new Wi,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update(i.dataType==="style"),this.fire(new l.k(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new l.k(`${i.dataType}dataloading`,i))}),this.on("dataabort",i=>{this.fire(new l.k("sourcedataabort",i))})}_getMapId(){return this._mapId}addControl(f,i){if(i===void 0&&(i=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new l.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=f.onAdd(this);this._controls.push(f);const h=this._controlPositions[i];return i.indexOf("bottom")!==-1?h.insertBefore(a,h.firstChild):h.appendChild(a),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new l.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(f);return i>-1&&this._controls.splice(i,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}calculateCameraOptionsFromTo(f,i,a,h){return h==null&&this.terrain&&(h=this.terrain.getElevationForLngLatZoom(a,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(f,i,a,h)}resize(f){var i;const a=this._containerDimensions(),h=a[0],p=a[1],g=this._getClampedPixelRatio(h,p);if(this._resizeCanvas(h,p,g),this.painter.resize(h,p,g),this.painter.overLimit()){const w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];const T=this._getClampedPixelRatio(h,p);this._resizeCanvas(h,p,T),this.painter.resize(h,p,T)}this.transform.resize(h,p),(i=this._requestedCameraState)===null||i===void 0||i.resize(h,p);const x=!this._moving;return x&&(this.stop(),this.fire(new l.k("movestart",f)).fire(new l.k("move",f))),this.fire(new l.k("resize",f)),x&&this.fire(new l.k("moveend",f)),this}_getClampedPixelRatio(f,i){const{0:a,1:h}=this._maxCanvasSize,p=this.getPixelRatio(),g=f*p,x=i*p;return Math.min(g>a?a/g:1,x>h?h/x:1)*p}getPixelRatio(){var f;return(f=this._overridePixelRatio)!==null&&f!==void 0?f:devicePixelRatio}setPixelRatio(f){this._overridePixelRatio=f,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(f){return this.transform.setMaxBounds(di.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f&&this.setZoom(f),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f&&this.setZoom(f),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f&&this.setPitch(f),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f&&this.setPitch(f),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(f){return this._cooperativeGestures=f,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(f){return this.transform.locationPoint(l.L.convert(f),this.style&&this.terrain)}unproject(f){return this.transform.pointLocation(l.P.convert(f),this.terrain)}isMoving(){var f;return this._moving||((f=this.handlers)===null||f===void 0?void 0:f.isMoving())}isZooming(){var f;return this._zooming||((f=this.handlers)===null||f===void 0?void 0:f.isZooming())}isRotating(){var f;return this._rotating||((f=this.handlers)===null||f===void 0?void 0:f.isRotating())}_createDelegatedListener(f,i,a){if(f==="mouseenter"||f==="mouseover"){let h=!1;return{layer:i,listener:a,delegates:{mousemove:g=>{const x=this.getLayer(i)?this.queryRenderedFeatures(g.point,{layers:[i]}):[];x.length?h||(h=!0,a.call(this,new On(f,this,g.originalEvent,{features:x}))):h=!1},mouseout:()=>{h=!1}}}}if(f==="mouseleave"||f==="mouseout"){let h=!1;return{layer:i,listener:a,delegates:{mousemove:x=>{(this.getLayer(i)?this.queryRenderedFeatures(x.point,{layers:[i]}):[]).length?h=!0:h&&(h=!1,a.call(this,new On(f,this,x.originalEvent)))},mouseout:x=>{h&&(h=!1,a.call(this,new On(f,this,x.originalEvent)))}}}}{const h=p=>{const g=this.getLayer(i)?this.queryRenderedFeatures(p.point,{layers:[i]}):[];g.length&&(p.features=g,a.call(this,p),delete p.features)};return{layer:i,listener:a,delegates:{[f]:h}}}}on(f,i,a){if(a===void 0)return super.on(f,i);const h=this._createDelegatedListener(f,i,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(h);for(const p in h.delegates)this.on(p,h.delegates[p]);return this}once(f,i,a){if(a===void 0)return super.once(f,i);const h=this._createDelegatedListener(f,i,a);for(const p in h.delegates)this.once(p,h.delegates[p]);return this}off(f,i,a){return a===void 0?super.off(f,i):(this._delegatedListeners&&this._delegatedListeners[f]&&(h=>{const p=this._delegatedListeners[f];for(let g=0;g<p.length;g++){const x=p[g];if(x.layer===i&&x.listener===a){for(const w in x.delegates)this.off(w,x.delegates[w]);return p.splice(g,1),this}}})(),this)}queryRenderedFeatures(f,i){if(!this.style)return[];let a;const h=f instanceof l.P||Array.isArray(f),p=h?f:[[0,0],[this.transform.width,this.transform.height]];if(i=i||(h?{}:f)||{},p instanceof l.P||typeof p[0]=="number")a=[l.P.convert(p)];else{const g=l.P.convert(p[0]),x=l.P.convert(p[1]);a=[g,new l.P(x.x,g.y),x,new l.P(g.x,x.y),g]}return this.style.queryRenderedFeatures(a,i,this.transform)}querySourceFeatures(f,i){return this.style.querySourceFeatures(f,i)}setStyle(f,i){return(i=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},i)).diff!==!1&&i.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&f?(this._diffStyle(f,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._updateStyle(f,i))}setTransformRequest(f){return this._requestManager.setTransformRequest(f),this}_getUIString(f){const i=this._locale[f];if(i==null)throw new Error(`Missing UI string '${f}'`);return i}_updateStyle(f,i){if(i.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(f,i));const a=this.style&&i.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!f)),f?(this.style=new Hr(this,i||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f,i,a):this.style.loadJSON(f,i,a),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Hr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,i){if(typeof f=="string"){const a=this._requestManager.transformRequest(f,it.Style);l.f(a,(h,p)=>{h?this.fire(new l.j(h)):p&&this._updateDiff(p,i)})}else typeof f=="object"&&this._updateDiff(f,i)}_updateDiff(f,i){try{this.style.setState(f,i)&&this._update(!0)}catch(a){l.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(f,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(f,i){return this._lazyInitEmptyStyle(),this.style.addSource(f,i),this._update(!0)}isSourceLoaded(f){const i=this.style&&this.style.sourceCaches[f];if(i!==void 0)return i.loaded();this.fire(new l.j(new Error(`There is no source with ID '${f}'`)))}setTerrain(f){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),f){const i=this.style.sourceCaches[f.source];if(!i)throw new Error(`cannot load terrain, because there exists no source with ID: ${f.source}`);for(const a in this.style._layers){const h=this.style._layers[a];h.type==="hillshade"&&h.source===f.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new _d(this.painter,i,f),this.painter.renderToTexture=new ec(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=a=>{a.dataType==="style"?this.terrain.sourceCache.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==f.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new l.k("terrain",{terrain:f})),this}getTerrain(){var f,i;return(i=(f=this.terrain)===null||f===void 0?void 0:f.options)!==null&&i!==void 0?i:null}areTilesLoaded(){const f=this.style&&this.style.sourceCaches;for(const i in f){const a=f[i]._tiles;for(const h in a){const p=a[h];if(p.state!=="loaded"&&p.state!=="errored")return!1}}return!0}addSourceType(f,i,a){return this._lazyInitEmptyStyle(),this.style.addSourceType(f,i,a)}removeSource(f){return this.style.removeSource(f),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,i,a={}){const{pixelRatio:h=1,sdf:p=!1,stretchX:g,stretchY:x,content:w}=a;if(this._lazyInitEmptyStyle(),!(i instanceof HTMLImageElement||l.a(i))){if(i.width===void 0||i.height===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:T,height:A,data:M}=i,D=i;return this.style.addImage(f,{data:new l.R({width:T,height:A},new Uint8Array(M)),pixelRatio:h,stretchX:g,stretchY:x,content:w,sdf:p,version:0,userImage:D}),D.onAdd&&D.onAdd(this,f),this}}{const{width:T,height:A,data:M}=l.h.getImageData(i);this.style.addImage(f,{data:new l.R({width:T,height:A},M),pixelRatio:h,stretchX:g,stretchY:x,content:w,sdf:p,version:0})}}updateImage(f,i){const a=this.style.getImage(f);if(!a)return this.fire(new l.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const h=i instanceof HTMLImageElement||l.a(i)?l.h.getImageData(i):i,{width:p,height:g,data:x}=h;if(p===void 0||g===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==a.data.width||g!==a.data.height)return this.fire(new l.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(i instanceof HTMLImageElement||l.a(i));return a.data.replace(x,w),this.style.updateImage(f,a),this}getImage(f){return this.style.getImage(f)}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new l.j(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,i){nt.getImage(this._requestManager.transformRequest(f,it.Image),i)}listImages(){return this.style.listImages()}addLayer(f,i){return this._lazyInitEmptyStyle(),this.style.addLayer(f,i),this._update(!0)}moveLayer(f,i){return this.style.moveLayer(f,i),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(f,i,a){return this.style.setLayerZoomRange(f,i,a),this._update(!0)}setFilter(f,i,a={}){return this.style.setFilter(f,i,a),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,i,a,h={}){return this.style.setPaintProperty(f,i,a,h),this._update(!0)}getPaintProperty(f,i){return this.style.getPaintProperty(f,i)}setLayoutProperty(f,i,a,h={}){return this.style.setLayoutProperty(f,i,a,h),this._update(!0)}getLayoutProperty(f,i){return this.style.getLayoutProperty(f,i)}setGlyphs(f,i={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(f,i),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(f,i,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(f,i,a,h=>{h||this._update(!0)}),this}removeSprite(f){return this._lazyInitEmptyStyle(),this.style.removeSprite(f),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(f,i={}){return this._lazyInitEmptyStyle(),this.style.setSprite(f,i,a=>{a||this._update(!0)}),this}setLight(f,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,i),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(f,i){return this.style.setFeatureState(f,i),this._update()}removeFeatureState(f,i){return this.style.removeFeatureState(f,i),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let f=0,i=0;return this._container&&(f=this._container.clientWidth||400,i=this._container.clientHeight||300),[f,i]}_setupContainer(){const f=this._container;f.classList.add("maplibregl-map");const i=this._canvasContainer=E.create("div","maplibregl-canvas-container",f);this._interactive&&i.classList.add("maplibregl-interactive"),this._canvas=E.create("canvas","maplibregl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const a=this._containerDimensions(),h=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],h);const p=this._controlContainer=E.create("div","maplibregl-control-container",f),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{g[x]=E.create("div",`maplibregl-ctrl-${x} `,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=E.create("div","maplibregl-cooperative-gesture-screen",this._container);let f=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(f=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${f}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){E.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(f,i,a){this._canvas.width=Math.floor(a*f),this._canvas.height=Math.floor(a*i),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${i}px`}_setupPainter(){const f={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let i=null;this._canvas.addEventListener("webglcontextcreationerror",h=>{i={requestedAttributes:f},h&&(i.statusMessage=h.statusMessage,i.type=h.type)},{once:!0});const a=this._canvas.getContext("webgl2",f)||this._canvas.getContext("webgl",f);if(!a){const h="Failed to initialize WebGL";throw i?(i.message=h,new Error(JSON.stringify(i))):new Error(h)}this.painter=new Ro(a,this.transform),U.testSupport(a)}_onCooperativeGesture(f,i,a){return!i&&a<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_render(f){const i=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._removed)return;let a=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const p=this.transform.zoom,g=l.h.now();this.style.zoomHistory.update(p,g);const x=new l.a8(p,{now:g,fadeDuration:i,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),w=x.crossFadingFactor();w===1&&w===this._crossFadingFactor||(a=!0,this._crossFadingFactor=w),this.style.update(x)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,i,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:i,showPadding:this.showPadding}),this.fire(new l.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.bg.mark(l.bh.load),this.fire(new l.k("load"))),this.style&&(this.style.hasTransitions()||a)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const h=this._sourcesDirty||this._styleDirty||this._placementDirty;return h||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.k("idle")),!this._loaded||this._fullyLoaded||h||(this._fullyLoaded=!0,l.bg.mark(l.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var f;this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),nt.removeThrottleControl(this._imageQueueHandle),(f=this._resizeObserver)===null||f===void 0||f.disconnect();const i=this.painter.context.gl.getExtension("WEBGL_lose_context");i&&i.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),E.remove(this._canvasContainer),E.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),l.bg.clearMetrics(),this._removed=!0,this.fire(new l.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=l.h.frame(f=>{l.bg.frame(f),this._frame=null,this._render(f)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get version(){return be}getCameraTargetElevation(){return this.transform.elevation}},Ii.NavigationControl=class{constructor(f){this._updateZoomButtons=()=>{const i=this._map.getZoom(),a=i===this._map.getMaxZoom(),h=i===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())},this._rotateCompassArrow=()=>{const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=i},this._setButtonTitle=(i,a)=>{const h=this._map._getUIString(`NavigationControl.${a}`);i.title=h,i.setAttribute("aria-label",h)},this.options=l.e({},Cu,f),this._container=E.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",i=>this._map.zoomIn({},{originalEvent:i})),E.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",i=>this._map.zoomOut({},{originalEvent:i})),E.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",i=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:i}):this._map.resetNorth({},{originalEvent:i})}),this._compassIcon=E.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Mu(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){E.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,i){const a=E.create("button",f,this._container);return a.type="button",a.addEventListener("click",i),a}},Ii.GeolocateControl=class extends l.E{constructor(f){super(),this._onSuccess=i=>{if(this._map){if(this._isOutOfMapMaxBounds(i))return this._setErrorState(),this.fire(new l.k("outofmaxbounds",i)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=i,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(i),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(i),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.k("geolocate",i)),this._finish()}},this._updateCamera=i=>{const a=new l.L(i.coords.longitude,i.coords.latitude),h=i.coords.accuracy,p=this._map.getBearing(),g=l.e({bearing:p},this.options.fitBoundsOptions),x=di.fromLngLat(a,h);this._map.fitBounds(x,g,{geolocateSource:!0})},this._updateMarker=i=>{if(i){const a=new l.L(i.coords.longitude,i.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=i.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=i=>{if(this._map){if(this.options.trackUserLocation)if(i.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(i.code===3&&_a)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.k("error",i)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=i=>{if(this._map){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=E.create("button","maplibregl-ctrl-geolocate",this._container),E.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",i===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=E.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Oo({element:this._dotElement}),this._circleElement=E.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Oo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.k("trackuserlocationend")))})}},this.options=l.e({},dr,f)}onAdd(f){return this._map=f,this._container=E.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(i,a=!1){xr===void 0||a?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(h=>{xr=h.state!=="denied",i(xr)}).catch(()=>{xr=!!window.navigator.geolocation,i(xr)}):(xr=!!window.navigator.geolocation,i(xr)):i(xr)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),E.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,or=0,_a=!1}_isOutOfMapMaxBounds(f){const i=this._map.getMaxBounds(),a=f.coords;return i&&(a.longitude<i.getWest()||a.longitude>i.getEast()||a.latitude<i.getSouth()||a.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const f=this._map.getBounds(),i=f.getSouthEast(),a=f.getNorthEast(),h=i.distanceTo(a),p=Math.ceil(this._accuracy/(h/this._map._container.clientHeight)*2);this._circleElement.style.width=`${p}px`,this._circleElement.style.height=`${p}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":or--,_a=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),or++,or>1?(f={maximumAge:6e5,timeout:0},_a=!0):(f=this.options.positionOptions,_a=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},Ii.AttributionControl=Nn,Ii.LogoControl=Wi,Ii.ScaleControl=class{constructor(f){this._onMove=()=>{ll(this._map,this._container,this.options)},this.setUnit=i=>{this.options.unit=i,ll(this._map,this._container,this.options)},this.options=l.e({},al,f)}getDefaultPosition(){return"bottom-left"}onAdd(f){return this._map=f,this._container=E.create("div","maplibregl-ctrl maplibregl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){E.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},Ii.FullscreenControl=class extends l.E{constructor(f={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=E.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){E.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const f=this._fullscreenButton=E.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);E.create("span","maplibregl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new l.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},Ii.TerrainControl=class{constructor(f){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=f}onAdd(f){return this._map=f,this._container=E.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=E.create("button","maplibregl-ctrl-terrain",this._container),E.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){E.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},Ii.Popup=class extends l.E{constructor(f){super(),this.remove=()=>(this._content&&E.remove(this._content),this._container&&(E.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new l.k("close")),this),this._onMouseUp=i=>{this._update(i.point)},this._onMouseMove=i=>{this._update(i.point)},this._onDrag=i=>{this._update(i.point)},this._update=i=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=E.create("div","maplibregl-popup",this._map.getContainer()),this._tip=E.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const x of this.options.className.split(" "))this._container.classList.add(x);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Du(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!i)return;const a=this._pos=this._trackPointer&&i?i:this._map.project(this._lngLat);let h=this.options.anchor;const p=va(this.options.offset);if(!h){const x=this._container.offsetWidth,w=this._container.offsetHeight;let T;T=a.y+p.bottom.y<w?["top"]:a.y>this._map.transform.height-w?["bottom"]:[],a.x<x/2?T.push("left"):a.x>this._map.transform.width-x/2&&T.push("right"),h=T.length===0?"bottom":T.join("-")}const g=a.add(p[h]).round();E.setTransform(this._container,`${es[h]} translate(${g.x}px,${g.y}px)`),vd(this._container,h,"popup")},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(Pu),f)}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=l.L.convert(f),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const i=document.createDocumentFragment(),a=document.createElement("body");let h;for(a.innerHTML=f;h=a.firstChild,h;)i.appendChild(h);return this.setDOMContent(i)}getMaxWidth(){var f;return(f=this._container)===null||f===void 0?void 0:f.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=E.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){this._container&&this._container.classList.add(f)}removeClassName(f){this._container&&this._container.classList.remove(f)}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){if(this._container)return this._container.classList.toggle(f)}_createCloseButton(){this.options.closeButton&&(this._closeButton=E.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(Lu);f&&f.focus()}},Ii.Marker=Oo,Ii.Style=Hr,Ii.LngLat=l.L,Ii.LngLatBounds=di,Ii.Point=l.P,Ii.MercatorCoordinate=l.U,Ii.Evented=l.E,Ii.AJAXError=l.bi,Ii.config=l.c,Ii.CanvasSource=lr,Ii.GeoJSONSource=Xt,Ii.ImageSource=Mi,Ii.RasterDEMTileSource=ye,Ii.RasterTileSource=xi,Ii.VectorTileSource=Xe,Ii.VideoSource=en,Ii.setRTLTextPlugin=l.bj,Ii.getRTLTextPluginStatus=l.bk,Ii.prewarm=function(){Za().acquire(gi)},Ii.clearPrewarmedResources=function(){const f=Zr;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(gi),Zr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},zu.extend(Ii,{isSafari:l.ac,getPerformanceMetrics:l.bg.getPerformanceMetrics}),Ii});var I=_;return I})})(Q0);var M2=Q0.exports;const Th=C2(M2);var D2=P2;function P2(s){var t,n,u;if(s){if(Array.isArray(s)){for(t=[],n=s.length,u=0;u<n;u++){var _=s[u];_!=null&&t.push(_)}return t}if(typeof s=="object"){t={};var v=Object.keys(s);for(n=v.length,u=0;u<n;u++){var I=v[u],l=s[I];l!=null&&(t[I]=l)}return t}}}function L2(s,t){Ki(t,!1);const n=us(),u=()=>Oi(_,"$map",n),{map:_}=tf();let v=bt(t,"position",0,"top-left"),I=bt(t,"container",8,()=>{}),l=Be(null);Qp(()=>{var P;(P=u())!=null&&P.loaded()&&wt(l)&&u().removeControl(wt(l))}),Pe(()=>(u(),wt(l),Ht(I()),Ht(v())),()=>{if(u()&&!wt(l)){let P;typeof I()=="string"?P=document.querySelector(I())??void 0:P=I(),Ce(l,new Th.FullscreenControl({container:P})),u().addControl(wt(l),v())}}),jr(),Ji(),Xi()}function z2(s,t){Ki(t,!1);const n=us(),u=()=>Oi(_,"$map",n),{map:_}=tf();let v=bt(t,"position",0,"top-left"),I=bt(t,"positionOptions",8,()=>{}),l=bt(t,"fitBoundsOptions",8,()=>{}),P=bt(t,"trackUserLocation",0,!1),E=bt(t,"showAccuracyCircle",0,!0),U=bt(t,"showUserLocation",0,!0),j=Be(null);Qp(()=>{var W;(W=u())!=null&&W.loaded()&&wt(j)&&u().removeControl(wt(j))}),Pe(()=>(u(),wt(j),Ht(I()),Ht(l()),Ht(P()),Ht(E()),Ht(U()),Ht(v())),()=>{u()&&!wt(j)&&(Ce(j,new Th.GeolocateControl({positionOptions:I(),fitBoundsOptions:l(),trackUserLocation:P(),showAccuracyCircle:E(),showUserLocation:U()})),u().addControl(wt(j),v()))}),jr(),Ji(),Xi()}function B2(s){let t=s.getCenter(),n=Math.round(s.getZoom()*100)/100,u=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,u),v=Math.round(t.lat*_)/_,I=Math.round(t.lng*_)/_,l=`${n}/${v}/${I}`,P=s.getBearing(),E=s.getPitch();return(P||E)&&(l+=`/${Math.round(P*10)/10}`),E&&(l+=`/${Math.round(E)}`),`#${l}`}function R2(s){return s.replace("#","").split("/").map(parseFloat)}var qd=fg;function fg(s,t){return s===t||s!==s&&t!==t?!0:typeof s!=typeof t||{}.toString.call(s)!={}.toString.call(t)||s!==Object(s)||!s?!1:Array.isArray(s)?W_(s,t):{}.toString.call(s)=="[object Set]"?W_(Array.from(s),Array.from(t)):{}.toString.call(s)=="[object Object]"?O2(s,t):F2(s,t)}function F2(s,t){return s.toString()===t.toString()}function W_(s,t){var n=s.length;if(n!=t.length)return!1;for(var u=0;u<n;u++)if(!fg(s[u],t[u]))return!1;return!0}function O2(s,t){var n=Object.keys(s),u=n.length;if(u!=Object.keys(t).length)return!1;for(var _=0;_<u;_++){var v=n[_];if(!(t.hasOwnProperty(v)&&fg(s[v],t[v])))return!1}return!0}function N2(s,t){Ki(t,!1);const n=us(),u=()=>Oi(_,"$map",n),{map:_}=tf();let v=bt(t,"position",0,"top-left"),I=bt(t,"showCompass",0,!0),l=bt(t,"showZoom",0,!0),P=bt(t,"visualizePitch",0,!1),E=Be(null);Qp(()=>{var U;(U=u())!=null&&U.loaded()&&wt(E)&&u().removeControl(wt(E))}),Pe(()=>(u(),wt(E),Ht(I()),Ht(l()),Ht(P()),Ht(v())),()=>{u()&&!wt(E)&&(Ce(E,new Th.NavigationControl({showCompass:I(),showZoom:l(),visualizePitch:P()})),u().addControl(wt(E),v()))}),jr(),Ji(),Xi()}function U2(s,t){Ki(t,!1);const n=us(),u=()=>Oi(_,"$map",n),{map:_}=tf();let v=bt(t,"position",0,"bottom-left"),I=bt(t,"maxWidth",8,()=>{}),l=bt(t,"unit",0,"metric"),P=Be(null);Qp(()=>{var E;(E=u())!=null&&E.loaded()&&wt(P)&&u().removeControl(wt(P))}),Pe(()=>(u(),wt(P),Ht(I()),Ht(l()),Ht(v())),()=>{u()&&!wt(P)&&(Ce(P,new Th.ScaleControl({maxWidth:I(),unit:l()})),u().addControl(wt(P),v()))}),jr(),Ji(),Xi()}var V2=ue("<!> <!> <!> <!>",1),$2=ue("<!> <!>",1),j2=ue("<div><!></div>");function q2(s,t){Ki(t,!1);const n=us(),u=()=>Oi(he,"$mapInstance",n),_=()=>Oi(ve,"$loadedImages",n),v=Be(),I=Be();let l=bt(t,"map",4,null),P=bt(t,"class",8,()=>{}),E=bt(t,"style"),U=bt(t,"diffStyleUpdates",0,!1),j=bt(t,"center",12,()=>{}),W=bt(t,"zoom",12,()=>{}),tt=bt(t,"pitch",4,0),ct=bt(t,"bearing",4,0),pt=bt(t,"bounds",12,()=>{}),nt=bt(t,"hash",0,!1),it=bt(t,"loaded",4,!1),It=bt(t,"minZoom",0,0),_t=bt(t,"maxZoom",0,22),gt=bt(t,"zoomOnDoubleClick",0,!0),kt=bt(t,"interactive",0,!0),Lt=bt(t,"attributionControl",0,!0),Vt=bt(t,"cooperativeGestures",0,!1),Rt=bt(t,"preserveDrawingBuffer",0,!1),Qt=bt(t,"maxBounds",8,()=>{}),Ut=bt(t,"images",8,()=>[]),me=bt(t,"standardControls",0,!1),jt=bt(t,"filterLayers",8,()=>{}),Bt=bt(t,"transformRequest",8,()=>{});const ae=hg(),{map:he,loadedImages:ve}=A2();let se=new Set;function ne(ye){var Xt;(Xt=u())!=null&&Xt.loaded()&&("url"in ye?(se.add(ye.id),u().loadImage(ye.url,(ze,Mi)=>{var en;se.delete(ye.id),ze?ae("error",ze):Mi&&((en=u())==null||en.addImage(ye.id,Mi,ye.options),_().add(ye.id),Hn(ve,_()))})):(u().addImage(ye.id,ye.data,ye.options),_().add(ye.id),Hn(ve,_())))}let ie=Be(void 0),ci=Be(void 0),ti=Be(void 0),mi=Be(void 0);function di(ye){if(nt()){let Xt=R2(window.location.hash);Xt.length>=3&&(W(Xt[0]),j([Xt[2],Xt[1]])),Xt.length==5&&(ct(Xt[3]),tt(Xt[4]))}return Hn(he,new Th.Map(D2({container:ye,style:E(),center:j(),zoom:W(),pitch:tt(),bearing:ct(),minZoom:It(),maxZoom:_t(),interactive:kt(),preserveDrawingBuffer:Rt(),maxBounds:Qt(),bounds:pt(),attributionControl:Lt(),transformRequest:Bt(),cooperativeGestures:Vt()}))),u().on("load",Xt=>{it(!0),ae("load",u())}),u().on("error",Xt=>ae("error",{...Xt,map:u()})),u().on("movestart",Xt=>ae("movestart",{...Xt,map:u()})),u().on("moveend",Xt=>{if(j(Xt.target.getCenter()),W(Xt.target.getZoom()),pt(Xt.target.getBounds()),ae("moveend",{...Xt,map:u()}),nt()){let ze=window.location.href.replace(/(#.+)?$/,B2(u()));window.history.replaceState(window.history.state,"",ze)}}),u().on("zoomstart",Xt=>ae("zoomstart",{...Xt,map:u()})),u().on("zoom",Xt=>{W(Xt.target.getZoom()),ae("zoom",{...Xt,map:u()})}),u().on("zoomend",Xt=>{W(Xt.target.getZoom()),ae("zoomend",{...Xt,map:u()})}),u().on("style.load",()=>{if(u()){const Xt=u().getStyle();if(Ce(ie,Xt.layers.map(ze=>ze.id)),Ce(ci,Object.keys(Xt.sources)),wt(mi))for(const[ze,Mi]of Object.entries(wt(mi)))u().addSource(ze,Mi);if(wt(ti))for(const ze of wt(ti))u().addLayer(ze)}}),u().on("styledata",Xt=>{if(u()&&jt()){const ze=u().getStyle().layers;if(ze)for(let Mi of ze)jt()(Mi)||u().setLayoutProperty(Mi.id,"visibility","none")}ae("styledata",{...Xt,map:u()})}),{destroy(){var Xt;it(!1),(Xt=u())==null||Xt.remove(),Hn(he,null)}}}let ke=Be(E());Pe(()=>Ht(me()),()=>{Ce(v,typeof me()=="boolean"?void 0:me())}),Pe(()=>u(),()=>{l(u())}),Pe(()=>(Ht(it()),u(),Ht(Ut())),()=>{var ye;if(it()&&((ye=u())!=null&&ye.loaded()))for(let Xt of Ut())!se.has(Xt.id)&&!u().hasImage(Xt.id)&&ne(Xt)}),Pe(()=>(Ht(Ut()),_()),()=>{Ce(I,Ut().every(ye=>_().has(ye.id)))}),Pe(()=>(u(),Ht(E()),wt(ke),wt(ie),wt(ci),Ht(U())),()=>{if(u()&&!qd(E(),wt(ke))){const ye=u().getStyle();if(wt(ie)&&Ce(ti,ye.layers.filter(Xt=>!wt(ie).includes(Xt.id))),wt(ci)){const Xt=Object.keys(ye.sources).filter(ze=>!wt(ci).includes(ze));Ce(mi,{});for(const ze of Xt)Ac(mi,wt(mi)[ze]=ye.sources[ze])}Ce(ke,E()),u().setStyle(E(),{diff:U()})}}),Pe(()=>(Ht(j()),u()),()=>{var ye,Xt;j()&&!qd(j(),(ye=u())==null?void 0:ye.getCenter())&&((Xt=u())==null||Xt.panTo(j()))}),Pe(()=>(Ht(W()),u()),()=>{var ye,Xt;W()&&!qd(W(),(ye=u())==null?void 0:ye.getZoom())&&((Xt=u())==null||Xt.zoomTo(W()))}),Pe(()=>(Ht(pt()),u()),()=>{var ye,Xt;pt()&&!qd(pt(),(ye=u())==null?void 0:ye.getBounds())&&((Xt=u())==null||Xt.fitBounds(pt()))}),Pe(()=>(Ht(gt()),u()),()=>{var ye,Xt;gt()?(ye=u())==null||ye.doubleClickZoom.enable():(Xt=u())==null||Xt.doubleClickZoom.disable()}),jr(),Ji();var Xe=j2(),xi=xe(Xe);zi(xi,()=>u()&&it(),ye=>{var Xt=$2(),ze=De(Xt);zi(ze,me,en=>{var lr=V2(),wn=De(lr);N2(wn,{get position(){return wt(v)},$$legacy:!0});var ir=Ot(Ot(wn,!0));z2(ir,{get position(){return wt(v)},fitBoundsOptions:{maxZoom:12},$$legacy:!0});var yr=Ot(Ot(ir,!0));L2(yr,{get position(){return wt(v)},$$legacy:!0});var Pr=Ot(Ot(yr,!0));U2(Pr,{get position(){return wt(v)},$$legacy:!0}),Et(en,lr)});var Mi=Ot(Ot(ze,!0));vi(Mi,mr(t),{get map(){return u()},get loadedImages(){return _()},get allImagesLoaded(){return wt(I)}},null),Et(ye,Xt)}),we(Xe),je(()=>{Pn(Xe,`${P()??""} svelte-p00lfq`),m2(Xe,"expand-map",!P())}),Fa(Xe,ye=>di(ye)),Et(s,Xe),Xi()}var kh=Uint8Array,ev=Uint16Array,G2=Int32Array,Z2=new kh([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),W2=new kh([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),iv=function(s,t){for(var n=new ev(31),u=0;u<31;++u)n[u]=t+=1<<s[u-1];for(var _=new G2(n[30]),u=1;u<30;++u)for(var v=n[u];v<n[u+1];++v)_[v]=v-n[u]<<5|u;return{b:n,r:_}},rv=iv(Z2,2),H2=rv.b,Y2=rv.r;H2[28]=258,Y2[258]=28;iv(W2,0);var K2=new ev(32768);for(Fi=0;Fi<32768;++Fi)Ho=(Fi&43690)>>1|(Fi&21845)<<1,Ho=(Ho&52428)>>2|(Ho&13107)<<2,Ho=(Ho&61680)>>4|(Ho&3855)<<4,K2[Fi]=((Ho&65280)>>8|(Ho&255)<<8)>>1;var Ho,Fi,ef=new kh(288);for(Fi=0;Fi<144;++Fi)ef[Fi]=8;var Fi;for(Fi=144;Fi<256;++Fi)ef[Fi]=9;var Fi;for(Fi=256;Fi<280;++Fi)ef[Fi]=7;var Fi;for(Fi=280;Fi<288;++Fi)ef[Fi]=8;var Fi,X2=new kh(32);for(Fi=0;Fi<32;++Fi)X2[Fi]=5;var Fi,J2=new kh(0),Q2=typeof TextDecoder<"u"&&new TextDecoder,tS=0;try{Q2.decode(J2,{stream:!0}),tS=1}catch{}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const nv=Symbol("Comlink.proxy"),eS=Symbol("Comlink.endpoint"),iS=Symbol("Comlink.releaseProxy"),xm=Symbol("Comlink.finalizer"),Jd=Symbol("Comlink.thrown"),sv=s=>typeof s=="object"&&s!==null||typeof s=="function",rS={canHandle:s=>sv(s)&&s[nv],serialize(s){const{port1:t,port2:n}=new MessageChannel;return mg(s,t),[n,[n]]},deserialize(s){return s.start(),lv(s)}},nS={canHandle:s=>sv(s)&&Jd in s,serialize({value:s}){let t;return s instanceof Error?t={isError:!0,value:{message:s.message,name:s.name,stack:s.stack}}:t={isError:!1,value:s},[t,[]]},deserialize(s){throw s.isError?Object.assign(new Error(s.value.message),s.value):s.value}},ov=new Map([["proxy",rS],["throw",nS]]);function sS(s,t){for(const n of s)if(t===n||n==="*"||n instanceof RegExp&&n.test(t))return!0;return!1}function mg(s,t=globalThis,n=["*"]){t.addEventListener("message",function u(_){if(!_||!_.data)return;if(!sS(n,_.origin)){console.warn(`Invalid origin '${_.origin}' for comlink proxy`);return}const{id:v,type:I,path:l}=Object.assign({path:[]},_.data),P=(_.data.argumentList||[]).map(yl);let E;try{const U=l.slice(0,-1).reduce((W,tt)=>W[tt],s),j=l.reduce((W,tt)=>W[tt],s);switch(I){case"GET":E=j;break;case"SET":U[l.slice(-1)[0]]=yl(_.data.value),E=!0;break;case"APPLY":E=j.apply(U,P);break;case"CONSTRUCT":{const W=new j(...P);E=hS(W)}break;case"ENDPOINT":{const{port1:W,port2:tt}=new MessageChannel;mg(s,tt),E=uS(W,[W])}break;case"RELEASE":E=void 0;break;default:return}}catch(U){E={value:U,[Jd]:0}}Promise.resolve(E).catch(U=>({value:U,[Jd]:0})).then(U=>{const[j,W]=yp(U);t.postMessage(Object.assign(Object.assign({},j),{id:v}),W),I==="RELEASE"&&(t.removeEventListener("message",u),av(t),xm in s&&typeof s[xm]=="function"&&s[xm]())}).catch(U=>{const[j,W]=yp({value:new TypeError("Unserializable return value"),[Jd]:0});t.postMessage(Object.assign(Object.assign({},j),{id:v}),W)})}),t.start&&t.start()}function oS(s){return s.constructor.name==="MessagePort"}function av(s){oS(s)&&s.close()}function lv(s,t){return Um(s,[],t)}function Gd(s){if(s)throw new Error("Proxy has been released and is not useable")}function cv(s){return fc(s,{type:"RELEASE"}).then(()=>{av(s)})}const mp=new WeakMap,gp="FinalizationRegistry"in globalThis&&new FinalizationRegistry(s=>{const t=(mp.get(s)||0)-1;mp.set(s,t),t===0&&cv(s)});function aS(s,t){const n=(mp.get(t)||0)+1;mp.set(t,n),gp&&gp.register(s,t,s)}function lS(s){gp&&gp.unregister(s)}function Um(s,t=[],n=function(){}){let u=!1;const _=new Proxy(n,{get(v,I){if(Gd(u),I===iS)return()=>{lS(_),cv(s),u=!0};if(I==="then"){if(t.length===0)return{then:()=>_};const l=fc(s,{type:"GET",path:t.map(P=>P.toString())}).then(yl);return l.then.bind(l)}return Um(s,[...t,I])},set(v,I,l){Gd(u);const[P,E]=yp(l);return fc(s,{type:"SET",path:[...t,I].map(U=>U.toString()),value:P},E).then(yl)},apply(v,I,l){Gd(u);const P=t[t.length-1];if(P===eS)return fc(s,{type:"ENDPOINT"}).then(yl);if(P==="bind")return Um(s,t.slice(0,-1));const[E,U]=H_(l);return fc(s,{type:"APPLY",path:t.map(j=>j.toString()),argumentList:E},U).then(yl)},construct(v,I){Gd(u);const[l,P]=H_(I);return fc(s,{type:"CONSTRUCT",path:t.map(E=>E.toString()),argumentList:l},P).then(yl)}});return aS(_,s),_}function cS(s){return Array.prototype.concat.apply([],s)}function H_(s){const t=s.map(yp);return[t.map(n=>n[0]),cS(t.map(n=>n[1]))]}const uv=new WeakMap;function uS(s,t){return uv.set(s,t),s}function hS(s){return Object.assign(s,{[nv]:!0})}function yp(s){for(const[t,n]of ov)if(n.canHandle(s)){const[u,_]=n.serialize(s);return[{type:"HANDLER",name:t,value:u},_]}return[{type:"RAW",value:s},uv.get(s)||[]]}function yl(s){switch(s.type){case"HANDLER":return ov.get(s.name).deserialize(s.value);case"RAW":return s.value}}function fc(s,t,n){return new Promise(u=>{const _=dS();s.addEventListener("message",function v(I){!I.data||!I.data.id||I.data.id!==_||(s.removeEventListener("message",v),u(I.data))}),s.start&&s.start(),s.postMessage(Object.assign({id:_},t),n)})}function dS(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}let si;const hv=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&hv.decode();let sh=null;function Qd(){return(sh===null||sh.byteLength===0)&&(sh=new Uint8Array(si.memory.buffer)),sh}function mo(s,t){return s=s>>>0,hv.decode(Qd().subarray(s,s+t))}let Tc=0;const tp=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},pS=typeof tp.encodeInto=="function"?function(s,t){return tp.encodeInto(s,t)}:function(s,t){const n=tp.encode(s);return t.set(n),{read:s.length,written:n.length}};function Zd(s,t,n){if(n===void 0){const l=tp.encode(s),P=t(l.length,1)>>>0;return Qd().subarray(P,P+l.length).set(l),Tc=l.length,P}let u=s.length,_=t(u,1)>>>0;const v=Qd();let I=0;for(;I<u;I++){const l=s.charCodeAt(I);if(l>127)break;v[_+I]=l}if(I!==u){I!==0&&(s=s.slice(I)),_=n(_,u,u=I+s.length*3,1)>>>0;const l=Qd().subarray(_+I,_+u),P=pS(s,l);I+=P.written,_=n(_,u,I,1)>>>0}return Tc=I,_}function eh(s){return s==null}let gl=null;function Cs(){return(gl===null||gl.buffer.detached===!0||gl.buffer.detached===void 0&&gl.buffer!==si.memory.buffer)&&(gl=new DataView(si.memory.buffer)),gl}function Vm(s){const t=typeof s;if(t=="number"||t=="boolean"||s==null)return`${s}`;if(t=="string")return`"${s}"`;if(t=="symbol"){const _=s.description;return _==null?"Symbol":`Symbol(${_})`}if(t=="function"){const _=s.name;return typeof _=="string"&&_.length>0?`Function(${_})`:"Function"}if(Array.isArray(s)){const _=s.length;let v="[";_>0&&(v+=Vm(s[0]));for(let I=1;I<_;I++)v+=", "+Vm(s[I]);return v+="]",v}const n=/\[object ([^\]]+)\]/.exec(toString.call(s));let u;if(n.length>1)u=n[1];else return toString.call(s);if(u=="Object")try{return"Object("+JSON.stringify(s)+")"}catch{return"Object"}return s instanceof Error?`${s.name}: ${s.message}
${s.stack}`:u}const Y_=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(s=>{si.__wbindgen_export_3.get(s.dtor)(s.a,s.b)});function fS(s,t,n,u){const _={a:s,b:t,cnt:1,dtor:n},v=(...I)=>{_.cnt++;const l=_.a;_.a=0;try{return u(l,_.b,...I)}finally{--_.cnt===0?(si.__wbindgen_export_3.get(_.dtor)(l,_.b),Y_.unregister(_)):_.a=l}};return v.original=_,Y_.register(v,_,_),v}function mS(s,t,n){si.closure949_externref_shim(s,t,n)}function gS(s){const t=si.__wbindgen_export_2.get(s);return si.__externref_table_dealloc(s),t}function fl(s){return()=>{throw new Error(`${s} is not defined`)}}function yS(s){const t=si.__externref_table_alloc();return si.__wbindgen_export_2.set(t,s),t}function Jr(s,t){try{return s.apply(this,t)}catch(n){const u=yS(n);si.__wbindgen_exn_store(u)}}function _S(s,t,n,u){si.closure14102_externref_shim(s,t,n,u)}const vS=["omit","same-origin","include"],bS=["same-origin","no-cors","cors","navigate"],K_=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(s=>si.__wbg_backend_free(s>>>0,1));class rf{static __wrap(t){t=t>>>0;const n=Object.create(rf.prototype);return n.__wbg_ptr=t,K_.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,K_.unregister(this),t}free(){const t=this.__destroy_into_raw();si.__wbg_backend_free(t,0)}constructor(){return si.backend_new()}getCountries(){return si.backend_getCountries(this.__wbg_ptr)}search(t,n){return si.backend_search(this.__wbg_ptr,t,n)}downloadMetrics(t){return si.backend_downloadMetrics(this.__wbg_ptr,t)}downloadMetricsSql(t){return si.backend_downloadMetricsSql(this.__wbg_ptr,t)}downloadGeoms(t){return si.backend_downloadGeoms(this.__wbg_ptr,t)}downloadDataRequest(t){return si.backend_downloadDataRequest(this.__wbg_ptr,t)}downloadDataRequestMetrics(t){return si.backend_downloadDataRequestMetrics(this.__wbg_ptr,t)}downloadDataRequestMetricsSql(t){return si.backend_downloadDataRequestMetricsSql(this.__wbg_ptr,t)}downloadDataRequestGeoms(t){return si.backend_downloadDataRequestGeoms(this.__wbg_ptr,t)}addColours(t){let n,u;try{const I=si.backend_addColours(this.__wbg_ptr,t);var _=I[0],v=I[1];if(I[3])throw _=0,v=0,gS(I[2]);return n=_,u=v,mo(_,v)}finally{si.__wbindgen_free(n,u,1)}}}async function xS(s,t){if(typeof Response=="function"&&s instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(s,t)}catch(u){if(s.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",u);else throw u}const n=await s.arrayBuffer();return await WebAssembly.instantiate(n,t)}else{const n=await WebAssembly.instantiate(s,t);return n instanceof WebAssembly.Instance?{instance:n,module:s}:n}}function wS(){const s={};return s.wbg={},s.wbg.__wbindgen_string_new=function(t,n){return mo(t,n)},s.wbg.__wbindgen_string_get=function(t,n){const u=n,_=typeof u=="string"?u:void 0;var v=eh(_)?0:Zd(_,si.__wbindgen_malloc,si.__wbindgen_realloc),I=Tc;Cs().setInt32(t+4*1,I,!0),Cs().setInt32(t+4*0,v,!0)},s.wbg.__wbg_backend_new=function(t){return rf.__wrap(t)},s.wbg.__wbindgen_error_new=function(t,n){return new Error(mo(t,n))},s.wbg.__wbindgen_cb_drop=function(t){const n=t.original;return n.cnt--==1?(n.a=0,!0):!1},s.wbg.__wbindgen_boolean_get=function(t){const n=t;return typeof n=="boolean"?n?1:0:2},s.wbg.__wbindgen_is_bigint=function(t){return typeof t=="bigint"},s.wbg.__wbindgen_number_get=function(t,n){const u=n,_=typeof u=="number"?u:void 0;Cs().setFloat64(t+8*1,eh(_)?0:_,!0),Cs().setInt32(t+4*0,!eh(_),!0)},s.wbg.__wbindgen_is_object=function(t){const n=t;return typeof n=="object"&&n!==null},s.wbg.__wbindgen_in=function(t,n){return t in n},s.wbg.__wbindgen_bigint_from_i64=function(t){return t},s.wbg.__wbindgen_jsval_eq=function(t,n){return t===n},s.wbg.__wbindgen_bigint_from_u64=function(t){return BigInt.asUintN(64,t)},s.wbg.__wbindgen_is_string=function(t){return typeof t=="string"},s.wbg.__wbindgen_is_undefined=function(t){return t===void 0},s.wbg.__wbindgen_jsval_loose_eq=function(t,n){return t==n},s.wbg.__wbindgen_as_number=function(t){return+t},s.wbg.__wbg_getwithrefkey_edc2c8960f0f1191=function(t,n){return t[n]},s.wbg.__wbg_new_abda76e883ba8a5f=function(){return new Error},s.wbg.__wbg_stack_658279fe44541cf6=function(t,n){const u=n.stack,_=Zd(u,si.__wbindgen_malloc,si.__wbindgen_realloc),v=Tc;Cs().setInt32(t+4*1,v,!0),Cs().setInt32(t+4*0,_,!0)},s.wbg.__wbg_error_f851667af71bcfc6=function(t,n){let u,_;try{u=t,_=n,console.error(mo(t,n))}finally{si.__wbindgen_free(u,_,1)}},s.wbg.__wbg_fetch_f8d735ba6fe1b719=typeof fetch=="function"?fetch:fl("fetch"),s.wbg.__wbg_queueMicrotask_848aa4969108a57e=function(t){return t.queueMicrotask},s.wbg.__wbindgen_is_function=function(t){return typeof t=="function"},s.wbg.__wbg_queueMicrotask_c5419c06eab41e73=typeof queueMicrotask=="function"?queueMicrotask:fl("queueMicrotask"),s.wbg.__wbg_fetch_1fdc4448ed9eec00=function(t,n){return t.fetch(n)},s.wbg.__wbg_debug_69675dd374e2c249=typeof console.debug=="function"?console.debug:fl("console.debug"),s.wbg.__wbg_error_53abcd6a461f73d8=typeof console.error=="function"?console.error:fl("console.error"),s.wbg.__wbg_info_f073b719c8035bbf=typeof console.info=="function"?console.info:fl("console.info"),s.wbg.__wbg_log_f740dc2253ea759b=typeof console.log=="function"?console.log:fl("console.log"),s.wbg.__wbg_warn_41503a1c2194de89=typeof console.warn=="function"?console.warn:fl("console.warn"),s.wbg.__wbg_newwithstrandinit_4b92c89af0a8e383=function(){return Jr(function(t,n,u){return new Request(mo(t,n),u)},arguments)},s.wbg.__wbg_setbody_aa8b691bec428bf4=function(t,n){t.body=n},s.wbg.__wbg_setcredentials_a4e661320cdb9738=function(t,n){t.credentials=vS[n]},s.wbg.__wbg_setheaders_f5205d36e423a544=function(t,n){t.headers=n},s.wbg.__wbg_setmethod_ce2da76000b02f6a=function(t,n,u){t.method=mo(n,u)},s.wbg.__wbg_setmode_4919fd636102c586=function(t,n){t.mode=bS[n]},s.wbg.__wbg_setsignal_812ccb8269a7fd90=function(t,n){t.signal=n},s.wbg.__wbg_new_a9ae04a5200606a5=function(){return Jr(function(){return new Headers},arguments)},s.wbg.__wbg_append_8b3e7f74a47ea7d5=function(){return Jr(function(t,n,u,_,v){t.append(mo(n,u),mo(_,v))},arguments)},s.wbg.__wbg_instanceof_Response_3c0e210a57ff751d=function(t){let n;try{n=t instanceof Response}catch{n=!1}return n},s.wbg.__wbg_url_58af972663531d16=function(t,n){const u=n.url,_=Zd(u,si.__wbindgen_malloc,si.__wbindgen_realloc),v=Tc;Cs().setInt32(t+4*1,v,!0),Cs().setInt32(t+4*0,_,!0)},s.wbg.__wbg_status_5f4e900d22140a18=function(t){return t.status},s.wbg.__wbg_headers_1b9bf90c73fae600=function(t){return t.headers},s.wbg.__wbg_arrayBuffer_144729e09879650e=function(){return Jr(function(t){return t.arrayBuffer()},arguments)},s.wbg.__wbg_text_ebeee8b31af4c919=function(){return Jr(function(t){return t.text()},arguments)},s.wbg.__wbg_signal_9acfcec9e7dffc22=function(t){return t.signal},s.wbg.__wbg_new_75169ae5a9683c55=function(){return Jr(function(){return new AbortController},arguments)},s.wbg.__wbg_abort_c57daab47a6c1215=function(t){t.abort()},s.wbg.__wbg_crypto_1d1f22824a6a080c=function(t){return t.crypto},s.wbg.__wbg_process_4a72847cc503995b=function(t){return t.process},s.wbg.__wbg_versions_f686565e586dd935=function(t){return t.versions},s.wbg.__wbg_node_104a2ff8d6ea03a2=function(t){return t.node},s.wbg.__wbg_require_cca90b1a94a0255b=function(){return Jr(function(){return module.require},arguments)},s.wbg.__wbg_msCrypto_eb05e62b530a1508=function(t){return t.msCrypto},s.wbg.__wbg_randomFillSync_5c9c955aa56b6049=function(){return Jr(function(t,n){t.randomFillSync(n)},arguments)},s.wbg.__wbg_getRandomValues_3aa56aa6edec874c=function(){return Jr(function(t,n){t.getRandomValues(n)},arguments)},s.wbg.__wbg_get_5419cf6b954aa11d=function(t,n){return t[n>>>0]},s.wbg.__wbg_length_f217bbbf7e8e4df4=function(t){return t.length},s.wbg.__wbg_newnoargs_1ede4bf2ebbaaf43=function(t,n){return new Function(mo(t,n))},s.wbg.__wbg_next_13b477da1eaa3897=function(t){return t.next},s.wbg.__wbg_next_b06e115d1b01e10b=function(){return Jr(function(t){return t.next()},arguments)},s.wbg.__wbg_done_983b5ffcaec8c583=function(t){return t.done},s.wbg.__wbg_value_2ab8a198c834c26a=function(t){return t.value},s.wbg.__wbg_iterator_695d699a44d6234c=function(){return Symbol.iterator},s.wbg.__wbg_get_ef828680c64da212=function(){return Jr(function(t,n){return Reflect.get(t,n)},arguments)},s.wbg.__wbg_call_a9ef466721e824f2=function(){return Jr(function(t,n){return t.call(n)},arguments)},s.wbg.__wbg_new_e69b5f66fda8f13c=function(){return new Object},s.wbg.__wbg_self_bf91bf94d9e04084=function(){return Jr(function(){return self.self},arguments)},s.wbg.__wbg_window_52dd9f07d03fd5f8=function(){return Jr(function(){return window.window},arguments)},s.wbg.__wbg_globalThis_05c129bf37fcf1be=function(){return Jr(function(){return globalThis.globalThis},arguments)},s.wbg.__wbg_global_3eca19bb09e9c484=function(){return Jr(function(){return global.global},arguments)},s.wbg.__wbg_isArray_6f3b47f09adb61b5=function(t){return Array.isArray(t)},s.wbg.__wbg_instanceof_ArrayBuffer_74945570b4a62ec7=function(t){let n;try{n=t instanceof ArrayBuffer}catch{n=!1}return n},s.wbg.__wbg_call_3bfa248576352471=function(){return Jr(function(t,n,u){return t.call(n,u)},arguments)},s.wbg.__wbg_instanceof_Map_f96986929e7e89ed=function(t){let n;try{n=t instanceof Map}catch{n=!1}return n},s.wbg.__wbg_isSafeInteger_b9dff570f01a9100=function(t){return Number.isSafeInteger(t)},s.wbg.__wbg_entries_c02034de337d3ee2=function(t){return Object.entries(t)},s.wbg.__wbg_new_1073970097e5a420=function(t,n){try{var u={a:t,b:n},_=(I,l)=>{const P=u.a;u.a=0;try{return _S(P,u.b,I,l)}finally{u.a=P}};return new Promise(_)}finally{u.a=u.b=0}},s.wbg.__wbg_resolve_0aad7c1484731c99=function(t){return Promise.resolve(t)},s.wbg.__wbg_then_748f75edfb032440=function(t,n){return t.then(n)},s.wbg.__wbg_then_4866a7d9f55d8f3e=function(t,n,u){return t.then(n,u)},s.wbg.__wbg_buffer_ccaed51a635d8a2d=function(t){return t.buffer},s.wbg.__wbg_newwithbyteoffsetandlength_7e3eb787208af730=function(t,n,u){return new Uint8Array(t,n>>>0,u>>>0)},s.wbg.__wbg_new_fec2611eb9180f95=function(t){return new Uint8Array(t)},s.wbg.__wbg_set_ec2fcf81bc573fd9=function(t,n,u){t.set(n,u>>>0)},s.wbg.__wbg_length_9254c4bd3b9f23c4=function(t){return t.length},s.wbg.__wbg_instanceof_Uint8Array_df0761410414ef36=function(t){let n;try{n=t instanceof Uint8Array}catch{n=!1}return n},s.wbg.__wbg_newwithlength_76462a666eca145f=function(t){return new Uint8Array(t>>>0)},s.wbg.__wbg_subarray_975a06f9dbd16995=function(t,n,u){return t.subarray(n>>>0,u>>>0)},s.wbg.__wbg_stringify_eead5648c09faaf8=function(){return Jr(function(t){return JSON.stringify(t)},arguments)},s.wbg.__wbg_has_bd717f25f195f23d=function(){return Jr(function(t,n){return Reflect.has(t,n)},arguments)},s.wbg.__wbindgen_bigint_get_as_i64=function(t,n){const u=n,_=typeof u=="bigint"?u:void 0;Cs().setBigInt64(t+8*1,eh(_)?BigInt(0):_,!0),Cs().setInt32(t+4*0,!eh(_),!0)},s.wbg.__wbindgen_debug_string=function(t,n){const u=Vm(n),_=Zd(u,si.__wbindgen_malloc,si.__wbindgen_realloc),v=Tc;Cs().setInt32(t+4*1,v,!0),Cs().setInt32(t+4*0,_,!0)},s.wbg.__wbindgen_throw=function(t,n){throw new Error(mo(t,n))},s.wbg.__wbindgen_memory=function(){return si.memory},s.wbg.__wbindgen_closure_wrapper2224=function(t,n,u){return fS(t,n,950,mS)},s.wbg.__wbindgen_init_externref_table=function(){const t=si.__wbindgen_export_2,n=t.grow(4);t.set(0,void 0),t.set(n+0,void 0),t.set(n+1,null),t.set(n+2,!0),t.set(n+3,!1)},s}function SS(s,t){return si=s.exports,dv.__wbindgen_wasm_module=t,gl=null,sh=null,si.__wbindgen_start(),si}async function dv(s){if(si!==void 0)return si;typeof s<"u"&&(Object.getPrototypeOf(s)===Object.prototype?{module_or_path:s}=s:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof s>"u"&&(s=new URL("rust_backend_bg.wasm",import.meta.url));const t=wS();(typeof s=="string"||typeof Request=="function"&&s instanceof Request||typeof URL=="function"&&s instanceof URL)&&(s=fetch(s));const{instance:n,module:u}=await xS(await s,t);return SS(n,u)}class IS{constructor(){z_(this,"inner");this.inner=null}async initialise(){await dv(),this.inner=await new rf}unset(){this.inner=null}isLoaded(){return this.inner!=null}async addColours(t){if(!this.inner)throw new Error("RustBackend not initialised");const n=JSON.parse(this.inner.addColours(t));return console.log("RustBackend.addColours result",n),n}async getCountries(){if(!this.inner)throw new Error("RustBackend not initialised");const t=JSON.parse(await this.inner.getCountries());return console.log("RustBackend.getCountries result",t),t}async search(t,n){if(!this.inner)throw new Error("RustBackend not initialised");return JSON.parse(await this.inner.search(t,n))}async downloadMetrics(t){if(!this.inner)throw new Error("RustBackend not initialised");return JSON.parse(await this.inner.downloadMetrics(t))}async downloadGeoms(t){if(!this.inner)throw new Error("RustBackend not initialised");return JSON.parse(await this.inner.downloadGeoms(t))}async downloadDataRequestMetrics(t){if(!this.inner)throw new Error("RustBackend not initialised");return await this.inner.downloadDataRequestMetrics(t)}async downloadDataRequestMetricsSql(t){if(!this.inner)throw new Error("RustBackend not initialised");return await this.inner.downloadDataRequestMetricsSql(t)}async downloadDataRequestGeoms(t){if(!this.inner)throw new Error("RustBackend not initialised");return JSON.parse(await this.inner.downloadDataRequestGeoms(t))}async downloadDataRequest(t){if(!this.inner)throw new Error("RustBackend not initialised");return JSON.parse(await this.inner.downloadDataRequest(t))}}mg(IS);const pv=Dr(null),Ah=Dr(null),nf=Dr({kind:"title"}),_p=Dr(""),$m=Dr(""),Cc=Dr([]),X_=Dr([]),fv=Dr({}),gg="-",TS=s=>{const t=AS(s),{conflictingClassGroups:n,conflictingClassGroupModifiers:u}=s;return{getClassGroupId:I=>{const l=I.split(gg);return l[0]===""&&l.length!==1&&l.shift(),mv(l,t)||kS(I)},getConflictingClassGroupIds:(I,l)=>{const P=n[I]||[];return l&&u[I]?[...P,...u[I]]:P}}},mv=(s,t)=>{var I;if(s.length===0)return t.classGroupId;const n=s[0],u=t.nextPart.get(n),_=u?mv(s.slice(1),u):void 0;if(_)return _;if(t.validators.length===0)return;const v=s.join(gg);return(I=t.validators.find(({validator:l})=>l(v)))==null?void 0:I.classGroupId},J_=/^\[(.+)\]$/,kS=s=>{if(J_.test(s)){const t=J_.exec(s)[1],n=t==null?void 0:t.substring(0,t.indexOf(":"));if(n)return"arbitrary.."+n}},AS=s=>{const{theme:t,prefix:n}=s,u={nextPart:new Map,validators:[]};return CS(Object.entries(s.classGroups),n).forEach(([v,I])=>{jm(I,u,v,t)}),u},jm=(s,t,n,u)=>{s.forEach(_=>{if(typeof _=="string"){const v=_===""?t:Q_(t,_);v.classGroupId=n;return}if(typeof _=="function"){if(ES(_)){jm(_(u),t,n,u);return}t.validators.push({validator:_,classGroupId:n});return}Object.entries(_).forEach(([v,I])=>{jm(I,Q_(t,v),n,u)})})},Q_=(s,t)=>{let n=s;return t.split(gg).forEach(u=>{n.nextPart.has(u)||n.nextPart.set(u,{nextPart:new Map,validators:[]}),n=n.nextPart.get(u)}),n},ES=s=>s.isThemeGetter,CS=(s,t)=>t?s.map(([n,u])=>{const _=u.map(v=>typeof v=="string"?t+v:typeof v=="object"?Object.fromEntries(Object.entries(v).map(([I,l])=>[t+I,l])):v);return[n,_]}):s,MS=s=>{if(s<1)return{get:()=>{},set:()=>{}};let t=0,n=new Map,u=new Map;const _=(v,I)=>{n.set(v,I),t++,t>s&&(t=0,u=n,n=new Map)};return{get(v){let I=n.get(v);if(I!==void 0)return I;if((I=u.get(v))!==void 0)return _(v,I),I},set(v,I){n.has(v)?n.set(v,I):_(v,I)}}},gv="!",DS=s=>{const{separator:t,experimentalParseClassName:n}=s,u=t.length===1,_=t[0],v=t.length,I=l=>{const P=[];let E=0,U=0,j;for(let nt=0;nt<l.length;nt++){let it=l[nt];if(E===0){if(it===_&&(u||l.slice(nt,nt+v)===t)){P.push(l.slice(U,nt)),U=nt+v;continue}if(it==="/"){j=nt;continue}}it==="["?E++:it==="]"&&E--}const W=P.length===0?l:l.substring(U),tt=W.startsWith(gv),ct=tt?W.substring(1):W,pt=j&&j>U?j-U:void 0;return{modifiers:P,hasImportantModifier:tt,baseClassName:ct,maybePostfixModifierPosition:pt}};return n?l=>n({className:l,parseClassName:I}):I},PS=s=>{if(s.length<=1)return s;const t=[];let n=[];return s.forEach(u=>{u[0]==="["?(t.push(...n.sort(),u),n=[]):n.push(u)}),t.push(...n.sort()),t},LS=s=>({cache:MS(s.cacheSize),parseClassName:DS(s),...TS(s)}),zS=/\s+/,BS=(s,t)=>{const{parseClassName:n,getClassGroupId:u,getConflictingClassGroupIds:_}=t,v=[],I=s.trim().split(zS);let l="";for(let P=I.length-1;P>=0;P-=1){const E=I[P],{modifiers:U,hasImportantModifier:j,baseClassName:W,maybePostfixModifierPosition:tt}=n(E);let ct=!!tt,pt=u(ct?W.substring(0,tt):W);if(!pt){if(!ct){l=E+(l.length>0?" "+l:l);continue}if(pt=u(W),!pt){l=E+(l.length>0?" "+l:l);continue}ct=!1}const nt=PS(U).join(":"),it=j?nt+gv:nt,It=it+pt;if(v.includes(It))continue;v.push(It);const _t=_(pt,ct);for(let gt=0;gt<_t.length;++gt){const kt=_t[gt];v.push(it+kt)}l=E+(l.length>0?" "+l:l)}return l};function yg(){let s=0,t,n,u="";for(;s<arguments.length;)(t=arguments[s++])&&(n=yv(t))&&(u&&(u+=" "),u+=n);return u}const yv=s=>{if(typeof s=="string")return s;let t,n="";for(let u=0;u<s.length;u++)s[u]&&(t=yv(s[u]))&&(n&&(n+=" "),n+=t);return n};function RS(s,...t){let n,u,_,v=I;function I(P){const E=t.reduce((U,j)=>j(U),s());return n=LS(E),u=n.cache.get,_=n.cache.set,v=l,l(P)}function l(P){const E=u(P);if(E)return E;const U=BS(P,n);return _(P,U),U}return function(){return v(yg.apply(null,arguments))}}const pr=s=>{const t=n=>n[s]||[];return t.isThemeGetter=!0,t},_v=/^\[(?:([a-z-]+):)?(.+)\]$/i,FS=/^\d+\/\d+$/,OS=new Set(["px","full","screen"]),NS=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,US=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,VS=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,$S=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,jS=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Yo=s=>Mc(s)||OS.has(s)||FS.test(s),Aa=s=>Gc(s,"length",XS),Mc=s=>!!s&&!Number.isNaN(Number(s)),wm=s=>Gc(s,"number",Mc),ih=s=>!!s&&Number.isInteger(Number(s)),qS=s=>s.endsWith("%")&&Mc(s.slice(0,-1)),ai=s=>_v.test(s),Ea=s=>NS.test(s),GS=new Set(["length","size","percentage"]),ZS=s=>Gc(s,GS,vv),WS=s=>Gc(s,"position",vv),HS=new Set(["image","url"]),YS=s=>Gc(s,HS,QS),KS=s=>Gc(s,"",JS),rh=()=>!0,Gc=(s,t,n)=>{const u=_v.exec(s);return u?u[1]?typeof t=="string"?u[1]===t:t.has(u[1]):n(u[2]):!1},XS=s=>US.test(s)&&!VS.test(s),vv=()=>!1,JS=s=>$S.test(s),QS=s=>jS.test(s),tI=()=>{const s=pr("colors"),t=pr("spacing"),n=pr("blur"),u=pr("brightness"),_=pr("borderColor"),v=pr("borderRadius"),I=pr("borderSpacing"),l=pr("borderWidth"),P=pr("contrast"),E=pr("grayscale"),U=pr("hueRotate"),j=pr("invert"),W=pr("gap"),tt=pr("gradientColorStops"),ct=pr("gradientColorStopPositions"),pt=pr("inset"),nt=pr("margin"),it=pr("opacity"),It=pr("padding"),_t=pr("saturate"),gt=pr("scale"),kt=pr("sepia"),Lt=pr("skew"),Vt=pr("space"),Rt=pr("translate"),Qt=()=>["auto","contain","none"],Ut=()=>["auto","hidden","clip","visible","scroll"],me=()=>["auto",ai,t],jt=()=>[ai,t],Bt=()=>["",Yo,Aa],ae=()=>["auto",Mc,ai],he=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],ve=()=>["solid","dashed","dotted","double","none"],se=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],ne=()=>["start","end","center","between","around","evenly","stretch"],ie=()=>["","0",ai],ci=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ti=()=>[Mc,ai];return{cacheSize:500,separator:":",theme:{colors:[rh],spacing:[Yo,Aa],blur:["none","",Ea,ai],brightness:ti(),borderColor:[s],borderRadius:["none","","full",Ea,ai],borderSpacing:jt(),borderWidth:Bt(),contrast:ti(),grayscale:ie(),hueRotate:ti(),invert:ie(),gap:jt(),gradientColorStops:[s],gradientColorStopPositions:[qS,Aa],inset:me(),margin:me(),opacity:ti(),padding:jt(),saturate:ti(),scale:ti(),sepia:ie(),skew:ti(),space:jt(),translate:jt()},classGroups:{aspect:[{aspect:["auto","square","video",ai]}],container:["container"],columns:[{columns:[Ea]}],"break-after":[{"break-after":ci()}],"break-before":[{"break-before":ci()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...he(),ai]}],overflow:[{overflow:Ut()}],"overflow-x":[{"overflow-x":Ut()}],"overflow-y":[{"overflow-y":Ut()}],overscroll:[{overscroll:Qt()}],"overscroll-x":[{"overscroll-x":Qt()}],"overscroll-y":[{"overscroll-y":Qt()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[pt]}],"inset-x":[{"inset-x":[pt]}],"inset-y":[{"inset-y":[pt]}],start:[{start:[pt]}],end:[{end:[pt]}],top:[{top:[pt]}],right:[{right:[pt]}],bottom:[{bottom:[pt]}],left:[{left:[pt]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",ih,ai]}],basis:[{basis:me()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",ai]}],grow:[{grow:ie()}],shrink:[{shrink:ie()}],order:[{order:["first","last","none",ih,ai]}],"grid-cols":[{"grid-cols":[rh]}],"col-start-end":[{col:["auto",{span:["full",ih,ai]},ai]}],"col-start":[{"col-start":ae()}],"col-end":[{"col-end":ae()}],"grid-rows":[{"grid-rows":[rh]}],"row-start-end":[{row:["auto",{span:[ih,ai]},ai]}],"row-start":[{"row-start":ae()}],"row-end":[{"row-end":ae()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",ai]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",ai]}],gap:[{gap:[W]}],"gap-x":[{"gap-x":[W]}],"gap-y":[{"gap-y":[W]}],"justify-content":[{justify:["normal",...ne()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...ne(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...ne(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[It]}],px:[{px:[It]}],py:[{py:[It]}],ps:[{ps:[It]}],pe:[{pe:[It]}],pt:[{pt:[It]}],pr:[{pr:[It]}],pb:[{pb:[It]}],pl:[{pl:[It]}],m:[{m:[nt]}],mx:[{mx:[nt]}],my:[{my:[nt]}],ms:[{ms:[nt]}],me:[{me:[nt]}],mt:[{mt:[nt]}],mr:[{mr:[nt]}],mb:[{mb:[nt]}],ml:[{ml:[nt]}],"space-x":[{"space-x":[Vt]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[Vt]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",ai,t]}],"min-w":[{"min-w":[ai,t,"min","max","fit"]}],"max-w":[{"max-w":[ai,t,"none","full","min","max","fit","prose",{screen:[Ea]},Ea]}],h:[{h:[ai,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[ai,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[ai,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[ai,t,"auto","min","max","fit"]}],"font-size":[{text:["base",Ea,Aa]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",wm]}],"font-family":[{font:[rh]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",ai]}],"line-clamp":[{"line-clamp":["none",Mc,wm]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Yo,ai]}],"list-image":[{"list-image":["none",ai]}],"list-style-type":[{list:["none","disc","decimal",ai]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[s]}],"placeholder-opacity":[{"placeholder-opacity":[it]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[s]}],"text-opacity":[{"text-opacity":[it]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...ve(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Yo,Aa]}],"underline-offset":[{"underline-offset":["auto",Yo,ai]}],"text-decoration-color":[{decoration:[s]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:jt()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",ai]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",ai]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[it]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...he(),WS]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",ZS]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},YS]}],"bg-color":[{bg:[s]}],"gradient-from-pos":[{from:[ct]}],"gradient-via-pos":[{via:[ct]}],"gradient-to-pos":[{to:[ct]}],"gradient-from":[{from:[tt]}],"gradient-via":[{via:[tt]}],"gradient-to":[{to:[tt]}],rounded:[{rounded:[v]}],"rounded-s":[{"rounded-s":[v]}],"rounded-e":[{"rounded-e":[v]}],"rounded-t":[{"rounded-t":[v]}],"rounded-r":[{"rounded-r":[v]}],"rounded-b":[{"rounded-b":[v]}],"rounded-l":[{"rounded-l":[v]}],"rounded-ss":[{"rounded-ss":[v]}],"rounded-se":[{"rounded-se":[v]}],"rounded-ee":[{"rounded-ee":[v]}],"rounded-es":[{"rounded-es":[v]}],"rounded-tl":[{"rounded-tl":[v]}],"rounded-tr":[{"rounded-tr":[v]}],"rounded-br":[{"rounded-br":[v]}],"rounded-bl":[{"rounded-bl":[v]}],"border-w":[{border:[l]}],"border-w-x":[{"border-x":[l]}],"border-w-y":[{"border-y":[l]}],"border-w-s":[{"border-s":[l]}],"border-w-e":[{"border-e":[l]}],"border-w-t":[{"border-t":[l]}],"border-w-r":[{"border-r":[l]}],"border-w-b":[{"border-b":[l]}],"border-w-l":[{"border-l":[l]}],"border-opacity":[{"border-opacity":[it]}],"border-style":[{border:[...ve(),"hidden"]}],"divide-x":[{"divide-x":[l]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[l]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[it]}],"divide-style":[{divide:ve()}],"border-color":[{border:[_]}],"border-color-x":[{"border-x":[_]}],"border-color-y":[{"border-y":[_]}],"border-color-s":[{"border-s":[_]}],"border-color-e":[{"border-e":[_]}],"border-color-t":[{"border-t":[_]}],"border-color-r":[{"border-r":[_]}],"border-color-b":[{"border-b":[_]}],"border-color-l":[{"border-l":[_]}],"divide-color":[{divide:[_]}],"outline-style":[{outline:["",...ve()]}],"outline-offset":[{"outline-offset":[Yo,ai]}],"outline-w":[{outline:[Yo,Aa]}],"outline-color":[{outline:[s]}],"ring-w":[{ring:Bt()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[s]}],"ring-opacity":[{"ring-opacity":[it]}],"ring-offset-w":[{"ring-offset":[Yo,Aa]}],"ring-offset-color":[{"ring-offset":[s]}],shadow:[{shadow:["","inner","none",Ea,KS]}],"shadow-color":[{shadow:[rh]}],opacity:[{opacity:[it]}],"mix-blend":[{"mix-blend":[...se(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":se()}],filter:[{filter:["","none"]}],blur:[{blur:[n]}],brightness:[{brightness:[u]}],contrast:[{contrast:[P]}],"drop-shadow":[{"drop-shadow":["","none",Ea,ai]}],grayscale:[{grayscale:[E]}],"hue-rotate":[{"hue-rotate":[U]}],invert:[{invert:[j]}],saturate:[{saturate:[_t]}],sepia:[{sepia:[kt]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[n]}],"backdrop-brightness":[{"backdrop-brightness":[u]}],"backdrop-contrast":[{"backdrop-contrast":[P]}],"backdrop-grayscale":[{"backdrop-grayscale":[E]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[U]}],"backdrop-invert":[{"backdrop-invert":[j]}],"backdrop-opacity":[{"backdrop-opacity":[it]}],"backdrop-saturate":[{"backdrop-saturate":[_t]}],"backdrop-sepia":[{"backdrop-sepia":[kt]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[I]}],"border-spacing-x":[{"border-spacing-x":[I]}],"border-spacing-y":[{"border-spacing-y":[I]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",ai]}],duration:[{duration:ti()}],ease:[{ease:["linear","in","out","in-out",ai]}],delay:[{delay:ti()}],animate:[{animate:["none","spin","ping","pulse","bounce",ai]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[gt]}],"scale-x":[{"scale-x":[gt]}],"scale-y":[{"scale-y":[gt]}],rotate:[{rotate:[ih,ai]}],"translate-x":[{"translate-x":[Rt]}],"translate-y":[{"translate-y":[Rt]}],"skew-x":[{"skew-x":[Lt]}],"skew-y":[{"skew-y":[Lt]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",ai]}],accent:[{accent:["auto",s]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",ai]}],"caret-color":[{caret:[s]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":jt()}],"scroll-mx":[{"scroll-mx":jt()}],"scroll-my":[{"scroll-my":jt()}],"scroll-ms":[{"scroll-ms":jt()}],"scroll-me":[{"scroll-me":jt()}],"scroll-mt":[{"scroll-mt":jt()}],"scroll-mr":[{"scroll-mr":jt()}],"scroll-mb":[{"scroll-mb":jt()}],"scroll-ml":[{"scroll-ml":jt()}],"scroll-p":[{"scroll-p":jt()}],"scroll-px":[{"scroll-px":jt()}],"scroll-py":[{"scroll-py":jt()}],"scroll-ps":[{"scroll-ps":jt()}],"scroll-pe":[{"scroll-pe":jt()}],"scroll-pt":[{"scroll-pt":jt()}],"scroll-pr":[{"scroll-pr":jt()}],"scroll-pb":[{"scroll-pb":jt()}],"scroll-pl":[{"scroll-pl":jt()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",ai]}],fill:[{fill:[s,"none"]}],"stroke-w":[{stroke:[Yo,Aa,wm]}],stroke:[{stroke:[s,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},fr=RS(tI),eI=s=>s;function bv(s){const t=s-1;return t*t*t+1}function iI(s){return s<.5?4*s*s*s:.5*Math.pow(2*s-2,3)+1}function qm(s){const t=typeof s=="string"&&s.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return t?[parseFloat(t[1]),t[2]||"px"]:[s,"px"]}function rI(s,{delay:t=0,duration:n=400,easing:u=iI,amount:_=5,opacity:v=0}={}){const I=getComputedStyle(s),l=+I.opacity,P=I.filter==="none"?"":I.filter,E=l*(1-v),[U,j]=qm(_);return{delay:t,duration:n,easing:u,css:(W,tt)=>`opacity: ${l-E*tt}; filter: ${P} blur(${tt*U}${j});`}}function nI(s,{delay:t=0,duration:n=400,easing:u=eI}={}){const _=+getComputedStyle(s).opacity;return{delay:t,duration:n,easing:u,css:v=>`opacity: ${v*_}`}}function sI(s,{delay:t=0,duration:n=400,easing:u=bv,x:_=0,y:v=0,opacity:I=0}={}){const l=getComputedStyle(s),P=+l.opacity,E=l.transform==="none"?"":l.transform,U=P*(1-I),[j,W]=qm(_),[tt,ct]=qm(v);return{delay:t,duration:n,easing:u,css:(pt,nt)=>`
			transform: ${E} translate(${(1-pt)*j}${W}, ${(1-pt)*tt}${ct});
			opacity: ${P-U*nt}`}}function oI(s,{delay:t=0,duration:n=400,easing:u=bv,axis:_="y"}={}){const v=getComputedStyle(s),I=+v.opacity,l=_==="y"?"height":"width",P=parseFloat(v[l]),E=_==="y"?["top","bottom"]:["left","right"],U=E.map(it=>`${it[0].toUpperCase()}${it.slice(1)}`),j=parseFloat(v[`padding${U[0]}`]),W=parseFloat(v[`padding${U[1]}`]),tt=parseFloat(v[`margin${U[0]}`]),ct=parseFloat(v[`margin${U[1]}`]),pt=parseFloat(v[`border${U[0]}Width`]),nt=parseFloat(v[`border${U[1]}Width`]);return{delay:t,duration:n,easing:u,css:it=>`overflow: hidden;opacity: ${Math.min(it*20,1)*I};${l}: ${it*P}px;padding-${E[0]}: ${it*j}px;padding-${E[1]}: ${it*W}px;margin-${E[0]}: ${it*tt}px;margin-${E[1]}: ${it*ct}px;border-${E[0]}-width: ${it*pt}px;border-${E[1]}-width: ${it*nt}px;`}}const aI={gray:"bg-gray-50 dark:bg-gray-800",red:"bg-red-50 dark:bg-gray-800",yellow:"bg-yellow-50 dark:bg-gray-800 ",green:"bg-green-50 dark:bg-gray-800 ",indigo:"bg-indigo-50 dark:bg-gray-800 ",purple:"bg-purple-50 dark:bg-gray-800 ",pink:"bg-pink-50 dark:bg-gray-800 ",blue:"bg-blue-50 dark:bg-gray-800 ",light:"bg-gray-50 dark:bg-gray-700",dark:"bg-gray-50 dark:bg-gray-800",default:"bg-white dark:bg-gray-800",dropdown:"bg-white dark:bg-gray-700",navbar:"bg-white dark:bg-gray-900",navbarUl:"bg-gray-50 dark:bg-gray-800",form:"bg-gray-50 dark:bg-gray-700",primary:"bg-primary-50 dark:bg-gray-800 ",orange:"bg-orange-50 dark:bg-orange-800",none:""};function lI(s,t){const n=bi(t,["children","$$slots","$$events","$$legacy"]),u=bi(n,["tag","color","rounded","border","shadow","node","use","options","role","transition","params","open"]);Ki(t,!1);const _=()=>{};ns("background",!0);let v=bt(t,"tag",8,()=>u.href?"a":"div"),I=bt(t,"color",4,"default"),l=bt(t,"rounded",0,!1),P=bt(t,"border",0,!1),E=bt(t,"shadow",0,!1),U=bt(t,"node",12,()=>{}),j=bt(t,"use",0,_),W=bt(t,"options",8,()=>({})),tt=bt(t,"role",8,()=>{}),ct=bt(t,"transition",8,()=>{}),pt=bt(t,"params",8,()=>({})),nt=bt(t,"open",0,!0);const it=hg(),It={gray:"text-gray-800 dark:text-gray-300",red:"text-red-800 dark:text-red-400",yellow:"text-yellow-800 dark:text-yellow-300",green:"text-green-800 dark:text-green-400",indigo:"text-indigo-800 dark:text-indigo-400",purple:"text-purple-800 dark:text-purple-400",pink:"text-pink-800 dark:text-pink-400",blue:"text-blue-800 dark:text-blue-400",light:"text-gray-700 dark:text-gray-300",dark:"text-gray-700 dark:text-gray-300",default:"text-gray-500 dark:text-gray-400",dropdown:"text-gray-700 dark:text-gray-200",navbar:"text-gray-700 dark:text-gray-200",navbarUl:"text-gray-700 dark:text-gray-400",form:"text-gray-900 dark:text-white",primary:"text-primary-800 dark:text-primary-400",orange:"text-orange-800 dark:text-orange-400",none:""},_t={gray:"border-gray-300 dark:border-gray-800 divide-gray-300 dark:divide-gray-800",red:"border-red-300 dark:border-red-800 divide-red-300 dark:divide-red-800",yellow:"border-yellow-300 dark:border-yellow-800 divide-yellow-300 dark:divide-yellow-800",green:"border-green-300 dark:border-green-800 divide-green-300 dark:divide-green-800",indigo:"border-indigo-300 dark:border-indigo-800 divide-indigo-300 dark:divide-indigo-800",purple:"border-purple-300 dark:border-purple-800 divide-purple-300 dark:divide-purple-800",pink:"border-pink-300 dark:border-pink-800 divide-pink-300 dark:divide-pink-800",blue:"border-blue-300 dark:border-blue-800 divide-blue-300 dark:divide-blue-800",light:"border-gray-500 divide-gray-500",dark:"border-gray-500 divide-gray-500",default:"border-gray-200 dark:border-gray-700 divide-gray-200 dark:divide-gray-700",dropdown:"border-gray-100 dark:border-gray-600 divide-gray-100 dark:divide-gray-600",navbar:"border-gray-100 dark:border-gray-700 divide-gray-100 dark:divide-gray-700",navbarUl:"border-gray-100 dark:border-gray-700 divide-gray-100 dark:divide-gray-700",form:"border-gray-300 dark:border-gray-700 divide-gray-300 dark:divide-gray-700",primary:"border-primary-500 dark:border-primary-200  divide-primary-500 dark:divide-primary-200 ",orange:"border-orange-300 dark:border-orange-800 divide-orange-300 dark:divide-orange-800",none:""};let gt=Be();Pe(()=>Ht(nt()),()=>{it(nt()?"open":"close")}),Pe(()=>Ht(nt()),()=>{it("show",nt())}),Pe(()=>Ht(I()),()=>{I(I()??"default")}),Pe(()=>Ht(I()),()=>{ns("color",I())}),Pe(()=>(Ht(I()),Ht(l()),Ht(P()),Ht(E()),Ht(n)),()=>{Ce(gt,fr(aI[I()],It[I()],l()&&"rounded-lg",P()&&"border",_t[I()],E()&&"shadow-md",n.class))}),jr(),Ji();var kt=Ai(),Lt=De(kt);zi(Lt,()=>ct()&&nt(),Vt=>{var Rt=Ai(),Qt=De(Rt);gh(Qt,v,!1,(Ut,me)=>{wl(Ut,he=>U(he),()=>U());let jt;je(()=>jt=yh(Ut,jt,{role:tt(),...u,class:wt(gt)},"")),K0(3,Ut,ct,pt),Fa(Ut,(he,ve)=>j()(he,ve),W),re("click",Ut,function(he){oe.call(this,t,he)}),re("mouseenter",Ut,function(he){oe.call(this,t,he)}),re("mouseleave",Ut,function(he){oe.call(this,t,he)}),re("focusin",Ut,function(he){oe.call(this,t,he)}),re("focusout",Ut,function(he){oe.call(this,t,he)});var Bt=Ai(),ae=De(Bt);vi(ae,mr(t),{},null),Et(me,Bt)}),Et(Vt,Rt)},Vt=>{var Rt=Ai(),Qt=De(Rt);zi(Qt,nt,Ut=>{var me=Ai(),jt=De(me);gh(jt,v,!1,(Bt,ae)=>{wl(Bt,ne=>U(ne),()=>U());let he;je(()=>he=yh(Bt,he,{role:tt(),...u,class:wt(gt)},"")),Fa(Bt,(ne,ie)=>j()(ne,ie),W),re("click",Bt,function(ne){oe.call(this,t,ne)}),re("mouseenter",Bt,function(ne){oe.call(this,t,ne)}),re("mouseleave",Bt,function(ne){oe.call(this,t,ne)}),re("focusin",Bt,function(ne){oe.call(this,t,ne)}),re("focusout",Bt,function(ne){oe.call(this,t,ne)});var ve=Ai(),se=De(ve);vi(se,mr(t),{},null),Et(ae,ve)}),Et(Ut,me)},null,!0),Et(Vt,Rt)}),Et(s,kt),Xi()}var cI=ue('<span class="sr-only"> </span>'),uI=ue("<a><!> <!></a>"),hI=ue('<span class="sr-only"> </span>'),dI=ue("<button><!> <!></button>");function pI(s,t){const n=bi(t,["children","$$slots","$$events","$$legacy"]),u=bi(n,["color","name","ariaLabel","size","href"]);Ki(t,!1);let _=bt(t,"color",0,"default"),v=bt(t,"name",8,()=>{}),I=bt(t,"ariaLabel",8,()=>{}),l=bt(t,"size",0,"md"),P=bt(t,"href",8,()=>{});const E=qr("background"),U={dark:"text-gray-500 hover:text-gray-900 hover:bg-gray-200 dark:text-gray-400 dark:hover:text-white dark:hover:bg-gray-600",gray:"text-gray-500 focus:ring-gray-400 hover:bg-gray-200 dark:hover:bg-gray-800 dark:hover:text-gray-300",red:"text-red-500 focus:ring-red-400 hover:bg-red-200 dark:hover:bg-red-800 dark:hover:text-red-300",yellow:"text-yellow-500 focus:ring-yellow-400 hover:bg-yellow-200 dark:hover:bg-yellow-800 dark:hover:text-yellow-300",green:"text-green-500 focus:ring-green-400 hover:bg-green-200 dark:hover:bg-green-800 dark:hover:text-green-300",indigo:"text-indigo-500 focus:ring-indigo-400 hover:bg-indigo-200 dark:hover:bg-indigo-800 dark:hover:text-indigo-300",purple:"text-purple-500 focus:ring-purple-400 hover:bg-purple-200 dark:hover:bg-purple-800 dark:hover:text-purple-300",pink:"text-pink-500 focus:ring-pink-400 hover:bg-pink-200 dark:hover:bg-pink-800 dark:hover:text-pink-300",blue:"text-blue-500 focus:ring-blue-400 hover:bg-blue-200 dark:hover:bg-blue-800 dark:hover:text-blue-300",primary:"text-primary-500 focus:ring-primary-400 hover:bg-primary-200 dark:hover:bg-primary-800 dark:hover:text-primary-300",default:"focus:ring-gray-400 hover:bg-gray-100"},j={xs:"m-0.5 rounded-sm focus:ring-1 p-0.5",sm:"m-0.5 rounded focus:ring-1 p-0.5",md:"m-0.5 rounded-lg focus:ring-2 p-1.5",lg:"m-0.5 rounded-lg focus:ring-2 p-2.5"};let W=Be();const tt={xs:"w-3 h-3",sm:"w-3.5 h-3.5",md:"w-5 h-5",lg:"w-5 h-5"};Pe(()=>(Ht(l()),Ht(_()),Ht(n)),()=>{Ce(W,fr("focus:outline-none whitespace-normal",j[l()],U[_()],_()==="default"&&(E?"dark:hover:bg-gray-600":"dark:hover:bg-gray-700"),n.class))}),jr(),Ji();var ct=Ai(),pt=De(ct);zi(pt,P,nt=>{var it=uI();let It;var _t=xe(it);zi(_t,v,kt=>{var Lt=cI(),Vt=xe(Lt);we(Lt),je(()=>bn(Vt,v())),Et(kt,Lt)});var gt=Ot(Ot(_t,!0));vi(gt,mr(t),{get svgSize(){return tt[l()]}},null),we(it),je(()=>It=xn(it,It,{href:P(),...u,class:wt(W),"aria-label":I()??v()},!0,"")),Et(nt,it)},nt=>{var it=dI();let It;var _t=xe(it);zi(_t,v,kt=>{var Lt=hI(),Vt=xe(Lt);we(Lt),je(()=>bn(Vt,v())),Et(kt,Lt)});var gt=Ot(Ot(_t,!0));vi(gt,mr(t),{get svgSize(){return tt[l()]}},null),we(it),je(()=>It=xn(it,It,{type:"button",...u,class:wt(W),"aria-label":I()??v()},!0,"")),re("click",it,function(kt){oe.call(this,t,kt)}),Et(nt,it)}),Et(s,ct),Xi()}var fI=qa('<svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>');function mI(s,t){const n=bi(t,["children","$$slots","$$events","$$legacy"]),u=bi(n,["name"]);Ki(t,!1);let _=bt(t,"name",0,"Close");Ji();var v=Rm(()=>fr("ms-auto",n.class));pI(s,dg({get name(){return _()}},()=>u,{get class(){return wt(v)},$$events:{click(I){oe.call(this,t,I)}},children:n2,$$slots:{default:(I,l)=>{const P=Rm(()=>l.svgSize);var E=fI();xe(E),we(E),je(()=>Z0(E,wt(P))),Et(I,E)}},$$legacy:!0})),Xi()}var gI=ue("<a><!></a>"),yI=ue("<button><!></button>");function vl(s,t){const n=bi(t,["children","$$slots","$$events","$$legacy"]),u=bi(n,["pill","outline","size","href","type","color","shadow","tag","checked","disabled"]);Ki(t,!1);const _=qr("group");let v=bt(t,"pill",0,!1),I=bt(t,"outline",0,!1),l=bt(t,"size",0,_?"sm":"md"),P=bt(t,"href",8,()=>{}),E=bt(t,"type",0,"button"),U=bt(t,"color",8,()=>_?I()?"dark":"alternative":"primary"),j=bt(t,"shadow",0,!1),W=bt(t,"tag",0,"button"),tt=bt(t,"checked",8,()=>{}),ct=bt(t,"disabled",0,!1);const pt={alternative:"text-gray-900 bg-white border border-gray-200 hover:bg-gray-100 dark:bg-gray-800 dark:text-gray-400 hover:text-primary-700 focus-within:text-primary-700 dark:focus-within:text-white dark:hover:text-white dark:hover:bg-gray-700",blue:"text-white bg-blue-700 hover:bg-blue-800 dark:bg-blue-600 dark:hover:bg-blue-700",dark:"text-white bg-gray-800 hover:bg-gray-900 dark:bg-gray-800 dark:hover:bg-gray-700",green:"text-white bg-green-700 hover:bg-green-800 dark:bg-green-600 dark:hover:bg-green-700",light:"text-gray-900 bg-white border border-gray-300 hover:bg-gray-100 dark:bg-gray-800 dark:text-white dark:border-gray-600 dark:hover:bg-gray-700 dark:hover:border-gray-600",primary:"text-white bg-primary-700 hover:bg-primary-800 dark:bg-primary-600 dark:hover:bg-primary-700",purple:"text-white bg-purple-700 hover:bg-purple-800 dark:bg-purple-600 dark:hover:bg-purple-700",red:"text-white bg-red-700 hover:bg-red-800 dark:bg-red-600 dark:hover:bg-red-700",yellow:"text-white bg-yellow-400 hover:bg-yellow-500 ",none:""},nt={alternative:"text-primary-700 border dark:text-primary-500 bg-gray-100 dark:bg-gray-700 border-gray-300 shadow-gray-300 dark:shadow-gray-800 shadow-inner",blue:"text-blue-900 bg-blue-400 dark:bg-blue-500 shadow-blue-700 dark:shadow-blue-800 shadow-inner",dark:"text-white bg-gray-500 dark:bg-gray-600 shadow-gray-800 dark:shadow-gray-900 shadow-inner",green:"text-green-900 bg-green-400 dark:bg-green-500 shadow-green-700 dark:shadow-green-800 shadow-inner",light:"text-gray-900 bg-gray-100 border border-gray-300 dark:bg-gray-500 dark:text-gray-900 dark:border-gray-700 shadow-gray-300 dark:shadow-gray-700 shadow-inner",primary:"text-primary-900 bg-primary-400 dark:bg-primary-500 shadow-primary-700 dark:shadow-primary-800 shadow-inner",purple:"text-purple-900 bg-purple-400 dark:bg-purple-500 shadow-purple-700 dark:shadow-purple-800 shadow-inner",red:"text-red-900 bg-red-400 dark:bg-red-500 shadow-red-700 dark:shadow-red-800 shadow-inner",yellow:"text-yellow-900 bg-yellow-300 dark:bg-yellow-400 shadow-yellow-500 dark:shadow-yellow-700 shadow-inner",none:""},it={alternative:"focus-within:ring-gray-200 dark:focus-within:ring-gray-700",blue:"focus-within:ring-blue-300 dark:focus-within:ring-blue-800",dark:"focus-within:ring-gray-300 dark:focus-within:ring-gray-700",green:"focus-within:ring-green-300 dark:focus-within:ring-green-800",light:"focus-within:ring-gray-200 dark:focus-within:ring-gray-700",primary:"focus-within:ring-primary-300 dark:focus-within:ring-primary-800",purple:"focus-within:ring-purple-300 dark:focus-within:ring-purple-900",red:"focus-within:ring-red-300 dark:focus-within:ring-red-900",yellow:"focus-within:ring-yellow-300 dark:focus-within:ring-yellow-900",none:""},It={alternative:"shadow-gray-500/50 dark:shadow-gray-800/80",blue:"shadow-blue-500/50 dark:shadow-blue-800/80",dark:"shadow-gray-500/50 dark:shadow-gray-800/80",green:"shadow-green-500/50 dark:shadow-green-800/80",light:"shadow-gray-500/50 dark:shadow-gray-800/80",primary:"shadow-primary-500/50 dark:shadow-primary-800/80",purple:"shadow-purple-500/50 dark:shadow-purple-800/80",red:"shadow-red-500/50 dark:shadow-red-800/80 ",yellow:"shadow-yellow-500/50 dark:shadow-yellow-800/80 ",none:""},_t={alternative:"text-gray-900 dark:text-gray-400 hover:text-white border border-gray-800 hover:bg-gray-900 focus-within:bg-gray-900 focus-within:text-white focus-within:ring-gray-300 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-600 dark:focus-within:ring-gray-800",blue:"text-blue-700 hover:text-white border border-blue-700 hover:bg-blue-800 dark:border-blue-500 dark:text-blue-500 dark:hover:text-white dark:hover:bg-blue-600",dark:"text-gray-900 hover:text-white border border-gray-800 hover:bg-gray-900 focus-within:bg-gray-900 focus-within:text-white dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-600",green:"text-green-700 hover:text-white border border-green-700 hover:bg-green-800 dark:border-green-500 dark:text-green-500 dark:hover:text-white dark:hover:bg-green-600",light:"text-gray-500 hover:text-gray-900 bg-white border border-gray-200 dark:border-gray-600 dark:hover:text-white dark:text-gray-400 hover:bg-gray-50 dark:bg-gray-700 dark:hover:bg-gray-600",primary:"text-primary-700 hover:text-white border border-primary-700 hover:bg-primary-700 dark:border-primary-500 dark:text-primary-500 dark:hover:text-white dark:hover:bg-primary-600",purple:"text-purple-700 hover:text-white border border-purple-700 hover:bg-purple-800 dark:border-purple-400 dark:text-purple-400 dark:hover:text-white dark:hover:bg-purple-500",red:"text-red-700 hover:text-white border border-red-700 hover:bg-red-800 dark:border-red-500 dark:text-red-500 dark:hover:text-white dark:hover:bg-red-600",yellow:"text-yellow-400 hover:text-white border border-yellow-400 hover:bg-yellow-500 dark:border-yellow-300 dark:text-yellow-300 dark:hover:text-white dark:hover:bg-yellow-400",none:""},gt={xs:"px-3 py-2 text-xs",sm:"px-4 py-2 text-sm",md:"px-5 py-2.5 text-sm",lg:"px-5 py-3 text-base",xl:"px-6 py-3.5 text-base"},kt=()=>I()||U()==="alternative"||U()==="light";let Lt=Be();Pe(()=>(Ht(l()),Ht(I()),Ht(tt()),Ht(U()),Ht(v()),Ht(j()),Ht(ct()),Ht(n)),()=>{Ce(Lt,fr("text-center font-medium",_?"focus-within:ring-2":"focus-within:ring-4",_&&"focus-within:z-10",_||"focus-within:outline-none","inline-flex items-center justify-center "+gt[l()],I()&&tt()&&"border dark:border-gray-900",I()&&tt()&&nt[U()],I()&&!tt()&&_t[U()],!I()&&tt()&&nt[U()],!I()&&!tt()&&pt[U()],U()==="alternative"&&(_&&!tt()?"dark:bg-gray-700 dark:text-white dark:border-gray-700 dark:hover:border-gray-600 dark:hover:bg-gray-600":"dark:bg-transparent dark:border-gray-600 dark:hover:border-gray-600"),I()&&U()==="dark"&&(_?tt()?"bg-gray-900 border-gray-800 dark:border-white dark:bg-gray-600":"dark:text-white border-gray-800 dark:border-white":"dark:text-gray-400 dark:border-gray-700"),it[U()],kt()&&_&&"[&:not(:first-child)]:-ms-px",_?v()&&"first:rounded-s-full last:rounded-e-full"||"first:rounded-s-lg last:rounded-e-lg":v()&&"rounded-full"||"rounded-lg",j()&&"shadow-lg",j()&&It[U()],ct()&&"cursor-not-allowed opacity-50",n.class))}),jr(),Ji();var Vt=Ai(),Rt=De(Vt);zi(Rt,()=>P()&&!ct(),Qt=>{var Ut=gI();let me;var jt=xe(Ut);vi(jt,mr(t),{},null),we(Ut),je(()=>me=xn(Ut,me,{href:P(),...u,class:wt(Lt),role:"button"},!0,"")),re("click",Ut,function(Bt){oe.call(this,t,Bt)}),re("change",Ut,function(Bt){oe.call(this,t,Bt)}),re("keydown",Ut,function(Bt){oe.call(this,t,Bt)}),re("keyup",Ut,function(Bt){oe.call(this,t,Bt)}),re("touchstart",Ut,function(Bt){oe.call(this,t,Bt)}),re("touchend",Ut,function(Bt){oe.call(this,t,Bt)}),re("touchcancel",Ut,function(Bt){oe.call(this,t,Bt)}),re("mouseenter",Ut,function(Bt){oe.call(this,t,Bt)}),re("mouseleave",Ut,function(Bt){oe.call(this,t,Bt)}),Et(Qt,Ut)},Qt=>{var Ut=Ai(),me=De(Ut);zi(me,()=>W()==="button",jt=>{var Bt=yI();let ae;var he=xe(Bt);vi(he,mr(t),{},null),we(Bt),je(()=>ae=xn(Bt,ae,{type:E(),...u,disabled:ct(),class:wt(Lt)},!0,"")),re("click",Bt,function(ve){oe.call(this,t,ve)}),re("change",Bt,function(ve){oe.call(this,t,ve)}),re("keydown",Bt,function(ve){oe.call(this,t,ve)}),re("keyup",Bt,function(ve){oe.call(this,t,ve)}),re("touchstart",Bt,function(ve){oe.call(this,t,ve)}),re("touchend",Bt,function(ve){oe.call(this,t,ve)}),re("touchcancel",Bt,function(ve){oe.call(this,t,ve)}),re("mouseenter",Bt,function(ve){oe.call(this,t,ve)}),re("mouseleave",Bt,function(ve){oe.call(this,t,ve)}),Et(jt,Bt)},jt=>{var Bt=Ai(),ae=De(Bt);gh(ae,W,!1,(he,ve)=>{let se;je(()=>se=yh(he,se,{...u,class:wt(Lt)},""));var ne=Ai(),ie=De(ne);vi(ie,mr(t),{},null),Et(ve,ne)}),Et(jt,Bt)},!0),Et(Qt,Ut)}),Et(s,Vt),Xi()}const _I=(s,t)=>{const n=u=>{u!=null&&u.target&&s&&!s.contains(u.target)&&!u.defaultPrevented&&t()};return document.addEventListener("click",n,!0),{destroy(){document.removeEventListener("click",n,!0)}}};var vI=ue('<div role="presentation"></div>'),bI=ue('<div role="presentation"></div>'),xI=ue("<!> <div><!></div>",1);function wI(s,t){const n=bi(t,["children","$$slots","$$events","$$legacy"]),u=bi(n,["activateClickOutside","hidden","position","leftOffset","rightOffset","topOffset","bottomOffset","width","backdrop","bgColor","bgOpacity","placement","id","divClass","transitionParams","transitionType"]);Ki(t,!1);let _=bt(t,"activateClickOutside",0,!0),v=bt(t,"hidden",4,!0),I=bt(t,"position",0,"fixed"),l=bt(t,"leftOffset",0,"inset-y-0 start-0"),P=bt(t,"rightOffset",0,"inset-y-0 end-0"),E=bt(t,"topOffset",0,"inset-x-0 top-0"),U=bt(t,"bottomOffset",0,"inset-x-0 bottom-0"),j=bt(t,"width",0,"w-80"),W=bt(t,"backdrop",0,!0),tt=bt(t,"bgColor",0,"bg-gray-900"),ct=bt(t,"bgOpacity",0,"bg-opacity-75"),pt=bt(t,"placement",0,"left"),nt=bt(t,"id",0,"drawer-example"),it=bt(t,"divClass",0,"overflow-y-auto z-50 p-4 bg-white dark:bg-gray-800"),It=bt(t,"transitionParams",8,()=>({})),_t=bt(t,"transitionType",0,"fly");function gt(jt,Bt){switch(_t()){case"slide":return oI(jt,Bt);case"blur":return rI(jt,Bt);case"fade":return nI(jt,Bt);default:return sI(jt,Bt)}}const kt={left:l(),right:P(),top:E(),bottom:U()},Lt=()=>{v(!v())},Vt=()=>_()&&!v()&&Lt();let Rt=fr("fixed top-0 start-0 z-50 w-full h-full",W()&&tt(),W()&&ct());function Qt(jt,Bt){return _()?_I(jt,Bt):void 0}Ji();var Ut=Ai(),me=De(Ut);zi(me,()=>!v(),jt=>{var Bt=xI(),ae=De(Bt);zi(ae,()=>W()&&_(),ne=>{var ie=vI(),ci=$0(()=>()=>!v()&&Lt());Pn(ie,Rt),re("click",ie,function(...ti){var mi;return(mi=wt(ci))==null?void 0:mi.apply(this,ti)},!1),Et(ne,ie)},ne=>{var ie=Ai(),ci=De(ie);zi(ci,()=>W()&&!_(),ti=>{var mi=bI();Pn(mi,Rt),Et(ti,mi)},null,!0),Et(ne,ie)});var he=Ot(Ot(ae,!0));let ve;var se=xe(he);vi(se,mr(t),{get hidden(){return v()}},null),we(he),je(()=>ve=xn(he,ve,{id:nt(),...u,class:fr(it(),j(),I(),kt[pt()],n.class),tabindex:"-1","aria-controls":nt(),"aria-labelledby":nt()},!0,"")),Fa(he,(ne,ie)=>Qt(ne,ie),()=>Vt),K0(3,he,()=>gt,It),Et(jt,Bt)}),Et(s,Ut),Xi()}const Rc=Math.min,bl=Math.max,vp=Math.round,Wd=Math.floor,Oa=s=>({x:s,y:s}),SI={left:"right",right:"left",bottom:"top",top:"bottom"},II={start:"end",end:"start"};function Gm(s,t,n){return bl(s,Rc(t,n))}function Eh(s,t){return typeof s=="function"?s(t):s}function Sl(s){return s.split("-")[0]}function Ch(s){return s.split("-")[1]}function xv(s){return s==="x"?"y":"x"}function _g(s){return s==="y"?"height":"width"}function Fc(s){return["top","bottom"].includes(Sl(s))?"y":"x"}function vg(s){return xv(Fc(s))}function TI(s,t,n){n===void 0&&(n=!1);const u=Ch(s),_=vg(s),v=_g(_);let I=_==="x"?u===(n?"end":"start")?"right":"left":u==="start"?"bottom":"top";return t.reference[v]>t.floating[v]&&(I=bp(I)),[I,bp(I)]}function kI(s){const t=bp(s);return[Zm(s),t,Zm(t)]}function Zm(s){return s.replace(/start|end/g,t=>II[t])}function AI(s,t,n){const u=["left","right"],_=["right","left"],v=["top","bottom"],I=["bottom","top"];switch(s){case"top":case"bottom":return n?t?_:u:t?u:_;case"left":case"right":return t?v:I;default:return[]}}function EI(s,t,n,u){const _=Ch(s);let v=AI(Sl(s),n==="start",u);return _&&(v=v.map(I=>I+"-"+_),t&&(v=v.concat(v.map(Zm)))),v}function bp(s){return s.replace(/left|right|bottom|top/g,t=>SI[t])}function CI(s){return{top:0,right:0,bottom:0,left:0,...s}}function wv(s){return typeof s!="number"?CI(s):{top:s,right:s,bottom:s,left:s}}function xp(s){const{x:t,y:n,width:u,height:_}=s;return{width:u,height:_,top:n,left:t,right:t+u,bottom:n+_,x:t,y:n}}function t0(s,t,n){let{reference:u,floating:_}=s;const v=Fc(t),I=vg(t),l=_g(I),P=Sl(t),E=v==="y",U=u.x+u.width/2-_.width/2,j=u.y+u.height/2-_.height/2,W=u[l]/2-_[l]/2;let tt;switch(P){case"top":tt={x:U,y:u.y-_.height};break;case"bottom":tt={x:U,y:u.y+u.height};break;case"right":tt={x:u.x+u.width,y:j};break;case"left":tt={x:u.x-_.width,y:j};break;default:tt={x:u.x,y:u.y}}switch(Ch(t)){case"start":tt[I]-=W*(n&&E?-1:1);break;case"end":tt[I]+=W*(n&&E?-1:1);break}return tt}const MI=async(s,t,n)=>{const{placement:u="bottom",strategy:_="absolute",middleware:v=[],platform:I}=n,l=v.filter(Boolean),P=await(I.isRTL==null?void 0:I.isRTL(t));let E=await I.getElementRects({reference:s,floating:t,strategy:_}),{x:U,y:j}=t0(E,u,P),W=u,tt={},ct=0;for(let pt=0;pt<l.length;pt++){const{name:nt,fn:it}=l[pt],{x:It,y:_t,data:gt,reset:kt}=await it({x:U,y:j,initialPlacement:u,placement:W,strategy:_,middlewareData:tt,rects:E,platform:I,elements:{reference:s,floating:t}});U=It??U,j=_t??j,tt={...tt,[nt]:{...tt[nt],...gt}},kt&&ct<=50&&(ct++,typeof kt=="object"&&(kt.placement&&(W=kt.placement),kt.rects&&(E=kt.rects===!0?await I.getElementRects({reference:s,floating:t,strategy:_}):kt.rects),{x:U,y:j}=t0(E,W,P)),pt=-1)}return{x:U,y:j,placement:W,strategy:_,middlewareData:tt}};async function Sv(s,t){var n;t===void 0&&(t={});const{x:u,y:_,platform:v,rects:I,elements:l,strategy:P}=s,{boundary:E="clippingAncestors",rootBoundary:U="viewport",elementContext:j="floating",altBoundary:W=!1,padding:tt=0}=Eh(t,s),ct=wv(tt),nt=l[W?j==="floating"?"reference":"floating":j],it=xp(await v.getClippingRect({element:(n=await(v.isElement==null?void 0:v.isElement(nt)))==null||n?nt:nt.contextElement||await(v.getDocumentElement==null?void 0:v.getDocumentElement(l.floating)),boundary:E,rootBoundary:U,strategy:P})),It=j==="floating"?{x:u,y:_,width:I.floating.width,height:I.floating.height}:I.reference,_t=await(v.getOffsetParent==null?void 0:v.getOffsetParent(l.floating)),gt=await(v.isElement==null?void 0:v.isElement(_t))?await(v.getScale==null?void 0:v.getScale(_t))||{x:1,y:1}:{x:1,y:1},kt=xp(v.convertOffsetParentRelativeRectToViewportRelativeRect?await v.convertOffsetParentRelativeRectToViewportRelativeRect({elements:l,rect:It,offsetParent:_t,strategy:P}):It);return{top:(it.top-kt.top+ct.top)/gt.y,bottom:(kt.bottom-it.bottom+ct.bottom)/gt.y,left:(it.left-kt.left+ct.left)/gt.x,right:(kt.right-it.right+ct.right)/gt.x}}const DI=s=>({name:"arrow",options:s,async fn(t){const{x:n,y:u,placement:_,rects:v,platform:I,elements:l,middlewareData:P}=t,{element:E,padding:U=0}=Eh(s,t)||{};if(E==null)return{};const j=wv(U),W={x:n,y:u},tt=vg(_),ct=_g(tt),pt=await I.getDimensions(E),nt=tt==="y",it=nt?"top":"left",It=nt?"bottom":"right",_t=nt?"clientHeight":"clientWidth",gt=v.reference[ct]+v.reference[tt]-W[tt]-v.floating[ct],kt=W[tt]-v.reference[tt],Lt=await(I.getOffsetParent==null?void 0:I.getOffsetParent(E));let Vt=Lt?Lt[_t]:0;(!Vt||!await(I.isElement==null?void 0:I.isElement(Lt)))&&(Vt=l.floating[_t]||v.floating[ct]);const Rt=gt/2-kt/2,Qt=Vt/2-pt[ct]/2-1,Ut=Rc(j[it],Qt),me=Rc(j[It],Qt),jt=Ut,Bt=Vt-pt[ct]-me,ae=Vt/2-pt[ct]/2+Rt,he=Gm(jt,ae,Bt),ve=!P.arrow&&Ch(_)!=null&&ae!==he&&v.reference[ct]/2-(ae<jt?Ut:me)-pt[ct]/2<0,se=ve?ae<jt?ae-jt:ae-Bt:0;return{[tt]:W[tt]+se,data:{[tt]:he,centerOffset:ae-he-se,...ve&&{alignmentOffset:se}},reset:ve}}}),PI=function(s){return s===void 0&&(s={}),{name:"flip",options:s,async fn(t){var n,u;const{placement:_,middlewareData:v,rects:I,initialPlacement:l,platform:P,elements:E}=t,{mainAxis:U=!0,crossAxis:j=!0,fallbackPlacements:W,fallbackStrategy:tt="bestFit",fallbackAxisSideDirection:ct="none",flipAlignment:pt=!0,...nt}=Eh(s,t);if((n=v.arrow)!=null&&n.alignmentOffset)return{};const it=Sl(_),It=Fc(l),_t=Sl(l)===l,gt=await(P.isRTL==null?void 0:P.isRTL(E.floating)),kt=W||(_t||!pt?[bp(l)]:kI(l)),Lt=ct!=="none";!W&&Lt&&kt.push(...EI(l,pt,ct,gt));const Vt=[l,...kt],Rt=await Sv(t,nt),Qt=[];let Ut=((u=v.flip)==null?void 0:u.overflows)||[];if(U&&Qt.push(Rt[it]),j){const ae=TI(_,I,gt);Qt.push(Rt[ae[0]],Rt[ae[1]])}if(Ut=[...Ut,{placement:_,overflows:Qt}],!Qt.every(ae=>ae<=0)){var me,jt;const ae=(((me=v.flip)==null?void 0:me.index)||0)+1,he=Vt[ae];if(he)return{data:{index:ae,overflows:Ut},reset:{placement:he}};let ve=(jt=Ut.filter(se=>se.overflows[0]<=0).sort((se,ne)=>se.overflows[1]-ne.overflows[1])[0])==null?void 0:jt.placement;if(!ve)switch(tt){case"bestFit":{var Bt;const se=(Bt=Ut.filter(ne=>{if(Lt){const ie=Fc(ne.placement);return ie===It||ie==="y"}return!0}).map(ne=>[ne.placement,ne.overflows.filter(ie=>ie>0).reduce((ie,ci)=>ie+ci,0)]).sort((ne,ie)=>ne[1]-ie[1])[0])==null?void 0:Bt[0];se&&(ve=se);break}case"initialPlacement":ve=l;break}if(_!==ve)return{reset:{placement:ve}}}return{}}}};async function LI(s,t){const{placement:n,platform:u,elements:_}=s,v=await(u.isRTL==null?void 0:u.isRTL(_.floating)),I=Sl(n),l=Ch(n),P=Fc(n)==="y",E=["left","top"].includes(I)?-1:1,U=v&&P?-1:1,j=Eh(t,s);let{mainAxis:W,crossAxis:tt,alignmentAxis:ct}=typeof j=="number"?{mainAxis:j,crossAxis:0,alignmentAxis:null}:{mainAxis:j.mainAxis||0,crossAxis:j.crossAxis||0,alignmentAxis:j.alignmentAxis};return l&&typeof ct=="number"&&(tt=l==="end"?ct*-1:ct),P?{x:tt*U,y:W*E}:{x:W*E,y:tt*U}}const zI=function(s){return s===void 0&&(s=0),{name:"offset",options:s,async fn(t){var n,u;const{x:_,y:v,placement:I,middlewareData:l}=t,P=await LI(t,s);return I===((n=l.offset)==null?void 0:n.placement)&&(u=l.arrow)!=null&&u.alignmentOffset?{}:{x:_+P.x,y:v+P.y,data:{...P,placement:I}}}}},BI=function(s){return s===void 0&&(s={}),{name:"shift",options:s,async fn(t){const{x:n,y:u,placement:_}=t,{mainAxis:v=!0,crossAxis:I=!1,limiter:l={fn:nt=>{let{x:it,y:It}=nt;return{x:it,y:It}}},...P}=Eh(s,t),E={x:n,y:u},U=await Sv(t,P),j=Fc(Sl(_)),W=xv(j);let tt=E[W],ct=E[j];if(v){const nt=W==="y"?"top":"left",it=W==="y"?"bottom":"right",It=tt+U[nt],_t=tt-U[it];tt=Gm(It,tt,_t)}if(I){const nt=j==="y"?"top":"left",it=j==="y"?"bottom":"right",It=ct+U[nt],_t=ct-U[it];ct=Gm(It,ct,_t)}const pt=l.fn({...t,[W]:tt,[j]:ct});return{...pt,data:{x:pt.x-n,y:pt.y-u,enabled:{[W]:v,[j]:I}}}}}};function sf(){return typeof window<"u"}function Zc(s){return Iv(s)?(s.nodeName||"").toLowerCase():"#document"}function ys(s){var t;return(s==null||(t=s.ownerDocument)==null?void 0:t.defaultView)||window}function Co(s){var t;return(t=(Iv(s)?s.ownerDocument:s.document)||window.document)==null?void 0:t.documentElement}function Iv(s){return sf()?s instanceof Node||s instanceof ys(s).Node:!1}function to(s){return sf()?s instanceof Element||s instanceof ys(s).Element:!1}function To(s){return sf()?s instanceof HTMLElement||s instanceof ys(s).HTMLElement:!1}function e0(s){return!sf()||typeof ShadowRoot>"u"?!1:s instanceof ShadowRoot||s instanceof ys(s).ShadowRoot}function Mh(s){const{overflow:t,overflowX:n,overflowY:u,display:_}=eo(s);return/auto|scroll|overlay|hidden|clip/.test(t+u+n)&&!["inline","contents"].includes(_)}function RI(s){return["table","td","th"].includes(Zc(s))}function of(s){return[":popover-open",":modal"].some(t=>{try{return s.matches(t)}catch{return!1}})}function bg(s){const t=xg(),n=to(s)?eo(s):s;return n.transform!=="none"||n.perspective!=="none"||(n.containerType?n.containerType!=="normal":!1)||!t&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!t&&(n.filter?n.filter!=="none":!1)||["transform","perspective","filter"].some(u=>(n.willChange||"").includes(u))||["paint","layout","strict","content"].some(u=>(n.contain||"").includes(u))}function FI(s){let t=Na(s);for(;To(t)&&!Oc(t);){if(bg(t))return t;if(of(t))return null;t=Na(t)}return null}function xg(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Oc(s){return["html","body","#document"].includes(Zc(s))}function eo(s){return ys(s).getComputedStyle(s)}function af(s){return to(s)?{scrollLeft:s.scrollLeft,scrollTop:s.scrollTop}:{scrollLeft:s.scrollX,scrollTop:s.scrollY}}function Na(s){if(Zc(s)==="html")return s;const t=s.assignedSlot||s.parentNode||e0(s)&&s.host||Co(s);return e0(t)?t.host:t}function Tv(s){const t=Na(s);return Oc(t)?s.ownerDocument?s.ownerDocument.body:s.body:To(t)&&Mh(t)?t:Tv(t)}function _h(s,t,n){var u;t===void 0&&(t=[]),n===void 0&&(n=!0);const _=Tv(s),v=_===((u=s.ownerDocument)==null?void 0:u.body),I=ys(_);if(v){const l=Wm(I);return t.concat(I,I.visualViewport||[],Mh(_)?_:[],l&&n?_h(l):[])}return t.concat(_,_h(_,[],n))}function Wm(s){return s.parent&&Object.getPrototypeOf(s.parent)?s.frameElement:null}function kv(s){const t=eo(s);let n=parseFloat(t.width)||0,u=parseFloat(t.height)||0;const _=To(s),v=_?s.offsetWidth:n,I=_?s.offsetHeight:u,l=vp(n)!==v||vp(u)!==I;return l&&(n=v,u=I),{width:n,height:u,$:l}}function wg(s){return to(s)?s:s.contextElement}function Dc(s){const t=wg(s);if(!To(t))return Oa(1);const n=t.getBoundingClientRect(),{width:u,height:_,$:v}=kv(t);let I=(v?vp(n.width):n.width)/u,l=(v?vp(n.height):n.height)/_;return(!I||!Number.isFinite(I))&&(I=1),(!l||!Number.isFinite(l))&&(l=1),{x:I,y:l}}const OI=Oa(0);function Av(s){const t=ys(s);return!xg()||!t.visualViewport?OI:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function NI(s,t,n){return t===void 0&&(t=!1),!n||t&&n!==ys(s)?!1:t}function Il(s,t,n,u){t===void 0&&(t=!1),n===void 0&&(n=!1);const _=s.getBoundingClientRect(),v=wg(s);let I=Oa(1);t&&(u?to(u)&&(I=Dc(u)):I=Dc(s));const l=NI(v,n,u)?Av(v):Oa(0);let P=(_.left+l.x)/I.x,E=(_.top+l.y)/I.y,U=_.width/I.x,j=_.height/I.y;if(v){const W=ys(v),tt=u&&to(u)?ys(u):u;let ct=W,pt=Wm(ct);for(;pt&&u&&tt!==ct;){const nt=Dc(pt),it=pt.getBoundingClientRect(),It=eo(pt),_t=it.left+(pt.clientLeft+parseFloat(It.paddingLeft))*nt.x,gt=it.top+(pt.clientTop+parseFloat(It.paddingTop))*nt.y;P*=nt.x,E*=nt.y,U*=nt.x,j*=nt.y,P+=_t,E+=gt,ct=ys(pt),pt=Wm(ct)}}return xp({width:U,height:j,x:P,y:E})}function UI(s){let{elements:t,rect:n,offsetParent:u,strategy:_}=s;const v=_==="fixed",I=Co(u),l=t?of(t.floating):!1;if(u===I||l&&v)return n;let P={scrollLeft:0,scrollTop:0},E=Oa(1);const U=Oa(0),j=To(u);if((j||!j&&!v)&&((Zc(u)!=="body"||Mh(I))&&(P=af(u)),To(u))){const W=Il(u);E=Dc(u),U.x=W.x+u.clientLeft,U.y=W.y+u.clientTop}return{width:n.width*E.x,height:n.height*E.y,x:n.x*E.x-P.scrollLeft*E.x+U.x,y:n.y*E.y-P.scrollTop*E.y+U.y}}function VI(s){return Array.from(s.getClientRects())}function Hm(s,t){const n=af(s).scrollLeft;return t?t.left+n:Il(Co(s)).left+n}function $I(s){const t=Co(s),n=af(s),u=s.ownerDocument.body,_=bl(t.scrollWidth,t.clientWidth,u.scrollWidth,u.clientWidth),v=bl(t.scrollHeight,t.clientHeight,u.scrollHeight,u.clientHeight);let I=-n.scrollLeft+Hm(s);const l=-n.scrollTop;return eo(u).direction==="rtl"&&(I+=bl(t.clientWidth,u.clientWidth)-_),{width:_,height:v,x:I,y:l}}function jI(s,t){const n=ys(s),u=Co(s),_=n.visualViewport;let v=u.clientWidth,I=u.clientHeight,l=0,P=0;if(_){v=_.width,I=_.height;const E=xg();(!E||E&&t==="fixed")&&(l=_.offsetLeft,P=_.offsetTop)}return{width:v,height:I,x:l,y:P}}function qI(s,t){const n=Il(s,!0,t==="fixed"),u=n.top+s.clientTop,_=n.left+s.clientLeft,v=To(s)?Dc(s):Oa(1),I=s.clientWidth*v.x,l=s.clientHeight*v.y,P=_*v.x,E=u*v.y;return{width:I,height:l,x:P,y:E}}function i0(s,t,n){let u;if(t==="viewport")u=jI(s,n);else if(t==="document")u=$I(Co(s));else if(to(t))u=qI(t,n);else{const _=Av(s);u={...t,x:t.x-_.x,y:t.y-_.y}}return xp(u)}function Ev(s,t){const n=Na(s);return n===t||!to(n)||Oc(n)?!1:eo(n).position==="fixed"||Ev(n,t)}function GI(s,t){const n=t.get(s);if(n)return n;let u=_h(s,[],!1).filter(l=>to(l)&&Zc(l)!=="body"),_=null;const v=eo(s).position==="fixed";let I=v?Na(s):s;for(;to(I)&&!Oc(I);){const l=eo(I),P=bg(I);!P&&l.position==="fixed"&&(_=null),(v?!P&&!_:!P&&l.position==="static"&&!!_&&["absolute","fixed"].includes(_.position)||Mh(I)&&!P&&Ev(s,I))?u=u.filter(U=>U!==I):_=l,I=Na(I)}return t.set(s,u),u}function ZI(s){let{element:t,boundary:n,rootBoundary:u,strategy:_}=s;const I=[...n==="clippingAncestors"?of(t)?[]:GI(t,this._c):[].concat(n),u],l=I[0],P=I.reduce((E,U)=>{const j=i0(t,U,_);return E.top=bl(j.top,E.top),E.right=Rc(j.right,E.right),E.bottom=Rc(j.bottom,E.bottom),E.left=bl(j.left,E.left),E},i0(t,l,_));return{width:P.right-P.left,height:P.bottom-P.top,x:P.left,y:P.top}}function WI(s){const{width:t,height:n}=kv(s);return{width:t,height:n}}function HI(s,t,n){const u=To(t),_=Co(t),v=n==="fixed",I=Il(s,!0,v,t);let l={scrollLeft:0,scrollTop:0};const P=Oa(0);if(u||!u&&!v)if((Zc(t)!=="body"||Mh(_))&&(l=af(t)),u){const tt=Il(t,!0,v,t);P.x=tt.x+t.clientLeft,P.y=tt.y+t.clientTop}else _&&(P.x=Hm(_));let E=0,U=0;if(_&&!u&&!v){const tt=_.getBoundingClientRect();U=tt.top+l.scrollTop,E=tt.left+l.scrollLeft-Hm(_,tt)}const j=I.left+l.scrollLeft-P.x-E,W=I.top+l.scrollTop-P.y-U;return{x:j,y:W,width:I.width,height:I.height}}function Sm(s){return eo(s).position==="static"}function r0(s,t){if(!To(s)||eo(s).position==="fixed")return null;if(t)return t(s);let n=s.offsetParent;return Co(s)===n&&(n=n.ownerDocument.body),n}function Cv(s,t){const n=ys(s);if(of(s))return n;if(!To(s)){let _=Na(s);for(;_&&!Oc(_);){if(to(_)&&!Sm(_))return _;_=Na(_)}return n}let u=r0(s,t);for(;u&&RI(u)&&Sm(u);)u=r0(u,t);return u&&Oc(u)&&Sm(u)&&!bg(u)?n:u||FI(s)||n}const YI=async function(s){const t=this.getOffsetParent||Cv,n=this.getDimensions,u=await n(s.floating);return{reference:HI(s.reference,await t(s.floating),s.strategy),floating:{x:0,y:0,width:u.width,height:u.height}}};function KI(s){return eo(s).direction==="rtl"}const XI={convertOffsetParentRelativeRectToViewportRelativeRect:UI,getDocumentElement:Co,getClippingRect:ZI,getOffsetParent:Cv,getElementRects:YI,getClientRects:VI,getDimensions:WI,getScale:Dc,isElement:to,isRTL:KI};function JI(s,t){let n=null,u;const _=Co(s);function v(){var l;clearTimeout(u),(l=n)==null||l.disconnect(),n=null}function I(l,P){l===void 0&&(l=!1),P===void 0&&(P=1),v();const{left:E,top:U,width:j,height:W}=s.getBoundingClientRect();if(l||t(),!j||!W)return;const tt=Wd(U),ct=Wd(_.clientWidth-(E+j)),pt=Wd(_.clientHeight-(U+W)),nt=Wd(E),It={rootMargin:-tt+"px "+-ct+"px "+-pt+"px "+-nt+"px",threshold:bl(0,Rc(1,P))||1};let _t=!0;function gt(kt){const Lt=kt[0].intersectionRatio;if(Lt!==P){if(!_t)return I();Lt?I(!1,Lt):u=setTimeout(()=>{I(!1,1e-7)},1e3)}_t=!1}try{n=new IntersectionObserver(gt,{...It,root:_.ownerDocument})}catch{n=new IntersectionObserver(gt,It)}n.observe(s)}return I(!0),v}function n0(s,t,n,u){u===void 0&&(u={});const{ancestorScroll:_=!0,ancestorResize:v=!0,elementResize:I=typeof ResizeObserver=="function",layoutShift:l=typeof IntersectionObserver=="function",animationFrame:P=!1}=u,E=wg(s),U=_||v?[...E?_h(E):[],..._h(t)]:[];U.forEach(it=>{_&&it.addEventListener("scroll",n,{passive:!0}),v&&it.addEventListener("resize",n)});const j=E&&l?JI(E,n):null;let W=-1,tt=null;I&&(tt=new ResizeObserver(it=>{let[It]=it;It&&It.target===E&&tt&&(tt.unobserve(t),cancelAnimationFrame(W),W=requestAnimationFrame(()=>{var _t;(_t=tt)==null||_t.observe(t)})),n()}),E&&!P&&tt.observe(E),tt.observe(t));let ct,pt=P?Il(s):null;P&&nt();function nt(){const it=Il(s);pt&&(it.x!==pt.x||it.y!==pt.y||it.width!==pt.width||it.height!==pt.height)&&n(),pt=it,ct=requestAnimationFrame(nt)}return n(),()=>{var it;U.forEach(It=>{_&&It.removeEventListener("scroll",n),v&&It.removeEventListener("resize",n)}),j==null||j(),(it=tt)==null||it.disconnect(),tt=null,P&&cancelAnimationFrame(ct)}}const QI=zI,tT=BI,eT=PI,iT=DI,rT=(s,t,n)=>{const u=new Map,_={platform:XI,...n},v={..._.platform,_c:u};return MI(s,t,{..._,platform:v})};var nT=ue("<div></div>"),sT=ue("<div></div>"),oT=ue("<!> <!>",1),aT=ue("<!> <!>",1);function lT(s,t){const n=bi(t,["children","$$slots","$$events","$$legacy"]),u=bi(n,["activeContent","arrow","offset","placement","trigger","triggeredBy","reference","strategy","open","yOnly","middlewares"]);Ki(t,!1);const _=Be();let v=bt(t,"activeContent",0,!1),I=bt(t,"arrow",0,!0),l=bt(t,"offset",0,8),P=bt(t,"placement",0,"top"),E=bt(t,"trigger",0,"hover"),U=bt(t,"triggeredBy",8,()=>{}),j=bt(t,"reference",8,()=>{}),W=bt(t,"strategy",0,"absolute"),tt=bt(t,"open",4,!1),ct=bt(t,"yOnly",0,!1),pt=bt(t,"middlewares",8,()=>[eT(),tT()]);const nt=hg();let it=Be(),It=Be(),_t=Be(),gt=Be(),kt,Lt=Be(),Vt=Be(),Rt=[];const Qt=ke=>{wt(gt)===void 0&&console.error("trigger undefined"),!(!j()&&Rt.includes(ke.target)&&wt(gt)!==ke.target&&(Ce(gt,ke.target),tt()))&&tt(ke.type==="click"?!tt():!0)},Ut=ke=>ke.matches(":hover"),me=ke=>ke?`${ke}px`:"",jt=ke=>{if(v()&&wt(_t)){const Xe=[wt(gt),kt,...Rt].filter(Boolean);setTimeout(()=>{ke.type==="mouseleave"&&!Xe.some(Ut)&&tt(!1)},100)}else tt(!1)};let Bt=Be();const ae={left:"right",right:"left",bottom:"top",top:"bottom"};function he(){rT(wt(gt),kt,{placement:P(),strategy:W(),middleware:wt(_)}).then(({x:ke,y:Xe,middlewareData:xi,placement:ye,strategy:Xt})=>{kt.style.position=Xt,kt.style.left=ct()?"0":me(ke),kt.style.top=me(Xe),xi.arrow&&wt(Lt)instanceof HTMLDivElement&&(Ac(Lt,wt(Lt).style.left=me(xi.arrow.x)),Ac(Lt,wt(Lt).style.top=me(xi.arrow.y)),Ce(Bt,ae[ye.split("-")[0]]),Ac(Lt,wt(Lt).style[wt(Bt)]=me(-wt(Lt).offsetWidth/2-(n.border?1:0))))})}function ve(ke,Xe){kt=ke;let xi=n0(Xe,kt,he);return{update(ye){xi(),xi=n0(ye,kt,he)},destroy(){xi()}}}qc(()=>{const ke=[["focusin",Qt,wt(it)],["focusout",jt,wt(it)],["click",Qt,wt(It)],["mouseenter",Qt,wt(_t)],["mouseleave",jt,wt(_t)]];return U()?Rt=[...document.querySelectorAll(U())]:Rt=wt(Vt).previousElementSibling?[wt(Vt).previousElementSibling]:[],Rt.length||console.error("No triggers found."),Rt.forEach(Xe=>{Xe.tabIndex<0&&(Xe.tabIndex=0);for(const[xi,ye,Xt]of ke)Xt&&Xe.addEventListener(xi,ye)}),j()?(Ce(gt,document.querySelector(j())??document.body),wt(gt)===document.body?console.error(`Popup reference not found: '${j()}'`):(wt(it)&&wt(gt).addEventListener("focusout",jt),wt(_t)&&wt(gt).addEventListener("mouseleave",jt))):Ce(gt,Rt[0]),wt(It)&&document.addEventListener("click",se),()=>{Rt.forEach(Xe=>{if(Xe)for(const[xi,ye]of ke)Xe.removeEventListener(xi,ye)}),wt(gt)&&(wt(gt).removeEventListener("focusout",jt),wt(gt).removeEventListener("mouseleave",jt)),document.removeEventListener("click",se)}});function se(ke){tt()&&!ke.composedPath().includes(kt)&&!Rt.some(Xe=>ke.composedPath().includes(Xe))&&jt(ke)}function ne(ke,Xe){return ke?Xe:()=>{}}let ie=Be();function ci(ke){return Ce(Lt,ke),{destroy(){Ce(Lt,null)}}}Pe(()=>Ht(E()),()=>{Ce(it,E()==="focus")}),Pe(()=>Ht(E()),()=>{Ce(It,E()==="click")}),Pe(()=>Ht(E()),()=>{Ce(_t,E()==="hover")}),Pe(()=>Ht(tt()),()=>{nt("show",tt())}),Pe(()=>(Ht(P()),wt(gt)),()=>{P()&&Ce(gt,wt(gt))}),Pe(()=>(Ht(pt()),Ht(l()),wt(Lt)),()=>{Ce(_,[...pt(),QI(+l()),wt(Lt)&&iT({element:wt(Lt),padding:10})])}),Pe(()=>(Ht(n),wt(Bt)),()=>{Ce(ie,yg("absolute pointer-events-none block w-[10px] h-[10px] rotate-45 bg-inherit border-inherit",n.border&&wt(Bt)==="bottom"&&"border-b border-e",n.border&&wt(Bt)==="top"&&"border-t border-s ",n.border&&wt(Bt)==="right"&&"border-t border-e ",n.border&&wt(Bt)==="left"&&"border-b border-s "))}),jr(),Ji();var ti=aT(),mi=De(ti);zi(mi,()=>!wt(gt),ke=>{var Xe=nT();wl(Xe,xi=>Ce(Vt,xi),()=>wt(Vt)),Et(ke,Xe)});var di=Ot(Ot(mi,!0));zi(di,()=>wt(gt),ke=>{var Xe=Rm(()=>v()?-1:void 0);lI(ke,dg({use:ve,get options(){return wt(gt)},get open(){return tt()},set open(xi){tt(xi)},role:"tooltip",get tabindex(){return wt(Xe)}},()=>u,{$$events:{focusin:ne(v()&&wt(it),Qt),focusout:ne(v()&&wt(it),jt),mouseenter:ne(v()&&wt(_t),Qt),mouseleave:ne(v()&&wt(_t),jt)},children:(xi,ye)=>{var Xt=oT(),ze=De(Xt);vi(ze,mr(t),{},null);var Mi=Ot(Ot(ze,!0));zi(Mi,I,en=>{var lr=sT();je(()=>Pn(lr,wt(ie))),Fa(lr,wn=>ci(wn)),Et(en,lr)}),Et(xi,Xt)},$$slots:{default:!0},$$legacy:!0}))}),Et(s,ti),Xi()}var cT=ue("<div><!></div>"),uT=ue("<div><!></div>"),hT=ue("<!> <ul><!></ul> <!>",1);function Mv(s,t){const n=s2(t),u=bi(t,["children","$$slots","$$events","$$legacy"]),_=bi(u,["activeUrl","open","containerClass","classContainer","headerClass","classHeader","footerClass","classFooter","activeClass","classActive","arrow","trigger","placement","color","shadow","rounded"]);Ki(t,!1);const v=Be(),I=Be(),l=Be(),P=Be();let E=bt(t,"activeUrl",8,()=>{}),U=bt(t,"open",4,!1),j=bt(t,"containerClass",0,"divide-y z-50"),W=bt(t,"classContainer",8,()=>{}),tt=bt(t,"headerClass",0,"py-1 overflow-hidden rounded-t-lg"),ct=bt(t,"classHeader",8,()=>{}),pt=bt(t,"footerClass",0,"py-1 overflow-hidden rounded-b-lg"),nt=bt(t,"classFooter",8,()=>{}),it=bt(t,"activeClass",0,"text-primary-700 dark:text-primary-700 hover:text-primary-900 dark:hover:text-primary-900"),It=bt(t,"classActive",8,()=>{}),_t=bt(t,"arrow",0,!1),gt=bt(t,"trigger",0,"click"),kt=bt(t,"placement",0,"bottom"),Lt=bt(t,"color",0,"dropdown"),Vt=bt(t,"shadow",0,!0),Rt=bt(t,"rounded",0,!0);const Qt=Dr("");let Ut=fr(it(),It());ns("DropdownType",{activeClass:Ut}),ns("activeUrl",Qt),Pe(()=>Ht(E()),()=>{Qt.set(E()??"")}),Pe(()=>(Ht(j()),Ht(W())),()=>{Ce(v,fr(j(),W()))}),Pe(()=>(Ht(tt()),Ht(ct())),()=>{Ce(I,fr(tt(),ct()))}),Pe(()=>Ht(u),()=>{Ce(l,fr("py-1",u.class))}),Pe(()=>(Ht(pt()),Ht(nt())),()=>{Ce(P,fr(pt(),nt()))}),jr(),Ji(),lT(s,dg({activeContent:!0},()=>_,{get trigger(){return gt()},get arrow(){return _t()},get placement(){return kt()},get shadow(){return Vt()},get rounded(){return Rt()},get color(){return Lt()},get class(){return wt(v)},get open(){return U()},set open(me){U(me)},$$events:{show(me){oe.call(this,t,me)}},children:(me,jt)=>{var Bt=hT(),ae=De(Bt);zi(ae,()=>n.header,ne=>{var ti;var ie=cT(),ci=xe(ie);vi(ci,(ti=t.$$slots)==null?void 0:ti.header,{},null),we(ie),je(()=>Pn(ie,wt(I))),Et(ne,ie)});var he=Ot(Ot(ae,!0)),ve=xe(he);vi(ve,mr(t),{},null),we(he);var se=Ot(Ot(he,!0));zi(se,()=>n.footer,ne=>{var ti;var ie=uT(),ci=xe(ie);vi(ci,(ti=t.$$slots)==null?void 0:ti.footer,{},null),we(ie),je(()=>Pn(ie,wt(P))),Et(ne,ie)}),je(()=>Pn(he,wt(l))),Et(me,Bt)},$$slots:{default:!0},$$legacy:!0})),Xi()}function dT(s,t){const n=bi(t,["children","$$slots","$$events","$$legacy"]),u=bi(n,["tag","show","use"]);let _=bt(t,"tag",0,"div"),v=bt(t,"show"),I=bt(t,"use",0,()=>{});var l=Ai(),P=De(l);zi(P,v,E=>{var U=Ai(),j=De(U);gh(j,_,!1,(W,tt)=>{let ct;je(()=>ct=yh(W,ct,{...u},"")),Fa(W,it=>I()(it));var pt=Ai(),nt=De(pt);vi(nt,mr(t),{},null),Et(tt,pt)}),Et(E,U)},E=>{var U=Ai(),j=De(U);vi(j,mr(t),{},null),Et(E,U)}),Et(s,l)}function Dv(s,t){const n=bi(t,["children","$$slots","$$events","$$legacy"]),u=bi(n,["defaultClass","href","activeClass"]);Ki(t,!1);const _=Be(),v=Be();let I=bt(t,"defaultClass",0,"font-medium py-2 px-4 text-sm hover:bg-gray-100 dark:hover:bg-gray-600"),l=bt(t,"href",8,()=>{}),P=bt(t,"activeClass",8,()=>{});const E=qr("DropdownType")??{},U=qr("activeUrl");let j=Be("");U.subscribe(ct=>{Ce(j,ct)});let W=Be(!0);function tt(ct){var pt;Ce(W,((pt=ct.parentElement)==null?void 0:pt.tagName)==="UL")}Pe(()=>(wt(j),Ht(l())),()=>{Ce(_,wt(j)?l()===wt(j):!1)}),Pe(()=>(Ht(I()),Ht(l()),wt(_),Ht(P()),Ht(n)),()=>{Ce(v,fr(I(),l()?"block":"w-full text-left",wt(_)&&(P()??E.activeClass),n.class))}),jr(),Ji(),dT(s,{tag:"li",get show(){return wt(W)},use:tt,children:(ct,pt)=>{var nt=Ai(),it=De(nt);gh(it,()=>l()?"a":"button",!1,(It,_t)=>{let gt;je(()=>gt=yh(It,gt,{href:l(),type:l()?void 0:"button",role:l()?"link":"button",...u,class:wt(v)},"")),re("click",It,function(Vt){oe.call(this,t,Vt)}),re("change",It,function(Vt){oe.call(this,t,Vt)}),re("keydown",It,function(Vt){oe.call(this,t,Vt)}),re("keyup",It,function(Vt){oe.call(this,t,Vt)}),re("focus",It,function(Vt){oe.call(this,t,Vt)}),re("blur",It,function(Vt){oe.call(this,t,Vt)}),re("mouseenter",It,function(Vt){oe.call(this,t,Vt)}),re("mouseleave",It,function(Vt){oe.call(this,t,Vt)});var kt=Ai(),Lt=De(kt);vi(Lt,mr(t),{},null),Et(_t,kt)}),Et(ct,nt)},$$slots:{default:!0},$$legacy:!0}),Xi()}function pT(s){const t=Math.cos(s*Math.PI*.5);return Math.abs(t)<1e-14?1:1-t}var fT=qa('<svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path></svg>'),mT=ue('<div><label for="table-search" class="sr-only">Search</label> <div><div><!></div> <input type="text" id="table-search"></div> <!></div>'),gT=ue("<div><!> <table><!></table></div>");function Sg(s,t){const n=bi(t,["children","$$slots","$$events","$$legacy"]),u=bi(n,["divClass","striped","hoverable","noborder","shadow","color","customeColor","items","filter","placeholder","innerDivClass","searchClass","svgDivClass","svgClass","inputClass"]);Ki(t,!1);let _=bt(t,"divClass",0,"relative overflow-x-auto"),v=bt(t,"striped",0,!1),I=bt(t,"hoverable",0,!1),l=bt(t,"noborder",0,!1),P=bt(t,"shadow",0,!1),E=bt(t,"color",0,"default"),U=bt(t,"customeColor",0,""),j=bt(t,"items",8,()=>[]),W=bt(t,"filter",0,null),tt=bt(t,"placeholder",0,"Search"),ct=bt(t,"innerDivClass",0,"p-4"),pt=bt(t,"searchClass",0,"relative mt-1"),nt=bt(t,"svgDivClass",0,"absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none"),it=bt(t,"svgClass",0,"w-5 h-5 text-gray-500 dark:text-gray-400"),It=bt(t,"inputClass",0,"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-80 p-2.5 ps-10 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"),_t=Be(""),gt=fr(It(),n.classInput),kt=fr(nt(),n.classSvgDiv);const Lt={default:"text-gray-500 dark:text-gray-400",blue:"text-blue-100 dark:text-blue-100",green:"text-green-100 dark:text-green-100",red:"text-red-100 dark:text-red-100",yellow:"text-yellow-100 dark:text-yellow-100",purple:"text-purple-100 dark:text-purple-100",indigo:"text-indigo-100 dark:text-indigo-100",pink:"text-pink-100 dark:text-pink-100",custom:U()},Vt=Dr(wt(_t)),Rt=Dr(W());ns("searchTerm",Vt),ns("filter",Rt),ns("sorter",Dr(null)),Pe(()=>Ht(v()),()=>{ns("striped",v())}),Pe(()=>Ht(I()),()=>{ns("hoverable",I())}),Pe(()=>Ht(l()),()=>{ns("noborder",l())}),Pe(()=>Ht(E()),()=>{ns("color",E())}),Pe(()=>Ht(j()),()=>{ns("items",j())}),Pe(()=>wt(_t),()=>{Vt.set(wt(_t))}),Pe(()=>Ht(W()),()=>{W()&&Rt.set(W())}),jr(),Ji();var Qt=gT();je(()=>Pn(Qt,yg(_(),P()&&"shadow-md sm:rounded-lg")));var Ut=xe(Qt);zi(Ut,W,ae=>{var se;var he=Ai(),ve=De(he);vi(ve,(se=t.$$slots)==null?void 0:se.search,{},ne=>{var xi,ye;var ie=mT(),ci=xe(ie),ti=Ot(Ot(ci,!0)),mi=xe(ti);Pn(mi,kt);var di=xe(mi);vi(di,(xi=t.$$slots)==null?void 0:xi.svgSearch,{},Xt=>{var ze=fT();xe(ze),we(ze),je(()=>Z0(ze,it())),Et(Xt,ze)}),we(mi);var ke=Ot(Ot(mi,!0));G0(ke),Pn(ke,gt),we(ti);var Xe=Ot(Ot(ti,!0));vi(Xe,(ye=t.$$slots)==null?void 0:ye.header,{},null),we(ie),je(()=>{Pn(ie,ct()),Pn(ti,pt()),Xs(ke,"placeholder",tt())}),X0(ke,()=>wt(_t),Xt=>Ce(_t,Xt)),Et(ne,ie)}),Et(ae,he)});var me=Ot(Ot(Ut,!0));let jt;var Bt=xe(me);vi(Bt,mr(t),{},null),we(me),we(Qt),je(()=>jt=xn(me,jt,{...u,class:fr("w-full text-left text-sm",Lt[E()],n.class)},!0,"")),Et(s,Qt),Xi()}var yT=ue("<tbody><!><!></tbody>");function Ig(s,t){const n=bi(t,["children","$$slots","$$events","$$legacy"]),u=bi(n,["tableBodyClass"]);Ki(t,!1);const _=us(),v=()=>Oi(W,"$filter",_),I=()=>Oi(tt,"$searchTerm",_),l=()=>Oi(ct,"$sorter",_),P=Be(),E=Be(),U=Be();let j=bt(t,"tableBodyClass",8,()=>{}),W=qr("filter"),tt=qr("searchTerm"),ct=qr("sorter");Pe(()=>{},()=>{Ce(P,qr("items")||[])}),Pe(()=>(v(),wt(P),I()),()=>{Ce(E,v()?wt(P).filter(_t=>v()(_t,I())):wt(P))}),Pe(()=>(l(),wt(E)),()=>{Ce(U,l()?wt(E).toSorted((_t,gt)=>l().sortDirection*l().sort(_t,gt)):wt(E))}),jr(),Ji();var pt=yT();let nt;var it=xe(pt);vi(it,mr(t),{},null);var It=Ot(it);Ra(It,1,()=>wt(U),Ba,(_t,gt,kt)=>{var Rt;var Lt=Ai(),Vt=De(Lt);vi(Vt,(Rt=t.$$slots)==null?void 0:Rt.row,{get item(){return hn(gt)}},null),Et(_t,Lt)}),we(pt),je(()=>nt=xn(pt,nt,{...u,class:j()},!0,"")),Et(s,pt),Xi()}var _T=ue("<button><!></button>"),vT=ue("<td><!></td>");function ta(s,t){const n=bi(t,["children","$$slots","$$events","$$legacy"]),u=bi(n,["tdClass"]);Ki(t,!1);let _=bt(t,"tdClass",0,"px-6 py-4 whitespace-nowrap font-medium "),v=Be("default");Ce(v,qr("color"));let I=Be();Pe(()=>(Ht(_()),wt(v),Ht(n)),()=>{Ce(I,fr(_(),wt(v)==="default"?"text-gray-900 dark:text-white":"text-blue-50 whitespace-nowrap dark:text-blue-100",n.class))}),jr(),Ji();var l=vT();let P;var E=xe(l);zi(E,()=>n.onclick,U=>{var j=_T(),W=xe(j);vi(W,mr(t),{},null),we(j),re("click",j,n.onclick,!1),Et(U,j)},U=>{var j=Ai(),W=De(j);vi(W,mr(t),{},null),Et(U,j)}),we(l),je(()=>P=xn(l,P,{...u,class:wt(I)},!0,"")),Et(s,l),Xi()}var bT=ue("<tr><!></tr>");function Tg(s,t){const n=bi(t,["children","$$slots","$$events","$$legacy"]),u=bi(n,["color"]);Ki(t,!1);let _=bt(t,"color",8,()=>qr("color"));const v={default:"bg-white dark:bg-gray-800 dark:border-gray-700",blue:"bg-blue-500 border-blue-400",green:"bg-green-500 border-green-400",red:"bg-red-500 border-red-400",yellow:"bg-yellow-500 border-yellow-400",purple:"bg-purple-500 border-purple-400",custom:""},I={default:"hover:bg-gray-50 dark:hover:bg-gray-600",blue:"hover:bg-blue-400",green:"hover:bg-green-400",red:"hover:bg-red-400",yellow:"hover:bg-yellow-400",purple:"hover:bg-purple-400",custom:""},l={default:"odd:bg-white even:bg-gray-50 odd:dark:bg-gray-800 even:dark:bg-gray-700",blue:"odd:bg-blue-800 even:bg-blue-700 odd:dark:bg-blue-800 even:dark:bg-blue-700",green:"odd:bg-green-800 even:bg-green-700 odd:dark:bg-green-800 even:dark:bg-green-700",red:"odd:bg-red-800 even:bg-red-700 odd:dark:bg-red-800 even:dark:bg-red-700",yellow:"odd:bg-yellow-800 even:bg-yellow-700 odd:dark:bg-yellow-800 even:dark:bg-yellow-700",purple:"odd:bg-purple-800 even:bg-purple-700 odd:dark:bg-purple-800 even:dark:bg-purple-700",custom:""};let P=Be();Pe(()=>(Ht(_()),Ht(n)),()=>{Ce(P,fr([!qr("noborder")&&"border-b last:border-b-0",v[_()],qr("hoverable")&&I[_()],qr("striped")&&l[_()],n.class]))}),jr(),Ji();var E=bT();let U;var j=xe(E);vi(j,mr(t),{},null),we(E),je(()=>U=xn(E,U,{...u,class:wt(P)},!0,"")),re("click",E,function(W){oe.call(this,t,W)}),re("contextmenu",E,function(W){oe.call(this,t,W)}),re("dblclick",E,function(W){oe.call(this,t,W)}),Et(s,E),Xi()}var xT=ue("<tr><!></tr>"),wT=ue("<thead><!></thead>");function kg(s,t){const n=bi(t,["children","$$slots","$$events","$$legacy"]),u=bi(n,["theadClass","defaultRow"]);Ki(t,!1);const _=Be();let v=bt(t,"theadClass",0,"text-xs uppercase"),I=bt(t,"defaultRow",0,!0),l=Be();Ce(l,qr("color"));let P=qr("noborder"),E=qr("striped");const j={default:P||E?"":"bg-gray-50 dark:bg-gray-700",blue:"bg-blue-600",green:"bg-green-600",red:"bg-red-600",yellow:"bg-yellow-600",purple:"bg-purple-600",custom:""};let W=wt(l)==="default"?"text-gray-700 dark:text-gray-400":wt(l)==="custom"?"":"text-white  dark:text-white",tt=E?"":wt(l)==="default"?"border-gray-700":wt(l)==="custom"?"":`border-${wt(l)}-400`;Pe(()=>(Ht(v()),wt(l),Ht(n)),()=>{Ce(_,fr(v(),W,E&&tt,j[wt(l)],n.class))}),jr(),Ji();var ct=wT();let pt;var nt=xe(ct);zi(nt,I,it=>{var It=xT(),_t=xe(It);vi(_t,mr(t),{},null),we(It),Et(it,It)},it=>{var It=Ai(),_t=De(It);vi(_t,mr(t),{},null),Et(it,It)}),we(ct),je(()=>pt=xn(ct,pt,{...u,class:wt(_)},!0,"")),Et(s,ct),Xi()}var ST=ue("<th><button><!></button></th>"),IT=ue("<th><!></th>");function vo(s,t){const n=bi(t,["children","$$slots","$$events","$$legacy"]),u=bi(n,["padding","sort","defaultDirection","defaultSort","direction"]);Ki(t,!1);const _=us(),v=()=>Oi(j,"$sorter",_);let I=bt(t,"padding",0,"px-6 py-3"),l=bt(t,"sort",0,null),P=bt(t,"defaultDirection",0,"asc"),E=bt(t,"defaultSort",0,!1),U=bt(t,"direction",12,()=>E()?P():null),j=qr("sorter"),W=Math.random().toString(36).substring(2);E()&&tt();function tt(){!l()||!j||j.update(nt=>({id:W,sort:l(),sortDirection:(nt==null?void 0:nt.id)===W?-nt.sortDirection:P()==="asc"?1:-1}))}Pe(()=>v(),()=>{var nt;U(((nt=v())==null?void 0:nt.id)===W?v().sortDirection===1?"asc":"desc":null)}),jr(),Ji();var ct=Ai(),pt=De(ct);zi(pt,()=>l()&&j,nt=>{var it=ST();let It;var _t=xe(it);je(()=>Pn(_t,fr("w-full text-left","after:absolute after:pl-3",U()==="asc"&&'after:content-["▲"]',U()==="desc"&&'after:content-["▼"]',I())));var gt=xe(_t);vi(gt,mr(t),{},null),we(_t),we(it),je(()=>It=xn(it,It,{...u,class:n.class,"aria-sort":U()?`${U()}ending`:void 0},!0,"")),re("click",it,function(kt){oe.call(this,t,kt)}),re("focus",it,function(kt){oe.call(this,t,kt)}),re("keydown",it,function(kt){oe.call(this,t,kt)}),re("keypress",it,function(kt){oe.call(this,t,kt)}),re("keyup",it,function(kt){oe.call(this,t,kt)}),re("mouseenter",it,function(kt){oe.call(this,t,kt)}),re("mouseleave",it,function(kt){oe.call(this,t,kt)}),re("mouseover",it,function(kt){oe.call(this,t,kt)}),re("click",_t,tt,!1),Et(nt,it)},nt=>{var it=IT();let It;var _t=xe(it);vi(_t,mr(t),{},null),we(it),je(()=>It=xn(it,It,{...u,class:fr(I(),n.class)},!0,"")),re("click",it,function(gt){oe.call(this,t,gt)}),re("focus",it,function(gt){oe.call(this,t,gt)}),re("keydown",it,function(gt){oe.call(this,t,gt)}),re("keypress",it,function(gt){oe.call(this,t,gt)}),re("keyup",it,function(gt){oe.call(this,t,gt)}),re("mouseenter",it,function(gt){oe.call(this,t,gt)}),re("mouseleave",it,function(gt){oe.call(this,t,gt)}),re("mouseover",it,function(gt){oe.call(this,t,gt)}),Et(nt,it)}),Et(s,ct),Xi()}var TT=ue('<div class="hidden tab_content_placeholder"><div><!></div></div>'),kT=ue('<li role="presentation"><button><!></button> <!></li>');function s0(s,t){var _t;const n=bi(t,["children","$$slots","$$events","$$legacy"]),u=bi(n,["open","title","activeClasses","inactiveClasses","defaultClass","divClass"]);Ki(t,!1);let _=bt(t,"open",4,!1),v=bt(t,"title",0,"Tab title"),I=bt(t,"activeClasses",8,()=>{}),l=bt(t,"inactiveClasses",8,()=>{}),P=bt(t,"defaultClass",0,"inline-block text-sm font-medium text-center disabled:cursor-not-allowed"),E=bt(t,"divClass",0,"");const U=qr("ctx")??{},j=U.selected??Dr();function W(gt){return j.set(gt),{destroy:j.subscribe(Lt=>{Lt!==gt&&_(!1)})}}let tt=Be();Pe(()=>(Ht(P()),Ht(_()),Ht(I()),Ht(l())),()=>{Ce(tt,fr(P(),_()?I()??U.activeClasses:l()??U.inactiveClasses,_()&&"active"))}),jr(),Ji();var ct=kT();je(()=>Pn(ct,fr("group",n.class)));var pt=xe(ct);let nt;var it=xe(pt);vi(it,(_t=t.$$slots)==null?void 0:_t.title,{},gt=>{var kt=Js();je(()=>bn(kt,v())),Et(gt,kt)}),we(pt);var It=Ot(Ot(pt,!0));zi(It,_,gt=>{var kt=TT(),Lt=xe(kt),Vt=xe(Lt);vi(Vt,mr(t),{},null),we(Lt),we(kt),je(()=>Pn(Lt,E())),Fa(Lt,Rt=>W(Rt)),Et(gt,kt)}),we(ct),je(()=>nt=xn(pt,nt,{type:"button",role:"tab",...u,class:wt(tt)},!0,"")),re("click",pt,()=>_(!0),!1),re("blur",pt,function(gt){oe.call(this,t,gt)}),re("click",pt,function(gt){oe.call(this,t,gt)}),re("contextmenu",pt,function(gt){oe.call(this,t,gt)}),re("focus",pt,function(gt){oe.call(this,t,gt)}),re("keydown",pt,function(gt){oe.call(this,t,gt)}),re("keypress",pt,function(gt){oe.call(this,t,gt)}),re("keyup",pt,function(gt){oe.call(this,t,gt)}),re("mouseenter",pt,function(gt){oe.call(this,t,gt)}),re("mouseleave",pt,function(gt){oe.call(this,t,gt)}),re("mouseover",pt,function(gt){oe.call(this,t,gt)}),Et(s,ct),Xi()}var AT=ue('<div class="h-px bg-gray-200 dark:bg-gray-700"></div>'),ET=ue('<ul><!></ul> <!> <div role="tabpanel" aria-labelledby="id-tab"></div>',1);function CT(s,t){const n=bi(t,["children","$$slots","$$events","$$legacy"]),u=bi(n,["tabStyle","defaultClass","contentClass","divider","activeClasses","inactiveClasses"]);Ki(t,!1);const _=Be();let v=bt(t,"tabStyle",0,"none"),I=bt(t,"defaultClass",0,"flex flex-wrap space-x-2 rtl:space-x-reverse"),l=bt(t,"contentClass",0,"p-4 bg-gray-50 rounded-lg dark:bg-gray-800 mt-4"),P=bt(t,"divider",4,!0),E=bt(t,"activeClasses",0,"p-4 text-primary-600 bg-gray-100 rounded-t-lg dark:bg-gray-800 dark:text-primary-500"),U=bt(t,"inactiveClasses",0,"p-4 text-gray-500 rounded-t-lg hover:text-gray-600 hover:bg-gray-50 dark:text-gray-400 dark:hover:bg-gray-800 dark:hover:text-gray-300");const j={full:"p-4 w-full group-first:rounded-s-lg group-last:rounded-e-lg text-gray-900 bg-gray-100 focus:ring-4 focus:ring-primary-300 focus:outline-none dark:bg-gray-700 dark:text-white",pill:"py-3 px-4 text-white bg-primary-600 rounded-lg",underline:"p-4 text-primary-600 border-b-2 border-primary-600 dark:text-primary-500 dark:border-primary-500",none:""},W={full:"p-4 w-full group-first:rounded-s-lg group-last:rounded-e-lg text-gray-500 dark:text-gray-400 bg-white hover:text-gray-700 hover:bg-gray-50 focus:ring-4 focus:ring-primary-300 focus:outline-none dark:hover:text-white dark:bg-gray-800 dark:hover:bg-gray-700",pill:"py-3 px-4 text-gray-500 rounded-lg hover:text-gray-900 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-800 dark:hover:text-white",underline:"p-4 border-b-2 border-transparent hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300 text-gray-500 dark:text-gray-400",none:""},tt={activeClasses:j[v()]||E(),inactiveClasses:W[v()]||U(),selected:Dr()};ns("ctx",tt);function ct(kt){return{destroy:tt.selected.subscribe(Vt=>{Vt&&kt.replaceChildren(Vt)})}}Pe(()=>(Ht(P()),Ht(v())),()=>{P(["full","pill"].includes(v())?!1:P())}),Pe(()=>(Ht(I()),Ht(v()),Ht(n)),()=>{Ce(_,fr(I(),v()==="underline"&&"-mb-px",n.class))}),jr(),Ji();var pt=ET(),nt=De(pt);let it;var It=xe(nt);vi(It,mr(t),{get tabStyle(){return v()}},null),we(nt);var _t=Ot(Ot(nt,!0));zi(_t,P,kt=>{var Rt;var Lt=Ai(),Vt=De(Lt);vi(Vt,(Rt=t.$$slots)==null?void 0:Rt.divider,{},Qt=>{var Ut=AT();Et(Qt,Ut)}),Et(kt,Lt)});var gt=Ot(Ot(_t,!0));je(()=>{it=xn(nt,it,{...u,class:wt(_)},!0,""),Pn(gt,l())}),Fa(gt,kt=>ct(kt)),Et(s,pt),Xi()}var MT=qa("<title> </title>"),DT=qa("<desc> </desc>"),PT=qa('<svg><!><!><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" d="m10 16 4-4-4-4"></path></svg>'),LT=qa("<title> </title>"),zT=qa("<desc> </desc>"),BT=qa('<svg><!><!><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" d="m10 16 4-4-4-4"></path></svg>');function Pv(s,t){const n=bi(t,["children","$$slots","$$events","$$legacy"]),u=bi(n,["size","role","color","withEvents","title","strokeWidth","desc","ariaLabel"]);Ki(t,!1);const _=qr("iconCtx")??{},v={xs:"w-3 h-3",sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6",xl:"w-8 h-8"};let I=bt(t,"size",8,()=>_.size||"md"),l=bt(t,"role",8,()=>_.role||"img"),P=bt(t,"color",8,()=>_.color||"currentColor"),E=bt(t,"withEvents",8,()=>_.withEvents||!1),U=bt(t,"title",8,()=>({})),j=bt(t,"strokeWidth",8,()=>_.strokeWidth||"2"),W=bt(t,"desc",8,()=>({})),tt=`${U().id||""} ${W().id||""}`,ct=Be(!1),pt=bt(t,"ariaLabel",0,"chevron right outline");Pe(()=>(Ht(U()),Ht(W())),()=>{U().id||W().id?Ce(ct,!0):Ce(ct,!1)}),jr(),Ji();var nt=Ai(),it=De(nt);zi(it,E,It=>{var _t=PT();let gt;var kt=xe(_t);zi(kt,()=>U().id&&U().title,Rt=>{var Qt=MT(),Ut=xe(Qt);we(Qt),je(()=>{Xs(Qt,"id",U().id),bn(Ut,U().title)}),Et(Rt,Qt)});var Lt=Ot(kt);zi(Lt,()=>W().id&&W().desc,Rt=>{var Qt=DT(),Ut=xe(Qt);we(Qt),je(()=>{Xs(Qt,"id",W().id),bn(Ut,W().desc)}),Et(Rt,Qt)});var Vt=Ot(Lt);we(_t),je(()=>{gt=xn(_t,gt,{xmlns:"http://www.w3.org/2000/svg",fill:"none",color:P(),...u,class:fr("shrink-0",v[I()??"md"],n.class),role:l(),"aria-label":pt(),"aria-describedby":wt(ct)?tt:void 0,viewBox:"0 0 24 24"},!1,""),Xs(Vt,"stroke-width",j())}),re("click",_t,function(Rt){oe.call(this,t,Rt)}),re("keydown",_t,function(Rt){oe.call(this,t,Rt)}),re("keyup",_t,function(Rt){oe.call(this,t,Rt)}),re("focus",_t,function(Rt){oe.call(this,t,Rt)}),re("blur",_t,function(Rt){oe.call(this,t,Rt)}),re("mouseenter",_t,function(Rt){oe.call(this,t,Rt)}),re("mouseleave",_t,function(Rt){oe.call(this,t,Rt)}),re("mouseover",_t,function(Rt){oe.call(this,t,Rt)}),re("mouseout",_t,function(Rt){oe.call(this,t,Rt)}),Et(It,_t)},It=>{var _t=BT();let gt;var kt=xe(_t);zi(kt,()=>U().id&&U().title,Rt=>{var Qt=LT(),Ut=xe(Qt);we(Qt),je(()=>{Xs(Qt,"id",U().id),bn(Ut,U().title)}),Et(Rt,Qt)});var Lt=Ot(kt);zi(Lt,()=>W().id&&W().desc,Rt=>{var Qt=zT(),Ut=xe(Qt);we(Qt),je(()=>{Xs(Qt,"id",W().id),bn(Ut,W().desc)}),Et(Rt,Qt)});var Vt=Ot(Lt);we(_t),je(()=>{gt=xn(_t,gt,{xmlns:"http://www.w3.org/2000/svg",fill:"none",color:P(),...u,class:fr("shrink-0",v[I()??"md"],n.class),role:l(),"aria-label":pt(),"aria-describedby":wt(ct)?tt:void 0,viewBox:"0 0 24 24"},!1,""),Xs(Vt,"stroke-width",j())}),Et(It,_t)}),Et(s,nt),Xi()}var RT=ue('<div style="text-align: left; margin-top: 2.5%; margin-bottom: 5%; "><h1 class="font-large text-grey-800 text-lg lg:text-lg dark:text-gray-200">Search for metrics to preview and download.</h1></div>');function Lv(s){var t=RT();xe(t),we(t),Et(s,t)}var FT=ue('<div><h2 class="font-large text-lg text-gray-500 lg:text-xl dark:text-gray-500"><p>Pick country...</p></h2> <!></div>'),OT=ue('<div slot="sidebar"><div><!> <!> <!></div></div>'),NT=ue('<div slot="map"></div>');function UT(s,t){Ki(t,!1);const n=us(),u=()=>Oi(_p,"$selectedCountry",n),_=()=>Oi(Ah,"$rustBackend",n);function v(l){Hn(_p,l),console.log("Selected country: ",u()),Hn(nf,{kind:"level"})}let I=Be([]);qc(async()=>{try{await _().isLoaded()||await _().initialise(),Ce(I,await _().getCountries()),console.log(wt(I));return}catch(l){window.alert(`Failed to get countries: ${l}`)}}),Ji(),pg(s,{$$slots:{sidebar:(l,P)=>{var E=OT(),U=xe(E),j=xe(U);Lv(j);var W=Ot(Ot(j,!0));vl(W,{children:(ct,pt)=>{var nt=FT(),it=xe(nt);xe(it),we(it);var It=Ot(Ot(it,!0));Pv(It,{color:"grey",size:"lg",class:"text-grey ms-2 h-6 w-6 dark:text-gray-500",$$legacy:!0}),we(nt),Et(ct,nt)},$$slots:{default:!0},$$legacy:!0});var tt=Ot(Ot(W,!0));Mv(tt,{placement:"right-start",children:(ct,pt)=>{var nt=Ai(),it=De(nt);Ra(it,1,()=>wt(I),Ba,(It,_t,gt)=>{Dv(It,{$$events:{click:()=>v(hn(_t).country_name_short_en)},children:(kt,Lt)=>{Ir();var Vt=Js();je(()=>bn(Vt,hn(_t).country_name_short_en)),Et(kt,Vt)},$$slots:{default:!0},$$legacy:!0})}),Et(ct,nt)},$$slots:{default:!0},$$legacy:!0}),we(U),we(E),Et(l,E)},map:(l,P)=>{var E=NT();Et(l,E)}},$$legacy:!0}),Xi()}function VT(s){return new Worker(""+new URL("../workers/rust_worker-VVZOFnUD.js",import.meta.url).href,{type:"module",name:s==null?void 0:s.name})}var $T=ue('<div id="search-input-cont" class="svelte-s9ylj0"><input type="text" id="search-field" placeholder="Enter Search Term" autocomplete="off" class="svelte-s9ylj0"></div>');function jT(s,t){let n=bt(t,"searchTerm",4);var u=$T(),_=xe(u);G0(_),we(u),X0(_,n,v=>n(v)),re("input",_,function(v){oe.call(this,t,v)}),Et(s,u)}var qT=ue("ID",1),GT=ue("Name",1),ZT=ue("Column",1),WT=ue("Year",1),HT=ue("Selected metrics",1),YT=ue("<!> <!> <!> <!> <!>",1),KT=ue("Remove",1),XT=ue("<!> <!> <!> <!> <!>",1),JT=ue("<!> <!>",1),QT=ue("<div><!></div>");function tk(s,t){Ki(t,!1);const n=us(),u=()=>Oi(Cc,"$selectedMetricsList",n);function _(l){console.log(l);const P=u().indexOf(l);P>-1&&u().splice(P,1),Hn(Cc,[...u()])}Ji();var v=QT(),I=xe(v);Sg(I,{children:(l,P)=>{var E=JT(),U=De(E);kg(U,{children:(W,tt)=>{var ct=YT(),pt=De(ct);vo(pt,{children:(gt,kt)=>{Ir();var Lt=qT();Et(gt,Lt)},$$slots:{default:!0},$$legacy:!0});var nt=Ot(Ot(pt,!0));vo(nt,{children:(gt,kt)=>{Ir();var Lt=GT();Et(gt,Lt)},$$slots:{default:!0},$$legacy:!0});var it=Ot(Ot(nt,!0));vo(it,{children:(gt,kt)=>{Ir();var Lt=ZT();Et(gt,Lt)},$$slots:{default:!0},$$legacy:!0});var It=Ot(Ot(it,!0));vo(It,{children:(gt,kt)=>{Ir();var Lt=WT();Et(gt,Lt)},$$slots:{default:!0},$$legacy:!0});var _t=Ot(Ot(It,!0));vo(_t,{children:(gt,kt)=>{Ir();var Lt=HT();Et(gt,Lt)},$$slots:{default:!0},$$legacy:!0}),Et(W,ct)},$$slots:{default:!0},$$legacy:!0});var j=Ot(Ot(U,!0));Ig(j,{tableBodyClass:"divide-y",children:(W,tt)=>{var ct=Ai(),pt=De(ct);Ra(pt,1,u,Ba,(nt,it,It)=>{Tg(nt,{children:(_t,gt)=>{var kt=XT(),Lt=De(kt);ta(Lt,{children:(me,jt)=>{Ir();var Bt=Js();je(()=>bn(Bt,hn(it).metric_id.slice(0,8))),Et(me,Bt)},$$slots:{default:!0},$$legacy:!0});var Vt=Ot(Ot(Lt,!0));ta(Vt,{class:"max-w-md whitespace-normal break-words border-b border-gray-200 px-2 py-2",children:(me,jt)=>{Ir();var Bt=Js();je(()=>bn(Bt,hn(it).metric_human_readable_name)),Et(me,Bt)},$$slots:{default:!0},$$legacy:!0});var Rt=Ot(Ot(Vt,!0));ta(Rt,{children:(me,jt)=>{Ir();var Bt=Js();je(()=>bn(Bt,hn(it).metric_parquet_column_name)),Et(me,Bt)},$$slots:{default:!0},$$legacy:!0});var Qt=Ot(Ot(Rt,!0));ta(Qt,{children:(me,jt)=>{Ir();var Bt=Js();je(()=>bn(Bt,hn(it).source_data_release_collection_period_start.slice(0,4))),Et(me,Bt)},$$slots:{default:!0},$$legacy:!0});var Ut=Ot(Ot(Qt,!0));ta(Ut,{children:(me,jt)=>{vl(me,{color:"light",$$events:{click:()=>_(hn(it))},children:(Bt,ae)=>{Ir();var he=KT();Et(Bt,he)},$$slots:{default:!0},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0}),Et(_t,kt)},$$slots:{default:!0},$$legacy:!0})}),Et(W,ct)},$$slots:{default:!0},$$legacy:!0}),Et(l,E)},$$slots:{default:!0},$$legacy:!0}),we(v),Et(s,v),Xi()}function Qe(s,t,n,u){function _(v){return v instanceof n?v:new n(function(I){I(v)})}return new(n||(n=Promise))(function(v,I){function l(U){try{E(u.next(U))}catch(j){I(j)}}function P(U){try{E(u.throw(U))}catch(j){I(j)}}function E(U){U.done?v(U.value):_(U.value).then(l,P)}E((u=u.apply(s,t||[])).next())})}function o0(s){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&s[t],u=0;if(n)return n.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&u>=s.length&&(s=void 0),{value:s&&s[u++],done:!s}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function li(s){return this instanceof li?(this.v=s,this):new li(s)}function So(s,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var u=n.apply(s,t||[]),_,v=[];return _={},l("next"),l("throw"),l("return",I),_[Symbol.asyncIterator]=function(){return this},_;function I(tt){return function(ct){return Promise.resolve(ct).then(tt,j)}}function l(tt,ct){u[tt]&&(_[tt]=function(pt){return new Promise(function(nt,it){v.push([tt,pt,nt,it])>1||P(tt,pt)})},ct&&(_[tt]=ct(_[tt])))}function P(tt,ct){try{E(u[tt](ct))}catch(pt){W(v[0][3],pt)}}function E(tt){tt.value instanceof li?Promise.resolve(tt.value.v).then(U,j):W(v[0][2],tt)}function U(tt){P("next",tt)}function j(tt){P("throw",tt)}function W(tt,ct){tt(ct),v.shift(),v.length&&P(v[0][0],v[0][1])}}function ep(s){var t,n;return t={},u("next"),u("throw",function(_){throw _}),u("return"),t[Symbol.iterator]=function(){return this},t;function u(_,v){t[_]=s[_]?function(I){return(n=!n)?{value:li(s[_](I)),done:!1}:v?v(I):I}:v}}function xl(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=s[Symbol.asyncIterator],n;return t?t.call(s):(s=typeof o0=="function"?o0(s):s[Symbol.iterator](),n={},u("next"),u("throw"),u("return"),n[Symbol.asyncIterator]=function(){return this},n);function u(v){n[v]=s[v]&&function(I){return new Promise(function(l,P){I=s[v](I),_(l,P,I.done,I.value)})}}function _(v,I,l,P){Promise.resolve(P).then(function(E){v({value:E,done:l})},I)}}const ek=new TextDecoder("utf-8"),Ym=s=>ek.decode(s),ik=new TextEncoder,Ag=s=>ik.encode(s),rk=s=>typeof s=="number",zv=s=>typeof s=="boolean",Qr=s=>typeof s=="function",ls=s=>s!=null&&Object(s)===s,Tl=s=>ls(s)&&Qr(s.then),Dh=s=>ls(s)&&Qr(s[Symbol.iterator]),Wc=s=>ls(s)&&Qr(s[Symbol.asyncIterator]),Km=s=>ls(s)&&ls(s.schema),Bv=s=>ls(s)&&"done"in s&&"value"in s,Rv=s=>ls(s)&&Qr(s.stat)&&rk(s.fd),Fv=s=>ls(s)&&Eg(s.body),lf=s=>"_getDOMStream"in s&&"_getNodeStream"in s,nk=s=>ls(s)&&Qr(s.abort)&&Qr(s.getWriter)&&!lf(s),Eg=s=>ls(s)&&Qr(s.cancel)&&Qr(s.getReader)&&!lf(s),sk=s=>ls(s)&&Qr(s.end)&&Qr(s.write)&&zv(s.writable)&&!lf(s),Ov=s=>ls(s)&&Qr(s.read)&&Qr(s.pipe)&&zv(s.readable)&&!lf(s),ok=s=>ls(s)&&Qr(s.clear)&&Qr(s.bytes)&&Qr(s.position)&&Qr(s.setPosition)&&Qr(s.capacity)&&Qr(s.getBufferIdentifier)&&Qr(s.createLong),Cg=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:ArrayBuffer;function ak(s){const t=s[0]?[s[0]]:[];let n,u,_,v;for(let I,l,P=0,E=0,U=s.length;++P<U;){if(I=t[E],l=s[P],!I||!l||I.buffer!==l.buffer||l.byteOffset<I.byteOffset){l&&(t[++E]=l);continue}if({byteOffset:n,byteLength:_}=I,{byteOffset:u,byteLength:v}=l,n+_<u||u+v<n){l&&(t[++E]=l);continue}t[E]=new Uint8Array(I.buffer,n,u-n+v)}return t}function a0(s,t,n=0,u=t.byteLength){const _=s.byteLength,v=new Uint8Array(s.buffer,s.byteOffset,_),I=new Uint8Array(t.buffer,t.byteOffset,Math.min(u,_));return v.set(I,n),s}function ko(s,t){const n=ak(s),u=n.reduce((U,j)=>U+j.byteLength,0);let _,v,I,l=0,P=-1;const E=Math.min(t||Number.POSITIVE_INFINITY,u);for(const U=n.length;++P<U;){if(_=n[P],v=_.subarray(0,Math.min(_.length,E-l)),E<=l+v.length){v.length<_.length?n[P]=_.subarray(v.length):v.length===_.length&&P++,I?a0(I,v,l):I=v;break}a0(I||(I=new Uint8Array(E)),v,l),l+=v.length}return[I||new Uint8Array(0),n.slice(P),u-(I?I.byteLength:0)]}function Zi(s,t){let n=Bv(t)?t.value:t;return n instanceof s?s===Uint8Array?new s(n.buffer,n.byteOffset,n.byteLength):n:n?(typeof n=="string"&&(n=Ag(n)),n instanceof ArrayBuffer?new s(n):n instanceof Cg?new s(n):ok(n)?Zi(s,n.bytes()):ArrayBuffer.isView(n)?n.byteLength<=0?new s(0):new s(n.buffer,n.byteOffset,n.byteLength/s.BYTES_PER_ELEMENT):s.from(n)):new s(0)}const nh=s=>Zi(Int32Array,s),l0=s=>Zi(BigInt64Array,s),Ti=s=>Zi(Uint8Array,s),Xm=s=>(s.next(),s);function*lk(s,t){const n=function*(_){yield _},u=typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof Cg?n(t):Dh(t)?t:n(t);return yield*Xm(function*(_){let v=null;do v=_.next(yield Zi(s,v));while(!v.done)}(u[Symbol.iterator]())),new s}const ck=s=>lk(Uint8Array,s);function Nv(s,t){return So(this,arguments,function*(){if(Tl(t))return yield li(yield li(yield*ep(xl(Nv(s,yield li(t))))));const u=function(I){return So(this,arguments,function*(){yield yield li(yield li(I))})},_=function(I){return So(this,arguments,function*(){yield li(yield*ep(xl(Xm(function*(l){let P=null;do P=l.next(yield P==null?void 0:P.value);while(!P.done)}(I[Symbol.iterator]())))))})},v=typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof Cg?u(t):Dh(t)?_(t):Wc(t)?t:u(t);return yield li(yield*ep(xl(Xm(function(I){return So(this,arguments,function*(){let l=null;do l=yield li(I.next(yield yield li(Zi(s,l))));while(!l.done)})}(v[Symbol.asyncIterator]()))))),yield li(new s)})}const uk=s=>Nv(Uint8Array,s);function Uv(s,t,n){if(s!==0){n=n.slice(0,t);for(let u=-1,_=n.length;++u<_;)n[u]+=s}return n.subarray(0,t)}function hk(s,t){let n=0;const u=s.length;if(u!==t.length)return!1;if(u>0)do if(s[n]!==t[n])return!1;while(++n<u);return!0}const Ds={fromIterable(s){return Hd(dk(s))},fromAsyncIterable(s){return Hd(pk(s))},fromDOMStream(s){return Hd(fk(s))},fromNodeStream(s){return Hd(gk(s))},toDOMStream(s,t){throw new Error('"toDOMStream" not available in this environment')},toNodeStream(s,t){throw new Error('"toNodeStream" not available in this environment')}},Hd=s=>(s.next(),s);function*dk(s){let t,n=!1,u=[],_,v,I,l=0;function P(){return v==="peek"?ko(u,I)[0]:([_,u,l]=ko(u,I),_)}({cmd:v,size:I}=(yield null)||{cmd:"read",size:0});const E=ck(s)[Symbol.iterator]();try{do if({done:t,value:_}=Number.isNaN(I-l)?E.next():E.next(I-l),!t&&_.byteLength>0&&(u.push(_),l+=_.byteLength),t||I<=l)do({cmd:v,size:I}=yield P());while(I<l);while(!t)}catch(U){(n=!0)&&typeof E.throw=="function"&&E.throw(U)}finally{n===!1&&typeof E.return=="function"&&E.return(null)}return null}function pk(s){return So(this,arguments,function*(){let n,u=!1,_=[],v,I,l,P=0;function E(){return I==="peek"?ko(_,l)[0]:([v,_,P]=ko(_,l),v)}({cmd:I,size:l}=(yield yield li(null))||{cmd:"read",size:0});const U=uk(s)[Symbol.asyncIterator]();try{do if({done:n,value:v}=Number.isNaN(l-P)?yield li(U.next()):yield li(U.next(l-P)),!n&&v.byteLength>0&&(_.push(v),P+=v.byteLength),n||l<=P)do({cmd:I,size:l}=yield yield li(E()));while(l<P);while(!n)}catch(j){(u=!0)&&typeof U.throw=="function"&&(yield li(U.throw(j)))}finally{u===!1&&typeof U.return=="function"&&(yield li(U.return(new Uint8Array(0))))}return yield li(null)})}function fk(s){return So(this,arguments,function*(){let n=!1,u=!1,_=[],v,I,l,P=0;function E(){return I==="peek"?ko(_,l)[0]:([v,_,P]=ko(_,l),v)}({cmd:I,size:l}=(yield yield li(null))||{cmd:"read",size:0});const U=new mk(s);try{do if({done:n,value:v}=Number.isNaN(l-P)?yield li(U.read()):yield li(U.read(l-P)),!n&&v.byteLength>0&&(_.push(Ti(v)),P+=v.byteLength),n||l<=P)do({cmd:I,size:l}=yield yield li(E()));while(l<P);while(!n)}catch(j){(u=!0)&&(yield li(U.cancel(j)))}finally{u===!1?yield li(U.cancel()):s.locked&&U.releaseLock()}return yield li(null)})}class mk{constructor(t){this.source=t,this.reader=null,this.reader=this.source.getReader(),this.reader.closed.catch(()=>{})}get closed(){return this.reader?this.reader.closed.catch(()=>{}):Promise.resolve()}releaseLock(){this.reader&&this.reader.releaseLock(),this.reader=null}cancel(t){return Qe(this,void 0,void 0,function*(){const{reader:n,source:u}=this;n&&(yield n.cancel(t).catch(()=>{})),u&&u.locked&&this.releaseLock()})}read(t){return Qe(this,void 0,void 0,function*(){if(t===0)return{done:this.reader==null,value:new Uint8Array(0)};const n=yield this.reader.read();return!n.done&&(n.value=Ti(n)),n})}}const Im=(s,t)=>{const n=_=>u([t,_]);let u;return[t,n,new Promise(_=>(u=_)&&s.once(t,n))]};function gk(s){return So(this,arguments,function*(){const n=[];let u="error",_=!1,v=null,I,l,P=0,E=[],U;function j(){return I==="peek"?ko(E,l)[0]:([U,E,P]=ko(E,l),U)}if({cmd:I,size:l}=(yield yield li(null))||{cmd:"read",size:0},s.isTTY)return yield yield li(new Uint8Array(0)),yield li(null);try{n[0]=Im(s,"end"),n[1]=Im(s,"error");do{if(n[2]=Im(s,"readable"),[u,v]=yield li(Promise.race(n.map(tt=>tt[2]))),u==="error")break;if((_=u==="end")||(Number.isFinite(l-P)?(U=Ti(s.read(l-P)),U.byteLength<l-P&&(U=Ti(s.read()))):U=Ti(s.read()),U.byteLength>0&&(E.push(U),P+=U.byteLength)),_||l<=P)do({cmd:I,size:l}=yield yield li(j()));while(l<P)}while(!_)}finally{yield li(W(n,u==="error"?v:null))}return yield li(null);function W(tt,ct){return U=E=null,new Promise((pt,nt)=>{for(const[it,It]of tt)s.off(it,It);try{const it=s.destroy;it&&it.call(s,ct),ct=void 0}catch(it){ct=it||ct}finally{ct!=null?nt(ct):pt()}})}})}var $r;(function(s){s[s.V1=0]="V1",s[s.V2=1]="V2",s[s.V3=2]="V3",s[s.V4=3]="V4",s[s.V5=4]="V5"})($r||($r={}));var zn;(function(s){s[s.Sparse=0]="Sparse",s[s.Dense=1]="Dense"})(zn||(zn={}));var Ln;(function(s){s[s.HALF=0]="HALF",s[s.SINGLE=1]="SINGLE",s[s.DOUBLE=2]="DOUBLE"})(Ln||(Ln={}));var Bs;(function(s){s[s.DAY=0]="DAY",s[s.MILLISECOND=1]="MILLISECOND"})(Bs||(Bs={}));var $e;(function(s){s[s.SECOND=0]="SECOND",s[s.MILLISECOND=1]="MILLISECOND",s[s.MICROSECOND=2]="MICROSECOND",s[s.NANOSECOND=3]="NANOSECOND"})($e||($e={}));var Ao;(function(s){s[s.YEAR_MONTH=0]="YEAR_MONTH",s[s.DAY_TIME=1]="DAY_TIME",s[s.MONTH_DAY_NANO=2]="MONTH_DAY_NANO"})(Ao||(Ao={}));const Tm=2,bo=4,ea=4,Vi=4,Pa=new Int32Array(2),c0=new Float32Array(Pa.buffer),u0=new Float64Array(Pa.buffer),Yd=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var Jm;(function(s){s[s.UTF8_BYTES=1]="UTF8_BYTES",s[s.UTF16_STRING=2]="UTF16_STRING"})(Jm||(Jm={}));let Nc=class Vv{constructor(t){this.bytes_=t,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(t){return new Vv(new Uint8Array(t))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(t){this.position_=t}capacity(){return this.bytes_.length}readInt8(t){return this.readUint8(t)<<24>>24}readUint8(t){return this.bytes_[t]}readInt16(t){return this.readUint16(t)<<16>>16}readUint16(t){return this.bytes_[t]|this.bytes_[t+1]<<8}readInt32(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24}readUint32(t){return this.readInt32(t)>>>0}readInt64(t){return BigInt.asIntN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readUint64(t){return BigInt.asUintN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readFloat32(t){return Pa[0]=this.readInt32(t),c0[0]}readFloat64(t){return Pa[Yd?0:1]=this.readInt32(t),Pa[Yd?1:0]=this.readInt32(t+4),u0[0]}writeInt8(t,n){this.bytes_[t]=n}writeUint8(t,n){this.bytes_[t]=n}writeInt16(t,n){this.bytes_[t]=n,this.bytes_[t+1]=n>>8}writeUint16(t,n){this.bytes_[t]=n,this.bytes_[t+1]=n>>8}writeInt32(t,n){this.bytes_[t]=n,this.bytes_[t+1]=n>>8,this.bytes_[t+2]=n>>16,this.bytes_[t+3]=n>>24}writeUint32(t,n){this.bytes_[t]=n,this.bytes_[t+1]=n>>8,this.bytes_[t+2]=n>>16,this.bytes_[t+3]=n>>24}writeInt64(t,n){this.writeInt32(t,Number(BigInt.asIntN(32,n))),this.writeInt32(t+4,Number(BigInt.asIntN(32,n>>BigInt(32))))}writeUint64(t,n){this.writeUint32(t,Number(BigInt.asUintN(32,n))),this.writeUint32(t+4,Number(BigInt.asUintN(32,n>>BigInt(32))))}writeFloat32(t,n){c0[0]=n,this.writeInt32(t,Pa[0])}writeFloat64(t,n){u0[0]=n,this.writeInt32(t,Pa[Yd?0:1]),this.writeInt32(t+4,Pa[Yd?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+bo+ea)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let t="";for(let n=0;n<ea;n++)t+=String.fromCharCode(this.readInt8(this.position_+bo+n));return t}__offset(t,n){const u=t-this.readInt32(t);return n<this.readInt16(u)?this.readInt16(u+n):0}__union(t,n){return t.bb_pos=n+this.readInt32(n),t.bb=this,t}__string(t,n){t+=this.readInt32(t);const u=this.readInt32(t);t+=bo;const _=this.bytes_.subarray(t,t+u);return n===Jm.UTF8_BYTES?_:this.text_decoder_.decode(_)}__union_with_string(t,n){return typeof t=="string"?this.__string(n):this.__union(t,n)}__indirect(t){return t+this.readInt32(t)}__vector(t){return t+this.readInt32(t)+bo}__vector_len(t){return this.readInt32(t+this.readInt32(t))}__has_identifier(t){if(t.length!=ea)throw new Error("FlatBuffers: file identifier must be length "+ea);for(let n=0;n<ea;n++)if(t.charCodeAt(n)!=this.readInt8(this.position()+bo+n))return!1;return!0}createScalarList(t,n){const u=[];for(let _=0;_<n;++_){const v=t(_);v!==null&&u.push(v)}return u}createObjList(t,n){const u=[];for(let _=0;_<n;++_){const v=t(_);v!==null&&u.push(v.unpack())}return u}},$v=class jv{constructor(t){this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null,this.text_encoder=new TextEncoder;let n;t?n=t:n=1024,this.bb=Nc.allocate(n),this.space=n}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(t){this.force_defaults=t}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(t,n){t>this.minalign&&(this.minalign=t);const u=~(this.bb.capacity()-this.space+n)+1&t-1;for(;this.space<u+t+n;){const _=this.bb.capacity();this.bb=jv.growByteBuffer(this.bb),this.space+=this.bb.capacity()-_}this.pad(u)}pad(t){for(let n=0;n<t;n++)this.bb.writeInt8(--this.space,0)}writeInt8(t){this.bb.writeInt8(this.space-=1,t)}writeInt16(t){this.bb.writeInt16(this.space-=2,t)}writeInt32(t){this.bb.writeInt32(this.space-=4,t)}writeInt64(t){this.bb.writeInt64(this.space-=8,t)}writeFloat32(t){this.bb.writeFloat32(this.space-=4,t)}writeFloat64(t){this.bb.writeFloat64(this.space-=8,t)}addInt8(t){this.prep(1,0),this.writeInt8(t)}addInt16(t){this.prep(2,0),this.writeInt16(t)}addInt32(t){this.prep(4,0),this.writeInt32(t)}addInt64(t){this.prep(8,0),this.writeInt64(t)}addFloat32(t){this.prep(4,0),this.writeFloat32(t)}addFloat64(t){this.prep(8,0),this.writeFloat64(t)}addFieldInt8(t,n,u){(this.force_defaults||n!=u)&&(this.addInt8(n),this.slot(t))}addFieldInt16(t,n,u){(this.force_defaults||n!=u)&&(this.addInt16(n),this.slot(t))}addFieldInt32(t,n,u){(this.force_defaults||n!=u)&&(this.addInt32(n),this.slot(t))}addFieldInt64(t,n,u){(this.force_defaults||n!==u)&&(this.addInt64(n),this.slot(t))}addFieldFloat32(t,n,u){(this.force_defaults||n!=u)&&(this.addFloat32(n),this.slot(t))}addFieldFloat64(t,n,u){(this.force_defaults||n!=u)&&(this.addFloat64(n),this.slot(t))}addFieldOffset(t,n,u){(this.force_defaults||n!=u)&&(this.addOffset(n),this.slot(t))}addFieldStruct(t,n,u){n!=u&&(this.nested(n),this.slot(t))}nested(t){if(t!=this.offset())throw new TypeError("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new TypeError("FlatBuffers: object serialization must not be nested.")}slot(t){this.vtable!==null&&(this.vtable[t]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(t){const n=t.capacity();if(n&3221225472)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const u=n<<1,_=Nc.allocate(u);return _.setPosition(u-n),_.bytes().set(t.bytes(),u-n),_}addOffset(t){this.prep(bo,0),this.writeInt32(this.offset()-t+bo)}startObject(t){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=t;for(let n=0;n<t;n++)this.vtable[n]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const t=this.offset();let n=this.vtable_in_use-1;for(;n>=0&&this.vtable[n]==0;n--);const u=n+1;for(;n>=0;n--)this.addInt16(this.vtable[n]!=0?t-this.vtable[n]:0);const _=2;this.addInt16(t-this.object_start);const v=(u+_)*Tm;this.addInt16(v);let I=0;const l=this.space;t:for(n=0;n<this.vtables.length;n++){const P=this.bb.capacity()-this.vtables[n];if(v==this.bb.readInt16(P)){for(let E=Tm;E<v;E+=Tm)if(this.bb.readInt16(l+E)!=this.bb.readInt16(P+E))continue t;I=this.vtables[n];break}}return I?(this.space=this.bb.capacity()-t,this.bb.writeInt32(this.space,I-t)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-t,this.offset()-t)),this.isNested=!1,t}finish(t,n,u){const _=u?Vi:0;if(n){const v=n;if(this.prep(this.minalign,bo+ea+_),v.length!=ea)throw new TypeError("FlatBuffers: file identifier must be length "+ea);for(let I=ea-1;I>=0;I--)this.writeInt8(v.charCodeAt(I))}this.prep(this.minalign,bo+_),this.addOffset(t),_&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(t,n){this.finish(t,n,!0)}requiredField(t,n){const u=this.bb.capacity()-t,_=u-this.bb.readInt32(u);if(!(n<this.bb.readInt16(_)&&this.bb.readInt16(_+n)!=0))throw new TypeError("FlatBuffers: field "+n+" must be set")}startVector(t,n,u){this.notNested(),this.vector_num_elems=n,this.prep(bo,t*n),this.prep(u,t*n)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(t){if(!t)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(t))return this.string_maps.get(t);const n=this.createString(t);return this.string_maps.set(t,n),n}createString(t){if(t==null)return 0;let n;return t instanceof Uint8Array?n=t:n=this.text_encoder.encode(t),this.addInt8(0),this.startVector(1,n.length,1),this.bb.setPosition(this.space-=n.length),this.bb.bytes().set(n,this.space),this.endVector()}createByteVector(t){return t==null?0:(this.startVector(1,t.length,1),this.bb.setPosition(this.space-=t.length),this.bb.bytes().set(t,this.space),this.endVector())}createObjectOffset(t){return t===null?0:typeof t=="string"?this.createString(t):t.pack(this)}createObjectOffsetList(t){const n=[];for(let u=0;u<t.length;++u){const _=t[u];if(_!==null)n.push(this.createObjectOffset(_));else throw new TypeError("FlatBuffers: Argument for createObjectOffsetList cannot contain null.")}return n}createStructOffsetList(t,n){return n(this,t.length),this.createObjectOffsetList(t.slice().reverse()),this.endVector()}};var wp;(function(s){s[s.BUFFER=0]="BUFFER"})(wp||(wp={}));var Sp;(function(s){s[s.LZ4_FRAME=0]="LZ4_FRAME",s[s.ZSTD=1]="ZSTD"})(Sp||(Sp={}));class La{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsBodyCompression(t,n){return(n||new La).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBodyCompression(t,n){return t.setPosition(t.position()+Vi),(n||new La).__init(t.readInt32(t.position())+t.position(),t)}codec(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt8(this.bb_pos+t):Sp.LZ4_FRAME}method(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt8(this.bb_pos+t):wp.BUFFER}static startBodyCompression(t){t.startObject(2)}static addCodec(t,n){t.addFieldInt8(0,n,Sp.LZ4_FRAME)}static addMethod(t,n){t.addFieldInt8(1,n,wp.BUFFER)}static endBodyCompression(t){return t.endObject()}static createBodyCompression(t,n,u){return La.startBodyCompression(t),La.addCodec(t,n),La.addMethod(t,u),La.endBodyCompression(t)}}class qv{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}offset(){return this.bb.readInt64(this.bb_pos)}length(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createBuffer(t,n,u){return t.prep(8,16),t.writeInt64(BigInt(u??0)),t.writeInt64(BigInt(n??0)),t.offset()}}let Gv=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}length(){return this.bb.readInt64(this.bb_pos)}nullCount(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createFieldNode(t,n,u){return t.prep(8,16),t.writeInt64(BigInt(u??0)),t.writeInt64(BigInt(n??0)),t.offset()}},Xo=class Qm{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsRecordBatch(t,n){return(n||new Qm).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsRecordBatch(t,n){return t.setPosition(t.position()+Vi),(n||new Qm).__init(t.readInt32(t.position())+t.position(),t)}length(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}nodes(t,n){const u=this.bb.__offset(this.bb_pos,6);return u?(n||new Gv).__init(this.bb.__vector(this.bb_pos+u)+t*16,this.bb):null}nodesLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}buffers(t,n){const u=this.bb.__offset(this.bb_pos,8);return u?(n||new qv).__init(this.bb.__vector(this.bb_pos+u)+t*16,this.bb):null}buffersLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}compression(t){const n=this.bb.__offset(this.bb_pos,10);return n?(t||new La).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}static startRecordBatch(t){t.startObject(4)}static addLength(t,n){t.addFieldInt64(0,n,BigInt("0"))}static addNodes(t,n){t.addFieldOffset(1,n,0)}static startNodesVector(t,n){t.startVector(16,n,8)}static addBuffers(t,n){t.addFieldOffset(2,n,0)}static startBuffersVector(t,n){t.startVector(16,n,8)}static addCompression(t,n){t.addFieldOffset(3,n,0)}static endRecordBatch(t){return t.endObject()}},mc=class tg{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsDictionaryBatch(t,n){return(n||new tg).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDictionaryBatch(t,n){return t.setPosition(t.position()+Vi),(n||new tg).__init(t.readInt32(t.position())+t.position(),t)}id(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}data(t){const n=this.bb.__offset(this.bb_pos,6);return n?(t||new Xo).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}isDelta(){const t=this.bb.__offset(this.bb_pos,8);return t?!!this.bb.readInt8(this.bb_pos+t):!1}static startDictionaryBatch(t){t.startObject(3)}static addId(t,n){t.addFieldInt64(0,n,BigInt("0"))}static addData(t,n){t.addFieldOffset(1,n,0)}static addIsDelta(t,n){t.addFieldInt8(2,+n,0)}static endDictionaryBatch(t){return t.endObject()}};var Uc;(function(s){s[s.Little=0]="Little",s[s.Big=1]="Big"})(Uc||(Uc={}));var Ip;(function(s){s[s.DenseArray=0]="DenseArray"})(Ip||(Ip={}));class gs{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsInt(t,n){return(n||new gs).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsInt(t,n){return t.setPosition(t.position()+Vi),(n||new gs).__init(t.readInt32(t.position())+t.position(),t)}bitWidth(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}isSigned(){const t=this.bb.__offset(this.bb_pos,6);return t?!!this.bb.readInt8(this.bb_pos+t):!1}static startInt(t){t.startObject(2)}static addBitWidth(t,n){t.addFieldInt32(0,n,0)}static addIsSigned(t,n){t.addFieldInt8(1,+n,0)}static endInt(t){return t.endObject()}static createInt(t,n,u){return gs.startInt(t),gs.addBitWidth(t,n),gs.addIsSigned(t,u),gs.endInt(t)}}class ia{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsDictionaryEncoding(t,n){return(n||new ia).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDictionaryEncoding(t,n){return t.setPosition(t.position()+Vi),(n||new ia).__init(t.readInt32(t.position())+t.position(),t)}id(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}indexType(t){const n=this.bb.__offset(this.bb_pos,6);return n?(t||new gs).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}isOrdered(){const t=this.bb.__offset(this.bb_pos,8);return t?!!this.bb.readInt8(this.bb_pos+t):!1}dictionaryKind(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt16(this.bb_pos+t):Ip.DenseArray}static startDictionaryEncoding(t){t.startObject(4)}static addId(t,n){t.addFieldInt64(0,n,BigInt("0"))}static addIndexType(t,n){t.addFieldOffset(1,n,0)}static addIsOrdered(t,n){t.addFieldInt8(2,+n,0)}static addDictionaryKind(t,n){t.addFieldInt16(3,n,Ip.DenseArray)}static endDictionaryEncoding(t){return t.endObject()}}class tn{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsKeyValue(t,n){return(n||new tn).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsKeyValue(t,n){return t.setPosition(t.position()+Vi),(n||new tn).__init(t.readInt32(t.position())+t.position(),t)}key(t){const n=this.bb.__offset(this.bb_pos,4);return n?this.bb.__string(this.bb_pos+n,t):null}value(t){const n=this.bb.__offset(this.bb_pos,6);return n?this.bb.__string(this.bb_pos+n,t):null}static startKeyValue(t){t.startObject(2)}static addKey(t,n){t.addFieldOffset(0,n,0)}static addValue(t,n){t.addFieldOffset(1,n,0)}static endKeyValue(t){return t.endObject()}static createKeyValue(t,n,u){return tn.startKeyValue(t),tn.addKey(t,n),tn.addValue(t,u),tn.endKeyValue(t)}}let h0=class oh{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsBinary(t,n){return(n||new oh).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBinary(t,n){return t.setPosition(t.position()+Vi),(n||new oh).__init(t.readInt32(t.position())+t.position(),t)}static startBinary(t){t.startObject(0)}static endBinary(t){return t.endObject()}static createBinary(t){return oh.startBinary(t),oh.endBinary(t)}},d0=class ah{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsBool(t,n){return(n||new ah).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBool(t,n){return t.setPosition(t.position()+Vi),(n||new ah).__init(t.readInt32(t.position())+t.position(),t)}static startBool(t){t.startObject(0)}static endBool(t){return t.endObject()}static createBool(t){return ah.startBool(t),ah.endBool(t)}},ip=class gc{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsDate(t,n){return(n||new gc).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDate(t,n){return t.setPosition(t.position()+Vi),(n||new gc).__init(t.readInt32(t.position())+t.position(),t)}unit(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Bs.MILLISECOND}static startDate(t){t.startObject(1)}static addUnit(t,n){t.addFieldInt16(0,n,Bs.MILLISECOND)}static endDate(t){return t.endObject()}static createDate(t,n){return gc.startDate(t),gc.addUnit(t,n),gc.endDate(t)}},yc=class Ma{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsDecimal(t,n){return(n||new Ma).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDecimal(t,n){return t.setPosition(t.position()+Vi),(n||new Ma).__init(t.readInt32(t.position())+t.position(),t)}precision(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}scale(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0}bitWidth(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readInt32(this.bb_pos+t):128}static startDecimal(t){t.startObject(3)}static addPrecision(t,n){t.addFieldInt32(0,n,0)}static addScale(t,n){t.addFieldInt32(1,n,0)}static addBitWidth(t,n){t.addFieldInt32(2,n,128)}static endDecimal(t){return t.endObject()}static createDecimal(t,n,u,_){return Ma.startDecimal(t),Ma.addPrecision(t,n),Ma.addScale(t,u),Ma.addBitWidth(t,_),Ma.endDecimal(t)}},rp=class _c{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsDuration(t,n){return(n||new _c).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDuration(t,n){return t.setPosition(t.position()+Vi),(n||new _c).__init(t.readInt32(t.position())+t.position(),t)}unit(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):$e.MILLISECOND}static startDuration(t){t.startObject(1)}static addUnit(t,n){t.addFieldInt16(0,n,$e.MILLISECOND)}static endDuration(t){return t.endObject()}static createDuration(t,n){return _c.startDuration(t),_c.addUnit(t,n),_c.endDuration(t)}},np=class vc{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsFixedSizeBinary(t,n){return(n||new vc).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFixedSizeBinary(t,n){return t.setPosition(t.position()+Vi),(n||new vc).__init(t.readInt32(t.position())+t.position(),t)}byteWidth(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}static startFixedSizeBinary(t){t.startObject(1)}static addByteWidth(t,n){t.addFieldInt32(0,n,0)}static endFixedSizeBinary(t){return t.endObject()}static createFixedSizeBinary(t,n){return vc.startFixedSizeBinary(t),vc.addByteWidth(t,n),vc.endFixedSizeBinary(t)}},sp=class bc{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsFixedSizeList(t,n){return(n||new bc).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFixedSizeList(t,n){return t.setPosition(t.position()+Vi),(n||new bc).__init(t.readInt32(t.position())+t.position(),t)}listSize(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}static startFixedSizeList(t){t.startObject(1)}static addListSize(t,n){t.addFieldInt32(0,n,0)}static endFixedSizeList(t){return t.endObject()}static createFixedSizeList(t,n){return bc.startFixedSizeList(t),bc.addListSize(t,n),bc.endFixedSizeList(t)}};class xo{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsFloatingPoint(t,n){return(n||new xo).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFloatingPoint(t,n){return t.setPosition(t.position()+Vi),(n||new xo).__init(t.readInt32(t.position())+t.position(),t)}precision(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Ln.HALF}static startFloatingPoint(t){t.startObject(1)}static addPrecision(t,n){t.addFieldInt16(0,n,Ln.HALF)}static endFloatingPoint(t){return t.endObject()}static createFloatingPoint(t,n){return xo.startFloatingPoint(t),xo.addPrecision(t,n),xo.endFloatingPoint(t)}}class wo{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsInterval(t,n){return(n||new wo).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsInterval(t,n){return t.setPosition(t.position()+Vi),(n||new wo).__init(t.readInt32(t.position())+t.position(),t)}unit(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Ao.YEAR_MONTH}static startInterval(t){t.startObject(1)}static addUnit(t,n){t.addFieldInt16(0,n,Ao.YEAR_MONTH)}static endInterval(t){return t.endObject()}static createInterval(t,n){return wo.startInterval(t),wo.addUnit(t,n),wo.endInterval(t)}}let p0=class lh{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsLargeBinary(t,n){return(n||new lh).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsLargeBinary(t,n){return t.setPosition(t.position()+Vi),(n||new lh).__init(t.readInt32(t.position())+t.position(),t)}static startLargeBinary(t){t.startObject(0)}static endLargeBinary(t){return t.endObject()}static createLargeBinary(t){return lh.startLargeBinary(t),lh.endLargeBinary(t)}},f0=class ch{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsLargeUtf8(t,n){return(n||new ch).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsLargeUtf8(t,n){return t.setPosition(t.position()+Vi),(n||new ch).__init(t.readInt32(t.position())+t.position(),t)}static startLargeUtf8(t){t.startObject(0)}static endLargeUtf8(t){return t.endObject()}static createLargeUtf8(t){return ch.startLargeUtf8(t),ch.endLargeUtf8(t)}},m0=class uh{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsList(t,n){return(n||new uh).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsList(t,n){return t.setPosition(t.position()+Vi),(n||new uh).__init(t.readInt32(t.position())+t.position(),t)}static startList(t){t.startObject(0)}static endList(t){return t.endObject()}static createList(t){return uh.startList(t),uh.endList(t)}},op=class xc{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsMap(t,n){return(n||new xc).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsMap(t,n){return t.setPosition(t.position()+Vi),(n||new xc).__init(t.readInt32(t.position())+t.position(),t)}keysSorted(){const t=this.bb.__offset(this.bb_pos,4);return t?!!this.bb.readInt8(this.bb_pos+t):!1}static startMap(t){t.startObject(1)}static addKeysSorted(t,n){t.addFieldInt8(0,+n,0)}static endMap(t){return t.endObject()}static createMap(t,n){return xc.startMap(t),xc.addKeysSorted(t,n),xc.endMap(t)}},g0=class hh{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsNull(t,n){return(n||new hh).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsNull(t,n){return t.setPosition(t.position()+Vi),(n||new hh).__init(t.readInt32(t.position())+t.position(),t)}static startNull(t){t.startObject(0)}static endNull(t){return t.endObject()}static createNull(t){return hh.startNull(t),hh.endNull(t)}};class _l{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsStruct_(t,n){return(n||new _l).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsStruct_(t,n){return t.setPosition(t.position()+Vi),(n||new _l).__init(t.readInt32(t.position())+t.position(),t)}static startStruct_(t){t.startObject(0)}static endStruct_(t){return t.endObject()}static createStruct_(t){return _l.startStruct_(t),_l.endStruct_(t)}}class Ps{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsTime(t,n){return(n||new Ps).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsTime(t,n){return t.setPosition(t.position()+Vi),(n||new Ps).__init(t.readInt32(t.position())+t.position(),t)}unit(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):$e.MILLISECOND}bitWidth(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):32}static startTime(t){t.startObject(2)}static addUnit(t,n){t.addFieldInt16(0,n,$e.MILLISECOND)}static addBitWidth(t,n){t.addFieldInt32(1,n,32)}static endTime(t){return t.endObject()}static createTime(t,n,u){return Ps.startTime(t),Ps.addUnit(t,n),Ps.addBitWidth(t,u),Ps.endTime(t)}}class Ls{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsTimestamp(t,n){return(n||new Ls).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsTimestamp(t,n){return t.setPosition(t.position()+Vi),(n||new Ls).__init(t.readInt32(t.position())+t.position(),t)}unit(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):$e.SECOND}timezone(t){const n=this.bb.__offset(this.bb_pos,6);return n?this.bb.__string(this.bb_pos+n,t):null}static startTimestamp(t){t.startObject(2)}static addUnit(t,n){t.addFieldInt16(0,n,$e.SECOND)}static addTimezone(t,n){t.addFieldOffset(1,n,0)}static endTimestamp(t){return t.endObject()}static createTimestamp(t,n,u){return Ls.startTimestamp(t),Ls.addUnit(t,n),Ls.addTimezone(t,u),Ls.endTimestamp(t)}}class os{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsUnion(t,n){return(n||new os).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsUnion(t,n){return t.setPosition(t.position()+Vi),(n||new os).__init(t.readInt32(t.position())+t.position(),t)}mode(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):zn.Sparse}typeIds(t){const n=this.bb.__offset(this.bb_pos,6);return n?this.bb.readInt32(this.bb.__vector(this.bb_pos+n)+t*4):0}typeIdsLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}typeIdsArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}static startUnion(t){t.startObject(2)}static addMode(t,n){t.addFieldInt16(0,n,zn.Sparse)}static addTypeIds(t,n){t.addFieldOffset(1,n,0)}static createTypeIdsVector(t,n){t.startVector(4,n.length,4);for(let u=n.length-1;u>=0;u--)t.addInt32(n[u]);return t.endVector()}static startTypeIdsVector(t,n){t.startVector(4,n,4)}static endUnion(t){return t.endObject()}static createUnion(t,n,u){return os.startUnion(t),os.addMode(t,n),os.addTypeIds(t,u),os.endUnion(t)}}let y0=class dh{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsUtf8(t,n){return(n||new dh).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsUtf8(t,n){return t.setPosition(t.position()+Vi),(n||new dh).__init(t.readInt32(t.position())+t.position(),t)}static startUtf8(t){t.startObject(0)}static endUtf8(t){return t.endObject()}static createUtf8(t){return dh.startUtf8(t),dh.endUtf8(t)}};var ar;(function(s){s[s.NONE=0]="NONE",s[s.Null=1]="Null",s[s.Int=2]="Int",s[s.FloatingPoint=3]="FloatingPoint",s[s.Binary=4]="Binary",s[s.Utf8=5]="Utf8",s[s.Bool=6]="Bool",s[s.Decimal=7]="Decimal",s[s.Date=8]="Date",s[s.Time=9]="Time",s[s.Timestamp=10]="Timestamp",s[s.Interval=11]="Interval",s[s.List=12]="List",s[s.Struct_=13]="Struct_",s[s.Union=14]="Union",s[s.FixedSizeBinary=15]="FixedSizeBinary",s[s.FixedSizeList=16]="FixedSizeList",s[s.Map=17]="Map",s[s.Duration=18]="Duration",s[s.LargeBinary=19]="LargeBinary",s[s.LargeUtf8=20]="LargeUtf8",s[s.LargeList=21]="LargeList",s[s.RunEndEncoded=22]="RunEndEncoded"})(ar||(ar={}));let Ms=class ap{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsField(t,n){return(n||new ap).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsField(t,n){return t.setPosition(t.position()+Vi),(n||new ap).__init(t.readInt32(t.position())+t.position(),t)}name(t){const n=this.bb.__offset(this.bb_pos,4);return n?this.bb.__string(this.bb_pos+n,t):null}nullable(){const t=this.bb.__offset(this.bb_pos,6);return t?!!this.bb.readInt8(this.bb_pos+t):!1}typeType(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint8(this.bb_pos+t):ar.NONE}type(t){const n=this.bb.__offset(this.bb_pos,10);return n?this.bb.__union(t,this.bb_pos+n):null}dictionary(t){const n=this.bb.__offset(this.bb_pos,12);return n?(t||new ia).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}children(t,n){const u=this.bb.__offset(this.bb_pos,14);return u?(n||new ap).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+u)+t*4),this.bb):null}childrenLength(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,n){const u=this.bb.__offset(this.bb_pos,16);return u?(n||new tn).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+u)+t*4),this.bb):null}customMetadataLength(){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.__vector_len(this.bb_pos+t):0}static startField(t){t.startObject(7)}static addName(t,n){t.addFieldOffset(0,n,0)}static addNullable(t,n){t.addFieldInt8(1,+n,0)}static addTypeType(t,n){t.addFieldInt8(2,n,ar.NONE)}static addType(t,n){t.addFieldOffset(3,n,0)}static addDictionary(t,n){t.addFieldOffset(4,n,0)}static addChildren(t,n){t.addFieldOffset(5,n,0)}static createChildrenVector(t,n){t.startVector(4,n.length,4);for(let u=n.length-1;u>=0;u--)t.addOffset(n[u]);return t.endVector()}static startChildrenVector(t,n){t.startVector(4,n,4)}static addCustomMetadata(t,n){t.addFieldOffset(6,n,0)}static createCustomMetadataVector(t,n){t.startVector(4,n.length,4);for(let u=n.length-1;u>=0;u--)t.addOffset(n[u]);return t.endVector()}static startCustomMetadataVector(t,n){t.startVector(4,n,4)}static endField(t){return t.endObject()}},yo=class Ko{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsSchema(t,n){return(n||new Ko).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsSchema(t,n){return t.setPosition(t.position()+Vi),(n||new Ko).__init(t.readInt32(t.position())+t.position(),t)}endianness(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Uc.Little}fields(t,n){const u=this.bb.__offset(this.bb_pos,6);return u?(n||new Ms).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+u)+t*4),this.bb):null}fieldsLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,n){const u=this.bb.__offset(this.bb_pos,8);return u?(n||new tn).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+u)+t*4),this.bb):null}customMetadataLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}features(t){const n=this.bb.__offset(this.bb_pos,10);return n?this.bb.readInt64(this.bb.__vector(this.bb_pos+n)+t*8):BigInt(0)}featuresLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}static startSchema(t){t.startObject(4)}static addEndianness(t,n){t.addFieldInt16(0,n,Uc.Little)}static addFields(t,n){t.addFieldOffset(1,n,0)}static createFieldsVector(t,n){t.startVector(4,n.length,4);for(let u=n.length-1;u>=0;u--)t.addOffset(n[u]);return t.endVector()}static startFieldsVector(t,n){t.startVector(4,n,4)}static addCustomMetadata(t,n){t.addFieldOffset(2,n,0)}static createCustomMetadataVector(t,n){t.startVector(4,n.length,4);for(let u=n.length-1;u>=0;u--)t.addOffset(n[u]);return t.endVector()}static startCustomMetadataVector(t,n){t.startVector(4,n,4)}static addFeatures(t,n){t.addFieldOffset(3,n,0)}static createFeaturesVector(t,n){t.startVector(8,n.length,8);for(let u=n.length-1;u>=0;u--)t.addInt64(n[u]);return t.endVector()}static startFeaturesVector(t,n){t.startVector(8,n,8)}static endSchema(t){return t.endObject()}static finishSchemaBuffer(t,n){t.finish(n)}static finishSizePrefixedSchemaBuffer(t,n){t.finish(n,void 0,!0)}static createSchema(t,n,u,_,v){return Ko.startSchema(t),Ko.addEndianness(t,n),Ko.addFields(t,u),Ko.addCustomMetadata(t,_),Ko.addFeatures(t,v),Ko.endSchema(t)}};var Li;(function(s){s[s.NONE=0]="NONE",s[s.Schema=1]="Schema",s[s.DictionaryBatch=2]="DictionaryBatch",s[s.RecordBatch=3]="RecordBatch",s[s.Tensor=4]="Tensor",s[s.SparseTensor=5]="SparseTensor"})(Li||(Li={}));var st;(function(s){s[s.NONE=0]="NONE",s[s.Null=1]="Null",s[s.Int=2]="Int",s[s.Float=3]="Float",s[s.Binary=4]="Binary",s[s.Utf8=5]="Utf8",s[s.Bool=6]="Bool",s[s.Decimal=7]="Decimal",s[s.Date=8]="Date",s[s.Time=9]="Time",s[s.Timestamp=10]="Timestamp",s[s.Interval=11]="Interval",s[s.List=12]="List",s[s.Struct=13]="Struct",s[s.Union=14]="Union",s[s.FixedSizeBinary=15]="FixedSizeBinary",s[s.FixedSizeList=16]="FixedSizeList",s[s.Map=17]="Map",s[s.Duration=18]="Duration",s[s.LargeBinary=19]="LargeBinary",s[s.LargeUtf8=20]="LargeUtf8",s[s.Dictionary=-1]="Dictionary",s[s.Int8=-2]="Int8",s[s.Int16=-3]="Int16",s[s.Int32=-4]="Int32",s[s.Int64=-5]="Int64",s[s.Uint8=-6]="Uint8",s[s.Uint16=-7]="Uint16",s[s.Uint32=-8]="Uint32",s[s.Uint64=-9]="Uint64",s[s.Float16=-10]="Float16",s[s.Float32=-11]="Float32",s[s.Float64=-12]="Float64",s[s.DateDay=-13]="DateDay",s[s.DateMillisecond=-14]="DateMillisecond",s[s.TimestampSecond=-15]="TimestampSecond",s[s.TimestampMillisecond=-16]="TimestampMillisecond",s[s.TimestampMicrosecond=-17]="TimestampMicrosecond",s[s.TimestampNanosecond=-18]="TimestampNanosecond",s[s.TimeSecond=-19]="TimeSecond",s[s.TimeMillisecond=-20]="TimeMillisecond",s[s.TimeMicrosecond=-21]="TimeMicrosecond",s[s.TimeNanosecond=-22]="TimeNanosecond",s[s.DenseUnion=-23]="DenseUnion",s[s.SparseUnion=-24]="SparseUnion",s[s.IntervalDayTime=-25]="IntervalDayTime",s[s.IntervalYearMonth=-26]="IntervalYearMonth",s[s.DurationSecond=-27]="DurationSecond",s[s.DurationMillisecond=-28]="DurationMillisecond",s[s.DurationMicrosecond=-29]="DurationMicrosecond",s[s.DurationNanosecond=-30]="DurationNanosecond"})(st||(st={}));var Jo;(function(s){s[s.OFFSET=0]="OFFSET",s[s.DATA=1]="DATA",s[s.VALIDITY=2]="VALIDITY",s[s.TYPE=3]="TYPE"})(Jo||(Jo={}));const yk=void 0;function vh(s){if(s===null)return"null";if(s===yk)return"undefined";switch(typeof s){case"number":return`${s}`;case"bigint":return`${s}`;case"string":return`"${s}"`}return typeof s[Symbol.toPrimitive]=="function"?s[Symbol.toPrimitive]("string"):ArrayBuffer.isView(s)?s instanceof BigInt64Array||s instanceof BigUint64Array?`[${[...s].map(t=>vh(t))}]`:`[${s}]`:ArrayBuffer.isView(s)?`[${s}]`:JSON.stringify(s,(t,n)=>typeof n=="bigint"?`${n}`:n)}function er(s){if(typeof s=="bigint"&&(s<Number.MIN_SAFE_INTEGER||s>Number.MAX_SAFE_INTEGER))throw new TypeError(`${s} is not safe to convert to a number.`);return Number(s)}function Zv(s,t){return er(s/t)+er(s%t)/er(t)}const _k=Symbol.for("isArrowBigNum");function io(s,...t){return t.length===0?Object.setPrototypeOf(Zi(this.TypedArray,s),this.constructor.prototype):Object.setPrototypeOf(new this.TypedArray(s,...t),this.constructor.prototype)}io.prototype[_k]=!0;io.prototype.toJSON=function(){return`"${xh(this)}"`};io.prototype.valueOf=function(s){return Wv(this,s)};io.prototype.toString=function(){return xh(this)};io.prototype[Symbol.toPrimitive]=function(s="default"){switch(s){case"number":return Wv(this);case"string":return xh(this);case"default":return xk(this)}return xh(this)};function Pc(...s){return io.apply(this,s)}function Lc(...s){return io.apply(this,s)}function bh(...s){return io.apply(this,s)}Object.setPrototypeOf(Pc.prototype,Object.create(Int32Array.prototype));Object.setPrototypeOf(Lc.prototype,Object.create(Uint32Array.prototype));Object.setPrototypeOf(bh.prototype,Object.create(Uint32Array.prototype));Object.assign(Pc.prototype,io.prototype,{constructor:Pc,signed:!0,TypedArray:Int32Array,BigIntArray:BigInt64Array});Object.assign(Lc.prototype,io.prototype,{constructor:Lc,signed:!1,TypedArray:Uint32Array,BigIntArray:BigUint64Array});Object.assign(bh.prototype,io.prototype,{constructor:bh,signed:!0,TypedArray:Uint32Array,BigIntArray:BigUint64Array});const vk=BigInt(4294967296)*BigInt(4294967296),bk=vk-BigInt(1);function Wv(s,t){const{buffer:n,byteOffset:u,byteLength:_,signed:v}=s,I=new BigUint64Array(n,u,_/8),l=v&&I.at(-1)&BigInt(1)<<BigInt(63);let P=BigInt(0),E=0;if(l){for(const U of I)P|=(U^bk)*(BigInt(1)<<BigInt(64*E++));P*=BigInt(-1),P-=BigInt(1)}else for(const U of I)P|=U*(BigInt(1)<<BigInt(64*E++));if(typeof t=="number"){const U=BigInt(Math.pow(10,t)),j=P/U,W=P%U;return er(j)+er(W)/er(U)}return er(P)}function xh(s){if(s.byteLength===8)return`${new s.BigIntArray(s.buffer,s.byteOffset,1)[0]}`;if(!s.signed)return km(s);let t=new Uint16Array(s.buffer,s.byteOffset,s.byteLength/2);if(new Int16Array([t.at(-1)])[0]>=0)return km(s);t=t.slice();let u=1;for(let v=0;v<t.length;v++){const I=t[v],l=~I+u;t[v]=l,u&=I===0?1:0}return`-${km(t)}`}function xk(s){return s.byteLength===8?new s.BigIntArray(s.buffer,s.byteOffset,1)[0]:xh(s)}function km(s){let t="";const n=new Uint32Array(2);let u=new Uint16Array(s.buffer,s.byteOffset,s.byteLength/2);const _=new Uint32Array((u=new Uint16Array(u).reverse()).buffer);let v=-1;const I=u.length-1;do{for(n[0]=u[v=0];v<I;)u[v++]=n[1]=n[0]/10,n[0]=(n[0]-n[1]*10<<16)+u[v];u[v]=n[1]=n[0]/10,n[0]=n[0]-n[1]*10,t=`${n[0]}${t}`}while(_[0]||_[1]||_[2]||_[3]);return t??"0"}class Mg{static new(t,n){switch(n){case!0:return new Pc(t);case!1:return new Lc(t)}switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:case BigInt64Array:return new Pc(t)}return t.byteLength===16?new bh(t):new Lc(t)}static signed(t){return new Pc(t)}static unsigned(t){return new Lc(t)}static decimal(t){return new bh(t)}constructor(t,n){return Mg.new(t,n)}}var Hv,Yv,Kv,Xv,Jv,Qv,tb,eb,ib,rb,nb,sb,ob,ab,lb,cb,ub,hb,db,pb,fb,mb;class Me{static isNull(t){return(t==null?void 0:t.typeId)===st.Null}static isInt(t){return(t==null?void 0:t.typeId)===st.Int}static isFloat(t){return(t==null?void 0:t.typeId)===st.Float}static isBinary(t){return(t==null?void 0:t.typeId)===st.Binary}static isLargeBinary(t){return(t==null?void 0:t.typeId)===st.LargeBinary}static isUtf8(t){return(t==null?void 0:t.typeId)===st.Utf8}static isLargeUtf8(t){return(t==null?void 0:t.typeId)===st.LargeUtf8}static isBool(t){return(t==null?void 0:t.typeId)===st.Bool}static isDecimal(t){return(t==null?void 0:t.typeId)===st.Decimal}static isDate(t){return(t==null?void 0:t.typeId)===st.Date}static isTime(t){return(t==null?void 0:t.typeId)===st.Time}static isTimestamp(t){return(t==null?void 0:t.typeId)===st.Timestamp}static isInterval(t){return(t==null?void 0:t.typeId)===st.Interval}static isDuration(t){return(t==null?void 0:t.typeId)===st.Duration}static isList(t){return(t==null?void 0:t.typeId)===st.List}static isStruct(t){return(t==null?void 0:t.typeId)===st.Struct}static isUnion(t){return(t==null?void 0:t.typeId)===st.Union}static isFixedSizeBinary(t){return(t==null?void 0:t.typeId)===st.FixedSizeBinary}static isFixedSizeList(t){return(t==null?void 0:t.typeId)===st.FixedSizeList}static isMap(t){return(t==null?void 0:t.typeId)===st.Map}static isDictionary(t){return(t==null?void 0:t.typeId)===st.Dictionary}static isDenseUnion(t){return Me.isUnion(t)&&t.mode===zn.Dense}static isSparseUnion(t){return Me.isUnion(t)&&t.mode===zn.Sparse}constructor(t){this.typeId=t}}Hv=Symbol.toStringTag;Me[Hv]=(s=>(s.children=null,s.ArrayType=Array,s.OffsetArrayType=Int32Array,s[Symbol.toStringTag]="DataType"))(Me.prototype);class Ua extends Me{constructor(){super(st.Null)}toString(){return"Null"}}Yv=Symbol.toStringTag;Ua[Yv]=(s=>s[Symbol.toStringTag]="Null")(Ua.prototype);class kl extends Me{constructor(t,n){super(st.Int),this.isSigned=t,this.bitWidth=n}get ArrayType(){switch(this.bitWidth){case 8:return this.isSigned?Int8Array:Uint8Array;case 16:return this.isSigned?Int16Array:Uint16Array;case 32:return this.isSigned?Int32Array:Uint32Array;case 64:return this.isSigned?BigInt64Array:BigUint64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`${this.isSigned?"I":"Ui"}nt${this.bitWidth}`}}Kv=Symbol.toStringTag;kl[Kv]=(s=>(s.isSigned=null,s.bitWidth=null,s[Symbol.toStringTag]="Int"))(kl.prototype);class wh extends kl{constructor(){super(!0,32)}get ArrayType(){return Int32Array}}Object.defineProperty(wh.prototype,"ArrayType",{value:Int32Array});class Tp extends Me{constructor(t){super(st.Float),this.precision=t}get ArrayType(){switch(this.precision){case Ln.HALF:return Uint16Array;case Ln.SINGLE:return Float32Array;case Ln.DOUBLE:return Float64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`Float${this.precision<<5||16}`}}Xv=Symbol.toStringTag;Tp[Xv]=(s=>(s.precision=null,s[Symbol.toStringTag]="Float"))(Tp.prototype);class kp extends Me{constructor(){super(st.Binary)}toString(){return"Binary"}}Jv=Symbol.toStringTag;kp[Jv]=(s=>(s.ArrayType=Uint8Array,s[Symbol.toStringTag]="Binary"))(kp.prototype);class Ap extends Me{constructor(){super(st.LargeBinary)}toString(){return"LargeBinary"}}Qv=Symbol.toStringTag;Ap[Qv]=(s=>(s.ArrayType=Uint8Array,s.OffsetArrayType=BigInt64Array,s[Symbol.toStringTag]="LargeBinary"))(Ap.prototype);class Ep extends Me{constructor(){super(st.Utf8)}toString(){return"Utf8"}}tb=Symbol.toStringTag;Ep[tb]=(s=>(s.ArrayType=Uint8Array,s[Symbol.toStringTag]="Utf8"))(Ep.prototype);class Cp extends Me{constructor(){super(st.LargeUtf8)}toString(){return"LargeUtf8"}}eb=Symbol.toStringTag;Cp[eb]=(s=>(s.ArrayType=Uint8Array,s.OffsetArrayType=BigInt64Array,s[Symbol.toStringTag]="LargeUtf8"))(Cp.prototype);class Mp extends Me{constructor(){super(st.Bool)}toString(){return"Bool"}}ib=Symbol.toStringTag;Mp[ib]=(s=>(s.ArrayType=Uint8Array,s[Symbol.toStringTag]="Bool"))(Mp.prototype);class Dp extends Me{constructor(t,n,u=128){super(st.Decimal),this.scale=t,this.precision=n,this.bitWidth=u}toString(){return`Decimal[${this.precision}e${this.scale>0?"+":""}${this.scale}]`}}rb=Symbol.toStringTag;Dp[rb]=(s=>(s.scale=null,s.precision=null,s.ArrayType=Uint32Array,s[Symbol.toStringTag]="Decimal"))(Dp.prototype);class Pp extends Me{constructor(t){super(st.Date),this.unit=t}toString(){return`Date${(this.unit+1)*32}<${Bs[this.unit]}>`}get ArrayType(){return this.unit===Bs.DAY?Int32Array:BigInt64Array}}nb=Symbol.toStringTag;Pp[nb]=(s=>(s.unit=null,s[Symbol.toStringTag]="Date"))(Pp.prototype);class Lp extends Me{constructor(t,n){super(st.Time),this.unit=t,this.bitWidth=n}toString(){return`Time${this.bitWidth}<${$e[this.unit]}>`}get ArrayType(){switch(this.bitWidth){case 32:return Int32Array;case 64:return BigInt64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}}sb=Symbol.toStringTag;Lp[sb]=(s=>(s.unit=null,s.bitWidth=null,s[Symbol.toStringTag]="Time"))(Lp.prototype);class zp extends Me{constructor(t,n){super(st.Timestamp),this.unit=t,this.timezone=n}toString(){return`Timestamp<${$e[this.unit]}${this.timezone?`, ${this.timezone}`:""}>`}}ob=Symbol.toStringTag;zp[ob]=(s=>(s.unit=null,s.timezone=null,s.ArrayType=BigInt64Array,s[Symbol.toStringTag]="Timestamp"))(zp.prototype);class Bp extends Me{constructor(t){super(st.Interval),this.unit=t}toString(){return`Interval<${Ao[this.unit]}>`}}ab=Symbol.toStringTag;Bp[ab]=(s=>(s.unit=null,s.ArrayType=Int32Array,s[Symbol.toStringTag]="Interval"))(Bp.prototype);class Rp extends Me{constructor(t){super(st.Duration),this.unit=t}toString(){return`Duration<${$e[this.unit]}>`}}lb=Symbol.toStringTag;Rp[lb]=(s=>(s.unit=null,s.ArrayType=BigInt64Array,s[Symbol.toStringTag]="Duration"))(Rp.prototype);class Fp extends Me{constructor(t){super(st.List),this.children=[t]}toString(){return`List<${this.valueType}>`}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}}cb=Symbol.toStringTag;Fp[cb]=(s=>(s.children=null,s[Symbol.toStringTag]="List"))(Fp.prototype);class Zn extends Me{constructor(t){super(st.Struct),this.children=t}toString(){return`Struct<{${this.children.map(t=>`${t.name}:${t.type}`).join(", ")}}>`}}ub=Symbol.toStringTag;Zn[ub]=(s=>(s.children=null,s[Symbol.toStringTag]="Struct"))(Zn.prototype);class Op extends Me{constructor(t,n,u){super(st.Union),this.mode=t,this.children=u,this.typeIds=n=Int32Array.from(n),this.typeIdToChildIndex=n.reduce((_,v,I)=>(_[v]=I)&&_||_,Object.create(null))}toString(){return`${this[Symbol.toStringTag]}<${this.children.map(t=>`${t.type}`).join(" | ")}>`}}hb=Symbol.toStringTag;Op[hb]=(s=>(s.mode=null,s.typeIds=null,s.children=null,s.typeIdToChildIndex=null,s.ArrayType=Int8Array,s[Symbol.toStringTag]="Union"))(Op.prototype);class Np extends Me{constructor(t){super(st.FixedSizeBinary),this.byteWidth=t}toString(){return`FixedSizeBinary[${this.byteWidth}]`}}db=Symbol.toStringTag;Np[db]=(s=>(s.byteWidth=null,s.ArrayType=Uint8Array,s[Symbol.toStringTag]="FixedSizeBinary"))(Np.prototype);class Up extends Me{constructor(t,n){super(st.FixedSizeList),this.listSize=t,this.children=[n]}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}toString(){return`FixedSizeList[${this.listSize}]<${this.valueType}>`}}pb=Symbol.toStringTag;Up[pb]=(s=>(s.children=null,s.listSize=null,s[Symbol.toStringTag]="FixedSizeList"))(Up.prototype);class Vp extends Me{constructor(t,n=!1){var u,_,v;if(super(st.Map),this.children=[t],this.keysSorted=n,t&&(t.name="entries",!((u=t==null?void 0:t.type)===null||u===void 0)&&u.children)){const I=(_=t==null?void 0:t.type)===null||_===void 0?void 0:_.children[0];I&&(I.name="key");const l=(v=t==null?void 0:t.type)===null||v===void 0?void 0:v.children[1];l&&(l.name="value")}}get keyType(){return this.children[0].type.children[0].type}get valueType(){return this.children[0].type.children[1].type}get childType(){return this.children[0].type}toString(){return`Map<{${this.children[0].type.children.map(t=>`${t.name}:${t.type}`).join(", ")}}>`}}fb=Symbol.toStringTag;Vp[fb]=(s=>(s.children=null,s.keysSorted=null,s[Symbol.toStringTag]="Map_"))(Vp.prototype);const wk=(s=>()=>++s)(-1);class Vc extends Me{constructor(t,n,u,_){super(st.Dictionary),this.indices=n,this.dictionary=t,this.isOrdered=_||!1,this.id=u==null?wk():er(u)}get children(){return this.dictionary.children}get valueType(){return this.dictionary}get ArrayType(){return this.dictionary.ArrayType}toString(){return`Dictionary<${this.indices}, ${this.dictionary}>`}}mb=Symbol.toStringTag;Vc[mb]=(s=>(s.id=null,s.indices=null,s.isOrdered=null,s.dictionary=null,s[Symbol.toStringTag]="Dictionary"))(Vc.prototype);function Qo(s){const t=s;switch(s.typeId){case st.Decimal:return s.bitWidth/32;case st.Interval:return 1+t.unit;case st.FixedSizeList:return t.listSize;case st.FixedSizeBinary:return t.byteWidth;default:return 1}}class fi{visitMany(t,...n){return t.map((u,_)=>this.visit(u,...n.map(v=>v[_])))}visit(...t){return this.getVisitFn(t[0],!1).apply(this,t)}getVisitFn(t,n=!0){return Sk(this,t,n)}getVisitFnByTypeId(t,n=!0){return wc(this,t,n)}visitNull(t,...n){return null}visitBool(t,...n){return null}visitInt(t,...n){return null}visitFloat(t,...n){return null}visitUtf8(t,...n){return null}visitLargeUtf8(t,...n){return null}visitBinary(t,...n){return null}visitLargeBinary(t,...n){return null}visitFixedSizeBinary(t,...n){return null}visitDate(t,...n){return null}visitTimestamp(t,...n){return null}visitTime(t,...n){return null}visitDecimal(t,...n){return null}visitList(t,...n){return null}visitStruct(t,...n){return null}visitUnion(t,...n){return null}visitDictionary(t,...n){return null}visitInterval(t,...n){return null}visitDuration(t,...n){return null}visitFixedSizeList(t,...n){return null}visitMap(t,...n){return null}}function Sk(s,t,n=!0){return typeof t=="number"?wc(s,t,n):typeof t=="string"&&t in st?wc(s,st[t],n):t&&t instanceof Me?wc(s,_0(t),n):t!=null&&t.type&&t.type instanceof Me?wc(s,_0(t.type),n):wc(s,st.NONE,n)}function wc(s,t,n=!0){let u=null;switch(t){case st.Null:u=s.visitNull;break;case st.Bool:u=s.visitBool;break;case st.Int:u=s.visitInt;break;case st.Int8:u=s.visitInt8||s.visitInt;break;case st.Int16:u=s.visitInt16||s.visitInt;break;case st.Int32:u=s.visitInt32||s.visitInt;break;case st.Int64:u=s.visitInt64||s.visitInt;break;case st.Uint8:u=s.visitUint8||s.visitInt;break;case st.Uint16:u=s.visitUint16||s.visitInt;break;case st.Uint32:u=s.visitUint32||s.visitInt;break;case st.Uint64:u=s.visitUint64||s.visitInt;break;case st.Float:u=s.visitFloat;break;case st.Float16:u=s.visitFloat16||s.visitFloat;break;case st.Float32:u=s.visitFloat32||s.visitFloat;break;case st.Float64:u=s.visitFloat64||s.visitFloat;break;case st.Utf8:u=s.visitUtf8;break;case st.LargeUtf8:u=s.visitLargeUtf8;break;case st.Binary:u=s.visitBinary;break;case st.LargeBinary:u=s.visitLargeBinary;break;case st.FixedSizeBinary:u=s.visitFixedSizeBinary;break;case st.Date:u=s.visitDate;break;case st.DateDay:u=s.visitDateDay||s.visitDate;break;case st.DateMillisecond:u=s.visitDateMillisecond||s.visitDate;break;case st.Timestamp:u=s.visitTimestamp;break;case st.TimestampSecond:u=s.visitTimestampSecond||s.visitTimestamp;break;case st.TimestampMillisecond:u=s.visitTimestampMillisecond||s.visitTimestamp;break;case st.TimestampMicrosecond:u=s.visitTimestampMicrosecond||s.visitTimestamp;break;case st.TimestampNanosecond:u=s.visitTimestampNanosecond||s.visitTimestamp;break;case st.Time:u=s.visitTime;break;case st.TimeSecond:u=s.visitTimeSecond||s.visitTime;break;case st.TimeMillisecond:u=s.visitTimeMillisecond||s.visitTime;break;case st.TimeMicrosecond:u=s.visitTimeMicrosecond||s.visitTime;break;case st.TimeNanosecond:u=s.visitTimeNanosecond||s.visitTime;break;case st.Decimal:u=s.visitDecimal;break;case st.List:u=s.visitList;break;case st.Struct:u=s.visitStruct;break;case st.Union:u=s.visitUnion;break;case st.DenseUnion:u=s.visitDenseUnion||s.visitUnion;break;case st.SparseUnion:u=s.visitSparseUnion||s.visitUnion;break;case st.Dictionary:u=s.visitDictionary;break;case st.Interval:u=s.visitInterval;break;case st.IntervalDayTime:u=s.visitIntervalDayTime||s.visitInterval;break;case st.IntervalYearMonth:u=s.visitIntervalYearMonth||s.visitInterval;break;case st.Duration:u=s.visitDuration;break;case st.DurationSecond:u=s.visitDurationSecond||s.visitDuration;break;case st.DurationMillisecond:u=s.visitDurationMillisecond||s.visitDuration;break;case st.DurationMicrosecond:u=s.visitDurationMicrosecond||s.visitDuration;break;case st.DurationNanosecond:u=s.visitDurationNanosecond||s.visitDuration;break;case st.FixedSizeList:u=s.visitFixedSizeList;break;case st.Map:u=s.visitMap;break}if(typeof u=="function")return u;if(!n)return()=>null;throw new Error(`Unrecognized type '${st[t]}'`)}function _0(s){switch(s.typeId){case st.Null:return st.Null;case st.Int:{const{bitWidth:t,isSigned:n}=s;switch(t){case 8:return n?st.Int8:st.Uint8;case 16:return n?st.Int16:st.Uint16;case 32:return n?st.Int32:st.Uint32;case 64:return n?st.Int64:st.Uint64}return st.Int}case st.Float:switch(s.precision){case Ln.HALF:return st.Float16;case Ln.SINGLE:return st.Float32;case Ln.DOUBLE:return st.Float64}return st.Float;case st.Binary:return st.Binary;case st.LargeBinary:return st.LargeBinary;case st.Utf8:return st.Utf8;case st.LargeUtf8:return st.LargeUtf8;case st.Bool:return st.Bool;case st.Decimal:return st.Decimal;case st.Time:switch(s.unit){case $e.SECOND:return st.TimeSecond;case $e.MILLISECOND:return st.TimeMillisecond;case $e.MICROSECOND:return st.TimeMicrosecond;case $e.NANOSECOND:return st.TimeNanosecond}return st.Time;case st.Timestamp:switch(s.unit){case $e.SECOND:return st.TimestampSecond;case $e.MILLISECOND:return st.TimestampMillisecond;case $e.MICROSECOND:return st.TimestampMicrosecond;case $e.NANOSECOND:return st.TimestampNanosecond}return st.Timestamp;case st.Date:switch(s.unit){case Bs.DAY:return st.DateDay;case Bs.MILLISECOND:return st.DateMillisecond}return st.Date;case st.Interval:switch(s.unit){case Ao.DAY_TIME:return st.IntervalDayTime;case Ao.YEAR_MONTH:return st.IntervalYearMonth}return st.Interval;case st.Duration:switch(s.unit){case $e.SECOND:return st.DurationSecond;case $e.MILLISECOND:return st.DurationMillisecond;case $e.MICROSECOND:return st.DurationMicrosecond;case $e.NANOSECOND:return st.DurationNanosecond}return st.Duration;case st.Map:return st.Map;case st.List:return st.List;case st.Struct:return st.Struct;case st.Union:switch(s.mode){case zn.Dense:return st.DenseUnion;case zn.Sparse:return st.SparseUnion}return st.Union;case st.FixedSizeBinary:return st.FixedSizeBinary;case st.FixedSizeList:return st.FixedSizeList;case st.Dictionary:return st.Dictionary}throw new Error(`Unrecognized type '${st[s.typeId]}'`)}fi.prototype.visitInt8=null;fi.prototype.visitInt16=null;fi.prototype.visitInt32=null;fi.prototype.visitInt64=null;fi.prototype.visitUint8=null;fi.prototype.visitUint16=null;fi.prototype.visitUint32=null;fi.prototype.visitUint64=null;fi.prototype.visitFloat16=null;fi.prototype.visitFloat32=null;fi.prototype.visitFloat64=null;fi.prototype.visitDateDay=null;fi.prototype.visitDateMillisecond=null;fi.prototype.visitTimestampSecond=null;fi.prototype.visitTimestampMillisecond=null;fi.prototype.visitTimestampMicrosecond=null;fi.prototype.visitTimestampNanosecond=null;fi.prototype.visitTimeSecond=null;fi.prototype.visitTimeMillisecond=null;fi.prototype.visitTimeMicrosecond=null;fi.prototype.visitTimeNanosecond=null;fi.prototype.visitDenseUnion=null;fi.prototype.visitSparseUnion=null;fi.prototype.visitIntervalDayTime=null;fi.prototype.visitIntervalYearMonth=null;fi.prototype.visitDuration=null;fi.prototype.visitDurationSecond=null;fi.prototype.visitDurationMillisecond=null;fi.prototype.visitDurationMicrosecond=null;fi.prototype.visitDurationNanosecond=null;const gb=new Float64Array(1),pc=new Uint32Array(gb.buffer);function yb(s){const t=(s&31744)>>10,n=(s&1023)/1024,u=Math.pow(-1,(s&32768)>>15);switch(t){case 31:return u*(n?Number.NaN:1/0);case 0:return u*(n?6103515625e-14*n:0)}return u*Math.pow(2,t-15)*(1+n)}function Ik(s){if(s!==s)return 32256;gb[0]=s;const t=(pc[1]&2147483648)>>16&65535;let n=pc[1]&2146435072,u=0;return n>=1089470464?pc[0]>0?n=31744:(n=(n&2080374784)>>16,u=(pc[1]&1048575)>>10):n<=1056964608?(u=1048576+(pc[1]&1048575),u=1048576+(u<<(n>>20)-998)>>21,n=0):(n=n-1056964608>>10,u=(pc[1]&1048575)+512>>10),t|n|u&65535}class qe extends fi{}function We(s){return(t,n,u)=>{if(t.setValid(n,u!=null))return s(t,n,u)}}const Tk=(s,t,n)=>{s[t]=Math.floor(n/864e5)},_b=(s,t,n,u)=>{if(n+1<t.length){const _=er(t[n]),v=er(t[n+1]);s.set(u.subarray(0,v-_),_)}},kk=({offset:s,values:t},n,u)=>{const _=s+n;u?t[_>>3]|=1<<_%8:t[_>>3]&=~(1<<_%8)},na=({values:s},t,n)=>{s[t]=n},Dg=({values:s},t,n)=>{s[t]=n},vb=({values:s},t,n)=>{s[t]=Ik(n)},Ak=(s,t,n)=>{switch(s.type.precision){case Ln.HALF:return vb(s,t,n);case Ln.SINGLE:case Ln.DOUBLE:return Dg(s,t,n)}},bb=({values:s},t,n)=>{Tk(s,t,n.valueOf())},xb=({values:s},t,n)=>{s[t]=BigInt(n)},Ek=({stride:s,values:t},n,u)=>{t.set(u.subarray(0,s),s*n)},wb=({values:s,valueOffsets:t},n,u)=>_b(s,t,n,u),Sb=({values:s,valueOffsets:t},n,u)=>_b(s,t,n,Ag(u)),Ck=(s,t,n)=>{s.type.unit===Bs.DAY?bb(s,t,n):xb(s,t,n)},Ib=({values:s},t,n)=>{s[t]=BigInt(n/1e3)},Tb=({values:s},t,n)=>{s[t]=BigInt(n)},kb=({values:s},t,n)=>{s[t]=BigInt(n*1e3)},Ab=({values:s},t,n)=>{s[t]=BigInt(n*1e6)},Mk=(s,t,n)=>{switch(s.type.unit){case $e.SECOND:return Ib(s,t,n);case $e.MILLISECOND:return Tb(s,t,n);case $e.MICROSECOND:return kb(s,t,n);case $e.NANOSECOND:return Ab(s,t,n)}},Eb=({values:s},t,n)=>{s[t]=n},Cb=({values:s},t,n)=>{s[t]=n},Mb=({values:s},t,n)=>{s[t]=n},Db=({values:s},t,n)=>{s[t]=n},Dk=(s,t,n)=>{switch(s.type.unit){case $e.SECOND:return Eb(s,t,n);case $e.MILLISECOND:return Cb(s,t,n);case $e.MICROSECOND:return Mb(s,t,n);case $e.NANOSECOND:return Db(s,t,n)}},Pk=({values:s,stride:t},n,u)=>{s.set(u.subarray(0,t),t*n)},Lk=(s,t,n)=>{const u=s.children[0],_=s.valueOffsets,v=Rs.getVisitFn(u);if(Array.isArray(n))for(let I=-1,l=_[t],P=_[t+1];l<P;)v(u,l++,n[++I]);else for(let I=-1,l=_[t],P=_[t+1];l<P;)v(u,l++,n.get(++I))},zk=(s,t,n)=>{const u=s.children[0],{valueOffsets:_}=s,v=Rs.getVisitFn(u);let{[t]:I,[t+1]:l}=_;const P=n instanceof Map?n.entries():Object.entries(n);for(const E of P)if(v(u,I,E),++I>=l)break},Bk=(s,t)=>(n,u,_,v)=>u&&n(u,s,t[v]),Rk=(s,t)=>(n,u,_,v)=>u&&n(u,s,t.get(v)),Fk=(s,t)=>(n,u,_,v)=>u&&n(u,s,t.get(_.name)),Ok=(s,t)=>(n,u,_,v)=>u&&n(u,s,t[_.name]),Nk=(s,t,n)=>{const u=s.type.children.map(v=>Rs.getVisitFn(v.type)),_=n instanceof Map?Fk(t,n):n instanceof Ni?Rk(t,n):Array.isArray(n)?Bk(t,n):Ok(t,n);s.type.children.forEach((v,I)=>_(u[I],s.children[I],v,I))},Uk=(s,t,n)=>{s.type.mode===zn.Dense?Pb(s,t,n):Lb(s,t,n)},Pb=(s,t,n)=>{const u=s.type.typeIdToChildIndex[s.typeIds[t]],_=s.children[u];Rs.visit(_,s.valueOffsets[t],n)},Lb=(s,t,n)=>{const u=s.type.typeIdToChildIndex[s.typeIds[t]],_=s.children[u];Rs.visit(_,t,n)},Vk=(s,t,n)=>{var u;(u=s.dictionary)===null||u===void 0||u.set(s.values[t],n)},$k=(s,t,n)=>{s.type.unit===Ao.DAY_TIME?zb(s,t,n):Bb(s,t,n)},zb=({values:s},t,n)=>{s.set(n.subarray(0,2),2*t)},Bb=({values:s},t,n)=>{s[t]=n[0]*12+n[1]%12},Rb=({values:s},t,n)=>{s[t]=n},Fb=({values:s},t,n)=>{s[t]=n},Ob=({values:s},t,n)=>{s[t]=n},Nb=({values:s},t,n)=>{s[t]=n},jk=(s,t,n)=>{switch(s.type.unit){case $e.SECOND:return Rb(s,t,n);case $e.MILLISECOND:return Fb(s,t,n);case $e.MICROSECOND:return Ob(s,t,n);case $e.NANOSECOND:return Nb(s,t,n)}},qk=(s,t,n)=>{const{stride:u}=s,_=s.children[0],v=Rs.getVisitFn(_);if(Array.isArray(n))for(let I=-1,l=t*u;++I<u;)v(_,l+I,n[I]);else for(let I=-1,l=t*u;++I<u;)v(_,l+I,n.get(I))};qe.prototype.visitBool=We(kk);qe.prototype.visitInt=We(na);qe.prototype.visitInt8=We(na);qe.prototype.visitInt16=We(na);qe.prototype.visitInt32=We(na);qe.prototype.visitInt64=We(na);qe.prototype.visitUint8=We(na);qe.prototype.visitUint16=We(na);qe.prototype.visitUint32=We(na);qe.prototype.visitUint64=We(na);qe.prototype.visitFloat=We(Ak);qe.prototype.visitFloat16=We(vb);qe.prototype.visitFloat32=We(Dg);qe.prototype.visitFloat64=We(Dg);qe.prototype.visitUtf8=We(Sb);qe.prototype.visitLargeUtf8=We(Sb);qe.prototype.visitBinary=We(wb);qe.prototype.visitLargeBinary=We(wb);qe.prototype.visitFixedSizeBinary=We(Ek);qe.prototype.visitDate=We(Ck);qe.prototype.visitDateDay=We(bb);qe.prototype.visitDateMillisecond=We(xb);qe.prototype.visitTimestamp=We(Mk);qe.prototype.visitTimestampSecond=We(Ib);qe.prototype.visitTimestampMillisecond=We(Tb);qe.prototype.visitTimestampMicrosecond=We(kb);qe.prototype.visitTimestampNanosecond=We(Ab);qe.prototype.visitTime=We(Dk);qe.prototype.visitTimeSecond=We(Eb);qe.prototype.visitTimeMillisecond=We(Cb);qe.prototype.visitTimeMicrosecond=We(Mb);qe.prototype.visitTimeNanosecond=We(Db);qe.prototype.visitDecimal=We(Pk);qe.prototype.visitList=We(Lk);qe.prototype.visitStruct=We(Nk);qe.prototype.visitUnion=We(Uk);qe.prototype.visitDenseUnion=We(Pb);qe.prototype.visitSparseUnion=We(Lb);qe.prototype.visitDictionary=We(Vk);qe.prototype.visitInterval=We($k);qe.prototype.visitIntervalDayTime=We(zb);qe.prototype.visitIntervalYearMonth=We(Bb);qe.prototype.visitDuration=We(jk);qe.prototype.visitDurationSecond=We(Rb);qe.prototype.visitDurationMillisecond=We(Fb);qe.prototype.visitDurationMicrosecond=We(Ob);qe.prototype.visitDurationNanosecond=We(Nb);qe.prototype.visitFixedSizeList=We(qk);qe.prototype.visitMap=We(zk);const Rs=new qe,Ks=Symbol.for("parent"),zc=Symbol.for("rowIndex");class Pg{constructor(t,n){return this[Ks]=t,this[zc]=n,new Proxy(this,new Zk)}toArray(){return Object.values(this.toJSON())}toJSON(){const t=this[zc],n=this[Ks],u=n.type.children,_={};for(let v=-1,I=u.length;++v<I;)_[u[v].name]=cs.visit(n.children[v],t);return _}toString(){return`{${[...this].map(([t,n])=>`${vh(t)}: ${vh(n)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}[Symbol.iterator](){return new Gk(this[Ks],this[zc])}}class Gk{constructor(t,n){this.childIndex=0,this.children=t.children,this.rowIndex=n,this.childFields=t.type.children,this.numChildren=this.childFields.length}[Symbol.iterator](){return this}next(){const t=this.childIndex;return t<this.numChildren?(this.childIndex=t+1,{done:!1,value:[this.childFields[t].name,cs.visit(this.children[t],this.rowIndex)]}):{done:!0,value:null}}}Object.defineProperties(Pg.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[Ks]:{writable:!0,enumerable:!1,configurable:!1,value:null},[zc]:{writable:!0,enumerable:!1,configurable:!1,value:-1}});class Zk{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(t){return t[Ks].type.children.map(n=>n.name)}has(t,n){return t[Ks].type.children.findIndex(u=>u.name===n)!==-1}getOwnPropertyDescriptor(t,n){if(t[Ks].type.children.findIndex(u=>u.name===n)!==-1)return{writable:!0,enumerable:!0,configurable:!0}}get(t,n){if(Reflect.has(t,n))return t[n];const u=t[Ks].type.children.findIndex(_=>_.name===n);if(u!==-1){const _=cs.visit(t[Ks].children[u],t[zc]);return Reflect.set(t,n,_),_}}set(t,n,u){const _=t[Ks].type.children.findIndex(v=>v.name===n);return _!==-1?(Rs.visit(t[Ks].children[_],t[zc],u),Reflect.set(t,n,u)):Reflect.has(t,n)||typeof n=="symbol"?Reflect.set(t,n,u):!1}}class Oe extends fi{}function Ge(s){return(t,n)=>t.getValid(n)?s(t,n):null}const Wk=(s,t)=>864e5*s[t],Hk=(s,t)=>null,Ub=(s,t,n)=>{if(n+1>=t.length)return null;const u=er(t[n]),_=er(t[n+1]);return s.subarray(u,_)},Yk=({offset:s,values:t},n)=>{const u=s+n;return(t[u>>3]&1<<u%8)!==0},Vb=({values:s},t)=>Wk(s,t),$b=({values:s},t)=>er(s[t]),Ga=({stride:s,values:t},n)=>t[s*n],Kk=({stride:s,values:t},n)=>yb(t[s*n]),jb=({values:s},t)=>s[t],Xk=({stride:s,values:t},n)=>t.subarray(s*n,s*(n+1)),qb=({values:s,valueOffsets:t},n)=>Ub(s,t,n),Gb=({values:s,valueOffsets:t},n)=>{const u=Ub(s,t,n);return u!==null?Ym(u):null},Jk=({values:s},t)=>s[t],Qk=({type:s,values:t},n)=>s.precision!==Ln.HALF?t[n]:yb(t[n]),tA=(s,t)=>s.type.unit===Bs.DAY?Vb(s,t):$b(s,t),Zb=({values:s},t)=>1e3*er(s[t]),Wb=({values:s},t)=>er(s[t]),Hb=({values:s},t)=>Zv(s[t],BigInt(1e3)),Yb=({values:s},t)=>Zv(s[t],BigInt(1e6)),eA=(s,t)=>{switch(s.type.unit){case $e.SECOND:return Zb(s,t);case $e.MILLISECOND:return Wb(s,t);case $e.MICROSECOND:return Hb(s,t);case $e.NANOSECOND:return Yb(s,t)}},Kb=({values:s},t)=>s[t],Xb=({values:s},t)=>s[t],Jb=({values:s},t)=>s[t],Qb=({values:s},t)=>s[t],iA=(s,t)=>{switch(s.type.unit){case $e.SECOND:return Kb(s,t);case $e.MILLISECOND:return Xb(s,t);case $e.MICROSECOND:return Jb(s,t);case $e.NANOSECOND:return Qb(s,t)}},rA=({values:s,stride:t},n)=>Mg.decimal(s.subarray(t*n,t*(n+1))),nA=(s,t)=>{const{valueOffsets:n,stride:u,children:_}=s,{[t*u]:v,[t*u+1]:I}=n,P=_[0].slice(v,I-v);return new Ni([P])},sA=(s,t)=>{const{valueOffsets:n,children:u}=s,{[t]:_,[t+1]:v}=n,I=u[0];return new Lg(I.slice(_,v-_))},oA=(s,t)=>new Pg(s,t),aA=(s,t)=>s.type.mode===zn.Dense?tx(s,t):ex(s,t),tx=(s,t)=>{const n=s.type.typeIdToChildIndex[s.typeIds[t]],u=s.children[n];return cs.visit(u,s.valueOffsets[t])},ex=(s,t)=>{const n=s.type.typeIdToChildIndex[s.typeIds[t]],u=s.children[n];return cs.visit(u,t)},lA=(s,t)=>{var n;return(n=s.dictionary)===null||n===void 0?void 0:n.get(s.values[t])},cA=(s,t)=>s.type.unit===Ao.DAY_TIME?ix(s,t):rx(s,t),ix=({values:s},t)=>s.subarray(2*t,2*(t+1)),rx=({values:s},t)=>{const n=s[t],u=new Int32Array(2);return u[0]=Math.trunc(n/12),u[1]=Math.trunc(n%12),u},nx=({values:s},t)=>s[t],sx=({values:s},t)=>s[t],ox=({values:s},t)=>s[t],ax=({values:s},t)=>s[t],uA=(s,t)=>{switch(s.type.unit){case $e.SECOND:return nx(s,t);case $e.MILLISECOND:return sx(s,t);case $e.MICROSECOND:return ox(s,t);case $e.NANOSECOND:return ax(s,t)}},hA=(s,t)=>{const{stride:n,children:u}=s,v=u[0].slice(t*n,n);return new Ni([v])};Oe.prototype.visitNull=Ge(Hk);Oe.prototype.visitBool=Ge(Yk);Oe.prototype.visitInt=Ge(Jk);Oe.prototype.visitInt8=Ge(Ga);Oe.prototype.visitInt16=Ge(Ga);Oe.prototype.visitInt32=Ge(Ga);Oe.prototype.visitInt64=Ge(jb);Oe.prototype.visitUint8=Ge(Ga);Oe.prototype.visitUint16=Ge(Ga);Oe.prototype.visitUint32=Ge(Ga);Oe.prototype.visitUint64=Ge(jb);Oe.prototype.visitFloat=Ge(Qk);Oe.prototype.visitFloat16=Ge(Kk);Oe.prototype.visitFloat32=Ge(Ga);Oe.prototype.visitFloat64=Ge(Ga);Oe.prototype.visitUtf8=Ge(Gb);Oe.prototype.visitLargeUtf8=Ge(Gb);Oe.prototype.visitBinary=Ge(qb);Oe.prototype.visitLargeBinary=Ge(qb);Oe.prototype.visitFixedSizeBinary=Ge(Xk);Oe.prototype.visitDate=Ge(tA);Oe.prototype.visitDateDay=Ge(Vb);Oe.prototype.visitDateMillisecond=Ge($b);Oe.prototype.visitTimestamp=Ge(eA);Oe.prototype.visitTimestampSecond=Ge(Zb);Oe.prototype.visitTimestampMillisecond=Ge(Wb);Oe.prototype.visitTimestampMicrosecond=Ge(Hb);Oe.prototype.visitTimestampNanosecond=Ge(Yb);Oe.prototype.visitTime=Ge(iA);Oe.prototype.visitTimeSecond=Ge(Kb);Oe.prototype.visitTimeMillisecond=Ge(Xb);Oe.prototype.visitTimeMicrosecond=Ge(Jb);Oe.prototype.visitTimeNanosecond=Ge(Qb);Oe.prototype.visitDecimal=Ge(rA);Oe.prototype.visitList=Ge(nA);Oe.prototype.visitStruct=Ge(oA);Oe.prototype.visitUnion=Ge(aA);Oe.prototype.visitDenseUnion=Ge(tx);Oe.prototype.visitSparseUnion=Ge(ex);Oe.prototype.visitDictionary=Ge(lA);Oe.prototype.visitInterval=Ge(cA);Oe.prototype.visitIntervalDayTime=Ge(ix);Oe.prototype.visitIntervalYearMonth=Ge(rx);Oe.prototype.visitDuration=Ge(uA);Oe.prototype.visitDurationSecond=Ge(nx);Oe.prototype.visitDurationMillisecond=Ge(sx);Oe.prototype.visitDurationMicrosecond=Ge(ox);Oe.prototype.visitDurationNanosecond=Ge(ax);Oe.prototype.visitFixedSizeList=Ge(hA);Oe.prototype.visitMap=Ge(sA);const cs=new Oe,Sc=Symbol.for("keys"),Bc=Symbol.for("vals"),Ic=Symbol.for("kKeysAsStrings"),eg=Symbol.for("_kKeysAsStrings");class Lg{constructor(t){return this[Sc]=new Ni([t.children[0]]).memoize(),this[Bc]=t.children[1],new Proxy(this,new pA)}get[Ic](){return this[eg]||(this[eg]=Array.from(this[Sc].toArray(),String))}[Symbol.iterator](){return new dA(this[Sc],this[Bc])}get size(){return this[Sc].length}toArray(){return Object.values(this.toJSON())}toJSON(){const t=this[Sc],n=this[Bc],u={};for(let _=-1,v=t.length;++_<v;)u[t.get(_)]=cs.visit(n,_);return u}toString(){return`{${[...this].map(([t,n])=>`${vh(t)}: ${vh(n)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}}class dA{constructor(t,n){this.keys=t,this.vals=n,this.keyIndex=0,this.numKeys=t.length}[Symbol.iterator](){return this}next(){const t=this.keyIndex;return t===this.numKeys?{done:!0,value:null}:(this.keyIndex++,{done:!1,value:[this.keys.get(t),cs.visit(this.vals,t)]})}}class pA{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(t){return t[Ic]}has(t,n){return t[Ic].includes(n)}getOwnPropertyDescriptor(t,n){if(t[Ic].indexOf(n)!==-1)return{writable:!0,enumerable:!0,configurable:!0}}get(t,n){if(Reflect.has(t,n))return t[n];const u=t[Ic].indexOf(n);if(u!==-1){const _=cs.visit(Reflect.get(t,Bc),u);return Reflect.set(t,n,_),_}}set(t,n,u){const _=t[Ic].indexOf(n);return _!==-1?(Rs.visit(Reflect.get(t,Bc),_,u),Reflect.set(t,n,u)):Reflect.has(t,n)?Reflect.set(t,n,u):!1}}Object.defineProperties(Lg.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[Sc]:{writable:!0,enumerable:!1,configurable:!1,value:null},[Bc]:{writable:!0,enumerable:!1,configurable:!1,value:null},[eg]:{writable:!0,enumerable:!1,configurable:!1,value:null}});let v0;function lx(s,t,n,u){const{length:_=0}=s;let v=typeof t!="number"?0:t,I=typeof n!="number"?_:n;return v<0&&(v=(v%_+_)%_),I<0&&(I=(I%_+_)%_),I<v&&(v0=v,v=I,I=v0),I>_&&(I=_),u?u(s,v,I):[v,I]}const zg=(s,t)=>s<0?t+s:s,b0=s=>s!==s;function Hc(s){if(typeof s!=="object"||s===null)return b0(s)?b0:n=>n===s;if(s instanceof Date){const n=s.valueOf();return u=>u instanceof Date?u.valueOf()===n:!1}return ArrayBuffer.isView(s)?n=>n?hk(s,n):!1:s instanceof Map?mA(s):Array.isArray(s)?fA(s):s instanceof Ni?gA(s):yA(s,!0)}function fA(s){const t=[];for(let n=-1,u=s.length;++n<u;)t[n]=Hc(s[n]);return cf(t)}function mA(s){let t=-1;const n=[];for(const u of s.values())n[++t]=Hc(u);return cf(n)}function gA(s){const t=[];for(let n=-1,u=s.length;++n<u;)t[n]=Hc(s.get(n));return cf(t)}function yA(s,t=!1){const n=Object.keys(s);if(!t&&n.length===0)return()=>!1;const u=[];for(let _=-1,v=n.length;++_<v;)u[_]=Hc(s[n[_]]);return cf(u,n)}function cf(s,t){return n=>{if(!n||typeof n!="object")return!1;switch(n.constructor){case Array:return _A(s,n);case Map:return x0(s,n,n.keys());case Lg:case Pg:case Object:case void 0:return x0(s,n,t||Object.keys(n))}return n instanceof Ni?vA(s,n):!1}}function _A(s,t){const n=s.length;if(t.length!==n)return!1;for(let u=-1;++u<n;)if(!s[u](t[u]))return!1;return!0}function vA(s,t){const n=s.length;if(t.length!==n)return!1;for(let u=-1;++u<n;)if(!s[u](t.get(u)))return!1;return!0}function x0(s,t,n){const u=n[Symbol.iterator](),_=t instanceof Map?t.keys():Object.keys(t)[Symbol.iterator](),v=t instanceof Map?t.values():Object.values(t)[Symbol.iterator]();let I=0;const l=s.length;let P=v.next(),E=u.next(),U=_.next();for(;I<l&&!E.done&&!U.done&&!P.done&&!(E.value!==U.value||!s[I](P.value));++I,E=u.next(),U=_.next(),P=v.next());return I===l&&E.done&&U.done&&P.done?!0:(u.return&&u.return(),_.return&&_.return(),v.return&&v.return(),!1)}function cx(s,t,n,u){return(n&1<<u)!==0}function bA(s,t,n,u){return(n&1<<u)>>u}function $p(s,t,n){const u=n.byteLength+7&-8;if(s>0||n.byteLength<u){const _=new Uint8Array(u);return _.set(s%8===0?n.subarray(s>>3):jp(new Bg(n,s,t,null,cx)).subarray(0,u)),_}return n}function jp(s){const t=[];let n=0,u=0,_=0;for(const I of s)I&&(_|=1<<u),++u===8&&(t[n++]=_,_=u=0);(n===0||u>0)&&(t[n++]=_);const v=new Uint8Array(t.length+7&-8);return v.set(t),v}class Bg{constructor(t,n,u,_,v){this.bytes=t,this.length=u,this.context=_,this.get=v,this.bit=n%8,this.byteIndex=n>>3,this.byte=t[this.byteIndex++],this.index=0}next(){return this.index<this.length?(this.bit===8&&(this.bit=0,this.byte=this.bytes[this.byteIndex++]),{value:this.get(this.context,this.index++,this.byte,this.bit++)}):{done:!0,value:null}}[Symbol.iterator](){return this}}function ig(s,t,n){if(n-t<=0)return 0;if(n-t<8){let v=0;for(const I of new Bg(s,t,n-t,s,bA))v+=I;return v}const u=n>>3<<3,_=t+(t%8===0?0:8-t%8);return ig(s,t,_)+ig(s,u,n)+xA(s,_>>3,u-_>>3)}function xA(s,t,n){let u=0,_=Math.trunc(t);const v=new DataView(s.buffer,s.byteOffset,s.byteLength),I=n===void 0?s.byteLength:_+n;for(;I-_>=4;)u+=Am(v.getUint32(_)),_+=4;for(;I-_>=2;)u+=Am(v.getUint16(_)),_+=2;for(;I-_>=1;)u+=Am(v.getUint8(_)),_+=1;return u}function Am(s){let t=Math.trunc(s);return t=t-(t>>>1&1431655765),t=(t&858993459)+(t>>>2&858993459),(t+(t>>>4)&252645135)*16843009>>>24}const wA=-1;class qi{get typeId(){return this.type.typeId}get ArrayType(){return this.type.ArrayType}get buffers(){return[this.valueOffsets,this.values,this.nullBitmap,this.typeIds]}get nullable(){if(this._nullCount!==0){const{type:t}=this;return Me.isSparseUnion(t)?this.children.some(n=>n.nullable):Me.isDenseUnion(t)?this.children.some(n=>n.nullable):this.nullBitmap&&this.nullBitmap.byteLength>0}return!0}get byteLength(){let t=0;const{valueOffsets:n,values:u,nullBitmap:_,typeIds:v}=this;return n&&(t+=n.byteLength),u&&(t+=u.byteLength),_&&(t+=_.byteLength),v&&(t+=v.byteLength),this.children.reduce((I,l)=>I+l.byteLength,t)}get nullCount(){if(Me.isUnion(this.type))return this.children.reduce((u,_)=>u+_.nullCount,0);let t=this._nullCount,n;return t<=wA&&(n=this.nullBitmap)&&(this._nullCount=t=n.length===0?0:this.length-ig(n,this.offset,this.offset+this.length)),t}constructor(t,n,u,_,v,I=[],l){this.type=t,this.children=I,this.dictionary=l,this.offset=Math.floor(Math.max(n||0,0)),this.length=Math.floor(Math.max(u||0,0)),this._nullCount=Math.floor(Math.max(_||0,-1));let P;v instanceof qi?(this.stride=v.stride,this.values=v.values,this.typeIds=v.typeIds,this.nullBitmap=v.nullBitmap,this.valueOffsets=v.valueOffsets):(this.stride=Qo(t),v&&((P=v[0])&&(this.valueOffsets=P),(P=v[1])&&(this.values=P),(P=v[2])&&(this.nullBitmap=P),(P=v[3])&&(this.typeIds=P)))}getValid(t){const{type:n}=this;if(Me.isUnion(n)){const u=n,_=this.children[u.typeIdToChildIndex[this.typeIds[t]]],v=u.mode===zn.Dense?this.valueOffsets[t]:t;return _.getValid(v)}if(this.nullable&&this.nullCount>0){const u=this.offset+t;return(this.nullBitmap[u>>3]&1<<u%8)!==0}return!0}setValid(t,n){let u;const{type:_}=this;if(Me.isUnion(_)){const v=_,I=this.children[v.typeIdToChildIndex[this.typeIds[t]]],l=v.mode===zn.Dense?this.valueOffsets[t]:t;u=I.getValid(l),I.setValid(l,n)}else{let{nullBitmap:v}=this;const{offset:I,length:l}=this,P=I+t,E=1<<P%8,U=P>>3;(!v||v.byteLength<=U)&&(v=new Uint8Array((I+l+63&-64)>>3).fill(255),this.nullCount>0?(v.set($p(I,l,this.nullBitmap),0),Object.assign(this,{nullBitmap:v})):Object.assign(this,{nullBitmap:v,_nullCount:0}));const j=v[U];u=(j&E)!==0,v[U]=n?j|E:j&~E}return u!==!!n&&(this._nullCount=this.nullCount+(n?-1:1)),n}clone(t=this.type,n=this.offset,u=this.length,_=this._nullCount,v=this,I=this.children){return new qi(t,n,u,_,v,I,this.dictionary)}slice(t,n){const{stride:u,typeId:_,children:v}=this,I=+(this._nullCount===0)-1,l=_===16?u:1,P=this._sliceBuffers(t,n,u,_);return this.clone(this.type,this.offset+t,n,I,P,v.length===0||this.valueOffsets?v:this._sliceChildren(v,l*t,l*n))}_changeLengthAndBackfillNullBitmap(t){if(this.typeId===st.Null)return this.clone(this.type,0,t,0);const{length:n,nullCount:u}=this,_=new Uint8Array((t+63&-64)>>3).fill(255,0,n>>3);_[n>>3]=(1<<n-(n&-8))-1,u>0&&_.set($p(this.offset,n,this.nullBitmap),0);const v=this.buffers;return v[Jo.VALIDITY]=_,this.clone(this.type,0,t,u+(t-n),v)}_sliceBuffers(t,n,u,_){let v;const{buffers:I}=this;return(v=I[Jo.TYPE])&&(I[Jo.TYPE]=v.subarray(t,t+n)),(v=I[Jo.OFFSET])&&(I[Jo.OFFSET]=v.subarray(t,t+n+1))||(v=I[Jo.DATA])&&(I[Jo.DATA]=_===6?v:v.subarray(u*t,u*(t+n))),I}_sliceChildren(t,n,u){return t.map(_=>_.slice(n,u))}}qi.prototype.children=Object.freeze([]);class mh extends fi{visit(t){return this.getVisitFn(t.type).call(this,t)}visitNull(t){const{["type"]:n,["offset"]:u=0,["length"]:_=0}=t;return new qi(n,u,_,_)}visitBool(t){const{["type"]:n,["offset"]:u=0}=t,_=Ti(t.nullBitmap),v=Zi(n.ArrayType,t.data),{["length"]:I=v.length>>3,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new qi(n,u,I,l,[void 0,v,_])}visitInt(t){const{["type"]:n,["offset"]:u=0}=t,_=Ti(t.nullBitmap),v=Zi(n.ArrayType,t.data),{["length"]:I=v.length,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new qi(n,u,I,l,[void 0,v,_])}visitFloat(t){const{["type"]:n,["offset"]:u=0}=t,_=Ti(t.nullBitmap),v=Zi(n.ArrayType,t.data),{["length"]:I=v.length,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new qi(n,u,I,l,[void 0,v,_])}visitUtf8(t){const{["type"]:n,["offset"]:u=0}=t,_=Ti(t.data),v=Ti(t.nullBitmap),I=nh(t.valueOffsets),{["length"]:l=I.length-1,["nullCount"]:P=t.nullBitmap?-1:0}=t;return new qi(n,u,l,P,[I,_,v])}visitLargeUtf8(t){const{["type"]:n,["offset"]:u=0}=t,_=Ti(t.data),v=Ti(t.nullBitmap),I=l0(t.valueOffsets),{["length"]:l=I.length-1,["nullCount"]:P=t.nullBitmap?-1:0}=t;return new qi(n,u,l,P,[I,_,v])}visitBinary(t){const{["type"]:n,["offset"]:u=0}=t,_=Ti(t.data),v=Ti(t.nullBitmap),I=nh(t.valueOffsets),{["length"]:l=I.length-1,["nullCount"]:P=t.nullBitmap?-1:0}=t;return new qi(n,u,l,P,[I,_,v])}visitLargeBinary(t){const{["type"]:n,["offset"]:u=0}=t,_=Ti(t.data),v=Ti(t.nullBitmap),I=l0(t.valueOffsets),{["length"]:l=I.length-1,["nullCount"]:P=t.nullBitmap?-1:0}=t;return new qi(n,u,l,P,[I,_,v])}visitFixedSizeBinary(t){const{["type"]:n,["offset"]:u=0}=t,_=Ti(t.nullBitmap),v=Zi(n.ArrayType,t.data),{["length"]:I=v.length/Qo(n),["nullCount"]:l=t.nullBitmap?-1:0}=t;return new qi(n,u,I,l,[void 0,v,_])}visitDate(t){const{["type"]:n,["offset"]:u=0}=t,_=Ti(t.nullBitmap),v=Zi(n.ArrayType,t.data),{["length"]:I=v.length/Qo(n),["nullCount"]:l=t.nullBitmap?-1:0}=t;return new qi(n,u,I,l,[void 0,v,_])}visitTimestamp(t){const{["type"]:n,["offset"]:u=0}=t,_=Ti(t.nullBitmap),v=Zi(n.ArrayType,t.data),{["length"]:I=v.length/Qo(n),["nullCount"]:l=t.nullBitmap?-1:0}=t;return new qi(n,u,I,l,[void 0,v,_])}visitTime(t){const{["type"]:n,["offset"]:u=0}=t,_=Ti(t.nullBitmap),v=Zi(n.ArrayType,t.data),{["length"]:I=v.length/Qo(n),["nullCount"]:l=t.nullBitmap?-1:0}=t;return new qi(n,u,I,l,[void 0,v,_])}visitDecimal(t){const{["type"]:n,["offset"]:u=0}=t,_=Ti(t.nullBitmap),v=Zi(n.ArrayType,t.data),{["length"]:I=v.length/Qo(n),["nullCount"]:l=t.nullBitmap?-1:0}=t;return new qi(n,u,I,l,[void 0,v,_])}visitList(t){const{["type"]:n,["offset"]:u=0,["child"]:_}=t,v=Ti(t.nullBitmap),I=nh(t.valueOffsets),{["length"]:l=I.length-1,["nullCount"]:P=t.nullBitmap?-1:0}=t;return new qi(n,u,l,P,[I,void 0,v],[_])}visitStruct(t){const{["type"]:n,["offset"]:u=0,["children"]:_=[]}=t,v=Ti(t.nullBitmap),{length:I=_.reduce((P,{length:E})=>Math.max(P,E),0),nullCount:l=t.nullBitmap?-1:0}=t;return new qi(n,u,I,l,[void 0,void 0,v],_)}visitUnion(t){const{["type"]:n,["offset"]:u=0,["children"]:_=[]}=t,v=Zi(n.ArrayType,t.typeIds),{["length"]:I=v.length,["nullCount"]:l=-1}=t;if(Me.isSparseUnion(n))return new qi(n,u,I,l,[void 0,void 0,void 0,v],_);const P=nh(t.valueOffsets);return new qi(n,u,I,l,[P,void 0,void 0,v],_)}visitDictionary(t){const{["type"]:n,["offset"]:u=0}=t,_=Ti(t.nullBitmap),v=Zi(n.indices.ArrayType,t.data),{["dictionary"]:I=new Ni([new mh().visit({type:n.dictionary})])}=t,{["length"]:l=v.length,["nullCount"]:P=t.nullBitmap?-1:0}=t;return new qi(n,u,l,P,[void 0,v,_],[],I)}visitInterval(t){const{["type"]:n,["offset"]:u=0}=t,_=Ti(t.nullBitmap),v=Zi(n.ArrayType,t.data),{["length"]:I=v.length/Qo(n),["nullCount"]:l=t.nullBitmap?-1:0}=t;return new qi(n,u,I,l,[void 0,v,_])}visitDuration(t){const{["type"]:n,["offset"]:u=0}=t,_=Ti(t.nullBitmap),v=Zi(n.ArrayType,t.data),{["length"]:I=v.length,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new qi(n,u,I,l,[void 0,v,_])}visitFixedSizeList(t){const{["type"]:n,["offset"]:u=0,["child"]:_=new mh().visit({type:n.valueType})}=t,v=Ti(t.nullBitmap),{["length"]:I=_.length/Qo(n),["nullCount"]:l=t.nullBitmap?-1:0}=t;return new qi(n,u,I,l,[void 0,void 0,v],[_])}visitMap(t){const{["type"]:n,["offset"]:u=0,["child"]:_=new mh().visit({type:n.childType})}=t,v=Ti(t.nullBitmap),I=nh(t.valueOffsets),{["length"]:l=I.length-1,["nullCount"]:P=t.nullBitmap?-1:0}=t;return new qi(n,u,l,P,[I,void 0,v],[_])}}const SA=new mh;function _i(s){return SA.visit(s)}class w0{constructor(t=0,n){this.numChunks=t,this.getChunkIterator=n,this.chunkIndex=0,this.chunkIterator=this.getChunkIterator(0)}next(){for(;this.chunkIndex<this.numChunks;){const t=this.chunkIterator.next();if(!t.done)return t;++this.chunkIndex<this.numChunks&&(this.chunkIterator=this.getChunkIterator(this.chunkIndex))}return{done:!0,value:null}}[Symbol.iterator](){return this}}function IA(s){return s.some(t=>t.nullable)}function ux(s){return s.reduce((t,n)=>t+n.nullCount,0)}function hx(s){return s.reduce((t,n,u)=>(t[u+1]=t[u]+n.length,t),new Uint32Array(s.length+1))}function dx(s,t,n,u){const _=[];for(let v=-1,I=s.length;++v<I;){const l=s[v],P=t[v],{length:E}=l;if(P>=u)break;if(n>=P+E)continue;if(P>=n&&P+E<=u){_.push(l);continue}const U=Math.max(0,n-P),j=Math.min(u-P,E);_.push(l.slice(U,j-U))}return _.length===0&&_.push(s[0].slice(0,0)),_}function Rg(s,t,n,u){let _=0,v=0,I=t.length-1;do{if(_>=I-1)return n<t[I]?u(s,_,n-t[_]):null;v=_+Math.trunc((I-_)*.5),n<t[v]?I=v:_=v}while(_<I)}function Fg(s,t){return s.getValid(t)}function qp(s){function t(n,u,_){return s(n[u],_)}return function(n){const u=this.data;return Rg(u,this._offsets,n,t)}}function px(s){let t;function n(u,_,v){return s(u[_],v,t)}return function(u,_){const v=this.data;t=_;const I=Rg(v,this._offsets,u,n);return t=void 0,I}}function fx(s){let t;function n(u,_,v){let I=v,l=0,P=0;for(let E=_-1,U=u.length;++E<U;){const j=u[E];if(~(l=s(j,t,I)))return P+l;I=0,P+=j.length}return-1}return function(u,_){t=u;const v=this.data,I=typeof _!="number"?n(v,0,0):Rg(v,this._offsets,_,n);return t=void 0,I}}class Ne extends fi{}function TA(s,t){return t===null&&s.length>0?0:-1}function kA(s,t){const{nullBitmap:n}=s;if(!n||s.nullCount<=0)return-1;let u=0;for(const _ of new Bg(n,s.offset+(t||0),s.length,n,cx)){if(!_)return u;++u}return-1}function Ke(s,t,n){if(t===void 0)return-1;if(t===null)switch(s.typeId){case st.Union:break;case st.Dictionary:break;default:return kA(s,n)}const u=cs.getVisitFn(s),_=Hc(t);for(let v=(n||0)-1,I=s.length;++v<I;)if(_(u(s,v)))return v;return-1}function mx(s,t,n){const u=cs.getVisitFn(s),_=Hc(t);for(let v=(n||0)-1,I=s.length;++v<I;)if(_(u(s,v)))return v;return-1}Ne.prototype.visitNull=TA;Ne.prototype.visitBool=Ke;Ne.prototype.visitInt=Ke;Ne.prototype.visitInt8=Ke;Ne.prototype.visitInt16=Ke;Ne.prototype.visitInt32=Ke;Ne.prototype.visitInt64=Ke;Ne.prototype.visitUint8=Ke;Ne.prototype.visitUint16=Ke;Ne.prototype.visitUint32=Ke;Ne.prototype.visitUint64=Ke;Ne.prototype.visitFloat=Ke;Ne.prototype.visitFloat16=Ke;Ne.prototype.visitFloat32=Ke;Ne.prototype.visitFloat64=Ke;Ne.prototype.visitUtf8=Ke;Ne.prototype.visitLargeUtf8=Ke;Ne.prototype.visitBinary=Ke;Ne.prototype.visitLargeBinary=Ke;Ne.prototype.visitFixedSizeBinary=Ke;Ne.prototype.visitDate=Ke;Ne.prototype.visitDateDay=Ke;Ne.prototype.visitDateMillisecond=Ke;Ne.prototype.visitTimestamp=Ke;Ne.prototype.visitTimestampSecond=Ke;Ne.prototype.visitTimestampMillisecond=Ke;Ne.prototype.visitTimestampMicrosecond=Ke;Ne.prototype.visitTimestampNanosecond=Ke;Ne.prototype.visitTime=Ke;Ne.prototype.visitTimeSecond=Ke;Ne.prototype.visitTimeMillisecond=Ke;Ne.prototype.visitTimeMicrosecond=Ke;Ne.prototype.visitTimeNanosecond=Ke;Ne.prototype.visitDecimal=Ke;Ne.prototype.visitList=Ke;Ne.prototype.visitStruct=Ke;Ne.prototype.visitUnion=Ke;Ne.prototype.visitDenseUnion=mx;Ne.prototype.visitSparseUnion=mx;Ne.prototype.visitDictionary=Ke;Ne.prototype.visitInterval=Ke;Ne.prototype.visitIntervalDayTime=Ke;Ne.prototype.visitIntervalYearMonth=Ke;Ne.prototype.visitDuration=Ke;Ne.prototype.visitDurationSecond=Ke;Ne.prototype.visitDurationMillisecond=Ke;Ne.prototype.visitDurationMicrosecond=Ke;Ne.prototype.visitDurationNanosecond=Ke;Ne.prototype.visitFixedSizeList=Ke;Ne.prototype.visitMap=Ke;const Gp=new Ne;class Ue extends fi{}function Ze(s){const{type:t}=s;if(s.nullCount===0&&s.stride===1&&(Me.isInt(t)&&t.bitWidth!==64||Me.isTime(t)&&t.bitWidth!==64||Me.isFloat(t)&&t.precision!==Ln.HALF))return new w0(s.data.length,u=>{const _=s.data[u];return _.values.subarray(0,_.length)[Symbol.iterator]()});let n=0;return new w0(s.data.length,u=>{const v=s.data[u].length,I=s.slice(n,n+v);return n+=v,new AA(I)})}class AA{constructor(t){this.vector=t,this.index=0}next(){return this.index<this.vector.length?{value:this.vector.get(this.index++)}:{done:!0,value:null}}[Symbol.iterator](){return this}}Ue.prototype.visitNull=Ze;Ue.prototype.visitBool=Ze;Ue.prototype.visitInt=Ze;Ue.prototype.visitInt8=Ze;Ue.prototype.visitInt16=Ze;Ue.prototype.visitInt32=Ze;Ue.prototype.visitInt64=Ze;Ue.prototype.visitUint8=Ze;Ue.prototype.visitUint16=Ze;Ue.prototype.visitUint32=Ze;Ue.prototype.visitUint64=Ze;Ue.prototype.visitFloat=Ze;Ue.prototype.visitFloat16=Ze;Ue.prototype.visitFloat32=Ze;Ue.prototype.visitFloat64=Ze;Ue.prototype.visitUtf8=Ze;Ue.prototype.visitLargeUtf8=Ze;Ue.prototype.visitBinary=Ze;Ue.prototype.visitLargeBinary=Ze;Ue.prototype.visitFixedSizeBinary=Ze;Ue.prototype.visitDate=Ze;Ue.prototype.visitDateDay=Ze;Ue.prototype.visitDateMillisecond=Ze;Ue.prototype.visitTimestamp=Ze;Ue.prototype.visitTimestampSecond=Ze;Ue.prototype.visitTimestampMillisecond=Ze;Ue.prototype.visitTimestampMicrosecond=Ze;Ue.prototype.visitTimestampNanosecond=Ze;Ue.prototype.visitTime=Ze;Ue.prototype.visitTimeSecond=Ze;Ue.prototype.visitTimeMillisecond=Ze;Ue.prototype.visitTimeMicrosecond=Ze;Ue.prototype.visitTimeNanosecond=Ze;Ue.prototype.visitDecimal=Ze;Ue.prototype.visitList=Ze;Ue.prototype.visitStruct=Ze;Ue.prototype.visitUnion=Ze;Ue.prototype.visitDenseUnion=Ze;Ue.prototype.visitSparseUnion=Ze;Ue.prototype.visitDictionary=Ze;Ue.prototype.visitInterval=Ze;Ue.prototype.visitIntervalDayTime=Ze;Ue.prototype.visitIntervalYearMonth=Ze;Ue.prototype.visitDuration=Ze;Ue.prototype.visitDurationSecond=Ze;Ue.prototype.visitDurationMillisecond=Ze;Ue.prototype.visitDurationMicrosecond=Ze;Ue.prototype.visitDurationNanosecond=Ze;Ue.prototype.visitFixedSizeList=Ze;Ue.prototype.visitMap=Ze;const Og=new Ue;var gx;const yx={},_x={};class Ni{constructor(t){var n,u,_;const v=t[0]instanceof Ni?t.flatMap(l=>l.data):t;if(v.length===0||v.some(l=>!(l instanceof qi)))throw new TypeError("Vector constructor expects an Array of Data instances.");const I=(n=v[0])===null||n===void 0?void 0:n.type;switch(v.length){case 0:this._offsets=[0];break;case 1:{const{get:l,set:P,indexOf:E}=yx[I.typeId],U=v[0];this.isValid=j=>Fg(U,j),this.get=j=>l(U,j),this.set=(j,W)=>P(U,j,W),this.indexOf=j=>E(U,j),this._offsets=[0,U.length];break}default:Object.setPrototypeOf(this,_x[I.typeId]),this._offsets=hx(v);break}this.data=v,this.type=I,this.stride=Qo(I),this.numChildren=(_=(u=I.children)===null||u===void 0?void 0:u.length)!==null&&_!==void 0?_:0,this.length=this._offsets.at(-1)}get byteLength(){return this.data.reduce((t,n)=>t+n.byteLength,0)}get nullable(){return IA(this.data)}get nullCount(){return ux(this.data)}get ArrayType(){return this.type.ArrayType}get[Symbol.toStringTag](){return`${this.VectorName}<${this.type[Symbol.toStringTag]}>`}get VectorName(){return`${st[this.type.typeId]}Vector`}isValid(t){return!1}get(t){return null}at(t){return this.get(zg(t,this.length))}set(t,n){}indexOf(t,n){return-1}includes(t,n){return this.indexOf(t,n)>-1}[Symbol.iterator](){return Og.visit(this)}concat(...t){return new Ni(this.data.concat(t.flatMap(n=>n.data).flat(Number.POSITIVE_INFINITY)))}slice(t,n){return new Ni(lx(this,t,n,({data:u,_offsets:_},v,I)=>dx(u,_,v,I)))}toJSON(){return[...this]}toArray(){const{type:t,data:n,length:u,stride:_,ArrayType:v}=this;switch(t.typeId){case st.Int:case st.Float:case st.Decimal:case st.Time:case st.Timestamp:switch(n.length){case 0:return new v;case 1:return n[0].values.subarray(0,u*_);default:return n.reduce((I,{values:l,length:P})=>(I.array.set(l.subarray(0,P*_),I.offset),I.offset+=P*_,I),{array:new v(u*_),offset:0}).array}}return[...this]}toString(){return`[${[...this].join(",")}]`}getChild(t){var n;return this.getChildAt((n=this.type.children)===null||n===void 0?void 0:n.findIndex(u=>u.name===t))}getChildAt(t){return t>-1&&t<this.numChildren?new Ni(this.data.map(({children:n})=>n[t])):null}get isMemoized(){return Me.isDictionary(this.type)?this.data[0].dictionary.isMemoized:!1}memoize(){if(Me.isDictionary(this.type)){const t=new Zp(this.data[0].dictionary),n=this.data.map(u=>{const _=u.clone();return _.dictionary=t,_});return new Ni(n)}return new Zp(this)}unmemoize(){if(Me.isDictionary(this.type)&&this.isMemoized){const t=this.data[0].dictionary.unmemoize(),n=this.data.map(u=>{const _=u.clone();return _.dictionary=t,_});return new Ni(n)}return this}}gx=Symbol.toStringTag;Ni[gx]=(s=>{s.type=Me.prototype,s.data=[],s.length=0,s.stride=1,s.numChildren=0,s._offsets=new Uint32Array([0]),s[Symbol.isConcatSpreadable]=!0;const t=Object.keys(st).map(n=>st[n]).filter(n=>typeof n=="number"&&n!==st.NONE);for(const n of t){const u=cs.getVisitFnByTypeId(n),_=Rs.getVisitFnByTypeId(n),v=Gp.getVisitFnByTypeId(n);yx[n]={get:u,set:_,indexOf:v},_x[n]=Object.create(s,{isValid:{value:qp(Fg)},get:{value:qp(cs.getVisitFnByTypeId(n))},set:{value:px(Rs.getVisitFnByTypeId(n))},indexOf:{value:fx(Gp.getVisitFnByTypeId(n))}})}return"Vector"})(Ni.prototype);class Zp extends Ni{constructor(t){super(t.data);const n=this.get,u=this.set,_=this.slice,v=new Array(this.length);Object.defineProperty(this,"get",{value(I){const l=v[I];if(l!==void 0)return l;const P=n.call(this,I);return v[I]=P,P}}),Object.defineProperty(this,"set",{value(I,l){u.call(this,I,l),v[I]=l}}),Object.defineProperty(this,"slice",{value:(I,l)=>new Zp(_.call(this,I,l))}),Object.defineProperty(this,"isMemoized",{value:!0}),Object.defineProperty(this,"unmemoize",{value:()=>new Ni(this.data)}),Object.defineProperty(this,"memoize",{value:()=>this})}}class rg{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}offset(){return this.bb.readInt64(this.bb_pos)}metaDataLength(){return this.bb.readInt32(this.bb_pos+8)}bodyLength(){return this.bb.readInt64(this.bb_pos+16)}static sizeOf(){return 24}static createBlock(t,n,u,_){return t.prep(8,24),t.writeInt64(BigInt(_??0)),t.pad(4),t.writeInt32(u),t.writeInt64(BigInt(n??0)),t.offset()}}class ms{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsFooter(t,n){return(n||new ms).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFooter(t,n){return t.setPosition(t.position()+Vi),(n||new ms).__init(t.readInt32(t.position())+t.position(),t)}version(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):$r.V1}schema(t){const n=this.bb.__offset(this.bb_pos,6);return n?(t||new yo).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}dictionaries(t,n){const u=this.bb.__offset(this.bb_pos,8);return u?(n||new rg).__init(this.bb.__vector(this.bb_pos+u)+t*24,this.bb):null}dictionariesLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}recordBatches(t,n){const u=this.bb.__offset(this.bb_pos,10);return u?(n||new rg).__init(this.bb.__vector(this.bb_pos+u)+t*24,this.bb):null}recordBatchesLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,n){const u=this.bb.__offset(this.bb_pos,12);return u?(n||new tn).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+u)+t*4),this.bb):null}customMetadataLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}static startFooter(t){t.startObject(5)}static addVersion(t,n){t.addFieldInt16(0,n,$r.V1)}static addSchema(t,n){t.addFieldOffset(1,n,0)}static addDictionaries(t,n){t.addFieldOffset(2,n,0)}static startDictionariesVector(t,n){t.startVector(24,n,8)}static addRecordBatches(t,n){t.addFieldOffset(3,n,0)}static startRecordBatchesVector(t,n){t.startVector(24,n,8)}static addCustomMetadata(t,n){t.addFieldOffset(4,n,0)}static createCustomMetadataVector(t,n){t.startVector(4,n.length,4);for(let u=n.length-1;u>=0;u--)t.addOffset(n[u]);return t.endVector()}static startCustomMetadataVector(t,n){t.startVector(4,n,4)}static endFooter(t){return t.endObject()}static finishFooterBuffer(t,n){t.finish(n)}static finishSizePrefixedFooterBuffer(t,n){t.finish(n,void 0,!0)}}class Ui{constructor(t=[],n,u,_=$r.V5){this.fields=t||[],this.metadata=n||new Map,u||(u=ng(this.fields)),this.dictionaries=u,this.metadataVersion=_}get[Symbol.toStringTag](){return"Schema"}get names(){return this.fields.map(t=>t.name)}toString(){return`Schema<{ ${this.fields.map((t,n)=>`${n}: ${t}`).join(", ")} }>`}select(t){const n=new Set(t),u=this.fields.filter(_=>n.has(_.name));return new Ui(u,this.metadata)}selectAt(t){const n=t.map(u=>this.fields[u]).filter(Boolean);return new Ui(n,this.metadata)}assign(...t){const n=t[0]instanceof Ui?t[0]:Array.isArray(t[0])?new Ui(t[0]):new Ui(t),u=[...this.fields],_=Kd(Kd(new Map,this.metadata),n.metadata),v=n.fields.filter(l=>{const P=u.findIndex(E=>E.name===l.name);return~P?(u[P]=l.clone({metadata:Kd(Kd(new Map,u[P].metadata),l.metadata)}))&&!1:!0}),I=ng(v,new Map);return new Ui([...u,...v],_,new Map([...this.dictionaries,...I]))}}Ui.prototype.fields=null;Ui.prototype.metadata=null;Ui.prototype.dictionaries=null;class gr{static new(...t){let[n,u,_,v]=t;return t[0]&&typeof t[0]=="object"&&({name:n}=t[0],u===void 0&&(u=t[0].type),_===void 0&&(_=t[0].nullable),v===void 0&&(v=t[0].metadata)),new gr(`${n}`,u,_,v)}constructor(t,n,u=!1,_){this.name=t,this.type=n,this.nullable=u,this.metadata=_||new Map}get typeId(){return this.type.typeId}get[Symbol.toStringTag](){return"Field"}toString(){return`${this.name}: ${this.type}`}clone(...t){let[n,u,_,v]=t;return!t[0]||typeof t[0]!="object"?[n=this.name,u=this.type,_=this.nullable,v=this.metadata]=t:{name:n=this.name,type:u=this.type,nullable:_=this.nullable,metadata:v=this.metadata}=t[0],gr.new(n,u,_,v)}}gr.prototype.type=null;gr.prototype.name=null;gr.prototype.nullable=null;gr.prototype.metadata=null;function Kd(s,t){return new Map([...s||new Map,...t||new Map])}function ng(s,t=new Map){for(let n=-1,u=s.length;++n<u;){const v=s[n].type;if(Me.isDictionary(v)){if(!t.has(v.id))t.set(v.id,v.dictionary);else if(t.get(v.id)!==v.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}v.children&&v.children.length>0&&ng(v.children,t)}return t}var EA=$v,CA=Nc;class Sh{static decode(t){t=new CA(Ti(t));const n=ms.getRootAsFooter(t),u=Ui.decode(n.schema(),new Map,n.version());return new MA(u,n)}static encode(t){const n=new EA,u=Ui.encode(n,t.schema);ms.startRecordBatchesVector(n,t.numRecordBatches);for(const I of[...t.recordBatches()].slice().reverse())Va.encode(n,I);const _=n.endVector();ms.startDictionariesVector(n,t.numDictionaries);for(const I of[...t.dictionaryBatches()].slice().reverse())Va.encode(n,I);const v=n.endVector();return ms.startFooter(n),ms.addSchema(n,u),ms.addVersion(n,$r.V5),ms.addRecordBatches(n,_),ms.addDictionaries(n,v),ms.finishFooterBuffer(n,ms.endFooter(n)),n.asUint8Array()}get numRecordBatches(){return this._recordBatches.length}get numDictionaries(){return this._dictionaryBatches.length}constructor(t,n=$r.V5,u,_){this.schema=t,this.version=n,u&&(this._recordBatches=u),_&&(this._dictionaryBatches=_)}*recordBatches(){for(let t,n=-1,u=this.numRecordBatches;++n<u;)(t=this.getRecordBatch(n))&&(yield t)}*dictionaryBatches(){for(let t,n=-1,u=this.numDictionaries;++n<u;)(t=this.getDictionaryBatch(n))&&(yield t)}getRecordBatch(t){return t>=0&&t<this.numRecordBatches&&this._recordBatches[t]||null}getDictionaryBatch(t){return t>=0&&t<this.numDictionaries&&this._dictionaryBatches[t]||null}}class MA extends Sh{get numRecordBatches(){return this._footer.recordBatchesLength()}get numDictionaries(){return this._footer.dictionariesLength()}constructor(t,n){super(t,n.version()),this._footer=n}getRecordBatch(t){if(t>=0&&t<this.numRecordBatches){const n=this._footer.recordBatches(t);if(n)return Va.decode(n)}return null}getDictionaryBatch(t){if(t>=0&&t<this.numDictionaries){const n=this._footer.dictionaries(t);if(n)return Va.decode(n)}return null}}class Va{static decode(t){return new Va(t.metaDataLength(),t.bodyLength(),t.offset())}static encode(t,n){const{metaDataLength:u}=n,_=BigInt(n.offset),v=BigInt(n.bodyLength);return rg.createBlock(t,_,u,v)}constructor(t,n,u){this.metaDataLength=t,this.offset=er(u),this.bodyLength=er(n)}}const Tr=Object.freeze({done:!0,value:void 0});class S0{constructor(t){this._json=t}get schema(){return this._json.schema}get batches(){return this._json.batches||[]}get dictionaries(){return this._json.dictionaries||[]}}class Ng{tee(){return this._getDOMStream().tee()}pipe(t,n){return this._getNodeStream().pipe(t,n)}pipeTo(t,n){return this._getDOMStream().pipeTo(t,n)}pipeThrough(t,n){return this._getDOMStream().pipeThrough(t,n)}_getDOMStream(){return this._DOMStream||(this._DOMStream=this.toDOMStream())}_getNodeStream(){return this._nodeStream||(this._nodeStream=this.toNodeStream())}}class DA extends Ng{constructor(){super(),this._values=[],this.resolvers=[],this._closedPromise=new Promise(t=>this._closedPromiseResolve=t)}get closed(){return this._closedPromise}cancel(t){return Qe(this,void 0,void 0,function*(){yield this.return(t)})}write(t){this._ensureOpen()&&(this.resolvers.length<=0?this._values.push(t):this.resolvers.shift().resolve({done:!1,value:t}))}abort(t){this._closedPromiseResolve&&(this.resolvers.length<=0?this._error={error:t}:this.resolvers.shift().reject({done:!0,value:t}))}close(){if(this._closedPromiseResolve){const{resolvers:t}=this;for(;t.length>0;)t.shift().resolve(Tr);this._closedPromiseResolve(),this._closedPromiseResolve=void 0}}[Symbol.asyncIterator](){return this}toDOMStream(t){return Ds.toDOMStream(this._closedPromiseResolve||this._error?this:this._values,t)}toNodeStream(t){return Ds.toNodeStream(this._closedPromiseResolve||this._error?this:this._values,t)}throw(t){return Qe(this,void 0,void 0,function*(){return yield this.abort(t),Tr})}return(t){return Qe(this,void 0,void 0,function*(){return yield this.close(),Tr})}read(t){return Qe(this,void 0,void 0,function*(){return(yield this.next(t,"read")).value})}peek(t){return Qe(this,void 0,void 0,function*(){return(yield this.next(t,"peek")).value})}next(...t){return this._values.length>0?Promise.resolve({done:!1,value:this._values.shift()}):this._error?Promise.reject({done:!0,value:this._error.error}):this._closedPromiseResolve?new Promise((n,u)=>{this.resolvers.push({resolve:n,reject:u})}):Promise.resolve(Tr)}_ensureOpen(){if(this._closedPromiseResolve)return!0;throw new Error("AsyncQueue is closed")}}class lp extends DA{write(t){if((t=Ti(t)).byteLength>0)return super.write(t)}toString(t=!1){return t?Ym(this.toUint8Array(!0)):this.toUint8Array(!1).then(Ym)}toUint8Array(t=!1){return t?ko(this._values)[0]:Qe(this,void 0,void 0,function*(){var n,u,_,v;const I=[];let l=0;try{for(var P=!0,E=xl(this),U;U=yield E.next(),n=U.done,!n;P=!0){v=U.value,P=!1;const j=v;I.push(j),l+=j.byteLength}}catch(j){u={error:j}}finally{try{!P&&!n&&(_=E.return)&&(yield _.call(E))}finally{if(u)throw u.error}}return ko(I,l)[0]})}}class Wp{constructor(t){t&&(this.source=new PA(Ds.fromIterable(t)))}[Symbol.iterator](){return this}next(t){return this.source.next(t)}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}peek(t){return this.source.peek(t)}read(t){return this.source.read(t)}}class $c{constructor(t){t instanceof $c?this.source=t.source:t instanceof lp?this.source=new ml(Ds.fromAsyncIterable(t)):Ov(t)?this.source=new ml(Ds.fromNodeStream(t)):Eg(t)?this.source=new ml(Ds.fromDOMStream(t)):Fv(t)?this.source=new ml(Ds.fromDOMStream(t.body)):Dh(t)?this.source=new ml(Ds.fromIterable(t)):Tl(t)?this.source=new ml(Ds.fromAsyncIterable(t)):Wc(t)&&(this.source=new ml(Ds.fromAsyncIterable(t)))}[Symbol.asyncIterator](){return this}next(t){return this.source.next(t)}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}get closed(){return this.source.closed}cancel(t){return this.source.cancel(t)}peek(t){return this.source.peek(t)}read(t){return this.source.read(t)}}class PA{constructor(t){this.source=t}cancel(t){this.return(t)}peek(t){return this.next(t,"peek").value}read(t){return this.next(t,"read").value}next(t,n="read"){return this.source.next({cmd:n,size:t})}throw(t){return Object.create(this.source.throw&&this.source.throw(t)||Tr)}return(t){return Object.create(this.source.return&&this.source.return(t)||Tr)}}class ml{constructor(t){this.source=t,this._closedPromise=new Promise(n=>this._closedPromiseResolve=n)}cancel(t){return Qe(this,void 0,void 0,function*(){yield this.return(t)})}get closed(){return this._closedPromise}read(t){return Qe(this,void 0,void 0,function*(){return(yield this.next(t,"read")).value})}peek(t){return Qe(this,void 0,void 0,function*(){return(yield this.next(t,"peek")).value})}next(t){return Qe(this,arguments,void 0,function*(n,u="read"){return yield this.source.next({cmd:u,size:n})})}throw(t){return Qe(this,void 0,void 0,function*(){const n=this.source.throw&&(yield this.source.throw(t))||Tr;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(n)})}return(t){return Qe(this,void 0,void 0,function*(){const n=this.source.return&&(yield this.source.return(t))||Tr;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(n)})}}class I0 extends Wp{constructor(t,n){super(),this.position=0,this.buffer=Ti(t),this.size=n===void 0?this.buffer.byteLength:n}readInt32(t){const{buffer:n,byteOffset:u}=this.readAt(t,4);return new DataView(n,u).getInt32(0,!0)}seek(t){return this.position=Math.min(t,this.size),t<this.size}read(t){const{buffer:n,size:u,position:_}=this;return n&&_<u?(typeof t!="number"&&(t=Number.POSITIVE_INFINITY),this.position=Math.min(u,_+Math.min(u-_,t)),n.subarray(_,this.position)):null}readAt(t,n){const u=this.buffer,_=Math.min(this.size,t+n);return u?u.subarray(t,_):new Uint8Array(n)}close(){this.buffer&&(this.buffer=null)}throw(t){return this.close(),{done:!0,value:t}}return(t){return this.close(),{done:!0,value:t}}}class Hp extends $c{constructor(t,n){super(),this.position=0,this._handle=t,typeof n=="number"?this.size=n:this._pending=Qe(this,void 0,void 0,function*(){this.size=(yield t.stat()).size,delete this._pending})}readInt32(t){return Qe(this,void 0,void 0,function*(){const{buffer:n,byteOffset:u}=yield this.readAt(t,4);return new DataView(n,u).getInt32(0,!0)})}seek(t){return Qe(this,void 0,void 0,function*(){return this._pending&&(yield this._pending),this.position=Math.min(t,this.size),t<this.size})}read(t){return Qe(this,void 0,void 0,function*(){this._pending&&(yield this._pending);const{_handle:n,size:u,position:_}=this;if(n&&_<u){typeof t!="number"&&(t=Number.POSITIVE_INFINITY);let v=_,I=0,l=0;const P=Math.min(u,v+Math.min(u-v,t)),E=new Uint8Array(Math.max(0,(this.position=P)-v));for(;(v+=l)<P&&(I+=l)<E.byteLength;)({bytesRead:l}=yield n.read(E,I,E.byteLength-I,v));return E}return null})}readAt(t,n){return Qe(this,void 0,void 0,function*(){this._pending&&(yield this._pending);const{_handle:u,size:_}=this;if(u&&t+n<_){const v=Math.min(_,t+n),I=new Uint8Array(v-t);return(yield u.read(I,0,n,t)).buffer}return new Uint8Array(n)})}close(){return Qe(this,void 0,void 0,function*(){const t=this._handle;this._handle=null,t&&(yield t.close())})}throw(t){return Qe(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:t}})}return(t){return Qe(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:t}})}}const LA=65536;function kc(s){return s<0&&(s=4294967295+s+1),`0x${s.toString(16)}`}const jc=8,Ug=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8];class vx{constructor(t){this.buffer=t}high(){return this.buffer[1]}low(){return this.buffer[0]}_times(t){const n=new Uint32Array([this.buffer[1]>>>16,this.buffer[1]&65535,this.buffer[0]>>>16,this.buffer[0]&65535]),u=new Uint32Array([t.buffer[1]>>>16,t.buffer[1]&65535,t.buffer[0]>>>16,t.buffer[0]&65535]);let _=n[3]*u[3];this.buffer[0]=_&65535;let v=_>>>16;return _=n[2]*u[3],v+=_,_=n[3]*u[2]>>>0,v+=_,this.buffer[0]+=v<<16,this.buffer[1]=v>>>0<_?LA:0,this.buffer[1]+=v>>>16,this.buffer[1]+=n[1]*u[3]+n[2]*u[2]+n[3]*u[1],this.buffer[1]+=n[0]*u[3]+n[1]*u[2]+n[2]*u[1]+n[3]*u[0]<<16,this}_plus(t){const n=this.buffer[0]+t.buffer[0]>>>0;this.buffer[1]+=t.buffer[1],n<this.buffer[0]>>>0&&++this.buffer[1],this.buffer[0]=n}lessThan(t){return this.buffer[1]<t.buffer[1]||this.buffer[1]===t.buffer[1]&&this.buffer[0]<t.buffer[0]}equals(t){return this.buffer[1]===t.buffer[1]&&this.buffer[0]==t.buffer[0]}greaterThan(t){return t.lessThan(this)}hex(){return`${kc(this.buffer[1])} ${kc(this.buffer[0])}`}}class Gi extends vx{times(t){return this._times(t),this}plus(t){return this._plus(t),this}static from(t,n=new Uint32Array(2)){return Gi.fromString(typeof t=="string"?t:t.toString(),n)}static fromNumber(t,n=new Uint32Array(2)){return Gi.fromString(t.toString(),n)}static fromString(t,n=new Uint32Array(2)){const u=t.length,_=new Gi(n);for(let v=0;v<u;){const I=jc<u-v?jc:u-v,l=new Gi(new Uint32Array([Number.parseInt(t.slice(v,v+I),10),0])),P=new Gi(new Uint32Array([Ug[I],0]));_.times(P),_.plus(l),v+=I}return _}static convertArray(t){const n=new Uint32Array(t.length*2);for(let u=-1,_=t.length;++u<_;)Gi.from(t[u],new Uint32Array(n.buffer,n.byteOffset+2*u*4,2));return n}static multiply(t,n){return new Gi(new Uint32Array(t.buffer)).times(n)}static add(t,n){return new Gi(new Uint32Array(t.buffer)).plus(n)}}class ss extends vx{negate(){return this.buffer[0]=~this.buffer[0]+1,this.buffer[1]=~this.buffer[1],this.buffer[0]==0&&++this.buffer[1],this}times(t){return this._times(t),this}plus(t){return this._plus(t),this}lessThan(t){const n=this.buffer[1]<<0,u=t.buffer[1]<<0;return n<u||n===u&&this.buffer[0]<t.buffer[0]}static from(t,n=new Uint32Array(2)){return ss.fromString(typeof t=="string"?t:t.toString(),n)}static fromNumber(t,n=new Uint32Array(2)){return ss.fromString(t.toString(),n)}static fromString(t,n=new Uint32Array(2)){const u=t.startsWith("-"),_=t.length,v=new ss(n);for(let I=u?1:0;I<_;){const l=jc<_-I?jc:_-I,P=new ss(new Uint32Array([Number.parseInt(t.slice(I,I+l),10),0])),E=new ss(new Uint32Array([Ug[l],0]));v.times(E),v.plus(P),I+=l}return u?v.negate():v}static convertArray(t){const n=new Uint32Array(t.length*2);for(let u=-1,_=t.length;++u<_;)ss.from(t[u],new Uint32Array(n.buffer,n.byteOffset+2*u*4,2));return n}static multiply(t,n){return new ss(new Uint32Array(t.buffer)).times(n)}static add(t,n){return new ss(new Uint32Array(t.buffer)).plus(n)}}class _o{constructor(t){this.buffer=t}high(){return new ss(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2))}low(){return new ss(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset,2))}negate(){return this.buffer[0]=~this.buffer[0]+1,this.buffer[1]=~this.buffer[1],this.buffer[2]=~this.buffer[2],this.buffer[3]=~this.buffer[3],this.buffer[0]==0&&++this.buffer[1],this.buffer[1]==0&&++this.buffer[2],this.buffer[2]==0&&++this.buffer[3],this}times(t){const n=new Gi(new Uint32Array([this.buffer[3],0])),u=new Gi(new Uint32Array([this.buffer[2],0])),_=new Gi(new Uint32Array([this.buffer[1],0])),v=new Gi(new Uint32Array([this.buffer[0],0])),I=new Gi(new Uint32Array([t.buffer[3],0])),l=new Gi(new Uint32Array([t.buffer[2],0])),P=new Gi(new Uint32Array([t.buffer[1],0])),E=new Gi(new Uint32Array([t.buffer[0],0]));let U=Gi.multiply(v,E);this.buffer[0]=U.low();const j=new Gi(new Uint32Array([U.high(),0]));return U=Gi.multiply(_,E),j.plus(U),U=Gi.multiply(v,P),j.plus(U),this.buffer[1]=j.low(),this.buffer[3]=j.lessThan(U)?1:0,this.buffer[2]=j.high(),new Gi(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2)).plus(Gi.multiply(u,E)).plus(Gi.multiply(_,P)).plus(Gi.multiply(v,l)),this.buffer[3]+=Gi.multiply(n,E).plus(Gi.multiply(u,P)).plus(Gi.multiply(_,l)).plus(Gi.multiply(v,I)).low(),this}plus(t){const n=new Uint32Array(4);return n[3]=this.buffer[3]+t.buffer[3]>>>0,n[2]=this.buffer[2]+t.buffer[2]>>>0,n[1]=this.buffer[1]+t.buffer[1]>>>0,n[0]=this.buffer[0]+t.buffer[0]>>>0,n[0]<this.buffer[0]>>>0&&++n[1],n[1]<this.buffer[1]>>>0&&++n[2],n[2]<this.buffer[2]>>>0&&++n[3],this.buffer[3]=n[3],this.buffer[2]=n[2],this.buffer[1]=n[1],this.buffer[0]=n[0],this}hex(){return`${kc(this.buffer[3])} ${kc(this.buffer[2])} ${kc(this.buffer[1])} ${kc(this.buffer[0])}`}static multiply(t,n){return new _o(new Uint32Array(t.buffer)).times(n)}static add(t,n){return new _o(new Uint32Array(t.buffer)).plus(n)}static from(t,n=new Uint32Array(4)){return _o.fromString(typeof t=="string"?t:t.toString(),n)}static fromNumber(t,n=new Uint32Array(4)){return _o.fromString(t.toString(),n)}static fromString(t,n=new Uint32Array(4)){const u=t.startsWith("-"),_=t.length,v=new _o(n);for(let I=u?1:0;I<_;){const l=jc<_-I?jc:_-I,P=new _o(new Uint32Array([Number.parseInt(t.slice(I,I+l),10),0,0,0])),E=new _o(new Uint32Array([Ug[l],0,0,0]));v.times(E),v.plus(P),I+=l}return u?v.negate():v}static convertArray(t){const n=new Uint32Array(t.length*4);for(let u=-1,_=t.length;++u<_;)_o.from(t[u],new Uint32Array(n.buffer,n.byteOffset+4*4*u,4));return n}}class bx extends fi{constructor(t,n,u,_,v=$r.V5){super(),this.nodesIndex=-1,this.buffersIndex=-1,this.bytes=t,this.nodes=n,this.buffers=u,this.dictionaries=_,this.metadataVersion=v}visit(t){return super.visit(t instanceof gr?t.type:t)}visitNull(t,{length:n}=this.nextFieldNode()){return _i({type:t,length:n})}visitBool(t,{length:n,nullCount:u}=this.nextFieldNode()){return _i({type:t,length:n,nullCount:u,nullBitmap:this.readNullBitmap(t,u),data:this.readData(t)})}visitInt(t,{length:n,nullCount:u}=this.nextFieldNode()){return _i({type:t,length:n,nullCount:u,nullBitmap:this.readNullBitmap(t,u),data:this.readData(t)})}visitFloat(t,{length:n,nullCount:u}=this.nextFieldNode()){return _i({type:t,length:n,nullCount:u,nullBitmap:this.readNullBitmap(t,u),data:this.readData(t)})}visitUtf8(t,{length:n,nullCount:u}=this.nextFieldNode()){return _i({type:t,length:n,nullCount:u,nullBitmap:this.readNullBitmap(t,u),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitLargeUtf8(t,{length:n,nullCount:u}=this.nextFieldNode()){return _i({type:t,length:n,nullCount:u,nullBitmap:this.readNullBitmap(t,u),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitBinary(t,{length:n,nullCount:u}=this.nextFieldNode()){return _i({type:t,length:n,nullCount:u,nullBitmap:this.readNullBitmap(t,u),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitLargeBinary(t,{length:n,nullCount:u}=this.nextFieldNode()){return _i({type:t,length:n,nullCount:u,nullBitmap:this.readNullBitmap(t,u),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitFixedSizeBinary(t,{length:n,nullCount:u}=this.nextFieldNode()){return _i({type:t,length:n,nullCount:u,nullBitmap:this.readNullBitmap(t,u),data:this.readData(t)})}visitDate(t,{length:n,nullCount:u}=this.nextFieldNode()){return _i({type:t,length:n,nullCount:u,nullBitmap:this.readNullBitmap(t,u),data:this.readData(t)})}visitTimestamp(t,{length:n,nullCount:u}=this.nextFieldNode()){return _i({type:t,length:n,nullCount:u,nullBitmap:this.readNullBitmap(t,u),data:this.readData(t)})}visitTime(t,{length:n,nullCount:u}=this.nextFieldNode()){return _i({type:t,length:n,nullCount:u,nullBitmap:this.readNullBitmap(t,u),data:this.readData(t)})}visitDecimal(t,{length:n,nullCount:u}=this.nextFieldNode()){return _i({type:t,length:n,nullCount:u,nullBitmap:this.readNullBitmap(t,u),data:this.readData(t)})}visitList(t,{length:n,nullCount:u}=this.nextFieldNode()){return _i({type:t,length:n,nullCount:u,nullBitmap:this.readNullBitmap(t,u),valueOffsets:this.readOffsets(t),child:this.visit(t.children[0])})}visitStruct(t,{length:n,nullCount:u}=this.nextFieldNode()){return _i({type:t,length:n,nullCount:u,nullBitmap:this.readNullBitmap(t,u),children:this.visitMany(t.children)})}visitUnion(t,{length:n,nullCount:u}=this.nextFieldNode()){return this.metadataVersion<$r.V5&&this.readNullBitmap(t,u),t.mode===zn.Sparse?this.visitSparseUnion(t,{length:n,nullCount:u}):this.visitDenseUnion(t,{length:n,nullCount:u})}visitDenseUnion(t,{length:n,nullCount:u}=this.nextFieldNode()){return _i({type:t,length:n,nullCount:u,typeIds:this.readTypeIds(t),valueOffsets:this.readOffsets(t),children:this.visitMany(t.children)})}visitSparseUnion(t,{length:n,nullCount:u}=this.nextFieldNode()){return _i({type:t,length:n,nullCount:u,typeIds:this.readTypeIds(t),children:this.visitMany(t.children)})}visitDictionary(t,{length:n,nullCount:u}=this.nextFieldNode()){return _i({type:t,length:n,nullCount:u,nullBitmap:this.readNullBitmap(t,u),data:this.readData(t.indices),dictionary:this.readDictionary(t)})}visitInterval(t,{length:n,nullCount:u}=this.nextFieldNode()){return _i({type:t,length:n,nullCount:u,nullBitmap:this.readNullBitmap(t,u),data:this.readData(t)})}visitDuration(t,{length:n,nullCount:u}=this.nextFieldNode()){return _i({type:t,length:n,nullCount:u,nullBitmap:this.readNullBitmap(t,u),data:this.readData(t)})}visitFixedSizeList(t,{length:n,nullCount:u}=this.nextFieldNode()){return _i({type:t,length:n,nullCount:u,nullBitmap:this.readNullBitmap(t,u),child:this.visit(t.children[0])})}visitMap(t,{length:n,nullCount:u}=this.nextFieldNode()){return _i({type:t,length:n,nullCount:u,nullBitmap:this.readNullBitmap(t,u),valueOffsets:this.readOffsets(t),child:this.visit(t.children[0])})}nextFieldNode(){return this.nodes[++this.nodesIndex]}nextBufferRange(){return this.buffers[++this.buffersIndex]}readNullBitmap(t,n,u=this.nextBufferRange()){return n>0&&this.readData(t,u)||new Uint8Array(0)}readOffsets(t,n){return this.readData(t,n)}readTypeIds(t,n){return this.readData(t,n)}readData(t,{length:n,offset:u}=this.nextBufferRange()){return this.bytes.subarray(u,u+n)}readDictionary(t){return this.dictionaries.get(t.id)}}class zA extends bx{constructor(t,n,u,_,v){super(new Uint8Array(0),n,u,_,v),this.sources=t}readNullBitmap(t,n,{offset:u}=this.nextBufferRange()){return n<=0?new Uint8Array(0):jp(this.sources[u])}readOffsets(t,{offset:n}=this.nextBufferRange()){return Zi(Uint8Array,Zi(t.OffsetArrayType,this.sources[n]))}readTypeIds(t,{offset:n}=this.nextBufferRange()){return Zi(Uint8Array,Zi(t.ArrayType,this.sources[n]))}readData(t,{offset:n}=this.nextBufferRange()){const{sources:u}=this;return Me.isTimestamp(t)||(Me.isInt(t)||Me.isTime(t))&&t.bitWidth===64||Me.isDuration(t)||Me.isDate(t)&&t.unit===Bs.MILLISECOND?Zi(Uint8Array,ss.convertArray(u[n])):Me.isDecimal(t)?Zi(Uint8Array,_o.convertArray(u[n])):Me.isBinary(t)||Me.isLargeBinary(t)||Me.isFixedSizeBinary(t)?BA(u[n]):Me.isBool(t)?jp(u[n]):Me.isUtf8(t)||Me.isLargeUtf8(t)?Ag(u[n].join("")):Zi(Uint8Array,Zi(t.ArrayType,u[n].map(_=>+_)))}}function BA(s){const t=s.join(""),n=new Uint8Array(t.length/2);for(let u=0;u<t.length;u+=2)n[u>>1]=Number.parseInt(t.slice(u,u+2),16);return n}class Ve extends fi{compareSchemas(t,n){return t===n||n instanceof t.constructor&&this.compareManyFields(t.fields,n.fields)}compareManyFields(t,n){return t===n||Array.isArray(t)&&Array.isArray(n)&&t.length===n.length&&t.every((u,_)=>this.compareFields(u,n[_]))}compareFields(t,n){return t===n||n instanceof t.constructor&&t.name===n.name&&t.nullable===n.nullable&&this.visit(t.type,n.type)}}function Yn(s,t){return t instanceof s.constructor}function Al(s,t){return s===t||Yn(s,t)}function sa(s,t){return s===t||Yn(s,t)&&s.bitWidth===t.bitWidth&&s.isSigned===t.isSigned}function uf(s,t){return s===t||Yn(s,t)&&s.precision===t.precision}function RA(s,t){return s===t||Yn(s,t)&&s.byteWidth===t.byteWidth}function Vg(s,t){return s===t||Yn(s,t)&&s.unit===t.unit}function Ph(s,t){return s===t||Yn(s,t)&&s.unit===t.unit&&s.timezone===t.timezone}function Lh(s,t){return s===t||Yn(s,t)&&s.unit===t.unit&&s.bitWidth===t.bitWidth}function FA(s,t){return s===t||Yn(s,t)&&s.children.length===t.children.length&&$a.compareManyFields(s.children,t.children)}function OA(s,t){return s===t||Yn(s,t)&&s.children.length===t.children.length&&$a.compareManyFields(s.children,t.children)}function $g(s,t){return s===t||Yn(s,t)&&s.mode===t.mode&&s.typeIds.every((n,u)=>n===t.typeIds[u])&&$a.compareManyFields(s.children,t.children)}function NA(s,t){return s===t||Yn(s,t)&&s.id===t.id&&s.isOrdered===t.isOrdered&&$a.visit(s.indices,t.indices)&&$a.visit(s.dictionary,t.dictionary)}function jg(s,t){return s===t||Yn(s,t)&&s.unit===t.unit}function zh(s,t){return s===t||Yn(s,t)&&s.unit===t.unit}function UA(s,t){return s===t||Yn(s,t)&&s.listSize===t.listSize&&s.children.length===t.children.length&&$a.compareManyFields(s.children,t.children)}function VA(s,t){return s===t||Yn(s,t)&&s.keysSorted===t.keysSorted&&s.children.length===t.children.length&&$a.compareManyFields(s.children,t.children)}Ve.prototype.visitNull=Al;Ve.prototype.visitBool=Al;Ve.prototype.visitInt=sa;Ve.prototype.visitInt8=sa;Ve.prototype.visitInt16=sa;Ve.prototype.visitInt32=sa;Ve.prototype.visitInt64=sa;Ve.prototype.visitUint8=sa;Ve.prototype.visitUint16=sa;Ve.prototype.visitUint32=sa;Ve.prototype.visitUint64=sa;Ve.prototype.visitFloat=uf;Ve.prototype.visitFloat16=uf;Ve.prototype.visitFloat32=uf;Ve.prototype.visitFloat64=uf;Ve.prototype.visitUtf8=Al;Ve.prototype.visitLargeUtf8=Al;Ve.prototype.visitBinary=Al;Ve.prototype.visitLargeBinary=Al;Ve.prototype.visitFixedSizeBinary=RA;Ve.prototype.visitDate=Vg;Ve.prototype.visitDateDay=Vg;Ve.prototype.visitDateMillisecond=Vg;Ve.prototype.visitTimestamp=Ph;Ve.prototype.visitTimestampSecond=Ph;Ve.prototype.visitTimestampMillisecond=Ph;Ve.prototype.visitTimestampMicrosecond=Ph;Ve.prototype.visitTimestampNanosecond=Ph;Ve.prototype.visitTime=Lh;Ve.prototype.visitTimeSecond=Lh;Ve.prototype.visitTimeMillisecond=Lh;Ve.prototype.visitTimeMicrosecond=Lh;Ve.prototype.visitTimeNanosecond=Lh;Ve.prototype.visitDecimal=Al;Ve.prototype.visitList=FA;Ve.prototype.visitStruct=OA;Ve.prototype.visitUnion=$g;Ve.prototype.visitDenseUnion=$g;Ve.prototype.visitSparseUnion=$g;Ve.prototype.visitDictionary=NA;Ve.prototype.visitInterval=jg;Ve.prototype.visitIntervalDayTime=jg;Ve.prototype.visitIntervalYearMonth=jg;Ve.prototype.visitDuration=zh;Ve.prototype.visitDurationSecond=zh;Ve.prototype.visitDurationMillisecond=zh;Ve.prototype.visitDurationMicrosecond=zh;Ve.prototype.visitDurationNanosecond=zh;Ve.prototype.visitFixedSizeList=UA;Ve.prototype.visitMap=VA;const $a=new Ve;function sg(s,t){return $a.compareSchemas(s,t)}function Em(s,t){return $A(s,t.map(n=>n.data.concat()))}function $A(s,t){const n=[...s.fields],u=[],_={numBatches:t.reduce((j,W)=>Math.max(j,W.length),0)};let v=0,I=0,l=-1;const P=t.length;let E,U=[];for(;_.numBatches-- >0;){for(I=Number.POSITIVE_INFINITY,l=-1;++l<P;)U[l]=E=t[l].shift(),I=Math.min(I,E?E.length:I);Number.isFinite(I)&&(U=jA(n,I,U,t,_),I>0&&(u[v++]=_i({type:new Zn(n),length:I,nullCount:0,children:U.slice()})))}return[s=s.assign(n),u.map(j=>new as(s,j))]}function jA(s,t,n,u,_){var v;const I=(t+63&-64)>>3;for(let l=-1,P=u.length;++l<P;){const E=n[l],U=E==null?void 0:E.length;if(U>=t)U===t?n[l]=E:(n[l]=E.slice(0,t),_.numBatches=Math.max(_.numBatches,u[l].unshift(E.slice(t,U-t))));else{const j=s[l];s[l]=j.clone({nullable:!0}),n[l]=(v=E==null?void 0:E._changeLengthAndBackfillNullBitmap(t))!==null&&v!==void 0?v:_i({type:j.type,length:t,nullCount:t,nullBitmap:new Uint8Array(I)})}}return n}var xx;class Gn{constructor(...t){var n,u;if(t.length===0)return this.batches=[],this.schema=new Ui([]),this._offsets=[0],this;let _,v;t[0]instanceof Ui&&(_=t.shift()),t.at(-1)instanceof Uint32Array&&(v=t.pop());const I=P=>{if(P){if(P instanceof as)return[P];if(P instanceof Gn)return P.batches;if(P instanceof qi){if(P.type instanceof Zn)return[new as(new Ui(P.type.children),P)]}else{if(Array.isArray(P))return P.flatMap(E=>I(E));if(typeof P[Symbol.iterator]=="function")return[...P].flatMap(E=>I(E));if(typeof P=="object"){const E=Object.keys(P),U=E.map(tt=>new Ni([P[tt]])),j=_??new Ui(E.map((tt,ct)=>new gr(String(tt),U[ct].type,U[ct].nullable))),[,W]=Em(j,U);return W.length===0?[new as(P)]:W}}}return[]},l=t.flatMap(P=>I(P));if(_=(u=_??((n=l[0])===null||n===void 0?void 0:n.schema))!==null&&u!==void 0?u:new Ui([]),!(_ instanceof Ui))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");for(const P of l){if(!(P instanceof as))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");if(!sg(_,P.schema))throw new TypeError("Table and inner RecordBatch schemas must be equivalent.")}this.schema=_,this.batches=l,this._offsets=v??hx(this.data)}get data(){return this.batches.map(({data:t})=>t)}get numCols(){return this.schema.fields.length}get numRows(){return this.data.reduce((t,n)=>t+n.length,0)}get nullCount(){return this._nullCount===-1&&(this._nullCount=ux(this.data)),this._nullCount}isValid(t){return!1}get(t){return null}at(t){return this.get(zg(t,this.numRows))}set(t,n){}indexOf(t,n){return-1}[Symbol.iterator](){return this.batches.length>0?Og.visit(new Ni(this.data)):new Array(0)[Symbol.iterator]()}toArray(){return[...this]}toString(){return`[
  ${this.toArray().join(`,
  `)}
]`}concat(...t){const n=this.schema,u=this.data.concat(t.flatMap(({data:_})=>_));return new Gn(n,u.map(_=>new as(n,_)))}slice(t,n){const u=this.schema;[t,n]=lx({length:this.numRows},t,n);const _=dx(this.data,this._offsets,t,n);return new Gn(u,_.map(v=>new as(u,v)))}getChild(t){return this.getChildAt(this.schema.fields.findIndex(n=>n.name===t))}getChildAt(t){if(t>-1&&t<this.schema.fields.length){const n=this.data.map(u=>u.children[t]);if(n.length===0){const{type:u}=this.schema.fields[t],_=_i({type:u,length:0,nullCount:0});n.push(_._changeLengthAndBackfillNullBitmap(this.numRows))}return new Ni(n)}return null}setChild(t,n){var u;return this.setChildAt((u=this.schema.fields)===null||u===void 0?void 0:u.findIndex(_=>_.name===t),n)}setChildAt(t,n){let u=this.schema,_=[...this.batches];if(t>-1&&t<this.numCols){n||(n=new Ni([_i({type:new Ua,length:this.numRows})]));const v=u.fields.slice(),I=v[t].clone({type:n.type}),l=this.schema.fields.map((P,E)=>this.getChildAt(E));[v[t],l[t]]=[I,n],[u,_]=Em(u,l)}return new Gn(u,_)}select(t){const n=this.schema.fields.reduce((u,_,v)=>u.set(_.name,v),new Map);return this.selectAt(t.map(u=>n.get(u)).filter(u=>u>-1))}selectAt(t){const n=this.schema.selectAt(t),u=this.batches.map(_=>_.selectAt(t));return new Gn(n,u)}assign(t){const n=this.schema.fields,[u,_]=t.schema.fields.reduce((l,P,E)=>{const[U,j]=l,W=n.findIndex(tt=>tt.name===P.name);return~W?j[W]=E:U.push(E),l},[[],[]]),v=this.schema.assign(t.schema),I=[...n.map((l,P)=>[P,_[P]]).map(([l,P])=>P===void 0?this.getChildAt(l):t.getChildAt(P)),...u.map(l=>t.getChildAt(l))].filter(Boolean);return new Gn(...Em(v,I))}}xx=Symbol.toStringTag;Gn[xx]=(s=>(s.schema=null,s.batches=[],s._offsets=new Uint32Array([0]),s._nullCount=-1,s[Symbol.isConcatSpreadable]=!0,s.isValid=qp(Fg),s.get=qp(cs.getVisitFn(st.Struct)),s.set=px(Rs.getVisitFn(st.Struct)),s.indexOf=fx(Gp.getVisitFn(st.Struct)),"Table"))(Gn.prototype);var wx;let as=class ph{constructor(...t){switch(t.length){case 2:{if([this.schema]=t,!(this.schema instanceof Ui))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");if([,this.data=_i({nullCount:0,type:new Zn(this.schema.fields),children:this.schema.fields.map(n=>_i({type:n.type,nullCount:0}))})]=t,!(this.data instanceof qi))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");[this.schema,this.data]=T0(this.schema,this.data.children);break}case 1:{const[n]=t,{fields:u,children:_,length:v}=Object.keys(n).reduce((P,E,U)=>(P.children[U]=n[E],P.length=Math.max(P.length,n[E].length),P.fields[U]=gr.new({name:E,type:n[E].type,nullable:!0}),P),{length:0,fields:new Array,children:new Array}),I=new Ui(u),l=_i({type:new Zn(u),length:v,children:_,nullCount:0});[this.schema,this.data]=T0(I,l.children,v);break}default:throw new TypeError("RecordBatch constructor expects an Object mapping names to child Data, or a [Schema, Data] pair.")}}get dictionaries(){return this._dictionaries||(this._dictionaries=Sx(this.schema.fields,this.data.children))}get numCols(){return this.schema.fields.length}get numRows(){return this.data.length}get nullCount(){return this.data.nullCount}isValid(t){return this.data.getValid(t)}get(t){return cs.visit(this.data,t)}at(t){return this.get(zg(t,this.numRows))}set(t,n){return Rs.visit(this.data,t,n)}indexOf(t,n){return Gp.visit(this.data,t,n)}[Symbol.iterator](){return Og.visit(new Ni([this.data]))}toArray(){return[...this]}concat(...t){return new Gn(this.schema,[this,...t])}slice(t,n){const[u]=new Ni([this.data]).slice(t,n).data;return new ph(this.schema,u)}getChild(t){var n;return this.getChildAt((n=this.schema.fields)===null||n===void 0?void 0:n.findIndex(u=>u.name===t))}getChildAt(t){return t>-1&&t<this.schema.fields.length?new Ni([this.data.children[t]]):null}setChild(t,n){var u;return this.setChildAt((u=this.schema.fields)===null||u===void 0?void 0:u.findIndex(_=>_.name===t),n)}setChildAt(t,n){let u=this.schema,_=this.data;if(t>-1&&t<this.numCols){n||(n=new Ni([_i({type:new Ua,length:this.numRows})]));const v=u.fields.slice(),I=_.children.slice(),l=v[t].clone({type:n.type});[v[t],I[t]]=[l,n.data[0]],u=new Ui(v,new Map(this.schema.metadata)),_=_i({type:new Zn(v),children:I})}return new ph(u,_)}select(t){const n=this.schema.select(t),u=new Zn(n.fields),_=[];for(const v of t){const I=this.schema.fields.findIndex(l=>l.name===v);~I&&(_[I]=this.data.children[I])}return new ph(n,_i({type:u,length:this.numRows,children:_}))}selectAt(t){const n=this.schema.selectAt(t),u=t.map(v=>this.data.children[v]).filter(Boolean),_=_i({type:new Zn(n.fields),length:this.numRows,children:u});return new ph(n,_)}};wx=Symbol.toStringTag;as[wx]=(s=>(s._nullCount=-1,s[Symbol.isConcatSpreadable]=!0,"RecordBatch"))(as.prototype);function T0(s,t,n=t.reduce((u,_)=>Math.max(u,_.length),0)){var u;const _=[...s.fields],v=[...t],I=(n+63&-64)>>3;for(const[l,P]of s.fields.entries()){const E=t[l];(!E||E.length!==n)&&(_[l]=P.clone({nullable:!0}),v[l]=(u=E==null?void 0:E._changeLengthAndBackfillNullBitmap(n))!==null&&u!==void 0?u:_i({type:P.type,length:n,nullCount:n,nullBitmap:new Uint8Array(I)}))}return[s.assign(_),_i({type:new Zn(_),length:n,children:v})]}function Sx(s,t,n=new Map){var u,_;if(((u=s==null?void 0:s.length)!==null&&u!==void 0?u:0)>0&&(s==null?void 0:s.length)===(t==null?void 0:t.length))for(let v=-1,I=s.length;++v<I;){const{type:l}=s[v],P=t[v];for(const E of[P,...((_=P==null?void 0:P.dictionary)===null||_===void 0?void 0:_.data)||[]])Sx(l.children,E==null?void 0:E.children,n);if(Me.isDictionary(l)){const{id:E}=l;if(!n.has(E))P!=null&&P.dictionary&&n.set(E,P.dictionary);else if(n.get(E)!==P.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}}return n}class qg extends as{constructor(t){const n=t.fields.map(_=>_i({type:_.type})),u=_i({type:new Zn(t.fields),nullCount:0,children:n});super(t,u)}}let Ca=class go{constructor(){this.bb=null,this.bb_pos=0}__init(t,n){return this.bb_pos=t,this.bb=n,this}static getRootAsMessage(t,n){return(n||new go).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsMessage(t,n){return t.setPosition(t.position()+Vi),(n||new go).__init(t.readInt32(t.position())+t.position(),t)}version(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):$r.V1}headerType(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb_pos+t):Li.NONE}header(t){const n=this.bb.__offset(this.bb_pos,8);return n?this.bb.__union(t,this.bb_pos+n):null}bodyLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}customMetadata(t,n){const u=this.bb.__offset(this.bb_pos,12);return u?(n||new tn).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+u)+t*4),this.bb):null}customMetadataLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}static startMessage(t){t.startObject(5)}static addVersion(t,n){t.addFieldInt16(0,n,$r.V1)}static addHeaderType(t,n){t.addFieldInt8(1,n,Li.NONE)}static addHeader(t,n){t.addFieldOffset(2,n,0)}static addBodyLength(t,n){t.addFieldInt64(3,n,BigInt("0"))}static addCustomMetadata(t,n){t.addFieldOffset(4,n,0)}static createCustomMetadataVector(t,n){t.startVector(4,n.length,4);for(let u=n.length-1;u>=0;u--)t.addOffset(n[u]);return t.endVector()}static startCustomMetadataVector(t,n){t.startVector(4,n,4)}static endMessage(t){return t.endObject()}static finishMessageBuffer(t,n){t.finish(n)}static finishSizePrefixedMessageBuffer(t,n){t.finish(n,void 0,!0)}static createMessage(t,n,u,_,v,I){return go.startMessage(t),go.addVersion(t,n),go.addHeaderType(t,u),go.addHeader(t,_),go.addBodyLength(t,v),go.addCustomMetadata(t,I),go.endMessage(t)}};class qA extends fi{visit(t,n){return t==null||n==null?void 0:super.visit(t,n)}visitNull(t,n){return g0.startNull(n),g0.endNull(n)}visitInt(t,n){return gs.startInt(n),gs.addBitWidth(n,t.bitWidth),gs.addIsSigned(n,t.isSigned),gs.endInt(n)}visitFloat(t,n){return xo.startFloatingPoint(n),xo.addPrecision(n,t.precision),xo.endFloatingPoint(n)}visitBinary(t,n){return h0.startBinary(n),h0.endBinary(n)}visitLargeBinary(t,n){return p0.startLargeBinary(n),p0.endLargeBinary(n)}visitBool(t,n){return d0.startBool(n),d0.endBool(n)}visitUtf8(t,n){return y0.startUtf8(n),y0.endUtf8(n)}visitLargeUtf8(t,n){return f0.startLargeUtf8(n),f0.endLargeUtf8(n)}visitDecimal(t,n){return yc.startDecimal(n),yc.addScale(n,t.scale),yc.addPrecision(n,t.precision),yc.addBitWidth(n,t.bitWidth),yc.endDecimal(n)}visitDate(t,n){return ip.startDate(n),ip.addUnit(n,t.unit),ip.endDate(n)}visitTime(t,n){return Ps.startTime(n),Ps.addUnit(n,t.unit),Ps.addBitWidth(n,t.bitWidth),Ps.endTime(n)}visitTimestamp(t,n){const u=t.timezone&&n.createString(t.timezone)||void 0;return Ls.startTimestamp(n),Ls.addUnit(n,t.unit),u!==void 0&&Ls.addTimezone(n,u),Ls.endTimestamp(n)}visitInterval(t,n){return wo.startInterval(n),wo.addUnit(n,t.unit),wo.endInterval(n)}visitDuration(t,n){return rp.startDuration(n),rp.addUnit(n,t.unit),rp.endDuration(n)}visitList(t,n){return m0.startList(n),m0.endList(n)}visitStruct(t,n){return _l.startStruct_(n),_l.endStruct_(n)}visitUnion(t,n){os.startTypeIdsVector(n,t.typeIds.length);const u=os.createTypeIdsVector(n,t.typeIds);return os.startUnion(n),os.addMode(n,t.mode),os.addTypeIds(n,u),os.endUnion(n)}visitDictionary(t,n){const u=this.visit(t.indices,n);return ia.startDictionaryEncoding(n),ia.addId(n,BigInt(t.id)),ia.addIsOrdered(n,t.isOrdered),u!==void 0&&ia.addIndexType(n,u),ia.endDictionaryEncoding(n)}visitFixedSizeBinary(t,n){return np.startFixedSizeBinary(n),np.addByteWidth(n,t.byteWidth),np.endFixedSizeBinary(n)}visitFixedSizeList(t,n){return sp.startFixedSizeList(n),sp.addListSize(n,t.listSize),sp.endFixedSizeList(n)}visitMap(t,n){return op.startMap(n),op.addKeysSorted(n,t.keysSorted),op.endMap(n)}}const Cm=new qA;function GA(s,t=new Map){return new Ui(WA(s,t),cp(s.metadata),t)}function Ix(s){return new _s(s.count,Tx(s.columns),kx(s.columns))}function ZA(s){return new Eo(Ix(s.data),s.id,s.isDelta)}function WA(s,t){return(s.fields||[]).filter(Boolean).map(n=>gr.fromJSON(n,t))}function k0(s,t){return(s.children||[]).filter(Boolean).map(n=>gr.fromJSON(n,t))}function Tx(s){return(s||[]).reduce((t,n)=>[...t,new ja(n.count,HA(n.VALIDITY)),...Tx(n.children)],[])}function kx(s,t=[]){for(let n=-1,u=(s||[]).length;++n<u;){const _=s[n];_.VALIDITY&&t.push(new Io(t.length,_.VALIDITY.length)),_.TYPE_ID&&t.push(new Io(t.length,_.TYPE_ID.length)),_.OFFSET&&t.push(new Io(t.length,_.OFFSET.length)),_.DATA&&t.push(new Io(t.length,_.DATA.length)),t=kx(_.children,t)}return t}function HA(s){return(s||[]).reduce((t,n)=>t+ +(n===0),0)}function YA(s,t){let n,u,_,v,I,l;return!t||!(v=s.dictionary)?(I=E0(s,k0(s,t)),_=new gr(s.name,I,s.nullable,cp(s.metadata))):t.has(n=v.id)?(u=(u=v.indexType)?A0(u):new wh,l=new Vc(t.get(n),u,n,v.isOrdered),_=new gr(s.name,l,s.nullable,cp(s.metadata))):(u=(u=v.indexType)?A0(u):new wh,t.set(n,I=E0(s,k0(s,t))),l=new Vc(I,u,n,v.isOrdered),_=new gr(s.name,l,s.nullable,cp(s.metadata))),_||null}function cp(s=[]){return new Map(s.map(({key:t,value:n})=>[t,n]))}function A0(s){return new kl(s.isSigned,s.bitWidth)}function E0(s,t){const n=s.type.name;switch(n){case"NONE":return new Ua;case"null":return new Ua;case"binary":return new kp;case"largebinary":return new Ap;case"utf8":return new Ep;case"largeutf8":return new Cp;case"bool":return new Mp;case"list":return new Fp((t||[])[0]);case"struct":return new Zn(t||[]);case"struct_":return new Zn(t||[])}switch(n){case"int":{const u=s.type;return new kl(u.isSigned,u.bitWidth)}case"floatingpoint":{const u=s.type;return new Tp(Ln[u.precision])}case"decimal":{const u=s.type;return new Dp(u.scale,u.precision,u.bitWidth)}case"date":{const u=s.type;return new Pp(Bs[u.unit])}case"time":{const u=s.type;return new Lp($e[u.unit],u.bitWidth)}case"timestamp":{const u=s.type;return new zp($e[u.unit],u.timezone)}case"interval":{const u=s.type;return new Bp(Ao[u.unit])}case"duration":{const u=s.type;return new Rp($e[u.unit])}case"union":{const u=s.type,[_,...v]=(u.mode+"").toLowerCase(),I=_.toUpperCase()+v.join("");return new Op(zn[I],u.typeIds||[],t||[])}case"fixedsizebinary":{const u=s.type;return new Np(u.byteWidth)}case"fixedsizelist":{const u=s.type;return new Up(u.listSize,(t||[])[0])}case"map":{const u=s.type;return new Vp((t||[])[0],u.keysSorted)}}throw new Error(`Unrecognized type: "${n}"`)}var KA=$v,XA=Nc;class Wn{static fromJSON(t,n){const u=new Wn(0,$r.V5,n);return u._createHeader=JA(t,n),u}static decode(t){t=new XA(Ti(t));const n=Ca.getRootAsMessage(t),u=n.bodyLength(),_=n.version(),v=n.headerType(),I=new Wn(u,_,v);return I._createHeader=QA(n,v),I}static encode(t){const n=new KA;let u=-1;return t.isSchema()?u=Ui.encode(n,t.header()):t.isRecordBatch()?u=_s.encode(n,t.header()):t.isDictionaryBatch()&&(u=Eo.encode(n,t.header())),Ca.startMessage(n),Ca.addVersion(n,$r.V5),Ca.addHeader(n,u),Ca.addHeaderType(n,t.headerType),Ca.addBodyLength(n,BigInt(t.bodyLength)),Ca.finishMessageBuffer(n,Ca.endMessage(n)),n.asUint8Array()}static from(t,n=0){if(t instanceof Ui)return new Wn(0,$r.V5,Li.Schema,t);if(t instanceof _s)return new Wn(n,$r.V5,Li.RecordBatch,t);if(t instanceof Eo)return new Wn(n,$r.V5,Li.DictionaryBatch,t);throw new Error(`Unrecognized Message header: ${t}`)}get type(){return this.headerType}get version(){return this._version}get headerType(){return this._headerType}get bodyLength(){return this._bodyLength}header(){return this._createHeader()}isSchema(){return this.headerType===Li.Schema}isRecordBatch(){return this.headerType===Li.RecordBatch}isDictionaryBatch(){return this.headerType===Li.DictionaryBatch}constructor(t,n,u,_){this._version=n,this._headerType=u,this.body=new Uint8Array(0),_&&(this._createHeader=()=>_),this._bodyLength=er(t)}}class _s{get nodes(){return this._nodes}get length(){return this._length}get buffers(){return this._buffers}constructor(t,n,u){this._nodes=n,this._buffers=u,this._length=er(t)}}class Eo{get id(){return this._id}get data(){return this._data}get isDelta(){return this._isDelta}get length(){return this.data.length}get nodes(){return this.data.nodes}get buffers(){return this.data.buffers}constructor(t,n,u=!1){this._data=t,this._isDelta=u,this._id=er(n)}}class Io{constructor(t,n){this.offset=er(t),this.length=er(n)}}class ja{constructor(t,n){this.length=er(t),this.nullCount=er(n)}}function JA(s,t){return()=>{switch(t){case Li.Schema:return Ui.fromJSON(s);case Li.RecordBatch:return _s.fromJSON(s);case Li.DictionaryBatch:return Eo.fromJSON(s)}throw new Error(`Unrecognized Message type: { name: ${Li[t]}, type: ${t} }`)}}function QA(s,t){return()=>{switch(t){case Li.Schema:return Ui.decode(s.header(new yo),new Map,s.version());case Li.RecordBatch:return _s.decode(s.header(new Xo),s.version());case Li.DictionaryBatch:return Eo.decode(s.header(new mc),s.version())}throw new Error(`Unrecognized Message type: { name: ${Li[t]}, type: ${t} }`)}}gr.encode=uE;gr.decode=lE;gr.fromJSON=YA;Ui.encode=cE;Ui.decode=tE;Ui.fromJSON=GA;_s.encode=hE;_s.decode=eE;_s.fromJSON=Ix;Eo.encode=dE;Eo.decode=iE;Eo.fromJSON=ZA;ja.encode=pE;ja.decode=nE;Io.encode=fE;Io.decode=rE;function tE(s,t=new Map,n=$r.V5){const u=aE(s,t);return new Ui(u,up(s),t,n)}function eE(s,t=$r.V5){if(s.compression()!==null)throw new Error("Record batch compression not implemented");return new _s(s.length(),sE(s),oE(s,t))}function iE(s,t=$r.V5){return new Eo(_s.decode(s.data(),t),s.id(),s.isDelta())}function rE(s){return new Io(s.offset(),s.length())}function nE(s){return new ja(s.length(),s.nullCount())}function sE(s){const t=[];for(let n,u=-1,_=-1,v=s.nodesLength();++u<v;)(n=s.nodes(u))&&(t[++_]=ja.decode(n));return t}function oE(s,t){const n=[];for(let u,_=-1,v=-1,I=s.buffersLength();++_<I;)(u=s.buffers(_))&&(t<$r.V4&&(u.bb_pos+=8*(_+1)),n[++v]=Io.decode(u));return n}function aE(s,t){const n=[];for(let u,_=-1,v=-1,I=s.fieldsLength();++_<I;)(u=s.fields(_))&&(n[++v]=gr.decode(u,t));return n}function C0(s,t){const n=[];for(let u,_=-1,v=-1,I=s.childrenLength();++_<I;)(u=s.children(_))&&(n[++v]=gr.decode(u,t));return n}function lE(s,t){let n,u,_,v,I,l;return!t||!(l=s.dictionary())?(_=D0(s,C0(s,t)),u=new gr(s.name(),_,s.nullable(),up(s))):t.has(n=er(l.id()))?(v=(v=l.indexType())?M0(v):new wh,I=new Vc(t.get(n),v,n,l.isOrdered()),u=new gr(s.name(),I,s.nullable(),up(s))):(v=(v=l.indexType())?M0(v):new wh,t.set(n,_=D0(s,C0(s,t))),I=new Vc(_,v,n,l.isOrdered()),u=new gr(s.name(),I,s.nullable(),up(s))),u||null}function up(s){const t=new Map;if(s)for(let n,u,_=-1,v=Math.trunc(s.customMetadataLength());++_<v;)(n=s.customMetadata(_))&&(u=n.key())!=null&&t.set(u,n.value());return t}function M0(s){return new kl(s.isSigned(),s.bitWidth())}function D0(s,t){const n=s.typeType();switch(n){case ar.NONE:return new Ua;case ar.Null:return new Ua;case ar.Binary:return new kp;case ar.LargeBinary:return new Ap;case ar.Utf8:return new Ep;case ar.LargeUtf8:return new Cp;case ar.Bool:return new Mp;case ar.List:return new Fp((t||[])[0]);case ar.Struct_:return new Zn(t||[])}switch(n){case ar.Int:{const u=s.type(new gs);return new kl(u.isSigned(),u.bitWidth())}case ar.FloatingPoint:{const u=s.type(new xo);return new Tp(u.precision())}case ar.Decimal:{const u=s.type(new yc);return new Dp(u.scale(),u.precision(),u.bitWidth())}case ar.Date:{const u=s.type(new ip);return new Pp(u.unit())}case ar.Time:{const u=s.type(new Ps);return new Lp(u.unit(),u.bitWidth())}case ar.Timestamp:{const u=s.type(new Ls);return new zp(u.unit(),u.timezone())}case ar.Interval:{const u=s.type(new wo);return new Bp(u.unit())}case ar.Duration:{const u=s.type(new rp);return new Rp(u.unit())}case ar.Union:{const u=s.type(new os);return new Op(u.mode(),u.typeIdsArray()||[],t||[])}case ar.FixedSizeBinary:{const u=s.type(new np);return new Np(u.byteWidth())}case ar.FixedSizeList:{const u=s.type(new sp);return new Up(u.listSize(),(t||[])[0])}case ar.Map:{const u=s.type(new op);return new Vp((t||[])[0],u.keysSorted())}}throw new Error(`Unrecognized type: "${ar[n]}" (${n})`)}function cE(s,t){const n=t.fields.map(v=>gr.encode(s,v));yo.startFieldsVector(s,n.length);const u=yo.createFieldsVector(s,n),_=t.metadata&&t.metadata.size>0?yo.createCustomMetadataVector(s,[...t.metadata].map(([v,I])=>{const l=s.createString(`${v}`),P=s.createString(`${I}`);return tn.startKeyValue(s),tn.addKey(s,l),tn.addValue(s,P),tn.endKeyValue(s)})):-1;return yo.startSchema(s),yo.addFields(s,u),yo.addEndianness(s,mE?Uc.Little:Uc.Big),_!==-1&&yo.addCustomMetadata(s,_),yo.endSchema(s)}function uE(s,t){let n=-1,u=-1,_=-1;const v=t.type;let I=t.typeId;Me.isDictionary(v)?(I=v.dictionary.typeId,_=Cm.visit(v,s),u=Cm.visit(v.dictionary,s)):u=Cm.visit(v,s);const l=(v.children||[]).map(U=>gr.encode(s,U)),P=Ms.createChildrenVector(s,l),E=t.metadata&&t.metadata.size>0?Ms.createCustomMetadataVector(s,[...t.metadata].map(([U,j])=>{const W=s.createString(`${U}`),tt=s.createString(`${j}`);return tn.startKeyValue(s),tn.addKey(s,W),tn.addValue(s,tt),tn.endKeyValue(s)})):-1;return t.name&&(n=s.createString(t.name)),Ms.startField(s),Ms.addType(s,u),Ms.addTypeType(s,I),Ms.addChildren(s,P),Ms.addNullable(s,!!t.nullable),n!==-1&&Ms.addName(s,n),_!==-1&&Ms.addDictionary(s,_),E!==-1&&Ms.addCustomMetadata(s,E),Ms.endField(s)}function hE(s,t){const n=t.nodes||[],u=t.buffers||[];Xo.startNodesVector(s,n.length);for(const I of n.slice().reverse())ja.encode(s,I);const _=s.endVector();Xo.startBuffersVector(s,u.length);for(const I of u.slice().reverse())Io.encode(s,I);const v=s.endVector();return Xo.startRecordBatch(s),Xo.addLength(s,BigInt(t.length)),Xo.addNodes(s,_),Xo.addBuffers(s,v),Xo.endRecordBatch(s)}function dE(s,t){const n=_s.encode(s,t.data);return mc.startDictionaryBatch(s),mc.addId(s,BigInt(t.id)),mc.addIsDelta(s,t.isDelta),mc.addData(s,n),mc.endDictionaryBatch(s)}function pE(s,t){return Gv.createFieldNode(s,BigInt(t.length),BigInt(t.nullCount))}function fE(s,t){return qv.createBuffer(s,BigInt(t.offset),BigInt(t.length))}const mE=(()=>{const s=new ArrayBuffer(2);return new DataView(s).setInt16(0,256,!0),new Int16Array(s)[0]===256})(),Gg=s=>`Expected ${Li[s]} Message in stream, but was null or length 0.`,Zg=s=>`Header pointer of flatbuffer-encoded ${Li[s]} Message is null or length 0.`,Ax=(s,t)=>`Expected to read ${s} metadata bytes, but only read ${t}.`,Ex=(s,t)=>`Expected to read ${s} bytes for message body, but only read ${t}.`;class Cx{constructor(t){this.source=t instanceof Wp?t:new Wp(t)}[Symbol.iterator](){return this}next(){let t;return(t=this.readMetadataLength()).done||t.value===-1&&(t=this.readMetadataLength()).done||(t=this.readMetadata(t.value)).done?Tr:t}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}readMessage(t){let n;if((n=this.next()).done)return null;if(t!=null&&n.value.headerType!==t)throw new Error(Gg(t));return n.value}readMessageBody(t){if(t<=0)return new Uint8Array(0);const n=Ti(this.source.read(t));if(n.byteLength<t)throw new Error(Ex(t,n.byteLength));return n.byteOffset%8===0&&n.byteOffset+n.byteLength<=n.buffer.byteLength?n:n.slice()}readSchema(t=!1){const n=Li.Schema,u=this.readMessage(n),_=u==null?void 0:u.header();if(t&&!_)throw new Error(Zg(n));return _}readMetadataLength(){const t=this.source.read(hf),n=t&&new Nc(t),u=(n==null?void 0:n.readInt32(0))||0;return{done:u===0,value:u}}readMetadata(t){const n=this.source.read(t);if(!n)return Tr;if(n.byteLength<t)throw new Error(Ax(t,n.byteLength));return{done:!1,value:Wn.decode(n)}}}class gE{constructor(t,n){this.source=t instanceof $c?t:Rv(t)?new Hp(t,n):new $c(t)}[Symbol.asyncIterator](){return this}next(){return Qe(this,void 0,void 0,function*(){let t;return(t=yield this.readMetadataLength()).done||t.value===-1&&(t=yield this.readMetadataLength()).done||(t=yield this.readMetadata(t.value)).done?Tr:t})}throw(t){return Qe(this,void 0,void 0,function*(){return yield this.source.throw(t)})}return(t){return Qe(this,void 0,void 0,function*(){return yield this.source.return(t)})}readMessage(t){return Qe(this,void 0,void 0,function*(){let n;if((n=yield this.next()).done)return null;if(t!=null&&n.value.headerType!==t)throw new Error(Gg(t));return n.value})}readMessageBody(t){return Qe(this,void 0,void 0,function*(){if(t<=0)return new Uint8Array(0);const n=Ti(yield this.source.read(t));if(n.byteLength<t)throw new Error(Ex(t,n.byteLength));return n.byteOffset%8===0&&n.byteOffset+n.byteLength<=n.buffer.byteLength?n:n.slice()})}readSchema(){return Qe(this,arguments,void 0,function*(t=!1){const n=Li.Schema,u=yield this.readMessage(n),_=u==null?void 0:u.header();if(t&&!_)throw new Error(Zg(n));return _})}readMetadataLength(){return Qe(this,void 0,void 0,function*(){const t=yield this.source.read(hf),n=t&&new Nc(t),u=(n==null?void 0:n.readInt32(0))||0;return{done:u===0,value:u}})}readMetadata(t){return Qe(this,void 0,void 0,function*(){const n=yield this.source.read(t);if(!n)return Tr;if(n.byteLength<t)throw new Error(Ax(t,n.byteLength));return{done:!1,value:Wn.decode(n)}})}}class yE extends Cx{constructor(t){super(new Uint8Array(0)),this._schema=!1,this._body=[],this._batchIndex=0,this._dictionaryIndex=0,this._json=t instanceof S0?t:new S0(t)}next(){const{_json:t}=this;if(!this._schema)return this._schema=!0,{done:!1,value:Wn.fromJSON(t.schema,Li.Schema)};if(this._dictionaryIndex<t.dictionaries.length){const n=t.dictionaries[this._dictionaryIndex++];return this._body=n.data.columns,{done:!1,value:Wn.fromJSON(n,Li.DictionaryBatch)}}if(this._batchIndex<t.batches.length){const n=t.batches[this._batchIndex++];return this._body=n.columns,{done:!1,value:Wn.fromJSON(n,Li.RecordBatch)}}return this._body=[],Tr}readMessageBody(t){return n(this._body);function n(u){return(u||[]).reduce((_,v)=>[..._,...v.VALIDITY&&[v.VALIDITY]||[],...v.TYPE_ID&&[v.TYPE_ID]||[],...v.OFFSET&&[v.OFFSET]||[],...v.DATA&&[v.DATA]||[],...n(v.children)],[])}}readMessage(t){let n;if((n=this.next()).done)return null;if(t!=null&&n.value.headerType!==t)throw new Error(Gg(t));return n.value}readSchema(){const t=Li.Schema,n=this.readMessage(t),u=n==null?void 0:n.header();if(!n||!u)throw new Error(Zg(t));return u}}const hf=4,og="ARROW1",Ih=new Uint8Array(og.length);for(let s=0;s<og.length;s+=1)Ih[s]=og.codePointAt(s);function Wg(s,t=0){for(let n=-1,u=Ih.length;++n<u;)if(Ih[n]!==s[t+n])return!1;return!0}const Bh=Ih.length,Mx=Bh+hf,_E=Bh*2+hf;class zs extends Ng{constructor(t){super(),this._impl=t}get closed(){return this._impl.closed}get schema(){return this._impl.schema}get autoDestroy(){return this._impl.autoDestroy}get dictionaries(){return this._impl.dictionaries}get numDictionaries(){return this._impl.numDictionaries}get numRecordBatches(){return this._impl.numRecordBatches}get footer(){return this._impl.isFile()?this._impl.footer:null}isSync(){return this._impl.isSync()}isAsync(){return this._impl.isAsync()}isFile(){return this._impl.isFile()}isStream(){return this._impl.isStream()}next(){return this._impl.next()}throw(t){return this._impl.throw(t)}return(t){return this._impl.return(t)}cancel(){return this._impl.cancel()}reset(t){return this._impl.reset(t),this._DOMStream=void 0,this._nodeStream=void 0,this}open(t){const n=this._impl.open(t);return Tl(n)?n.then(()=>this):this}readRecordBatch(t){return this._impl.isFile()?this._impl.readRecordBatch(t):null}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}toDOMStream(){return Ds.toDOMStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this})}toNodeStream(){return Ds.toNodeStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this},{objectMode:!0})}static throughNode(t){throw new Error('"throughNode" not available in this environment')}static throughDOM(t,n){throw new Error('"throughDOM" not available in this environment')}static from(t){return t instanceof zs?t:Km(t)?wE(t):Rv(t)?TE(t):Tl(t)?Qe(this,void 0,void 0,function*(){return yield zs.from(yield t)}):Fv(t)||Eg(t)||Ov(t)||Wc(t)?IE(new $c(t)):SE(new Wp(t))}static readAll(t){return t instanceof zs?t.isSync()?P0(t):L0(t):Km(t)||ArrayBuffer.isView(t)||Dh(t)||Bv(t)?P0(t):L0(t)}}class Yp extends zs{constructor(t){super(t),this._impl=t}readAll(){return[...this]}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return So(this,arguments,function*(){yield li(yield*ep(xl(this[Symbol.iterator]())))})}}class Kp extends zs{constructor(t){super(t),this._impl=t}readAll(){return Qe(this,void 0,void 0,function*(){var t,n,u,_;const v=new Array;try{for(var I=!0,l=xl(this),P;P=yield l.next(),t=P.done,!t;I=!0){_=P.value,I=!1;const E=_;v.push(E)}}catch(E){n={error:E}}finally{try{!I&&!t&&(u=l.return)&&(yield u.call(l))}finally{if(n)throw n.error}}return v})}[Symbol.iterator](){throw new Error("AsyncRecordBatchStreamReader is not Iterable")}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}}class Dx extends Yp{constructor(t){super(t),this._impl=t}}class vE extends Kp{constructor(t){super(t),this._impl=t}}class Px{get numDictionaries(){return this._dictionaryIndex}get numRecordBatches(){return this._recordBatchIndex}constructor(t=new Map){this.closed=!1,this.autoDestroy=!0,this._dictionaryIndex=0,this._recordBatchIndex=0,this.dictionaries=t}isSync(){return!1}isAsync(){return!1}isFile(){return!1}isStream(){return!1}reset(t){return this._dictionaryIndex=0,this._recordBatchIndex=0,this.schema=t,this.dictionaries=new Map,this}_loadRecordBatch(t,n){const u=this._loadVectors(t,n,this.schema.fields),_=_i({type:new Zn(this.schema.fields),length:t.length,children:u});return new as(this.schema,_)}_loadDictionaryBatch(t,n){const{id:u,isDelta:_}=t,{dictionaries:v,schema:I}=this,l=v.get(u),P=I.dictionaries.get(u),E=this._loadVectors(t.data,n,[P]);return(l&&_?l.concat(new Ni(E)):new Ni(E)).memoize()}_loadVectors(t,n,u){return new bx(n,t.nodes,t.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(u)}}class Xp extends Px{constructor(t,n){super(n),this._reader=Km(t)?new yE(this._handle=t):new Cx(this._handle=t)}isSync(){return!0}isStream(){return!0}[Symbol.iterator](){return this}cancel(){!this.closed&&(this.closed=!0)&&(this.reset()._reader.return(),this._reader=null,this.dictionaries=null)}open(t){return this.closed||(this.autoDestroy=zx(this,t),this.schema||(this.schema=this._reader.readSchema())||this.cancel()),this}throw(t){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.throw(t):Tr}return(t){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.return(t):Tr}next(){if(this.closed)return Tr;let t;const{_reader:n}=this;for(;t=this._readNextMessageAndValidate();)if(t.isSchema())this.reset(t.header());else if(t.isRecordBatch()){this._recordBatchIndex++;const u=t.header(),_=n.readMessageBody(t.bodyLength);return{done:!1,value:this._loadRecordBatch(u,_)}}else if(t.isDictionaryBatch()){this._dictionaryIndex++;const u=t.header(),_=n.readMessageBody(t.bodyLength),v=this._loadDictionaryBatch(u,_);this.dictionaries.set(u.id,v)}return this.schema&&this._recordBatchIndex===0?(this._recordBatchIndex++,{done:!1,value:new qg(this.schema)}):this.return()}_readNextMessageAndValidate(t){return this._reader.readMessage(t)}}class Jp extends Px{constructor(t,n){super(n),this._reader=new gE(this._handle=t)}isAsync(){return!0}isStream(){return!0}[Symbol.asyncIterator](){return this}cancel(){return Qe(this,void 0,void 0,function*(){!this.closed&&(this.closed=!0)&&(yield this.reset()._reader.return(),this._reader=null,this.dictionaries=null)})}open(t){return Qe(this,void 0,void 0,function*(){return this.closed||(this.autoDestroy=zx(this,t),this.schema||(this.schema=yield this._reader.readSchema())||(yield this.cancel())),this})}throw(t){return Qe(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.throw(t):Tr})}return(t){return Qe(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.return(t):Tr})}next(){return Qe(this,void 0,void 0,function*(){if(this.closed)return Tr;let t;const{_reader:n}=this;for(;t=yield this._readNextMessageAndValidate();)if(t.isSchema())yield this.reset(t.header());else if(t.isRecordBatch()){this._recordBatchIndex++;const u=t.header(),_=yield n.readMessageBody(t.bodyLength);return{done:!1,value:this._loadRecordBatch(u,_)}}else if(t.isDictionaryBatch()){this._dictionaryIndex++;const u=t.header(),_=yield n.readMessageBody(t.bodyLength),v=this._loadDictionaryBatch(u,_);this.dictionaries.set(u.id,v)}return this.schema&&this._recordBatchIndex===0?(this._recordBatchIndex++,{done:!1,value:new qg(this.schema)}):yield this.return()})}_readNextMessageAndValidate(t){return Qe(this,void 0,void 0,function*(){return yield this._reader.readMessage(t)})}}class Lx extends Xp{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(t,n){super(t instanceof I0?t:new I0(t),n)}isSync(){return!0}isFile(){return!0}open(t){if(!this.closed&&!this._footer){this.schema=(this._footer=this._readFooter()).schema;for(const n of this._footer.dictionaryBatches())n&&this._readDictionaryBatch(this._dictionaryIndex++)}return super.open(t)}readRecordBatch(t){var n;if(this.closed)return null;this._footer||this.open();const u=(n=this._footer)===null||n===void 0?void 0:n.getRecordBatch(t);if(u&&this._handle.seek(u.offset)){const _=this._reader.readMessage(Li.RecordBatch);if(_!=null&&_.isRecordBatch()){const v=_.header(),I=this._reader.readMessageBody(_.bodyLength);return this._loadRecordBatch(v,I)}}return null}_readDictionaryBatch(t){var n;const u=(n=this._footer)===null||n===void 0?void 0:n.getDictionaryBatch(t);if(u&&this._handle.seek(u.offset)){const _=this._reader.readMessage(Li.DictionaryBatch);if(_!=null&&_.isDictionaryBatch()){const v=_.header(),I=this._reader.readMessageBody(_.bodyLength),l=this._loadDictionaryBatch(v,I);this.dictionaries.set(v.id,l)}}}_readFooter(){const{_handle:t}=this,n=t.size-Mx,u=t.readInt32(n),_=t.readAt(n-u,u);return Sh.decode(_)}_readNextMessageAndValidate(t){var n;if(this._footer||this.open(),this._footer&&this._recordBatchIndex<this.numRecordBatches){const u=(n=this._footer)===null||n===void 0?void 0:n.getRecordBatch(this._recordBatchIndex);if(u&&this._handle.seek(u.offset))return this._reader.readMessage(t)}return null}}class bE extends Jp{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(t,...n){const u=typeof n[0]!="number"?n.shift():void 0,_=n[0]instanceof Map?n.shift():void 0;super(t instanceof Hp?t:new Hp(t,u),_)}isFile(){return!0}isAsync(){return!0}open(t){const n=Object.create(null,{open:{get:()=>super.open}});return Qe(this,void 0,void 0,function*(){if(!this.closed&&!this._footer){this.schema=(this._footer=yield this._readFooter()).schema;for(const u of this._footer.dictionaryBatches())u&&(yield this._readDictionaryBatch(this._dictionaryIndex++))}return yield n.open.call(this,t)})}readRecordBatch(t){return Qe(this,void 0,void 0,function*(){var n;if(this.closed)return null;this._footer||(yield this.open());const u=(n=this._footer)===null||n===void 0?void 0:n.getRecordBatch(t);if(u&&(yield this._handle.seek(u.offset))){const _=yield this._reader.readMessage(Li.RecordBatch);if(_!=null&&_.isRecordBatch()){const v=_.header(),I=yield this._reader.readMessageBody(_.bodyLength);return this._loadRecordBatch(v,I)}}return null})}_readDictionaryBatch(t){return Qe(this,void 0,void 0,function*(){var n;const u=(n=this._footer)===null||n===void 0?void 0:n.getDictionaryBatch(t);if(u&&(yield this._handle.seek(u.offset))){const _=yield this._reader.readMessage(Li.DictionaryBatch);if(_!=null&&_.isDictionaryBatch()){const v=_.header(),I=yield this._reader.readMessageBody(_.bodyLength),l=this._loadDictionaryBatch(v,I);this.dictionaries.set(v.id,l)}}})}_readFooter(){return Qe(this,void 0,void 0,function*(){const{_handle:t}=this;t._pending&&(yield t._pending);const n=t.size-Mx,u=yield t.readInt32(n),_=yield t.readAt(n-u,u);return Sh.decode(_)})}_readNextMessageAndValidate(t){return Qe(this,void 0,void 0,function*(){if(this._footer||(yield this.open()),this._footer&&this._recordBatchIndex<this.numRecordBatches){const n=this._footer.getRecordBatch(this._recordBatchIndex);if(n&&(yield this._handle.seek(n.offset)))return yield this._reader.readMessage(t)}return null})}}class xE extends Xp{constructor(t,n){super(t,n)}_loadVectors(t,n,u){return new zA(n,t.nodes,t.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(u)}}function zx(s,t){return t&&typeof t.autoDestroy=="boolean"?t.autoDestroy:s.autoDestroy}function*P0(s){const t=zs.from(s);try{if(!t.open({autoDestroy:!1}).closed)do yield t;while(!t.reset().open().closed)}finally{t.cancel()}}function L0(s){return So(this,arguments,function*(){const n=yield li(zs.from(s));try{if(!(yield li(n.open({autoDestroy:!1}))).closed)do yield yield li(n);while(!(yield li(n.reset().open())).closed)}finally{yield li(n.cancel())}})}function wE(s){return new Yp(new xE(s))}function SE(s){const t=s.peek(Bh+7&-8);return t&&t.byteLength>=4?Wg(t)?new Dx(new Lx(s.read())):new Yp(new Xp(s)):new Yp(new Xp(function*(){}()))}function IE(s){return Qe(this,void 0,void 0,function*(){const t=yield s.peek(Bh+7&-8);return t&&t.byteLength>=4?Wg(t)?new Dx(new Lx(yield s.read())):new Kp(new Jp(s)):new Kp(new Jp(function(){return So(this,arguments,function*(){})}()))})}function TE(s){return Qe(this,void 0,void 0,function*(){const{size:t}=yield s.stat(),n=new Hp(s,t);return t>=_E&&Wg(yield n.readAt(0,Bh+7&-8))?new vE(new bE(n)):new Kp(new Jp(n))})}class kr extends fi{static assemble(...t){const n=_=>_.flatMap(v=>Array.isArray(v)?n(v):v instanceof as?v.data.children:v.data),u=new kr;return u.visitMany(n(t)),u}constructor(){super(),this._byteLength=0,this._nodes=[],this._buffers=[],this._bufferRegions=[]}visit(t){if(t instanceof Ni)return this.visitMany(t.data),this;const{type:n}=t;if(!Me.isDictionary(n)){const{length:u}=t;if(u>2147483647)throw new RangeError("Cannot write arrays larger than 2^31 - 1 in length");if(Me.isUnion(n))this.nodes.push(new ja(u,0));else{const{nullCount:_}=t;Me.isNull(n)||Qs.call(this,_<=0?new Uint8Array(0):$p(t.offset,u,t.nullBitmap)),this.nodes.push(new ja(u,_))}}return super.visit(t)}visitNull(t){return this}visitDictionary(t){return this.visit(t.clone(t.type.indices))}get nodes(){return this._nodes}get buffers(){return this._buffers}get byteLength(){return this._byteLength}get bufferRegions(){return this._bufferRegions}}function Qs(s){const t=s.byteLength+7&-8;return this.buffers.push(s),this.bufferRegions.push(new Io(this._byteLength,t)),this._byteLength+=t,this}function kE(s){var t;const{type:n,length:u,typeIds:_,valueOffsets:v}=s;if(Qs.call(this,_),n.mode===zn.Sparse)return ag.call(this,s);if(n.mode===zn.Dense){if(s.offset<=0)return Qs.call(this,v),ag.call(this,s);{const I=new Int32Array(u),l=Object.create(null),P=Object.create(null);for(let E,U,j=-1;++j<u;)(E=_[j])!==void 0&&((U=l[E])===void 0&&(U=l[E]=v[j]),I[j]=v[j]-U,P[E]=((t=P[E])!==null&&t!==void 0?t:0)+1);Qs.call(this,I),this.visitMany(s.children.map((E,U)=>{const j=n.typeIds[U],W=l[j],tt=P[j];return E.slice(W,Math.min(u,tt))}))}}return this}function AE(s){let t;return s.nullCount>=s.length?Qs.call(this,new Uint8Array(0)):(t=s.values)instanceof Uint8Array?Qs.call(this,$p(s.offset,s.length,t)):Qs.call(this,jp(s.values))}function oa(s){return Qs.call(this,s.values.subarray(0,s.length*s.stride))}function df(s){const{length:t,values:n,valueOffsets:u}=s,_=er(u[0]),v=er(u[t]),I=Math.min(v-_,n.byteLength-_);return Qs.call(this,Uv(-_,t+1,u)),Qs.call(this,n.subarray(_,_+I)),this}function Hg(s){const{length:t,valueOffsets:n}=s;if(n){const{[0]:u,[t]:_}=n;return Qs.call(this,Uv(-u,t+1,n)),this.visit(s.children[0].slice(u,_-u))}return this.visit(s.children[0])}function ag(s){return this.visitMany(s.type.children.map((t,n)=>s.children[n]).filter(Boolean))[0]}kr.prototype.visitBool=AE;kr.prototype.visitInt=oa;kr.prototype.visitFloat=oa;kr.prototype.visitUtf8=df;kr.prototype.visitLargeUtf8=df;kr.prototype.visitBinary=df;kr.prototype.visitLargeBinary=df;kr.prototype.visitFixedSizeBinary=oa;kr.prototype.visitDate=oa;kr.prototype.visitTimestamp=oa;kr.prototype.visitTime=oa;kr.prototype.visitDecimal=oa;kr.prototype.visitList=Hg;kr.prototype.visitStruct=ag;kr.prototype.visitUnion=kE;kr.prototype.visitInterval=oa;kr.prototype.visitDuration=oa;kr.prototype.visitFixedSizeList=Hg;kr.prototype.visitMap=Hg;class Bx extends Ng{static throughNode(t){throw new Error('"throughNode" not available in this environment')}static throughDOM(t,n){throw new Error('"throughDOM" not available in this environment')}constructor(t){super(),this._position=0,this._started=!1,this._sink=new lp,this._schema=null,this._dictionaryBlocks=[],this._recordBatchBlocks=[],this._seenDictionaries=new Map,this._dictionaryDeltaOffsets=new Map,ls(t)||(t={autoDestroy:!0,writeLegacyIpcFormat:!1}),this._autoDestroy=typeof t.autoDestroy=="boolean"?t.autoDestroy:!0,this._writeLegacyIpcFormat=typeof t.writeLegacyIpcFormat=="boolean"?t.writeLegacyIpcFormat:!1}toString(t=!1){return this._sink.toString(t)}toUint8Array(t=!1){return this._sink.toUint8Array(t)}writeAll(t){return Tl(t)?t.then(n=>this.writeAll(n)):Wc(t)?Jg(this,t):Xg(this,t)}get closed(){return this._sink.closed}[Symbol.asyncIterator](){return this._sink[Symbol.asyncIterator]()}toDOMStream(t){return this._sink.toDOMStream(t)}toNodeStream(t){return this._sink.toNodeStream(t)}close(){return this.reset()._sink.close()}abort(t){return this.reset()._sink.abort(t)}finish(){return this._autoDestroy?this.close():this.reset(this._sink,this._schema),this}reset(t=this._sink,n=null){return t===this._sink||t instanceof lp?this._sink=t:(this._sink=new lp,t&&nk(t)?this.toDOMStream({type:"bytes"}).pipeTo(t):t&&sk(t)&&this.toNodeStream({objectMode:!1}).pipe(t)),this._started&&this._schema&&this._writeFooter(this._schema),this._started=!1,this._dictionaryBlocks=[],this._recordBatchBlocks=[],this._seenDictionaries=new Map,this._dictionaryDeltaOffsets=new Map,(!n||!sg(n,this._schema))&&(n==null?(this._position=0,this._schema=null):(this._started=!0,this._schema=n,this._writeSchema(n))),this}write(t){let n=null;if(this._sink){if(t==null)return this.finish()&&void 0;if(t instanceof Gn&&!(n=t.schema))return this.finish()&&void 0;if(t instanceof as&&!(n=t.schema))return this.finish()&&void 0}else throw new Error("RecordBatchWriter is closed");if(n&&!sg(n,this._schema)){if(this._started&&this._autoDestroy)return this.close();this.reset(this._sink,n)}t instanceof as?t instanceof qg||this._writeRecordBatch(t):t instanceof Gn?this.writeAll(t.batches):Dh(t)&&this.writeAll(t)}_writeMessage(t,n=8){const u=n-1,_=Wn.encode(t),v=_.byteLength,I=this._writeLegacyIpcFormat?4:8,l=v+I+u&~u,P=l-v-I;return t.headerType===Li.RecordBatch?this._recordBatchBlocks.push(new Va(l,t.bodyLength,this._position)):t.headerType===Li.DictionaryBatch&&this._dictionaryBlocks.push(new Va(l,t.bodyLength,this._position)),this._writeLegacyIpcFormat||this._write(Int32Array.of(-1)),this._write(Int32Array.of(l-I)),v>0&&this._write(_),this._writePadding(P)}_write(t){if(this._started){const n=Ti(t);n&&n.byteLength>0&&(this._sink.write(n),this._position+=n.byteLength)}return this}_writeSchema(t){return this._writeMessage(Wn.from(t))}_writeFooter(t){return this._writeLegacyIpcFormat?this._write(Int32Array.of(0)):this._write(Int32Array.of(-1,0))}_writeMagic(){return this._write(Ih)}_writePadding(t){return t>0?this._write(new Uint8Array(t)):this}_writeRecordBatch(t){const{byteLength:n,nodes:u,bufferRegions:_,buffers:v}=kr.assemble(t),I=new _s(t.numRows,u,_),l=Wn.from(I,n);return this._writeDictionaries(t)._writeMessage(l)._writeBodyBuffers(v)}_writeDictionaryBatch(t,n,u=!1){const{byteLength:_,nodes:v,bufferRegions:I,buffers:l}=kr.assemble(new Ni([t])),P=new _s(t.length,v,I),E=new Eo(P,n,u),U=Wn.from(E,_);return this._writeMessage(U)._writeBodyBuffers(l)}_writeBodyBuffers(t){let n,u,_;for(let v=-1,I=t.length;++v<I;)(n=t[v])&&(u=n.byteLength)>0&&(this._write(n),(_=(u+7&-8)-u)>0&&this._writePadding(_));return this}_writeDictionaries(t){var n,u;for(const[_,v]of t.dictionaries){const I=(n=v==null?void 0:v.data)!==null&&n!==void 0?n:[],l=this._seenDictionaries.get(_),P=(u=this._dictionaryDeltaOffsets.get(_))!==null&&u!==void 0?u:0;if(!l||l.data[0]!==I[0])for(const[E,U]of I.entries())this._writeDictionaryBatch(U,_,E>0);else if(P<I.length)for(const E of I.slice(P))this._writeDictionaryBatch(E,_,!0);this._seenDictionaries.set(_,v),this._dictionaryDeltaOffsets.set(_,I.length)}return this}}class Yg extends Bx{static writeAll(t,n){const u=new Yg(n);return Tl(t)?t.then(_=>u.writeAll(_)):Wc(t)?Jg(u,t):Xg(u,t)}}class Kg extends Bx{static writeAll(t){const n=new Kg;return Tl(t)?t.then(u=>n.writeAll(u)):Wc(t)?Jg(n,t):Xg(n,t)}constructor(){super(),this._autoDestroy=!0}_writeSchema(t){return this._writeMagic()._writePadding(2)}_writeDictionaryBatch(t,n,u=!1){if(!u&&this._seenDictionaries.has(n))throw new Error("The Arrow File format does not support replacement dictionaries. ");return super._writeDictionaryBatch(t,n,u)}_writeFooter(t){const n=Sh.encode(new Sh(t,$r.V5,this._recordBatchBlocks,this._dictionaryBlocks));return super._writeFooter(t)._write(n)._write(Int32Array.of(n.byteLength))._writeMagic()}}function Xg(s,t){let n=t;t instanceof Gn&&(n=t.batches,s.reset(void 0,t.schema));for(const u of n)s.write(u);return s.finish()}function Jg(s,t){return Qe(this,void 0,void 0,function*(){var n,u,_,v,I,l,P;try{for(n=!0,u=xl(t);_=yield u.next(),v=_.done,!v;n=!0){P=_.value,n=!1;const E=P;s.write(E)}}catch(E){I={error:E}}finally{try{!n&&!v&&(l=u.return)&&(yield l.call(u))}finally{if(I)throw I.error}}return s.finish()})}function EE(s,t="stream"){return(t==="stream"?Yg:Kg).writeAll(s).toUint8Array(!0)}var CE=Object.create,Rx=Object.defineProperty,ME=Object.getOwnPropertyDescriptor,DE=Object.getOwnPropertyNames,PE=Object.getPrototypeOf,LE=Object.prototype.hasOwnProperty,zE=(s,t)=>()=>(t||s((t={exports:{}}).exports,t),t.exports),BE=(s,t,n,u)=>{if(t&&typeof t=="object"||typeof t=="function")for(let _ of DE(t))!LE.call(s,_)&&_!==n&&Rx(s,_,{get:()=>t[_],enumerable:!(u=ME(t,_))||u.enumerable});return s},RE=(s,t,n)=>(n=s!=null?CE(PE(s)):{},BE(!s||!s.__esModule?Rx(n,"default",{value:s,enumerable:!0}):n,s)),FE=zE((s,t)=>{t.exports=Worker}),OE=(s=>(s[s.UNDEFINED=0]="UNDEFINED",s[s.AUTOMATIC=1]="AUTOMATIC",s[s.READ_ONLY=2]="READ_ONLY",s[s.READ_WRITE=3]="READ_WRITE",s))(OE||{}),NE=(s=>(s[s.IDENTIFIER=0]="IDENTIFIER",s[s.NUMERIC_CONSTANT=1]="NUMERIC_CONSTANT",s[s.STRING_CONSTANT=2]="STRING_CONSTANT",s[s.OPERATOR=3]="OPERATOR",s[s.KEYWORD=4]="KEYWORD",s[s.COMMENT=5]="COMMENT",s))(NE||{}),UE=(s=>(s[s.NONE=0]="NONE",s[s.DEBUG=1]="DEBUG",s[s.INFO=2]="INFO",s[s.WARNING=3]="WARNING",s[s.ERROR=4]="ERROR",s))(UE||{}),VE=(s=>(s[s.NONE=0]="NONE",s[s.CONNECT=1]="CONNECT",s[s.DISCONNECT=2]="DISCONNECT",s[s.OPEN=3]="OPEN",s[s.QUERY=4]="QUERY",s[s.INSTANTIATE=5]="INSTANTIATE",s))(VE||{}),$E=(s=>(s[s.NONE=0]="NONE",s[s.OK=1]="OK",s[s.ERROR=2]="ERROR",s[s.START=3]="START",s[s.RUN=4]="RUN",s[s.CAPTURE=5]="CAPTURE",s))($E||{}),jE=(s=>(s[s.NONE=0]="NONE",s[s.WEB_WORKER=1]="WEB_WORKER",s[s.NODE_WORKER=2]="NODE_WORKER",s[s.BINDINGS=3]="BINDINGS",s[s.ASYNC_DUCKDB=4]="ASYNC_DUCKDB",s))(jE||{}),qE=class{constructor(s=2){this.level=s}log(s){s.level>=this.level&&console.log(s)}},GE=(s=>(s[s.SUCCESS=0]="SUCCESS",s))(GE||{}),ZE=class{constructor(s,t){this._bindings=s,this._conn=t}get bindings(){return this._bindings}async close(){return this._bindings.disconnect(this._conn)}useUnsafe(s){return s(this._bindings,this._conn)}async query(s){this._bindings.logger.log({timestamp:new Date,level:2,origin:4,topic:4,event:4,value:s});let t=await this._bindings.runQuery(this._conn,s),n=zs.from(t);return console.assert(n.isSync(),"Reader is not sync"),console.assert(n.isFile(),"Reader is not file"),new Gn(n)}async send(s){this._bindings.logger.log({timestamp:new Date,level:2,origin:4,topic:4,event:4,value:s});let t=await this._bindings.startPendingQuery(this._conn,s);for(;t==null;)t=await this._bindings.pollPendingQuery(this._conn);let n=new Fx(this._bindings,this._conn,t),u=await zs.from(n);return console.assert(u.isAsync()),console.assert(u.isStream()),u}async cancelSent(){return await this._bindings.cancelPendingQuery(this._conn)}async getTableNames(s){return await this._bindings.getTableNames(this._conn,s)}async prepare(s){let t=await this._bindings.createPrepared(this._conn,s);return new WE(this._bindings,this._conn,t)}async insertArrowTable(s,t){let n=EE(s,"stream");await this.insertArrowFromIPCStream(n,t)}async insertArrowFromIPCStream(s,t){await this._bindings.insertArrowFromIPCStream(this._conn,s,t)}async insertCSVFromPath(s,t){await this._bindings.insertCSVFromPath(this._conn,s,t)}async insertJSONFromPath(s,t){await this._bindings.insertJSONFromPath(this._conn,s,t)}},Fx=class{constructor(s,t,n){this.db=s,this.conn=t,this.header=n,this._first=!0,this._depleted=!1,this._inFlight=null}async next(){if(this._first)return this._first=!1,{done:!1,value:this.header};if(this._depleted)return{done:!0,value:null};let s;return this._inFlight!=null?(s=await this._inFlight,this._inFlight=null):s=await this.db.fetchQueryResults(this.conn),this._depleted=s.length==0,this._depleted||(this._inFlight=this.db.fetchQueryResults(this.conn)),{done:this._depleted,value:s}}[Symbol.asyncIterator](){return this}},WE=class{constructor(s,t,n){this.bindings=s,this.connectionId=t,this.statementId=n}async close(){await this.bindings.closePrepared(this.connectionId,this.statementId)}async query(...s){let t=await this.bindings.runPrepared(this.connectionId,this.statementId,s),n=zs.from(t);return console.assert(n.isSync()),console.assert(n.isFile()),new Gn(n)}async send(...s){let t=await this.bindings.sendPrepared(this.connectionId,this.statementId,s),n=new Fx(this.bindings,this.connectionId,t),u=await zs.from(n);return console.assert(u.isAsync()),console.assert(u.isStream()),u}},HE=(s=>(s.CANCEL_PENDING_QUERY="CANCEL_PENDING_QUERY",s.CLOSE_PREPARED="CLOSE_PREPARED",s.COLLECT_FILE_STATISTICS="COLLECT_FILE_STATISTICS",s.CONNECT="CONNECT",s.COPY_FILE_TO_BUFFER="COPY_FILE_TO_BUFFER",s.COPY_FILE_TO_PATH="COPY_FILE_TO_PATH",s.CREATE_PREPARED="CREATE_PREPARED",s.DISCONNECT="DISCONNECT",s.DROP_FILE="DROP_FILE",s.DROP_FILES="DROP_FILES",s.EXPORT_FILE_STATISTICS="EXPORT_FILE_STATISTICS",s.FETCH_QUERY_RESULTS="FETCH_QUERY_RESULTS",s.FLUSH_FILES="FLUSH_FILES",s.GET_FEATURE_FLAGS="GET_FEATURE_FLAGS",s.GET_TABLE_NAMES="GET_TABLE_NAMES",s.GET_VERSION="GET_VERSION",s.GLOB_FILE_INFOS="GLOB_FILE_INFOS",s.INSERT_ARROW_FROM_IPC_STREAM="INSERT_ARROW_FROM_IPC_STREAM",s.INSERT_CSV_FROM_PATH="IMPORT_CSV_FROM_PATH",s.INSERT_JSON_FROM_PATH="IMPORT_JSON_FROM_PATH",s.INSTANTIATE="INSTANTIATE",s.OPEN="OPEN",s.PING="PING",s.POLL_PENDING_QUERY="POLL_PENDING_QUERY",s.REGISTER_FILE_BUFFER="REGISTER_FILE_BUFFER",s.REGISTER_FILE_HANDLE="REGISTER_FILE_HANDLE",s.REGISTER_FILE_URL="REGISTER_FILE_URL",s.RESET="RESET",s.RUN_PREPARED="RUN_PREPARED",s.RUN_QUERY="RUN_QUERY",s.SEND_PREPARED="SEND_PREPARED",s.START_PENDING_QUERY="START_PENDING_QUERY",s.TOKENIZE="TOKENIZE",s))(HE||{}),YE=(s=>(s.CONNECTION_INFO="CONNECTION_INFO",s.ERROR="ERROR",s.FEATURE_FLAGS="FEATURE_FLAGS",s.FILE_BUFFER="FILE_BUFFER",s.FILE_INFOS="FILE_INFOS",s.FILE_SIZE="FILE_SIZE",s.FILE_STATISTICS="FILE_STATISTICS",s.INSTANTIATE_PROGRESS="INSTANTIATE_PROGRESS",s.LOG="LOG",s.OK="OK",s.PREPARED_STATEMENT_ID="PREPARED_STATEMENT_ID",s.QUERY_PLAN="QUERY_PLAN",s.QUERY_RESULT="QUERY_RESULT",s.QUERY_RESULT_CHUNK="QUERY_RESULT_CHUNK",s.QUERY_RESULT_HEADER="QUERY_RESULT_HEADER",s.QUERY_RESULT_HEADER_OR_NULL="QUERY_RESULT_HEADER_OR_NULL",s.REGISTERED_FILE="REGISTERED_FILE",s.SCRIPT_TOKENS="SCRIPT_TOKENS",s.SUCCESS="SUCCESS",s.TABLE_NAMES="TABLE_NAMES",s.VERSION_STRING="VERSION_STRING",s))(YE||{}),Ci=class{constructor(s,t){this.promiseResolver=()=>{},this.promiseRejecter=()=>{},this.type=s,this.data=t,this.promise=new Promise((n,u)=>{this.promiseResolver=n,this.promiseRejecter=u})}};function hp(s){switch(s.typeId){case st.Binary:return{sqlType:"binary"};case st.Bool:return{sqlType:"bool"};case st.Date:return{sqlType:"date"};case st.DateDay:return{sqlType:"date32[d]"};case st.DateMillisecond:return{sqlType:"date64[ms]"};case st.Decimal:{let t=s;return{sqlType:"decimal",precision:t.precision,scale:t.scale}}case st.Float:return{sqlType:"float"};case st.Float16:return{sqlType:"float16"};case st.Float32:return{sqlType:"float32"};case st.Float64:return{sqlType:"float64"};case st.Int:return{sqlType:"int32"};case st.Int16:return{sqlType:"int16"};case st.Int32:return{sqlType:"int32"};case st.Int64:return{sqlType:"int64"};case st.Uint16:return{sqlType:"uint16"};case st.Uint32:return{sqlType:"uint32"};case st.Uint64:return{sqlType:"uint64"};case st.Uint8:return{sqlType:"uint8"};case st.IntervalDayTime:return{sqlType:"interval[dt]"};case st.IntervalYearMonth:return{sqlType:"interval[m]"};case st.List:return{sqlType:"list",valueType:hp(s.valueType)};case st.FixedSizeBinary:return{sqlType:"fixedsizebinary",byteWidth:s.byteWidth};case st.Null:return{sqlType:"null"};case st.Utf8:return{sqlType:"utf8"};case st.Struct:return{sqlType:"struct",fields:s.children.map(t=>lg(t.name,t.type))};case st.Map:{let t=s;return{sqlType:"map",keyType:hp(t.keyType),valueType:hp(t.valueType)}}case st.Time:return{sqlType:"time[s]"};case st.TimeMicrosecond:return{sqlType:"time[us]"};case st.TimeMillisecond:return{sqlType:"time[ms]"};case st.TimeNanosecond:return{sqlType:"time[ns]"};case st.TimeSecond:return{sqlType:"time[s]"};case st.Timestamp:return{sqlType:"timestamp",timezone:s.timezone||void 0};case st.TimestampSecond:return{sqlType:"timestamp[s]",timezone:s.timezone||void 0};case st.TimestampMicrosecond:return{sqlType:"timestamp[us]",timezone:s.timezone||void 0};case st.TimestampNanosecond:return{sqlType:"timestamp[ns]",timezone:s.timezone||void 0};case st.TimestampMillisecond:return{sqlType:"timestamp[ms]",timezone:s.timezone||void 0}}throw new Error("unsupported arrow type: ".concat(s.toString()))}function lg(s,t){let n=hp(t);return n.name=s,n}var KE=new TextEncoder,XE=class{constructor(s,t=null){this._onInstantiationProgress=[],this._worker=null,this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{},this._nextMessageId=0,this._pendingRequests=new Map,this._logger=s,this._onMessageHandler=this.onMessage.bind(this),this._onErrorHandler=this.onError.bind(this),this._onCloseHandler=this.onClose.bind(this),t!=null&&this.attach(t)}get logger(){return this._logger}attach(s){this._worker=s,this._worker.addEventListener("message",this._onMessageHandler),this._worker.addEventListener("error",this._onErrorHandler),this._worker.addEventListener("close",this._onCloseHandler),this._workerShutdownPromise=new Promise((t,n)=>{this._workerShutdownResolver=t})}detach(){this._worker&&(this._worker.removeEventListener("message",this._onMessageHandler),this._worker.removeEventListener("error",this._onErrorHandler),this._worker.removeEventListener("close",this._onCloseHandler),this._worker=null,this._workerShutdownResolver(null),this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{})}async terminate(){this._worker&&(this._worker.terminate(),this._worker=null,this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{})}async postTask(s,t=[]){if(!this._worker){console.error("cannot send a message since the worker is not set!");return}let n=this._nextMessageId++;return this._pendingRequests.set(n,s),this._worker.postMessage({messageId:n,type:s.type,data:s.data},t),await s.promise}onMessage(s){var t;let n=s.data;switch(n.type){case"LOG":{this._logger.log(n.data);return}case"INSTANTIATE_PROGRESS":{for(let _ of this._onInstantiationProgress)_(n.data);return}}let u=this._pendingRequests.get(n.requestId);if(!u){console.warn("unassociated response: [".concat(n.requestId,", ").concat(n.type.toString(),"]"));return}if(this._pendingRequests.delete(n.requestId),n.type=="ERROR"){let _=new Error(n.data.message);_.name=n.data.name,(t=Object.getOwnPropertyDescriptor(_,"stack"))!=null&&t.writable&&(_.stack=n.data.stack),u.promiseRejecter(_);return}switch(u.type){case"CLOSE_PREPARED":case"COLLECT_FILE_STATISTICS":case"COPY_FILE_TO_PATH":case"DISCONNECT":case"DROP_FILE":case"DROP_FILES":case"FLUSH_FILES":case"INSERT_ARROW_FROM_IPC_STREAM":case"IMPORT_CSV_FROM_PATH":case"IMPORT_JSON_FROM_PATH":case"OPEN":case"PING":case"REGISTER_FILE_BUFFER":case"REGISTER_FILE_HANDLE":case"REGISTER_FILE_URL":case"RESET":if(n.type=="OK"){u.promiseResolver(n.data);return}break;case"INSTANTIATE":if(this._onInstantiationProgress=[],n.type=="OK"){u.promiseResolver(n.data);return}break;case"GLOB_FILE_INFOS":if(n.type=="FILE_INFOS"){u.promiseResolver(n.data);return}break;case"GET_VERSION":if(n.type=="VERSION_STRING"){u.promiseResolver(n.data);return}break;case"GET_FEATURE_FLAGS":if(n.type=="FEATURE_FLAGS"){u.promiseResolver(n.data);return}break;case"GET_TABLE_NAMES":if(n.type=="TABLE_NAMES"){u.promiseResolver(n.data);return}break;case"TOKENIZE":if(n.type=="SCRIPT_TOKENS"){u.promiseResolver(n.data);return}break;case"COPY_FILE_TO_BUFFER":if(n.type=="FILE_BUFFER"){u.promiseResolver(n.data);return}break;case"EXPORT_FILE_STATISTICS":if(n.type=="FILE_STATISTICS"){u.promiseResolver(n.data);return}break;case"CONNECT":if(n.type=="CONNECTION_INFO"){u.promiseResolver(n.data);return}break;case"RUN_PREPARED":case"RUN_QUERY":if(n.type=="QUERY_RESULT"){u.promiseResolver(n.data);return}break;case"SEND_PREPARED":if(n.type=="QUERY_RESULT_HEADER"){u.promiseResolver(n.data);return}break;case"START_PENDING_QUERY":if(n.type=="QUERY_RESULT_HEADER_OR_NULL"){u.promiseResolver(n.data);return}break;case"POLL_PENDING_QUERY":if(n.type=="QUERY_RESULT_HEADER_OR_NULL"){u.promiseResolver(n.data);return}break;case"CANCEL_PENDING_QUERY":if(this._onInstantiationProgress=[],n.type=="SUCCESS"){u.promiseResolver(n.data);return}break;case"FETCH_QUERY_RESULTS":if(n.type=="QUERY_RESULT_CHUNK"){u.promiseResolver(n.data);return}break;case"CREATE_PREPARED":if(n.type=="PREPARED_STATEMENT_ID"){u.promiseResolver(n.data);return}break}u.promiseRejecter(new Error("unexpected response type: ".concat(n.type.toString())))}onError(s){console.error(s),console.error("error in duckdb worker: ".concat(s.message)),this._pendingRequests.clear()}onClose(){if(this._workerShutdownResolver(null),this._pendingRequests.size!=0){console.warn("worker terminated with ".concat(this._pendingRequests.size," pending requests"));return}this._pendingRequests.clear()}async reset(){let s=new Ci("RESET",null);return await this.postTask(s)}async ping(){let s=new Ci("PING",null);await this.postTask(s)}async dropFile(s){let t=new Ci("DROP_FILE",s);return await this.postTask(t)}async dropFiles(){let s=new Ci("DROP_FILES",null);return await this.postTask(s)}async flushFiles(){let s=new Ci("FLUSH_FILES",null);return await this.postTask(s)}async instantiate(s,t=null,n=u=>{}){this._onInstantiationProgress.push(n);let u=new Ci("INSTANTIATE",[s,t]);return await this.postTask(u)}async getVersion(){let s=new Ci("GET_VERSION",null);return await this.postTask(s)}async getFeatureFlags(){let s=new Ci("GET_FEATURE_FLAGS",null);return await this.postTask(s)}async open(s){let t=new Ci("OPEN",s);await this.postTask(t)}async tokenize(s){let t=new Ci("TOKENIZE",s);return await this.postTask(t)}async connectInternal(){let s=new Ci("CONNECT",null);return await this.postTask(s)}async connect(){let s=await this.connectInternal();return new ZE(this,s)}async disconnect(s){let t=new Ci("DISCONNECT",s);await this.postTask(t)}async runQuery(s,t){let n=new Ci("RUN_QUERY",[s,t]);return await this.postTask(n)}async startPendingQuery(s,t){let n=new Ci("START_PENDING_QUERY",[s,t]);return await this.postTask(n)}async pollPendingQuery(s){let t=new Ci("POLL_PENDING_QUERY",s);return await this.postTask(t)}async cancelPendingQuery(s){let t=new Ci("CANCEL_PENDING_QUERY",s);return await this.postTask(t)}async fetchQueryResults(s){let t=new Ci("FETCH_QUERY_RESULTS",s);return await this.postTask(t)}async getTableNames(s,t){let n=new Ci("GET_TABLE_NAMES",[s,t]);return await this.postTask(n)}async createPrepared(s,t){let n=new Ci("CREATE_PREPARED",[s,t]);return await this.postTask(n)}async closePrepared(s,t){let n=new Ci("CLOSE_PREPARED",[s,t]);await this.postTask(n)}async runPrepared(s,t,n){let u=new Ci("RUN_PREPARED",[s,t,n]);return await this.postTask(u)}async sendPrepared(s,t,n){let u=new Ci("SEND_PREPARED",[s,t,n]);return await this.postTask(u)}async globFiles(s){let t=new Ci("GLOB_FILE_INFOS",s);return await this.postTask(t)}async registerFileText(s,t){let n=KE.encode(t);await this.registerFileBuffer(s,n)}async registerFileURL(s,t,n,u){t===void 0&&(t=s);let _=new Ci("REGISTER_FILE_URL",[s,t,n,u]);await this.postTask(_)}async registerEmptyFileBuffer(s){}async registerFileBuffer(s,t){let n=new Ci("REGISTER_FILE_BUFFER",[s,t]);await this.postTask(n,[t.buffer])}async registerFileHandle(s,t,n,u){let _=new Ci("REGISTER_FILE_HANDLE",[s,t,n,u]);await this.postTask(_,[])}async collectFileStatistics(s,t){let n=new Ci("COLLECT_FILE_STATISTICS",[s,t]);await this.postTask(n,[])}async exportFileStatistics(s){let t=new Ci("EXPORT_FILE_STATISTICS",s);return await this.postTask(t,[])}async copyFileToBuffer(s){let t=new Ci("COPY_FILE_TO_BUFFER",s);return await this.postTask(t)}async copyFileToPath(s,t){let n=new Ci("COPY_FILE_TO_PATH",[s,t]);await this.postTask(n)}async insertArrowFromIPCStream(s,t,n){if(t.length==0)return;let u=new Ci("INSERT_ARROW_FROM_IPC_STREAM",[s,t,n]);await this.postTask(u,[t.buffer])}async insertCSVFromPath(s,t,n){if(n.columns!==void 0){let _=[];for(let v in n.columns){let I=n.columns[v];_.push(lg(v,I))}n.columnsFlat=_,delete n.columns}let u=new Ci("IMPORT_CSV_FROM_PATH",[s,t,n]);await this.postTask(u)}async insertJSONFromPath(s,t,n){if(n.columns!==void 0){let _=[];for(let v in n.columns){let I=n.columns[v];_.push(lg(v,I))}n.columnsFlat=_,delete n.columns}let u=new Ci("IMPORT_JSON_FROM_PATH",[s,t,n]);await this.postTask(u)}},JE=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,3,1,0,1,10,14,1,12,0,65,0,65,0,65,0,252,10,0,0,11])),QE=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,8,1,6,0,6,64,25,11,11])),tC=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),eC=()=>(async s=>{try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(s)}catch{return!1}})(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])),iC={name:"@duckdb/duckdb-wasm",version:"1.29.0",description:"DuckDB powered by WebAssembly",license:"MIT",repository:{type:"git",url:"https://github.com/duckdb/duckdb-wasm.git"},keywords:["sql","duckdb","relational","database","data","query","wasm","analytics","olap","arrow","parquet","json","csv"],dependencies:{"apache-arrow":"^17.0.0"},devDependencies:{"@types/emscripten":"^1.39.10","@types/jasmine":"^5.1.4","@typescript-eslint/eslint-plugin":"^6.21.0","@typescript-eslint/parser":"^6.21.0",esbuild:"^0.20.2",eslint:"^8.57.0","eslint-plugin-jasmine":"^4.1.3","eslint-plugin-react":"^7.34.0","fast-glob":"^3.3.2",jasmine:"^5.1.0","jasmine-core":"^5.1.2","jasmine-spec-reporter":"^7.0.0","js-sha256":"^0.11.0",karma:"^6.4.2","karma-chrome-launcher":"^3.2.0","karma-coverage":"^2.2.1","karma-firefox-launcher":"^2.1.3","karma-jasmine":"^5.1.0","karma-jasmine-html-reporter":"^2.1.0","karma-sourcemap-loader":"^0.4.0","karma-spec-reporter":"^0.0.36","make-dir":"^4.0.0",nyc:"^15.1.0",prettier:"^3.2.5",puppeteer:"^22.8.0",rimraf:"^5.0.5",s3rver:"^3.7.1",typedoc:"^0.25.13",typescript:"^5.3.3","wasm-feature-detect":"^1.6.1","web-worker":"^1.2.0"},scripts:{"build:debug":"node bundle.mjs debug && tsc --emitDeclarationOnly","build:release":"node bundle.mjs release && tsc --emitDeclarationOnly",docs:"typedoc",report:"node ./coverage.mjs","test:node":"node --enable-source-maps ../../node_modules/jasmine/bin/jasmine ./dist/tests-node.cjs","test:node:debug":"node --inspect-brk --enable-source-maps ../../node_modules/jasmine/bin/jasmine ./dist/tests-node.cjs","test:node:coverage":"nyc -r json --report-dir ./coverage/node node ../../node_modules/jasmine/bin/jasmine ./dist/tests-node.cjs","test:firefox":"karma start ./karma/tests-firefox.cjs","test:chrome":"karma start ./karma/tests-chrome.cjs","test:chrome:eh":"karma start ./karma/tests-chrome-eh.cjs","test:chrome:coverage":"karma start ./karma/tests-chrome-coverage.cjs","test:browser":"karma start ./karma/tests-all.cjs","test:browser:debug":"karma start ./karma/tests-debug.cjs",test:"npm run test:chrome && npm run test:node","test:coverage":"npm run test:chrome:coverage && npm run test:node:coverage && npm run report",lint:"eslint src test"},files:["dist","!dist/tests-*","!dist/duckdb-browser-mvp.worker.js.map","!dist/types/test"],main:"dist/duckdb-browser.cjs",module:"dist/duckdb-browser.mjs",types:"dist/duckdb-browser.d.ts",jsdelivr:"dist/duckdb-browser.cjs",unpkg:"dist/duckdb-browser.mjs",sideEffects:!1,browser:{fs:!1,path:!1,perf_hooks:!1,os:!1,worker_threads:!1},exports:{"./dist/duckdb-mvp.wasm":"./dist/duckdb-mvp.wasm","./dist/duckdb-eh.wasm":"./dist/duckdb-eh.wasm","./dist/duckdb-coi.wasm":"./dist/duckdb-coi.wasm","./dist/duckdb-browser":"./dist/duckdb-browser.mjs","./dist/duckdb-browser.cjs":"./dist/duckdb-browser.cjs","./dist/duckdb-browser.mjs":"./dist/duckdb-browser.mjs","./dist/duckdb-browser-coi.pthread.worker.js":"./dist/duckdb-browser-coi.pthread.worker.js","./dist/duckdb-browser-coi.worker.js":"./dist/duckdb-browser-coi.worker.js","./dist/duckdb-browser-eh.worker.js":"./dist/duckdb-browser-eh.worker.js","./dist/duckdb-browser-mvp.worker.js":"./dist/duckdb-browser-mvp.worker.js","./dist/duckdb-node":"./dist/duckdb-node.cjs","./dist/duckdb-node.cjs":"./dist/duckdb-node.cjs","./dist/duckdb-node-blocking":"./dist/duckdb-node-blocking.cjs","./dist/duckdb-node-blocking.cjs":"./dist/duckdb-node-blocking.cjs","./dist/duckdb-node-eh.worker.cjs":"./dist/duckdb-node-eh.worker.cjs","./dist/duckdb-node-mvp.worker.cjs":"./dist/duckdb-node-mvp.worker.cjs","./blocking":{node:{types:"./dist/duckdb-node-blocking.d.ts",require:"./dist/duckdb-node-blocking.cjs",import:"./dist/duckdb-node-blocking.cjs"},types:"./dist/duckdb-node-blocking.d.ts",import:"./dist/duckdb-node-blocking.mjs",require:"./dist/duckdb-node-blocking.cjs"},".":{browser:{types:"./dist/duckdb-browser.d.ts",import:"./dist/duckdb-browser.mjs",require:"./dist/duckdb-browser.cjs"},node:{types:"./dist/duckdb-node.d.ts",import:"./dist/duckdb-node.cjs",require:"./dist/duckdb-node.cjs"},types:"./dist/duckdb-browser.d.ts",import:"./dist/duckdb-browser.mjs",require:"./dist/duckdb-browser.cjs"}}},Qg=iC.version.split(".");Qg[0];Qg[1];Qg[2];var rC=()=>typeof navigator>"u",Mm=null,Dm=null,Pm=null,Lm=null,zm=null;async function nC(){return Mm==null&&(Mm=typeof BigInt64Array<"u"),Dm==null&&(Dm=await QE()),Pm==null&&(Pm=await eC()),Lm==null&&(Lm=await tC()),zm==null&&(zm=await JE()),{bigInt64Array:Mm,crossOriginIsolated:rC()||globalThis.crossOriginIsolated||!1,wasmExceptions:Dm,wasmSIMD:Lm,wasmThreads:Pm,wasmBulkMemory:zm}}async function sC(s){let t=await nC();if(t.wasmExceptions){if(t.wasmSIMD&&t.wasmThreads&&t.crossOriginIsolated&&s.coi)return{mainModule:s.coi.mainModule,mainWorker:s.coi.mainWorker,pthreadWorker:s.coi.pthreadWorker};if(s.eh)return{mainModule:s.eh.mainModule,mainWorker:s.eh.mainWorker,pthreadWorker:null}}return{mainModule:s.mvp.mainModule,mainWorker:s.mvp.mainWorker,pthreadWorker:null}}RE(FE());function oC(){let s=new TextDecoder;return t=>(typeof SharedArrayBuffer<"u"&&t.buffer instanceof SharedArrayBuffer&&(t=new Uint8Array(t)),s.decode(t))}oC();var aC=(s=>(s[s.BUFFER=0]="BUFFER",s[s.NODE_FS=1]="NODE_FS",s[s.BROWSER_FILEREADER=2]="BROWSER_FILEREADER",s[s.BROWSER_FSACCESS=3]="BROWSER_FSACCESS",s[s.HTTP=4]="HTTP",s[s.S3=5]="S3",s))(aC||{});const lC=""+new URL("../assets/duckdb-mvp.DuKjbjvP.wasm",import.meta.url).href,cC=""+new URL("../assets/duckdb-browser-mvp.worker.CM-L3bpJ.js",import.meta.url).href,uC=""+new URL("../assets/duckdb-eh.DrTJ_0hP.wasm",import.meta.url).href,hC=""+new URL("../assets/duckdb-browser-eh.worker.D6ypKDsm.js",import.meta.url).href;var dC=ue("GEO_ID",1),pC=ue("<!> <!>",1),fC=ue("<!> <!>",1),mC=ue("<div><!></div>");function gC(s,t){Ki(t,!1);const n=us(),u=()=>Oi(Ah,"$rustBackend",n),_=()=>Oi(Cc,"$selectedMetricsList",n),v=()=>Oi(X_,"$previewedMetricsList",n),I={mvp:{mainModule:lC,mainWorker:cC},eh:{mainModule:uC,mainWorker:hC}};function l(tt){console.log("Set preview metric map: ",tt),fv.set(tt)}async function P(tt){const ct=await U.connect(),nt=(await ct.query(tt)).toArray().map(it=>it.toJSON());return console.log(nt),await ct.close(),nt}async function E(tt){await u().isLoaded()||await u().initialise();try{console.log(tt);let pt=await u().downloadDataRequestMetricsSql(tt);console.log(pt);const nt=await P(`INSTALL httpfs; LOAD httpfs; ${pt}`);return console.log(nt),nt}catch(pt){window.alert(`Failed to download: ${pt}`)}}let U;qc(async()=>{try{await u().isLoaded()||await u().initialise();const ct=await sC(I),pt=new Worker(ct.mainWorker),nt=new qE;U=new XE(nt,pt),await U.instantiate(ct.mainModule,ct.pthreadWorker);const it=_().map(gt=>({MetricId:{id:gt.metric_id}}));console.log(it);const _t=await E({region:[],metrics:it,years:[]});Hn(X_,_t),console.log(v().slice(0,10));return}catch(tt){window.alert(`Failed to get countries: ${tt}`)}}),Ji();var j=mC(),W=xe(j);Sg(W,{children:(tt,ct)=>{var pt=fC(),nt=De(pt);kg(nt,{children:(It,_t)=>{var gt=pC(),kt=De(gt);vo(kt,{children:(Vt,Rt)=>{Ir();var Qt=dC();Et(Vt,Qt)},$$slots:{default:!0},$$legacy:!0});var Lt=Ot(Ot(kt,!0));Ra(Lt,1,_,Ba,(Vt,Rt,Qt)=>{vo(Vt,{children:(Ut,me)=>{vl(Ut,{size:"xs",color:"light",$$events:{click:()=>l(hn(Rt))},children:(jt,Bt)=>{Ir();var ae=Js();je(()=>bn(ae,hn(Rt).metric_parquet_column_name)),Et(jt,ae)},$$slots:{default:!0},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0})}),Et(It,gt)},$$slots:{default:!0},$$legacy:!0});var it=Ot(Ot(nt,!0));Ig(it,{children:(It,_t)=>{var gt=Ai(),kt=De(gt);Ra(kt,1,()=>v().slice(0,10),Ba,(Lt,Vt,Rt)=>{Tg(Lt,{children:(Qt,Ut)=>{var me=Ai(),jt=De(me);Ra(jt,1,()=>Object.keys(hn(Vt)).map(function(Bt){return String(hn(Vt)[Bt])}),Ba,(Bt,ae,he)=>{ta(Bt,{class:"justified",children:(ve,se)=>{Ir();var ne=Js();je(()=>bn(ne,hn(ae))),Et(ve,ne)},$$slots:{default:!0},$$legacy:!0})}),Et(Qt,me)},$$slots:{default:!0},$$legacy:!0})}),Et(It,gt)},$$slots:{default:!0},$$legacy:!0}),Et(tt,pt)},$$slots:{default:!0},$$legacy:!0}),we(j),Et(s,j),Xi()}var yC=ue("Home",1),_C=ue("Selected metrics and Preview",1),vC=ue("Name",1),bC=ue("Year",1),xC=ue("Selected metrics",1),wC=ue("<!> <!> <!>",1),SC=ue("Add",1),IC=ue("<!> <!> <!>",1),TC=ue("<!> <!>",1),kC=ue('<div slot="sidebar"><div style="text-align: left; margin-top: 2.5%; margin-bottom: 5%; "><!> <!></div> <section id="query-section" style="text-align: left; margin-top: 2.5%; margin-bottom: 5%; "><!></section> <section id="&lt;results-table"><!></section></div>'),AC=ue('<p class="text-sm text-gray-500 dark:text-gray-400"><b>Selected metrics</b></p> <!>',1),EC=ue('<p class="text-sm text-gray-500 dark:text-gray-400"><b>Preview of selected metrics <button>(view selected on map)</button></b></p> <!>',1),CC=ue("<!> <!>",1),MC=ue("<!> <!>",1),DC=ue('<div slot="map"><div><!></div></div>');function PC(s,t){Ki(t,!1);const n=us(),u=()=>Oi(pv,"$map",n),_=()=>Oi(Cc,"$selectedMetricsList",n),v=()=>Oi(Ah,"$rustBackend",n),I=()=>Oi($m,"$selectedLevel",n),l=()=>Oi(_p,"$selectedCountry",n),P=()=>Oi(fv,"$previewMetricMap",n);let E=Be(!1),U={y:320,duration:200,easing:pT};qc(()=>{u().on("load",pt),u().on("moveend",pt),pt();let se=ct.map(ne=>Number(ne.toFixed(6)));console.log("Bbox",se)});function j(se){console.log(se),_().indexOf(se)===-1?_().push(se):console.log("Not added"),Hn(Cc,[..._()])}function W(se){console.log(se);const ne=_().indexOf(se);ne>-1&&_().splice(ne,1),Hn(Cc,[..._()])}async function tt(se,ne){try{return await v().isLoaded()||await v().initialise(),await v().search(se,ne)}catch(ie){window.alert(`Failed to search: ${ie}`)}}let ct=[];function pt(){const se=u().getBounds();ct=[se.getWest(),se.getSouth(),se.getEast(),se.getNorth()]}const nt="geojson-data",it="geojson-layer",It="geojson-linelayer";function _t(){u().getLayer(it)&&u().removeLayer(it),u().getLayer(It)&&u().removeLayer(It),u().getSource(nt)&&u().removeSource(nt)}async function gt(se){await v().isLoaded()||await v().initialise();try{console.log(se);let ie=await v().downloadDataRequest(se);return console.log(ie),ie}catch(ie){window.alert(`Failed to download: ${ie}`)}}let kt=Be(""),Lt={},Vt=[],Rt=Be([]),Qt={type:"FeatureCollection",features:[]};async function Ut(){Lt={metric_id:[],text:[{text:wt(kt),context:["Hxl","HumanReadableName","Description"],config:{match_type:"Regex",case_sensitivity:"Insensitive"}}],geometry_level:{value:I(),config:{match_type:"Exact",case_sensitivity:"Insensitive"}},year_range:[],country:{value:l(),config:{match_type:"Regex",case_sensitivity:"Insensitive"}},region_spec:[]},console.log(Lt),Vt=await tt(Lt,0),Ce(Rt,Vt.slice(0,10)),console.log(Vt)}function me(se,ne){let ie;return function(...ci){clearTimeout(ie),ie=setTimeout(()=>{se.apply(this,ci)},ne)}}const jt=me(Ut,300);let Bt=0,ae=0;function he(se){const ne=se.features.map(ie=>ie.properties[String(P().metric_parquet_column_name)]);Bt=Math.min(...ne),ae=Math.max(...ne)}async function ve(){let se=ct.map(ci=>Number(ci.toFixed(6)));console.log("Bbox",se);let ne={region:[{BoundingBox:se}],metrics:[{MetricId:{id:P().metric_id}}]};console.log(ne);let ie=await gt(ne);he(ie),Qt=ie,console.log(P().metric_parquet_column_name),console.log(Qt),console.log(Bt),console.log(ae),_t(),u().addSource(nt,{type:"geojson",data:Qt}),u().addLayer({id:it,type:"fill",source:nt,paint:{"fill-color":["interpolate",["linear"],["get",String(P().metric_parquet_column_name)],0,"#0a0",ae,"#a00"],"fill-opacity":.5}}),u().addLayer({id:It,type:"line",source:nt,paint:{"line-color":"black","line-width":.5}})}return Ji(),pg(s,{$$slots:{sidebar:(se,ne)=>{var ie=kC(),ci=xe(ie),ti=xe(ci);vl(ti,{color:"light",$$events:{click:()=>Hn(nf,{kind:"title"})},children:(ye,Xt)=>{Ir();var ze=yC();Et(ye,ze)},$$slots:{default:!0},$$legacy:!0});var mi=Ot(Ot(ti,!0));vl(mi,{color:"light",$$events:{click:()=>Ce(E,!1)},children:(ye,Xt)=>{Ir();var ze=_C();Et(ye,ze)},$$slots:{default:!0},$$legacy:!0}),we(ci);var di=Ot(Ot(ci,!0)),ke=xe(di);jT(ke,{get searchTerm(){return wt(kt)},set searchTerm(ye){Ce(kt,ye)},$$events:{input:jt},$$legacy:!0}),we(di);var Xe=Ot(Ot(di,!0)),xi=xe(Xe);Sg(xi,{children:(ye,Xt)=>{var ze=TC(),Mi=De(ze);kg(Mi,{children:(lr,wn)=>{var ir=wC(),yr=De(ir);vo(yr,{children:(Gr,Sn)=>{Ir();var Tt=vC();Et(Gr,Tt)},$$slots:{default:!0},$$legacy:!0});var Pr=Ot(Ot(yr,!0));vo(Pr,{children:(Gr,Sn)=>{Ir();var Tt=bC();Et(Gr,Tt)},$$slots:{default:!0},$$legacy:!0});var rn=Ot(Ot(Pr,!0));vo(rn,{children:(Gr,Sn)=>{Ir();var Tt=xC();Et(Gr,Tt)},$$slots:{default:!0},$$legacy:!0}),Et(lr,ir)},$$slots:{default:!0},$$legacy:!0});var en=Ot(Ot(Mi,!0));Ig(en,{tableBodyClass:"divide-y",children:(lr,wn)=>{var ir=Ai(),yr=De(ir);Ra(yr,1,()=>wt(Rt),Ba,(Pr,rn,Gr)=>{Tg(Pr,{children:(Sn,Tt)=>{var Ar=IC(),dn=De(Ar);ta(dn,{class:"max-w-md whitespace-normal break-words border-b border-gray-200 px-2 py-2",children:(nn,Fs)=>{Ir();var Zr=Js();je(()=>bn(Zr,hn(rn).metric_human_readable_name)),Et(nn,Zr)},$$slots:{default:!0},$$legacy:!0});var Ei=Ot(Ot(dn,!0));ta(Ei,{children:(nn,Fs)=>{Ir();var Zr=Js();je(()=>bn(Zr,hn(rn).source_data_release_collection_period_start.slice(0,4))),Et(nn,Zr)},$$slots:{default:!0},$$legacy:!0});var gi=Ot(Ot(Ei,!0));ta(gi,{children:(nn,Fs)=>{vl(nn,{color:"light",$$events:{click:()=>j(hn(rn))},children:(Zr,Za)=>{Ir();var ro=SC();Et(Zr,ro)},$$slots:{default:!0},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0}),Et(Sn,Ar)},$$slots:{default:!0},$$legacy:!0})}),Et(lr,ir)},$$slots:{default:!0},$$legacy:!0}),Et(ye,ze)},$$slots:{default:!0},$$legacy:!0}),we(Xe),we(ie),Et(se,ie)},map:(se,ne)=>{var ie=DC(),ci=xe(ie),ti=xe(ci);wI(ti,{placement:"top",position:"absolute",transitionType:"fly",width:"w-full",activateClickOutside:!1,transitionParams:U,backdrop:!1,get hidden(){return wt(E)},set hidden(mi){Ce(E,mi)},id:"sidebar8",children:(mi,di)=>{var ke=MC(),Xe=De(ke);mI(Xe,{class:"mb-4 dark:text-white",$$events:{click:()=>Ce(E,!0)},$$legacy:!0});var xi=Ot(Ot(Xe,!0));CT(xi,{children:(ye,Xt)=>{var ze=CC(),Mi=De(ze);s0(Mi,{open:!0,title:"Selected Metrics",children:(lr,wn)=>{var ir=AC(),yr=De(ir);xe(yr),we(yr);var Pr=Ot(Ot(yr,!0));tk(Pr,{$$legacy:!0}),Et(lr,ir)},$$slots:{default:!0},$$legacy:!0});var en=Ot(Ot(Mi,!0));s0(en,{title:"Preview",children:(lr,wn)=>{var ir=EC(),yr=De(ir),Pr=xe(yr),rn=Ot(xe(Pr)),Gr=$0(()=>()=>ve());we(Pr),we(yr);var Sn=Ot(Ot(yr,!0));gC(Sn,{$$legacy:!0}),re("click",rn,function(...Tt){var Ar;return(Ar=wt(Gr))==null?void 0:Ar.apply(this,Tt)},!1),Et(lr,ir)},$$slots:{default:!0},$$legacy:!0}),Et(ye,ze)},$$slots:{default:!0},$$legacy:!0}),Et(mi,ke)},$$slots:{default:!0},$$legacy:!0}),we(ci),we(ie),Et(se,ie)}},$$legacy:!0}),w2(t,"remove",W),Xi({remove:W})}var LC=ue('<div><h2 class="font-large text-lg text-gray-500 lg:text-xl dark:text-gray-500"><p>Pick geometry level...</p></h2> <!></div>'),zC=ue('<li class="rounded p-2 hover:bg-gray-100 dark:hover:bg-gray-600"><!></li>'),BC=ue('<div slot="sidebar"><div><!> <!> <!></div></div>');function RC(s,t){Ki(t,!1);const n=us(),u=()=>Oi($m,"$selectedLevel",n),_=()=>Oi(_p,"$selectedCountry",n),v=()=>Oi(Ah,"$rustBackend",n),I={"United States":["tract","county","block_group"],Scotland:["OutputArea2011","CouncilArea2011","DataZone2011"],"Northern Ireland":["LGD14","DZ21","SDZ21"],"England and Wales":["msoa","lsoa","rgn","oa","ctry","ltla"],Belgium:["statistical_sector","municipality"]};let l=Be([]);function P(E){Hn($m,E),console.log("Selected country: ",_()),console.log("Selected level: ",u()),Hn(nf,{kind:"download"})}qc(async()=>{try{await v().isLoaded()||await v().initialise(),Ce(l,I[_()+""]),console.log(wt(l));return}catch(E){window.alert(`Failed to get countries: ${E}`)}}),Ji(),pg(s,{$$slots:{sidebar:(E,U)=>{var j=BC(),W=xe(j),tt=xe(W);Lv(tt);var ct=Ot(Ot(tt,!0));vl(ct,{children:(nt,it)=>{var It=LC(),_t=xe(It);xe(_t),we(_t);var gt=Ot(Ot(_t,!0));Pv(gt,{color:"grey",size:"lg",class:"text-grey ms-2 h-6 w-6 dark:text-gray-500",$$legacy:!0}),we(It),Et(nt,It)},$$slots:{default:!0},$$legacy:!0});var pt=Ot(Ot(ct,!0));Mv(pt,{children:(nt,it)=>{var It=Ai(),_t=De(It);Ra(_t,1,()=>wt(l),Ba,(gt,kt,Lt)=>{var Vt=zC(),Rt=xe(Vt);Dv(Rt,{$$events:{click:()=>P(hn(kt))},children:(Qt,Ut)=>{Ir();var me=Js();je(()=>bn(me,hn(kt))),Et(Qt,me)},$$slots:{default:!0},$$legacy:!0}),we(Vt),Et(gt,Vt)}),Et(nt,It)},$$slots:{default:!0},$$legacy:!0}),we(W),we(j),Et(E,j)}},$$legacy:!0}),Xi()}var FC=ue('<div slot="left"><h1 class="lg:text-6s md:text-5s mb-4 text-4xl font-extrabold leading-none tracking-tight text-gray-900 dark:text-gray-900">Popgetter browser</h1> <div></div></div>'),OC=ue("<div></div> <!>",1),NC=ue('<div slot="main" style="position:relative; width: 100%; height: 100vh;"><!></div>');function YC(s,t){Ki(t,!1);const n=us(),u=()=>Oi(Om,"$sidebarContents",n),_=()=>Oi(Nm,"$mapContents",n),v=()=>Oi(nf,"$mode",n);qc(async()=>{const E=lv(new VT);let U=await new E;Ah.set(U)});let I=Be(void 0),l=Be(),P=Be();Pe(()=>wt(I),()=>{wt(I)&&pv.set(wt(I))}),Pe(()=>(wt(l),u()),()=>{wt(l)&&u()&&(Ac(l,wt(l).innerHTML=""),wt(l).appendChild(u()))}),Pe(()=>(wt(P),_()),()=>{wt(P)&&_()&&(Ac(P,wt(P).innerHTML=""),wt(P).appendChild(_()))}),jr(),Ji(),I2(s,{$$slots:{left:(E,U)=>{var j=FC(),W=xe(j),tt=Ot(Ot(W,!0));wl(tt,ct=>Ce(l,ct),()=>wt(l)),we(j),Et(E,j)},main:(E,U)=>{var j=NC(),W=xe(j);q2(W,{style:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",standardControls:!0,hash:!0,get map(){return wt(I)},set map(tt){Ce(I,tt)},children:(tt,ct)=>{var pt=OC(),nt=De(pt);wl(nt,It=>Ce(P,It),()=>wt(P));var it=Ot(Ot(nt,!0));zi(it,()=>v().kind=="title",It=>{UT(It,{$$legacy:!0})},It=>{var _t=Ai(),gt=De(_t);zi(gt,()=>v().kind=="level",kt=>{RC(kt,{$$legacy:!0})},kt=>{var Lt=Ai(),Vt=De(Lt);zi(Vt,()=>v().kind=="download",Rt=>{PC(Rt,{$$legacy:!0})},null,!0),Et(kt,Lt)},!0),Et(It,_t)}),Et(tt,pt)},$$slots:{default:!0},$$legacy:!0}),we(j),Et(E,j)}},$$legacy:!0}),Xi()}export{YC as component};
