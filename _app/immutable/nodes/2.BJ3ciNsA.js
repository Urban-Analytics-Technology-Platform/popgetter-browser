var kS=Object.defineProperty;var AS=(i,e,n)=>e in i?kS(i,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[e]=n;var cg=(i,e,n)=>AS(i,typeof e!="symbol"?e+"":e,n);import{h as Ui,b as jf,j as fo,U as ES,q as CS,u as G0,i as qf,g as Ph,k as MS,E as DS,A as PS,B as LS,n as zS,o as BS,e as RS,C as db,D as FS,F as OS,G as NS,T as US,f as mt,c as ct,s as Ae,a as xe,t as rt,r as ut,p as rr,I as ss,z as bs,J as Or}from"../chunks/disclose-version.CJ6P83X4.js";import{y as cy,j as $S,A as uy,w as Vp,i as VS,z as hy,W as jS,x as Gf,s as ot,m as xt,D as Z0,X as qS,Y as GS,Z as fb,E as pb,B as mb,d as gb,C as yb,f as ze,q as Zf,_ as ZS,$ as WS,T as W0,a0 as HS,n as Ef,a1 as YS,a2 as KS,J as XS,h as JS,F as QS,p as Dr,a3 as jn,a4 as bt,a5 as gi,t as Ct,g as ue,a as Pr,a6 as $i,a7 as eI,M as Kc,K as _b,a8 as Lh,a9 as Ni,V as tI}from"../chunks/runtime.BRAqMMCI.js";import{b as Wo,l as ur,p as oe,c as Yh,i as hr,s as dy,o as Kh,a as au}from"../chunks/index-client.Dsykefas.js";import{s as An,b as Bi,a as Ir,i as Lr}from"../chunks/store.iSMRLC3g.js";import{w as hi,r as ug,g as rI}from"../chunks/index.DM8_DTYB.js";import{a as H0,c as Y0,d as iI,b as nI,e as Qe,s as Ei}from"../chunks/render.BMiLFty_.js";import{s as cr,b as Xe,d as Zr,a as vb}from"../chunks/misc.ChbGwrX_.js";function bb(i,e,n){Ui&&jf();var l=i,p=ES,v;cy(()=>{$S(p,p=e())&&(v&&uy(v),v=Vp(()=>n(l)))}),Ui&&(l=fo)}let Vc=null;function K0(i){Vc=i}function Ra(i,e){return e}function sI(i,e,n,l){for(var p=[],v=e.length,b=0;b<v;b++)qS(e[b].e,p,!0);var c=v>0&&p.length===0&&n!==null;if(c){var E=n.parentNode;zS(E),E.append(n),l.clear(),qo(i,e[0].prev,e[v-1].next)}GS(p,()=>{for(var T=0;T<v;T++){var z=e[T];c||(l.delete(z.k),qo(i,z.prev,z.next)),fb(z.e,!c)}})}function Fa(i,e,n,l,p,v=null){var b=i,c={flags:e,items:new Map,first:null};Ui&&jf();var E=null;cy(()=>{var T=n(),z=VS(T)?T:T==null?[]:Array.from(T),B=z.length,$=c.flags;let q=!1;if(Ui){var Q=b.data===CS;Q!==(B===0)&&(b=G0(),qf(b),Ph(!1),q=!0)}if(Ui){for(var ae=null,ie,Y=0;Y<B;Y++){if(fo.nodeType===8&&fo.data===MS){b=fo,q=!0,Ph(!1);break}var be=z[Y],fe=l(be,Y);ie=xb(fo,c,ae,null,be,fe,Y,p,$),c.items.set(fe,ie),ae=ie}B>0&&qf(G0())}Ui||aI(z,c,b,p,$,l),v!==null&&(B===0?E?hy(E):E=Vp(()=>v(b)):E!==null&&uy(E,()=>{E=null})),q&&Ph(!0)}),Ui&&(b=fo)}function aI(i,e,n,l,p,v){var b=i.length,c=e.items,E=e.first,T=E,z=new Set,B=null,$=[],q=[],Q,ae,ie,Y;for(Y=0;Y<b;Y+=1){if(Q=i[Y],ae=v(Q,Y),ie=c.get(ae),ie===void 0){var be=T?T.e.nodes.start:n;B=xb(be,e,B,B===null?e.first:B.next,Q,ae,Y,l,p),c.set(ae,B),$=[],q=[],T=B.next;continue}if(oI(ie,Q,Y),ie.e.f&jS&&hy(ie.e),ie!==T){if(z.has(ie)){if($.length<q.length){var fe=q[0],de;B=fe.prev;var Se=$[0],Me=$[$.length-1];for(de=0;de<$.length;de+=1)X0($[de],fe,n);for(de=0;de<q.length;de+=1)z.delete(q[de]);qo(e,Se.prev,Me.next),qo(e,B,Se),qo(e,Me,fe),T=fe,B=Me,Y-=1,$=[],q=[]}else z.delete(ie),X0(ie,T,n),qo(e,ie.prev,ie.next),qo(e,ie,B===null?e.first:B.next),qo(e,B,ie),B=ie;continue}for($=[],q=[];T!==null&&T.k!==ae;)z.add(T),q.push(T),T=T.next;if(T===null)continue;ie=T}$.push(ie),B=ie,T=ie.next}const Ge=Array.from(z);for(;T!==null;)Ge.push(T),T=T.next;var Ee=Ge.length;if(Ee>0){var Ve=null;sI(e,Ge,Ve,c)}Gf.first=e.first&&e.first.e,Gf.last=B&&B.e}function oI(i,e,n,l){ot(i.v,e),i.i=n}function xb(i,e,n,l,p,v,b,c,E){var T=Vc;try{var z=(E&DS)!==0,B=(E&PS)===0,$=z?B?xt(p):Z0(p):p,q=E&LS?Z0(b):b,Q={i:q,v:$,k:v,a:null,e:null,prev:n,next:l};return Vc=Q,Q.e=Vp(()=>c(i,$,q),Ui),Q.e.prev=n&&n.e,Q.e.next=l&&l.e,n===null?e.first=Q:(n.next=Q,n.e.next=Q.e),l!==null&&(l.prev=Q,l.e.prev=Q.e),Q}finally{Vc=T}}function X0(i,e,n){for(var l=i.next?i.next.e.nodes.start:n,p=e?e.e.nodes.start:n,v=i.e.nodes.start;v!==l;){var b=v.nextSibling;p.before(v),v=b}}function qo(i,e,n){e===null?i.first=n:(e.next=n,e.e.next=n&&n.e),n!==null&&(n.prev=e,n.e.prev=e&&e.e)}function Fh(i,e,n,l,p,v){let b=Ui;Ui&&jf();var c,E,T=null;Ui&&fo.nodeType===1&&(T=fo,jf());var z=Ui?fo:i,B,$=Vc;cy(()=>{const q=e()||null;var Q=q==="svg"?db:null;if(q!==c){var ae=Vc;K0($),B&&(q===null?uy(B,()=>{B=null,E=null}):q===E?hy(B):(fb(B),H0(!1))),q&&q!==E&&(B=Vp(()=>{if(T=Ui?T:Q?document.createElementNS(Q,q):document.createElement(q),BS(T,T),l){var ie=Ui?T.firstChild:T.appendChild(RS());Ui&&(ie===null?Ph(!1):qf(ie)),l(T,ie)}Gf.nodes.end=T,z.before(T)})),c=q,c&&(E=c),H0(!0),K0(ae)}},pb),b&&(Ph(!0),qf(z))}function Ho(i,e,n){mb(()=>{var l=gb(()=>e(i,n==null?void 0:n())||{});if(n&&(l!=null&&l.update)){var p=!1;yb(()=>{var v=n();ze(v),p&&l.update(v)}),p=!0}if(l!=null&&l.destroy)return()=>l.destroy()})}function lI(i,e){if(e){const n=document.body;i.autofocus=!0,Zf(()=>{document.activeElement===n&&i.focus()})}}let J0=!1;function wb(){J0||(J0=!0,document.addEventListener("reset",i=>{Promise.resolve().then(()=>{var e;if(!i.defaultPrevented)for(const n of i.target.elements)(e=n.__on_r)==null||e.call(n)})},{capture:!0}))}function fy(i){if(Ui){var e=!1,n=()=>{if(!e){if(e=!0,i.hasAttribute("value")){var l=i.value;yn(i,"value",null),i.value=l}if(i.hasAttribute("checked")){var p=i.checked;yn(i,"checked",null),i.checked=p}}};i.__on_r=n,ZS(n),wb()}}function yn(i,e,n){n=n==null?null:n+"";var l=i.__attributes??(i.__attributes={});Ui&&(l[e]=i.getAttribute(e),e==="src"||e==="href"||e==="srcset")||l[e]!==(l[e]=n)&&(e==="loading"&&(i[WS]=n),n===null?i.removeAttribute(e):i.setAttribute(e,n))}function cI(i,e,n){if(e in i){var l=i[e],p=typeof l=="boolean"&&n===""?!0:n;(typeof l!="object"||l!==p)&&(i[e]=p)}else yn(i,e,n)}function ji(i,e,n,l,p){var v=p.length!==0,b=e||{},c=i.tagName==="OPTION";for(var E in e)E in n||(n[E]=null);v&&!n.class&&(n.class="");var T=Q0.get(i.nodeName);T||Q0.set(i.nodeName,T=hI(i));var z=i.__attributes??(i.__attributes={}),B=[];for(const ie in n){let Y=n[ie];if(c&&ie==="value"&&Y==null){i.value=i.__value="",b[ie]=Y;continue}var $=b[ie];if(Y!==$){b[ie]=Y;var q=ie[0]+ie[1];if(q!=="$$")if(q==="on"){const be={},fe="$$"+ie;let de=ie.slice(2);var Q=NS.includes(de);if(FS(de)&&(de=de.slice(0,-7),be.capture=!0),!Q&&$){if(Y!=null)continue;i.removeEventListener(de,b[fe],be),b[fe]=null}if(Y!=null)if(Q)i[`__${de}`]=Y,iI([de]);else{let Se=function(Me){b[ie].call(this,Me)};e?b[fe]=Y0(de,i,Se,be):B.push([ie,Y,()=>b[fe]=Y0(de,i,Se,be)])}}else if(Y==null)z[ie]=null,i.removeAttribute(ie);else if(ie==="style")i.style.cssText=Y+"";else if(ie==="autofocus")lI(i,!!Y);else if(ie==="__value"||ie==="value")i.value=i[ie]=i.__value=Y;else{var ae=ie;l&&(ae=ae.toLowerCase(),ae=OS[ae]||ae),T.includes(ae)?Ui&&(ae==="src"||ae==="href"||ae==="srcset")||(i[ae]=Y):typeof Y!="function"&&(v&&ae==="class"&&(Y&&(Y+=" "),Y+=p),yn(i,ae,Y))}}}return e||Zf(()=>{if(i.isConnected)for(const[ie,Y,be]of B)b[ie]===Y&&be()}),b}function Oh(i,e,n,l){if(i.tagName.includes("-")){for(var p in e)p in n||(n[p]=null);for(p in n)cI(i,p,n[p]);return n}return ji(i,e,n,i.namespaceURI!==db,l)}var uI=["width","height"],Q0=new Map;function hI(i){for(var e=[],n,l=W0(i);l.constructor.name!=="Element";){n=HS(l);for(var p in n)n[p].set&&!uI.includes(p)&&e.push(p);l=W0(l)}return e}function Sb(i,e){var n=i.__className,l=Ib(e);Ui&&i.getAttribute("class")===l?i.__className=l:(n!==l||Ui&&i.getAttribute("class")!==l)&&(l===""?i.removeAttribute("class"):i.setAttribute("class",l),i.__className=l)}function kn(i,e){var n=i.__className,l=Ib(e);Ui&&i.className===l?i.__className=l:(n!==l||Ui&&i.className!==l)&&(e==null?i.removeAttribute("class"):i.className=l,i.__className=l)}function Ib(i){return i??""}function dI(i,e,n){n?i.classList.add(e):i.classList.remove(e)}const Tb=typeof window<"u",fI=Tb?requestAnimationFrame:Ef,pI=Tb?()=>performance.now():()=>Date.now(),go={tick:i=>fI(i),now:()=>pI(),tasks:new Set};function kb(i){go.tasks.forEach(e=>{e.c(i)||(go.tasks.delete(e),e.f())}),go.tasks.size!==0&&go.tick(kb)}function mI(i){let e;return go.tasks.size===0&&go.tick(kb),{promise:new Promise(n=>{go.tasks.add(e={c:i,f:n})}),abort(){go.tasks.delete(e)}}}function gf(i,e){i.dispatchEvent(new CustomEvent(e))}function gI(i){const e=i.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(n=>n[0].toUpperCase()+n.slice(1)).join("")}function ev(i){const e={},n=i.split(";");for(const l of n){const[p,v]=l.split(":");if(!p||v===void 0)break;const b=gI(p.trim());e[b]=v.trim()}return e}const yI=i=>i;function Ab(i,e,n,l){var p=(i&US)!==0,v="both",b,c=e.inert,E,T;function z(){return b??(b=n()(e,l==null?void 0:l(),{direction:v}))}var B={is_global:p,in(){e.inert=c,T==null||T.abort(),E==null||E.abort(),gf(e,"introstart"),E=Mg(e,z(),T,1,()=>{gf(e,"introend"),E=b=void 0},void 0)},out(Q){T==null||T.abort(),e.inert=!0,gf(e,"outrostart"),T=Mg(e,z(),E,0,()=>{gf(e,"outroend"),T=b=void 0,Q==null||Q()},void 0),T.reset},stop:()=>{E==null||E.abort(),T==null||T.abort()}},$=Gf;if(($.transitions??($.transitions=[])).push(B),nI){let Q=p;if(!Q){for(var q=$.parent;q&&q.f&pb;)for(;(q=q.parent)&&!(q.f&YS););Q=!q||(q.f&KS)!==0}Q&&mb(()=>{gb(()=>B.in())})}}function Mg(i,e,n,l,p,v){var b=l===1;if(XS(e)){var c;return Zf(()=>{var fe=e({direction:b?"in":"out"});c=Mg(i,fe,n,l,p,v)}),{abort:()=>c.abort(),deactivate:()=>c.deactivate(),reset:()=>c.reset(),t:fe=>c.t(fe)}}if(n==null||n.deactivate(),!(e!=null&&e.duration))return p==null||p(),{abort:Ef,deactivate:Ef,reset:Ef,t:()=>l};const{delay:E=0,css:T,tick:z,easing:B=yI}=e;var $=go.now()+E,q=(n==null?void 0:n.t($))??1-l,Q=l-q,ae=e.duration*Math.abs(Q),ie=$+ae,Y,be;return T?Zf(()=>{var fe=[],de=Math.ceil(ae/16.666666666666668);if(b&&E>0){let Ee=Math.ceil(E/16.666666666666668),Ve=ev(T(0,1));for(let De=0;De<Ee;De+=1)fe.push(Ve)}for(var Se=0;Se<=de;Se+=1){var Me=q+Q*B(Se/de),Ge=T(Me,1-Me);fe.push(ev(Ge))}Y=i.animate(fe,{delay:b?0:E,duration:ae+(b?E:0),easing:"linear",fill:"forwards"}),Y.finished.then(()=>{p==null||p(),l===1&&Y.cancel()}).catch(Ee=>{if(Y.startTime!==null&&Y.currentTime!==null)throw Ee})}):(q===0&&(z==null||z(0,1)),be=mI(fe=>{if(fe>=ie)return z==null||z(l,1-l),p==null||p(),!1;if(fe>=$){var de=q+Q*B((fe-$)/ae);z==null||z(de,1-de)}return!0})),{abort:()=>{Y==null||Y.cancel(),be==null||be.abort(),v==null||v()},deactivate:()=>{p=void 0,v=void 0},reset:()=>{l===0&&(z==null||z(1,0))},t:fe=>{var de=q+Q*B((fe-$)/ae);return Math.min(1,Math.max(0,de))}}}function _I(i,e,n,l=n){i.addEventListener(e,n);const p=i.__on_r;p?i.__on_r=()=>{p(),l()}:i.__on_r=l,wb()}function py(i,e,n){_I(i,"input",()=>{n(tv(i)?rv(i.value):i.value)}),yb(()=>{var l=e();if(Ui&&i.defaultValue!==i.value){n(i.value);return}tv(i)&&l===rv(i.value)||i.type==="date"&&!l&&!i.value||(i.value=l??"")})}function tv(i){var e=i.type;return e==="number"||e==="range"}function rv(i){return i===""?null:+i}function vI(i,e,n){var l=QS(i,e);l&&l.set&&(i[e]=n,JS(()=>{i[e]=null}))}var bI=rt('<div class="left svelte-kic6jv"><!></div> <div class="main svelte-kic6jv"><!></div>',1);function xI(i,e){var c,E;var n=bI(),l=mt(n),p=ct(l);cr(p,(c=e.$$slots)==null?void 0:c.left,{},null),ut(l);var v=Ae(Ae(l,!0)),b=ct(v);cr(b,(E=e.$$slots)==null?void 0:E.main,{},null),ut(v),xe(i,n)}var wI=rt("<div><!></div> <div><!></div>",1);function my(i,e){var z,B;const n=An(),l=()=>Ir(Dg,"$sidebarContents",n),p=()=>Ir(iv,"$mapContents",n);var v=wI(),b=mt(v);Wo(b,$=>Bi(Dg,$),()=>l());var c=ct(b);cr(c,(z=e.$$slots)==null?void 0:z.sidebar,{},null),ut(b);var E=Ae(Ae(b,!0));Wo(E,$=>Bi(iv,$),()=>p());var T=ct(E);cr(T,(B=e.$$slots)==null?void 0:B.map,{},null),ut(E),xe(i,v)}let Dg=hi(null),iv=hi(null);/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Eb=Symbol("Comlink.proxy"),SI=Symbol("Comlink.endpoint"),II=Symbol("Comlink.releaseProxy"),hg=Symbol("Comlink.finalizer"),Cf=Symbol("Comlink.thrown"),Cb=i=>typeof i=="object"&&i!==null||typeof i=="function",TI={canHandle:i=>Cb(i)&&i[Eb],serialize(i){const{port1:e,port2:n}=new MessageChannel;return jp(i,e),[n,[n]]},deserialize(i){return i.start(),Pg(i)}},kI={canHandle:i=>Cb(i)&&Cf in i,serialize({value:i}){let e;return i instanceof Error?e={isError:!0,value:{message:i.message,name:i.name,stack:i.stack}}:e={isError:!1,value:i},[e,[]]},deserialize(i){throw i.isError?Object.assign(new Error(i.value.message),i.value):i.value}},Mb=new Map([["proxy",TI],["throw",kI]]);function AI(i,e){for(const n of i)if(e===n||n==="*"||n instanceof RegExp&&n.test(e))return!0;return!1}function jp(i,e=globalThis,n=["*"]){e.addEventListener("message",function l(p){if(!p||!p.data)return;if(!AI(n,p.origin)){console.warn(`Invalid origin '${p.origin}' for comlink proxy`);return}const{id:v,type:b,path:c}=Object.assign({path:[]},p.data),E=(p.data.argumentList||[]).map(El);let T;try{const z=c.slice(0,-1).reduce(($,q)=>$[q],i),B=c.reduce(($,q)=>$[q],i);switch(b){case"GET":T=B;break;case"SET":z[c.slice(-1)[0]]=El(p.data.value),T=!0;break;case"APPLY":T=B.apply(z,E);break;case"CONSTRUCT":{const $=new B(...E);T=LI($)}break;case"ENDPOINT":{const{port1:$,port2:q}=new MessageChannel;jp(i,q),T=PI($,[$])}break;case"RELEASE":T=void 0;break;default:return}}catch(z){T={value:z,[Cf]:0}}Promise.resolve(T).catch(z=>({value:z,[Cf]:0})).then(z=>{const[B,$]=Yf(z);e.postMessage(Object.assign(Object.assign({},B),{id:v}),$),b==="RELEASE"&&(e.removeEventListener("message",l),Db(e),hg in i&&typeof i[hg]=="function"&&i[hg]())}).catch(z=>{const[B,$]=Yf({value:new TypeError("Unserializable return value"),[Cf]:0});e.postMessage(Object.assign(Object.assign({},B),{id:v}),$)})}),e.start&&e.start()}function EI(i){return i.constructor.name==="MessagePort"}function Db(i){EI(i)&&i.close()}function Pg(i,e){return Lg(i,[],e)}function yf(i){if(i)throw new Error("Proxy has been released and is not useable")}function Pb(i){return Ec(i,{type:"RELEASE"}).then(()=>{Db(i)})}const Wf=new WeakMap,Hf="FinalizationRegistry"in globalThis&&new FinalizationRegistry(i=>{const e=(Wf.get(i)||0)-1;Wf.set(i,e),e===0&&Pb(i)});function CI(i,e){const n=(Wf.get(e)||0)+1;Wf.set(e,n),Hf&&Hf.register(i,e,i)}function MI(i){Hf&&Hf.unregister(i)}function Lg(i,e=[],n=function(){}){let l=!1;const p=new Proxy(n,{get(v,b){if(yf(l),b===II)return()=>{MI(p),Pb(i),l=!0};if(b==="then"){if(e.length===0)return{then:()=>p};const c=Ec(i,{type:"GET",path:e.map(E=>E.toString())}).then(El);return c.then.bind(c)}return Lg(i,[...e,b])},set(v,b,c){yf(l);const[E,T]=Yf(c);return Ec(i,{type:"SET",path:[...e,b].map(z=>z.toString()),value:E},T).then(El)},apply(v,b,c){yf(l);const E=e[e.length-1];if(E===SI)return Ec(i,{type:"ENDPOINT"}).then(El);if(E==="bind")return Lg(i,e.slice(0,-1));const[T,z]=nv(c);return Ec(i,{type:"APPLY",path:e.map(B=>B.toString()),argumentList:T},z).then(El)},construct(v,b){yf(l);const[c,E]=nv(b);return Ec(i,{type:"CONSTRUCT",path:e.map(T=>T.toString()),argumentList:c},E).then(El)}});return CI(p,i),p}function DI(i){return Array.prototype.concat.apply([],i)}function nv(i){const e=i.map(Yf);return[e.map(n=>n[0]),DI(e.map(n=>n[1]))]}const Lb=new WeakMap;function PI(i,e){return Lb.set(i,e),i}function LI(i){return Object.assign(i,{[Eb]:!0})}function Yf(i){for(const[e,n]of Mb)if(n.canHandle(i)){const[l,p]=n.serialize(i);return[{type:"HANDLER",name:e,value:l},p]}return[{type:"RAW",value:i},Lb.get(i)||[]]}function El(i){switch(i.type){case"HANDLER":return Mb.get(i.name).deserialize(i.value);case"RAW":return i.value}}function Ec(i,e,n){return new Promise(l=>{const p=zI();i.addEventListener("message",function v(b){!b.data||!b.data.id||b.data.id!==p||(i.removeEventListener("message",v),l(b.data))}),i.start&&i.start(),i.postMessage(Object.assign({id:p},e),n)})}function zI(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}let yr;const zb=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&zb.decode();let Sh=null;function Mf(){return(Sh===null||Sh.byteLength===0)&&(Sh=new Uint8Array(yr.memory.buffer)),Sh}function Aa(i,e){return i=i>>>0,zb.decode(Mf().subarray(i,i+e))}let Nc=0;const Df=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},BI=typeof Df.encodeInto=="function"?function(i,e){return Df.encodeInto(i,e)}:function(i,e){const n=Df.encode(i);return e.set(n),{read:i.length,written:n.length}};function _f(i,e,n){if(n===void 0){const c=Df.encode(i),E=e(c.length,1)>>>0;return Mf().subarray(E,E+c.length).set(c),Nc=c.length,E}let l=i.length,p=e(l,1)>>>0;const v=Mf();let b=0;for(;b<l;b++){const c=i.charCodeAt(b);if(c>127)break;v[p+b]=c}if(b!==l){b!==0&&(i=i.slice(b)),p=n(p,l,l=b+i.length*3,1)>>>0;const c=Mf().subarray(p+b,p+l),E=BI(i,c);b+=E.written,p=n(p,l,b,1)>>>0}return Nc=b,p}function yh(i){return i==null}let kl=null;function js(){return(kl===null||kl.buffer.detached===!0||kl.buffer.detached===void 0&&kl.buffer!==yr.memory.buffer)&&(kl=new DataView(yr.memory.buffer)),kl}function zg(i){const e=typeof i;if(e=="number"||e=="boolean"||i==null)return`${i}`;if(e=="string")return`"${i}"`;if(e=="symbol"){const p=i.description;return p==null?"Symbol":`Symbol(${p})`}if(e=="function"){const p=i.name;return typeof p=="string"&&p.length>0?`Function(${p})`:"Function"}if(Array.isArray(i)){const p=i.length;let v="[";p>0&&(v+=zg(i[0]));for(let b=1;b<p;b++)v+=", "+zg(i[b]);return v+="]",v}const n=/\[object ([^\]]+)\]/.exec(toString.call(i));let l;if(n.length>1)l=n[1];else return toString.call(i);if(l=="Object")try{return"Object("+JSON.stringify(i)+")"}catch{return"Object"}return i instanceof Error?`${i.name}: ${i.message}
${i.stack}`:l}const sv=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(i=>{yr.__wbindgen_export_3.get(i.dtor)(i.a,i.b)});function RI(i,e,n,l){const p={a:i,b:e,cnt:1,dtor:n},v=(...b)=>{p.cnt++;const c=p.a;p.a=0;try{return l(c,p.b,...b)}finally{--p.cnt===0?(yr.__wbindgen_export_3.get(p.dtor)(c,p.b),sv.unregister(p)):p.a=c}};return v.original=p,sv.register(v,p,p),v}function FI(i,e,n){yr.closure946_externref_shim(i,e,n)}function OI(i){const e=yr.__wbindgen_export_2.get(i);return yr.__externref_table_dealloc(i),e}function Il(i){return()=>{throw new Error(`${i} is not defined`)}}function NI(i){const e=yr.__externref_table_alloc();return yr.__wbindgen_export_2.set(e,i),e}function mn(i,e){try{return i.apply(this,e)}catch(n){const l=NI(n);yr.__wbindgen_exn_store(l)}}function UI(i,e,n,l){yr.closure14099_externref_shim(i,e,n,l)}const $I=["omit","same-origin","include"],VI=["same-origin","no-cors","cors","navigate"],av=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(i=>yr.__wbg_backend_free(i>>>0,1));class qp{static __wrap(e){e=e>>>0;const n=Object.create(qp.prototype);return n.__wbg_ptr=e,av.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,av.unregister(this),e}free(){const e=this.__destroy_into_raw();yr.__wbg_backend_free(e,0)}constructor(){return yr.backend_new()}getCountries(){return yr.backend_getCountries(this.__wbg_ptr)}search(e,n){return yr.backend_search(this.__wbg_ptr,e,n)}downloadMetrics(e){return yr.backend_downloadMetrics(this.__wbg_ptr,e)}downloadMetricsSql(e){return yr.backend_downloadMetricsSql(this.__wbg_ptr,e)}downloadGeoms(e){return yr.backend_downloadGeoms(this.__wbg_ptr,e)}downloadDataRequest(e){return yr.backend_downloadDataRequest(this.__wbg_ptr,e)}downloadDataRequestMetrics(e){return yr.backend_downloadDataRequestMetrics(this.__wbg_ptr,e)}downloadDataRequestMetricsSql(e){return yr.backend_downloadDataRequestMetricsSql(this.__wbg_ptr,e)}downloadDataRequestGeoms(e){return yr.backend_downloadDataRequestGeoms(this.__wbg_ptr,e)}downloadDataRequestGeomsPmtiles(e){return yr.backend_downloadDataRequestGeomsPmtiles(this.__wbg_ptr,e)}addColours(e){let n,l;try{const b=yr.backend_addColours(this.__wbg_ptr,e);var p=b[0],v=b[1];if(b[3])throw p=0,v=0,OI(b[2]);return n=p,l=v,Aa(p,v)}finally{yr.__wbindgen_free(n,l,1)}}}async function jI(i,e){if(typeof Response=="function"&&i instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(i,e)}catch(l){if(i.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",l);else throw l}const n=await i.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{const n=await WebAssembly.instantiate(i,e);return n instanceof WebAssembly.Instance?{instance:n,module:i}:n}}function qI(){const i={};return i.wbg={},i.wbg.__wbindgen_string_new=function(e,n){return Aa(e,n)},i.wbg.__wbindgen_string_get=function(e,n){const l=n,p=typeof l=="string"?l:void 0;var v=yh(p)?0:_f(p,yr.__wbindgen_malloc,yr.__wbindgen_realloc),b=Nc;js().setInt32(e+4*1,b,!0),js().setInt32(e+4*0,v,!0)},i.wbg.__wbg_backend_new=function(e){return qp.__wrap(e)},i.wbg.__wbindgen_boolean_get=function(e){const n=e;return typeof n=="boolean"?n?1:0:2},i.wbg.__wbindgen_is_bigint=function(e){return typeof e=="bigint"},i.wbg.__wbindgen_number_get=function(e,n){const l=n,p=typeof l=="number"?l:void 0;js().setFloat64(e+8*1,yh(p)?0:p,!0),js().setInt32(e+4*0,!yh(p),!0)},i.wbg.__wbindgen_is_object=function(e){const n=e;return typeof n=="object"&&n!==null},i.wbg.__wbindgen_in=function(e,n){return e in n},i.wbg.__wbindgen_bigint_from_i64=function(e){return e},i.wbg.__wbindgen_jsval_eq=function(e,n){return e===n},i.wbg.__wbindgen_bigint_from_u64=function(e){return BigInt.asUintN(64,e)},i.wbg.__wbindgen_error_new=function(e,n){return new Error(Aa(e,n))},i.wbg.__wbindgen_is_string=function(e){return typeof e=="string"},i.wbg.__wbindgen_is_undefined=function(e){return e===void 0},i.wbg.__wbindgen_cb_drop=function(e){const n=e.original;return n.cnt--==1?(n.a=0,!0):!1},i.wbg.__wbindgen_jsval_loose_eq=function(e,n){return e==n},i.wbg.__wbindgen_as_number=function(e){return+e},i.wbg.__wbg_getwithrefkey_edc2c8960f0f1191=function(e,n){return e[n]},i.wbg.__wbg_new_abda76e883ba8a5f=function(){return new Error},i.wbg.__wbg_stack_658279fe44541cf6=function(e,n){const l=n.stack,p=_f(l,yr.__wbindgen_malloc,yr.__wbindgen_realloc),v=Nc;js().setInt32(e+4*1,v,!0),js().setInt32(e+4*0,p,!0)},i.wbg.__wbg_error_f851667af71bcfc6=function(e,n){let l,p;try{l=e,p=n,console.error(Aa(e,n))}finally{yr.__wbindgen_free(l,p,1)}},i.wbg.__wbg_fetch_f8d735ba6fe1b719=typeof fetch=="function"?fetch:Il("fetch"),i.wbg.__wbg_queueMicrotask_848aa4969108a57e=function(e){return e.queueMicrotask},i.wbg.__wbindgen_is_function=function(e){return typeof e=="function"},i.wbg.__wbg_queueMicrotask_c5419c06eab41e73=typeof queueMicrotask=="function"?queueMicrotask:Il("queueMicrotask"),i.wbg.__wbg_fetch_1fdc4448ed9eec00=function(e,n){return e.fetch(n)},i.wbg.__wbg_debug_69675dd374e2c249=typeof console.debug=="function"?console.debug:Il("console.debug"),i.wbg.__wbg_error_53abcd6a461f73d8=typeof console.error=="function"?console.error:Il("console.error"),i.wbg.__wbg_info_f073b719c8035bbf=typeof console.info=="function"?console.info:Il("console.info"),i.wbg.__wbg_log_f740dc2253ea759b=typeof console.log=="function"?console.log:Il("console.log"),i.wbg.__wbg_warn_41503a1c2194de89=typeof console.warn=="function"?console.warn:Il("console.warn"),i.wbg.__wbg_newwithstrandinit_4b92c89af0a8e383=function(){return mn(function(e,n,l){return new Request(Aa(e,n),l)},arguments)},i.wbg.__wbg_setbody_aa8b691bec428bf4=function(e,n){e.body=n},i.wbg.__wbg_setcredentials_a4e661320cdb9738=function(e,n){e.credentials=$I[n]},i.wbg.__wbg_setheaders_f5205d36e423a544=function(e,n){e.headers=n},i.wbg.__wbg_setmethod_ce2da76000b02f6a=function(e,n,l){e.method=Aa(n,l)},i.wbg.__wbg_setmode_4919fd636102c586=function(e,n){e.mode=VI[n]},i.wbg.__wbg_setsignal_812ccb8269a7fd90=function(e,n){e.signal=n},i.wbg.__wbg_new_a9ae04a5200606a5=function(){return mn(function(){return new Headers},arguments)},i.wbg.__wbg_append_8b3e7f74a47ea7d5=function(){return mn(function(e,n,l,p,v){e.append(Aa(n,l),Aa(p,v))},arguments)},i.wbg.__wbg_instanceof_Response_3c0e210a57ff751d=function(e){let n;try{n=e instanceof Response}catch{n=!1}return n},i.wbg.__wbg_url_58af972663531d16=function(e,n){const l=n.url,p=_f(l,yr.__wbindgen_malloc,yr.__wbindgen_realloc),v=Nc;js().setInt32(e+4*1,v,!0),js().setInt32(e+4*0,p,!0)},i.wbg.__wbg_status_5f4e900d22140a18=function(e){return e.status},i.wbg.__wbg_headers_1b9bf90c73fae600=function(e){return e.headers},i.wbg.__wbg_arrayBuffer_144729e09879650e=function(){return mn(function(e){return e.arrayBuffer()},arguments)},i.wbg.__wbg_text_ebeee8b31af4c919=function(){return mn(function(e){return e.text()},arguments)},i.wbg.__wbg_signal_9acfcec9e7dffc22=function(e){return e.signal},i.wbg.__wbg_new_75169ae5a9683c55=function(){return mn(function(){return new AbortController},arguments)},i.wbg.__wbg_abort_c57daab47a6c1215=function(e){e.abort()},i.wbg.__wbg_crypto_1d1f22824a6a080c=function(e){return e.crypto},i.wbg.__wbg_process_4a72847cc503995b=function(e){return e.process},i.wbg.__wbg_versions_f686565e586dd935=function(e){return e.versions},i.wbg.__wbg_node_104a2ff8d6ea03a2=function(e){return e.node},i.wbg.__wbg_require_cca90b1a94a0255b=function(){return mn(function(){return module.require},arguments)},i.wbg.__wbg_msCrypto_eb05e62b530a1508=function(e){return e.msCrypto},i.wbg.__wbg_randomFillSync_5c9c955aa56b6049=function(){return mn(function(e,n){e.randomFillSync(n)},arguments)},i.wbg.__wbg_getRandomValues_3aa56aa6edec874c=function(){return mn(function(e,n){e.getRandomValues(n)},arguments)},i.wbg.__wbg_get_5419cf6b954aa11d=function(e,n){return e[n>>>0]},i.wbg.__wbg_length_f217bbbf7e8e4df4=function(e){return e.length},i.wbg.__wbg_newnoargs_1ede4bf2ebbaaf43=function(e,n){return new Function(Aa(e,n))},i.wbg.__wbg_next_13b477da1eaa3897=function(e){return e.next},i.wbg.__wbg_next_b06e115d1b01e10b=function(){return mn(function(e){return e.next()},arguments)},i.wbg.__wbg_done_983b5ffcaec8c583=function(e){return e.done},i.wbg.__wbg_value_2ab8a198c834c26a=function(e){return e.value},i.wbg.__wbg_iterator_695d699a44d6234c=function(){return Symbol.iterator},i.wbg.__wbg_get_ef828680c64da212=function(){return mn(function(e,n){return Reflect.get(e,n)},arguments)},i.wbg.__wbg_call_a9ef466721e824f2=function(){return mn(function(e,n){return e.call(n)},arguments)},i.wbg.__wbg_new_e69b5f66fda8f13c=function(){return new Object},i.wbg.__wbg_self_bf91bf94d9e04084=function(){return mn(function(){return self.self},arguments)},i.wbg.__wbg_window_52dd9f07d03fd5f8=function(){return mn(function(){return window.window},arguments)},i.wbg.__wbg_globalThis_05c129bf37fcf1be=function(){return mn(function(){return globalThis.globalThis},arguments)},i.wbg.__wbg_global_3eca19bb09e9c484=function(){return mn(function(){return global.global},arguments)},i.wbg.__wbg_isArray_6f3b47f09adb61b5=function(e){return Array.isArray(e)},i.wbg.__wbg_instanceof_ArrayBuffer_74945570b4a62ec7=function(e){let n;try{n=e instanceof ArrayBuffer}catch{n=!1}return n},i.wbg.__wbg_call_3bfa248576352471=function(){return mn(function(e,n,l){return e.call(n,l)},arguments)},i.wbg.__wbg_instanceof_Map_f96986929e7e89ed=function(e){let n;try{n=e instanceof Map}catch{n=!1}return n},i.wbg.__wbg_isSafeInteger_b9dff570f01a9100=function(e){return Number.isSafeInteger(e)},i.wbg.__wbg_entries_c02034de337d3ee2=function(e){return Object.entries(e)},i.wbg.__wbg_new_1073970097e5a420=function(e,n){try{var l={a:e,b:n},p=(b,c)=>{const E=l.a;l.a=0;try{return UI(E,l.b,b,c)}finally{l.a=E}};return new Promise(p)}finally{l.a=l.b=0}},i.wbg.__wbg_resolve_0aad7c1484731c99=function(e){return Promise.resolve(e)},i.wbg.__wbg_then_748f75edfb032440=function(e,n){return e.then(n)},i.wbg.__wbg_then_4866a7d9f55d8f3e=function(e,n,l){return e.then(n,l)},i.wbg.__wbg_buffer_ccaed51a635d8a2d=function(e){return e.buffer},i.wbg.__wbg_newwithbyteoffsetandlength_7e3eb787208af730=function(e,n,l){return new Uint8Array(e,n>>>0,l>>>0)},i.wbg.__wbg_new_fec2611eb9180f95=function(e){return new Uint8Array(e)},i.wbg.__wbg_set_ec2fcf81bc573fd9=function(e,n,l){e.set(n,l>>>0)},i.wbg.__wbg_length_9254c4bd3b9f23c4=function(e){return e.length},i.wbg.__wbg_instanceof_Uint8Array_df0761410414ef36=function(e){let n;try{n=e instanceof Uint8Array}catch{n=!1}return n},i.wbg.__wbg_newwithlength_76462a666eca145f=function(e){return new Uint8Array(e>>>0)},i.wbg.__wbg_subarray_975a06f9dbd16995=function(e,n,l){return e.subarray(n>>>0,l>>>0)},i.wbg.__wbg_stringify_eead5648c09faaf8=function(){return mn(function(e){return JSON.stringify(e)},arguments)},i.wbg.__wbg_has_bd717f25f195f23d=function(){return mn(function(e,n){return Reflect.has(e,n)},arguments)},i.wbg.__wbindgen_bigint_get_as_i64=function(e,n){const l=n,p=typeof l=="bigint"?l:void 0;js().setBigInt64(e+8*1,yh(p)?BigInt(0):p,!0),js().setInt32(e+4*0,!yh(p),!0)},i.wbg.__wbindgen_debug_string=function(e,n){const l=zg(n),p=_f(l,yr.__wbindgen_malloc,yr.__wbindgen_realloc),v=Nc;js().setInt32(e+4*1,v,!0),js().setInt32(e+4*0,p,!0)},i.wbg.__wbindgen_throw=function(e,n){throw new Error(Aa(e,n))},i.wbg.__wbindgen_memory=function(){return yr.memory},i.wbg.__wbindgen_closure_wrapper2217=function(e,n,l){return RI(e,n,947,FI)},i.wbg.__wbindgen_init_externref_table=function(){const e=yr.__wbindgen_export_2,n=e.grow(4);e.set(0,void 0),e.set(n+0,void 0),e.set(n+1,null),e.set(n+2,!0),e.set(n+3,!1)},i}function GI(i,e){return yr=i.exports,Bb.__wbindgen_wasm_module=e,kl=null,Sh=null,yr.__wbindgen_start(),yr}async function Bb(i){if(yr!==void 0)return yr;typeof i<"u"&&(Object.getPrototypeOf(i)===Object.prototype?{module_or_path:i}=i:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof i>"u"&&(i=new URL("rust_backend_bg.wasm",import.meta.url));const e=qI();(typeof i=="string"||typeof Request=="function"&&i instanceof Request||typeof URL=="function"&&i instanceof URL)&&(i=fetch(i));const{instance:n,module:l}=await jI(await i,e);return GI(n,l)}class ZI{constructor(){cg(this,"inner");this.inner=null}async initialise(){await Bb(),this.inner=await new qp}unset(){this.inner=null}isLoaded(){return this.inner!=null}async addColours(e){if(!this.inner)throw new Error("RustBackend not initialised");const n=JSON.parse(this.inner.addColours(e));return console.log("RustBackend.addColours result",n),n}async getCountries(){if(!this.inner)throw new Error("RustBackend not initialised");const e=JSON.parse(await this.inner.getCountries());return console.log("RustBackend.getCountries result",e),e}async search(e,n){if(!this.inner)throw new Error("RustBackend not initialised");return JSON.parse(await this.inner.search(e,n))}async downloadMetrics(e){if(!this.inner)throw new Error("RustBackend not initialised");return JSON.parse(await this.inner.downloadMetrics(e))}async downloadGeoms(e){if(!this.inner)throw new Error("RustBackend not initialised");return JSON.parse(await this.inner.downloadGeoms(e))}async downloadDataRequestMetrics(e){if(!this.inner)throw new Error("RustBackend not initialised");return await this.inner.downloadDataRequestMetrics(e)}async downloadDataRequestMetricsSql(e){if(!this.inner)throw new Error("RustBackend not initialised");return await this.inner.downloadDataRequestMetricsSql(e)}async downloadDataRequestGeoms(e){if(!this.inner)throw new Error("RustBackend not initialised");return JSON.parse(await this.inner.downloadDataRequestGeoms(e))}async downloadDataRequestGeomsPmtiles(e){if(!this.inner)throw new Error("RustBackend not initialised");return await this.inner.downloadDataRequestGeomsPmtiles(e)}async downloadDataRequest(e){if(!this.inner)throw new Error("RustBackend not initialised");return JSON.parse(await this.inner.downloadDataRequest(e))}}jp(ZI);function lr(i,e,n,l){function p(v){return v instanceof n?v:new n(function(b){b(v)})}return new(n||(n=Promise))(function(v,b){function c(z){try{T(l.next(z))}catch(B){b(B)}}function E(z){try{T(l.throw(z))}catch(B){b(B)}}function T(z){z.done?v(z.value):p(z.value).then(c,E)}T((l=l.apply(i,e||[])).next())})}function ov(i){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&i[e],l=0;if(n)return n.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&l>=i.length&&(i=void 0),{value:i&&i[l++],done:!i}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Sr(i){return this instanceof Sr?(this.v=i,this):new Sr(i)}function za(i,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l=n.apply(i,e||[]),p,v=[];return p={},c("next"),c("throw"),c("return",b),p[Symbol.asyncIterator]=function(){return this},p;function b(q){return function(Q){return Promise.resolve(Q).then(q,B)}}function c(q,Q){l[q]&&(p[q]=function(ae){return new Promise(function(ie,Y){v.push([q,ae,ie,Y])>1||E(q,ae)})},Q&&(p[q]=Q(p[q])))}function E(q,Q){try{T(l[q](Q))}catch(ae){$(v[0][3],ae)}}function T(q){q.value instanceof Sr?Promise.resolve(q.value.v).then(z,B):$(v[0][2],q)}function z(q){E("next",q)}function B(q){E("throw",q)}function $(q,Q){q(Q),v.shift(),v.length&&E(v[0][0],v[0][1])}}function Pf(i){var e,n;return e={},l("next"),l("throw",function(p){throw p}),l("return"),e[Symbol.iterator]=function(){return this},e;function l(p,v){e[p]=i[p]?function(b){return(n=!n)?{value:Sr(i[p](b)),done:!1}:v?v(b):b}:v}}function Dl(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=i[Symbol.asyncIterator],n;return e?e.call(i):(i=typeof ov=="function"?ov(i):i[Symbol.iterator](),n={},l("next"),l("throw"),l("return"),n[Symbol.asyncIterator]=function(){return this},n);function l(v){n[v]=i[v]&&function(b){return new Promise(function(c,E){b=i[v](b),p(c,E,b.done,b.value)})}}function p(v,b,c,E){Promise.resolve(E).then(function(T){v({value:T,done:c})},b)}}const WI=new TextDecoder("utf-8"),Bg=i=>WI.decode(i),HI=new TextEncoder,gy=i=>HI.encode(i),YI=i=>typeof i=="number",Rb=i=>typeof i=="boolean",gn=i=>typeof i=="function",ws=i=>i!=null&&Object(i)===i,Bl=i=>ws(i)&&gn(i.then),Xh=i=>ws(i)&&gn(i[Symbol.iterator]),ou=i=>ws(i)&&gn(i[Symbol.asyncIterator]),Rg=i=>ws(i)&&ws(i.schema),Fb=i=>ws(i)&&"done"in i&&"value"in i,Ob=i=>ws(i)&&gn(i.stat)&&YI(i.fd),Nb=i=>ws(i)&&yy(i.body),Gp=i=>"_getDOMStream"in i&&"_getNodeStream"in i,KI=i=>ws(i)&&gn(i.abort)&&gn(i.getWriter)&&!Gp(i),yy=i=>ws(i)&&gn(i.cancel)&&gn(i.getReader)&&!Gp(i),XI=i=>ws(i)&&gn(i.end)&&gn(i.write)&&Rb(i.writable)&&!Gp(i),Ub=i=>ws(i)&&gn(i.read)&&gn(i.pipe)&&Rb(i.readable)&&!Gp(i),JI=i=>ws(i)&&gn(i.clear)&&gn(i.bytes)&&gn(i.position)&&gn(i.setPosition)&&gn(i.capacity)&&gn(i.getBufferIdentifier)&&gn(i.createLong),_y=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:ArrayBuffer;function QI(i){const e=i[0]?[i[0]]:[];let n,l,p,v;for(let b,c,E=0,T=0,z=i.length;++E<z;){if(b=e[T],c=i[E],!b||!c||b.buffer!==c.buffer||c.byteOffset<b.byteOffset){c&&(e[++T]=c);continue}if({byteOffset:n,byteLength:p}=b,{byteOffset:l,byteLength:v}=c,n+p<l||l+v<n){c&&(e[++T]=c);continue}e[T]=new Uint8Array(b.buffer,n,l-n+v)}return e}function lv(i,e,n=0,l=e.byteLength){const p=i.byteLength,v=new Uint8Array(i.buffer,i.byteOffset,p),b=new Uint8Array(e.buffer,e.byteOffset,Math.min(l,p));return v.set(b,n),i}function Na(i,e){const n=QI(i),l=n.reduce((z,B)=>z+B.byteLength,0);let p,v,b,c=0,E=-1;const T=Math.min(e||Number.POSITIVE_INFINITY,l);for(const z=n.length;++E<z;){if(p=n[E],v=p.subarray(0,Math.min(p.length,T-c)),T<=c+v.length){v.length<p.length?n[E]=p.subarray(v.length):v.length===p.length&&E++,b?lv(b,v,c):b=v;break}lv(b||(b=new Uint8Array(T)),v,c),c+=v.length}return[b||new Uint8Array(0),n.slice(E),l-(b?b.byteLength:0)]}function si(i,e){let n=Fb(e)?e.value:e;return n instanceof i?i===Uint8Array?new i(n.buffer,n.byteOffset,n.byteLength):n:n?(typeof n=="string"&&(n=gy(n)),n instanceof ArrayBuffer?new i(n):n instanceof _y?new i(n):JI(n)?si(i,n.bytes()):ArrayBuffer.isView(n)?n.byteLength<=0?new i(0):new i(n.buffer,n.byteOffset,n.byteLength/i.BYTES_PER_ELEMENT):i.from(n)):new i(0)}const _h=i=>si(Int32Array,i),cv=i=>si(BigInt64Array,i),Fr=i=>si(Uint8Array,i),Fg=i=>(i.next(),i);function*eT(i,e){const n=function*(p){yield p},l=typeof e=="string"||ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof _y?n(e):Xh(e)?e:n(e);return yield*Fg(function*(p){let v=null;do v=p.next(yield si(i,v));while(!v.done)}(l[Symbol.iterator]())),new i}const tT=i=>eT(Uint8Array,i);function $b(i,e){return za(this,arguments,function*(){if(Bl(e))return yield Sr(yield Sr(yield*Pf(Dl($b(i,yield Sr(e))))));const l=function(b){return za(this,arguments,function*(){yield yield Sr(yield Sr(b))})},p=function(b){return za(this,arguments,function*(){yield Sr(yield*Pf(Dl(Fg(function*(c){let E=null;do E=c.next(yield E==null?void 0:E.value);while(!E.done)}(b[Symbol.iterator]())))))})},v=typeof e=="string"||ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof _y?l(e):Xh(e)?p(e):ou(e)?e:l(e);return yield Sr(yield*Pf(Dl(Fg(function(b){return za(this,arguments,function*(){let c=null;do c=yield Sr(b.next(yield yield Sr(si(i,c))));while(!c.done)})}(v[Symbol.asyncIterator]()))))),yield Sr(new i)})}const rT=i=>$b(Uint8Array,i);function Vb(i,e,n){if(i!==0){n=n.slice(0,e);for(let l=-1,p=n.length;++l<p;)n[l]+=i}return n.subarray(0,e)}function iT(i,e){let n=0;const l=i.length;if(l!==e.length)return!1;if(l>0)do if(i[n]!==e[n])return!1;while(++n<l);return!0}const Gs={fromIterable(i){return vf(nT(i))},fromAsyncIterable(i){return vf(sT(i))},fromDOMStream(i){return vf(aT(i))},fromNodeStream(i){return vf(lT(i))},toDOMStream(i,e){throw new Error('"toDOMStream" not available in this environment')},toNodeStream(i,e){throw new Error('"toNodeStream" not available in this environment')}},vf=i=>(i.next(),i);function*nT(i){let e,n=!1,l=[],p,v,b,c=0;function E(){return v==="peek"?Na(l,b)[0]:([p,l,c]=Na(l,b),p)}({cmd:v,size:b}=(yield null)||{cmd:"read",size:0});const T=tT(i)[Symbol.iterator]();try{do if({done:e,value:p}=Number.isNaN(b-c)?T.next():T.next(b-c),!e&&p.byteLength>0&&(l.push(p),c+=p.byteLength),e||b<=c)do({cmd:v,size:b}=yield E());while(b<c);while(!e)}catch(z){(n=!0)&&typeof T.throw=="function"&&T.throw(z)}finally{n===!1&&typeof T.return=="function"&&T.return(null)}return null}function sT(i){return za(this,arguments,function*(){let n,l=!1,p=[],v,b,c,E=0;function T(){return b==="peek"?Na(p,c)[0]:([v,p,E]=Na(p,c),v)}({cmd:b,size:c}=(yield yield Sr(null))||{cmd:"read",size:0});const z=rT(i)[Symbol.asyncIterator]();try{do if({done:n,value:v}=Number.isNaN(c-E)?yield Sr(z.next()):yield Sr(z.next(c-E)),!n&&v.byteLength>0&&(p.push(v),E+=v.byteLength),n||c<=E)do({cmd:b,size:c}=yield yield Sr(T()));while(c<E);while(!n)}catch(B){(l=!0)&&typeof z.throw=="function"&&(yield Sr(z.throw(B)))}finally{l===!1&&typeof z.return=="function"&&(yield Sr(z.return(new Uint8Array(0))))}return yield Sr(null)})}function aT(i){return za(this,arguments,function*(){let n=!1,l=!1,p=[],v,b,c,E=0;function T(){return b==="peek"?Na(p,c)[0]:([v,p,E]=Na(p,c),v)}({cmd:b,size:c}=(yield yield Sr(null))||{cmd:"read",size:0});const z=new oT(i);try{do if({done:n,value:v}=Number.isNaN(c-E)?yield Sr(z.read()):yield Sr(z.read(c-E)),!n&&v.byteLength>0&&(p.push(Fr(v)),E+=v.byteLength),n||c<=E)do({cmd:b,size:c}=yield yield Sr(T()));while(c<E);while(!n)}catch(B){(l=!0)&&(yield Sr(z.cancel(B)))}finally{l===!1?yield Sr(z.cancel()):i.locked&&z.releaseLock()}return yield Sr(null)})}class oT{constructor(e){this.source=e,this.reader=null,this.reader=this.source.getReader(),this.reader.closed.catch(()=>{})}get closed(){return this.reader?this.reader.closed.catch(()=>{}):Promise.resolve()}releaseLock(){this.reader&&this.reader.releaseLock(),this.reader=null}cancel(e){return lr(this,void 0,void 0,function*(){const{reader:n,source:l}=this;n&&(yield n.cancel(e).catch(()=>{})),l&&l.locked&&this.releaseLock()})}read(e){return lr(this,void 0,void 0,function*(){if(e===0)return{done:this.reader==null,value:new Uint8Array(0)};const n=yield this.reader.read();return!n.done&&(n.value=Fr(n)),n})}}const dg=(i,e)=>{const n=p=>l([e,p]);let l;return[e,n,new Promise(p=>(l=p)&&i.once(e,n))]};function lT(i){return za(this,arguments,function*(){const n=[];let l="error",p=!1,v=null,b,c,E=0,T=[],z;function B(){return b==="peek"?Na(T,c)[0]:([z,T,E]=Na(T,c),z)}if({cmd:b,size:c}=(yield yield Sr(null))||{cmd:"read",size:0},i.isTTY)return yield yield Sr(new Uint8Array(0)),yield Sr(null);try{n[0]=dg(i,"end"),n[1]=dg(i,"error");do{if(n[2]=dg(i,"readable"),[l,v]=yield Sr(Promise.race(n.map(q=>q[2]))),l==="error")break;if((p=l==="end")||(Number.isFinite(c-E)?(z=Fr(i.read(c-E)),z.byteLength<c-E&&(z=Fr(i.read()))):z=Fr(i.read()),z.byteLength>0&&(T.push(z),E+=z.byteLength)),p||c<=E)do({cmd:b,size:c}=yield yield Sr(B()));while(c<E)}while(!p)}finally{yield Sr($(n,l==="error"?v:null))}return yield Sr(null);function $(q,Q){return z=T=null,new Promise((ae,ie)=>{for(const[Y,be]of q)i.off(Y,be);try{const Y=i.destroy;Y&&Y.call(i,Q),Q=void 0}catch(Y){Q=Y||Q}finally{Q!=null?ie(Q):ae()}})}})}var an;(function(i){i[i.V1=0]="V1",i[i.V2=1]="V2",i[i.V3=2]="V3",i[i.V4=3]="V4",i[i.V5=4]="V5"})(an||(an={}));var Gn;(function(i){i[i.Sparse=0]="Sparse",i[i.Dense=1]="Dense"})(Gn||(Gn={}));var qn;(function(i){i[i.HALF=0]="HALF",i[i.SINGLE=1]="SINGLE",i[i.DOUBLE=2]="DOUBLE"})(qn||(qn={}));var Ks;(function(i){i[i.DAY=0]="DAY",i[i.MILLISECOND=1]="MILLISECOND"})(Ks||(Ks={}));var Wt;(function(i){i[i.SECOND=0]="SECOND",i[i.MILLISECOND=1]="MILLISECOND",i[i.MICROSECOND=2]="MICROSECOND",i[i.NANOSECOND=3]="NANOSECOND"})(Wt||(Wt={}));var Ua;(function(i){i[i.YEAR_MONTH=0]="YEAR_MONTH",i[i.DAY_TIME=1]="DAY_TIME",i[i.MONTH_DAY_NANO=2]="MONTH_DAY_NANO"})(Ua||(Ua={}));const fg=2,Da=4,po=4,ei=4,Go=new Int32Array(2),uv=new Float32Array(Go.buffer),hv=new Float64Array(Go.buffer),bf=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var Og;(function(i){i[i.UTF8_BYTES=1]="UTF8_BYTES",i[i.UTF16_STRING=2]="UTF16_STRING"})(Og||(Og={}));let Xc=class jb{constructor(e){this.bytes_=e,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(e){return new jb(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return BigInt.asIntN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readUint64(e){return BigInt.asUintN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readFloat32(e){return Go[0]=this.readInt32(e),uv[0]}readFloat64(e){return Go[bf?0:1]=this.readInt32(e),Go[bf?1:0]=this.readInt32(e+4),hv[0]}writeInt8(e,n){this.bytes_[e]=n}writeUint8(e,n){this.bytes_[e]=n}writeInt16(e,n){this.bytes_[e]=n,this.bytes_[e+1]=n>>8}writeUint16(e,n){this.bytes_[e]=n,this.bytes_[e+1]=n>>8}writeInt32(e,n){this.bytes_[e]=n,this.bytes_[e+1]=n>>8,this.bytes_[e+2]=n>>16,this.bytes_[e+3]=n>>24}writeUint32(e,n){this.bytes_[e]=n,this.bytes_[e+1]=n>>8,this.bytes_[e+2]=n>>16,this.bytes_[e+3]=n>>24}writeInt64(e,n){this.writeInt32(e,Number(BigInt.asIntN(32,n))),this.writeInt32(e+4,Number(BigInt.asIntN(32,n>>BigInt(32))))}writeUint64(e,n){this.writeUint32(e,Number(BigInt.asUintN(32,n))),this.writeUint32(e+4,Number(BigInt.asUintN(32,n>>BigInt(32))))}writeFloat32(e,n){uv[0]=n,this.writeInt32(e,Go[0])}writeFloat64(e,n){hv[0]=n,this.writeInt32(e,Go[bf?0:1]),this.writeInt32(e+4,Go[bf?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+Da+po)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let n=0;n<po;n++)e+=String.fromCharCode(this.readInt8(this.position_+Da+n));return e}__offset(e,n){const l=e-this.readInt32(e);return n<this.readInt16(l)?this.readInt16(l+n):0}__union(e,n){return e.bb_pos=n+this.readInt32(n),e.bb=this,e}__string(e,n){e+=this.readInt32(e);const l=this.readInt32(e);e+=Da;const p=this.bytes_.subarray(e,e+l);return n===Og.UTF8_BYTES?p:this.text_decoder_.decode(p)}__union_with_string(e,n){return typeof e=="string"?this.__string(n):this.__union(e,n)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+Da}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=po)throw new Error("FlatBuffers: file identifier must be length "+po);for(let n=0;n<po;n++)if(e.charCodeAt(n)!=this.readInt8(this.position()+Da+n))return!1;return!0}createScalarList(e,n){const l=[];for(let p=0;p<n;++p){const v=e(p);v!==null&&l.push(v)}return l}createObjList(e,n){const l=[];for(let p=0;p<n;++p){const v=e(p);v!==null&&l.push(v.unpack())}return l}},qb=class Gb{constructor(e){this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null,this.text_encoder=new TextEncoder;let n;e?n=e:n=1024,this.bb=Xc.allocate(n),this.space=n}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(e){this.force_defaults=e}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(e,n){e>this.minalign&&(this.minalign=e);const l=~(this.bb.capacity()-this.space+n)+1&e-1;for(;this.space<l+e+n;){const p=this.bb.capacity();this.bb=Gb.growByteBuffer(this.bb),this.space+=this.bb.capacity()-p}this.pad(l)}pad(e){for(let n=0;n<e;n++)this.bb.writeInt8(--this.space,0)}writeInt8(e){this.bb.writeInt8(this.space-=1,e)}writeInt16(e){this.bb.writeInt16(this.space-=2,e)}writeInt32(e){this.bb.writeInt32(this.space-=4,e)}writeInt64(e){this.bb.writeInt64(this.space-=8,e)}writeFloat32(e){this.bb.writeFloat32(this.space-=4,e)}writeFloat64(e){this.bb.writeFloat64(this.space-=8,e)}addInt8(e){this.prep(1,0),this.writeInt8(e)}addInt16(e){this.prep(2,0),this.writeInt16(e)}addInt32(e){this.prep(4,0),this.writeInt32(e)}addInt64(e){this.prep(8,0),this.writeInt64(e)}addFloat32(e){this.prep(4,0),this.writeFloat32(e)}addFloat64(e){this.prep(8,0),this.writeFloat64(e)}addFieldInt8(e,n,l){(this.force_defaults||n!=l)&&(this.addInt8(n),this.slot(e))}addFieldInt16(e,n,l){(this.force_defaults||n!=l)&&(this.addInt16(n),this.slot(e))}addFieldInt32(e,n,l){(this.force_defaults||n!=l)&&(this.addInt32(n),this.slot(e))}addFieldInt64(e,n,l){(this.force_defaults||n!==l)&&(this.addInt64(n),this.slot(e))}addFieldFloat32(e,n,l){(this.force_defaults||n!=l)&&(this.addFloat32(n),this.slot(e))}addFieldFloat64(e,n,l){(this.force_defaults||n!=l)&&(this.addFloat64(n),this.slot(e))}addFieldOffset(e,n,l){(this.force_defaults||n!=l)&&(this.addOffset(n),this.slot(e))}addFieldStruct(e,n,l){n!=l&&(this.nested(n),this.slot(e))}nested(e){if(e!=this.offset())throw new TypeError("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new TypeError("FlatBuffers: object serialization must not be nested.")}slot(e){this.vtable!==null&&(this.vtable[e]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(e){const n=e.capacity();if(n&3221225472)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const l=n<<1,p=Xc.allocate(l);return p.setPosition(l-n),p.bytes().set(e.bytes(),l-n),p}addOffset(e){this.prep(Da,0),this.writeInt32(this.offset()-e+Da)}startObject(e){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=e;for(let n=0;n<e;n++)this.vtable[n]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const e=this.offset();let n=this.vtable_in_use-1;for(;n>=0&&this.vtable[n]==0;n--);const l=n+1;for(;n>=0;n--)this.addInt16(this.vtable[n]!=0?e-this.vtable[n]:0);const p=2;this.addInt16(e-this.object_start);const v=(l+p)*fg;this.addInt16(v);let b=0;const c=this.space;e:for(n=0;n<this.vtables.length;n++){const E=this.bb.capacity()-this.vtables[n];if(v==this.bb.readInt16(E)){for(let T=fg;T<v;T+=fg)if(this.bb.readInt16(c+T)!=this.bb.readInt16(E+T))continue e;b=this.vtables[n];break}}return b?(this.space=this.bb.capacity()-e,this.bb.writeInt32(this.space,b-e)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-e,this.offset()-e)),this.isNested=!1,e}finish(e,n,l){const p=l?ei:0;if(n){const v=n;if(this.prep(this.minalign,Da+po+p),v.length!=po)throw new TypeError("FlatBuffers: file identifier must be length "+po);for(let b=po-1;b>=0;b--)this.writeInt8(v.charCodeAt(b))}this.prep(this.minalign,Da+p),this.addOffset(e),p&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(e,n){this.finish(e,n,!0)}requiredField(e,n){const l=this.bb.capacity()-e,p=l-this.bb.readInt32(l);if(!(n<this.bb.readInt16(p)&&this.bb.readInt16(p+n)!=0))throw new TypeError("FlatBuffers: field "+n+" must be set")}startVector(e,n,l){this.notNested(),this.vector_num_elems=n,this.prep(Da,e*n),this.prep(l,e*n)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(e){if(!e)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(e))return this.string_maps.get(e);const n=this.createString(e);return this.string_maps.set(e,n),n}createString(e){if(e==null)return 0;let n;return e instanceof Uint8Array?n=e:n=this.text_encoder.encode(e),this.addInt8(0),this.startVector(1,n.length,1),this.bb.setPosition(this.space-=n.length),this.bb.bytes().set(n,this.space),this.endVector()}createByteVector(e){return e==null?0:(this.startVector(1,e.length,1),this.bb.setPosition(this.space-=e.length),this.bb.bytes().set(e,this.space),this.endVector())}createObjectOffset(e){return e===null?0:typeof e=="string"?this.createString(e):e.pack(this)}createObjectOffsetList(e){const n=[];for(let l=0;l<e.length;++l){const p=e[l];if(p!==null)n.push(this.createObjectOffset(p));else throw new TypeError("FlatBuffers: Argument for createObjectOffsetList cannot contain null.")}return n}createStructOffsetList(e,n){return n(this,e.length),this.createObjectOffsetList(e.slice().reverse()),this.endVector()}};var Kf;(function(i){i[i.BUFFER=0]="BUFFER"})(Kf||(Kf={}));var Xf;(function(i){i[i.LZ4_FRAME=0]="LZ4_FRAME",i[i.ZSTD=1]="ZSTD"})(Xf||(Xf={}));class Zo{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsBodyCompression(e,n){return(n||new Zo).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsBodyCompression(e,n){return e.setPosition(e.position()+ei),(n||new Zo).__init(e.readInt32(e.position())+e.position(),e)}codec(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt8(this.bb_pos+e):Xf.LZ4_FRAME}method(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt8(this.bb_pos+e):Kf.BUFFER}static startBodyCompression(e){e.startObject(2)}static addCodec(e,n){e.addFieldInt8(0,n,Xf.LZ4_FRAME)}static addMethod(e,n){e.addFieldInt8(1,n,Kf.BUFFER)}static endBodyCompression(e){return e.endObject()}static createBodyCompression(e,n,l){return Zo.startBodyCompression(e),Zo.addCodec(e,n),Zo.addMethod(e,l),Zo.endBodyCompression(e)}}class Zb{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}offset(){return this.bb.readInt64(this.bb_pos)}length(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createBuffer(e,n,l){return e.prep(8,16),e.writeInt64(BigInt(l??0)),e.writeInt64(BigInt(n??0)),e.offset()}}let Wb=class{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}length(){return this.bb.readInt64(this.bb_pos)}nullCount(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createFieldNode(e,n,l){return e.prep(8,16),e.writeInt64(BigInt(l??0)),e.writeInt64(BigInt(n??0)),e.offset()}},co=class Ng{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsRecordBatch(e,n){return(n||new Ng).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsRecordBatch(e,n){return e.setPosition(e.position()+ei),(n||new Ng).__init(e.readInt32(e.position())+e.position(),e)}length(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}nodes(e,n){const l=this.bb.__offset(this.bb_pos,6);return l?(n||new Wb).__init(this.bb.__vector(this.bb_pos+l)+e*16,this.bb):null}nodesLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}buffers(e,n){const l=this.bb.__offset(this.bb_pos,8);return l?(n||new Zb).__init(this.bb.__vector(this.bb_pos+l)+e*16,this.bb):null}buffersLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}compression(e){const n=this.bb.__offset(this.bb_pos,10);return n?(e||new Zo).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}static startRecordBatch(e){e.startObject(4)}static addLength(e,n){e.addFieldInt64(0,n,BigInt("0"))}static addNodes(e,n){e.addFieldOffset(1,n,0)}static startNodesVector(e,n){e.startVector(16,n,8)}static addBuffers(e,n){e.addFieldOffset(2,n,0)}static startBuffersVector(e,n){e.startVector(16,n,8)}static addCompression(e,n){e.addFieldOffset(3,n,0)}static endRecordBatch(e){return e.endObject()}},Cc=class Ug{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsDictionaryBatch(e,n){return(n||new Ug).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDictionaryBatch(e,n){return e.setPosition(e.position()+ei),(n||new Ug).__init(e.readInt32(e.position())+e.position(),e)}id(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}data(e){const n=this.bb.__offset(this.bb_pos,6);return n?(e||new co).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}isDelta(){const e=this.bb.__offset(this.bb_pos,8);return e?!!this.bb.readInt8(this.bb_pos+e):!1}static startDictionaryBatch(e){e.startObject(3)}static addId(e,n){e.addFieldInt64(0,n,BigInt("0"))}static addData(e,n){e.addFieldOffset(1,n,0)}static addIsDelta(e,n){e.addFieldInt8(2,+n,0)}static endDictionaryBatch(e){return e.endObject()}};var Jc;(function(i){i[i.Little=0]="Little",i[i.Big=1]="Big"})(Jc||(Jc={}));var Jf;(function(i){i[i.DenseArray=0]="DenseArray"})(Jf||(Jf={}));class Ms{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsInt(e,n){return(n||new Ms).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsInt(e,n){return e.setPosition(e.position()+ei),(n||new Ms).__init(e.readInt32(e.position())+e.position(),e)}bitWidth(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}isSigned(){const e=this.bb.__offset(this.bb_pos,6);return e?!!this.bb.readInt8(this.bb_pos+e):!1}static startInt(e){e.startObject(2)}static addBitWidth(e,n){e.addFieldInt32(0,n,0)}static addIsSigned(e,n){e.addFieldInt8(1,+n,0)}static endInt(e){return e.endObject()}static createInt(e,n,l){return Ms.startInt(e),Ms.addBitWidth(e,n),Ms.addIsSigned(e,l),Ms.endInt(e)}}class mo{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsDictionaryEncoding(e,n){return(n||new mo).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDictionaryEncoding(e,n){return e.setPosition(e.position()+ei),(n||new mo).__init(e.readInt32(e.position())+e.position(),e)}id(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}indexType(e){const n=this.bb.__offset(this.bb_pos,6);return n?(e||new Ms).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}isOrdered(){const e=this.bb.__offset(this.bb_pos,8);return e?!!this.bb.readInt8(this.bb_pos+e):!1}dictionaryKind(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readInt16(this.bb_pos+e):Jf.DenseArray}static startDictionaryEncoding(e){e.startObject(4)}static addId(e,n){e.addFieldInt64(0,n,BigInt("0"))}static addIndexType(e,n){e.addFieldOffset(1,n,0)}static addIsOrdered(e,n){e.addFieldInt8(2,+n,0)}static addDictionaryKind(e,n){e.addFieldInt16(3,n,Jf.DenseArray)}static endDictionaryEncoding(e){return e.endObject()}}class _n{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsKeyValue(e,n){return(n||new _n).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsKeyValue(e,n){return e.setPosition(e.position()+ei),(n||new _n).__init(e.readInt32(e.position())+e.position(),e)}key(e){const n=this.bb.__offset(this.bb_pos,4);return n?this.bb.__string(this.bb_pos+n,e):null}value(e){const n=this.bb.__offset(this.bb_pos,6);return n?this.bb.__string(this.bb_pos+n,e):null}static startKeyValue(e){e.startObject(2)}static addKey(e,n){e.addFieldOffset(0,n,0)}static addValue(e,n){e.addFieldOffset(1,n,0)}static endKeyValue(e){return e.endObject()}static createKeyValue(e,n,l){return _n.startKeyValue(e),_n.addKey(e,n),_n.addValue(e,l),_n.endKeyValue(e)}}let dv=class Ih{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsBinary(e,n){return(n||new Ih).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsBinary(e,n){return e.setPosition(e.position()+ei),(n||new Ih).__init(e.readInt32(e.position())+e.position(),e)}static startBinary(e){e.startObject(0)}static endBinary(e){return e.endObject()}static createBinary(e){return Ih.startBinary(e),Ih.endBinary(e)}},fv=class Th{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsBool(e,n){return(n||new Th).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsBool(e,n){return e.setPosition(e.position()+ei),(n||new Th).__init(e.readInt32(e.position())+e.position(),e)}static startBool(e){e.startObject(0)}static endBool(e){return e.endObject()}static createBool(e){return Th.startBool(e),Th.endBool(e)}},Lf=class Mc{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsDate(e,n){return(n||new Mc).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDate(e,n){return e.setPosition(e.position()+ei),(n||new Mc).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Ks.MILLISECOND}static startDate(e){e.startObject(1)}static addUnit(e,n){e.addFieldInt16(0,n,Ks.MILLISECOND)}static endDate(e){return e.endObject()}static createDate(e,n){return Mc.startDate(e),Mc.addUnit(e,n),Mc.endDate(e)}},Dc=class jo{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsDecimal(e,n){return(n||new jo).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDecimal(e,n){return e.setPosition(e.position()+ei),(n||new jo).__init(e.readInt32(e.position())+e.position(),e)}precision(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}scale(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):0}bitWidth(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readInt32(this.bb_pos+e):128}static startDecimal(e){e.startObject(3)}static addPrecision(e,n){e.addFieldInt32(0,n,0)}static addScale(e,n){e.addFieldInt32(1,n,0)}static addBitWidth(e,n){e.addFieldInt32(2,n,128)}static endDecimal(e){return e.endObject()}static createDecimal(e,n,l,p){return jo.startDecimal(e),jo.addPrecision(e,n),jo.addScale(e,l),jo.addBitWidth(e,p),jo.endDecimal(e)}},zf=class Pc{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsDuration(e,n){return(n||new Pc).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDuration(e,n){return e.setPosition(e.position()+ei),(n||new Pc).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Wt.MILLISECOND}static startDuration(e){e.startObject(1)}static addUnit(e,n){e.addFieldInt16(0,n,Wt.MILLISECOND)}static endDuration(e){return e.endObject()}static createDuration(e,n){return Pc.startDuration(e),Pc.addUnit(e,n),Pc.endDuration(e)}},Bf=class Lc{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsFixedSizeBinary(e,n){return(n||new Lc).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFixedSizeBinary(e,n){return e.setPosition(e.position()+ei),(n||new Lc).__init(e.readInt32(e.position())+e.position(),e)}byteWidth(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}static startFixedSizeBinary(e){e.startObject(1)}static addByteWidth(e,n){e.addFieldInt32(0,n,0)}static endFixedSizeBinary(e){return e.endObject()}static createFixedSizeBinary(e,n){return Lc.startFixedSizeBinary(e),Lc.addByteWidth(e,n),Lc.endFixedSizeBinary(e)}},Rf=class zc{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsFixedSizeList(e,n){return(n||new zc).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFixedSizeList(e,n){return e.setPosition(e.position()+ei),(n||new zc).__init(e.readInt32(e.position())+e.position(),e)}listSize(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}static startFixedSizeList(e){e.startObject(1)}static addListSize(e,n){e.addFieldInt32(0,n,0)}static endFixedSizeList(e){return e.endObject()}static createFixedSizeList(e,n){return zc.startFixedSizeList(e),zc.addListSize(e,n),zc.endFixedSizeList(e)}};class Pa{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsFloatingPoint(e,n){return(n||new Pa).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFloatingPoint(e,n){return e.setPosition(e.position()+ei),(n||new Pa).__init(e.readInt32(e.position())+e.position(),e)}precision(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):qn.HALF}static startFloatingPoint(e){e.startObject(1)}static addPrecision(e,n){e.addFieldInt16(0,n,qn.HALF)}static endFloatingPoint(e){return e.endObject()}static createFloatingPoint(e,n){return Pa.startFloatingPoint(e),Pa.addPrecision(e,n),Pa.endFloatingPoint(e)}}class La{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsInterval(e,n){return(n||new La).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsInterval(e,n){return e.setPosition(e.position()+ei),(n||new La).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Ua.YEAR_MONTH}static startInterval(e){e.startObject(1)}static addUnit(e,n){e.addFieldInt16(0,n,Ua.YEAR_MONTH)}static endInterval(e){return e.endObject()}static createInterval(e,n){return La.startInterval(e),La.addUnit(e,n),La.endInterval(e)}}let pv=class kh{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsLargeBinary(e,n){return(n||new kh).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsLargeBinary(e,n){return e.setPosition(e.position()+ei),(n||new kh).__init(e.readInt32(e.position())+e.position(),e)}static startLargeBinary(e){e.startObject(0)}static endLargeBinary(e){return e.endObject()}static createLargeBinary(e){return kh.startLargeBinary(e),kh.endLargeBinary(e)}},mv=class Ah{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsLargeUtf8(e,n){return(n||new Ah).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsLargeUtf8(e,n){return e.setPosition(e.position()+ei),(n||new Ah).__init(e.readInt32(e.position())+e.position(),e)}static startLargeUtf8(e){e.startObject(0)}static endLargeUtf8(e){return e.endObject()}static createLargeUtf8(e){return Ah.startLargeUtf8(e),Ah.endLargeUtf8(e)}},gv=class Eh{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsList(e,n){return(n||new Eh).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsList(e,n){return e.setPosition(e.position()+ei),(n||new Eh).__init(e.readInt32(e.position())+e.position(),e)}static startList(e){e.startObject(0)}static endList(e){return e.endObject()}static createList(e){return Eh.startList(e),Eh.endList(e)}},Ff=class Bc{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsMap(e,n){return(n||new Bc).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsMap(e,n){return e.setPosition(e.position()+ei),(n||new Bc).__init(e.readInt32(e.position())+e.position(),e)}keysSorted(){const e=this.bb.__offset(this.bb_pos,4);return e?!!this.bb.readInt8(this.bb_pos+e):!1}static startMap(e){e.startObject(1)}static addKeysSorted(e,n){e.addFieldInt8(0,+n,0)}static endMap(e){return e.endObject()}static createMap(e,n){return Bc.startMap(e),Bc.addKeysSorted(e,n),Bc.endMap(e)}},yv=class Ch{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsNull(e,n){return(n||new Ch).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsNull(e,n){return e.setPosition(e.position()+ei),(n||new Ch).__init(e.readInt32(e.position())+e.position(),e)}static startNull(e){e.startObject(0)}static endNull(e){return e.endObject()}static createNull(e){return Ch.startNull(e),Ch.endNull(e)}};class Cl{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsStruct_(e,n){return(n||new Cl).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsStruct_(e,n){return e.setPosition(e.position()+ei),(n||new Cl).__init(e.readInt32(e.position())+e.position(),e)}static startStruct_(e){e.startObject(0)}static endStruct_(e){return e.endObject()}static createStruct_(e){return Cl.startStruct_(e),Cl.endStruct_(e)}}class Zs{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsTime(e,n){return(n||new Zs).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsTime(e,n){return e.setPosition(e.position()+ei),(n||new Zs).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Wt.MILLISECOND}bitWidth(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):32}static startTime(e){e.startObject(2)}static addUnit(e,n){e.addFieldInt16(0,n,Wt.MILLISECOND)}static addBitWidth(e,n){e.addFieldInt32(1,n,32)}static endTime(e){return e.endObject()}static createTime(e,n,l){return Zs.startTime(e),Zs.addUnit(e,n),Zs.addBitWidth(e,l),Zs.endTime(e)}}class Ws{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsTimestamp(e,n){return(n||new Ws).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsTimestamp(e,n){return e.setPosition(e.position()+ei),(n||new Ws).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Wt.SECOND}timezone(e){const n=this.bb.__offset(this.bb_pos,6);return n?this.bb.__string(this.bb_pos+n,e):null}static startTimestamp(e){e.startObject(2)}static addUnit(e,n){e.addFieldInt16(0,n,Wt.SECOND)}static addTimezone(e,n){e.addFieldOffset(1,n,0)}static endTimestamp(e){return e.endObject()}static createTimestamp(e,n,l){return Ws.startTimestamp(e),Ws.addUnit(e,n),Ws.addTimezone(e,l),Ws.endTimestamp(e)}}class _s{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsUnion(e,n){return(n||new _s).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsUnion(e,n){return e.setPosition(e.position()+ei),(n||new _s).__init(e.readInt32(e.position())+e.position(),e)}mode(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Gn.Sparse}typeIds(e){const n=this.bb.__offset(this.bb_pos,6);return n?this.bb.readInt32(this.bb.__vector(this.bb_pos+n)+e*4):0}typeIdsLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}typeIdsArray(){const e=this.bb.__offset(this.bb_pos,6);return e?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}static startUnion(e){e.startObject(2)}static addMode(e,n){e.addFieldInt16(0,n,Gn.Sparse)}static addTypeIds(e,n){e.addFieldOffset(1,n,0)}static createTypeIdsVector(e,n){e.startVector(4,n.length,4);for(let l=n.length-1;l>=0;l--)e.addInt32(n[l]);return e.endVector()}static startTypeIdsVector(e,n){e.startVector(4,n,4)}static endUnion(e){return e.endObject()}static createUnion(e,n,l){return _s.startUnion(e),_s.addMode(e,n),_s.addTypeIds(e,l),_s.endUnion(e)}}let _v=class Mh{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsUtf8(e,n){return(n||new Mh).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsUtf8(e,n){return e.setPosition(e.position()+ei),(n||new Mh).__init(e.readInt32(e.position())+e.position(),e)}static startUtf8(e){e.startObject(0)}static endUtf8(e){return e.endObject()}static createUtf8(e){return Mh.startUtf8(e),Mh.endUtf8(e)}};var wi;(function(i){i[i.NONE=0]="NONE",i[i.Null=1]="Null",i[i.Int=2]="Int",i[i.FloatingPoint=3]="FloatingPoint",i[i.Binary=4]="Binary",i[i.Utf8=5]="Utf8",i[i.Bool=6]="Bool",i[i.Decimal=7]="Decimal",i[i.Date=8]="Date",i[i.Time=9]="Time",i[i.Timestamp=10]="Timestamp",i[i.Interval=11]="Interval",i[i.List=12]="List",i[i.Struct_=13]="Struct_",i[i.Union=14]="Union",i[i.FixedSizeBinary=15]="FixedSizeBinary",i[i.FixedSizeList=16]="FixedSizeList",i[i.Map=17]="Map",i[i.Duration=18]="Duration",i[i.LargeBinary=19]="LargeBinary",i[i.LargeUtf8=20]="LargeUtf8",i[i.LargeList=21]="LargeList",i[i.RunEndEncoded=22]="RunEndEncoded"})(wi||(wi={}));let qs=class Of{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsField(e,n){return(n||new Of).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsField(e,n){return e.setPosition(e.position()+ei),(n||new Of).__init(e.readInt32(e.position())+e.position(),e)}name(e){const n=this.bb.__offset(this.bb_pos,4);return n?this.bb.__string(this.bb_pos+n,e):null}nullable(){const e=this.bb.__offset(this.bb_pos,6);return e?!!this.bb.readInt8(this.bb_pos+e):!1}typeType(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint8(this.bb_pos+e):wi.NONE}type(e){const n=this.bb.__offset(this.bb_pos,10);return n?this.bb.__union(e,this.bb_pos+n):null}dictionary(e){const n=this.bb.__offset(this.bb_pos,12);return n?(e||new mo).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}children(e,n){const l=this.bb.__offset(this.bb_pos,14);return l?(n||new Of).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+l)+e*4),this.bb):null}childrenLength(){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__vector_len(this.bb_pos+e):0}customMetadata(e,n){const l=this.bb.__offset(this.bb_pos,16);return l?(n||new _n).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+l)+e*4),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,16);return e?this.bb.__vector_len(this.bb_pos+e):0}static startField(e){e.startObject(7)}static addName(e,n){e.addFieldOffset(0,n,0)}static addNullable(e,n){e.addFieldInt8(1,+n,0)}static addTypeType(e,n){e.addFieldInt8(2,n,wi.NONE)}static addType(e,n){e.addFieldOffset(3,n,0)}static addDictionary(e,n){e.addFieldOffset(4,n,0)}static addChildren(e,n){e.addFieldOffset(5,n,0)}static createChildrenVector(e,n){e.startVector(4,n.length,4);for(let l=n.length-1;l>=0;l--)e.addOffset(n[l]);return e.endVector()}static startChildrenVector(e,n){e.startVector(4,n,4)}static addCustomMetadata(e,n){e.addFieldOffset(6,n,0)}static createCustomMetadataVector(e,n){e.startVector(4,n.length,4);for(let l=n.length-1;l>=0;l--)e.addOffset(n[l]);return e.endVector()}static startCustomMetadataVector(e,n){e.startVector(4,n,4)}static endField(e){return e.endObject()}},Ca=class lo{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsSchema(e,n){return(n||new lo).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsSchema(e,n){return e.setPosition(e.position()+ei),(n||new lo).__init(e.readInt32(e.position())+e.position(),e)}endianness(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Jc.Little}fields(e,n){const l=this.bb.__offset(this.bb_pos,6);return l?(n||new qs).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+l)+e*4),this.bb):null}fieldsLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}customMetadata(e,n){const l=this.bb.__offset(this.bb_pos,8);return l?(n||new _n).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+l)+e*4),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}features(e){const n=this.bb.__offset(this.bb_pos,10);return n?this.bb.readInt64(this.bb.__vector(this.bb_pos+n)+e*8):BigInt(0)}featuresLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}static startSchema(e){e.startObject(4)}static addEndianness(e,n){e.addFieldInt16(0,n,Jc.Little)}static addFields(e,n){e.addFieldOffset(1,n,0)}static createFieldsVector(e,n){e.startVector(4,n.length,4);for(let l=n.length-1;l>=0;l--)e.addOffset(n[l]);return e.endVector()}static startFieldsVector(e,n){e.startVector(4,n,4)}static addCustomMetadata(e,n){e.addFieldOffset(2,n,0)}static createCustomMetadataVector(e,n){e.startVector(4,n.length,4);for(let l=n.length-1;l>=0;l--)e.addOffset(n[l]);return e.endVector()}static startCustomMetadataVector(e,n){e.startVector(4,n,4)}static addFeatures(e,n){e.addFieldOffset(3,n,0)}static createFeaturesVector(e,n){e.startVector(8,n.length,8);for(let l=n.length-1;l>=0;l--)e.addInt64(n[l]);return e.endVector()}static startFeaturesVector(e,n){e.startVector(8,n,8)}static endSchema(e){return e.endObject()}static finishSchemaBuffer(e,n){e.finish(n)}static finishSizePrefixedSchemaBuffer(e,n){e.finish(n,void 0,!0)}static createSchema(e,n,l,p,v){return lo.startSchema(e),lo.addEndianness(e,n),lo.addFields(e,l),lo.addCustomMetadata(e,p),lo.addFeatures(e,v),lo.endSchema(e)}};var Gr;(function(i){i[i.NONE=0]="NONE",i[i.Schema=1]="Schema",i[i.DictionaryBatch=2]="DictionaryBatch",i[i.RecordBatch=3]="RecordBatch",i[i.Tensor=4]="Tensor",i[i.SparseTensor=5]="SparseTensor"})(Gr||(Gr={}));var le;(function(i){i[i.NONE=0]="NONE",i[i.Null=1]="Null",i[i.Int=2]="Int",i[i.Float=3]="Float",i[i.Binary=4]="Binary",i[i.Utf8=5]="Utf8",i[i.Bool=6]="Bool",i[i.Decimal=7]="Decimal",i[i.Date=8]="Date",i[i.Time=9]="Time",i[i.Timestamp=10]="Timestamp",i[i.Interval=11]="Interval",i[i.List=12]="List",i[i.Struct=13]="Struct",i[i.Union=14]="Union",i[i.FixedSizeBinary=15]="FixedSizeBinary",i[i.FixedSizeList=16]="FixedSizeList",i[i.Map=17]="Map",i[i.Duration=18]="Duration",i[i.LargeBinary=19]="LargeBinary",i[i.LargeUtf8=20]="LargeUtf8",i[i.Dictionary=-1]="Dictionary",i[i.Int8=-2]="Int8",i[i.Int16=-3]="Int16",i[i.Int32=-4]="Int32",i[i.Int64=-5]="Int64",i[i.Uint8=-6]="Uint8",i[i.Uint16=-7]="Uint16",i[i.Uint32=-8]="Uint32",i[i.Uint64=-9]="Uint64",i[i.Float16=-10]="Float16",i[i.Float32=-11]="Float32",i[i.Float64=-12]="Float64",i[i.DateDay=-13]="DateDay",i[i.DateMillisecond=-14]="DateMillisecond",i[i.TimestampSecond=-15]="TimestampSecond",i[i.TimestampMillisecond=-16]="TimestampMillisecond",i[i.TimestampMicrosecond=-17]="TimestampMicrosecond",i[i.TimestampNanosecond=-18]="TimestampNanosecond",i[i.TimeSecond=-19]="TimeSecond",i[i.TimeMillisecond=-20]="TimeMillisecond",i[i.TimeMicrosecond=-21]="TimeMicrosecond",i[i.TimeNanosecond=-22]="TimeNanosecond",i[i.DenseUnion=-23]="DenseUnion",i[i.SparseUnion=-24]="SparseUnion",i[i.IntervalDayTime=-25]="IntervalDayTime",i[i.IntervalYearMonth=-26]="IntervalYearMonth",i[i.DurationSecond=-27]="DurationSecond",i[i.DurationMillisecond=-28]="DurationMillisecond",i[i.DurationMicrosecond=-29]="DurationMicrosecond",i[i.DurationNanosecond=-30]="DurationNanosecond"})(le||(le={}));var uo;(function(i){i[i.OFFSET=0]="OFFSET",i[i.DATA=1]="DATA",i[i.VALIDITY=2]="VALIDITY",i[i.TYPE=3]="TYPE"})(uo||(uo={}));const cT=void 0;function Nh(i){if(i===null)return"null";if(i===cT)return"undefined";switch(typeof i){case"number":return`${i}`;case"bigint":return`${i}`;case"string":return`"${i}"`}return typeof i[Symbol.toPrimitive]=="function"?i[Symbol.toPrimitive]("string"):ArrayBuffer.isView(i)?i instanceof BigInt64Array||i instanceof BigUint64Array?`[${[...i].map(e=>Nh(e))}]`:`[${i}]`:ArrayBuffer.isView(i)?`[${i}]`:JSON.stringify(i,(e,n)=>typeof n=="bigint"?`${n}`:n)}function mi(i){if(typeof i=="bigint"&&(i<Number.MIN_SAFE_INTEGER||i>Number.MAX_SAFE_INTEGER))throw new TypeError(`${i} is not safe to convert to a number.`);return Number(i)}function Hb(i,e){return mi(i/e)+mi(i%e)/mi(e)}const uT=Symbol.for("isArrowBigNum");function ya(i,...e){return e.length===0?Object.setPrototypeOf(si(this.TypedArray,i),this.constructor.prototype):Object.setPrototypeOf(new this.TypedArray(i,...e),this.constructor.prototype)}ya.prototype[uT]=!0;ya.prototype.toJSON=function(){return`"${$h(this)}"`};ya.prototype.valueOf=function(i){return Yb(this,i)};ya.prototype.toString=function(){return $h(this)};ya.prototype[Symbol.toPrimitive]=function(i="default"){switch(i){case"number":return Yb(this);case"string":return $h(this);case"default":return fT(this)}return $h(this)};function jc(...i){return ya.apply(this,i)}function qc(...i){return ya.apply(this,i)}function Uh(...i){return ya.apply(this,i)}Object.setPrototypeOf(jc.prototype,Object.create(Int32Array.prototype));Object.setPrototypeOf(qc.prototype,Object.create(Uint32Array.prototype));Object.setPrototypeOf(Uh.prototype,Object.create(Uint32Array.prototype));Object.assign(jc.prototype,ya.prototype,{constructor:jc,signed:!0,TypedArray:Int32Array,BigIntArray:BigInt64Array});Object.assign(qc.prototype,ya.prototype,{constructor:qc,signed:!1,TypedArray:Uint32Array,BigIntArray:BigUint64Array});Object.assign(Uh.prototype,ya.prototype,{constructor:Uh,signed:!0,TypedArray:Uint32Array,BigIntArray:BigUint64Array});const hT=BigInt(4294967296)*BigInt(4294967296),dT=hT-BigInt(1);function Yb(i,e){const{buffer:n,byteOffset:l,byteLength:p,signed:v}=i,b=new BigUint64Array(n,l,p/8),c=v&&b.at(-1)&BigInt(1)<<BigInt(63);let E=BigInt(0),T=0;if(c){for(const z of b)E|=(z^dT)*(BigInt(1)<<BigInt(64*T++));E*=BigInt(-1),E-=BigInt(1)}else for(const z of b)E|=z*(BigInt(1)<<BigInt(64*T++));if(typeof e=="number"){const z=BigInt(Math.pow(10,e)),B=E/z,$=E%z;return mi(B)+mi($)/mi(z)}return mi(E)}function $h(i){if(i.byteLength===8)return`${new i.BigIntArray(i.buffer,i.byteOffset,1)[0]}`;if(!i.signed)return pg(i);let e=new Uint16Array(i.buffer,i.byteOffset,i.byteLength/2);if(new Int16Array([e.at(-1)])[0]>=0)return pg(i);e=e.slice();let l=1;for(let v=0;v<e.length;v++){const b=e[v],c=~b+l;e[v]=c,l&=b===0?1:0}return`-${pg(e)}`}function fT(i){return i.byteLength===8?new i.BigIntArray(i.buffer,i.byteOffset,1)[0]:$h(i)}function pg(i){let e="";const n=new Uint32Array(2);let l=new Uint16Array(i.buffer,i.byteOffset,i.byteLength/2);const p=new Uint32Array((l=new Uint16Array(l).reverse()).buffer);let v=-1;const b=l.length-1;do{for(n[0]=l[v=0];v<b;)l[v++]=n[1]=n[0]/10,n[0]=(n[0]-n[1]*10<<16)+l[v];l[v]=n[1]=n[0]/10,n[0]=n[0]-n[1]*10,e=`${n[0]}${e}`}while(p[0]||p[1]||p[2]||p[3]);return e??"0"}class vy{static new(e,n){switch(n){case!0:return new jc(e);case!1:return new qc(e)}switch(e.constructor){case Int8Array:case Int16Array:case Int32Array:case BigInt64Array:return new jc(e)}return e.byteLength===16?new Uh(e):new qc(e)}static signed(e){return new jc(e)}static unsigned(e){return new qc(e)}static decimal(e){return new Uh(e)}constructor(e,n){return vy.new(e,n)}}var Kb,Xb,Jb,Qb,ex,tx,rx,ix,nx,sx,ax,ox,lx,cx,ux,hx,dx,fx,px,mx,gx,yx;class Ot{static isNull(e){return(e==null?void 0:e.typeId)===le.Null}static isInt(e){return(e==null?void 0:e.typeId)===le.Int}static isFloat(e){return(e==null?void 0:e.typeId)===le.Float}static isBinary(e){return(e==null?void 0:e.typeId)===le.Binary}static isLargeBinary(e){return(e==null?void 0:e.typeId)===le.LargeBinary}static isUtf8(e){return(e==null?void 0:e.typeId)===le.Utf8}static isLargeUtf8(e){return(e==null?void 0:e.typeId)===le.LargeUtf8}static isBool(e){return(e==null?void 0:e.typeId)===le.Bool}static isDecimal(e){return(e==null?void 0:e.typeId)===le.Decimal}static isDate(e){return(e==null?void 0:e.typeId)===le.Date}static isTime(e){return(e==null?void 0:e.typeId)===le.Time}static isTimestamp(e){return(e==null?void 0:e.typeId)===le.Timestamp}static isInterval(e){return(e==null?void 0:e.typeId)===le.Interval}static isDuration(e){return(e==null?void 0:e.typeId)===le.Duration}static isList(e){return(e==null?void 0:e.typeId)===le.List}static isStruct(e){return(e==null?void 0:e.typeId)===le.Struct}static isUnion(e){return(e==null?void 0:e.typeId)===le.Union}static isFixedSizeBinary(e){return(e==null?void 0:e.typeId)===le.FixedSizeBinary}static isFixedSizeList(e){return(e==null?void 0:e.typeId)===le.FixedSizeList}static isMap(e){return(e==null?void 0:e.typeId)===le.Map}static isDictionary(e){return(e==null?void 0:e.typeId)===le.Dictionary}static isDenseUnion(e){return Ot.isUnion(e)&&e.mode===Gn.Dense}static isSparseUnion(e){return Ot.isUnion(e)&&e.mode===Gn.Sparse}constructor(e){this.typeId=e}}Kb=Symbol.toStringTag;Ot[Kb]=(i=>(i.children=null,i.ArrayType=Array,i.OffsetArrayType=Int32Array,i[Symbol.toStringTag]="DataType"))(Ot.prototype);class Yo extends Ot{constructor(){super(le.Null)}toString(){return"Null"}}Xb=Symbol.toStringTag;Yo[Xb]=(i=>i[Symbol.toStringTag]="Null")(Yo.prototype);class Rl extends Ot{constructor(e,n){super(le.Int),this.isSigned=e,this.bitWidth=n}get ArrayType(){switch(this.bitWidth){case 8:return this.isSigned?Int8Array:Uint8Array;case 16:return this.isSigned?Int16Array:Uint16Array;case 32:return this.isSigned?Int32Array:Uint32Array;case 64:return this.isSigned?BigInt64Array:BigUint64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`${this.isSigned?"I":"Ui"}nt${this.bitWidth}`}}Jb=Symbol.toStringTag;Rl[Jb]=(i=>(i.isSigned=null,i.bitWidth=null,i[Symbol.toStringTag]="Int"))(Rl.prototype);class Vh extends Rl{constructor(){super(!0,32)}get ArrayType(){return Int32Array}}Object.defineProperty(Vh.prototype,"ArrayType",{value:Int32Array});class Qf extends Ot{constructor(e){super(le.Float),this.precision=e}get ArrayType(){switch(this.precision){case qn.HALF:return Uint16Array;case qn.SINGLE:return Float32Array;case qn.DOUBLE:return Float64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`Float${this.precision<<5||16}`}}Qb=Symbol.toStringTag;Qf[Qb]=(i=>(i.precision=null,i[Symbol.toStringTag]="Float"))(Qf.prototype);class ep extends Ot{constructor(){super(le.Binary)}toString(){return"Binary"}}ex=Symbol.toStringTag;ep[ex]=(i=>(i.ArrayType=Uint8Array,i[Symbol.toStringTag]="Binary"))(ep.prototype);class tp extends Ot{constructor(){super(le.LargeBinary)}toString(){return"LargeBinary"}}tx=Symbol.toStringTag;tp[tx]=(i=>(i.ArrayType=Uint8Array,i.OffsetArrayType=BigInt64Array,i[Symbol.toStringTag]="LargeBinary"))(tp.prototype);class rp extends Ot{constructor(){super(le.Utf8)}toString(){return"Utf8"}}rx=Symbol.toStringTag;rp[rx]=(i=>(i.ArrayType=Uint8Array,i[Symbol.toStringTag]="Utf8"))(rp.prototype);class ip extends Ot{constructor(){super(le.LargeUtf8)}toString(){return"LargeUtf8"}}ix=Symbol.toStringTag;ip[ix]=(i=>(i.ArrayType=Uint8Array,i.OffsetArrayType=BigInt64Array,i[Symbol.toStringTag]="LargeUtf8"))(ip.prototype);class np extends Ot{constructor(){super(le.Bool)}toString(){return"Bool"}}nx=Symbol.toStringTag;np[nx]=(i=>(i.ArrayType=Uint8Array,i[Symbol.toStringTag]="Bool"))(np.prototype);class sp extends Ot{constructor(e,n,l=128){super(le.Decimal),this.scale=e,this.precision=n,this.bitWidth=l}toString(){return`Decimal[${this.precision}e${this.scale>0?"+":""}${this.scale}]`}}sx=Symbol.toStringTag;sp[sx]=(i=>(i.scale=null,i.precision=null,i.ArrayType=Uint32Array,i[Symbol.toStringTag]="Decimal"))(sp.prototype);class ap extends Ot{constructor(e){super(le.Date),this.unit=e}toString(){return`Date${(this.unit+1)*32}<${Ks[this.unit]}>`}get ArrayType(){return this.unit===Ks.DAY?Int32Array:BigInt64Array}}ax=Symbol.toStringTag;ap[ax]=(i=>(i.unit=null,i[Symbol.toStringTag]="Date"))(ap.prototype);class op extends Ot{constructor(e,n){super(le.Time),this.unit=e,this.bitWidth=n}toString(){return`Time${this.bitWidth}<${Wt[this.unit]}>`}get ArrayType(){switch(this.bitWidth){case 32:return Int32Array;case 64:return BigInt64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}}ox=Symbol.toStringTag;op[ox]=(i=>(i.unit=null,i.bitWidth=null,i[Symbol.toStringTag]="Time"))(op.prototype);class lp extends Ot{constructor(e,n){super(le.Timestamp),this.unit=e,this.timezone=n}toString(){return`Timestamp<${Wt[this.unit]}${this.timezone?`, ${this.timezone}`:""}>`}}lx=Symbol.toStringTag;lp[lx]=(i=>(i.unit=null,i.timezone=null,i.ArrayType=BigInt64Array,i[Symbol.toStringTag]="Timestamp"))(lp.prototype);class cp extends Ot{constructor(e){super(le.Interval),this.unit=e}toString(){return`Interval<${Ua[this.unit]}>`}}cx=Symbol.toStringTag;cp[cx]=(i=>(i.unit=null,i.ArrayType=Int32Array,i[Symbol.toStringTag]="Interval"))(cp.prototype);class up extends Ot{constructor(e){super(le.Duration),this.unit=e}toString(){return`Duration<${Wt[this.unit]}>`}}ux=Symbol.toStringTag;up[ux]=(i=>(i.unit=null,i.ArrayType=BigInt64Array,i[Symbol.toStringTag]="Duration"))(up.prototype);class hp extends Ot{constructor(e){super(le.List),this.children=[e]}toString(){return`List<${this.valueType}>`}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}}hx=Symbol.toStringTag;hp[hx]=(i=>(i.children=null,i[Symbol.toStringTag]="List"))(hp.prototype);class rs extends Ot{constructor(e){super(le.Struct),this.children=e}toString(){return`Struct<{${this.children.map(e=>`${e.name}:${e.type}`).join(", ")}}>`}}dx=Symbol.toStringTag;rs[dx]=(i=>(i.children=null,i[Symbol.toStringTag]="Struct"))(rs.prototype);class dp extends Ot{constructor(e,n,l){super(le.Union),this.mode=e,this.children=l,this.typeIds=n=Int32Array.from(n),this.typeIdToChildIndex=n.reduce((p,v,b)=>(p[v]=b)&&p||p,Object.create(null))}toString(){return`${this[Symbol.toStringTag]}<${this.children.map(e=>`${e.type}`).join(" | ")}>`}}fx=Symbol.toStringTag;dp[fx]=(i=>(i.mode=null,i.typeIds=null,i.children=null,i.typeIdToChildIndex=null,i.ArrayType=Int8Array,i[Symbol.toStringTag]="Union"))(dp.prototype);class fp extends Ot{constructor(e){super(le.FixedSizeBinary),this.byteWidth=e}toString(){return`FixedSizeBinary[${this.byteWidth}]`}}px=Symbol.toStringTag;fp[px]=(i=>(i.byteWidth=null,i.ArrayType=Uint8Array,i[Symbol.toStringTag]="FixedSizeBinary"))(fp.prototype);class pp extends Ot{constructor(e,n){super(le.FixedSizeList),this.listSize=e,this.children=[n]}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}toString(){return`FixedSizeList[${this.listSize}]<${this.valueType}>`}}mx=Symbol.toStringTag;pp[mx]=(i=>(i.children=null,i.listSize=null,i[Symbol.toStringTag]="FixedSizeList"))(pp.prototype);class mp extends Ot{constructor(e,n=!1){var l,p,v;if(super(le.Map),this.children=[e],this.keysSorted=n,e&&(e.name="entries",!((l=e==null?void 0:e.type)===null||l===void 0)&&l.children)){const b=(p=e==null?void 0:e.type)===null||p===void 0?void 0:p.children[0];b&&(b.name="key");const c=(v=e==null?void 0:e.type)===null||v===void 0?void 0:v.children[1];c&&(c.name="value")}}get keyType(){return this.children[0].type.children[0].type}get valueType(){return this.children[0].type.children[1].type}get childType(){return this.children[0].type}toString(){return`Map<{${this.children[0].type.children.map(e=>`${e.name}:${e.type}`).join(", ")}}>`}}gx=Symbol.toStringTag;mp[gx]=(i=>(i.children=null,i.keysSorted=null,i[Symbol.toStringTag]="Map_"))(mp.prototype);const pT=(i=>()=>++i)(-1);class Qc extends Ot{constructor(e,n,l,p){super(le.Dictionary),this.indices=n,this.dictionary=e,this.isOrdered=p||!1,this.id=l==null?pT():mi(l)}get children(){return this.dictionary.children}get valueType(){return this.dictionary}get ArrayType(){return this.dictionary.ArrayType}toString(){return`Dictionary<${this.indices}, ${this.dictionary}>`}}yx=Symbol.toStringTag;Qc[yx]=(i=>(i.id=null,i.indices=null,i.isOrdered=null,i.dictionary=null,i[Symbol.toStringTag]="Dictionary"))(Qc.prototype);function ho(i){const e=i;switch(i.typeId){case le.Decimal:return i.bitWidth/32;case le.Interval:return 1+e.unit;case le.FixedSizeList:return e.listSize;case le.FixedSizeBinary:return e.byteWidth;default:return 1}}class Er{visitMany(e,...n){return e.map((l,p)=>this.visit(l,...n.map(v=>v[p])))}visit(...e){return this.getVisitFn(e[0],!1).apply(this,e)}getVisitFn(e,n=!0){return mT(this,e,n)}getVisitFnByTypeId(e,n=!0){return Rc(this,e,n)}visitNull(e,...n){return null}visitBool(e,...n){return null}visitInt(e,...n){return null}visitFloat(e,...n){return null}visitUtf8(e,...n){return null}visitLargeUtf8(e,...n){return null}visitBinary(e,...n){return null}visitLargeBinary(e,...n){return null}visitFixedSizeBinary(e,...n){return null}visitDate(e,...n){return null}visitTimestamp(e,...n){return null}visitTime(e,...n){return null}visitDecimal(e,...n){return null}visitList(e,...n){return null}visitStruct(e,...n){return null}visitUnion(e,...n){return null}visitDictionary(e,...n){return null}visitInterval(e,...n){return null}visitDuration(e,...n){return null}visitFixedSizeList(e,...n){return null}visitMap(e,...n){return null}}function mT(i,e,n=!0){return typeof e=="number"?Rc(i,e,n):typeof e=="string"&&e in le?Rc(i,le[e],n):e&&e instanceof Ot?Rc(i,vv(e),n):e!=null&&e.type&&e.type instanceof Ot?Rc(i,vv(e.type),n):Rc(i,le.NONE,n)}function Rc(i,e,n=!0){let l=null;switch(e){case le.Null:l=i.visitNull;break;case le.Bool:l=i.visitBool;break;case le.Int:l=i.visitInt;break;case le.Int8:l=i.visitInt8||i.visitInt;break;case le.Int16:l=i.visitInt16||i.visitInt;break;case le.Int32:l=i.visitInt32||i.visitInt;break;case le.Int64:l=i.visitInt64||i.visitInt;break;case le.Uint8:l=i.visitUint8||i.visitInt;break;case le.Uint16:l=i.visitUint16||i.visitInt;break;case le.Uint32:l=i.visitUint32||i.visitInt;break;case le.Uint64:l=i.visitUint64||i.visitInt;break;case le.Float:l=i.visitFloat;break;case le.Float16:l=i.visitFloat16||i.visitFloat;break;case le.Float32:l=i.visitFloat32||i.visitFloat;break;case le.Float64:l=i.visitFloat64||i.visitFloat;break;case le.Utf8:l=i.visitUtf8;break;case le.LargeUtf8:l=i.visitLargeUtf8;break;case le.Binary:l=i.visitBinary;break;case le.LargeBinary:l=i.visitLargeBinary;break;case le.FixedSizeBinary:l=i.visitFixedSizeBinary;break;case le.Date:l=i.visitDate;break;case le.DateDay:l=i.visitDateDay||i.visitDate;break;case le.DateMillisecond:l=i.visitDateMillisecond||i.visitDate;break;case le.Timestamp:l=i.visitTimestamp;break;case le.TimestampSecond:l=i.visitTimestampSecond||i.visitTimestamp;break;case le.TimestampMillisecond:l=i.visitTimestampMillisecond||i.visitTimestamp;break;case le.TimestampMicrosecond:l=i.visitTimestampMicrosecond||i.visitTimestamp;break;case le.TimestampNanosecond:l=i.visitTimestampNanosecond||i.visitTimestamp;break;case le.Time:l=i.visitTime;break;case le.TimeSecond:l=i.visitTimeSecond||i.visitTime;break;case le.TimeMillisecond:l=i.visitTimeMillisecond||i.visitTime;break;case le.TimeMicrosecond:l=i.visitTimeMicrosecond||i.visitTime;break;case le.TimeNanosecond:l=i.visitTimeNanosecond||i.visitTime;break;case le.Decimal:l=i.visitDecimal;break;case le.List:l=i.visitList;break;case le.Struct:l=i.visitStruct;break;case le.Union:l=i.visitUnion;break;case le.DenseUnion:l=i.visitDenseUnion||i.visitUnion;break;case le.SparseUnion:l=i.visitSparseUnion||i.visitUnion;break;case le.Dictionary:l=i.visitDictionary;break;case le.Interval:l=i.visitInterval;break;case le.IntervalDayTime:l=i.visitIntervalDayTime||i.visitInterval;break;case le.IntervalYearMonth:l=i.visitIntervalYearMonth||i.visitInterval;break;case le.Duration:l=i.visitDuration;break;case le.DurationSecond:l=i.visitDurationSecond||i.visitDuration;break;case le.DurationMillisecond:l=i.visitDurationMillisecond||i.visitDuration;break;case le.DurationMicrosecond:l=i.visitDurationMicrosecond||i.visitDuration;break;case le.DurationNanosecond:l=i.visitDurationNanosecond||i.visitDuration;break;case le.FixedSizeList:l=i.visitFixedSizeList;break;case le.Map:l=i.visitMap;break}if(typeof l=="function")return l;if(!n)return()=>null;throw new Error(`Unrecognized type '${le[e]}'`)}function vv(i){switch(i.typeId){case le.Null:return le.Null;case le.Int:{const{bitWidth:e,isSigned:n}=i;switch(e){case 8:return n?le.Int8:le.Uint8;case 16:return n?le.Int16:le.Uint16;case 32:return n?le.Int32:le.Uint32;case 64:return n?le.Int64:le.Uint64}return le.Int}case le.Float:switch(i.precision){case qn.HALF:return le.Float16;case qn.SINGLE:return le.Float32;case qn.DOUBLE:return le.Float64}return le.Float;case le.Binary:return le.Binary;case le.LargeBinary:return le.LargeBinary;case le.Utf8:return le.Utf8;case le.LargeUtf8:return le.LargeUtf8;case le.Bool:return le.Bool;case le.Decimal:return le.Decimal;case le.Time:switch(i.unit){case Wt.SECOND:return le.TimeSecond;case Wt.MILLISECOND:return le.TimeMillisecond;case Wt.MICROSECOND:return le.TimeMicrosecond;case Wt.NANOSECOND:return le.TimeNanosecond}return le.Time;case le.Timestamp:switch(i.unit){case Wt.SECOND:return le.TimestampSecond;case Wt.MILLISECOND:return le.TimestampMillisecond;case Wt.MICROSECOND:return le.TimestampMicrosecond;case Wt.NANOSECOND:return le.TimestampNanosecond}return le.Timestamp;case le.Date:switch(i.unit){case Ks.DAY:return le.DateDay;case Ks.MILLISECOND:return le.DateMillisecond}return le.Date;case le.Interval:switch(i.unit){case Ua.DAY_TIME:return le.IntervalDayTime;case Ua.YEAR_MONTH:return le.IntervalYearMonth}return le.Interval;case le.Duration:switch(i.unit){case Wt.SECOND:return le.DurationSecond;case Wt.MILLISECOND:return le.DurationMillisecond;case Wt.MICROSECOND:return le.DurationMicrosecond;case Wt.NANOSECOND:return le.DurationNanosecond}return le.Duration;case le.Map:return le.Map;case le.List:return le.List;case le.Struct:return le.Struct;case le.Union:switch(i.mode){case Gn.Dense:return le.DenseUnion;case Gn.Sparse:return le.SparseUnion}return le.Union;case le.FixedSizeBinary:return le.FixedSizeBinary;case le.FixedSizeList:return le.FixedSizeList;case le.Dictionary:return le.Dictionary}throw new Error(`Unrecognized type '${le[i.typeId]}'`)}Er.prototype.visitInt8=null;Er.prototype.visitInt16=null;Er.prototype.visitInt32=null;Er.prototype.visitInt64=null;Er.prototype.visitUint8=null;Er.prototype.visitUint16=null;Er.prototype.visitUint32=null;Er.prototype.visitUint64=null;Er.prototype.visitFloat16=null;Er.prototype.visitFloat32=null;Er.prototype.visitFloat64=null;Er.prototype.visitDateDay=null;Er.prototype.visitDateMillisecond=null;Er.prototype.visitTimestampSecond=null;Er.prototype.visitTimestampMillisecond=null;Er.prototype.visitTimestampMicrosecond=null;Er.prototype.visitTimestampNanosecond=null;Er.prototype.visitTimeSecond=null;Er.prototype.visitTimeMillisecond=null;Er.prototype.visitTimeMicrosecond=null;Er.prototype.visitTimeNanosecond=null;Er.prototype.visitDenseUnion=null;Er.prototype.visitSparseUnion=null;Er.prototype.visitIntervalDayTime=null;Er.prototype.visitIntervalYearMonth=null;Er.prototype.visitDuration=null;Er.prototype.visitDurationSecond=null;Er.prototype.visitDurationMillisecond=null;Er.prototype.visitDurationMicrosecond=null;Er.prototype.visitDurationNanosecond=null;const _x=new Float64Array(1),kc=new Uint32Array(_x.buffer);function vx(i){const e=(i&31744)>>10,n=(i&1023)/1024,l=Math.pow(-1,(i&32768)>>15);switch(e){case 31:return l*(n?Number.NaN:1/0);case 0:return l*(n?6103515625e-14*n:0)}return l*Math.pow(2,e-15)*(1+n)}function gT(i){if(i!==i)return 32256;_x[0]=i;const e=(kc[1]&2147483648)>>16&65535;let n=kc[1]&2146435072,l=0;return n>=1089470464?kc[0]>0?n=31744:(n=(n&2080374784)>>16,l=(kc[1]&1048575)>>10):n<=1056964608?(l=1048576+(kc[1]&1048575),l=1048576+(l<<(n>>20)-998)>>21,n=0):(n=n-1056964608>>10,l=(kc[1]&1048575)+512>>10),e|n|l&65535}class Ht extends Er{}function Qt(i){return(e,n,l)=>{if(e.setValid(n,l!=null))return i(e,n,l)}}const yT=(i,e,n)=>{i[e]=Math.floor(n/864e5)},bx=(i,e,n,l)=>{if(n+1<e.length){const p=mi(e[n]),v=mi(e[n+1]);i.set(l.subarray(0,v-p),p)}},_T=({offset:i,values:e},n,l)=>{const p=i+n;l?e[p>>3]|=1<<p%8:e[p>>3]&=~(1<<p%8)},yo=({values:i},e,n)=>{i[e]=n},by=({values:i},e,n)=>{i[e]=n},xx=({values:i},e,n)=>{i[e]=gT(n)},vT=(i,e,n)=>{switch(i.type.precision){case qn.HALF:return xx(i,e,n);case qn.SINGLE:case qn.DOUBLE:return by(i,e,n)}},wx=({values:i},e,n)=>{yT(i,e,n.valueOf())},Sx=({values:i},e,n)=>{i[e]=BigInt(n)},bT=({stride:i,values:e},n,l)=>{e.set(l.subarray(0,i),i*n)},Ix=({values:i,valueOffsets:e},n,l)=>bx(i,e,n,l),Tx=({values:i,valueOffsets:e},n,l)=>bx(i,e,n,gy(l)),xT=(i,e,n)=>{i.type.unit===Ks.DAY?wx(i,e,n):Sx(i,e,n)},kx=({values:i},e,n)=>{i[e]=BigInt(n/1e3)},Ax=({values:i},e,n)=>{i[e]=BigInt(n)},Ex=({values:i},e,n)=>{i[e]=BigInt(n*1e3)},Cx=({values:i},e,n)=>{i[e]=BigInt(n*1e6)},wT=(i,e,n)=>{switch(i.type.unit){case Wt.SECOND:return kx(i,e,n);case Wt.MILLISECOND:return Ax(i,e,n);case Wt.MICROSECOND:return Ex(i,e,n);case Wt.NANOSECOND:return Cx(i,e,n)}},Mx=({values:i},e,n)=>{i[e]=n},Dx=({values:i},e,n)=>{i[e]=n},Px=({values:i},e,n)=>{i[e]=n},Lx=({values:i},e,n)=>{i[e]=n},ST=(i,e,n)=>{switch(i.type.unit){case Wt.SECOND:return Mx(i,e,n);case Wt.MILLISECOND:return Dx(i,e,n);case Wt.MICROSECOND:return Px(i,e,n);case Wt.NANOSECOND:return Lx(i,e,n)}},IT=({values:i,stride:e},n,l)=>{i.set(l.subarray(0,e),e*n)},TT=(i,e,n)=>{const l=i.children[0],p=i.valueOffsets,v=Xs.getVisitFn(l);if(Array.isArray(n))for(let b=-1,c=p[e],E=p[e+1];c<E;)v(l,c++,n[++b]);else for(let b=-1,c=p[e],E=p[e+1];c<E;)v(l,c++,n.get(++b))},kT=(i,e,n)=>{const l=i.children[0],{valueOffsets:p}=i,v=Xs.getVisitFn(l);let{[e]:b,[e+1]:c}=p;const E=n instanceof Map?n.entries():Object.entries(n);for(const T of E)if(v(l,b,T),++b>=c)break},AT=(i,e)=>(n,l,p,v)=>l&&n(l,i,e[v]),ET=(i,e)=>(n,l,p,v)=>l&&n(l,i,e.get(v)),CT=(i,e)=>(n,l,p,v)=>l&&n(l,i,e.get(p.name)),MT=(i,e)=>(n,l,p,v)=>l&&n(l,i,e[p.name]),DT=(i,e,n)=>{const l=i.type.children.map(v=>Xs.getVisitFn(v.type)),p=n instanceof Map?CT(e,n):n instanceof Jr?ET(e,n):Array.isArray(n)?AT(e,n):MT(e,n);i.type.children.forEach((v,b)=>p(l[b],i.children[b],v,b))},PT=(i,e,n)=>{i.type.mode===Gn.Dense?zx(i,e,n):Bx(i,e,n)},zx=(i,e,n)=>{const l=i.type.typeIdToChildIndex[i.typeIds[e]],p=i.children[l];Xs.visit(p,i.valueOffsets[e],n)},Bx=(i,e,n)=>{const l=i.type.typeIdToChildIndex[i.typeIds[e]],p=i.children[l];Xs.visit(p,e,n)},LT=(i,e,n)=>{var l;(l=i.dictionary)===null||l===void 0||l.set(i.values[e],n)},zT=(i,e,n)=>{i.type.unit===Ua.DAY_TIME?Rx(i,e,n):Fx(i,e,n)},Rx=({values:i},e,n)=>{i.set(n.subarray(0,2),2*e)},Fx=({values:i},e,n)=>{i[e]=n[0]*12+n[1]%12},Ox=({values:i},e,n)=>{i[e]=n},Nx=({values:i},e,n)=>{i[e]=n},Ux=({values:i},e,n)=>{i[e]=n},$x=({values:i},e,n)=>{i[e]=n},BT=(i,e,n)=>{switch(i.type.unit){case Wt.SECOND:return Ox(i,e,n);case Wt.MILLISECOND:return Nx(i,e,n);case Wt.MICROSECOND:return Ux(i,e,n);case Wt.NANOSECOND:return $x(i,e,n)}},RT=(i,e,n)=>{const{stride:l}=i,p=i.children[0],v=Xs.getVisitFn(p);if(Array.isArray(n))for(let b=-1,c=e*l;++b<l;)v(p,c+b,n[b]);else for(let b=-1,c=e*l;++b<l;)v(p,c+b,n.get(b))};Ht.prototype.visitBool=Qt(_T);Ht.prototype.visitInt=Qt(yo);Ht.prototype.visitInt8=Qt(yo);Ht.prototype.visitInt16=Qt(yo);Ht.prototype.visitInt32=Qt(yo);Ht.prototype.visitInt64=Qt(yo);Ht.prototype.visitUint8=Qt(yo);Ht.prototype.visitUint16=Qt(yo);Ht.prototype.visitUint32=Qt(yo);Ht.prototype.visitUint64=Qt(yo);Ht.prototype.visitFloat=Qt(vT);Ht.prototype.visitFloat16=Qt(xx);Ht.prototype.visitFloat32=Qt(by);Ht.prototype.visitFloat64=Qt(by);Ht.prototype.visitUtf8=Qt(Tx);Ht.prototype.visitLargeUtf8=Qt(Tx);Ht.prototype.visitBinary=Qt(Ix);Ht.prototype.visitLargeBinary=Qt(Ix);Ht.prototype.visitFixedSizeBinary=Qt(bT);Ht.prototype.visitDate=Qt(xT);Ht.prototype.visitDateDay=Qt(wx);Ht.prototype.visitDateMillisecond=Qt(Sx);Ht.prototype.visitTimestamp=Qt(wT);Ht.prototype.visitTimestampSecond=Qt(kx);Ht.prototype.visitTimestampMillisecond=Qt(Ax);Ht.prototype.visitTimestampMicrosecond=Qt(Ex);Ht.prototype.visitTimestampNanosecond=Qt(Cx);Ht.prototype.visitTime=Qt(ST);Ht.prototype.visitTimeSecond=Qt(Mx);Ht.prototype.visitTimeMillisecond=Qt(Dx);Ht.prototype.visitTimeMicrosecond=Qt(Px);Ht.prototype.visitTimeNanosecond=Qt(Lx);Ht.prototype.visitDecimal=Qt(IT);Ht.prototype.visitList=Qt(TT);Ht.prototype.visitStruct=Qt(DT);Ht.prototype.visitUnion=Qt(PT);Ht.prototype.visitDenseUnion=Qt(zx);Ht.prototype.visitSparseUnion=Qt(Bx);Ht.prototype.visitDictionary=Qt(LT);Ht.prototype.visitInterval=Qt(zT);Ht.prototype.visitIntervalDayTime=Qt(Rx);Ht.prototype.visitIntervalYearMonth=Qt(Fx);Ht.prototype.visitDuration=Qt(BT);Ht.prototype.visitDurationSecond=Qt(Ox);Ht.prototype.visitDurationMillisecond=Qt(Nx);Ht.prototype.visitDurationMicrosecond=Qt(Ux);Ht.prototype.visitDurationNanosecond=Qt($x);Ht.prototype.visitFixedSizeList=Qt(RT);Ht.prototype.visitMap=Qt(kT);const Xs=new Ht,ha=Symbol.for("parent"),Gc=Symbol.for("rowIndex");class xy{constructor(e,n){return this[ha]=e,this[Gc]=n,new Proxy(this,new OT)}toArray(){return Object.values(this.toJSON())}toJSON(){const e=this[Gc],n=this[ha],l=n.type.children,p={};for(let v=-1,b=l.length;++v<b;)p[l[v].name]=Ss.visit(n.children[v],e);return p}toString(){return`{${[...this].map(([e,n])=>`${Nh(e)}: ${Nh(n)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}[Symbol.iterator](){return new FT(this[ha],this[Gc])}}class FT{constructor(e,n){this.childIndex=0,this.children=e.children,this.rowIndex=n,this.childFields=e.type.children,this.numChildren=this.childFields.length}[Symbol.iterator](){return this}next(){const e=this.childIndex;return e<this.numChildren?(this.childIndex=e+1,{done:!1,value:[this.childFields[e].name,Ss.visit(this.children[e],this.rowIndex)]}):{done:!0,value:null}}}Object.defineProperties(xy.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[ha]:{writable:!0,enumerable:!1,configurable:!1,value:null},[Gc]:{writable:!0,enumerable:!1,configurable:!1,value:-1}});class OT{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(e){return e[ha].type.children.map(n=>n.name)}has(e,n){return e[ha].type.children.findIndex(l=>l.name===n)!==-1}getOwnPropertyDescriptor(e,n){if(e[ha].type.children.findIndex(l=>l.name===n)!==-1)return{writable:!0,enumerable:!0,configurable:!0}}get(e,n){if(Reflect.has(e,n))return e[n];const l=e[ha].type.children.findIndex(p=>p.name===n);if(l!==-1){const p=Ss.visit(e[ha].children[l],e[Gc]);return Reflect.set(e,n,p),p}}set(e,n,l){const p=e[ha].type.children.findIndex(v=>v.name===n);return p!==-1?(Xs.visit(e[ha].children[p],e[Gc],l),Reflect.set(e,n,l)):Reflect.has(e,n)||typeof n=="symbol"?Reflect.set(e,n,l):!1}}class jt extends Er{}function Yt(i){return(e,n)=>e.getValid(n)?i(e,n):null}const NT=(i,e)=>864e5*i[e],UT=(i,e)=>null,Vx=(i,e,n)=>{if(n+1>=e.length)return null;const l=mi(e[n]),p=mi(e[n+1]);return i.subarray(l,p)},$T=({offset:i,values:e},n)=>{const l=i+n;return(e[l>>3]&1<<l%8)!==0},jx=({values:i},e)=>NT(i,e),qx=({values:i},e)=>mi(i[e]),rl=({stride:i,values:e},n)=>e[i*n],VT=({stride:i,values:e},n)=>vx(e[i*n]),Gx=({values:i},e)=>i[e],jT=({stride:i,values:e},n)=>e.subarray(i*n,i*(n+1)),Zx=({values:i,valueOffsets:e},n)=>Vx(i,e,n),Wx=({values:i,valueOffsets:e},n)=>{const l=Vx(i,e,n);return l!==null?Bg(l):null},qT=({values:i},e)=>i[e],GT=({type:i,values:e},n)=>i.precision!==qn.HALF?e[n]:vx(e[n]),ZT=(i,e)=>i.type.unit===Ks.DAY?jx(i,e):qx(i,e),Hx=({values:i},e)=>1e3*mi(i[e]),Yx=({values:i},e)=>mi(i[e]),Kx=({values:i},e)=>Hb(i[e],BigInt(1e3)),Xx=({values:i},e)=>Hb(i[e],BigInt(1e6)),WT=(i,e)=>{switch(i.type.unit){case Wt.SECOND:return Hx(i,e);case Wt.MILLISECOND:return Yx(i,e);case Wt.MICROSECOND:return Kx(i,e);case Wt.NANOSECOND:return Xx(i,e)}},Jx=({values:i},e)=>i[e],Qx=({values:i},e)=>i[e],e1=({values:i},e)=>i[e],t1=({values:i},e)=>i[e],HT=(i,e)=>{switch(i.type.unit){case Wt.SECOND:return Jx(i,e);case Wt.MILLISECOND:return Qx(i,e);case Wt.MICROSECOND:return e1(i,e);case Wt.NANOSECOND:return t1(i,e)}},YT=({values:i,stride:e},n)=>vy.decimal(i.subarray(e*n,e*(n+1))),KT=(i,e)=>{const{valueOffsets:n,stride:l,children:p}=i,{[e*l]:v,[e*l+1]:b}=n,E=p[0].slice(v,b-v);return new Jr([E])},XT=(i,e)=>{const{valueOffsets:n,children:l}=i,{[e]:p,[e+1]:v}=n,b=l[0];return new wy(b.slice(p,v-p))},JT=(i,e)=>new xy(i,e),QT=(i,e)=>i.type.mode===Gn.Dense?r1(i,e):i1(i,e),r1=(i,e)=>{const n=i.type.typeIdToChildIndex[i.typeIds[e]],l=i.children[n];return Ss.visit(l,i.valueOffsets[e])},i1=(i,e)=>{const n=i.type.typeIdToChildIndex[i.typeIds[e]],l=i.children[n];return Ss.visit(l,e)},ek=(i,e)=>{var n;return(n=i.dictionary)===null||n===void 0?void 0:n.get(i.values[e])},tk=(i,e)=>i.type.unit===Ua.DAY_TIME?n1(i,e):s1(i,e),n1=({values:i},e)=>i.subarray(2*e,2*(e+1)),s1=({values:i},e)=>{const n=i[e],l=new Int32Array(2);return l[0]=Math.trunc(n/12),l[1]=Math.trunc(n%12),l},a1=({values:i},e)=>i[e],o1=({values:i},e)=>i[e],l1=({values:i},e)=>i[e],c1=({values:i},e)=>i[e],rk=(i,e)=>{switch(i.type.unit){case Wt.SECOND:return a1(i,e);case Wt.MILLISECOND:return o1(i,e);case Wt.MICROSECOND:return l1(i,e);case Wt.NANOSECOND:return c1(i,e)}},ik=(i,e)=>{const{stride:n,children:l}=i,v=l[0].slice(e*n,n);return new Jr([v])};jt.prototype.visitNull=Yt(UT);jt.prototype.visitBool=Yt($T);jt.prototype.visitInt=Yt(qT);jt.prototype.visitInt8=Yt(rl);jt.prototype.visitInt16=Yt(rl);jt.prototype.visitInt32=Yt(rl);jt.prototype.visitInt64=Yt(Gx);jt.prototype.visitUint8=Yt(rl);jt.prototype.visitUint16=Yt(rl);jt.prototype.visitUint32=Yt(rl);jt.prototype.visitUint64=Yt(Gx);jt.prototype.visitFloat=Yt(GT);jt.prototype.visitFloat16=Yt(VT);jt.prototype.visitFloat32=Yt(rl);jt.prototype.visitFloat64=Yt(rl);jt.prototype.visitUtf8=Yt(Wx);jt.prototype.visitLargeUtf8=Yt(Wx);jt.prototype.visitBinary=Yt(Zx);jt.prototype.visitLargeBinary=Yt(Zx);jt.prototype.visitFixedSizeBinary=Yt(jT);jt.prototype.visitDate=Yt(ZT);jt.prototype.visitDateDay=Yt(jx);jt.prototype.visitDateMillisecond=Yt(qx);jt.prototype.visitTimestamp=Yt(WT);jt.prototype.visitTimestampSecond=Yt(Hx);jt.prototype.visitTimestampMillisecond=Yt(Yx);jt.prototype.visitTimestampMicrosecond=Yt(Kx);jt.prototype.visitTimestampNanosecond=Yt(Xx);jt.prototype.visitTime=Yt(HT);jt.prototype.visitTimeSecond=Yt(Jx);jt.prototype.visitTimeMillisecond=Yt(Qx);jt.prototype.visitTimeMicrosecond=Yt(e1);jt.prototype.visitTimeNanosecond=Yt(t1);jt.prototype.visitDecimal=Yt(YT);jt.prototype.visitList=Yt(KT);jt.prototype.visitStruct=Yt(JT);jt.prototype.visitUnion=Yt(QT);jt.prototype.visitDenseUnion=Yt(r1);jt.prototype.visitSparseUnion=Yt(i1);jt.prototype.visitDictionary=Yt(ek);jt.prototype.visitInterval=Yt(tk);jt.prototype.visitIntervalDayTime=Yt(n1);jt.prototype.visitIntervalYearMonth=Yt(s1);jt.prototype.visitDuration=Yt(rk);jt.prototype.visitDurationSecond=Yt(a1);jt.prototype.visitDurationMillisecond=Yt(o1);jt.prototype.visitDurationMicrosecond=Yt(l1);jt.prototype.visitDurationNanosecond=Yt(c1);jt.prototype.visitFixedSizeList=Yt(ik);jt.prototype.visitMap=Yt(XT);const Ss=new jt,Fc=Symbol.for("keys"),Zc=Symbol.for("vals"),Oc=Symbol.for("kKeysAsStrings"),$g=Symbol.for("_kKeysAsStrings");class wy{constructor(e){return this[Fc]=new Jr([e.children[0]]).memoize(),this[Zc]=e.children[1],new Proxy(this,new sk)}get[Oc](){return this[$g]||(this[$g]=Array.from(this[Fc].toArray(),String))}[Symbol.iterator](){return new nk(this[Fc],this[Zc])}get size(){return this[Fc].length}toArray(){return Object.values(this.toJSON())}toJSON(){const e=this[Fc],n=this[Zc],l={};for(let p=-1,v=e.length;++p<v;)l[e.get(p)]=Ss.visit(n,p);return l}toString(){return`{${[...this].map(([e,n])=>`${Nh(e)}: ${Nh(n)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}}class nk{constructor(e,n){this.keys=e,this.vals=n,this.keyIndex=0,this.numKeys=e.length}[Symbol.iterator](){return this}next(){const e=this.keyIndex;return e===this.numKeys?{done:!0,value:null}:(this.keyIndex++,{done:!1,value:[this.keys.get(e),Ss.visit(this.vals,e)]})}}class sk{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(e){return e[Oc]}has(e,n){return e[Oc].includes(n)}getOwnPropertyDescriptor(e,n){if(e[Oc].indexOf(n)!==-1)return{writable:!0,enumerable:!0,configurable:!0}}get(e,n){if(Reflect.has(e,n))return e[n];const l=e[Oc].indexOf(n);if(l!==-1){const p=Ss.visit(Reflect.get(e,Zc),l);return Reflect.set(e,n,p),p}}set(e,n,l){const p=e[Oc].indexOf(n);return p!==-1?(Xs.visit(Reflect.get(e,Zc),p,l),Reflect.set(e,n,l)):Reflect.has(e,n)?Reflect.set(e,n,l):!1}}Object.defineProperties(wy.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[Fc]:{writable:!0,enumerable:!1,configurable:!1,value:null},[Zc]:{writable:!0,enumerable:!1,configurable:!1,value:null},[$g]:{writable:!0,enumerable:!1,configurable:!1,value:null}});let bv;function u1(i,e,n,l){const{length:p=0}=i;let v=typeof e!="number"?0:e,b=typeof n!="number"?p:n;return v<0&&(v=(v%p+p)%p),b<0&&(b=(b%p+p)%p),b<v&&(bv=v,v=b,b=bv),b>p&&(b=p),l?l(i,v,b):[v,b]}const Sy=(i,e)=>i<0?e+i:i,xv=i=>i!==i;function lu(i){if(typeof i!=="object"||i===null)return xv(i)?xv:n=>n===i;if(i instanceof Date){const n=i.valueOf();return l=>l instanceof Date?l.valueOf()===n:!1}return ArrayBuffer.isView(i)?n=>n?iT(i,n):!1:i instanceof Map?ok(i):Array.isArray(i)?ak(i):i instanceof Jr?lk(i):ck(i,!0)}function ak(i){const e=[];for(let n=-1,l=i.length;++n<l;)e[n]=lu(i[n]);return Zp(e)}function ok(i){let e=-1;const n=[];for(const l of i.values())n[++e]=lu(l);return Zp(n)}function lk(i){const e=[];for(let n=-1,l=i.length;++n<l;)e[n]=lu(i.get(n));return Zp(e)}function ck(i,e=!1){const n=Object.keys(i);if(!e&&n.length===0)return()=>!1;const l=[];for(let p=-1,v=n.length;++p<v;)l[p]=lu(i[n[p]]);return Zp(l,n)}function Zp(i,e){return n=>{if(!n||typeof n!="object")return!1;switch(n.constructor){case Array:return uk(i,n);case Map:return wv(i,n,n.keys());case wy:case xy:case Object:case void 0:return wv(i,n,e||Object.keys(n))}return n instanceof Jr?hk(i,n):!1}}function uk(i,e){const n=i.length;if(e.length!==n)return!1;for(let l=-1;++l<n;)if(!i[l](e[l]))return!1;return!0}function hk(i,e){const n=i.length;if(e.length!==n)return!1;for(let l=-1;++l<n;)if(!i[l](e.get(l)))return!1;return!0}function wv(i,e,n){const l=n[Symbol.iterator](),p=e instanceof Map?e.keys():Object.keys(e)[Symbol.iterator](),v=e instanceof Map?e.values():Object.values(e)[Symbol.iterator]();let b=0;const c=i.length;let E=v.next(),T=l.next(),z=p.next();for(;b<c&&!T.done&&!z.done&&!E.done&&!(T.value!==z.value||!i[b](E.value));++b,T=l.next(),z=p.next(),E=v.next());return b===c&&T.done&&z.done&&E.done?!0:(l.return&&l.return(),p.return&&p.return(),v.return&&v.return(),!1)}function h1(i,e,n,l){return(n&1<<l)!==0}function dk(i,e,n,l){return(n&1<<l)>>l}function gp(i,e,n){const l=n.byteLength+7&-8;if(i>0||n.byteLength<l){const p=new Uint8Array(l);return p.set(i%8===0?n.subarray(i>>3):yp(new Iy(n,i,e,null,h1)).subarray(0,l)),p}return n}function yp(i){const e=[];let n=0,l=0,p=0;for(const b of i)b&&(p|=1<<l),++l===8&&(e[n++]=p,p=l=0);(n===0||l>0)&&(e[n++]=p);const v=new Uint8Array(e.length+7&-8);return v.set(e),v}class Iy{constructor(e,n,l,p,v){this.bytes=e,this.length=l,this.context=p,this.get=v,this.bit=n%8,this.byteIndex=n>>3,this.byte=e[this.byteIndex++],this.index=0}next(){return this.index<this.length?(this.bit===8&&(this.bit=0,this.byte=this.bytes[this.byteIndex++]),{value:this.get(this.context,this.index++,this.byte,this.bit++)}):{done:!0,value:null}}[Symbol.iterator](){return this}}function Vg(i,e,n){if(n-e<=0)return 0;if(n-e<8){let v=0;for(const b of new Iy(i,e,n-e,i,dk))v+=b;return v}const l=n>>3<<3,p=e+(e%8===0?0:8-e%8);return Vg(i,e,p)+Vg(i,l,n)+fk(i,p>>3,l-p>>3)}function fk(i,e,n){let l=0,p=Math.trunc(e);const v=new DataView(i.buffer,i.byteOffset,i.byteLength),b=n===void 0?i.byteLength:p+n;for(;b-p>=4;)l+=mg(v.getUint32(p)),p+=4;for(;b-p>=2;)l+=mg(v.getUint16(p)),p+=2;for(;b-p>=1;)l+=mg(v.getUint8(p)),p+=1;return l}function mg(i){let e=Math.trunc(i);return e=e-(e>>>1&1431655765),e=(e&858993459)+(e>>>2&858993459),(e+(e>>>4)&252645135)*16843009>>>24}const pk=-1;class ii{get typeId(){return this.type.typeId}get ArrayType(){return this.type.ArrayType}get buffers(){return[this.valueOffsets,this.values,this.nullBitmap,this.typeIds]}get nullable(){if(this._nullCount!==0){const{type:e}=this;return Ot.isSparseUnion(e)?this.children.some(n=>n.nullable):Ot.isDenseUnion(e)?this.children.some(n=>n.nullable):this.nullBitmap&&this.nullBitmap.byteLength>0}return!0}get byteLength(){let e=0;const{valueOffsets:n,values:l,nullBitmap:p,typeIds:v}=this;return n&&(e+=n.byteLength),l&&(e+=l.byteLength),p&&(e+=p.byteLength),v&&(e+=v.byteLength),this.children.reduce((b,c)=>b+c.byteLength,e)}get nullCount(){if(Ot.isUnion(this.type))return this.children.reduce((l,p)=>l+p.nullCount,0);let e=this._nullCount,n;return e<=pk&&(n=this.nullBitmap)&&(this._nullCount=e=n.length===0?0:this.length-Vg(n,this.offset,this.offset+this.length)),e}constructor(e,n,l,p,v,b=[],c){this.type=e,this.children=b,this.dictionary=c,this.offset=Math.floor(Math.max(n||0,0)),this.length=Math.floor(Math.max(l||0,0)),this._nullCount=Math.floor(Math.max(p||0,-1));let E;v instanceof ii?(this.stride=v.stride,this.values=v.values,this.typeIds=v.typeIds,this.nullBitmap=v.nullBitmap,this.valueOffsets=v.valueOffsets):(this.stride=ho(e),v&&((E=v[0])&&(this.valueOffsets=E),(E=v[1])&&(this.values=E),(E=v[2])&&(this.nullBitmap=E),(E=v[3])&&(this.typeIds=E)))}getValid(e){const{type:n}=this;if(Ot.isUnion(n)){const l=n,p=this.children[l.typeIdToChildIndex[this.typeIds[e]]],v=l.mode===Gn.Dense?this.valueOffsets[e]:e;return p.getValid(v)}if(this.nullable&&this.nullCount>0){const l=this.offset+e;return(this.nullBitmap[l>>3]&1<<l%8)!==0}return!0}setValid(e,n){let l;const{type:p}=this;if(Ot.isUnion(p)){const v=p,b=this.children[v.typeIdToChildIndex[this.typeIds[e]]],c=v.mode===Gn.Dense?this.valueOffsets[e]:e;l=b.getValid(c),b.setValid(c,n)}else{let{nullBitmap:v}=this;const{offset:b,length:c}=this,E=b+e,T=1<<E%8,z=E>>3;(!v||v.byteLength<=z)&&(v=new Uint8Array((b+c+63&-64)>>3).fill(255),this.nullCount>0?(v.set(gp(b,c,this.nullBitmap),0),Object.assign(this,{nullBitmap:v})):Object.assign(this,{nullBitmap:v,_nullCount:0}));const B=v[z];l=(B&T)!==0,v[z]=n?B|T:B&~T}return l!==!!n&&(this._nullCount=this.nullCount+(n?-1:1)),n}clone(e=this.type,n=this.offset,l=this.length,p=this._nullCount,v=this,b=this.children){return new ii(e,n,l,p,v,b,this.dictionary)}slice(e,n){const{stride:l,typeId:p,children:v}=this,b=+(this._nullCount===0)-1,c=p===16?l:1,E=this._sliceBuffers(e,n,l,p);return this.clone(this.type,this.offset+e,n,b,E,v.length===0||this.valueOffsets?v:this._sliceChildren(v,c*e,c*n))}_changeLengthAndBackfillNullBitmap(e){if(this.typeId===le.Null)return this.clone(this.type,0,e,0);const{length:n,nullCount:l}=this,p=new Uint8Array((e+63&-64)>>3).fill(255,0,n>>3);p[n>>3]=(1<<n-(n&-8))-1,l>0&&p.set(gp(this.offset,n,this.nullBitmap),0);const v=this.buffers;return v[uo.VALIDITY]=p,this.clone(this.type,0,e,l+(e-n),v)}_sliceBuffers(e,n,l,p){let v;const{buffers:b}=this;return(v=b[uo.TYPE])&&(b[uo.TYPE]=v.subarray(e,e+n)),(v=b[uo.OFFSET])&&(b[uo.OFFSET]=v.subarray(e,e+n+1))||(v=b[uo.DATA])&&(b[uo.DATA]=p===6?v:v.subarray(l*e,l*(e+n))),b}_sliceChildren(e,n,l){return e.map(p=>p.slice(n,l))}}ii.prototype.children=Object.freeze([]);class zh extends Er{visit(e){return this.getVisitFn(e.type).call(this,e)}visitNull(e){const{["type"]:n,["offset"]:l=0,["length"]:p=0}=e;return new ii(n,l,p,p)}visitBool(e){const{["type"]:n,["offset"]:l=0}=e,p=Fr(e.nullBitmap),v=si(n.ArrayType,e.data),{["length"]:b=v.length>>3,["nullCount"]:c=e.nullBitmap?-1:0}=e;return new ii(n,l,b,c,[void 0,v,p])}visitInt(e){const{["type"]:n,["offset"]:l=0}=e,p=Fr(e.nullBitmap),v=si(n.ArrayType,e.data),{["length"]:b=v.length,["nullCount"]:c=e.nullBitmap?-1:0}=e;return new ii(n,l,b,c,[void 0,v,p])}visitFloat(e){const{["type"]:n,["offset"]:l=0}=e,p=Fr(e.nullBitmap),v=si(n.ArrayType,e.data),{["length"]:b=v.length,["nullCount"]:c=e.nullBitmap?-1:0}=e;return new ii(n,l,b,c,[void 0,v,p])}visitUtf8(e){const{["type"]:n,["offset"]:l=0}=e,p=Fr(e.data),v=Fr(e.nullBitmap),b=_h(e.valueOffsets),{["length"]:c=b.length-1,["nullCount"]:E=e.nullBitmap?-1:0}=e;return new ii(n,l,c,E,[b,p,v])}visitLargeUtf8(e){const{["type"]:n,["offset"]:l=0}=e,p=Fr(e.data),v=Fr(e.nullBitmap),b=cv(e.valueOffsets),{["length"]:c=b.length-1,["nullCount"]:E=e.nullBitmap?-1:0}=e;return new ii(n,l,c,E,[b,p,v])}visitBinary(e){const{["type"]:n,["offset"]:l=0}=e,p=Fr(e.data),v=Fr(e.nullBitmap),b=_h(e.valueOffsets),{["length"]:c=b.length-1,["nullCount"]:E=e.nullBitmap?-1:0}=e;return new ii(n,l,c,E,[b,p,v])}visitLargeBinary(e){const{["type"]:n,["offset"]:l=0}=e,p=Fr(e.data),v=Fr(e.nullBitmap),b=cv(e.valueOffsets),{["length"]:c=b.length-1,["nullCount"]:E=e.nullBitmap?-1:0}=e;return new ii(n,l,c,E,[b,p,v])}visitFixedSizeBinary(e){const{["type"]:n,["offset"]:l=0}=e,p=Fr(e.nullBitmap),v=si(n.ArrayType,e.data),{["length"]:b=v.length/ho(n),["nullCount"]:c=e.nullBitmap?-1:0}=e;return new ii(n,l,b,c,[void 0,v,p])}visitDate(e){const{["type"]:n,["offset"]:l=0}=e,p=Fr(e.nullBitmap),v=si(n.ArrayType,e.data),{["length"]:b=v.length/ho(n),["nullCount"]:c=e.nullBitmap?-1:0}=e;return new ii(n,l,b,c,[void 0,v,p])}visitTimestamp(e){const{["type"]:n,["offset"]:l=0}=e,p=Fr(e.nullBitmap),v=si(n.ArrayType,e.data),{["length"]:b=v.length/ho(n),["nullCount"]:c=e.nullBitmap?-1:0}=e;return new ii(n,l,b,c,[void 0,v,p])}visitTime(e){const{["type"]:n,["offset"]:l=0}=e,p=Fr(e.nullBitmap),v=si(n.ArrayType,e.data),{["length"]:b=v.length/ho(n),["nullCount"]:c=e.nullBitmap?-1:0}=e;return new ii(n,l,b,c,[void 0,v,p])}visitDecimal(e){const{["type"]:n,["offset"]:l=0}=e,p=Fr(e.nullBitmap),v=si(n.ArrayType,e.data),{["length"]:b=v.length/ho(n),["nullCount"]:c=e.nullBitmap?-1:0}=e;return new ii(n,l,b,c,[void 0,v,p])}visitList(e){const{["type"]:n,["offset"]:l=0,["child"]:p}=e,v=Fr(e.nullBitmap),b=_h(e.valueOffsets),{["length"]:c=b.length-1,["nullCount"]:E=e.nullBitmap?-1:0}=e;return new ii(n,l,c,E,[b,void 0,v],[p])}visitStruct(e){const{["type"]:n,["offset"]:l=0,["children"]:p=[]}=e,v=Fr(e.nullBitmap),{length:b=p.reduce((E,{length:T})=>Math.max(E,T),0),nullCount:c=e.nullBitmap?-1:0}=e;return new ii(n,l,b,c,[void 0,void 0,v],p)}visitUnion(e){const{["type"]:n,["offset"]:l=0,["children"]:p=[]}=e,v=si(n.ArrayType,e.typeIds),{["length"]:b=v.length,["nullCount"]:c=-1}=e;if(Ot.isSparseUnion(n))return new ii(n,l,b,c,[void 0,void 0,void 0,v],p);const E=_h(e.valueOffsets);return new ii(n,l,b,c,[E,void 0,void 0,v],p)}visitDictionary(e){const{["type"]:n,["offset"]:l=0}=e,p=Fr(e.nullBitmap),v=si(n.indices.ArrayType,e.data),{["dictionary"]:b=new Jr([new zh().visit({type:n.dictionary})])}=e,{["length"]:c=v.length,["nullCount"]:E=e.nullBitmap?-1:0}=e;return new ii(n,l,c,E,[void 0,v,p],[],b)}visitInterval(e){const{["type"]:n,["offset"]:l=0}=e,p=Fr(e.nullBitmap),v=si(n.ArrayType,e.data),{["length"]:b=v.length/ho(n),["nullCount"]:c=e.nullBitmap?-1:0}=e;return new ii(n,l,b,c,[void 0,v,p])}visitDuration(e){const{["type"]:n,["offset"]:l=0}=e,p=Fr(e.nullBitmap),v=si(n.ArrayType,e.data),{["length"]:b=v.length,["nullCount"]:c=e.nullBitmap?-1:0}=e;return new ii(n,l,b,c,[void 0,v,p])}visitFixedSizeList(e){const{["type"]:n,["offset"]:l=0,["child"]:p=new zh().visit({type:n.valueType})}=e,v=Fr(e.nullBitmap),{["length"]:b=p.length/ho(n),["nullCount"]:c=e.nullBitmap?-1:0}=e;return new ii(n,l,b,c,[void 0,void 0,v],[p])}visitMap(e){const{["type"]:n,["offset"]:l=0,["child"]:p=new zh().visit({type:n.childType})}=e,v=Fr(e.nullBitmap),b=_h(e.valueOffsets),{["length"]:c=b.length-1,["nullCount"]:E=e.nullBitmap?-1:0}=e;return new ii(n,l,c,E,[b,void 0,v],[p])}}const mk=new zh;function Mr(i){return mk.visit(i)}class Sv{constructor(e=0,n){this.numChunks=e,this.getChunkIterator=n,this.chunkIndex=0,this.chunkIterator=this.getChunkIterator(0)}next(){for(;this.chunkIndex<this.numChunks;){const e=this.chunkIterator.next();if(!e.done)return e;++this.chunkIndex<this.numChunks&&(this.chunkIterator=this.getChunkIterator(this.chunkIndex))}return{done:!0,value:null}}[Symbol.iterator](){return this}}function gk(i){return i.some(e=>e.nullable)}function d1(i){return i.reduce((e,n)=>e+n.nullCount,0)}function f1(i){return i.reduce((e,n,l)=>(e[l+1]=e[l]+n.length,e),new Uint32Array(i.length+1))}function p1(i,e,n,l){const p=[];for(let v=-1,b=i.length;++v<b;){const c=i[v],E=e[v],{length:T}=c;if(E>=l)break;if(n>=E+T)continue;if(E>=n&&E+T<=l){p.push(c);continue}const z=Math.max(0,n-E),B=Math.min(l-E,T);p.push(c.slice(z,B-z))}return p.length===0&&p.push(i[0].slice(0,0)),p}function Ty(i,e,n,l){let p=0,v=0,b=e.length-1;do{if(p>=b-1)return n<e[b]?l(i,p,n-e[p]):null;v=p+Math.trunc((b-p)*.5),n<e[v]?b=v:p=v}while(p<b)}function ky(i,e){return i.getValid(e)}function _p(i){function e(n,l,p){return i(n[l],p)}return function(n){const l=this.data;return Ty(l,this._offsets,n,e)}}function m1(i){let e;function n(l,p,v){return i(l[p],v,e)}return function(l,p){const v=this.data;e=p;const b=Ty(v,this._offsets,l,n);return e=void 0,b}}function g1(i){let e;function n(l,p,v){let b=v,c=0,E=0;for(let T=p-1,z=l.length;++T<z;){const B=l[T];if(~(c=i(B,e,b)))return E+c;b=0,E+=B.length}return-1}return function(l,p){e=l;const v=this.data,b=typeof p!="number"?n(v,0,0):Ty(v,this._offsets,p,n);return e=void 0,b}}class qt extends Er{}function yk(i,e){return e===null&&i.length>0?0:-1}function _k(i,e){const{nullBitmap:n}=i;if(!n||i.nullCount<=0)return-1;let l=0;for(const p of new Iy(n,i.offset+(e||0),i.length,n,h1)){if(!p)return l;++l}return-1}function sr(i,e,n){if(e===void 0)return-1;if(e===null)switch(i.typeId){case le.Union:break;case le.Dictionary:break;default:return _k(i,n)}const l=Ss.getVisitFn(i),p=lu(e);for(let v=(n||0)-1,b=i.length;++v<b;)if(p(l(i,v)))return v;return-1}function y1(i,e,n){const l=Ss.getVisitFn(i),p=lu(e);for(let v=(n||0)-1,b=i.length;++v<b;)if(p(l(i,v)))return v;return-1}qt.prototype.visitNull=yk;qt.prototype.visitBool=sr;qt.prototype.visitInt=sr;qt.prototype.visitInt8=sr;qt.prototype.visitInt16=sr;qt.prototype.visitInt32=sr;qt.prototype.visitInt64=sr;qt.prototype.visitUint8=sr;qt.prototype.visitUint16=sr;qt.prototype.visitUint32=sr;qt.prototype.visitUint64=sr;qt.prototype.visitFloat=sr;qt.prototype.visitFloat16=sr;qt.prototype.visitFloat32=sr;qt.prototype.visitFloat64=sr;qt.prototype.visitUtf8=sr;qt.prototype.visitLargeUtf8=sr;qt.prototype.visitBinary=sr;qt.prototype.visitLargeBinary=sr;qt.prototype.visitFixedSizeBinary=sr;qt.prototype.visitDate=sr;qt.prototype.visitDateDay=sr;qt.prototype.visitDateMillisecond=sr;qt.prototype.visitTimestamp=sr;qt.prototype.visitTimestampSecond=sr;qt.prototype.visitTimestampMillisecond=sr;qt.prototype.visitTimestampMicrosecond=sr;qt.prototype.visitTimestampNanosecond=sr;qt.prototype.visitTime=sr;qt.prototype.visitTimeSecond=sr;qt.prototype.visitTimeMillisecond=sr;qt.prototype.visitTimeMicrosecond=sr;qt.prototype.visitTimeNanosecond=sr;qt.prototype.visitDecimal=sr;qt.prototype.visitList=sr;qt.prototype.visitStruct=sr;qt.prototype.visitUnion=sr;qt.prototype.visitDenseUnion=y1;qt.prototype.visitSparseUnion=y1;qt.prototype.visitDictionary=sr;qt.prototype.visitInterval=sr;qt.prototype.visitIntervalDayTime=sr;qt.prototype.visitIntervalYearMonth=sr;qt.prototype.visitDuration=sr;qt.prototype.visitDurationSecond=sr;qt.prototype.visitDurationMillisecond=sr;qt.prototype.visitDurationMicrosecond=sr;qt.prototype.visitDurationNanosecond=sr;qt.prototype.visitFixedSizeList=sr;qt.prototype.visitMap=sr;const vp=new qt;class Gt extends Er{}function Kt(i){const{type:e}=i;if(i.nullCount===0&&i.stride===1&&(Ot.isInt(e)&&e.bitWidth!==64||Ot.isTime(e)&&e.bitWidth!==64||Ot.isFloat(e)&&e.precision!==qn.HALF))return new Sv(i.data.length,l=>{const p=i.data[l];return p.values.subarray(0,p.length)[Symbol.iterator]()});let n=0;return new Sv(i.data.length,l=>{const v=i.data[l].length,b=i.slice(n,n+v);return n+=v,new vk(b)})}class vk{constructor(e){this.vector=e,this.index=0}next(){return this.index<this.vector.length?{value:this.vector.get(this.index++)}:{done:!0,value:null}}[Symbol.iterator](){return this}}Gt.prototype.visitNull=Kt;Gt.prototype.visitBool=Kt;Gt.prototype.visitInt=Kt;Gt.prototype.visitInt8=Kt;Gt.prototype.visitInt16=Kt;Gt.prototype.visitInt32=Kt;Gt.prototype.visitInt64=Kt;Gt.prototype.visitUint8=Kt;Gt.prototype.visitUint16=Kt;Gt.prototype.visitUint32=Kt;Gt.prototype.visitUint64=Kt;Gt.prototype.visitFloat=Kt;Gt.prototype.visitFloat16=Kt;Gt.prototype.visitFloat32=Kt;Gt.prototype.visitFloat64=Kt;Gt.prototype.visitUtf8=Kt;Gt.prototype.visitLargeUtf8=Kt;Gt.prototype.visitBinary=Kt;Gt.prototype.visitLargeBinary=Kt;Gt.prototype.visitFixedSizeBinary=Kt;Gt.prototype.visitDate=Kt;Gt.prototype.visitDateDay=Kt;Gt.prototype.visitDateMillisecond=Kt;Gt.prototype.visitTimestamp=Kt;Gt.prototype.visitTimestampSecond=Kt;Gt.prototype.visitTimestampMillisecond=Kt;Gt.prototype.visitTimestampMicrosecond=Kt;Gt.prototype.visitTimestampNanosecond=Kt;Gt.prototype.visitTime=Kt;Gt.prototype.visitTimeSecond=Kt;Gt.prototype.visitTimeMillisecond=Kt;Gt.prototype.visitTimeMicrosecond=Kt;Gt.prototype.visitTimeNanosecond=Kt;Gt.prototype.visitDecimal=Kt;Gt.prototype.visitList=Kt;Gt.prototype.visitStruct=Kt;Gt.prototype.visitUnion=Kt;Gt.prototype.visitDenseUnion=Kt;Gt.prototype.visitSparseUnion=Kt;Gt.prototype.visitDictionary=Kt;Gt.prototype.visitInterval=Kt;Gt.prototype.visitIntervalDayTime=Kt;Gt.prototype.visitIntervalYearMonth=Kt;Gt.prototype.visitDuration=Kt;Gt.prototype.visitDurationSecond=Kt;Gt.prototype.visitDurationMillisecond=Kt;Gt.prototype.visitDurationMicrosecond=Kt;Gt.prototype.visitDurationNanosecond=Kt;Gt.prototype.visitFixedSizeList=Kt;Gt.prototype.visitMap=Kt;const Ay=new Gt;var _1;const v1={},b1={};class Jr{constructor(e){var n,l,p;const v=e[0]instanceof Jr?e.flatMap(c=>c.data):e;if(v.length===0||v.some(c=>!(c instanceof ii)))throw new TypeError("Vector constructor expects an Array of Data instances.");const b=(n=v[0])===null||n===void 0?void 0:n.type;switch(v.length){case 0:this._offsets=[0];break;case 1:{const{get:c,set:E,indexOf:T}=v1[b.typeId],z=v[0];this.isValid=B=>ky(z,B),this.get=B=>c(z,B),this.set=(B,$)=>E(z,B,$),this.indexOf=B=>T(z,B),this._offsets=[0,z.length];break}default:Object.setPrototypeOf(this,b1[b.typeId]),this._offsets=f1(v);break}this.data=v,this.type=b,this.stride=ho(b),this.numChildren=(p=(l=b.children)===null||l===void 0?void 0:l.length)!==null&&p!==void 0?p:0,this.length=this._offsets.at(-1)}get byteLength(){return this.data.reduce((e,n)=>e+n.byteLength,0)}get nullable(){return gk(this.data)}get nullCount(){return d1(this.data)}get ArrayType(){return this.type.ArrayType}get[Symbol.toStringTag](){return`${this.VectorName}<${this.type[Symbol.toStringTag]}>`}get VectorName(){return`${le[this.type.typeId]}Vector`}isValid(e){return!1}get(e){return null}at(e){return this.get(Sy(e,this.length))}set(e,n){}indexOf(e,n){return-1}includes(e,n){return this.indexOf(e,n)>-1}[Symbol.iterator](){return Ay.visit(this)}concat(...e){return new Jr(this.data.concat(e.flatMap(n=>n.data).flat(Number.POSITIVE_INFINITY)))}slice(e,n){return new Jr(u1(this,e,n,({data:l,_offsets:p},v,b)=>p1(l,p,v,b)))}toJSON(){return[...this]}toArray(){const{type:e,data:n,length:l,stride:p,ArrayType:v}=this;switch(e.typeId){case le.Int:case le.Float:case le.Decimal:case le.Time:case le.Timestamp:switch(n.length){case 0:return new v;case 1:return n[0].values.subarray(0,l*p);default:return n.reduce((b,{values:c,length:E})=>(b.array.set(c.subarray(0,E*p),b.offset),b.offset+=E*p,b),{array:new v(l*p),offset:0}).array}}return[...this]}toString(){return`[${[...this].join(",")}]`}getChild(e){var n;return this.getChildAt((n=this.type.children)===null||n===void 0?void 0:n.findIndex(l=>l.name===e))}getChildAt(e){return e>-1&&e<this.numChildren?new Jr(this.data.map(({children:n})=>n[e])):null}get isMemoized(){return Ot.isDictionary(this.type)?this.data[0].dictionary.isMemoized:!1}memoize(){if(Ot.isDictionary(this.type)){const e=new bp(this.data[0].dictionary),n=this.data.map(l=>{const p=l.clone();return p.dictionary=e,p});return new Jr(n)}return new bp(this)}unmemoize(){if(Ot.isDictionary(this.type)&&this.isMemoized){const e=this.data[0].dictionary.unmemoize(),n=this.data.map(l=>{const p=l.clone();return p.dictionary=e,p});return new Jr(n)}return this}}_1=Symbol.toStringTag;Jr[_1]=(i=>{i.type=Ot.prototype,i.data=[],i.length=0,i.stride=1,i.numChildren=0,i._offsets=new Uint32Array([0]),i[Symbol.isConcatSpreadable]=!0;const e=Object.keys(le).map(n=>le[n]).filter(n=>typeof n=="number"&&n!==le.NONE);for(const n of e){const l=Ss.getVisitFnByTypeId(n),p=Xs.getVisitFnByTypeId(n),v=vp.getVisitFnByTypeId(n);v1[n]={get:l,set:p,indexOf:v},b1[n]=Object.create(i,{isValid:{value:_p(ky)},get:{value:_p(Ss.getVisitFnByTypeId(n))},set:{value:m1(Xs.getVisitFnByTypeId(n))},indexOf:{value:g1(vp.getVisitFnByTypeId(n))}})}return"Vector"})(Jr.prototype);class bp extends Jr{constructor(e){super(e.data);const n=this.get,l=this.set,p=this.slice,v=new Array(this.length);Object.defineProperty(this,"get",{value(b){const c=v[b];if(c!==void 0)return c;const E=n.call(this,b);return v[b]=E,E}}),Object.defineProperty(this,"set",{value(b,c){l.call(this,b,c),v[b]=c}}),Object.defineProperty(this,"slice",{value:(b,c)=>new bp(p.call(this,b,c))}),Object.defineProperty(this,"isMemoized",{value:!0}),Object.defineProperty(this,"unmemoize",{value:()=>new Jr(this.data)}),Object.defineProperty(this,"memoize",{value:()=>this})}}class jg{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}offset(){return this.bb.readInt64(this.bb_pos)}metaDataLength(){return this.bb.readInt32(this.bb_pos+8)}bodyLength(){return this.bb.readInt64(this.bb_pos+16)}static sizeOf(){return 24}static createBlock(e,n,l,p){return e.prep(8,24),e.writeInt64(BigInt(p??0)),e.pad(4),e.writeInt32(l),e.writeInt64(BigInt(n??0)),e.offset()}}class Es{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsFooter(e,n){return(n||new Es).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFooter(e,n){return e.setPosition(e.position()+ei),(n||new Es).__init(e.readInt32(e.position())+e.position(),e)}version(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):an.V1}schema(e){const n=this.bb.__offset(this.bb_pos,6);return n?(e||new Ca).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}dictionaries(e,n){const l=this.bb.__offset(this.bb_pos,8);return l?(n||new jg).__init(this.bb.__vector(this.bb_pos+l)+e*24,this.bb):null}dictionariesLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}recordBatches(e,n){const l=this.bb.__offset(this.bb_pos,10);return l?(n||new jg).__init(this.bb.__vector(this.bb_pos+l)+e*24,this.bb):null}recordBatchesLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}customMetadata(e,n){const l=this.bb.__offset(this.bb_pos,12);return l?(n||new _n).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+l)+e*4),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}static startFooter(e){e.startObject(5)}static addVersion(e,n){e.addFieldInt16(0,n,an.V1)}static addSchema(e,n){e.addFieldOffset(1,n,0)}static addDictionaries(e,n){e.addFieldOffset(2,n,0)}static startDictionariesVector(e,n){e.startVector(24,n,8)}static addRecordBatches(e,n){e.addFieldOffset(3,n,0)}static startRecordBatchesVector(e,n){e.startVector(24,n,8)}static addCustomMetadata(e,n){e.addFieldOffset(4,n,0)}static createCustomMetadataVector(e,n){e.startVector(4,n.length,4);for(let l=n.length-1;l>=0;l--)e.addOffset(n[l]);return e.endVector()}static startCustomMetadataVector(e,n){e.startVector(4,n,4)}static endFooter(e){return e.endObject()}static finishFooterBuffer(e,n){e.finish(n)}static finishSizePrefixedFooterBuffer(e,n){e.finish(n,void 0,!0)}}class Qr{constructor(e=[],n,l,p=an.V5){this.fields=e||[],this.metadata=n||new Map,l||(l=qg(this.fields)),this.dictionaries=l,this.metadataVersion=p}get[Symbol.toStringTag](){return"Schema"}get names(){return this.fields.map(e=>e.name)}toString(){return`Schema<{ ${this.fields.map((e,n)=>`${n}: ${e}`).join(", ")} }>`}select(e){const n=new Set(e),l=this.fields.filter(p=>n.has(p.name));return new Qr(l,this.metadata)}selectAt(e){const n=e.map(l=>this.fields[l]).filter(Boolean);return new Qr(n,this.metadata)}assign(...e){const n=e[0]instanceof Qr?e[0]:Array.isArray(e[0])?new Qr(e[0]):new Qr(e),l=[...this.fields],p=xf(xf(new Map,this.metadata),n.metadata),v=n.fields.filter(c=>{const E=l.findIndex(T=>T.name===c.name);return~E?(l[E]=c.clone({metadata:xf(xf(new Map,l[E].metadata),c.metadata)}))&&!1:!0}),b=qg(v,new Map);return new Qr([...l,...v],p,new Map([...this.dictionaries,...b]))}}Qr.prototype.fields=null;Qr.prototype.metadata=null;Qr.prototype.dictionaries=null;class Ci{static new(...e){let[n,l,p,v]=e;return e[0]&&typeof e[0]=="object"&&({name:n}=e[0],l===void 0&&(l=e[0].type),p===void 0&&(p=e[0].nullable),v===void 0&&(v=e[0].metadata)),new Ci(`${n}`,l,p,v)}constructor(e,n,l=!1,p){this.name=e,this.type=n,this.nullable=l,this.metadata=p||new Map}get typeId(){return this.type.typeId}get[Symbol.toStringTag](){return"Field"}toString(){return`${this.name}: ${this.type}`}clone(...e){let[n,l,p,v]=e;return!e[0]||typeof e[0]!="object"?[n=this.name,l=this.type,p=this.nullable,v=this.metadata]=e:{name:n=this.name,type:l=this.type,nullable:p=this.nullable,metadata:v=this.metadata}=e[0],Ci.new(n,l,p,v)}}Ci.prototype.type=null;Ci.prototype.name=null;Ci.prototype.nullable=null;Ci.prototype.metadata=null;function xf(i,e){return new Map([...i||new Map,...e||new Map])}function qg(i,e=new Map){for(let n=-1,l=i.length;++n<l;){const v=i[n].type;if(Ot.isDictionary(v)){if(!e.has(v.id))e.set(v.id,v.dictionary);else if(e.get(v.id)!==v.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}v.children&&v.children.length>0&&qg(v.children,e)}return e}var bk=qb,xk=Xc;class jh{static decode(e){e=new xk(Fr(e));const n=Es.getRootAsFooter(e),l=Qr.decode(n.schema(),new Map,n.version());return new wk(l,n)}static encode(e){const n=new bk,l=Qr.encode(n,e.schema);Es.startRecordBatchesVector(n,e.numRecordBatches);for(const b of[...e.recordBatches()].slice().reverse())Ko.encode(n,b);const p=n.endVector();Es.startDictionariesVector(n,e.numDictionaries);for(const b of[...e.dictionaryBatches()].slice().reverse())Ko.encode(n,b);const v=n.endVector();return Es.startFooter(n),Es.addSchema(n,l),Es.addVersion(n,an.V5),Es.addRecordBatches(n,p),Es.addDictionaries(n,v),Es.finishFooterBuffer(n,Es.endFooter(n)),n.asUint8Array()}get numRecordBatches(){return this._recordBatches.length}get numDictionaries(){return this._dictionaryBatches.length}constructor(e,n=an.V5,l,p){this.schema=e,this.version=n,l&&(this._recordBatches=l),p&&(this._dictionaryBatches=p)}*recordBatches(){for(let e,n=-1,l=this.numRecordBatches;++n<l;)(e=this.getRecordBatch(n))&&(yield e)}*dictionaryBatches(){for(let e,n=-1,l=this.numDictionaries;++n<l;)(e=this.getDictionaryBatch(n))&&(yield e)}getRecordBatch(e){return e>=0&&e<this.numRecordBatches&&this._recordBatches[e]||null}getDictionaryBatch(e){return e>=0&&e<this.numDictionaries&&this._dictionaryBatches[e]||null}}class wk extends jh{get numRecordBatches(){return this._footer.recordBatchesLength()}get numDictionaries(){return this._footer.dictionariesLength()}constructor(e,n){super(e,n.version()),this._footer=n}getRecordBatch(e){if(e>=0&&e<this.numRecordBatches){const n=this._footer.recordBatches(e);if(n)return Ko.decode(n)}return null}getDictionaryBatch(e){if(e>=0&&e<this.numDictionaries){const n=this._footer.dictionaries(e);if(n)return Ko.decode(n)}return null}}class Ko{static decode(e){return new Ko(e.metaDataLength(),e.bodyLength(),e.offset())}static encode(e,n){const{metaDataLength:l}=n,p=BigInt(n.offset),v=BigInt(n.bodyLength);return jg.createBlock(e,p,l,v)}constructor(e,n,l){this.metaDataLength=e,this.offset=mi(l),this.bodyLength=mi(n)}}const Vi=Object.freeze({done:!0,value:void 0});class Iv{constructor(e){this._json=e}get schema(){return this._json.schema}get batches(){return this._json.batches||[]}get dictionaries(){return this._json.dictionaries||[]}}class Ey{tee(){return this._getDOMStream().tee()}pipe(e,n){return this._getNodeStream().pipe(e,n)}pipeTo(e,n){return this._getDOMStream().pipeTo(e,n)}pipeThrough(e,n){return this._getDOMStream().pipeThrough(e,n)}_getDOMStream(){return this._DOMStream||(this._DOMStream=this.toDOMStream())}_getNodeStream(){return this._nodeStream||(this._nodeStream=this.toNodeStream())}}class Sk extends Ey{constructor(){super(),this._values=[],this.resolvers=[],this._closedPromise=new Promise(e=>this._closedPromiseResolve=e)}get closed(){return this._closedPromise}cancel(e){return lr(this,void 0,void 0,function*(){yield this.return(e)})}write(e){this._ensureOpen()&&(this.resolvers.length<=0?this._values.push(e):this.resolvers.shift().resolve({done:!1,value:e}))}abort(e){this._closedPromiseResolve&&(this.resolvers.length<=0?this._error={error:e}:this.resolvers.shift().reject({done:!0,value:e}))}close(){if(this._closedPromiseResolve){const{resolvers:e}=this;for(;e.length>0;)e.shift().resolve(Vi);this._closedPromiseResolve(),this._closedPromiseResolve=void 0}}[Symbol.asyncIterator](){return this}toDOMStream(e){return Gs.toDOMStream(this._closedPromiseResolve||this._error?this:this._values,e)}toNodeStream(e){return Gs.toNodeStream(this._closedPromiseResolve||this._error?this:this._values,e)}throw(e){return lr(this,void 0,void 0,function*(){return yield this.abort(e),Vi})}return(e){return lr(this,void 0,void 0,function*(){return yield this.close(),Vi})}read(e){return lr(this,void 0,void 0,function*(){return(yield this.next(e,"read")).value})}peek(e){return lr(this,void 0,void 0,function*(){return(yield this.next(e,"peek")).value})}next(...e){return this._values.length>0?Promise.resolve({done:!1,value:this._values.shift()}):this._error?Promise.reject({done:!0,value:this._error.error}):this._closedPromiseResolve?new Promise((n,l)=>{this.resolvers.push({resolve:n,reject:l})}):Promise.resolve(Vi)}_ensureOpen(){if(this._closedPromiseResolve)return!0;throw new Error("AsyncQueue is closed")}}class Nf extends Sk{write(e){if((e=Fr(e)).byteLength>0)return super.write(e)}toString(e=!1){return e?Bg(this.toUint8Array(!0)):this.toUint8Array(!1).then(Bg)}toUint8Array(e=!1){return e?Na(this._values)[0]:lr(this,void 0,void 0,function*(){var n,l,p,v;const b=[];let c=0;try{for(var E=!0,T=Dl(this),z;z=yield T.next(),n=z.done,!n;E=!0){v=z.value,E=!1;const B=v;b.push(B),c+=B.byteLength}}catch(B){l={error:B}}finally{try{!E&&!n&&(p=T.return)&&(yield p.call(T))}finally{if(l)throw l.error}}return Na(b,c)[0]})}}class xp{constructor(e){e&&(this.source=new Ik(Gs.fromIterable(e)))}[Symbol.iterator](){return this}next(e){return this.source.next(e)}throw(e){return this.source.throw(e)}return(e){return this.source.return(e)}peek(e){return this.source.peek(e)}read(e){return this.source.read(e)}}class eu{constructor(e){e instanceof eu?this.source=e.source:e instanceof Nf?this.source=new Tl(Gs.fromAsyncIterable(e)):Ub(e)?this.source=new Tl(Gs.fromNodeStream(e)):yy(e)?this.source=new Tl(Gs.fromDOMStream(e)):Nb(e)?this.source=new Tl(Gs.fromDOMStream(e.body)):Xh(e)?this.source=new Tl(Gs.fromIterable(e)):Bl(e)?this.source=new Tl(Gs.fromAsyncIterable(e)):ou(e)&&(this.source=new Tl(Gs.fromAsyncIterable(e)))}[Symbol.asyncIterator](){return this}next(e){return this.source.next(e)}throw(e){return this.source.throw(e)}return(e){return this.source.return(e)}get closed(){return this.source.closed}cancel(e){return this.source.cancel(e)}peek(e){return this.source.peek(e)}read(e){return this.source.read(e)}}class Ik{constructor(e){this.source=e}cancel(e){this.return(e)}peek(e){return this.next(e,"peek").value}read(e){return this.next(e,"read").value}next(e,n="read"){return this.source.next({cmd:n,size:e})}throw(e){return Object.create(this.source.throw&&this.source.throw(e)||Vi)}return(e){return Object.create(this.source.return&&this.source.return(e)||Vi)}}class Tl{constructor(e){this.source=e,this._closedPromise=new Promise(n=>this._closedPromiseResolve=n)}cancel(e){return lr(this,void 0,void 0,function*(){yield this.return(e)})}get closed(){return this._closedPromise}read(e){return lr(this,void 0,void 0,function*(){return(yield this.next(e,"read")).value})}peek(e){return lr(this,void 0,void 0,function*(){return(yield this.next(e,"peek")).value})}next(e){return lr(this,arguments,void 0,function*(n,l="read"){return yield this.source.next({cmd:l,size:n})})}throw(e){return lr(this,void 0,void 0,function*(){const n=this.source.throw&&(yield this.source.throw(e))||Vi;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(n)})}return(e){return lr(this,void 0,void 0,function*(){const n=this.source.return&&(yield this.source.return(e))||Vi;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(n)})}}class Tv extends xp{constructor(e,n){super(),this.position=0,this.buffer=Fr(e),this.size=n===void 0?this.buffer.byteLength:n}readInt32(e){const{buffer:n,byteOffset:l}=this.readAt(e,4);return new DataView(n,l).getInt32(0,!0)}seek(e){return this.position=Math.min(e,this.size),e<this.size}read(e){const{buffer:n,size:l,position:p}=this;return n&&p<l?(typeof e!="number"&&(e=Number.POSITIVE_INFINITY),this.position=Math.min(l,p+Math.min(l-p,e)),n.subarray(p,this.position)):null}readAt(e,n){const l=this.buffer,p=Math.min(this.size,e+n);return l?l.subarray(e,p):new Uint8Array(n)}close(){this.buffer&&(this.buffer=null)}throw(e){return this.close(),{done:!0,value:e}}return(e){return this.close(),{done:!0,value:e}}}class wp extends eu{constructor(e,n){super(),this.position=0,this._handle=e,typeof n=="number"?this.size=n:this._pending=lr(this,void 0,void 0,function*(){this.size=(yield e.stat()).size,delete this._pending})}readInt32(e){return lr(this,void 0,void 0,function*(){const{buffer:n,byteOffset:l}=yield this.readAt(e,4);return new DataView(n,l).getInt32(0,!0)})}seek(e){return lr(this,void 0,void 0,function*(){return this._pending&&(yield this._pending),this.position=Math.min(e,this.size),e<this.size})}read(e){return lr(this,void 0,void 0,function*(){this._pending&&(yield this._pending);const{_handle:n,size:l,position:p}=this;if(n&&p<l){typeof e!="number"&&(e=Number.POSITIVE_INFINITY);let v=p,b=0,c=0;const E=Math.min(l,v+Math.min(l-v,e)),T=new Uint8Array(Math.max(0,(this.position=E)-v));for(;(v+=c)<E&&(b+=c)<T.byteLength;)({bytesRead:c}=yield n.read(T,b,T.byteLength-b,v));return T}return null})}readAt(e,n){return lr(this,void 0,void 0,function*(){this._pending&&(yield this._pending);const{_handle:l,size:p}=this;if(l&&e+n<p){const v=Math.min(p,e+n),b=new Uint8Array(v-e);return(yield l.read(b,0,n,e)).buffer}return new Uint8Array(n)})}close(){return lr(this,void 0,void 0,function*(){const e=this._handle;this._handle=null,e&&(yield e.close())})}throw(e){return lr(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:e}})}return(e){return lr(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:e}})}}const Tk=65536;function Uc(i){return i<0&&(i=4294967295+i+1),`0x${i.toString(16)}`}const tu=8,Cy=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8];class x1{constructor(e){this.buffer=e}high(){return this.buffer[1]}low(){return this.buffer[0]}_times(e){const n=new Uint32Array([this.buffer[1]>>>16,this.buffer[1]&65535,this.buffer[0]>>>16,this.buffer[0]&65535]),l=new Uint32Array([e.buffer[1]>>>16,e.buffer[1]&65535,e.buffer[0]>>>16,e.buffer[0]&65535]);let p=n[3]*l[3];this.buffer[0]=p&65535;let v=p>>>16;return p=n[2]*l[3],v+=p,p=n[3]*l[2]>>>0,v+=p,this.buffer[0]+=v<<16,this.buffer[1]=v>>>0<p?Tk:0,this.buffer[1]+=v>>>16,this.buffer[1]+=n[1]*l[3]+n[2]*l[2]+n[3]*l[1],this.buffer[1]+=n[0]*l[3]+n[1]*l[2]+n[2]*l[1]+n[3]*l[0]<<16,this}_plus(e){const n=this.buffer[0]+e.buffer[0]>>>0;this.buffer[1]+=e.buffer[1],n<this.buffer[0]>>>0&&++this.buffer[1],this.buffer[0]=n}lessThan(e){return this.buffer[1]<e.buffer[1]||this.buffer[1]===e.buffer[1]&&this.buffer[0]<e.buffer[0]}equals(e){return this.buffer[1]===e.buffer[1]&&this.buffer[0]==e.buffer[0]}greaterThan(e){return e.lessThan(this)}hex(){return`${Uc(this.buffer[1])} ${Uc(this.buffer[0])}`}}class ni extends x1{times(e){return this._times(e),this}plus(e){return this._plus(e),this}static from(e,n=new Uint32Array(2)){return ni.fromString(typeof e=="string"?e:e.toString(),n)}static fromNumber(e,n=new Uint32Array(2)){return ni.fromString(e.toString(),n)}static fromString(e,n=new Uint32Array(2)){const l=e.length,p=new ni(n);for(let v=0;v<l;){const b=tu<l-v?tu:l-v,c=new ni(new Uint32Array([Number.parseInt(e.slice(v,v+b),10),0])),E=new ni(new Uint32Array([Cy[b],0]));p.times(E),p.plus(c),v+=b}return p}static convertArray(e){const n=new Uint32Array(e.length*2);for(let l=-1,p=e.length;++l<p;)ni.from(e[l],new Uint32Array(n.buffer,n.byteOffset+2*l*4,2));return n}static multiply(e,n){return new ni(new Uint32Array(e.buffer)).times(n)}static add(e,n){return new ni(new Uint32Array(e.buffer)).plus(n)}}class ys extends x1{negate(){return this.buffer[0]=~this.buffer[0]+1,this.buffer[1]=~this.buffer[1],this.buffer[0]==0&&++this.buffer[1],this}times(e){return this._times(e),this}plus(e){return this._plus(e),this}lessThan(e){const n=this.buffer[1]<<0,l=e.buffer[1]<<0;return n<l||n===l&&this.buffer[0]<e.buffer[0]}static from(e,n=new Uint32Array(2)){return ys.fromString(typeof e=="string"?e:e.toString(),n)}static fromNumber(e,n=new Uint32Array(2)){return ys.fromString(e.toString(),n)}static fromString(e,n=new Uint32Array(2)){const l=e.startsWith("-"),p=e.length,v=new ys(n);for(let b=l?1:0;b<p;){const c=tu<p-b?tu:p-b,E=new ys(new Uint32Array([Number.parseInt(e.slice(b,b+c),10),0])),T=new ys(new Uint32Array([Cy[c],0]));v.times(T),v.plus(E),b+=c}return l?v.negate():v}static convertArray(e){const n=new Uint32Array(e.length*2);for(let l=-1,p=e.length;++l<p;)ys.from(e[l],new Uint32Array(n.buffer,n.byteOffset+2*l*4,2));return n}static multiply(e,n){return new ys(new Uint32Array(e.buffer)).times(n)}static add(e,n){return new ys(new Uint32Array(e.buffer)).plus(n)}}class Ma{constructor(e){this.buffer=e}high(){return new ys(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2))}low(){return new ys(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset,2))}negate(){return this.buffer[0]=~this.buffer[0]+1,this.buffer[1]=~this.buffer[1],this.buffer[2]=~this.buffer[2],this.buffer[3]=~this.buffer[3],this.buffer[0]==0&&++this.buffer[1],this.buffer[1]==0&&++this.buffer[2],this.buffer[2]==0&&++this.buffer[3],this}times(e){const n=new ni(new Uint32Array([this.buffer[3],0])),l=new ni(new Uint32Array([this.buffer[2],0])),p=new ni(new Uint32Array([this.buffer[1],0])),v=new ni(new Uint32Array([this.buffer[0],0])),b=new ni(new Uint32Array([e.buffer[3],0])),c=new ni(new Uint32Array([e.buffer[2],0])),E=new ni(new Uint32Array([e.buffer[1],0])),T=new ni(new Uint32Array([e.buffer[0],0]));let z=ni.multiply(v,T);this.buffer[0]=z.low();const B=new ni(new Uint32Array([z.high(),0]));return z=ni.multiply(p,T),B.plus(z),z=ni.multiply(v,E),B.plus(z),this.buffer[1]=B.low(),this.buffer[3]=B.lessThan(z)?1:0,this.buffer[2]=B.high(),new ni(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2)).plus(ni.multiply(l,T)).plus(ni.multiply(p,E)).plus(ni.multiply(v,c)),this.buffer[3]+=ni.multiply(n,T).plus(ni.multiply(l,E)).plus(ni.multiply(p,c)).plus(ni.multiply(v,b)).low(),this}plus(e){const n=new Uint32Array(4);return n[3]=this.buffer[3]+e.buffer[3]>>>0,n[2]=this.buffer[2]+e.buffer[2]>>>0,n[1]=this.buffer[1]+e.buffer[1]>>>0,n[0]=this.buffer[0]+e.buffer[0]>>>0,n[0]<this.buffer[0]>>>0&&++n[1],n[1]<this.buffer[1]>>>0&&++n[2],n[2]<this.buffer[2]>>>0&&++n[3],this.buffer[3]=n[3],this.buffer[2]=n[2],this.buffer[1]=n[1],this.buffer[0]=n[0],this}hex(){return`${Uc(this.buffer[3])} ${Uc(this.buffer[2])} ${Uc(this.buffer[1])} ${Uc(this.buffer[0])}`}static multiply(e,n){return new Ma(new Uint32Array(e.buffer)).times(n)}static add(e,n){return new Ma(new Uint32Array(e.buffer)).plus(n)}static from(e,n=new Uint32Array(4)){return Ma.fromString(typeof e=="string"?e:e.toString(),n)}static fromNumber(e,n=new Uint32Array(4)){return Ma.fromString(e.toString(),n)}static fromString(e,n=new Uint32Array(4)){const l=e.startsWith("-"),p=e.length,v=new Ma(n);for(let b=l?1:0;b<p;){const c=tu<p-b?tu:p-b,E=new Ma(new Uint32Array([Number.parseInt(e.slice(b,b+c),10),0,0,0])),T=new Ma(new Uint32Array([Cy[c],0,0,0]));v.times(T),v.plus(E),b+=c}return l?v.negate():v}static convertArray(e){const n=new Uint32Array(e.length*4);for(let l=-1,p=e.length;++l<p;)Ma.from(e[l],new Uint32Array(n.buffer,n.byteOffset+4*4*l,4));return n}}class w1 extends Er{constructor(e,n,l,p,v=an.V5){super(),this.nodesIndex=-1,this.buffersIndex=-1,this.bytes=e,this.nodes=n,this.buffers=l,this.dictionaries=p,this.metadataVersion=v}visit(e){return super.visit(e instanceof Ci?e.type:e)}visitNull(e,{length:n}=this.nextFieldNode()){return Mr({type:e,length:n})}visitBool(e,{length:n,nullCount:l}=this.nextFieldNode()){return Mr({type:e,length:n,nullCount:l,nullBitmap:this.readNullBitmap(e,l),data:this.readData(e)})}visitInt(e,{length:n,nullCount:l}=this.nextFieldNode()){return Mr({type:e,length:n,nullCount:l,nullBitmap:this.readNullBitmap(e,l),data:this.readData(e)})}visitFloat(e,{length:n,nullCount:l}=this.nextFieldNode()){return Mr({type:e,length:n,nullCount:l,nullBitmap:this.readNullBitmap(e,l),data:this.readData(e)})}visitUtf8(e,{length:n,nullCount:l}=this.nextFieldNode()){return Mr({type:e,length:n,nullCount:l,nullBitmap:this.readNullBitmap(e,l),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitLargeUtf8(e,{length:n,nullCount:l}=this.nextFieldNode()){return Mr({type:e,length:n,nullCount:l,nullBitmap:this.readNullBitmap(e,l),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitBinary(e,{length:n,nullCount:l}=this.nextFieldNode()){return Mr({type:e,length:n,nullCount:l,nullBitmap:this.readNullBitmap(e,l),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitLargeBinary(e,{length:n,nullCount:l}=this.nextFieldNode()){return Mr({type:e,length:n,nullCount:l,nullBitmap:this.readNullBitmap(e,l),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitFixedSizeBinary(e,{length:n,nullCount:l}=this.nextFieldNode()){return Mr({type:e,length:n,nullCount:l,nullBitmap:this.readNullBitmap(e,l),data:this.readData(e)})}visitDate(e,{length:n,nullCount:l}=this.nextFieldNode()){return Mr({type:e,length:n,nullCount:l,nullBitmap:this.readNullBitmap(e,l),data:this.readData(e)})}visitTimestamp(e,{length:n,nullCount:l}=this.nextFieldNode()){return Mr({type:e,length:n,nullCount:l,nullBitmap:this.readNullBitmap(e,l),data:this.readData(e)})}visitTime(e,{length:n,nullCount:l}=this.nextFieldNode()){return Mr({type:e,length:n,nullCount:l,nullBitmap:this.readNullBitmap(e,l),data:this.readData(e)})}visitDecimal(e,{length:n,nullCount:l}=this.nextFieldNode()){return Mr({type:e,length:n,nullCount:l,nullBitmap:this.readNullBitmap(e,l),data:this.readData(e)})}visitList(e,{length:n,nullCount:l}=this.nextFieldNode()){return Mr({type:e,length:n,nullCount:l,nullBitmap:this.readNullBitmap(e,l),valueOffsets:this.readOffsets(e),child:this.visit(e.children[0])})}visitStruct(e,{length:n,nullCount:l}=this.nextFieldNode()){return Mr({type:e,length:n,nullCount:l,nullBitmap:this.readNullBitmap(e,l),children:this.visitMany(e.children)})}visitUnion(e,{length:n,nullCount:l}=this.nextFieldNode()){return this.metadataVersion<an.V5&&this.readNullBitmap(e,l),e.mode===Gn.Sparse?this.visitSparseUnion(e,{length:n,nullCount:l}):this.visitDenseUnion(e,{length:n,nullCount:l})}visitDenseUnion(e,{length:n,nullCount:l}=this.nextFieldNode()){return Mr({type:e,length:n,nullCount:l,typeIds:this.readTypeIds(e),valueOffsets:this.readOffsets(e),children:this.visitMany(e.children)})}visitSparseUnion(e,{length:n,nullCount:l}=this.nextFieldNode()){return Mr({type:e,length:n,nullCount:l,typeIds:this.readTypeIds(e),children:this.visitMany(e.children)})}visitDictionary(e,{length:n,nullCount:l}=this.nextFieldNode()){return Mr({type:e,length:n,nullCount:l,nullBitmap:this.readNullBitmap(e,l),data:this.readData(e.indices),dictionary:this.readDictionary(e)})}visitInterval(e,{length:n,nullCount:l}=this.nextFieldNode()){return Mr({type:e,length:n,nullCount:l,nullBitmap:this.readNullBitmap(e,l),data:this.readData(e)})}visitDuration(e,{length:n,nullCount:l}=this.nextFieldNode()){return Mr({type:e,length:n,nullCount:l,nullBitmap:this.readNullBitmap(e,l),data:this.readData(e)})}visitFixedSizeList(e,{length:n,nullCount:l}=this.nextFieldNode()){return Mr({type:e,length:n,nullCount:l,nullBitmap:this.readNullBitmap(e,l),child:this.visit(e.children[0])})}visitMap(e,{length:n,nullCount:l}=this.nextFieldNode()){return Mr({type:e,length:n,nullCount:l,nullBitmap:this.readNullBitmap(e,l),valueOffsets:this.readOffsets(e),child:this.visit(e.children[0])})}nextFieldNode(){return this.nodes[++this.nodesIndex]}nextBufferRange(){return this.buffers[++this.buffersIndex]}readNullBitmap(e,n,l=this.nextBufferRange()){return n>0&&this.readData(e,l)||new Uint8Array(0)}readOffsets(e,n){return this.readData(e,n)}readTypeIds(e,n){return this.readData(e,n)}readData(e,{length:n,offset:l}=this.nextBufferRange()){return this.bytes.subarray(l,l+n)}readDictionary(e){return this.dictionaries.get(e.id)}}class kk extends w1{constructor(e,n,l,p,v){super(new Uint8Array(0),n,l,p,v),this.sources=e}readNullBitmap(e,n,{offset:l}=this.nextBufferRange()){return n<=0?new Uint8Array(0):yp(this.sources[l])}readOffsets(e,{offset:n}=this.nextBufferRange()){return si(Uint8Array,si(e.OffsetArrayType,this.sources[n]))}readTypeIds(e,{offset:n}=this.nextBufferRange()){return si(Uint8Array,si(e.ArrayType,this.sources[n]))}readData(e,{offset:n}=this.nextBufferRange()){const{sources:l}=this;return Ot.isTimestamp(e)||(Ot.isInt(e)||Ot.isTime(e))&&e.bitWidth===64||Ot.isDuration(e)||Ot.isDate(e)&&e.unit===Ks.MILLISECOND?si(Uint8Array,ys.convertArray(l[n])):Ot.isDecimal(e)?si(Uint8Array,Ma.convertArray(l[n])):Ot.isBinary(e)||Ot.isLargeBinary(e)||Ot.isFixedSizeBinary(e)?Ak(l[n]):Ot.isBool(e)?yp(l[n]):Ot.isUtf8(e)||Ot.isLargeUtf8(e)?gy(l[n].join("")):si(Uint8Array,si(e.ArrayType,l[n].map(p=>+p)))}}function Ak(i){const e=i.join(""),n=new Uint8Array(e.length/2);for(let l=0;l<e.length;l+=2)n[l>>1]=Number.parseInt(e.slice(l,l+2),16);return n}class Zt extends Er{compareSchemas(e,n){return e===n||n instanceof e.constructor&&this.compareManyFields(e.fields,n.fields)}compareManyFields(e,n){return e===n||Array.isArray(e)&&Array.isArray(n)&&e.length===n.length&&e.every((l,p)=>this.compareFields(l,n[p]))}compareFields(e,n){return e===n||n instanceof e.constructor&&e.name===n.name&&e.nullable===n.nullable&&this.visit(e.type,n.type)}}function as(i,e){return e instanceof i.constructor}function Ul(i,e){return i===e||as(i,e)}function _o(i,e){return i===e||as(i,e)&&i.bitWidth===e.bitWidth&&i.isSigned===e.isSigned}function Wp(i,e){return i===e||as(i,e)&&i.precision===e.precision}function Ek(i,e){return i===e||as(i,e)&&i.byteWidth===e.byteWidth}function My(i,e){return i===e||as(i,e)&&i.unit===e.unit}function Jh(i,e){return i===e||as(i,e)&&i.unit===e.unit&&i.timezone===e.timezone}function Qh(i,e){return i===e||as(i,e)&&i.unit===e.unit&&i.bitWidth===e.bitWidth}function Ck(i,e){return i===e||as(i,e)&&i.children.length===e.children.length&&Xo.compareManyFields(i.children,e.children)}function Mk(i,e){return i===e||as(i,e)&&i.children.length===e.children.length&&Xo.compareManyFields(i.children,e.children)}function Dy(i,e){return i===e||as(i,e)&&i.mode===e.mode&&i.typeIds.every((n,l)=>n===e.typeIds[l])&&Xo.compareManyFields(i.children,e.children)}function Dk(i,e){return i===e||as(i,e)&&i.id===e.id&&i.isOrdered===e.isOrdered&&Xo.visit(i.indices,e.indices)&&Xo.visit(i.dictionary,e.dictionary)}function Py(i,e){return i===e||as(i,e)&&i.unit===e.unit}function ed(i,e){return i===e||as(i,e)&&i.unit===e.unit}function Pk(i,e){return i===e||as(i,e)&&i.listSize===e.listSize&&i.children.length===e.children.length&&Xo.compareManyFields(i.children,e.children)}function Lk(i,e){return i===e||as(i,e)&&i.keysSorted===e.keysSorted&&i.children.length===e.children.length&&Xo.compareManyFields(i.children,e.children)}Zt.prototype.visitNull=Ul;Zt.prototype.visitBool=Ul;Zt.prototype.visitInt=_o;Zt.prototype.visitInt8=_o;Zt.prototype.visitInt16=_o;Zt.prototype.visitInt32=_o;Zt.prototype.visitInt64=_o;Zt.prototype.visitUint8=_o;Zt.prototype.visitUint16=_o;Zt.prototype.visitUint32=_o;Zt.prototype.visitUint64=_o;Zt.prototype.visitFloat=Wp;Zt.prototype.visitFloat16=Wp;Zt.prototype.visitFloat32=Wp;Zt.prototype.visitFloat64=Wp;Zt.prototype.visitUtf8=Ul;Zt.prototype.visitLargeUtf8=Ul;Zt.prototype.visitBinary=Ul;Zt.prototype.visitLargeBinary=Ul;Zt.prototype.visitFixedSizeBinary=Ek;Zt.prototype.visitDate=My;Zt.prototype.visitDateDay=My;Zt.prototype.visitDateMillisecond=My;Zt.prototype.visitTimestamp=Jh;Zt.prototype.visitTimestampSecond=Jh;Zt.prototype.visitTimestampMillisecond=Jh;Zt.prototype.visitTimestampMicrosecond=Jh;Zt.prototype.visitTimestampNanosecond=Jh;Zt.prototype.visitTime=Qh;Zt.prototype.visitTimeSecond=Qh;Zt.prototype.visitTimeMillisecond=Qh;Zt.prototype.visitTimeMicrosecond=Qh;Zt.prototype.visitTimeNanosecond=Qh;Zt.prototype.visitDecimal=Ul;Zt.prototype.visitList=Ck;Zt.prototype.visitStruct=Mk;Zt.prototype.visitUnion=Dy;Zt.prototype.visitDenseUnion=Dy;Zt.prototype.visitSparseUnion=Dy;Zt.prototype.visitDictionary=Dk;Zt.prototype.visitInterval=Py;Zt.prototype.visitIntervalDayTime=Py;Zt.prototype.visitIntervalYearMonth=Py;Zt.prototype.visitDuration=ed;Zt.prototype.visitDurationSecond=ed;Zt.prototype.visitDurationMillisecond=ed;Zt.prototype.visitDurationMicrosecond=ed;Zt.prototype.visitDurationNanosecond=ed;Zt.prototype.visitFixedSizeList=Pk;Zt.prototype.visitMap=Lk;const Xo=new Zt;function Gg(i,e){return Xo.compareSchemas(i,e)}function gg(i,e){return zk(i,e.map(n=>n.data.concat()))}function zk(i,e){const n=[...i.fields],l=[],p={numBatches:e.reduce((B,$)=>Math.max(B,$.length),0)};let v=0,b=0,c=-1;const E=e.length;let T,z=[];for(;p.numBatches-- >0;){for(b=Number.POSITIVE_INFINITY,c=-1;++c<E;)z[c]=T=e[c].shift(),b=Math.min(b,T?T.length:b);Number.isFinite(b)&&(z=Bk(n,b,z,e,p),b>0&&(l[v++]=Mr({type:new rs(n),length:b,nullCount:0,children:z.slice()})))}return[i=i.assign(n),l.map(B=>new vs(i,B))]}function Bk(i,e,n,l,p){var v;const b=(e+63&-64)>>3;for(let c=-1,E=l.length;++c<E;){const T=n[c],z=T==null?void 0:T.length;if(z>=e)z===e?n[c]=T:(n[c]=T.slice(0,e),p.numBatches=Math.max(p.numBatches,l[c].unshift(T.slice(e,z-e))));else{const B=i[c];i[c]=B.clone({nullable:!0}),n[c]=(v=T==null?void 0:T._changeLengthAndBackfillNullBitmap(e))!==null&&v!==void 0?v:Mr({type:B.type,length:e,nullCount:e,nullBitmap:new Uint8Array(b)})}}return n}var S1;let Jo=class Al{constructor(...e){var n,l;if(e.length===0)return this.batches=[],this.schema=new Qr([]),this._offsets=[0],this;let p,v;e[0]instanceof Qr&&(p=e.shift()),e.at(-1)instanceof Uint32Array&&(v=e.pop());const b=E=>{if(E){if(E instanceof vs)return[E];if(E instanceof Al)return E.batches;if(E instanceof ii){if(E.type instanceof rs)return[new vs(new Qr(E.type.children),E)]}else{if(Array.isArray(E))return E.flatMap(T=>b(T));if(typeof E[Symbol.iterator]=="function")return[...E].flatMap(T=>b(T));if(typeof E=="object"){const T=Object.keys(E),z=T.map(q=>new Jr([E[q]])),B=p??new Qr(T.map((q,Q)=>new Ci(String(q),z[Q].type,z[Q].nullable))),[,$]=gg(B,z);return $.length===0?[new vs(E)]:$}}}return[]},c=e.flatMap(E=>b(E));if(p=(l=p??((n=c[0])===null||n===void 0?void 0:n.schema))!==null&&l!==void 0?l:new Qr([]),!(p instanceof Qr))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");for(const E of c){if(!(E instanceof vs))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");if(!Gg(p,E.schema))throw new TypeError("Table and inner RecordBatch schemas must be equivalent.")}this.schema=p,this.batches=c,this._offsets=v??f1(this.data)}get data(){return this.batches.map(({data:e})=>e)}get numCols(){return this.schema.fields.length}get numRows(){return this.data.reduce((e,n)=>e+n.length,0)}get nullCount(){return this._nullCount===-1&&(this._nullCount=d1(this.data)),this._nullCount}isValid(e){return!1}get(e){return null}at(e){return this.get(Sy(e,this.numRows))}set(e,n){}indexOf(e,n){return-1}[Symbol.iterator](){return this.batches.length>0?Ay.visit(new Jr(this.data)):new Array(0)[Symbol.iterator]()}toArray(){return[...this]}toString(){return`[
  ${this.toArray().join(`,
  `)}
]`}concat(...e){const n=this.schema,l=this.data.concat(e.flatMap(({data:p})=>p));return new Al(n,l.map(p=>new vs(n,p)))}slice(e,n){const l=this.schema;[e,n]=u1({length:this.numRows},e,n);const p=p1(this.data,this._offsets,e,n);return new Al(l,p.map(v=>new vs(l,v)))}getChild(e){return this.getChildAt(this.schema.fields.findIndex(n=>n.name===e))}getChildAt(e){if(e>-1&&e<this.schema.fields.length){const n=this.data.map(l=>l.children[e]);if(n.length===0){const{type:l}=this.schema.fields[e],p=Mr({type:l,length:0,nullCount:0});n.push(p._changeLengthAndBackfillNullBitmap(this.numRows))}return new Jr(n)}return null}setChild(e,n){var l;return this.setChildAt((l=this.schema.fields)===null||l===void 0?void 0:l.findIndex(p=>p.name===e),n)}setChildAt(e,n){let l=this.schema,p=[...this.batches];if(e>-1&&e<this.numCols){n||(n=new Jr([Mr({type:new Yo,length:this.numRows})]));const v=l.fields.slice(),b=v[e].clone({type:n.type}),c=this.schema.fields.map((E,T)=>this.getChildAt(T));[v[e],c[e]]=[b,n],[l,p]=gg(l,c)}return new Al(l,p)}select(e){const n=this.schema.fields.reduce((l,p,v)=>l.set(p.name,v),new Map);return this.selectAt(e.map(l=>n.get(l)).filter(l=>l>-1))}selectAt(e){const n=this.schema.selectAt(e),l=this.batches.map(p=>p.selectAt(e));return new Al(n,l)}assign(e){const n=this.schema.fields,[l,p]=e.schema.fields.reduce((c,E,T)=>{const[z,B]=c,$=n.findIndex(q=>q.name===E.name);return~$?B[$]=T:z.push(T),c},[[],[]]),v=this.schema.assign(e.schema),b=[...n.map((c,E)=>[E,p[E]]).map(([c,E])=>E===void 0?this.getChildAt(c):e.getChildAt(E)),...l.map(c=>e.getChildAt(c))].filter(Boolean);return new Al(...gg(v,b))}};S1=Symbol.toStringTag;Jo[S1]=(i=>(i.schema=null,i.batches=[],i._offsets=new Uint32Array([0]),i._nullCount=-1,i[Symbol.isConcatSpreadable]=!0,i.isValid=_p(ky),i.get=_p(Ss.getVisitFn(le.Struct)),i.set=m1(Xs.getVisitFn(le.Struct)),i.indexOf=g1(vp.getVisitFn(le.Struct)),"Table"))(Jo.prototype);var I1;let vs=class Dh{constructor(...e){switch(e.length){case 2:{if([this.schema]=e,!(this.schema instanceof Qr))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");if([,this.data=Mr({nullCount:0,type:new rs(this.schema.fields),children:this.schema.fields.map(n=>Mr({type:n.type,nullCount:0}))})]=e,!(this.data instanceof ii))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");[this.schema,this.data]=kv(this.schema,this.data.children);break}case 1:{const[n]=e,{fields:l,children:p,length:v}=Object.keys(n).reduce((E,T,z)=>(E.children[z]=n[T],E.length=Math.max(E.length,n[T].length),E.fields[z]=Ci.new({name:T,type:n[T].type,nullable:!0}),E),{length:0,fields:new Array,children:new Array}),b=new Qr(l),c=Mr({type:new rs(l),length:v,children:p,nullCount:0});[this.schema,this.data]=kv(b,c.children,v);break}default:throw new TypeError("RecordBatch constructor expects an Object mapping names to child Data, or a [Schema, Data] pair.")}}get dictionaries(){return this._dictionaries||(this._dictionaries=T1(this.schema.fields,this.data.children))}get numCols(){return this.schema.fields.length}get numRows(){return this.data.length}get nullCount(){return this.data.nullCount}isValid(e){return this.data.getValid(e)}get(e){return Ss.visit(this.data,e)}at(e){return this.get(Sy(e,this.numRows))}set(e,n){return Xs.visit(this.data,e,n)}indexOf(e,n){return vp.visit(this.data,e,n)}[Symbol.iterator](){return Ay.visit(new Jr([this.data]))}toArray(){return[...this]}concat(...e){return new Jo(this.schema,[this,...e])}slice(e,n){const[l]=new Jr([this.data]).slice(e,n).data;return new Dh(this.schema,l)}getChild(e){var n;return this.getChildAt((n=this.schema.fields)===null||n===void 0?void 0:n.findIndex(l=>l.name===e))}getChildAt(e){return e>-1&&e<this.schema.fields.length?new Jr([this.data.children[e]]):null}setChild(e,n){var l;return this.setChildAt((l=this.schema.fields)===null||l===void 0?void 0:l.findIndex(p=>p.name===e),n)}setChildAt(e,n){let l=this.schema,p=this.data;if(e>-1&&e<this.numCols){n||(n=new Jr([Mr({type:new Yo,length:this.numRows})]));const v=l.fields.slice(),b=p.children.slice(),c=v[e].clone({type:n.type});[v[e],b[e]]=[c,n.data[0]],l=new Qr(v,new Map(this.schema.metadata)),p=Mr({type:new rs(v),children:b})}return new Dh(l,p)}select(e){const n=this.schema.select(e),l=new rs(n.fields),p=[];for(const v of e){const b=this.schema.fields.findIndex(c=>c.name===v);~b&&(p[b]=this.data.children[b])}return new Dh(n,Mr({type:l,length:this.numRows,children:p}))}selectAt(e){const n=this.schema.selectAt(e),l=e.map(v=>this.data.children[v]).filter(Boolean),p=Mr({type:new rs(n.fields),length:this.numRows,children:l});return new Dh(n,p)}};I1=Symbol.toStringTag;vs[I1]=(i=>(i._nullCount=-1,i[Symbol.isConcatSpreadable]=!0,"RecordBatch"))(vs.prototype);function kv(i,e,n=e.reduce((l,p)=>Math.max(l,p.length),0)){var l;const p=[...i.fields],v=[...e],b=(n+63&-64)>>3;for(const[c,E]of i.fields.entries()){const T=e[c];(!T||T.length!==n)&&(p[c]=E.clone({nullable:!0}),v[c]=(l=T==null?void 0:T._changeLengthAndBackfillNullBitmap(n))!==null&&l!==void 0?l:Mr({type:E.type,length:n,nullCount:n,nullBitmap:new Uint8Array(b)}))}return[i.assign(p),Mr({type:new rs(p),length:n,children:v})]}function T1(i,e,n=new Map){var l,p;if(((l=i==null?void 0:i.length)!==null&&l!==void 0?l:0)>0&&(i==null?void 0:i.length)===(e==null?void 0:e.length))for(let v=-1,b=i.length;++v<b;){const{type:c}=i[v],E=e[v];for(const T of[E,...((p=E==null?void 0:E.dictionary)===null||p===void 0?void 0:p.data)||[]])T1(c.children,T==null?void 0:T.children,n);if(Ot.isDictionary(c)){const{id:T}=c;if(!n.has(T))E!=null&&E.dictionary&&n.set(T,E.dictionary);else if(n.get(T)!==E.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}}return n}class Ly extends vs{constructor(e){const n=e.fields.map(p=>Mr({type:p.type})),l=Mr({type:new rs(e.fields),nullCount:0,children:n});super(e,l)}}let Uo=class Ea{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsMessage(e,n){return(n||new Ea).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsMessage(e,n){return e.setPosition(e.position()+ei),(n||new Ea).__init(e.readInt32(e.position())+e.position(),e)}version(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):an.V1}headerType(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb_pos+e):Gr.NONE}header(e){const n=this.bb.__offset(this.bb_pos,8);return n?this.bb.__union(e,this.bb_pos+n):null}bodyLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}customMetadata(e,n){const l=this.bb.__offset(this.bb_pos,12);return l?(n||new _n).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+l)+e*4),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}static startMessage(e){e.startObject(5)}static addVersion(e,n){e.addFieldInt16(0,n,an.V1)}static addHeaderType(e,n){e.addFieldInt8(1,n,Gr.NONE)}static addHeader(e,n){e.addFieldOffset(2,n,0)}static addBodyLength(e,n){e.addFieldInt64(3,n,BigInt("0"))}static addCustomMetadata(e,n){e.addFieldOffset(4,n,0)}static createCustomMetadataVector(e,n){e.startVector(4,n.length,4);for(let l=n.length-1;l>=0;l--)e.addOffset(n[l]);return e.endVector()}static startCustomMetadataVector(e,n){e.startVector(4,n,4)}static endMessage(e){return e.endObject()}static finishMessageBuffer(e,n){e.finish(n)}static finishSizePrefixedMessageBuffer(e,n){e.finish(n,void 0,!0)}static createMessage(e,n,l,p,v,b){return Ea.startMessage(e),Ea.addVersion(e,n),Ea.addHeaderType(e,l),Ea.addHeader(e,p),Ea.addBodyLength(e,v),Ea.addCustomMetadata(e,b),Ea.endMessage(e)}};class Rk extends Er{visit(e,n){return e==null||n==null?void 0:super.visit(e,n)}visitNull(e,n){return yv.startNull(n),yv.endNull(n)}visitInt(e,n){return Ms.startInt(n),Ms.addBitWidth(n,e.bitWidth),Ms.addIsSigned(n,e.isSigned),Ms.endInt(n)}visitFloat(e,n){return Pa.startFloatingPoint(n),Pa.addPrecision(n,e.precision),Pa.endFloatingPoint(n)}visitBinary(e,n){return dv.startBinary(n),dv.endBinary(n)}visitLargeBinary(e,n){return pv.startLargeBinary(n),pv.endLargeBinary(n)}visitBool(e,n){return fv.startBool(n),fv.endBool(n)}visitUtf8(e,n){return _v.startUtf8(n),_v.endUtf8(n)}visitLargeUtf8(e,n){return mv.startLargeUtf8(n),mv.endLargeUtf8(n)}visitDecimal(e,n){return Dc.startDecimal(n),Dc.addScale(n,e.scale),Dc.addPrecision(n,e.precision),Dc.addBitWidth(n,e.bitWidth),Dc.endDecimal(n)}visitDate(e,n){return Lf.startDate(n),Lf.addUnit(n,e.unit),Lf.endDate(n)}visitTime(e,n){return Zs.startTime(n),Zs.addUnit(n,e.unit),Zs.addBitWidth(n,e.bitWidth),Zs.endTime(n)}visitTimestamp(e,n){const l=e.timezone&&n.createString(e.timezone)||void 0;return Ws.startTimestamp(n),Ws.addUnit(n,e.unit),l!==void 0&&Ws.addTimezone(n,l),Ws.endTimestamp(n)}visitInterval(e,n){return La.startInterval(n),La.addUnit(n,e.unit),La.endInterval(n)}visitDuration(e,n){return zf.startDuration(n),zf.addUnit(n,e.unit),zf.endDuration(n)}visitList(e,n){return gv.startList(n),gv.endList(n)}visitStruct(e,n){return Cl.startStruct_(n),Cl.endStruct_(n)}visitUnion(e,n){_s.startTypeIdsVector(n,e.typeIds.length);const l=_s.createTypeIdsVector(n,e.typeIds);return _s.startUnion(n),_s.addMode(n,e.mode),_s.addTypeIds(n,l),_s.endUnion(n)}visitDictionary(e,n){const l=this.visit(e.indices,n);return mo.startDictionaryEncoding(n),mo.addId(n,BigInt(e.id)),mo.addIsOrdered(n,e.isOrdered),l!==void 0&&mo.addIndexType(n,l),mo.endDictionaryEncoding(n)}visitFixedSizeBinary(e,n){return Bf.startFixedSizeBinary(n),Bf.addByteWidth(n,e.byteWidth),Bf.endFixedSizeBinary(n)}visitFixedSizeList(e,n){return Rf.startFixedSizeList(n),Rf.addListSize(n,e.listSize),Rf.endFixedSizeList(n)}visitMap(e,n){return Ff.startMap(n),Ff.addKeysSorted(n,e.keysSorted),Ff.endMap(n)}}const yg=new Rk;function Fk(i,e=new Map){return new Qr(Nk(i,e),Uf(i.metadata),e)}function k1(i){return new zs(i.count,A1(i.columns),E1(i.columns))}function Ok(i){return new $a(k1(i.data),i.id,i.isDelta)}function Nk(i,e){return(i.fields||[]).filter(Boolean).map(n=>Ci.fromJSON(n,e))}function Av(i,e){return(i.children||[]).filter(Boolean).map(n=>Ci.fromJSON(n,e))}function A1(i){return(i||[]).reduce((e,n)=>[...e,new Qo(n.count,Uk(n.VALIDITY)),...A1(n.children)],[])}function E1(i,e=[]){for(let n=-1,l=(i||[]).length;++n<l;){const p=i[n];p.VALIDITY&&e.push(new Ba(e.length,p.VALIDITY.length)),p.TYPE_ID&&e.push(new Ba(e.length,p.TYPE_ID.length)),p.OFFSET&&e.push(new Ba(e.length,p.OFFSET.length)),p.DATA&&e.push(new Ba(e.length,p.DATA.length)),e=E1(p.children,e)}return e}function Uk(i){return(i||[]).reduce((e,n)=>e+ +(n===0),0)}function $k(i,e){let n,l,p,v,b,c;return!e||!(v=i.dictionary)?(b=Cv(i,Av(i,e)),p=new Ci(i.name,b,i.nullable,Uf(i.metadata))):e.has(n=v.id)?(l=(l=v.indexType)?Ev(l):new Vh,c=new Qc(e.get(n),l,n,v.isOrdered),p=new Ci(i.name,c,i.nullable,Uf(i.metadata))):(l=(l=v.indexType)?Ev(l):new Vh,e.set(n,b=Cv(i,Av(i,e))),c=new Qc(b,l,n,v.isOrdered),p=new Ci(i.name,c,i.nullable,Uf(i.metadata))),p||null}function Uf(i=[]){return new Map(i.map(({key:e,value:n})=>[e,n]))}function Ev(i){return new Rl(i.isSigned,i.bitWidth)}function Cv(i,e){const n=i.type.name;switch(n){case"NONE":return new Yo;case"null":return new Yo;case"binary":return new ep;case"largebinary":return new tp;case"utf8":return new rp;case"largeutf8":return new ip;case"bool":return new np;case"list":return new hp((e||[])[0]);case"struct":return new rs(e||[]);case"struct_":return new rs(e||[])}switch(n){case"int":{const l=i.type;return new Rl(l.isSigned,l.bitWidth)}case"floatingpoint":{const l=i.type;return new Qf(qn[l.precision])}case"decimal":{const l=i.type;return new sp(l.scale,l.precision,l.bitWidth)}case"date":{const l=i.type;return new ap(Ks[l.unit])}case"time":{const l=i.type;return new op(Wt[l.unit],l.bitWidth)}case"timestamp":{const l=i.type;return new lp(Wt[l.unit],l.timezone)}case"interval":{const l=i.type;return new cp(Ua[l.unit])}case"duration":{const l=i.type;return new up(Wt[l.unit])}case"union":{const l=i.type,[p,...v]=(l.mode+"").toLowerCase(),b=p.toUpperCase()+v.join("");return new dp(Gn[b],l.typeIds||[],e||[])}case"fixedsizebinary":{const l=i.type;return new fp(l.byteWidth)}case"fixedsizelist":{const l=i.type;return new pp(l.listSize,(e||[])[0])}case"map":{const l=i.type;return new mp((e||[])[0],l.keysSorted)}}throw new Error(`Unrecognized type: "${n}"`)}var Vk=qb,jk=Xc;class is{static fromJSON(e,n){const l=new is(0,an.V5,n);return l._createHeader=qk(e,n),l}static decode(e){e=new jk(Fr(e));const n=Uo.getRootAsMessage(e),l=n.bodyLength(),p=n.version(),v=n.headerType(),b=new is(l,p,v);return b._createHeader=Gk(n,v),b}static encode(e){const n=new Vk;let l=-1;return e.isSchema()?l=Qr.encode(n,e.header()):e.isRecordBatch()?l=zs.encode(n,e.header()):e.isDictionaryBatch()&&(l=$a.encode(n,e.header())),Uo.startMessage(n),Uo.addVersion(n,an.V5),Uo.addHeader(n,l),Uo.addHeaderType(n,e.headerType),Uo.addBodyLength(n,BigInt(e.bodyLength)),Uo.finishMessageBuffer(n,Uo.endMessage(n)),n.asUint8Array()}static from(e,n=0){if(e instanceof Qr)return new is(0,an.V5,Gr.Schema,e);if(e instanceof zs)return new is(n,an.V5,Gr.RecordBatch,e);if(e instanceof $a)return new is(n,an.V5,Gr.DictionaryBatch,e);throw new Error(`Unrecognized Message header: ${e}`)}get type(){return this.headerType}get version(){return this._version}get headerType(){return this._headerType}get bodyLength(){return this._bodyLength}header(){return this._createHeader()}isSchema(){return this.headerType===Gr.Schema}isRecordBatch(){return this.headerType===Gr.RecordBatch}isDictionaryBatch(){return this.headerType===Gr.DictionaryBatch}constructor(e,n,l,p){this._version=n,this._headerType=l,this.body=new Uint8Array(0),p&&(this._createHeader=()=>p),this._bodyLength=mi(e)}}class zs{get nodes(){return this._nodes}get length(){return this._length}get buffers(){return this._buffers}constructor(e,n,l){this._nodes=n,this._buffers=l,this._length=mi(e)}}class $a{get id(){return this._id}get data(){return this._data}get isDelta(){return this._isDelta}get length(){return this.data.length}get nodes(){return this.data.nodes}get buffers(){return this.data.buffers}constructor(e,n,l=!1){this._data=e,this._isDelta=l,this._id=mi(n)}}class Ba{constructor(e,n){this.offset=mi(e),this.length=mi(n)}}class Qo{constructor(e,n){this.length=mi(e),this.nullCount=mi(n)}}function qk(i,e){return()=>{switch(e){case Gr.Schema:return Qr.fromJSON(i);case Gr.RecordBatch:return zs.fromJSON(i);case Gr.DictionaryBatch:return $a.fromJSON(i)}throw new Error(`Unrecognized Message type: { name: ${Gr[e]}, type: ${e} }`)}}function Gk(i,e){return()=>{switch(e){case Gr.Schema:return Qr.decode(i.header(new Ca),new Map,i.version());case Gr.RecordBatch:return zs.decode(i.header(new co),i.version());case Gr.DictionaryBatch:return $a.decode(i.header(new Cc),i.version())}throw new Error(`Unrecognized Message type: { name: ${Gr[e]}, type: ${e} }`)}}Ci.encode=rA;Ci.decode=eA;Ci.fromJSON=$k;Qr.encode=tA;Qr.decode=Zk;Qr.fromJSON=Fk;zs.encode=iA;zs.decode=Wk;zs.fromJSON=k1;$a.encode=nA;$a.decode=Hk;$a.fromJSON=Ok;Qo.encode=sA;Qo.decode=Kk;Ba.encode=aA;Ba.decode=Yk;function Zk(i,e=new Map,n=an.V5){const l=Qk(i,e);return new Qr(l,$f(i),e,n)}function Wk(i,e=an.V5){if(i.compression()!==null)throw new Error("Record batch compression not implemented");return new zs(i.length(),Xk(i),Jk(i,e))}function Hk(i,e=an.V5){return new $a(zs.decode(i.data(),e),i.id(),i.isDelta())}function Yk(i){return new Ba(i.offset(),i.length())}function Kk(i){return new Qo(i.length(),i.nullCount())}function Xk(i){const e=[];for(let n,l=-1,p=-1,v=i.nodesLength();++l<v;)(n=i.nodes(l))&&(e[++p]=Qo.decode(n));return e}function Jk(i,e){const n=[];for(let l,p=-1,v=-1,b=i.buffersLength();++p<b;)(l=i.buffers(p))&&(e<an.V4&&(l.bb_pos+=8*(p+1)),n[++v]=Ba.decode(l));return n}function Qk(i,e){const n=[];for(let l,p=-1,v=-1,b=i.fieldsLength();++p<b;)(l=i.fields(p))&&(n[++v]=Ci.decode(l,e));return n}function Mv(i,e){const n=[];for(let l,p=-1,v=-1,b=i.childrenLength();++p<b;)(l=i.children(p))&&(n[++v]=Ci.decode(l,e));return n}function eA(i,e){let n,l,p,v,b,c;return!e||!(c=i.dictionary())?(p=Pv(i,Mv(i,e)),l=new Ci(i.name(),p,i.nullable(),$f(i))):e.has(n=mi(c.id()))?(v=(v=c.indexType())?Dv(v):new Vh,b=new Qc(e.get(n),v,n,c.isOrdered()),l=new Ci(i.name(),b,i.nullable(),$f(i))):(v=(v=c.indexType())?Dv(v):new Vh,e.set(n,p=Pv(i,Mv(i,e))),b=new Qc(p,v,n,c.isOrdered()),l=new Ci(i.name(),b,i.nullable(),$f(i))),l||null}function $f(i){const e=new Map;if(i)for(let n,l,p=-1,v=Math.trunc(i.customMetadataLength());++p<v;)(n=i.customMetadata(p))&&(l=n.key())!=null&&e.set(l,n.value());return e}function Dv(i){return new Rl(i.isSigned(),i.bitWidth())}function Pv(i,e){const n=i.typeType();switch(n){case wi.NONE:return new Yo;case wi.Null:return new Yo;case wi.Binary:return new ep;case wi.LargeBinary:return new tp;case wi.Utf8:return new rp;case wi.LargeUtf8:return new ip;case wi.Bool:return new np;case wi.List:return new hp((e||[])[0]);case wi.Struct_:return new rs(e||[])}switch(n){case wi.Int:{const l=i.type(new Ms);return new Rl(l.isSigned(),l.bitWidth())}case wi.FloatingPoint:{const l=i.type(new Pa);return new Qf(l.precision())}case wi.Decimal:{const l=i.type(new Dc);return new sp(l.scale(),l.precision(),l.bitWidth())}case wi.Date:{const l=i.type(new Lf);return new ap(l.unit())}case wi.Time:{const l=i.type(new Zs);return new op(l.unit(),l.bitWidth())}case wi.Timestamp:{const l=i.type(new Ws);return new lp(l.unit(),l.timezone())}case wi.Interval:{const l=i.type(new La);return new cp(l.unit())}case wi.Duration:{const l=i.type(new zf);return new up(l.unit())}case wi.Union:{const l=i.type(new _s);return new dp(l.mode(),l.typeIdsArray()||[],e||[])}case wi.FixedSizeBinary:{const l=i.type(new Bf);return new fp(l.byteWidth())}case wi.FixedSizeList:{const l=i.type(new Rf);return new pp(l.listSize(),(e||[])[0])}case wi.Map:{const l=i.type(new Ff);return new mp((e||[])[0],l.keysSorted())}}throw new Error(`Unrecognized type: "${wi[n]}" (${n})`)}function tA(i,e){const n=e.fields.map(v=>Ci.encode(i,v));Ca.startFieldsVector(i,n.length);const l=Ca.createFieldsVector(i,n),p=e.metadata&&e.metadata.size>0?Ca.createCustomMetadataVector(i,[...e.metadata].map(([v,b])=>{const c=i.createString(`${v}`),E=i.createString(`${b}`);return _n.startKeyValue(i),_n.addKey(i,c),_n.addValue(i,E),_n.endKeyValue(i)})):-1;return Ca.startSchema(i),Ca.addFields(i,l),Ca.addEndianness(i,oA?Jc.Little:Jc.Big),p!==-1&&Ca.addCustomMetadata(i,p),Ca.endSchema(i)}function rA(i,e){let n=-1,l=-1,p=-1;const v=e.type;let b=e.typeId;Ot.isDictionary(v)?(b=v.dictionary.typeId,p=yg.visit(v,i),l=yg.visit(v.dictionary,i)):l=yg.visit(v,i);const c=(v.children||[]).map(z=>Ci.encode(i,z)),E=qs.createChildrenVector(i,c),T=e.metadata&&e.metadata.size>0?qs.createCustomMetadataVector(i,[...e.metadata].map(([z,B])=>{const $=i.createString(`${z}`),q=i.createString(`${B}`);return _n.startKeyValue(i),_n.addKey(i,$),_n.addValue(i,q),_n.endKeyValue(i)})):-1;return e.name&&(n=i.createString(e.name)),qs.startField(i),qs.addType(i,l),qs.addTypeType(i,b),qs.addChildren(i,E),qs.addNullable(i,!!e.nullable),n!==-1&&qs.addName(i,n),p!==-1&&qs.addDictionary(i,p),T!==-1&&qs.addCustomMetadata(i,T),qs.endField(i)}function iA(i,e){const n=e.nodes||[],l=e.buffers||[];co.startNodesVector(i,n.length);for(const b of n.slice().reverse())Qo.encode(i,b);const p=i.endVector();co.startBuffersVector(i,l.length);for(const b of l.slice().reverse())Ba.encode(i,b);const v=i.endVector();return co.startRecordBatch(i),co.addLength(i,BigInt(e.length)),co.addNodes(i,p),co.addBuffers(i,v),co.endRecordBatch(i)}function nA(i,e){const n=zs.encode(i,e.data);return Cc.startDictionaryBatch(i),Cc.addId(i,BigInt(e.id)),Cc.addIsDelta(i,e.isDelta),Cc.addData(i,n),Cc.endDictionaryBatch(i)}function sA(i,e){return Wb.createFieldNode(i,BigInt(e.length),BigInt(e.nullCount))}function aA(i,e){return Zb.createBuffer(i,BigInt(e.offset),BigInt(e.length))}const oA=(()=>{const i=new ArrayBuffer(2);return new DataView(i).setInt16(0,256,!0),new Int16Array(i)[0]===256})(),zy=i=>`Expected ${Gr[i]} Message in stream, but was null or length 0.`,By=i=>`Header pointer of flatbuffer-encoded ${Gr[i]} Message is null or length 0.`,C1=(i,e)=>`Expected to read ${i} metadata bytes, but only read ${e}.`,M1=(i,e)=>`Expected to read ${i} bytes for message body, but only read ${e}.`;class D1{constructor(e){this.source=e instanceof xp?e:new xp(e)}[Symbol.iterator](){return this}next(){let e;return(e=this.readMetadataLength()).done||e.value===-1&&(e=this.readMetadataLength()).done||(e=this.readMetadata(e.value)).done?Vi:e}throw(e){return this.source.throw(e)}return(e){return this.source.return(e)}readMessage(e){let n;if((n=this.next()).done)return null;if(e!=null&&n.value.headerType!==e)throw new Error(zy(e));return n.value}readMessageBody(e){if(e<=0)return new Uint8Array(0);const n=Fr(this.source.read(e));if(n.byteLength<e)throw new Error(M1(e,n.byteLength));return n.byteOffset%8===0&&n.byteOffset+n.byteLength<=n.buffer.byteLength?n:n.slice()}readSchema(e=!1){const n=Gr.Schema,l=this.readMessage(n),p=l==null?void 0:l.header();if(e&&!p)throw new Error(By(n));return p}readMetadataLength(){const e=this.source.read(Hp),n=e&&new Xc(e),l=(n==null?void 0:n.readInt32(0))||0;return{done:l===0,value:l}}readMetadata(e){const n=this.source.read(e);if(!n)return Vi;if(n.byteLength<e)throw new Error(C1(e,n.byteLength));return{done:!1,value:is.decode(n)}}}class lA{constructor(e,n){this.source=e instanceof eu?e:Ob(e)?new wp(e,n):new eu(e)}[Symbol.asyncIterator](){return this}next(){return lr(this,void 0,void 0,function*(){let e;return(e=yield this.readMetadataLength()).done||e.value===-1&&(e=yield this.readMetadataLength()).done||(e=yield this.readMetadata(e.value)).done?Vi:e})}throw(e){return lr(this,void 0,void 0,function*(){return yield this.source.throw(e)})}return(e){return lr(this,void 0,void 0,function*(){return yield this.source.return(e)})}readMessage(e){return lr(this,void 0,void 0,function*(){let n;if((n=yield this.next()).done)return null;if(e!=null&&n.value.headerType!==e)throw new Error(zy(e));return n.value})}readMessageBody(e){return lr(this,void 0,void 0,function*(){if(e<=0)return new Uint8Array(0);const n=Fr(yield this.source.read(e));if(n.byteLength<e)throw new Error(M1(e,n.byteLength));return n.byteOffset%8===0&&n.byteOffset+n.byteLength<=n.buffer.byteLength?n:n.slice()})}readSchema(){return lr(this,arguments,void 0,function*(e=!1){const n=Gr.Schema,l=yield this.readMessage(n),p=l==null?void 0:l.header();if(e&&!p)throw new Error(By(n));return p})}readMetadataLength(){return lr(this,void 0,void 0,function*(){const e=yield this.source.read(Hp),n=e&&new Xc(e),l=(n==null?void 0:n.readInt32(0))||0;return{done:l===0,value:l}})}readMetadata(e){return lr(this,void 0,void 0,function*(){const n=yield this.source.read(e);if(!n)return Vi;if(n.byteLength<e)throw new Error(C1(e,n.byteLength));return{done:!1,value:is.decode(n)}})}}class cA extends D1{constructor(e){super(new Uint8Array(0)),this._schema=!1,this._body=[],this._batchIndex=0,this._dictionaryIndex=0,this._json=e instanceof Iv?e:new Iv(e)}next(){const{_json:e}=this;if(!this._schema)return this._schema=!0,{done:!1,value:is.fromJSON(e.schema,Gr.Schema)};if(this._dictionaryIndex<e.dictionaries.length){const n=e.dictionaries[this._dictionaryIndex++];return this._body=n.data.columns,{done:!1,value:is.fromJSON(n,Gr.DictionaryBatch)}}if(this._batchIndex<e.batches.length){const n=e.batches[this._batchIndex++];return this._body=n.columns,{done:!1,value:is.fromJSON(n,Gr.RecordBatch)}}return this._body=[],Vi}readMessageBody(e){return n(this._body);function n(l){return(l||[]).reduce((p,v)=>[...p,...v.VALIDITY&&[v.VALIDITY]||[],...v.TYPE_ID&&[v.TYPE_ID]||[],...v.OFFSET&&[v.OFFSET]||[],...v.DATA&&[v.DATA]||[],...n(v.children)],[])}}readMessage(e){let n;if((n=this.next()).done)return null;if(e!=null&&n.value.headerType!==e)throw new Error(zy(e));return n.value}readSchema(){const e=Gr.Schema,n=this.readMessage(e),l=n==null?void 0:n.header();if(!n||!l)throw new Error(By(e));return l}}const Hp=4,Zg="ARROW1",qh=new Uint8Array(Zg.length);for(let i=0;i<Zg.length;i+=1)qh[i]=Zg.codePointAt(i);function Ry(i,e=0){for(let n=-1,l=qh.length;++n<l;)if(qh[n]!==i[e+n])return!1;return!0}const td=qh.length,P1=td+Hp,uA=td*2+Hp;class Ys extends Ey{constructor(e){super(),this._impl=e}get closed(){return this._impl.closed}get schema(){return this._impl.schema}get autoDestroy(){return this._impl.autoDestroy}get dictionaries(){return this._impl.dictionaries}get numDictionaries(){return this._impl.numDictionaries}get numRecordBatches(){return this._impl.numRecordBatches}get footer(){return this._impl.isFile()?this._impl.footer:null}isSync(){return this._impl.isSync()}isAsync(){return this._impl.isAsync()}isFile(){return this._impl.isFile()}isStream(){return this._impl.isStream()}next(){return this._impl.next()}throw(e){return this._impl.throw(e)}return(e){return this._impl.return(e)}cancel(){return this._impl.cancel()}reset(e){return this._impl.reset(e),this._DOMStream=void 0,this._nodeStream=void 0,this}open(e){const n=this._impl.open(e);return Bl(n)?n.then(()=>this):this}readRecordBatch(e){return this._impl.isFile()?this._impl.readRecordBatch(e):null}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}toDOMStream(){return Gs.toDOMStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this})}toNodeStream(){return Gs.toNodeStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this},{objectMode:!0})}static throughNode(e){throw new Error('"throughNode" not available in this environment')}static throughDOM(e,n){throw new Error('"throughDOM" not available in this environment')}static from(e){return e instanceof Ys?e:Rg(e)?pA(e):Ob(e)?yA(e):Bl(e)?lr(this,void 0,void 0,function*(){return yield Ys.from(yield e)}):Nb(e)||yy(e)||Ub(e)||ou(e)?gA(new eu(e)):mA(new xp(e))}static readAll(e){return e instanceof Ys?e.isSync()?Lv(e):zv(e):Rg(e)||ArrayBuffer.isView(e)||Xh(e)||Fb(e)?Lv(e):zv(e)}}class Sp extends Ys{constructor(e){super(e),this._impl=e}readAll(){return[...this]}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return za(this,arguments,function*(){yield Sr(yield*Pf(Dl(this[Symbol.iterator]())))})}}class Ip extends Ys{constructor(e){super(e),this._impl=e}readAll(){return lr(this,void 0,void 0,function*(){var e,n,l,p;const v=new Array;try{for(var b=!0,c=Dl(this),E;E=yield c.next(),e=E.done,!e;b=!0){p=E.value,b=!1;const T=p;v.push(T)}}catch(T){n={error:T}}finally{try{!b&&!e&&(l=c.return)&&(yield l.call(c))}finally{if(n)throw n.error}}return v})}[Symbol.iterator](){throw new Error("AsyncRecordBatchStreamReader is not Iterable")}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}}class L1 extends Sp{constructor(e){super(e),this._impl=e}}class hA extends Ip{constructor(e){super(e),this._impl=e}}class z1{get numDictionaries(){return this._dictionaryIndex}get numRecordBatches(){return this._recordBatchIndex}constructor(e=new Map){this.closed=!1,this.autoDestroy=!0,this._dictionaryIndex=0,this._recordBatchIndex=0,this.dictionaries=e}isSync(){return!1}isAsync(){return!1}isFile(){return!1}isStream(){return!1}reset(e){return this._dictionaryIndex=0,this._recordBatchIndex=0,this.schema=e,this.dictionaries=new Map,this}_loadRecordBatch(e,n){const l=this._loadVectors(e,n,this.schema.fields),p=Mr({type:new rs(this.schema.fields),length:e.length,children:l});return new vs(this.schema,p)}_loadDictionaryBatch(e,n){const{id:l,isDelta:p}=e,{dictionaries:v,schema:b}=this,c=v.get(l),E=b.dictionaries.get(l),T=this._loadVectors(e.data,n,[E]);return(c&&p?c.concat(new Jr(T)):new Jr(T)).memoize()}_loadVectors(e,n,l){return new w1(n,e.nodes,e.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(l)}}class Tp extends z1{constructor(e,n){super(n),this._reader=Rg(e)?new cA(this._handle=e):new D1(this._handle=e)}isSync(){return!0}isStream(){return!0}[Symbol.iterator](){return this}cancel(){!this.closed&&(this.closed=!0)&&(this.reset()._reader.return(),this._reader=null,this.dictionaries=null)}open(e){return this.closed||(this.autoDestroy=R1(this,e),this.schema||(this.schema=this._reader.readSchema())||this.cancel()),this}throw(e){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.throw(e):Vi}return(e){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.return(e):Vi}next(){if(this.closed)return Vi;let e;const{_reader:n}=this;for(;e=this._readNextMessageAndValidate();)if(e.isSchema())this.reset(e.header());else if(e.isRecordBatch()){this._recordBatchIndex++;const l=e.header(),p=n.readMessageBody(e.bodyLength);return{done:!1,value:this._loadRecordBatch(l,p)}}else if(e.isDictionaryBatch()){this._dictionaryIndex++;const l=e.header(),p=n.readMessageBody(e.bodyLength),v=this._loadDictionaryBatch(l,p);this.dictionaries.set(l.id,v)}return this.schema&&this._recordBatchIndex===0?(this._recordBatchIndex++,{done:!1,value:new Ly(this.schema)}):this.return()}_readNextMessageAndValidate(e){return this._reader.readMessage(e)}}class kp extends z1{constructor(e,n){super(n),this._reader=new lA(this._handle=e)}isAsync(){return!0}isStream(){return!0}[Symbol.asyncIterator](){return this}cancel(){return lr(this,void 0,void 0,function*(){!this.closed&&(this.closed=!0)&&(yield this.reset()._reader.return(),this._reader=null,this.dictionaries=null)})}open(e){return lr(this,void 0,void 0,function*(){return this.closed||(this.autoDestroy=R1(this,e),this.schema||(this.schema=yield this._reader.readSchema())||(yield this.cancel())),this})}throw(e){return lr(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.throw(e):Vi})}return(e){return lr(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.return(e):Vi})}next(){return lr(this,void 0,void 0,function*(){if(this.closed)return Vi;let e;const{_reader:n}=this;for(;e=yield this._readNextMessageAndValidate();)if(e.isSchema())yield this.reset(e.header());else if(e.isRecordBatch()){this._recordBatchIndex++;const l=e.header(),p=yield n.readMessageBody(e.bodyLength);return{done:!1,value:this._loadRecordBatch(l,p)}}else if(e.isDictionaryBatch()){this._dictionaryIndex++;const l=e.header(),p=yield n.readMessageBody(e.bodyLength),v=this._loadDictionaryBatch(l,p);this.dictionaries.set(l.id,v)}return this.schema&&this._recordBatchIndex===0?(this._recordBatchIndex++,{done:!1,value:new Ly(this.schema)}):yield this.return()})}_readNextMessageAndValidate(e){return lr(this,void 0,void 0,function*(){return yield this._reader.readMessage(e)})}}class B1 extends Tp{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(e,n){super(e instanceof Tv?e:new Tv(e),n)}isSync(){return!0}isFile(){return!0}open(e){if(!this.closed&&!this._footer){this.schema=(this._footer=this._readFooter()).schema;for(const n of this._footer.dictionaryBatches())n&&this._readDictionaryBatch(this._dictionaryIndex++)}return super.open(e)}readRecordBatch(e){var n;if(this.closed)return null;this._footer||this.open();const l=(n=this._footer)===null||n===void 0?void 0:n.getRecordBatch(e);if(l&&this._handle.seek(l.offset)){const p=this._reader.readMessage(Gr.RecordBatch);if(p!=null&&p.isRecordBatch()){const v=p.header(),b=this._reader.readMessageBody(p.bodyLength);return this._loadRecordBatch(v,b)}}return null}_readDictionaryBatch(e){var n;const l=(n=this._footer)===null||n===void 0?void 0:n.getDictionaryBatch(e);if(l&&this._handle.seek(l.offset)){const p=this._reader.readMessage(Gr.DictionaryBatch);if(p!=null&&p.isDictionaryBatch()){const v=p.header(),b=this._reader.readMessageBody(p.bodyLength),c=this._loadDictionaryBatch(v,b);this.dictionaries.set(v.id,c)}}}_readFooter(){const{_handle:e}=this,n=e.size-P1,l=e.readInt32(n),p=e.readAt(n-l,l);return jh.decode(p)}_readNextMessageAndValidate(e){var n;if(this._footer||this.open(),this._footer&&this._recordBatchIndex<this.numRecordBatches){const l=(n=this._footer)===null||n===void 0?void 0:n.getRecordBatch(this._recordBatchIndex);if(l&&this._handle.seek(l.offset))return this._reader.readMessage(e)}return null}}class dA extends kp{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(e,...n){const l=typeof n[0]!="number"?n.shift():void 0,p=n[0]instanceof Map?n.shift():void 0;super(e instanceof wp?e:new wp(e,l),p)}isFile(){return!0}isAsync(){return!0}open(e){const n=Object.create(null,{open:{get:()=>super.open}});return lr(this,void 0,void 0,function*(){if(!this.closed&&!this._footer){this.schema=(this._footer=yield this._readFooter()).schema;for(const l of this._footer.dictionaryBatches())l&&(yield this._readDictionaryBatch(this._dictionaryIndex++))}return yield n.open.call(this,e)})}readRecordBatch(e){return lr(this,void 0,void 0,function*(){var n;if(this.closed)return null;this._footer||(yield this.open());const l=(n=this._footer)===null||n===void 0?void 0:n.getRecordBatch(e);if(l&&(yield this._handle.seek(l.offset))){const p=yield this._reader.readMessage(Gr.RecordBatch);if(p!=null&&p.isRecordBatch()){const v=p.header(),b=yield this._reader.readMessageBody(p.bodyLength);return this._loadRecordBatch(v,b)}}return null})}_readDictionaryBatch(e){return lr(this,void 0,void 0,function*(){var n;const l=(n=this._footer)===null||n===void 0?void 0:n.getDictionaryBatch(e);if(l&&(yield this._handle.seek(l.offset))){const p=yield this._reader.readMessage(Gr.DictionaryBatch);if(p!=null&&p.isDictionaryBatch()){const v=p.header(),b=yield this._reader.readMessageBody(p.bodyLength),c=this._loadDictionaryBatch(v,b);this.dictionaries.set(v.id,c)}}})}_readFooter(){return lr(this,void 0,void 0,function*(){const{_handle:e}=this;e._pending&&(yield e._pending);const n=e.size-P1,l=yield e.readInt32(n),p=yield e.readAt(n-l,l);return jh.decode(p)})}_readNextMessageAndValidate(e){return lr(this,void 0,void 0,function*(){if(this._footer||(yield this.open()),this._footer&&this._recordBatchIndex<this.numRecordBatches){const n=this._footer.getRecordBatch(this._recordBatchIndex);if(n&&(yield this._handle.seek(n.offset)))return yield this._reader.readMessage(e)}return null})}}class fA extends Tp{constructor(e,n){super(e,n)}_loadVectors(e,n,l){return new kk(n,e.nodes,e.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(l)}}function R1(i,e){return e&&typeof e.autoDestroy=="boolean"?e.autoDestroy:i.autoDestroy}function*Lv(i){const e=Ys.from(i);try{if(!e.open({autoDestroy:!1}).closed)do yield e;while(!e.reset().open().closed)}finally{e.cancel()}}function zv(i){return za(this,arguments,function*(){const n=yield Sr(Ys.from(i));try{if(!(yield Sr(n.open({autoDestroy:!1}))).closed)do yield yield Sr(n);while(!(yield Sr(n.reset().open())).closed)}finally{yield Sr(n.cancel())}})}function pA(i){return new Sp(new fA(i))}function mA(i){const e=i.peek(td+7&-8);return e&&e.byteLength>=4?Ry(e)?new L1(new B1(i.read())):new Sp(new Tp(i)):new Sp(new Tp(function*(){}()))}function gA(i){return lr(this,void 0,void 0,function*(){const e=yield i.peek(td+7&-8);return e&&e.byteLength>=4?Ry(e)?new L1(new B1(yield i.read())):new Ip(new kp(i)):new Ip(new kp(function(){return za(this,arguments,function*(){})}()))})}function yA(i){return lr(this,void 0,void 0,function*(){const{size:e}=yield i.stat(),n=new wp(i,e);return e>=uA&&Ry(yield n.readAt(0,td+7&-8))?new hA(new dA(n)):new Ip(new kp(n))})}class qi extends Er{static assemble(...e){const n=p=>p.flatMap(v=>Array.isArray(v)?n(v):v instanceof vs?v.data.children:v.data),l=new qi;return l.visitMany(n(e)),l}constructor(){super(),this._byteLength=0,this._nodes=[],this._buffers=[],this._bufferRegions=[]}visit(e){if(e instanceof Jr)return this.visitMany(e.data),this;const{type:n}=e;if(!Ot.isDictionary(n)){const{length:l}=e;if(l>2147483647)throw new RangeError("Cannot write arrays larger than 2^31 - 1 in length");if(Ot.isUnion(n))this.nodes.push(new Qo(l,0));else{const{nullCount:p}=e;Ot.isNull(n)||pa.call(this,p<=0?new Uint8Array(0):gp(e.offset,l,e.nullBitmap)),this.nodes.push(new Qo(l,p))}}return super.visit(e)}visitNull(e){return this}visitDictionary(e){return this.visit(e.clone(e.type.indices))}get nodes(){return this._nodes}get buffers(){return this._buffers}get byteLength(){return this._byteLength}get bufferRegions(){return this._bufferRegions}}function pa(i){const e=i.byteLength+7&-8;return this.buffers.push(i),this.bufferRegions.push(new Ba(this._byteLength,e)),this._byteLength+=e,this}function _A(i){var e;const{type:n,length:l,typeIds:p,valueOffsets:v}=i;if(pa.call(this,p),n.mode===Gn.Sparse)return Wg.call(this,i);if(n.mode===Gn.Dense){if(i.offset<=0)return pa.call(this,v),Wg.call(this,i);{const b=new Int32Array(l),c=Object.create(null),E=Object.create(null);for(let T,z,B=-1;++B<l;)(T=p[B])!==void 0&&((z=c[T])===void 0&&(z=c[T]=v[B]),b[B]=v[B]-z,E[T]=((e=E[T])!==null&&e!==void 0?e:0)+1);pa.call(this,b),this.visitMany(i.children.map((T,z)=>{const B=n.typeIds[z],$=c[B],q=E[B];return T.slice($,Math.min(l,q))}))}}return this}function vA(i){let e;return i.nullCount>=i.length?pa.call(this,new Uint8Array(0)):(e=i.values)instanceof Uint8Array?pa.call(this,gp(i.offset,i.length,e)):pa.call(this,yp(i.values))}function vo(i){return pa.call(this,i.values.subarray(0,i.length*i.stride))}function Yp(i){const{length:e,values:n,valueOffsets:l}=i,p=mi(l[0]),v=mi(l[e]),b=Math.min(v-p,n.byteLength-p);return pa.call(this,Vb(-p,e+1,l)),pa.call(this,n.subarray(p,p+b)),this}function Fy(i){const{length:e,valueOffsets:n}=i;if(n){const{[0]:l,[e]:p}=n;return pa.call(this,Vb(-l,e+1,n)),this.visit(i.children[0].slice(l,p-l))}return this.visit(i.children[0])}function Wg(i){return this.visitMany(i.type.children.map((e,n)=>i.children[n]).filter(Boolean))[0]}qi.prototype.visitBool=vA;qi.prototype.visitInt=vo;qi.prototype.visitFloat=vo;qi.prototype.visitUtf8=Yp;qi.prototype.visitLargeUtf8=Yp;qi.prototype.visitBinary=Yp;qi.prototype.visitLargeBinary=Yp;qi.prototype.visitFixedSizeBinary=vo;qi.prototype.visitDate=vo;qi.prototype.visitTimestamp=vo;qi.prototype.visitTime=vo;qi.prototype.visitDecimal=vo;qi.prototype.visitList=Fy;qi.prototype.visitStruct=Wg;qi.prototype.visitUnion=_A;qi.prototype.visitInterval=vo;qi.prototype.visitDuration=vo;qi.prototype.visitFixedSizeList=Fy;qi.prototype.visitMap=Fy;class F1 extends Ey{static throughNode(e){throw new Error('"throughNode" not available in this environment')}static throughDOM(e,n){throw new Error('"throughDOM" not available in this environment')}constructor(e){super(),this._position=0,this._started=!1,this._sink=new Nf,this._schema=null,this._dictionaryBlocks=[],this._recordBatchBlocks=[],this._seenDictionaries=new Map,this._dictionaryDeltaOffsets=new Map,ws(e)||(e={autoDestroy:!0,writeLegacyIpcFormat:!1}),this._autoDestroy=typeof e.autoDestroy=="boolean"?e.autoDestroy:!0,this._writeLegacyIpcFormat=typeof e.writeLegacyIpcFormat=="boolean"?e.writeLegacyIpcFormat:!1}toString(e=!1){return this._sink.toString(e)}toUint8Array(e=!1){return this._sink.toUint8Array(e)}writeAll(e){return Bl(e)?e.then(n=>this.writeAll(n)):ou(e)?$y(this,e):Uy(this,e)}get closed(){return this._sink.closed}[Symbol.asyncIterator](){return this._sink[Symbol.asyncIterator]()}toDOMStream(e){return this._sink.toDOMStream(e)}toNodeStream(e){return this._sink.toNodeStream(e)}close(){return this.reset()._sink.close()}abort(e){return this.reset()._sink.abort(e)}finish(){return this._autoDestroy?this.close():this.reset(this._sink,this._schema),this}reset(e=this._sink,n=null){return e===this._sink||e instanceof Nf?this._sink=e:(this._sink=new Nf,e&&KI(e)?this.toDOMStream({type:"bytes"}).pipeTo(e):e&&XI(e)&&this.toNodeStream({objectMode:!1}).pipe(e)),this._started&&this._schema&&this._writeFooter(this._schema),this._started=!1,this._dictionaryBlocks=[],this._recordBatchBlocks=[],this._seenDictionaries=new Map,this._dictionaryDeltaOffsets=new Map,(!n||!Gg(n,this._schema))&&(n==null?(this._position=0,this._schema=null):(this._started=!0,this._schema=n,this._writeSchema(n))),this}write(e){let n=null;if(this._sink){if(e==null)return this.finish()&&void 0;if(e instanceof Jo&&!(n=e.schema))return this.finish()&&void 0;if(e instanceof vs&&!(n=e.schema))return this.finish()&&void 0}else throw new Error("RecordBatchWriter is closed");if(n&&!Gg(n,this._schema)){if(this._started&&this._autoDestroy)return this.close();this.reset(this._sink,n)}e instanceof vs?e instanceof Ly||this._writeRecordBatch(e):e instanceof Jo?this.writeAll(e.batches):Xh(e)&&this.writeAll(e)}_writeMessage(e,n=8){const l=n-1,p=is.encode(e),v=p.byteLength,b=this._writeLegacyIpcFormat?4:8,c=v+b+l&~l,E=c-v-b;return e.headerType===Gr.RecordBatch?this._recordBatchBlocks.push(new Ko(c,e.bodyLength,this._position)):e.headerType===Gr.DictionaryBatch&&this._dictionaryBlocks.push(new Ko(c,e.bodyLength,this._position)),this._writeLegacyIpcFormat||this._write(Int32Array.of(-1)),this._write(Int32Array.of(c-b)),v>0&&this._write(p),this._writePadding(E)}_write(e){if(this._started){const n=Fr(e);n&&n.byteLength>0&&(this._sink.write(n),this._position+=n.byteLength)}return this}_writeSchema(e){return this._writeMessage(is.from(e))}_writeFooter(e){return this._writeLegacyIpcFormat?this._write(Int32Array.of(0)):this._write(Int32Array.of(-1,0))}_writeMagic(){return this._write(qh)}_writePadding(e){return e>0?this._write(new Uint8Array(e)):this}_writeRecordBatch(e){const{byteLength:n,nodes:l,bufferRegions:p,buffers:v}=qi.assemble(e),b=new zs(e.numRows,l,p),c=is.from(b,n);return this._writeDictionaries(e)._writeMessage(c)._writeBodyBuffers(v)}_writeDictionaryBatch(e,n,l=!1){const{byteLength:p,nodes:v,bufferRegions:b,buffers:c}=qi.assemble(new Jr([e])),E=new zs(e.length,v,b),T=new $a(E,n,l),z=is.from(T,p);return this._writeMessage(z)._writeBodyBuffers(c)}_writeBodyBuffers(e){let n,l,p;for(let v=-1,b=e.length;++v<b;)(n=e[v])&&(l=n.byteLength)>0&&(this._write(n),(p=(l+7&-8)-l)>0&&this._writePadding(p));return this}_writeDictionaries(e){var n,l;for(const[p,v]of e.dictionaries){const b=(n=v==null?void 0:v.data)!==null&&n!==void 0?n:[],c=this._seenDictionaries.get(p),E=(l=this._dictionaryDeltaOffsets.get(p))!==null&&l!==void 0?l:0;if(!c||c.data[0]!==b[0])for(const[T,z]of b.entries())this._writeDictionaryBatch(z,p,T>0);else if(E<b.length)for(const T of b.slice(E))this._writeDictionaryBatch(T,p,!0);this._seenDictionaries.set(p,v),this._dictionaryDeltaOffsets.set(p,b.length)}return this}}class Oy extends F1{static writeAll(e,n){const l=new Oy(n);return Bl(e)?e.then(p=>l.writeAll(p)):ou(e)?$y(l,e):Uy(l,e)}}class Ny extends F1{static writeAll(e){const n=new Ny;return Bl(e)?e.then(l=>n.writeAll(l)):ou(e)?$y(n,e):Uy(n,e)}constructor(){super(),this._autoDestroy=!0}_writeSchema(e){return this._writeMagic()._writePadding(2)}_writeDictionaryBatch(e,n,l=!1){if(!l&&this._seenDictionaries.has(n))throw new Error("The Arrow File format does not support replacement dictionaries. ");return super._writeDictionaryBatch(e,n,l)}_writeFooter(e){const n=jh.encode(new jh(e,an.V5,this._recordBatchBlocks,this._dictionaryBlocks));return super._writeFooter(e)._write(n)._write(Int32Array.of(n.byteLength))._writeMagic()}}function Uy(i,e){let n=e;e instanceof Jo&&(n=e.batches,i.reset(void 0,e.schema));for(const l of n)i.write(l);return i.finish()}function $y(i,e){return lr(this,void 0,void 0,function*(){var n,l,p,v,b,c,E;try{for(n=!0,l=Dl(e);p=yield l.next(),v=p.done,!v;n=!0){E=p.value,n=!1;const T=E;i.write(T)}}catch(T){b={error:T}}finally{try{!n&&!v&&(c=l.return)&&(yield c.call(l))}finally{if(b)throw b.error}}return i.finish()})}function bA(i,e="stream"){return(e==="stream"?Oy:Ny).writeAll(i).toUint8Array(!0)}var xA=Object.create,O1=Object.defineProperty,wA=Object.getOwnPropertyDescriptor,SA=Object.getOwnPropertyNames,IA=Object.getPrototypeOf,TA=Object.prototype.hasOwnProperty,kA=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports),AA=(i,e,n,l)=>{if(e&&typeof e=="object"||typeof e=="function")for(let p of SA(e))!TA.call(i,p)&&p!==n&&O1(i,p,{get:()=>e[p],enumerable:!(l=wA(e,p))||l.enumerable});return i},EA=(i,e,n)=>(n=i!=null?xA(IA(i)):{},AA(!i||!i.__esModule?O1(n,"default",{value:i,enumerable:!0}):n,i)),CA=kA((i,e)=>{e.exports=Worker}),MA=(i=>(i[i.UNDEFINED=0]="UNDEFINED",i[i.AUTOMATIC=1]="AUTOMATIC",i[i.READ_ONLY=2]="READ_ONLY",i[i.READ_WRITE=3]="READ_WRITE",i))(MA||{}),DA=(i=>(i[i.IDENTIFIER=0]="IDENTIFIER",i[i.NUMERIC_CONSTANT=1]="NUMERIC_CONSTANT",i[i.STRING_CONSTANT=2]="STRING_CONSTANT",i[i.OPERATOR=3]="OPERATOR",i[i.KEYWORD=4]="KEYWORD",i[i.COMMENT=5]="COMMENT",i))(DA||{}),PA=(i=>(i[i.NONE=0]="NONE",i[i.DEBUG=1]="DEBUG",i[i.INFO=2]="INFO",i[i.WARNING=3]="WARNING",i[i.ERROR=4]="ERROR",i))(PA||{}),LA=(i=>(i[i.NONE=0]="NONE",i[i.CONNECT=1]="CONNECT",i[i.DISCONNECT=2]="DISCONNECT",i[i.OPEN=3]="OPEN",i[i.QUERY=4]="QUERY",i[i.INSTANTIATE=5]="INSTANTIATE",i))(LA||{}),zA=(i=>(i[i.NONE=0]="NONE",i[i.OK=1]="OK",i[i.ERROR=2]="ERROR",i[i.START=3]="START",i[i.RUN=4]="RUN",i[i.CAPTURE=5]="CAPTURE",i))(zA||{}),BA=(i=>(i[i.NONE=0]="NONE",i[i.WEB_WORKER=1]="WEB_WORKER",i[i.NODE_WORKER=2]="NODE_WORKER",i[i.BINDINGS=3]="BINDINGS",i[i.ASYNC_DUCKDB=4]="ASYNC_DUCKDB",i))(BA||{}),RA=class{constructor(i=2){this.level=i}log(i){i.level>=this.level&&console.log(i)}},FA=(i=>(i[i.SUCCESS=0]="SUCCESS",i))(FA||{}),OA=class{constructor(i,e){this._bindings=i,this._conn=e}get bindings(){return this._bindings}async close(){return this._bindings.disconnect(this._conn)}useUnsafe(i){return i(this._bindings,this._conn)}async query(i){this._bindings.logger.log({timestamp:new Date,level:2,origin:4,topic:4,event:4,value:i});let e=await this._bindings.runQuery(this._conn,i),n=Ys.from(e);return console.assert(n.isSync(),"Reader is not sync"),console.assert(n.isFile(),"Reader is not file"),new Jo(n)}async send(i){this._bindings.logger.log({timestamp:new Date,level:2,origin:4,topic:4,event:4,value:i});let e=await this._bindings.startPendingQuery(this._conn,i);for(;e==null;)e=await this._bindings.pollPendingQuery(this._conn);let n=new N1(this._bindings,this._conn,e),l=await Ys.from(n);return console.assert(l.isAsync()),console.assert(l.isStream()),l}async cancelSent(){return await this._bindings.cancelPendingQuery(this._conn)}async getTableNames(i){return await this._bindings.getTableNames(this._conn,i)}async prepare(i){let e=await this._bindings.createPrepared(this._conn,i);return new NA(this._bindings,this._conn,e)}async insertArrowTable(i,e){let n=bA(i,"stream");await this.insertArrowFromIPCStream(n,e)}async insertArrowFromIPCStream(i,e){await this._bindings.insertArrowFromIPCStream(this._conn,i,e)}async insertCSVFromPath(i,e){await this._bindings.insertCSVFromPath(this._conn,i,e)}async insertJSONFromPath(i,e){await this._bindings.insertJSONFromPath(this._conn,i,e)}},N1=class{constructor(i,e,n){this.db=i,this.conn=e,this.header=n,this._first=!0,this._depleted=!1,this._inFlight=null}async next(){if(this._first)return this._first=!1,{done:!1,value:this.header};if(this._depleted)return{done:!0,value:null};let i;return this._inFlight!=null?(i=await this._inFlight,this._inFlight=null):i=await this.db.fetchQueryResults(this.conn),this._depleted=i.length==0,this._depleted||(this._inFlight=this.db.fetchQueryResults(this.conn)),{done:this._depleted,value:i}}[Symbol.asyncIterator](){return this}},NA=class{constructor(i,e,n){this.bindings=i,this.connectionId=e,this.statementId=n}async close(){await this.bindings.closePrepared(this.connectionId,this.statementId)}async query(...i){let e=await this.bindings.runPrepared(this.connectionId,this.statementId,i),n=Ys.from(e);return console.assert(n.isSync()),console.assert(n.isFile()),new Jo(n)}async send(...i){let e=await this.bindings.sendPrepared(this.connectionId,this.statementId,i),n=new N1(this.bindings,this.connectionId,e),l=await Ys.from(n);return console.assert(l.isAsync()),console.assert(l.isStream()),l}},UA=(i=>(i.CANCEL_PENDING_QUERY="CANCEL_PENDING_QUERY",i.CLOSE_PREPARED="CLOSE_PREPARED",i.COLLECT_FILE_STATISTICS="COLLECT_FILE_STATISTICS",i.CONNECT="CONNECT",i.COPY_FILE_TO_BUFFER="COPY_FILE_TO_BUFFER",i.COPY_FILE_TO_PATH="COPY_FILE_TO_PATH",i.CREATE_PREPARED="CREATE_PREPARED",i.DISCONNECT="DISCONNECT",i.DROP_FILE="DROP_FILE",i.DROP_FILES="DROP_FILES",i.EXPORT_FILE_STATISTICS="EXPORT_FILE_STATISTICS",i.FETCH_QUERY_RESULTS="FETCH_QUERY_RESULTS",i.FLUSH_FILES="FLUSH_FILES",i.GET_FEATURE_FLAGS="GET_FEATURE_FLAGS",i.GET_TABLE_NAMES="GET_TABLE_NAMES",i.GET_VERSION="GET_VERSION",i.GLOB_FILE_INFOS="GLOB_FILE_INFOS",i.INSERT_ARROW_FROM_IPC_STREAM="INSERT_ARROW_FROM_IPC_STREAM",i.INSERT_CSV_FROM_PATH="IMPORT_CSV_FROM_PATH",i.INSERT_JSON_FROM_PATH="IMPORT_JSON_FROM_PATH",i.INSTANTIATE="INSTANTIATE",i.OPEN="OPEN",i.PING="PING",i.POLL_PENDING_QUERY="POLL_PENDING_QUERY",i.REGISTER_FILE_BUFFER="REGISTER_FILE_BUFFER",i.REGISTER_FILE_HANDLE="REGISTER_FILE_HANDLE",i.REGISTER_FILE_URL="REGISTER_FILE_URL",i.RESET="RESET",i.RUN_PREPARED="RUN_PREPARED",i.RUN_QUERY="RUN_QUERY",i.SEND_PREPARED="SEND_PREPARED",i.START_PENDING_QUERY="START_PENDING_QUERY",i.TOKENIZE="TOKENIZE",i))(UA||{}),$A=(i=>(i.CONNECTION_INFO="CONNECTION_INFO",i.ERROR="ERROR",i.FEATURE_FLAGS="FEATURE_FLAGS",i.FILE_BUFFER="FILE_BUFFER",i.FILE_INFOS="FILE_INFOS",i.FILE_SIZE="FILE_SIZE",i.FILE_STATISTICS="FILE_STATISTICS",i.INSTANTIATE_PROGRESS="INSTANTIATE_PROGRESS",i.LOG="LOG",i.OK="OK",i.PREPARED_STATEMENT_ID="PREPARED_STATEMENT_ID",i.QUERY_PLAN="QUERY_PLAN",i.QUERY_RESULT="QUERY_RESULT",i.QUERY_RESULT_CHUNK="QUERY_RESULT_CHUNK",i.QUERY_RESULT_HEADER="QUERY_RESULT_HEADER",i.QUERY_RESULT_HEADER_OR_NULL="QUERY_RESULT_HEADER_OR_NULL",i.REGISTERED_FILE="REGISTERED_FILE",i.SCRIPT_TOKENS="SCRIPT_TOKENS",i.SUCCESS="SUCCESS",i.TABLE_NAMES="TABLE_NAMES",i.VERSION_STRING="VERSION_STRING",i))($A||{}),Vr=class{constructor(i,e){this.promiseResolver=()=>{},this.promiseRejecter=()=>{},this.type=i,this.data=e,this.promise=new Promise((n,l)=>{this.promiseResolver=n,this.promiseRejecter=l})}};function Vf(i){switch(i.typeId){case le.Binary:return{sqlType:"binary"};case le.Bool:return{sqlType:"bool"};case le.Date:return{sqlType:"date"};case le.DateDay:return{sqlType:"date32[d]"};case le.DateMillisecond:return{sqlType:"date64[ms]"};case le.Decimal:{let e=i;return{sqlType:"decimal",precision:e.precision,scale:e.scale}}case le.Float:return{sqlType:"float"};case le.Float16:return{sqlType:"float16"};case le.Float32:return{sqlType:"float32"};case le.Float64:return{sqlType:"float64"};case le.Int:return{sqlType:"int32"};case le.Int16:return{sqlType:"int16"};case le.Int32:return{sqlType:"int32"};case le.Int64:return{sqlType:"int64"};case le.Uint16:return{sqlType:"uint16"};case le.Uint32:return{sqlType:"uint32"};case le.Uint64:return{sqlType:"uint64"};case le.Uint8:return{sqlType:"uint8"};case le.IntervalDayTime:return{sqlType:"interval[dt]"};case le.IntervalYearMonth:return{sqlType:"interval[m]"};case le.List:return{sqlType:"list",valueType:Vf(i.valueType)};case le.FixedSizeBinary:return{sqlType:"fixedsizebinary",byteWidth:i.byteWidth};case le.Null:return{sqlType:"null"};case le.Utf8:return{sqlType:"utf8"};case le.Struct:return{sqlType:"struct",fields:i.children.map(e=>Hg(e.name,e.type))};case le.Map:{let e=i;return{sqlType:"map",keyType:Vf(e.keyType),valueType:Vf(e.valueType)}}case le.Time:return{sqlType:"time[s]"};case le.TimeMicrosecond:return{sqlType:"time[us]"};case le.TimeMillisecond:return{sqlType:"time[ms]"};case le.TimeNanosecond:return{sqlType:"time[ns]"};case le.TimeSecond:return{sqlType:"time[s]"};case le.Timestamp:return{sqlType:"timestamp",timezone:i.timezone||void 0};case le.TimestampSecond:return{sqlType:"timestamp[s]",timezone:i.timezone||void 0};case le.TimestampMicrosecond:return{sqlType:"timestamp[us]",timezone:i.timezone||void 0};case le.TimestampNanosecond:return{sqlType:"timestamp[ns]",timezone:i.timezone||void 0};case le.TimestampMillisecond:return{sqlType:"timestamp[ms]",timezone:i.timezone||void 0}}throw new Error("unsupported arrow type: ".concat(i.toString()))}function Hg(i,e){let n=Vf(e);return n.name=i,n}var VA=new TextEncoder,jA=class{constructor(i,e=null){this._onInstantiationProgress=[],this._worker=null,this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{},this._nextMessageId=0,this._pendingRequests=new Map,this._logger=i,this._onMessageHandler=this.onMessage.bind(this),this._onErrorHandler=this.onError.bind(this),this._onCloseHandler=this.onClose.bind(this),e!=null&&this.attach(e)}get logger(){return this._logger}attach(i){this._worker=i,this._worker.addEventListener("message",this._onMessageHandler),this._worker.addEventListener("error",this._onErrorHandler),this._worker.addEventListener("close",this._onCloseHandler),this._workerShutdownPromise=new Promise((e,n)=>{this._workerShutdownResolver=e})}detach(){this._worker&&(this._worker.removeEventListener("message",this._onMessageHandler),this._worker.removeEventListener("error",this._onErrorHandler),this._worker.removeEventListener("close",this._onCloseHandler),this._worker=null,this._workerShutdownResolver(null),this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{})}async terminate(){this._worker&&(this._worker.terminate(),this._worker=null,this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{})}async postTask(i,e=[]){if(!this._worker){console.error("cannot send a message since the worker is not set!");return}let n=this._nextMessageId++;return this._pendingRequests.set(n,i),this._worker.postMessage({messageId:n,type:i.type,data:i.data},e),await i.promise}onMessage(i){var e;let n=i.data;switch(n.type){case"LOG":{this._logger.log(n.data);return}case"INSTANTIATE_PROGRESS":{for(let p of this._onInstantiationProgress)p(n.data);return}}let l=this._pendingRequests.get(n.requestId);if(!l){console.warn("unassociated response: [".concat(n.requestId,", ").concat(n.type.toString(),"]"));return}if(this._pendingRequests.delete(n.requestId),n.type=="ERROR"){let p=new Error(n.data.message);p.name=n.data.name,(e=Object.getOwnPropertyDescriptor(p,"stack"))!=null&&e.writable&&(p.stack=n.data.stack),l.promiseRejecter(p);return}switch(l.type){case"CLOSE_PREPARED":case"COLLECT_FILE_STATISTICS":case"COPY_FILE_TO_PATH":case"DISCONNECT":case"DROP_FILE":case"DROP_FILES":case"FLUSH_FILES":case"INSERT_ARROW_FROM_IPC_STREAM":case"IMPORT_CSV_FROM_PATH":case"IMPORT_JSON_FROM_PATH":case"OPEN":case"PING":case"REGISTER_FILE_BUFFER":case"REGISTER_FILE_HANDLE":case"REGISTER_FILE_URL":case"RESET":if(n.type=="OK"){l.promiseResolver(n.data);return}break;case"INSTANTIATE":if(this._onInstantiationProgress=[],n.type=="OK"){l.promiseResolver(n.data);return}break;case"GLOB_FILE_INFOS":if(n.type=="FILE_INFOS"){l.promiseResolver(n.data);return}break;case"GET_VERSION":if(n.type=="VERSION_STRING"){l.promiseResolver(n.data);return}break;case"GET_FEATURE_FLAGS":if(n.type=="FEATURE_FLAGS"){l.promiseResolver(n.data);return}break;case"GET_TABLE_NAMES":if(n.type=="TABLE_NAMES"){l.promiseResolver(n.data);return}break;case"TOKENIZE":if(n.type=="SCRIPT_TOKENS"){l.promiseResolver(n.data);return}break;case"COPY_FILE_TO_BUFFER":if(n.type=="FILE_BUFFER"){l.promiseResolver(n.data);return}break;case"EXPORT_FILE_STATISTICS":if(n.type=="FILE_STATISTICS"){l.promiseResolver(n.data);return}break;case"CONNECT":if(n.type=="CONNECTION_INFO"){l.promiseResolver(n.data);return}break;case"RUN_PREPARED":case"RUN_QUERY":if(n.type=="QUERY_RESULT"){l.promiseResolver(n.data);return}break;case"SEND_PREPARED":if(n.type=="QUERY_RESULT_HEADER"){l.promiseResolver(n.data);return}break;case"START_PENDING_QUERY":if(n.type=="QUERY_RESULT_HEADER_OR_NULL"){l.promiseResolver(n.data);return}break;case"POLL_PENDING_QUERY":if(n.type=="QUERY_RESULT_HEADER_OR_NULL"){l.promiseResolver(n.data);return}break;case"CANCEL_PENDING_QUERY":if(this._onInstantiationProgress=[],n.type=="SUCCESS"){l.promiseResolver(n.data);return}break;case"FETCH_QUERY_RESULTS":if(n.type=="QUERY_RESULT_CHUNK"){l.promiseResolver(n.data);return}break;case"CREATE_PREPARED":if(n.type=="PREPARED_STATEMENT_ID"){l.promiseResolver(n.data);return}break}l.promiseRejecter(new Error("unexpected response type: ".concat(n.type.toString())))}onError(i){console.error(i),console.error("error in duckdb worker: ".concat(i.message)),this._pendingRequests.clear()}onClose(){if(this._workerShutdownResolver(null),this._pendingRequests.size!=0){console.warn("worker terminated with ".concat(this._pendingRequests.size," pending requests"));return}this._pendingRequests.clear()}async reset(){let i=new Vr("RESET",null);return await this.postTask(i)}async ping(){let i=new Vr("PING",null);await this.postTask(i)}async dropFile(i){let e=new Vr("DROP_FILE",i);return await this.postTask(e)}async dropFiles(){let i=new Vr("DROP_FILES",null);return await this.postTask(i)}async flushFiles(){let i=new Vr("FLUSH_FILES",null);return await this.postTask(i)}async instantiate(i,e=null,n=l=>{}){this._onInstantiationProgress.push(n);let l=new Vr("INSTANTIATE",[i,e]);return await this.postTask(l)}async getVersion(){let i=new Vr("GET_VERSION",null);return await this.postTask(i)}async getFeatureFlags(){let i=new Vr("GET_FEATURE_FLAGS",null);return await this.postTask(i)}async open(i){let e=new Vr("OPEN",i);await this.postTask(e)}async tokenize(i){let e=new Vr("TOKENIZE",i);return await this.postTask(e)}async connectInternal(){let i=new Vr("CONNECT",null);return await this.postTask(i)}async connect(){let i=await this.connectInternal();return new OA(this,i)}async disconnect(i){let e=new Vr("DISCONNECT",i);await this.postTask(e)}async runQuery(i,e){let n=new Vr("RUN_QUERY",[i,e]);return await this.postTask(n)}async startPendingQuery(i,e){let n=new Vr("START_PENDING_QUERY",[i,e]);return await this.postTask(n)}async pollPendingQuery(i){let e=new Vr("POLL_PENDING_QUERY",i);return await this.postTask(e)}async cancelPendingQuery(i){let e=new Vr("CANCEL_PENDING_QUERY",i);return await this.postTask(e)}async fetchQueryResults(i){let e=new Vr("FETCH_QUERY_RESULTS",i);return await this.postTask(e)}async getTableNames(i,e){let n=new Vr("GET_TABLE_NAMES",[i,e]);return await this.postTask(n)}async createPrepared(i,e){let n=new Vr("CREATE_PREPARED",[i,e]);return await this.postTask(n)}async closePrepared(i,e){let n=new Vr("CLOSE_PREPARED",[i,e]);await this.postTask(n)}async runPrepared(i,e,n){let l=new Vr("RUN_PREPARED",[i,e,n]);return await this.postTask(l)}async sendPrepared(i,e,n){let l=new Vr("SEND_PREPARED",[i,e,n]);return await this.postTask(l)}async globFiles(i){let e=new Vr("GLOB_FILE_INFOS",i);return await this.postTask(e)}async registerFileText(i,e){let n=VA.encode(e);await this.registerFileBuffer(i,n)}async registerFileURL(i,e,n,l){e===void 0&&(e=i);let p=new Vr("REGISTER_FILE_URL",[i,e,n,l]);await this.postTask(p)}async registerEmptyFileBuffer(i){}async registerFileBuffer(i,e){let n=new Vr("REGISTER_FILE_BUFFER",[i,e]);await this.postTask(n,[e.buffer])}async registerFileHandle(i,e,n,l){let p=new Vr("REGISTER_FILE_HANDLE",[i,e,n,l]);await this.postTask(p,[])}async collectFileStatistics(i,e){let n=new Vr("COLLECT_FILE_STATISTICS",[i,e]);await this.postTask(n,[])}async exportFileStatistics(i){let e=new Vr("EXPORT_FILE_STATISTICS",i);return await this.postTask(e,[])}async copyFileToBuffer(i){let e=new Vr("COPY_FILE_TO_BUFFER",i);return await this.postTask(e)}async copyFileToPath(i,e){let n=new Vr("COPY_FILE_TO_PATH",[i,e]);await this.postTask(n)}async insertArrowFromIPCStream(i,e,n){if(e.length==0)return;let l=new Vr("INSERT_ARROW_FROM_IPC_STREAM",[i,e,n]);await this.postTask(l,[e.buffer])}async insertCSVFromPath(i,e,n){if(n.columns!==void 0){let p=[];for(let v in n.columns){let b=n.columns[v];p.push(Hg(v,b))}n.columnsFlat=p,delete n.columns}let l=new Vr("IMPORT_CSV_FROM_PATH",[i,e,n]);await this.postTask(l)}async insertJSONFromPath(i,e,n){if(n.columns!==void 0){let p=[];for(let v in n.columns){let b=n.columns[v];p.push(Hg(v,b))}n.columnsFlat=p,delete n.columns}let l=new Vr("IMPORT_JSON_FROM_PATH",[i,e,n]);await this.postTask(l)}},qA=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,3,1,0,1,10,14,1,12,0,65,0,65,0,65,0,252,10,0,0,11])),GA=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,8,1,6,0,6,64,25,11,11])),ZA=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),WA=()=>(async i=>{try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(i)}catch{return!1}})(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])),Vy={name:"@duckdb/duckdb-wasm",version:"1.29.0",description:"DuckDB powered by WebAssembly",license:"MIT",repository:{type:"git",url:"https://github.com/duckdb/duckdb-wasm.git"},keywords:["sql","duckdb","relational","database","data","query","wasm","analytics","olap","arrow","parquet","json","csv"],dependencies:{"apache-arrow":"^17.0.0"},devDependencies:{"@types/emscripten":"^1.39.10","@types/jasmine":"^5.1.4","@typescript-eslint/eslint-plugin":"^6.21.0","@typescript-eslint/parser":"^6.21.0",esbuild:"^0.20.2",eslint:"^8.57.0","eslint-plugin-jasmine":"^4.1.3","eslint-plugin-react":"^7.34.0","fast-glob":"^3.3.2",jasmine:"^5.1.0","jasmine-core":"^5.1.2","jasmine-spec-reporter":"^7.0.0","js-sha256":"^0.11.0",karma:"^6.4.2","karma-chrome-launcher":"^3.2.0","karma-coverage":"^2.2.1","karma-firefox-launcher":"^2.1.3","karma-jasmine":"^5.1.0","karma-jasmine-html-reporter":"^2.1.0","karma-sourcemap-loader":"^0.4.0","karma-spec-reporter":"^0.0.36","make-dir":"^4.0.0",nyc:"^15.1.0",prettier:"^3.2.5",puppeteer:"^22.8.0",rimraf:"^5.0.5",s3rver:"^3.7.1",typedoc:"^0.25.13",typescript:"^5.3.3","wasm-feature-detect":"^1.6.1","web-worker":"^1.2.0"},scripts:{"build:debug":"node bundle.mjs debug && tsc --emitDeclarationOnly","build:release":"node bundle.mjs release && tsc --emitDeclarationOnly",docs:"typedoc",report:"node ./coverage.mjs","test:node":"node --enable-source-maps ../../node_modules/jasmine/bin/jasmine ./dist/tests-node.cjs","test:node:debug":"node --inspect-brk --enable-source-maps ../../node_modules/jasmine/bin/jasmine ./dist/tests-node.cjs","test:node:coverage":"nyc -r json --report-dir ./coverage/node node ../../node_modules/jasmine/bin/jasmine ./dist/tests-node.cjs","test:firefox":"karma start ./karma/tests-firefox.cjs","test:chrome":"karma start ./karma/tests-chrome.cjs","test:chrome:eh":"karma start ./karma/tests-chrome-eh.cjs","test:chrome:coverage":"karma start ./karma/tests-chrome-coverage.cjs","test:browser":"karma start ./karma/tests-all.cjs","test:browser:debug":"karma start ./karma/tests-debug.cjs",test:"npm run test:chrome && npm run test:node","test:coverage":"npm run test:chrome:coverage && npm run test:node:coverage && npm run report",lint:"eslint src test"},files:["dist","!dist/tests-*","!dist/duckdb-browser-mvp.worker.js.map","!dist/types/test"],main:"dist/duckdb-browser.cjs",module:"dist/duckdb-browser.mjs",types:"dist/duckdb-browser.d.ts",jsdelivr:"dist/duckdb-browser.cjs",unpkg:"dist/duckdb-browser.mjs",sideEffects:!1,browser:{fs:!1,path:!1,perf_hooks:!1,os:!1,worker_threads:!1},exports:{"./dist/duckdb-mvp.wasm":"./dist/duckdb-mvp.wasm","./dist/duckdb-eh.wasm":"./dist/duckdb-eh.wasm","./dist/duckdb-coi.wasm":"./dist/duckdb-coi.wasm","./dist/duckdb-browser":"./dist/duckdb-browser.mjs","./dist/duckdb-browser.cjs":"./dist/duckdb-browser.cjs","./dist/duckdb-browser.mjs":"./dist/duckdb-browser.mjs","./dist/duckdb-browser-coi.pthread.worker.js":"./dist/duckdb-browser-coi.pthread.worker.js","./dist/duckdb-browser-coi.worker.js":"./dist/duckdb-browser-coi.worker.js","./dist/duckdb-browser-eh.worker.js":"./dist/duckdb-browser-eh.worker.js","./dist/duckdb-browser-mvp.worker.js":"./dist/duckdb-browser-mvp.worker.js","./dist/duckdb-node":"./dist/duckdb-node.cjs","./dist/duckdb-node.cjs":"./dist/duckdb-node.cjs","./dist/duckdb-node-blocking":"./dist/duckdb-node-blocking.cjs","./dist/duckdb-node-blocking.cjs":"./dist/duckdb-node-blocking.cjs","./dist/duckdb-node-eh.worker.cjs":"./dist/duckdb-node-eh.worker.cjs","./dist/duckdb-node-mvp.worker.cjs":"./dist/duckdb-node-mvp.worker.cjs","./blocking":{node:{types:"./dist/duckdb-node-blocking.d.ts",require:"./dist/duckdb-node-blocking.cjs",import:"./dist/duckdb-node-blocking.cjs"},types:"./dist/duckdb-node-blocking.d.ts",import:"./dist/duckdb-node-blocking.mjs",require:"./dist/duckdb-node-blocking.cjs"},".":{browser:{types:"./dist/duckdb-browser.d.ts",import:"./dist/duckdb-browser.mjs",require:"./dist/duckdb-browser.cjs"},node:{types:"./dist/duckdb-node.d.ts",import:"./dist/duckdb-node.cjs",require:"./dist/duckdb-node.cjs"},types:"./dist/duckdb-browser.d.ts",import:"./dist/duckdb-browser.mjs",require:"./dist/duckdb-browser.cjs"}}},HA=Vy.name,YA=Vy.version,jy=Vy.version.split(".");jy[0];jy[1];jy[2];var KA=()=>typeof navigator>"u";function XA(){let i="https://cdn.jsdelivr.net/npm/".concat(HA,"@").concat(YA,"/dist/");return{mvp:{mainModule:"".concat(i,"duckdb-mvp.wasm"),mainWorker:"".concat(i,"duckdb-browser-mvp.worker.js")},eh:{mainModule:"".concat(i,"duckdb-eh.wasm"),mainWorker:"".concat(i,"duckdb-browser-eh.worker.js")}}}var _g=null,vg=null,bg=null,xg=null,wg=null;async function JA(){return _g==null&&(_g=typeof BigInt64Array<"u"),vg==null&&(vg=await GA()),bg==null&&(bg=await WA()),xg==null&&(xg=await ZA()),wg==null&&(wg=await qA()),{bigInt64Array:_g,crossOriginIsolated:KA()||globalThis.crossOriginIsolated||!1,wasmExceptions:vg,wasmSIMD:xg,wasmThreads:bg,wasmBulkMemory:wg}}async function QA(i){let e=await JA();if(e.wasmExceptions){if(e.wasmSIMD&&e.wasmThreads&&e.crossOriginIsolated&&i.coi)return{mainModule:i.coi.mainModule,mainWorker:i.coi.mainWorker,pthreadWorker:i.coi.pthreadWorker};if(i.eh)return{mainModule:i.eh.mainModule,mainWorker:i.eh.mainWorker,pthreadWorker:null}}return{mainModule:i.mvp.mainModule,mainWorker:i.mvp.mainWorker,pthreadWorker:null}}EA(CA());function eE(){let i=new TextDecoder;return e=>(typeof SharedArrayBuffer<"u"&&e.buffer instanceof SharedArrayBuffer&&(e=new Uint8Array(e)),i.decode(e))}eE();var tE=(i=>(i[i.BUFFER=0]="BUFFER",i[i.NODE_FS=1]="NODE_FS",i[i.BROWSER_FILEREADER=2]="BROWSER_FILEREADER",i[i.BROWSER_FSACCESS=3]="BROWSER_FSACCESS",i[i.HTTP=4]="HTTP",i[i.S3=5]="S3",i))(tE||{});class rE{constructor(){cg(this,"inner");this.inner=null}async initialise(){const e=XA(),n=await QA(e),l=URL.createObjectURL(new Blob([`importScripts("${n.mainWorker}");`],{type:"text/javascript"})),p=new Worker(l),v=new RA,b=new jA(v,p);await b.instantiate(n.mainModule,n.pthreadWorker),URL.revokeObjectURL(l),this.inner=b}unset(){this.inner=null}isLoaded(){return this.inner!=null}async getMetrics(e){if(!this.inner)throw new Error("DuckDBBackend not initialised");const n=await this.inner.connect(),p=(await n.query(`INSTALL httpfs; LOAD httpfs; ${e}`)).toArray().map(v=>v.toJSON());return console.log(p),await n.close(),p}}jp(rE);const Yg=hi(null),U1=hi(null),Kp=hi({kind:"title"}),Kg=hi([]),Ap=hi(""),Xg=hi(""),Pl=hi([]),Ep=hi([]),Bv=hi({}),qy=hi([]),Gy=hi("pmtiles://https://popgetter.blob.core.windows.net/dev/v0.2/usa/geometries/tract_2019.pmtiles"),Zy="-",iE=i=>{const e=sE(i),{conflictingClassGroups:n,conflictingClassGroupModifiers:l}=i;return{getClassGroupId:b=>{const c=b.split(Zy);return c[0]===""&&c.length!==1&&c.shift(),$1(c,e)||nE(b)},getConflictingClassGroupIds:(b,c)=>{const E=n[b]||[];return c&&l[b]?[...E,...l[b]]:E}}},$1=(i,e)=>{var b;if(i.length===0)return e.classGroupId;const n=i[0],l=e.nextPart.get(n),p=l?$1(i.slice(1),l):void 0;if(p)return p;if(e.validators.length===0)return;const v=i.join(Zy);return(b=e.validators.find(({validator:c})=>c(v)))==null?void 0:b.classGroupId},Rv=/^\[(.+)\]$/,nE=i=>{if(Rv.test(i)){const e=Rv.exec(i)[1],n=e==null?void 0:e.substring(0,e.indexOf(":"));if(n)return"arbitrary.."+n}},sE=i=>{const{theme:e,prefix:n}=i,l={nextPart:new Map,validators:[]};return oE(Object.entries(i.classGroups),n).forEach(([v,b])=>{Jg(b,l,v,e)}),l},Jg=(i,e,n,l)=>{i.forEach(p=>{if(typeof p=="string"){const v=p===""?e:Fv(e,p);v.classGroupId=n;return}if(typeof p=="function"){if(aE(p)){Jg(p(l),e,n,l);return}e.validators.push({validator:p,classGroupId:n});return}Object.entries(p).forEach(([v,b])=>{Jg(b,Fv(e,v),n,l)})})},Fv=(i,e)=>{let n=i;return e.split(Zy).forEach(l=>{n.nextPart.has(l)||n.nextPart.set(l,{nextPart:new Map,validators:[]}),n=n.nextPart.get(l)}),n},aE=i=>i.isThemeGetter,oE=(i,e)=>e?i.map(([n,l])=>{const p=l.map(v=>typeof v=="string"?e+v:typeof v=="object"?Object.fromEntries(Object.entries(v).map(([b,c])=>[e+b,c])):v);return[n,p]}):i,lE=i=>{if(i<1)return{get:()=>{},set:()=>{}};let e=0,n=new Map,l=new Map;const p=(v,b)=>{n.set(v,b),e++,e>i&&(e=0,l=n,n=new Map)};return{get(v){let b=n.get(v);if(b!==void 0)return b;if((b=l.get(v))!==void 0)return p(v,b),b},set(v,b){n.has(v)?n.set(v,b):p(v,b)}}},V1="!",cE=i=>{const{separator:e,experimentalParseClassName:n}=i,l=e.length===1,p=e[0],v=e.length,b=c=>{const E=[];let T=0,z=0,B;for(let ie=0;ie<c.length;ie++){let Y=c[ie];if(T===0){if(Y===p&&(l||c.slice(ie,ie+v)===e)){E.push(c.slice(z,ie)),z=ie+v;continue}if(Y==="/"){B=ie;continue}}Y==="["?T++:Y==="]"&&T--}const $=E.length===0?c:c.substring(z),q=$.startsWith(V1),Q=q?$.substring(1):$,ae=B&&B>z?B-z:void 0;return{modifiers:E,hasImportantModifier:q,baseClassName:Q,maybePostfixModifierPosition:ae}};return n?c=>n({className:c,parseClassName:b}):b},uE=i=>{if(i.length<=1)return i;const e=[];let n=[];return i.forEach(l=>{l[0]==="["?(e.push(...n.sort(),l),n=[]):n.push(l)}),e.push(...n.sort()),e},hE=i=>({cache:lE(i.cacheSize),parseClassName:cE(i),...iE(i)}),dE=/\s+/,fE=(i,e)=>{const{parseClassName:n,getClassGroupId:l,getConflictingClassGroupIds:p}=e,v=[],b=i.trim().split(dE);let c="";for(let E=b.length-1;E>=0;E-=1){const T=b[E],{modifiers:z,hasImportantModifier:B,baseClassName:$,maybePostfixModifierPosition:q}=n(T);let Q=!!q,ae=l(Q?$.substring(0,q):$);if(!ae){if(!Q){c=T+(c.length>0?" "+c:c);continue}if(ae=l($),!ae){c=T+(c.length>0?" "+c:c);continue}Q=!1}const ie=uE(z).join(":"),Y=B?ie+V1:ie,be=Y+ae;if(v.includes(be))continue;v.push(be);const fe=p(ae,Q);for(let de=0;de<fe.length;++de){const Se=fe[de];v.push(Y+Se)}c=T+(c.length>0?" "+c:c)}return c};function Wy(){let i=0,e,n,l="";for(;i<arguments.length;)(e=arguments[i++])&&(n=j1(e))&&(l&&(l+=" "),l+=n);return l}const j1=i=>{if(typeof i=="string")return i;let e,n="";for(let l=0;l<i.length;l++)i[l]&&(e=j1(i[l]))&&(n&&(n+=" "),n+=e);return n};function pE(i,...e){let n,l,p,v=b;function b(E){const T=e.reduce((z,B)=>B(z),i());return n=hE(T),l=n.cache.get,p=n.cache.set,v=c,c(E)}function c(E){const T=l(E);if(T)return T;const z=fE(E,n);return p(E,z),z}return function(){return v(Wy.apply(null,arguments))}}const Ai=i=>{const e=n=>n[i]||[];return e.isThemeGetter=!0,e},q1=/^\[(?:([a-z-]+):)?(.+)\]$/i,mE=/^\d+\/\d+$/,gE=new Set(["px","full","screen"]),yE=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,_E=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,vE=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,bE=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,xE=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,ao=i=>Wc(i)||gE.has(i)||mE.test(i),$o=i=>cu(i,"length",CE),Wc=i=>!!i&&!Number.isNaN(Number(i)),Sg=i=>cu(i,"number",Wc),vh=i=>!!i&&Number.isInteger(Number(i)),wE=i=>i.endsWith("%")&&Wc(i.slice(0,-1)),wr=i=>q1.test(i),Vo=i=>yE.test(i),SE=new Set(["length","size","percentage"]),IE=i=>cu(i,SE,G1),TE=i=>cu(i,"position",G1),kE=new Set(["image","url"]),AE=i=>cu(i,kE,DE),EE=i=>cu(i,"",ME),bh=()=>!0,cu=(i,e,n)=>{const l=q1.exec(i);return l?l[1]?typeof e=="string"?l[1]===e:e.has(l[1]):n(l[2]):!1},CE=i=>_E.test(i)&&!vE.test(i),G1=()=>!1,ME=i=>bE.test(i),DE=i=>xE.test(i),PE=()=>{const i=Ai("colors"),e=Ai("spacing"),n=Ai("blur"),l=Ai("brightness"),p=Ai("borderColor"),v=Ai("borderRadius"),b=Ai("borderSpacing"),c=Ai("borderWidth"),E=Ai("contrast"),T=Ai("grayscale"),z=Ai("hueRotate"),B=Ai("invert"),$=Ai("gap"),q=Ai("gradientColorStops"),Q=Ai("gradientColorStopPositions"),ae=Ai("inset"),ie=Ai("margin"),Y=Ai("opacity"),be=Ai("padding"),fe=Ai("saturate"),de=Ai("scale"),Se=Ai("sepia"),Me=Ai("skew"),Ge=Ai("space"),Ee=Ai("translate"),Ve=()=>["auto","contain","none"],De=()=>["auto","hidden","clip","visible","scroll"],qe=()=>["auto",wr,e],Ze=()=>[wr,e],Pe=()=>["",ao,$o],$e=()=>["auto",Wc,wr],We=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Je=()=>["solid","dashed","dotted","double","none"],gt=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Ne=()=>["start","end","center","between","around","evenly","stretch"],ht=()=>["","0",wr],_t=()=>["auto","avoid","all","avoid-page","page","left","right","column"],er=()=>[Wc,wr];return{cacheSize:500,separator:":",theme:{colors:[bh],spacing:[ao,$o],blur:["none","",Vo,wr],brightness:er(),borderColor:[i],borderRadius:["none","","full",Vo,wr],borderSpacing:Ze(),borderWidth:Pe(),contrast:er(),grayscale:ht(),hueRotate:er(),invert:ht(),gap:Ze(),gradientColorStops:[i],gradientColorStopPositions:[wE,$o],inset:qe(),margin:qe(),opacity:er(),padding:Ze(),saturate:er(),scale:er(),sepia:ht(),skew:er(),space:Ze(),translate:Ze()},classGroups:{aspect:[{aspect:["auto","square","video",wr]}],container:["container"],columns:[{columns:[Vo]}],"break-after":[{"break-after":_t()}],"break-before":[{"break-before":_t()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...We(),wr]}],overflow:[{overflow:De()}],"overflow-x":[{"overflow-x":De()}],"overflow-y":[{"overflow-y":De()}],overscroll:[{overscroll:Ve()}],"overscroll-x":[{"overscroll-x":Ve()}],"overscroll-y":[{"overscroll-y":Ve()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[ae]}],"inset-x":[{"inset-x":[ae]}],"inset-y":[{"inset-y":[ae]}],start:[{start:[ae]}],end:[{end:[ae]}],top:[{top:[ae]}],right:[{right:[ae]}],bottom:[{bottom:[ae]}],left:[{left:[ae]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",vh,wr]}],basis:[{basis:qe()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",wr]}],grow:[{grow:ht()}],shrink:[{shrink:ht()}],order:[{order:["first","last","none",vh,wr]}],"grid-cols":[{"grid-cols":[bh]}],"col-start-end":[{col:["auto",{span:["full",vh,wr]},wr]}],"col-start":[{"col-start":$e()}],"col-end":[{"col-end":$e()}],"grid-rows":[{"grid-rows":[bh]}],"row-start-end":[{row:["auto",{span:[vh,wr]},wr]}],"row-start":[{"row-start":$e()}],"row-end":[{"row-end":$e()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",wr]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",wr]}],gap:[{gap:[$]}],"gap-x":[{"gap-x":[$]}],"gap-y":[{"gap-y":[$]}],"justify-content":[{justify:["normal",...Ne()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Ne(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Ne(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[be]}],px:[{px:[be]}],py:[{py:[be]}],ps:[{ps:[be]}],pe:[{pe:[be]}],pt:[{pt:[be]}],pr:[{pr:[be]}],pb:[{pb:[be]}],pl:[{pl:[be]}],m:[{m:[ie]}],mx:[{mx:[ie]}],my:[{my:[ie]}],ms:[{ms:[ie]}],me:[{me:[ie]}],mt:[{mt:[ie]}],mr:[{mr:[ie]}],mb:[{mb:[ie]}],ml:[{ml:[ie]}],"space-x":[{"space-x":[Ge]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[Ge]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",wr,e]}],"min-w":[{"min-w":[wr,e,"min","max","fit"]}],"max-w":[{"max-w":[wr,e,"none","full","min","max","fit","prose",{screen:[Vo]},Vo]}],h:[{h:[wr,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[wr,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[wr,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[wr,e,"auto","min","max","fit"]}],"font-size":[{text:["base",Vo,$o]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Sg]}],"font-family":[{font:[bh]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",wr]}],"line-clamp":[{"line-clamp":["none",Wc,Sg]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",ao,wr]}],"list-image":[{"list-image":["none",wr]}],"list-style-type":[{list:["none","disc","decimal",wr]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[i]}],"placeholder-opacity":[{"placeholder-opacity":[Y]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[i]}],"text-opacity":[{"text-opacity":[Y]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Je(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",ao,$o]}],"underline-offset":[{"underline-offset":["auto",ao,wr]}],"text-decoration-color":[{decoration:[i]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Ze()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",wr]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",wr]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[Y]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...We(),TE]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",IE]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},AE]}],"bg-color":[{bg:[i]}],"gradient-from-pos":[{from:[Q]}],"gradient-via-pos":[{via:[Q]}],"gradient-to-pos":[{to:[Q]}],"gradient-from":[{from:[q]}],"gradient-via":[{via:[q]}],"gradient-to":[{to:[q]}],rounded:[{rounded:[v]}],"rounded-s":[{"rounded-s":[v]}],"rounded-e":[{"rounded-e":[v]}],"rounded-t":[{"rounded-t":[v]}],"rounded-r":[{"rounded-r":[v]}],"rounded-b":[{"rounded-b":[v]}],"rounded-l":[{"rounded-l":[v]}],"rounded-ss":[{"rounded-ss":[v]}],"rounded-se":[{"rounded-se":[v]}],"rounded-ee":[{"rounded-ee":[v]}],"rounded-es":[{"rounded-es":[v]}],"rounded-tl":[{"rounded-tl":[v]}],"rounded-tr":[{"rounded-tr":[v]}],"rounded-br":[{"rounded-br":[v]}],"rounded-bl":[{"rounded-bl":[v]}],"border-w":[{border:[c]}],"border-w-x":[{"border-x":[c]}],"border-w-y":[{"border-y":[c]}],"border-w-s":[{"border-s":[c]}],"border-w-e":[{"border-e":[c]}],"border-w-t":[{"border-t":[c]}],"border-w-r":[{"border-r":[c]}],"border-w-b":[{"border-b":[c]}],"border-w-l":[{"border-l":[c]}],"border-opacity":[{"border-opacity":[Y]}],"border-style":[{border:[...Je(),"hidden"]}],"divide-x":[{"divide-x":[c]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[c]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[Y]}],"divide-style":[{divide:Je()}],"border-color":[{border:[p]}],"border-color-x":[{"border-x":[p]}],"border-color-y":[{"border-y":[p]}],"border-color-s":[{"border-s":[p]}],"border-color-e":[{"border-e":[p]}],"border-color-t":[{"border-t":[p]}],"border-color-r":[{"border-r":[p]}],"border-color-b":[{"border-b":[p]}],"border-color-l":[{"border-l":[p]}],"divide-color":[{divide:[p]}],"outline-style":[{outline:["",...Je()]}],"outline-offset":[{"outline-offset":[ao,wr]}],"outline-w":[{outline:[ao,$o]}],"outline-color":[{outline:[i]}],"ring-w":[{ring:Pe()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[i]}],"ring-opacity":[{"ring-opacity":[Y]}],"ring-offset-w":[{"ring-offset":[ao,$o]}],"ring-offset-color":[{"ring-offset":[i]}],shadow:[{shadow:["","inner","none",Vo,EE]}],"shadow-color":[{shadow:[bh]}],opacity:[{opacity:[Y]}],"mix-blend":[{"mix-blend":[...gt(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":gt()}],filter:[{filter:["","none"]}],blur:[{blur:[n]}],brightness:[{brightness:[l]}],contrast:[{contrast:[E]}],"drop-shadow":[{"drop-shadow":["","none",Vo,wr]}],grayscale:[{grayscale:[T]}],"hue-rotate":[{"hue-rotate":[z]}],invert:[{invert:[B]}],saturate:[{saturate:[fe]}],sepia:[{sepia:[Se]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[n]}],"backdrop-brightness":[{"backdrop-brightness":[l]}],"backdrop-contrast":[{"backdrop-contrast":[E]}],"backdrop-grayscale":[{"backdrop-grayscale":[T]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[z]}],"backdrop-invert":[{"backdrop-invert":[B]}],"backdrop-opacity":[{"backdrop-opacity":[Y]}],"backdrop-saturate":[{"backdrop-saturate":[fe]}],"backdrop-sepia":[{"backdrop-sepia":[Se]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[b]}],"border-spacing-x":[{"border-spacing-x":[b]}],"border-spacing-y":[{"border-spacing-y":[b]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",wr]}],duration:[{duration:er()}],ease:[{ease:["linear","in","out","in-out",wr]}],delay:[{delay:er()}],animate:[{animate:["none","spin","ping","pulse","bounce",wr]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[de]}],"scale-x":[{"scale-x":[de]}],"scale-y":[{"scale-y":[de]}],rotate:[{rotate:[vh,wr]}],"translate-x":[{"translate-x":[Ee]}],"translate-y":[{"translate-y":[Ee]}],"skew-x":[{"skew-x":[Me]}],"skew-y":[{"skew-y":[Me]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",wr]}],accent:[{accent:["auto",i]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",wr]}],"caret-color":[{caret:[i]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Ze()}],"scroll-mx":[{"scroll-mx":Ze()}],"scroll-my":[{"scroll-my":Ze()}],"scroll-ms":[{"scroll-ms":Ze()}],"scroll-me":[{"scroll-me":Ze()}],"scroll-mt":[{"scroll-mt":Ze()}],"scroll-mr":[{"scroll-mr":Ze()}],"scroll-mb":[{"scroll-mb":Ze()}],"scroll-ml":[{"scroll-ml":Ze()}],"scroll-p":[{"scroll-p":Ze()}],"scroll-px":[{"scroll-px":Ze()}],"scroll-py":[{"scroll-py":Ze()}],"scroll-ps":[{"scroll-ps":Ze()}],"scroll-pe":[{"scroll-pe":Ze()}],"scroll-pt":[{"scroll-pt":Ze()}],"scroll-pr":[{"scroll-pr":Ze()}],"scroll-pb":[{"scroll-pb":Ze()}],"scroll-pl":[{"scroll-pl":Ze()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",wr]}],fill:[{fill:[i,"none"]}],"stroke-w":[{stroke:[ao,$o,Sg]}],stroke:[{stroke:[i,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},Ur=pE(PE),LE=i=>i;function Z1(i){const e=i-1;return e*e*e+1}function zE(i){return i<.5?4*i*i*i:.5*Math.pow(2*i-2,3)+1}function Qg(i){const e=typeof i=="string"&&i.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return e?[parseFloat(e[1]),e[2]||"px"]:[i,"px"]}function BE(i,{delay:e=0,duration:n=400,easing:l=zE,amount:p=5,opacity:v=0}={}){const b=getComputedStyle(i),c=+b.opacity,E=b.filter==="none"?"":b.filter,T=c*(1-v),[z,B]=Qg(p);return{delay:e,duration:n,easing:l,css:($,q)=>`opacity: ${c-T*q}; filter: ${E} blur(${q*z}${B});`}}function RE(i,{delay:e=0,duration:n=400,easing:l=LE}={}){const p=+getComputedStyle(i).opacity;return{delay:e,duration:n,easing:l,css:v=>`opacity: ${v*p}`}}function FE(i,{delay:e=0,duration:n=400,easing:l=Z1,x:p=0,y:v=0,opacity:b=0}={}){const c=getComputedStyle(i),E=+c.opacity,T=c.transform==="none"?"":c.transform,z=E*(1-b),[B,$]=Qg(p),[q,Q]=Qg(v);return{delay:e,duration:n,easing:l,css:(ae,ie)=>`
			transform: ${T} translate(${(1-ae)*B}${$}, ${(1-ae)*q}${Q});
			opacity: ${E-z*ie}`}}function OE(i,{delay:e=0,duration:n=400,easing:l=Z1,axis:p="y"}={}){const v=getComputedStyle(i),b=+v.opacity,c=p==="y"?"height":"width",E=parseFloat(v[c]),T=p==="y"?["top","bottom"]:["left","right"],z=T.map(Y=>`${Y[0].toUpperCase()}${Y.slice(1)}`),B=parseFloat(v[`padding${z[0]}`]),$=parseFloat(v[`padding${z[1]}`]),q=parseFloat(v[`margin${z[0]}`]),Q=parseFloat(v[`margin${z[1]}`]),ae=parseFloat(v[`border${z[0]}Width`]),ie=parseFloat(v[`border${z[1]}Width`]);return{delay:e,duration:n,easing:l,css:Y=>`overflow: hidden;opacity: ${Math.min(Y*20,1)*b};${c}: ${Y*E}px;padding-${T[0]}: ${Y*B}px;padding-${T[1]}: ${Y*$}px;margin-${T[0]}: ${Y*q}px;margin-${T[1]}: ${Y*Q}px;border-${T[0]}-width: ${Y*ae}px;border-${T[1]}-width: ${Y*ie}px;`}}const NE={gray:"bg-gray-50 dark:bg-gray-800",red:"bg-red-50 dark:bg-gray-800",yellow:"bg-yellow-50 dark:bg-gray-800 ",green:"bg-green-50 dark:bg-gray-800 ",indigo:"bg-indigo-50 dark:bg-gray-800 ",purple:"bg-purple-50 dark:bg-gray-800 ",pink:"bg-pink-50 dark:bg-gray-800 ",blue:"bg-blue-50 dark:bg-gray-800 ",light:"bg-gray-50 dark:bg-gray-700",dark:"bg-gray-50 dark:bg-gray-800",default:"bg-white dark:bg-gray-800",dropdown:"bg-white dark:bg-gray-700",navbar:"bg-white dark:bg-gray-900",navbarUl:"bg-gray-50 dark:bg-gray-800",form:"bg-gray-50 dark:bg-gray-700",primary:"bg-primary-50 dark:bg-gray-800 ",orange:"bg-orange-50 dark:bg-orange-800",none:""};function UE(i,e){const n=ur(e,["children","$$slots","$$events","$$legacy"]),l=ur(n,["tag","color","rounded","border","shadow","node","use","options","role","transition","params","open"]);Dr(e,!1);const p=()=>{};jn("background",!0);let v=oe(e,"tag",8,()=>l.href?"a":"div"),b=oe(e,"color",4,"default"),c=oe(e,"rounded",0,!1),E=oe(e,"border",0,!1),T=oe(e,"shadow",0,!1),z=oe(e,"node",12,()=>{}),B=oe(e,"use",0,p),$=oe(e,"options",8,()=>({})),q=oe(e,"role",8,()=>{}),Q=oe(e,"transition",8,()=>{}),ae=oe(e,"params",8,()=>({})),ie=oe(e,"open",0,!0);const Y=Yh(),be={gray:"text-gray-800 dark:text-gray-300",red:"text-red-800 dark:text-red-400",yellow:"text-yellow-800 dark:text-yellow-300",green:"text-green-800 dark:text-green-400",indigo:"text-indigo-800 dark:text-indigo-400",purple:"text-purple-800 dark:text-purple-400",pink:"text-pink-800 dark:text-pink-400",blue:"text-blue-800 dark:text-blue-400",light:"text-gray-700 dark:text-gray-300",dark:"text-gray-700 dark:text-gray-300",default:"text-gray-500 dark:text-gray-400",dropdown:"text-gray-700 dark:text-gray-200",navbar:"text-gray-700 dark:text-gray-200",navbarUl:"text-gray-700 dark:text-gray-400",form:"text-gray-900 dark:text-white",primary:"text-primary-800 dark:text-primary-400",orange:"text-orange-800 dark:text-orange-400",none:""},fe={gray:"border-gray-300 dark:border-gray-800 divide-gray-300 dark:divide-gray-800",red:"border-red-300 dark:border-red-800 divide-red-300 dark:divide-red-800",yellow:"border-yellow-300 dark:border-yellow-800 divide-yellow-300 dark:divide-yellow-800",green:"border-green-300 dark:border-green-800 divide-green-300 dark:divide-green-800",indigo:"border-indigo-300 dark:border-indigo-800 divide-indigo-300 dark:divide-indigo-800",purple:"border-purple-300 dark:border-purple-800 divide-purple-300 dark:divide-purple-800",pink:"border-pink-300 dark:border-pink-800 divide-pink-300 dark:divide-pink-800",blue:"border-blue-300 dark:border-blue-800 divide-blue-300 dark:divide-blue-800",light:"border-gray-500 divide-gray-500",dark:"border-gray-500 divide-gray-500",default:"border-gray-200 dark:border-gray-700 divide-gray-200 dark:divide-gray-700",dropdown:"border-gray-100 dark:border-gray-600 divide-gray-100 dark:divide-gray-600",navbar:"border-gray-100 dark:border-gray-700 divide-gray-100 dark:divide-gray-700",navbarUl:"border-gray-100 dark:border-gray-700 divide-gray-100 dark:divide-gray-700",form:"border-gray-300 dark:border-gray-700 divide-gray-300 dark:divide-gray-700",primary:"border-primary-500 dark:border-primary-200  divide-primary-500 dark:divide-primary-200 ",orange:"border-orange-300 dark:border-orange-800 divide-orange-300 dark:divide-orange-800",none:""};let de=xt();bt(()=>ze(ie()),()=>{Y(ie()?"open":"close")}),bt(()=>ze(ie()),()=>{Y("show",ie())}),bt(()=>ze(b()),()=>{b(b()??"default")}),bt(()=>ze(b()),()=>{jn("color",b())}),bt(()=>(ze(b()),ze(c()),ze(E()),ze(T()),ze(n)),()=>{ot(de,Ur(NE[b()],be[b()],c()&&"rounded-lg",E()&&"border",fe[b()],T()&&"shadow-md",n.class))}),gi(),Lr();var Se=rr(),Me=mt(Se);hr(Me,()=>Q()&&ie(),Ge=>{var Ee=rr(),Ve=mt(Ee);Fh(Ve,v,!1,(De,qe)=>{Wo(De,We=>z(We),()=>z());let Ze;Ct(()=>Ze=Oh(De,Ze,{role:q(),...l,class:ue(de)},"")),Ab(3,De,Q,ae),Ho(De,(We,Je)=>B()(We,Je),$),Qe("click",De,function(We){Xe.call(this,e,We)}),Qe("mouseenter",De,function(We){Xe.call(this,e,We)}),Qe("mouseleave",De,function(We){Xe.call(this,e,We)}),Qe("focusin",De,function(We){Xe.call(this,e,We)}),Qe("focusout",De,function(We){Xe.call(this,e,We)});var Pe=rr(),$e=mt(Pe);cr($e,Zr(e),{},null),xe(qe,Pe)}),xe(Ge,Ee)},Ge=>{var Ee=rr(),Ve=mt(Ee);hr(Ve,ie,De=>{var qe=rr(),Ze=mt(qe);Fh(Ze,v,!1,(Pe,$e)=>{Wo(Pe,Ne=>z(Ne),()=>z());let We;Ct(()=>We=Oh(Pe,We,{role:q(),...l,class:ue(de)},"")),Ho(Pe,(Ne,ht)=>B()(Ne,ht),$),Qe("click",Pe,function(Ne){Xe.call(this,e,Ne)}),Qe("mouseenter",Pe,function(Ne){Xe.call(this,e,Ne)}),Qe("mouseleave",Pe,function(Ne){Xe.call(this,e,Ne)}),Qe("focusin",Pe,function(Ne){Xe.call(this,e,Ne)}),Qe("focusout",Pe,function(Ne){Xe.call(this,e,Ne)});var Je=rr(),gt=mt(Je);cr(gt,Zr(e),{},null),xe($e,Je)}),xe(De,qe)},null,!0),xe(Ge,Ee)}),xe(i,Se),Pr()}var $E=rt('<span class="sr-only"> </span>'),VE=rt("<a><!> <!></a>"),jE=rt('<span class="sr-only"> </span>'),qE=rt("<button><!> <!></button>");function GE(i,e){const n=ur(e,["children","$$slots","$$events","$$legacy"]),l=ur(n,["color","name","ariaLabel","size","href"]);Dr(e,!1);let p=oe(e,"color",0,"default"),v=oe(e,"name",8,()=>{}),b=oe(e,"ariaLabel",8,()=>{}),c=oe(e,"size",0,"md"),E=oe(e,"href",8,()=>{});const T=$i("background"),z={dark:"text-gray-500 hover:text-gray-900 hover:bg-gray-200 dark:text-gray-400 dark:hover:text-white dark:hover:bg-gray-600",gray:"text-gray-500 focus:ring-gray-400 hover:bg-gray-200 dark:hover:bg-gray-800 dark:hover:text-gray-300",red:"text-red-500 focus:ring-red-400 hover:bg-red-200 dark:hover:bg-red-800 dark:hover:text-red-300",yellow:"text-yellow-500 focus:ring-yellow-400 hover:bg-yellow-200 dark:hover:bg-yellow-800 dark:hover:text-yellow-300",green:"text-green-500 focus:ring-green-400 hover:bg-green-200 dark:hover:bg-green-800 dark:hover:text-green-300",indigo:"text-indigo-500 focus:ring-indigo-400 hover:bg-indigo-200 dark:hover:bg-indigo-800 dark:hover:text-indigo-300",purple:"text-purple-500 focus:ring-purple-400 hover:bg-purple-200 dark:hover:bg-purple-800 dark:hover:text-purple-300",pink:"text-pink-500 focus:ring-pink-400 hover:bg-pink-200 dark:hover:bg-pink-800 dark:hover:text-pink-300",blue:"text-blue-500 focus:ring-blue-400 hover:bg-blue-200 dark:hover:bg-blue-800 dark:hover:text-blue-300",primary:"text-primary-500 focus:ring-primary-400 hover:bg-primary-200 dark:hover:bg-primary-800 dark:hover:text-primary-300",default:"focus:ring-gray-400 hover:bg-gray-100"},B={xs:"m-0.5 rounded-sm focus:ring-1 p-0.5",sm:"m-0.5 rounded focus:ring-1 p-0.5",md:"m-0.5 rounded-lg focus:ring-2 p-1.5",lg:"m-0.5 rounded-lg focus:ring-2 p-2.5"};let $=xt();const q={xs:"w-3 h-3",sm:"w-3.5 h-3.5",md:"w-5 h-5",lg:"w-5 h-5"};bt(()=>(ze(c()),ze(p()),ze(n)),()=>{ot($,Ur("focus:outline-none whitespace-normal",B[c()],z[p()],p()==="default"&&(T?"dark:hover:bg-gray-600":"dark:hover:bg-gray-700"),n.class))}),gi(),Lr();var Q=rr(),ae=mt(Q);hr(ae,E,ie=>{var Y=VE();let be;var fe=ct(Y);hr(fe,v,Se=>{var Me=$E(),Ge=ct(Me);ut(Me),Ct(()=>Ei(Ge,v())),xe(Se,Me)});var de=Ae(Ae(fe,!0));cr(de,Zr(e),{get svgSize(){return q[c()]}},null),ut(Y),Ct(()=>be=ji(Y,be,{href:E(),...l,class:ue($),"aria-label":b()??v()},!0,"")),xe(ie,Y)},ie=>{var Y=qE();let be;var fe=ct(Y);hr(fe,v,Se=>{var Me=jE(),Ge=ct(Me);ut(Me),Ct(()=>Ei(Ge,v())),xe(Se,Me)});var de=Ae(Ae(fe,!0));cr(de,Zr(e),{get svgSize(){return q[c()]}},null),ut(Y),Ct(()=>be=ji(Y,be,{type:"button",...l,class:ue($),"aria-label":b()??v()},!0,"")),Qe("click",Y,function(Se){Xe.call(this,e,Se)}),xe(ie,Y)}),xe(i,Q),Pr()}var ZE=ss('<svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>');function W1(i,e){const n=ur(e,["children","$$slots","$$events","$$legacy"]),l=ur(n,["name"]);Dr(e,!1);let p=oe(e,"name",0,"Close");Lr();var v=Kc(()=>Ur("ms-auto",n.class));GE(i,dy({get name(){return p()}},()=>l,{get class(){return ue(v)},$$events:{click(b){Xe.call(this,e,b)}},children:eI,$$slots:{default:(b,c)=>{const E=Kc(()=>c.svgSize);var T=ZE();ct(T),ut(T),Ct(()=>Sb(T,ue(E))),xe(b,T)}},$$legacy:!0})),Pr()}var WE=rt("<a><!></a>"),HE=rt("<button><!></button>");function da(i,e){const n=ur(e,["children","$$slots","$$events","$$legacy"]),l=ur(n,["pill","outline","size","href","type","color","shadow","tag","checked","disabled"]);Dr(e,!1);const p=$i("group");let v=oe(e,"pill",0,!1),b=oe(e,"outline",0,!1),c=oe(e,"size",0,p?"sm":"md"),E=oe(e,"href",8,()=>{}),T=oe(e,"type",0,"button"),z=oe(e,"color",8,()=>p?b()?"dark":"alternative":"primary"),B=oe(e,"shadow",0,!1),$=oe(e,"tag",0,"button"),q=oe(e,"checked",8,()=>{}),Q=oe(e,"disabled",0,!1);const ae={alternative:"text-gray-900 bg-white border border-gray-200 hover:bg-gray-100 dark:bg-gray-800 dark:text-gray-400 hover:text-primary-700 focus-within:text-primary-700 dark:focus-within:text-white dark:hover:text-white dark:hover:bg-gray-700",blue:"text-white bg-blue-700 hover:bg-blue-800 dark:bg-blue-600 dark:hover:bg-blue-700",dark:"text-white bg-gray-800 hover:bg-gray-900 dark:bg-gray-800 dark:hover:bg-gray-700",green:"text-white bg-green-700 hover:bg-green-800 dark:bg-green-600 dark:hover:bg-green-700",light:"text-gray-900 bg-white border border-gray-300 hover:bg-gray-100 dark:bg-gray-800 dark:text-white dark:border-gray-600 dark:hover:bg-gray-700 dark:hover:border-gray-600",primary:"text-white bg-primary-700 hover:bg-primary-800 dark:bg-primary-600 dark:hover:bg-primary-700",purple:"text-white bg-purple-700 hover:bg-purple-800 dark:bg-purple-600 dark:hover:bg-purple-700",red:"text-white bg-red-700 hover:bg-red-800 dark:bg-red-600 dark:hover:bg-red-700",yellow:"text-white bg-yellow-400 hover:bg-yellow-500 ",none:""},ie={alternative:"text-primary-700 border dark:text-primary-500 bg-gray-100 dark:bg-gray-700 border-gray-300 shadow-gray-300 dark:shadow-gray-800 shadow-inner",blue:"text-blue-900 bg-blue-400 dark:bg-blue-500 shadow-blue-700 dark:shadow-blue-800 shadow-inner",dark:"text-white bg-gray-500 dark:bg-gray-600 shadow-gray-800 dark:shadow-gray-900 shadow-inner",green:"text-green-900 bg-green-400 dark:bg-green-500 shadow-green-700 dark:shadow-green-800 shadow-inner",light:"text-gray-900 bg-gray-100 border border-gray-300 dark:bg-gray-500 dark:text-gray-900 dark:border-gray-700 shadow-gray-300 dark:shadow-gray-700 shadow-inner",primary:"text-primary-900 bg-primary-400 dark:bg-primary-500 shadow-primary-700 dark:shadow-primary-800 shadow-inner",purple:"text-purple-900 bg-purple-400 dark:bg-purple-500 shadow-purple-700 dark:shadow-purple-800 shadow-inner",red:"text-red-900 bg-red-400 dark:bg-red-500 shadow-red-700 dark:shadow-red-800 shadow-inner",yellow:"text-yellow-900 bg-yellow-300 dark:bg-yellow-400 shadow-yellow-500 dark:shadow-yellow-700 shadow-inner",none:""},Y={alternative:"focus-within:ring-gray-200 dark:focus-within:ring-gray-700",blue:"focus-within:ring-blue-300 dark:focus-within:ring-blue-800",dark:"focus-within:ring-gray-300 dark:focus-within:ring-gray-700",green:"focus-within:ring-green-300 dark:focus-within:ring-green-800",light:"focus-within:ring-gray-200 dark:focus-within:ring-gray-700",primary:"focus-within:ring-primary-300 dark:focus-within:ring-primary-800",purple:"focus-within:ring-purple-300 dark:focus-within:ring-purple-900",red:"focus-within:ring-red-300 dark:focus-within:ring-red-900",yellow:"focus-within:ring-yellow-300 dark:focus-within:ring-yellow-900",none:""},be={alternative:"shadow-gray-500/50 dark:shadow-gray-800/80",blue:"shadow-blue-500/50 dark:shadow-blue-800/80",dark:"shadow-gray-500/50 dark:shadow-gray-800/80",green:"shadow-green-500/50 dark:shadow-green-800/80",light:"shadow-gray-500/50 dark:shadow-gray-800/80",primary:"shadow-primary-500/50 dark:shadow-primary-800/80",purple:"shadow-purple-500/50 dark:shadow-purple-800/80",red:"shadow-red-500/50 dark:shadow-red-800/80 ",yellow:"shadow-yellow-500/50 dark:shadow-yellow-800/80 ",none:""},fe={alternative:"text-gray-900 dark:text-gray-400 hover:text-white border border-gray-800 hover:bg-gray-900 focus-within:bg-gray-900 focus-within:text-white focus-within:ring-gray-300 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-600 dark:focus-within:ring-gray-800",blue:"text-blue-700 hover:text-white border border-blue-700 hover:bg-blue-800 dark:border-blue-500 dark:text-blue-500 dark:hover:text-white dark:hover:bg-blue-600",dark:"text-gray-900 hover:text-white border border-gray-800 hover:bg-gray-900 focus-within:bg-gray-900 focus-within:text-white dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-600",green:"text-green-700 hover:text-white border border-green-700 hover:bg-green-800 dark:border-green-500 dark:text-green-500 dark:hover:text-white dark:hover:bg-green-600",light:"text-gray-500 hover:text-gray-900 bg-white border border-gray-200 dark:border-gray-600 dark:hover:text-white dark:text-gray-400 hover:bg-gray-50 dark:bg-gray-700 dark:hover:bg-gray-600",primary:"text-primary-700 hover:text-white border border-primary-700 hover:bg-primary-700 dark:border-primary-500 dark:text-primary-500 dark:hover:text-white dark:hover:bg-primary-600",purple:"text-purple-700 hover:text-white border border-purple-700 hover:bg-purple-800 dark:border-purple-400 dark:text-purple-400 dark:hover:text-white dark:hover:bg-purple-500",red:"text-red-700 hover:text-white border border-red-700 hover:bg-red-800 dark:border-red-500 dark:text-red-500 dark:hover:text-white dark:hover:bg-red-600",yellow:"text-yellow-400 hover:text-white border border-yellow-400 hover:bg-yellow-500 dark:border-yellow-300 dark:text-yellow-300 dark:hover:text-white dark:hover:bg-yellow-400",none:""},de={xs:"px-3 py-2 text-xs",sm:"px-4 py-2 text-sm",md:"px-5 py-2.5 text-sm",lg:"px-5 py-3 text-base",xl:"px-6 py-3.5 text-base"},Se=()=>b()||z()==="alternative"||z()==="light";let Me=xt();bt(()=>(ze(c()),ze(b()),ze(q()),ze(z()),ze(v()),ze(B()),ze(Q()),ze(n)),()=>{ot(Me,Ur("text-center font-medium",p?"focus-within:ring-2":"focus-within:ring-4",p&&"focus-within:z-10",p||"focus-within:outline-none","inline-flex items-center justify-center "+de[c()],b()&&q()&&"border dark:border-gray-900",b()&&q()&&ie[z()],b()&&!q()&&fe[z()],!b()&&q()&&ie[z()],!b()&&!q()&&ae[z()],z()==="alternative"&&(p&&!q()?"dark:bg-gray-700 dark:text-white dark:border-gray-700 dark:hover:border-gray-600 dark:hover:bg-gray-600":"dark:bg-transparent dark:border-gray-600 dark:hover:border-gray-600"),b()&&z()==="dark"&&(p?q()?"bg-gray-900 border-gray-800 dark:border-white dark:bg-gray-600":"dark:text-white border-gray-800 dark:border-white":"dark:text-gray-400 dark:border-gray-700"),Y[z()],Se()&&p&&"[&:not(:first-child)]:-ms-px",p?v()&&"first:rounded-s-full last:rounded-e-full"||"first:rounded-s-lg last:rounded-e-lg":v()&&"rounded-full"||"rounded-lg",B()&&"shadow-lg",B()&&be[z()],Q()&&"cursor-not-allowed opacity-50",n.class))}),gi(),Lr();var Ge=rr(),Ee=mt(Ge);hr(Ee,()=>E()&&!Q(),Ve=>{var De=WE();let qe;var Ze=ct(De);cr(Ze,Zr(e),{},null),ut(De),Ct(()=>qe=ji(De,qe,{href:E(),...l,class:ue(Me),role:"button"},!0,"")),Qe("click",De,function(Pe){Xe.call(this,e,Pe)}),Qe("change",De,function(Pe){Xe.call(this,e,Pe)}),Qe("keydown",De,function(Pe){Xe.call(this,e,Pe)}),Qe("keyup",De,function(Pe){Xe.call(this,e,Pe)}),Qe("touchstart",De,function(Pe){Xe.call(this,e,Pe)}),Qe("touchend",De,function(Pe){Xe.call(this,e,Pe)}),Qe("touchcancel",De,function(Pe){Xe.call(this,e,Pe)}),Qe("mouseenter",De,function(Pe){Xe.call(this,e,Pe)}),Qe("mouseleave",De,function(Pe){Xe.call(this,e,Pe)}),xe(Ve,De)},Ve=>{var De=rr(),qe=mt(De);hr(qe,()=>$()==="button",Ze=>{var Pe=HE();let $e;var We=ct(Pe);cr(We,Zr(e),{},null),ut(Pe),Ct(()=>$e=ji(Pe,$e,{type:T(),...l,disabled:Q(),class:ue(Me)},!0,"")),Qe("click",Pe,function(Je){Xe.call(this,e,Je)}),Qe("change",Pe,function(Je){Xe.call(this,e,Je)}),Qe("keydown",Pe,function(Je){Xe.call(this,e,Je)}),Qe("keyup",Pe,function(Je){Xe.call(this,e,Je)}),Qe("touchstart",Pe,function(Je){Xe.call(this,e,Je)}),Qe("touchend",Pe,function(Je){Xe.call(this,e,Je)}),Qe("touchcancel",Pe,function(Je){Xe.call(this,e,Je)}),Qe("mouseenter",Pe,function(Je){Xe.call(this,e,Je)}),Qe("mouseleave",Pe,function(Je){Xe.call(this,e,Je)}),xe(Ze,Pe)},Ze=>{var Pe=rr(),$e=mt(Pe);Fh($e,$,!1,(We,Je)=>{let gt;Ct(()=>gt=Oh(We,gt,{...l,class:ue(Me)},""));var Ne=rr(),ht=mt(Ne);cr(ht,Zr(e),{},null),xe(Je,Ne)}),xe(Ze,Pe)},!0),xe(Ve,De)}),xe(i,Ge),Pr()}var YE=rt("<div><!></div>");function Ov(i,e){const n=ur(e,["children","$$slots","$$events","$$legacy"]),l=ur(n,["size","divClass"]);Dr(e,!1);let p=oe(e,"size",0,"md"),v=oe(e,"divClass",0,"inline-flex rounded-lg shadow-sm");jn("group",{size:p()}),Lr();var b=YE();let c;var E=ct(b);cr(E,Zr(e),{},null),ut(b),Ct(()=>c=ji(b,c,{...l,class:Ur(v(),n.class),role:"group"},!0,"")),xe(i,b),Pr()}const KE=(i,e)=>{const n=l=>{l!=null&&l.target&&i&&!i.contains(l.target)&&!l.defaultPrevented&&e()};return document.addEventListener("click",n,!0),{destroy(){document.removeEventListener("click",n,!0)}}};var XE=rt('<div role="presentation"></div>'),JE=rt('<div role="presentation"></div>'),QE=rt("<!> <div><!></div>",1);function eC(i,e){const n=ur(e,["children","$$slots","$$events","$$legacy"]),l=ur(n,["activateClickOutside","hidden","position","leftOffset","rightOffset","topOffset","bottomOffset","width","backdrop","bgColor","bgOpacity","placement","id","divClass","transitionParams","transitionType"]);Dr(e,!1);let p=oe(e,"activateClickOutside",0,!0),v=oe(e,"hidden",4,!0),b=oe(e,"position",0,"fixed"),c=oe(e,"leftOffset",0,"inset-y-0 start-0"),E=oe(e,"rightOffset",0,"inset-y-0 end-0"),T=oe(e,"topOffset",0,"inset-x-0 top-0"),z=oe(e,"bottomOffset",0,"inset-x-0 bottom-0"),B=oe(e,"width",0,"w-80"),$=oe(e,"backdrop",0,!0),q=oe(e,"bgColor",0,"bg-gray-900"),Q=oe(e,"bgOpacity",0,"bg-opacity-75"),ae=oe(e,"placement",0,"left"),ie=oe(e,"id",0,"drawer-example"),Y=oe(e,"divClass",0,"overflow-y-auto z-50 p-4 bg-white dark:bg-gray-800"),be=oe(e,"transitionParams",8,()=>({})),fe=oe(e,"transitionType",0,"fly");function de(Ze,Pe){switch(fe()){case"slide":return OE(Ze,Pe);case"blur":return BE(Ze,Pe);case"fade":return RE(Ze,Pe);default:return FE(Ze,Pe)}}const Se={left:c(),right:E(),top:T(),bottom:z()},Me=()=>{v(!v())},Ge=()=>p()&&!v()&&Me();let Ee=Ur("fixed top-0 start-0 z-50 w-full h-full",$()&&q(),$()&&Q());function Ve(Ze,Pe){return p()?KE(Ze,Pe):void 0}Lr();var De=rr(),qe=mt(De);hr(qe,()=>!v(),Ze=>{var Pe=QE(),$e=mt(Pe);hr($e,()=>$()&&p(),Ne=>{var ht=XE(),_t=_b(()=>()=>!v()&&Me());kn(ht,Ee),Qe("click",ht,function(...er){var Xt;return(Xt=ue(_t))==null?void 0:Xt.apply(this,er)},!1),xe(Ne,ht)},Ne=>{var ht=rr(),_t=mt(ht);hr(_t,()=>$()&&!p(),er=>{var Xt=JE();kn(Xt,Ee),xe(er,Xt)},null,!0),xe(Ne,ht)});var We=Ae(Ae($e,!0));let Je;var gt=ct(We);cr(gt,Zr(e),{get hidden(){return v()}},null),ut(We),Ct(()=>Je=ji(We,Je,{id:ie(),...l,class:Ur(Y(),B(),b(),Se[ae()],n.class),tabindex:"-1","aria-controls":ie(),"aria-labelledby":ie()},!0,"")),Ho(We,(Ne,ht)=>Ve(Ne,ht),()=>Ge),Ab(3,We,()=>de,be),xe(Ze,Pe)}),xe(i,De),Pr()}const ru=Math.min,Ll=Math.max,Cp=Math.round,wf=Math.floor,el=i=>({x:i,y:i}),tC={left:"right",right:"left",bottom:"top",top:"bottom"},rC={start:"end",end:"start"};function ey(i,e,n){return Ll(i,ru(e,n))}function rd(i,e){return typeof i=="function"?i(e):i}function Fl(i){return i.split("-")[0]}function id(i){return i.split("-")[1]}function H1(i){return i==="x"?"y":"x"}function Hy(i){return i==="y"?"height":"width"}function iu(i){return["top","bottom"].includes(Fl(i))?"y":"x"}function Yy(i){return H1(iu(i))}function iC(i,e,n){n===void 0&&(n=!1);const l=id(i),p=Yy(i),v=Hy(p);let b=p==="x"?l===(n?"end":"start")?"right":"left":l==="start"?"bottom":"top";return e.reference[v]>e.floating[v]&&(b=Mp(b)),[b,Mp(b)]}function nC(i){const e=Mp(i);return[ty(i),e,ty(e)]}function ty(i){return i.replace(/start|end/g,e=>rC[e])}function sC(i,e,n){const l=["left","right"],p=["right","left"],v=["top","bottom"],b=["bottom","top"];switch(i){case"top":case"bottom":return n?e?p:l:e?l:p;case"left":case"right":return e?v:b;default:return[]}}function aC(i,e,n,l){const p=id(i);let v=sC(Fl(i),n==="start",l);return p&&(v=v.map(b=>b+"-"+p),e&&(v=v.concat(v.map(ty)))),v}function Mp(i){return i.replace(/left|right|bottom|top/g,e=>tC[e])}function oC(i){return{top:0,right:0,bottom:0,left:0,...i}}function Y1(i){return typeof i!="number"?oC(i):{top:i,right:i,bottom:i,left:i}}function Dp(i){const{x:e,y:n,width:l,height:p}=i;return{width:l,height:p,top:n,left:e,right:e+l,bottom:n+p,x:e,y:n}}function Nv(i,e,n){let{reference:l,floating:p}=i;const v=iu(e),b=Yy(e),c=Hy(b),E=Fl(e),T=v==="y",z=l.x+l.width/2-p.width/2,B=l.y+l.height/2-p.height/2,$=l[c]/2-p[c]/2;let q;switch(E){case"top":q={x:z,y:l.y-p.height};break;case"bottom":q={x:z,y:l.y+l.height};break;case"right":q={x:l.x+l.width,y:B};break;case"left":q={x:l.x-p.width,y:B};break;default:q={x:l.x,y:l.y}}switch(id(e)){case"start":q[b]-=$*(n&&T?-1:1);break;case"end":q[b]+=$*(n&&T?-1:1);break}return q}const lC=async(i,e,n)=>{const{placement:l="bottom",strategy:p="absolute",middleware:v=[],platform:b}=n,c=v.filter(Boolean),E=await(b.isRTL==null?void 0:b.isRTL(e));let T=await b.getElementRects({reference:i,floating:e,strategy:p}),{x:z,y:B}=Nv(T,l,E),$=l,q={},Q=0;for(let ae=0;ae<c.length;ae++){const{name:ie,fn:Y}=c[ae],{x:be,y:fe,data:de,reset:Se}=await Y({x:z,y:B,initialPlacement:l,placement:$,strategy:p,middlewareData:q,rects:T,platform:b,elements:{reference:i,floating:e}});z=be??z,B=fe??B,q={...q,[ie]:{...q[ie],...de}},Se&&Q<=50&&(Q++,typeof Se=="object"&&(Se.placement&&($=Se.placement),Se.rects&&(T=Se.rects===!0?await b.getElementRects({reference:i,floating:e,strategy:p}):Se.rects),{x:z,y:B}=Nv(T,$,E)),ae=-1)}return{x:z,y:B,placement:$,strategy:p,middlewareData:q}};async function K1(i,e){var n;e===void 0&&(e={});const{x:l,y:p,platform:v,rects:b,elements:c,strategy:E}=i,{boundary:T="clippingAncestors",rootBoundary:z="viewport",elementContext:B="floating",altBoundary:$=!1,padding:q=0}=rd(e,i),Q=Y1(q),ie=c[$?B==="floating"?"reference":"floating":B],Y=Dp(await v.getClippingRect({element:(n=await(v.isElement==null?void 0:v.isElement(ie)))==null||n?ie:ie.contextElement||await(v.getDocumentElement==null?void 0:v.getDocumentElement(c.floating)),boundary:T,rootBoundary:z,strategy:E})),be=B==="floating"?{x:l,y:p,width:b.floating.width,height:b.floating.height}:b.reference,fe=await(v.getOffsetParent==null?void 0:v.getOffsetParent(c.floating)),de=await(v.isElement==null?void 0:v.isElement(fe))?await(v.getScale==null?void 0:v.getScale(fe))||{x:1,y:1}:{x:1,y:1},Se=Dp(v.convertOffsetParentRelativeRectToViewportRelativeRect?await v.convertOffsetParentRelativeRectToViewportRelativeRect({elements:c,rect:be,offsetParent:fe,strategy:E}):be);return{top:(Y.top-Se.top+Q.top)/de.y,bottom:(Se.bottom-Y.bottom+Q.bottom)/de.y,left:(Y.left-Se.left+Q.left)/de.x,right:(Se.right-Y.right+Q.right)/de.x}}const cC=i=>({name:"arrow",options:i,async fn(e){const{x:n,y:l,placement:p,rects:v,platform:b,elements:c,middlewareData:E}=e,{element:T,padding:z=0}=rd(i,e)||{};if(T==null)return{};const B=Y1(z),$={x:n,y:l},q=Yy(p),Q=Hy(q),ae=await b.getDimensions(T),ie=q==="y",Y=ie?"top":"left",be=ie?"bottom":"right",fe=ie?"clientHeight":"clientWidth",de=v.reference[Q]+v.reference[q]-$[q]-v.floating[Q],Se=$[q]-v.reference[q],Me=await(b.getOffsetParent==null?void 0:b.getOffsetParent(T));let Ge=Me?Me[fe]:0;(!Ge||!await(b.isElement==null?void 0:b.isElement(Me)))&&(Ge=c.floating[fe]||v.floating[Q]);const Ee=de/2-Se/2,Ve=Ge/2-ae[Q]/2-1,De=ru(B[Y],Ve),qe=ru(B[be],Ve),Ze=De,Pe=Ge-ae[Q]-qe,$e=Ge/2-ae[Q]/2+Ee,We=ey(Ze,$e,Pe),Je=!E.arrow&&id(p)!=null&&$e!==We&&v.reference[Q]/2-($e<Ze?De:qe)-ae[Q]/2<0,gt=Je?$e<Ze?$e-Ze:$e-Pe:0;return{[q]:$[q]+gt,data:{[q]:We,centerOffset:$e-We-gt,...Je&&{alignmentOffset:gt}},reset:Je}}}),uC=function(i){return i===void 0&&(i={}),{name:"flip",options:i,async fn(e){var n,l;const{placement:p,middlewareData:v,rects:b,initialPlacement:c,platform:E,elements:T}=e,{mainAxis:z=!0,crossAxis:B=!0,fallbackPlacements:$,fallbackStrategy:q="bestFit",fallbackAxisSideDirection:Q="none",flipAlignment:ae=!0,...ie}=rd(i,e);if((n=v.arrow)!=null&&n.alignmentOffset)return{};const Y=Fl(p),be=iu(c),fe=Fl(c)===c,de=await(E.isRTL==null?void 0:E.isRTL(T.floating)),Se=$||(fe||!ae?[Mp(c)]:nC(c)),Me=Q!=="none";!$&&Me&&Se.push(...aC(c,ae,Q,de));const Ge=[c,...Se],Ee=await K1(e,ie),Ve=[];let De=((l=v.flip)==null?void 0:l.overflows)||[];if(z&&Ve.push(Ee[Y]),B){const $e=iC(p,b,de);Ve.push(Ee[$e[0]],Ee[$e[1]])}if(De=[...De,{placement:p,overflows:Ve}],!Ve.every($e=>$e<=0)){var qe,Ze;const $e=(((qe=v.flip)==null?void 0:qe.index)||0)+1,We=Ge[$e];if(We)return{data:{index:$e,overflows:De},reset:{placement:We}};let Je=(Ze=De.filter(gt=>gt.overflows[0]<=0).sort((gt,Ne)=>gt.overflows[1]-Ne.overflows[1])[0])==null?void 0:Ze.placement;if(!Je)switch(q){case"bestFit":{var Pe;const gt=(Pe=De.filter(Ne=>{if(Me){const ht=iu(Ne.placement);return ht===be||ht==="y"}return!0}).map(Ne=>[Ne.placement,Ne.overflows.filter(ht=>ht>0).reduce((ht,_t)=>ht+_t,0)]).sort((Ne,ht)=>Ne[1]-ht[1])[0])==null?void 0:Pe[0];gt&&(Je=gt);break}case"initialPlacement":Je=c;break}if(p!==Je)return{reset:{placement:Je}}}return{}}}};async function hC(i,e){const{placement:n,platform:l,elements:p}=i,v=await(l.isRTL==null?void 0:l.isRTL(p.floating)),b=Fl(n),c=id(n),E=iu(n)==="y",T=["left","top"].includes(b)?-1:1,z=v&&E?-1:1,B=rd(e,i);let{mainAxis:$,crossAxis:q,alignmentAxis:Q}=typeof B=="number"?{mainAxis:B,crossAxis:0,alignmentAxis:null}:{mainAxis:B.mainAxis||0,crossAxis:B.crossAxis||0,alignmentAxis:B.alignmentAxis};return c&&typeof Q=="number"&&(q=c==="end"?Q*-1:Q),E?{x:q*z,y:$*T}:{x:$*T,y:q*z}}const dC=function(i){return i===void 0&&(i=0),{name:"offset",options:i,async fn(e){var n,l;const{x:p,y:v,placement:b,middlewareData:c}=e,E=await hC(e,i);return b===((n=c.offset)==null?void 0:n.placement)&&(l=c.arrow)!=null&&l.alignmentOffset?{}:{x:p+E.x,y:v+E.y,data:{...E,placement:b}}}}},fC=function(i){return i===void 0&&(i={}),{name:"shift",options:i,async fn(e){const{x:n,y:l,placement:p}=e,{mainAxis:v=!0,crossAxis:b=!1,limiter:c={fn:ie=>{let{x:Y,y:be}=ie;return{x:Y,y:be}}},...E}=rd(i,e),T={x:n,y:l},z=await K1(e,E),B=iu(Fl(p)),$=H1(B);let q=T[$],Q=T[B];if(v){const ie=$==="y"?"top":"left",Y=$==="y"?"bottom":"right",be=q+z[ie],fe=q-z[Y];q=ey(be,q,fe)}if(b){const ie=B==="y"?"top":"left",Y=B==="y"?"bottom":"right",be=Q+z[ie],fe=Q-z[Y];Q=ey(be,Q,fe)}const ae=c.fn({...e,[$]:q,[B]:Q});return{...ae,data:{x:ae.x-n,y:ae.y-l,enabled:{[$]:v,[B]:b}}}}}};function Xp(){return typeof window<"u"}function uu(i){return X1(i)?(i.nodeName||"").toLowerCase():"#document"}function Ls(i){var e;return(i==null||(e=i.ownerDocument)==null?void 0:e.defaultView)||window}function ja(i){var e;return(e=(X1(i)?i.ownerDocument:i.document)||window.document)==null?void 0:e.documentElement}function X1(i){return Xp()?i instanceof Node||i instanceof Ls(i).Node:!1}function ma(i){return Xp()?i instanceof Element||i instanceof Ls(i).Element:!1}function Va(i){return Xp()?i instanceof HTMLElement||i instanceof Ls(i).HTMLElement:!1}function Uv(i){return!Xp()||typeof ShadowRoot>"u"?!1:i instanceof ShadowRoot||i instanceof Ls(i).ShadowRoot}function nd(i){const{overflow:e,overflowX:n,overflowY:l,display:p}=ga(i);return/auto|scroll|overlay|hidden|clip/.test(e+l+n)&&!["inline","contents"].includes(p)}function pC(i){return["table","td","th"].includes(uu(i))}function Jp(i){return[":popover-open",":modal"].some(e=>{try{return i.matches(e)}catch{return!1}})}function Ky(i){const e=Xy(),n=ma(i)?ga(i):i;return n.transform!=="none"||n.perspective!=="none"||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||["transform","perspective","filter"].some(l=>(n.willChange||"").includes(l))||["paint","layout","strict","content"].some(l=>(n.contain||"").includes(l))}function mC(i){let e=tl(i);for(;Va(e)&&!nu(e);){if(Ky(e))return e;if(Jp(e))return null;e=tl(e)}return null}function Xy(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function nu(i){return["html","body","#document"].includes(uu(i))}function ga(i){return Ls(i).getComputedStyle(i)}function Qp(i){return ma(i)?{scrollLeft:i.scrollLeft,scrollTop:i.scrollTop}:{scrollLeft:i.scrollX,scrollTop:i.scrollY}}function tl(i){if(uu(i)==="html")return i;const e=i.assignedSlot||i.parentNode||Uv(i)&&i.host||ja(i);return Uv(e)?e.host:e}function J1(i){const e=tl(i);return nu(e)?i.ownerDocument?i.ownerDocument.body:i.body:Va(e)&&nd(e)?e:J1(e)}function Gh(i,e,n){var l;e===void 0&&(e=[]),n===void 0&&(n=!0);const p=J1(i),v=p===((l=i.ownerDocument)==null?void 0:l.body),b=Ls(p);if(v){const c=ry(b);return e.concat(b,b.visualViewport||[],nd(p)?p:[],c&&n?Gh(c):[])}return e.concat(p,Gh(p,[],n))}function ry(i){return i.parent&&Object.getPrototypeOf(i.parent)?i.frameElement:null}function Q1(i){const e=ga(i);let n=parseFloat(e.width)||0,l=parseFloat(e.height)||0;const p=Va(i),v=p?i.offsetWidth:n,b=p?i.offsetHeight:l,c=Cp(n)!==v||Cp(l)!==b;return c&&(n=v,l=b),{width:n,height:l,$:c}}function Jy(i){return ma(i)?i:i.contextElement}function Hc(i){const e=Jy(i);if(!Va(e))return el(1);const n=e.getBoundingClientRect(),{width:l,height:p,$:v}=Q1(e);let b=(v?Cp(n.width):n.width)/l,c=(v?Cp(n.height):n.height)/p;return(!b||!Number.isFinite(b))&&(b=1),(!c||!Number.isFinite(c))&&(c=1),{x:b,y:c}}const gC=el(0);function ew(i){const e=Ls(i);return!Xy()||!e.visualViewport?gC:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function yC(i,e,n){return e===void 0&&(e=!1),!n||e&&n!==Ls(i)?!1:e}function Ol(i,e,n,l){e===void 0&&(e=!1),n===void 0&&(n=!1);const p=i.getBoundingClientRect(),v=Jy(i);let b=el(1);e&&(l?ma(l)&&(b=Hc(l)):b=Hc(i));const c=yC(v,n,l)?ew(v):el(0);let E=(p.left+c.x)/b.x,T=(p.top+c.y)/b.y,z=p.width/b.x,B=p.height/b.y;if(v){const $=Ls(v),q=l&&ma(l)?Ls(l):l;let Q=$,ae=ry(Q);for(;ae&&l&&q!==Q;){const ie=Hc(ae),Y=ae.getBoundingClientRect(),be=ga(ae),fe=Y.left+(ae.clientLeft+parseFloat(be.paddingLeft))*ie.x,de=Y.top+(ae.clientTop+parseFloat(be.paddingTop))*ie.y;E*=ie.x,T*=ie.y,z*=ie.x,B*=ie.y,E+=fe,T+=de,Q=Ls(ae),ae=ry(Q)}}return Dp({width:z,height:B,x:E,y:T})}function _C(i){let{elements:e,rect:n,offsetParent:l,strategy:p}=i;const v=p==="fixed",b=ja(l),c=e?Jp(e.floating):!1;if(l===b||c&&v)return n;let E={scrollLeft:0,scrollTop:0},T=el(1);const z=el(0),B=Va(l);if((B||!B&&!v)&&((uu(l)!=="body"||nd(b))&&(E=Qp(l)),Va(l))){const $=Ol(l);T=Hc(l),z.x=$.x+l.clientLeft,z.y=$.y+l.clientTop}return{width:n.width*T.x,height:n.height*T.y,x:n.x*T.x-E.scrollLeft*T.x+z.x,y:n.y*T.y-E.scrollTop*T.y+z.y}}function vC(i){return Array.from(i.getClientRects())}function iy(i,e){const n=Qp(i).scrollLeft;return e?e.left+n:Ol(ja(i)).left+n}function bC(i){const e=ja(i),n=Qp(i),l=i.ownerDocument.body,p=Ll(e.scrollWidth,e.clientWidth,l.scrollWidth,l.clientWidth),v=Ll(e.scrollHeight,e.clientHeight,l.scrollHeight,l.clientHeight);let b=-n.scrollLeft+iy(i);const c=-n.scrollTop;return ga(l).direction==="rtl"&&(b+=Ll(e.clientWidth,l.clientWidth)-p),{width:p,height:v,x:b,y:c}}function xC(i,e){const n=Ls(i),l=ja(i),p=n.visualViewport;let v=l.clientWidth,b=l.clientHeight,c=0,E=0;if(p){v=p.width,b=p.height;const T=Xy();(!T||T&&e==="fixed")&&(c=p.offsetLeft,E=p.offsetTop)}return{width:v,height:b,x:c,y:E}}function wC(i,e){const n=Ol(i,!0,e==="fixed"),l=n.top+i.clientTop,p=n.left+i.clientLeft,v=Va(i)?Hc(i):el(1),b=i.clientWidth*v.x,c=i.clientHeight*v.y,E=p*v.x,T=l*v.y;return{width:b,height:c,x:E,y:T}}function $v(i,e,n){let l;if(e==="viewport")l=xC(i,n);else if(e==="document")l=bC(ja(i));else if(ma(e))l=wC(e,n);else{const p=ew(i);l={...e,x:e.x-p.x,y:e.y-p.y}}return Dp(l)}function tw(i,e){const n=tl(i);return n===e||!ma(n)||nu(n)?!1:ga(n).position==="fixed"||tw(n,e)}function SC(i,e){const n=e.get(i);if(n)return n;let l=Gh(i,[],!1).filter(c=>ma(c)&&uu(c)!=="body"),p=null;const v=ga(i).position==="fixed";let b=v?tl(i):i;for(;ma(b)&&!nu(b);){const c=ga(b),E=Ky(b);!E&&c.position==="fixed"&&(p=null),(v?!E&&!p:!E&&c.position==="static"&&!!p&&["absolute","fixed"].includes(p.position)||nd(b)&&!E&&tw(i,b))?l=l.filter(z=>z!==b):p=c,b=tl(b)}return e.set(i,l),l}function IC(i){let{element:e,boundary:n,rootBoundary:l,strategy:p}=i;const b=[...n==="clippingAncestors"?Jp(e)?[]:SC(e,this._c):[].concat(n),l],c=b[0],E=b.reduce((T,z)=>{const B=$v(e,z,p);return T.top=Ll(B.top,T.top),T.right=ru(B.right,T.right),T.bottom=ru(B.bottom,T.bottom),T.left=Ll(B.left,T.left),T},$v(e,c,p));return{width:E.right-E.left,height:E.bottom-E.top,x:E.left,y:E.top}}function TC(i){const{width:e,height:n}=Q1(i);return{width:e,height:n}}function kC(i,e,n){const l=Va(e),p=ja(e),v=n==="fixed",b=Ol(i,!0,v,e);let c={scrollLeft:0,scrollTop:0};const E=el(0);if(l||!l&&!v)if((uu(e)!=="body"||nd(p))&&(c=Qp(e)),l){const q=Ol(e,!0,v,e);E.x=q.x+e.clientLeft,E.y=q.y+e.clientTop}else p&&(E.x=iy(p));let T=0,z=0;if(p&&!l&&!v){const q=p.getBoundingClientRect();z=q.top+c.scrollTop,T=q.left+c.scrollLeft-iy(p,q)}const B=b.left+c.scrollLeft-E.x-T,$=b.top+c.scrollTop-E.y-z;return{x:B,y:$,width:b.width,height:b.height}}function Ig(i){return ga(i).position==="static"}function Vv(i,e){if(!Va(i)||ga(i).position==="fixed")return null;if(e)return e(i);let n=i.offsetParent;return ja(i)===n&&(n=n.ownerDocument.body),n}function rw(i,e){const n=Ls(i);if(Jp(i))return n;if(!Va(i)){let p=tl(i);for(;p&&!nu(p);){if(ma(p)&&!Ig(p))return p;p=tl(p)}return n}let l=Vv(i,e);for(;l&&pC(l)&&Ig(l);)l=Vv(l,e);return l&&nu(l)&&Ig(l)&&!Ky(l)?n:l||mC(i)||n}const AC=async function(i){const e=this.getOffsetParent||rw,n=this.getDimensions,l=await n(i.floating);return{reference:kC(i.reference,await e(i.floating),i.strategy),floating:{x:0,y:0,width:l.width,height:l.height}}};function EC(i){return ga(i).direction==="rtl"}const CC={convertOffsetParentRelativeRectToViewportRelativeRect:_C,getDocumentElement:ja,getClippingRect:IC,getOffsetParent:rw,getElementRects:AC,getClientRects:vC,getDimensions:TC,getScale:Hc,isElement:ma,isRTL:EC};function MC(i,e){let n=null,l;const p=ja(i);function v(){var c;clearTimeout(l),(c=n)==null||c.disconnect(),n=null}function b(c,E){c===void 0&&(c=!1),E===void 0&&(E=1),v();const{left:T,top:z,width:B,height:$}=i.getBoundingClientRect();if(c||e(),!B||!$)return;const q=wf(z),Q=wf(p.clientWidth-(T+B)),ae=wf(p.clientHeight-(z+$)),ie=wf(T),be={rootMargin:-q+"px "+-Q+"px "+-ae+"px "+-ie+"px",threshold:Ll(0,ru(1,E))||1};let fe=!0;function de(Se){const Me=Se[0].intersectionRatio;if(Me!==E){if(!fe)return b();Me?b(!1,Me):l=setTimeout(()=>{b(!1,1e-7)},1e3)}fe=!1}try{n=new IntersectionObserver(de,{...be,root:p.ownerDocument})}catch{n=new IntersectionObserver(de,be)}n.observe(i)}return b(!0),v}function jv(i,e,n,l){l===void 0&&(l={});const{ancestorScroll:p=!0,ancestorResize:v=!0,elementResize:b=typeof ResizeObserver=="function",layoutShift:c=typeof IntersectionObserver=="function",animationFrame:E=!1}=l,T=Jy(i),z=p||v?[...T?Gh(T):[],...Gh(e)]:[];z.forEach(Y=>{p&&Y.addEventListener("scroll",n,{passive:!0}),v&&Y.addEventListener("resize",n)});const B=T&&c?MC(T,n):null;let $=-1,q=null;b&&(q=new ResizeObserver(Y=>{let[be]=Y;be&&be.target===T&&q&&(q.unobserve(e),cancelAnimationFrame($),$=requestAnimationFrame(()=>{var fe;(fe=q)==null||fe.observe(e)})),n()}),T&&!E&&q.observe(T),q.observe(e));let Q,ae=E?Ol(i):null;E&&ie();function ie(){const Y=Ol(i);ae&&(Y.x!==ae.x||Y.y!==ae.y||Y.width!==ae.width||Y.height!==ae.height)&&n(),ae=Y,Q=requestAnimationFrame(ie)}return n(),()=>{var Y;z.forEach(be=>{p&&be.removeEventListener("scroll",n),v&&be.removeEventListener("resize",n)}),B==null||B(),(Y=q)==null||Y.disconnect(),q=null,E&&cancelAnimationFrame(Q)}}const DC=dC,PC=fC,LC=uC,zC=cC,BC=(i,e,n)=>{const l=new Map,p={platform:CC,...n},v={...p.platform,_c:l};return lC(i,e,{...p,platform:v})};var RC=rt("<div></div>"),FC=rt("<div></div>"),OC=rt("<!> <!>",1),NC=rt("<!> <!>",1);function UC(i,e){const n=ur(e,["children","$$slots","$$events","$$legacy"]),l=ur(n,["activeContent","arrow","offset","placement","trigger","triggeredBy","reference","strategy","open","yOnly","middlewares"]);Dr(e,!1);const p=xt();let v=oe(e,"activeContent",0,!1),b=oe(e,"arrow",0,!0),c=oe(e,"offset",0,8),E=oe(e,"placement",0,"top"),T=oe(e,"trigger",0,"hover"),z=oe(e,"triggeredBy",8,()=>{}),B=oe(e,"reference",8,()=>{}),$=oe(e,"strategy",0,"absolute"),q=oe(e,"open",4,!1),Q=oe(e,"yOnly",0,!1),ae=oe(e,"middlewares",8,()=>[LC(),PC()]);const ie=Yh();let Y=xt(),be=xt(),fe=xt(),de=xt(),Se,Me=xt(),Ge=xt(),Ee=[];const Ve=dt=>{ue(de)===void 0&&console.error("trigger undefined"),!(!B()&&Ee.includes(dt.target)&&ue(de)!==dt.target&&(ot(de,dt.target),q()))&&q(dt.type==="click"?!q():!0)},De=dt=>dt.matches(":hover"),qe=dt=>dt?`${dt}px`:"",Ze=dt=>{if(v()&&ue(fe)){const Nt=[ue(de),Se,...Ee].filter(Boolean);setTimeout(()=>{dt.type==="mouseleave"&&!Nt.some(De)&&q(!1)},100)}else q(!1)};let Pe=xt();const $e={left:"right",right:"left",bottom:"top",top:"bottom"};function We(){BC(ue(de),Se,{placement:E(),strategy:$(),middleware:ue(p)}).then(({x:dt,y:Nt,middlewareData:or,placement:wt,strategy:je})=>{Se.style.position=je,Se.style.left=Q()?"0":qe(dt),Se.style.top=qe(Nt),or.arrow&&ue(Me)instanceof HTMLDivElement&&(Lh(Me,ue(Me).style.left=qe(or.arrow.x)),Lh(Me,ue(Me).style.top=qe(or.arrow.y)),ot(Pe,$e[wt.split("-")[0]]),Lh(Me,ue(Me).style[ue(Pe)]=qe(-ue(Me).offsetWidth/2-(n.border?1:0))))})}function Je(dt,Nt){Se=dt;let or=jv(Nt,Se,We);return{update(wt){or(),or=jv(wt,Se,We)},destroy(){or()}}}Kh(()=>{const dt=[["focusin",Ve,ue(Y)],["focusout",Ze,ue(Y)],["click",Ve,ue(be)],["mouseenter",Ve,ue(fe)],["mouseleave",Ze,ue(fe)]];return z()?Ee=[...document.querySelectorAll(z())]:Ee=ue(Ge).previousElementSibling?[ue(Ge).previousElementSibling]:[],Ee.length||console.error("No triggers found."),Ee.forEach(Nt=>{Nt.tabIndex<0&&(Nt.tabIndex=0);for(const[or,wt,je]of dt)je&&Nt.addEventListener(or,wt)}),B()?(ot(de,document.querySelector(B())??document.body),ue(de)===document.body?console.error(`Popup reference not found: '${B()}'`):(ue(Y)&&ue(de).addEventListener("focusout",Ze),ue(fe)&&ue(de).addEventListener("mouseleave",Ze))):ot(de,Ee[0]),ue(be)&&document.addEventListener("click",gt),()=>{Ee.forEach(Nt=>{if(Nt)for(const[or,wt]of dt)Nt.removeEventListener(or,wt)}),ue(de)&&(ue(de).removeEventListener("focusout",Ze),ue(de).removeEventListener("mouseleave",Ze)),document.removeEventListener("click",gt)}});function gt(dt){q()&&!dt.composedPath().includes(Se)&&!Ee.some(Nt=>dt.composedPath().includes(Nt))&&Ze(dt)}function Ne(dt,Nt){return dt?Nt:()=>{}}let ht=xt();function _t(dt){return ot(Me,dt),{destroy(){ot(Me,null)}}}bt(()=>ze(T()),()=>{ot(Y,T()==="focus")}),bt(()=>ze(T()),()=>{ot(be,T()==="click")}),bt(()=>ze(T()),()=>{ot(fe,T()==="hover")}),bt(()=>ze(q()),()=>{ie("show",q())}),bt(()=>(ze(E()),ue(de)),()=>{E()&&ot(de,ue(de))}),bt(()=>(ze(ae()),ze(c()),ue(Me)),()=>{ot(p,[...ae(),DC(+c()),ue(Me)&&zC({element:ue(Me),padding:10})])}),bt(()=>(ze(n),ue(Pe)),()=>{ot(ht,Wy("absolute pointer-events-none block w-[10px] h-[10px] rotate-45 bg-inherit border-inherit",n.border&&ue(Pe)==="bottom"&&"border-b border-e",n.border&&ue(Pe)==="top"&&"border-t border-s ",n.border&&ue(Pe)==="right"&&"border-t border-e ",n.border&&ue(Pe)==="left"&&"border-b border-s "))}),gi(),Lr();var er=NC(),Xt=mt(er);hr(Xt,()=>!ue(de),dt=>{var Nt=RC();Wo(Nt,or=>ot(Ge,or),()=>ue(Ge)),xe(dt,Nt)});var ar=Ae(Ae(Xt,!0));hr(ar,()=>ue(de),dt=>{var Nt=Kc(()=>v()?-1:void 0);UE(dt,dy({use:Je,get options(){return ue(de)},get open(){return q()},set open(or){q(or)},role:"tooltip",get tabindex(){return ue(Nt)}},()=>l,{$$events:{focusin:Ne(v()&&ue(Y),Ve),focusout:Ne(v()&&ue(Y),Ze),mouseenter:Ne(v()&&ue(fe),Ve),mouseleave:Ne(v()&&ue(fe),Ze)},children:(or,wt)=>{var je=OC(),Pt=mt(je);cr(Pt,Zr(e),{},null);var zt=Ae(Ae(Pt,!0));hr(zt,b,dr=>{var ir=FC();Ct(()=>kn(ir,ue(ht))),Ho(ir,$r=>_t($r)),xe(dr,ir)}),xe(or,je)},$$slots:{default:!0},$$legacy:!0}))}),xe(i,er),Pr()}var $C=rt("<div><!></div>"),VC=rt("<div><!></div>"),jC=rt("<!> <ul><!></ul> <!>",1);function Qy(i,e){const n=vb(e),l=ur(e,["children","$$slots","$$events","$$legacy"]),p=ur(l,["activeUrl","open","containerClass","classContainer","headerClass","classHeader","footerClass","classFooter","activeClass","classActive","arrow","trigger","placement","color","shadow","rounded"]);Dr(e,!1);const v=xt(),b=xt(),c=xt(),E=xt();let T=oe(e,"activeUrl",8,()=>{}),z=oe(e,"open",4,!1),B=oe(e,"containerClass",0,"divide-y z-50"),$=oe(e,"classContainer",8,()=>{}),q=oe(e,"headerClass",0,"py-1 overflow-hidden rounded-t-lg"),Q=oe(e,"classHeader",8,()=>{}),ae=oe(e,"footerClass",0,"py-1 overflow-hidden rounded-b-lg"),ie=oe(e,"classFooter",8,()=>{}),Y=oe(e,"activeClass",0,"text-primary-700 dark:text-primary-700 hover:text-primary-900 dark:hover:text-primary-900"),be=oe(e,"classActive",8,()=>{}),fe=oe(e,"arrow",0,!1),de=oe(e,"trigger",0,"click"),Se=oe(e,"placement",0,"bottom"),Me=oe(e,"color",0,"dropdown"),Ge=oe(e,"shadow",0,!0),Ee=oe(e,"rounded",0,!0);const Ve=hi("");let De=Ur(Y(),be());jn("DropdownType",{activeClass:De}),jn("activeUrl",Ve),bt(()=>ze(T()),()=>{Ve.set(T()??"")}),bt(()=>(ze(B()),ze($())),()=>{ot(v,Ur(B(),$()))}),bt(()=>(ze(q()),ze(Q())),()=>{ot(b,Ur(q(),Q()))}),bt(()=>ze(l),()=>{ot(c,Ur("py-1",l.class))}),bt(()=>(ze(ae()),ze(ie())),()=>{ot(E,Ur(ae(),ie()))}),gi(),Lr(),UC(i,dy({activeContent:!0},()=>p,{get trigger(){return de()},get arrow(){return fe()},get placement(){return Se()},get shadow(){return Ge()},get rounded(){return Ee()},get color(){return Me()},get class(){return ue(v)},get open(){return z()},set open(qe){z(qe)},$$events:{show(qe){Xe.call(this,e,qe)}},children:(qe,Ze)=>{var Pe=jC(),$e=mt(Pe);hr($e,()=>n.header,Ne=>{var er;var ht=$C(),_t=ct(ht);cr(_t,(er=e.$$slots)==null?void 0:er.header,{},null),ut(ht),Ct(()=>kn(ht,ue(b))),xe(Ne,ht)});var We=Ae(Ae($e,!0)),Je=ct(We);cr(Je,Zr(e),{},null),ut(We);var gt=Ae(Ae(We,!0));hr(gt,()=>n.footer,Ne=>{var er;var ht=VC(),_t=ct(ht);cr(_t,(er=e.$$slots)==null?void 0:er.footer,{},null),ut(ht),Ct(()=>kn(ht,ue(E))),xe(Ne,ht)}),Ct(()=>kn(We,ue(c))),xe(qe,Pe)},$$slots:{default:!0},$$legacy:!0})),Pr()}function iw(i,e){const n=ur(e,["children","$$slots","$$events","$$legacy"]),l=ur(n,["tag","show","use"]);let p=oe(e,"tag",0,"div"),v=oe(e,"show"),b=oe(e,"use",0,()=>{});var c=rr(),E=mt(c);hr(E,v,T=>{var z=rr(),B=mt(z);Fh(B,p,!1,($,q)=>{let Q;Ct(()=>Q=Oh($,Q,{...l},"")),Ho($,Y=>b()(Y));var ae=rr(),ie=mt(ae);cr(ie,Zr(e),{},null),xe(q,ae)}),xe(T,z)},T=>{var z=rr(),B=mt(z);cr(B,Zr(e),{},null),xe(T,z)}),xe(i,c)}function e_(i,e){const n=ur(e,["children","$$slots","$$events","$$legacy"]),l=ur(n,["defaultClass","href","activeClass"]);Dr(e,!1);const p=xt(),v=xt();let b=oe(e,"defaultClass",0,"font-medium py-2 px-4 text-sm hover:bg-gray-100 dark:hover:bg-gray-600"),c=oe(e,"href",8,()=>{}),E=oe(e,"activeClass",8,()=>{});const T=$i("DropdownType")??{},z=$i("activeUrl");let B=xt("");z.subscribe(Q=>{ot(B,Q)});let $=xt(!0);function q(Q){var ae;ot($,((ae=Q.parentElement)==null?void 0:ae.tagName)==="UL")}bt(()=>(ue(B),ze(c())),()=>{ot(p,ue(B)?c()===ue(B):!1)}),bt(()=>(ze(b()),ze(c()),ue(p),ze(E()),ze(n)),()=>{ot(v,Ur(b(),c()?"block":"w-full text-left",ue(p)&&(E()??T.activeClass),n.class))}),gi(),Lr(),iw(i,{tag:"li",get show(){return ue($)},use:q,children:(Q,ae)=>{var ie=rr(),Y=mt(ie);Fh(Y,()=>c()?"a":"button",!1,(be,fe)=>{let de;Ct(()=>de=Oh(be,de,{href:c(),type:c()?void 0:"button",role:c()?"link":"button",...l,class:ue(v)},"")),Qe("click",be,function(Ge){Xe.call(this,e,Ge)}),Qe("change",be,function(Ge){Xe.call(this,e,Ge)}),Qe("keydown",be,function(Ge){Xe.call(this,e,Ge)}),Qe("keyup",be,function(Ge){Xe.call(this,e,Ge)}),Qe("focus",be,function(Ge){Xe.call(this,e,Ge)}),Qe("blur",be,function(Ge){Xe.call(this,e,Ge)}),Qe("mouseenter",be,function(Ge){Xe.call(this,e,Ge)}),Qe("mouseleave",be,function(Ge){Xe.call(this,e,Ge)});var Se=rr(),Me=mt(Se);cr(Me,Zr(e),{},null),xe(fe,Se)}),xe(Q,ie)},$$slots:{default:!0},$$legacy:!0}),Pr()}var qC=rt("<label><!></label>");function Tg(i,e){const n=ur(e,["children","$$slots","$$events","$$legacy"]),l=ur(n,["color","defaultClass","show"]);Dr(e,!1);const p=xt();let v=oe(e,"color",4,"gray"),b=oe(e,"defaultClass",0,"text-sm rtl:text-right font-medium block"),c=oe(e,"show",0,!0),E=xt();const T={gray:"text-gray-900 dark:text-gray-300",green:"text-green-700 dark:text-green-500",red:"text-red-700 dark:text-red-500",disabled:"text-gray-400 dark:text-gray-500 grayscale contrast-50"};bt(()=>(ue(E),ze(v())),()=>{var q;const $=(q=ue(E))==null?void 0:q.control;v($!=null&&$.disabled?"disabled":v())}),bt(()=>(ze(b()),ze(v()),ze(n)),()=>{ot(p,Ur(b(),T[v()],n.class))}),gi(),Lr();var z=rr(),B=mt(z);hr(B,c,$=>{var q=qC();Wo(q,ie=>ot(E,ie),()=>ue(E));let Q;var ae=ct(q);cr(ae,Zr(e),{},null),ut(q),Ct(()=>Q=ji(q,Q,{...l,class:ue(p)},!0,"")),xe($,q)},$=>{var q=rr(),Q=mt(q);cr(Q,Zr(e),{},null),xe($,q)}),xe(i,z),Pr()}var GC=rt("<div><!></div>"),ZC=rt("<input>"),WC=rt("<div><!></div>"),HC=rt("<!> <!> <!> <!>",1);function YC(i){return i&&i==="xs"?"sm":i==="xl"?"lg":i}function qv(i,e){const n=vb(e),l=ur(e,["children","$$slots","$$events","$$legacy"]),p=ur(l,["type","value","size","clearable","defaultClass","color","floatClass"]);Dr(e,!1);const v=xt();let b=oe(e,"type",0,"text"),c=oe(e,"value",12,()=>{}),E=oe(e,"size",8,()=>{}),T=oe(e,"clearable",0,!1),z=oe(e,"defaultClass",0,"block w-full disabled:cursor-not-allowed disabled:opacity-50 rtl:text-right"),B=oe(e,"color",0,"base"),$=oe(e,"floatClass",0,"flex absolute inset-y-0 items-center text-gray-500 dark:text-gray-400");const q=Yh(),Q={base:"border border-gray-300 dark:border-gray-600",tinted:"border border-gray-300 dark:border-gray-500",green:"border border-green-500 dark:border-green-400",red:"border border-red-500 dark:border-red-400"},ae={base:"focus:border-primary-500 focus:ring-primary-500 dark:focus:border-primary-500 dark:focus:ring-primary-500",green:"focus:ring-green-500 focus:border-green-500 dark:focus:border-green-500 dark:focus:ring-green-500",red:"focus:ring-red-500 focus:border-red-500 dark:focus:ring-red-500 dark:focus:border-red-500"},ie={base:"bg-gray-50 text-gray-900 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400",tinted:"bg-gray-50 text-gray-900 dark:bg-gray-600 dark:text-white dark:placeholder-gray-400",green:"bg-green-50 text-green-900 placeholder-green-700 dark:text-green-400 dark:placeholder-green-500 dark:bg-gray-700",red:"bg-red-50 text-red-900 placeholder-red-700 dark:text-red-500 dark:placeholder-red-500 dark:bg-gray-700"};let Y=$i("background"),be=$i("group");const fe={sm:"sm:text-xs",md:"text-sm",lg:"sm:text-base"},de={sm:"ps-9",md:"ps-10",lg:"ps-11"},Se={sm:"pe-9",md:"pe-10",lg:"pe-11"},Me={sm:"p-2",md:"p-2.5",lg:"p-3"};let Ge=xt();const Ee=De=>{De.stopPropagation(),c(void 0),q("change")};bt(()=>ze(E()),()=>{ot(v,E()||YC(be==null?void 0:be.size)||"md")}),bt(()=>(ze(B()),ze(z()),ue(v),ze(T()),ze(l)),()=>{const De=B()==="base"&&Y?"tinted":B();ot(Ge,Ur([z(),Me[ue(v)],n.left&&de[ue(v)]||(T()||n.right)&&Se[ue(v)],ae[B()],ie[De],Q[De],fe[ue(v)],be||"rounded-lg",be&&"first:rounded-s-lg last:rounded-e-lg",be&&"[&:not(:first-child)]:-ms-px",l.class]))}),gi(),Lr();var Ve=Kc(()=>n.left||n.right);iw(i,{class:"relative w-full",get show(){return ue(Ve)},children:(De,qe)=>{var Ze=HC(),Pe=mt(Ze);hr(Pe,()=>n.left,gt=>{var _t;var Ne=GC();Ct(()=>kn(Ne,`${Ur($(),l.classLeft)??""} start-0 ps-2.5 pointer-events-none`));var ht=ct(Ne);cr(ht,(_t=e.$$slots)==null?void 0:_t.left,{},null),ut(Ne),xe(gt,Ne)});var $e=Ae(Ae(Pe,!0));cr($e,Zr(e),{get props(){return{...p,class:ue(Ge)}}},gt=>{var Ne=ZC();fy(Ne);let ht;Ct(()=>ht=ji(Ne,ht,{...p,type:b(),class:ue(Ge)},!0,"")),py(Ne,c,_t=>c(_t)),Qe("blur",Ne,function(_t){Xe.call(this,e,_t)}),Qe("change",Ne,function(_t){Xe.call(this,e,_t)}),Qe("click",Ne,function(_t){Xe.call(this,e,_t)}),Qe("contextmenu",Ne,function(_t){Xe.call(this,e,_t)}),Qe("focus",Ne,function(_t){Xe.call(this,e,_t)}),Qe("keydown",Ne,function(_t){Xe.call(this,e,_t)}),Qe("keypress",Ne,function(_t){Xe.call(this,e,_t)}),Qe("keyup",Ne,function(_t){Xe.call(this,e,_t)}),Qe("mouseover",Ne,function(_t){Xe.call(this,e,_t)}),Qe("mouseenter",Ne,function(_t){Xe.call(this,e,_t)}),Qe("mouseleave",Ne,function(_t){Xe.call(this,e,_t)}),Qe("paste",Ne,function(_t){Xe.call(this,e,_t)}),Qe("input",Ne,function(_t){Xe.call(this,e,_t)}),xe(gt,Ne)});var We=Ae(Ae($e,!0));hr(We,()=>n.right,gt=>{var _t;var Ne=WC();Ct(()=>kn(Ne,`${Ur($(),l.classRight)??""} end-0 pe-2.5`));var ht=ct(Ne);cr(ht,(_t=e.$$slots)==null?void 0:_t.right,{},null),ut(Ne),xe(gt,Ne)});var Je=Ae(Ae(We,!0));hr(Je,()=>T()&&c()&&`${c()}`.length>0,gt=>{var Ne=Kc(()=>` ${Ur($(),l.classRight)??""} focus:ring-0 end-6 focus:ring-gray-400 dark:text-white`);W1(gt,{get size(){return E()},color:"none",get class(){return ue(Ne)},$$events:{click:Ee},$$legacy:!0})}),xe(De,Ze)},$$slots:{default:!0},$$legacy:!0}),Pr()}function KC(i){const e=Math.cos(i*Math.PI*.5);return Math.abs(e)<1e-14?1:1-e}var XC=ss('<svg><path d="M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z"></path><path d="M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z"></path></svg>');function JC(i,e){const n=ur(e,["children","$$slots","$$events","$$legacy"]),l=ur(n,["color","bg","customColor","size","currentFill","currentColor"]);Dr(e,!1);let p=oe(e,"color",4,"primary"),v=oe(e,"bg",0,"text-gray-300"),b=oe(e,"customColor",0,""),c=oe(e,"size",0,"8"),E=oe(e,"currentFill",0,"currentFill"),T=oe(e,"currentColor",0,"currentColor"),z=`w-${c()} h-${c()}`;E()!=="currentFill"&&p(void 0);const B={primary:"fill-primary-600",blue:"fill-blue-600",gray:"fill-gray-600 dark:fill-gray-300",green:"fill-green-500",red:"fill-red-600",yellow:"fill-yellow-400",pink:"fill-pink-600",purple:"fill-purple-600",white:"fill-white",custom:b()};let $=p()===void 0?"":B[p()]??B.blue;Lr();var q=XC();let Q;var ae=ct(q),ie=Ae(ae);ut(q),Ct(()=>{Q=ji(q,Q,{...l,role:"status",class:Ur("inline -mt-px animate-spin dark:text-gray-600",z,v(),$,n.class),viewBox:"0 0 100 101",fill:"none",xmlns:"http://www.w3.org/2000/svg"},!1,""),yn(ae,"fill",T()),yn(ie,"fill",E())}),xe(i,q),Pr()}var QC=ss('<svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path></svg>'),eM=rt('<div><label for="table-search" class="sr-only">Search</label> <div><div><!></div> <input type="text" id="table-search"></div> <!></div>'),tM=rt("<div><!> <table><!></table></div>");function Pp(i,e){const n=ur(e,["children","$$slots","$$events","$$legacy"]),l=ur(n,["divClass","striped","hoverable","noborder","shadow","color","customeColor","items","filter","placeholder","innerDivClass","searchClass","svgDivClass","svgClass","inputClass"]);Dr(e,!1);let p=oe(e,"divClass",0,"relative overflow-x-auto"),v=oe(e,"striped",0,!1),b=oe(e,"hoverable",0,!1),c=oe(e,"noborder",0,!1),E=oe(e,"shadow",0,!1),T=oe(e,"color",0,"default"),z=oe(e,"customeColor",0,""),B=oe(e,"items",8,()=>[]),$=oe(e,"filter",0,null),q=oe(e,"placeholder",0,"Search"),Q=oe(e,"innerDivClass",0,"p-4"),ae=oe(e,"searchClass",0,"relative mt-1"),ie=oe(e,"svgDivClass",0,"absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none"),Y=oe(e,"svgClass",0,"w-5 h-5 text-gray-500 dark:text-gray-400"),be=oe(e,"inputClass",0,"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-80 p-2.5 ps-10 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"),fe=xt(""),de=Ur(be(),n.classInput),Se=Ur(ie(),n.classSvgDiv);const Me={default:"text-gray-500 dark:text-gray-400",blue:"text-blue-100 dark:text-blue-100",green:"text-green-100 dark:text-green-100",red:"text-red-100 dark:text-red-100",yellow:"text-yellow-100 dark:text-yellow-100",purple:"text-purple-100 dark:text-purple-100",indigo:"text-indigo-100 dark:text-indigo-100",pink:"text-pink-100 dark:text-pink-100",custom:z()},Ge=hi(ue(fe)),Ee=hi($());jn("searchTerm",Ge),jn("filter",Ee),jn("sorter",hi(null)),bt(()=>ze(v()),()=>{jn("striped",v())}),bt(()=>ze(b()),()=>{jn("hoverable",b())}),bt(()=>ze(c()),()=>{jn("noborder",c())}),bt(()=>ze(T()),()=>{jn("color",T())}),bt(()=>ze(B()),()=>{jn("items",B())}),bt(()=>ue(fe),()=>{Ge.set(ue(fe))}),bt(()=>ze($()),()=>{$()&&Ee.set($())}),gi(),Lr();var Ve=tM();Ct(()=>kn(Ve,Wy(p(),E()&&"shadow-md sm:rounded-lg")));var De=ct(Ve);hr(De,$,$e=>{var gt;var We=rr(),Je=mt(We);cr(Je,(gt=e.$$slots)==null?void 0:gt.search,{},Ne=>{var or,wt;var ht=eM(),_t=ct(ht),er=Ae(Ae(_t,!0)),Xt=ct(er);kn(Xt,Se);var ar=ct(Xt);cr(ar,(or=e.$$slots)==null?void 0:or.svgSearch,{},je=>{var Pt=QC();ct(Pt),ut(Pt),Ct(()=>Sb(Pt,Y())),xe(je,Pt)}),ut(Xt);var dt=Ae(Ae(Xt,!0));fy(dt),kn(dt,de),ut(er);var Nt=Ae(Ae(er,!0));cr(Nt,(wt=e.$$slots)==null?void 0:wt.header,{},null),ut(ht),Ct(()=>{kn(ht,Q()),kn(er,ae()),yn(dt,"placeholder",q())}),py(dt,()=>ue(fe),je=>ot(fe,je)),xe(Ne,ht)}),xe($e,We)});var qe=Ae(Ae(De,!0));let Ze;var Pe=ct(qe);cr(Pe,Zr(e),{},null),ut(qe),ut(Ve),Ct(()=>Ze=ji(qe,Ze,{...l,class:Ur("w-full text-left text-sm",Me[T()],n.class)},!0,"")),xe(i,Ve),Pr()}var rM=rt("<tbody><!><!></tbody>");function Lp(i,e){const n=ur(e,["children","$$slots","$$events","$$legacy"]),l=ur(n,["tableBodyClass"]);Dr(e,!1);const p=An(),v=()=>Ir($,"$filter",p),b=()=>Ir(q,"$searchTerm",p),c=()=>Ir(Q,"$sorter",p),E=xt(),T=xt(),z=xt();let B=oe(e,"tableBodyClass",8,()=>{}),$=$i("filter"),q=$i("searchTerm"),Q=$i("sorter");bt(()=>{},()=>{ot(E,$i("items")||[])}),bt(()=>(v(),ue(E),b()),()=>{ot(T,v()?ue(E).filter(fe=>v()(fe,b())):ue(E))}),bt(()=>(c(),ue(T)),()=>{ot(z,c()?ue(T).toSorted((fe,de)=>c().sortDirection*c().sort(fe,de)):ue(T))}),gi(),Lr();var ae=rM();let ie;var Y=ct(ae);cr(Y,Zr(e),{},null);var be=Ae(Y);Fa(be,1,()=>ue(z),Ra,(fe,de,Se)=>{var Ee;var Me=rr(),Ge=mt(Me);cr(Ge,(Ee=e.$$slots)==null?void 0:Ee.row,{get item(){return Ni(de)}},null),xe(fe,Me)}),ut(ae),Ct(()=>ie=ji(ae,ie,{...l,class:B()},!0,"")),xe(i,ae),Pr()}var iM=rt("<button><!></button>"),nM=rt("<td><!></td>");function Hs(i,e){const n=ur(e,["children","$$slots","$$events","$$legacy"]),l=ur(n,["tdClass"]);Dr(e,!1);let p=oe(e,"tdClass",0,"px-6 py-4 whitespace-nowrap font-medium "),v=xt("default");ot(v,$i("color"));let b=xt();bt(()=>(ze(p()),ue(v),ze(n)),()=>{ot(b,Ur(p(),ue(v)==="default"?"text-gray-900 dark:text-white":"text-blue-50 whitespace-nowrap dark:text-blue-100",n.class))}),gi(),Lr();var c=nM();let E;var T=ct(c);hr(T,()=>n.onclick,z=>{var B=iM(),$=ct(B);cr($,Zr(e),{},null),ut(B),Qe("click",B,n.onclick,!1),xe(z,B)},z=>{var B=rr(),$=mt(B);cr($,Zr(e),{},null),xe(z,B)}),ut(c),Ct(()=>E=ji(c,E,{...l,class:ue(b)},!0,"")),xe(i,c),Pr()}var sM=rt("<tr><!></tr>");function zp(i,e){const n=ur(e,["children","$$slots","$$events","$$legacy"]),l=ur(n,["color"]);Dr(e,!1);let p=oe(e,"color",8,()=>$i("color"));const v={default:"bg-white dark:bg-gray-800 dark:border-gray-700",blue:"bg-blue-500 border-blue-400",green:"bg-green-500 border-green-400",red:"bg-red-500 border-red-400",yellow:"bg-yellow-500 border-yellow-400",purple:"bg-purple-500 border-purple-400",custom:""},b={default:"hover:bg-gray-50 dark:hover:bg-gray-600",blue:"hover:bg-blue-400",green:"hover:bg-green-400",red:"hover:bg-red-400",yellow:"hover:bg-yellow-400",purple:"hover:bg-purple-400",custom:""},c={default:"odd:bg-white even:bg-gray-50 odd:dark:bg-gray-800 even:dark:bg-gray-700",blue:"odd:bg-blue-800 even:bg-blue-700 odd:dark:bg-blue-800 even:dark:bg-blue-700",green:"odd:bg-green-800 even:bg-green-700 odd:dark:bg-green-800 even:dark:bg-green-700",red:"odd:bg-red-800 even:bg-red-700 odd:dark:bg-red-800 even:dark:bg-red-700",yellow:"odd:bg-yellow-800 even:bg-yellow-700 odd:dark:bg-yellow-800 even:dark:bg-yellow-700",purple:"odd:bg-purple-800 even:bg-purple-700 odd:dark:bg-purple-800 even:dark:bg-purple-700",custom:""};let E=xt();bt(()=>(ze(p()),ze(n)),()=>{ot(E,Ur([!$i("noborder")&&"border-b last:border-b-0",v[p()],$i("hoverable")&&b[p()],$i("striped")&&c[p()],n.class]))}),gi(),Lr();var T=sM();let z;var B=ct(T);cr(B,Zr(e),{},null),ut(T),Ct(()=>z=ji(T,z,{...l,class:ue(E)},!0,"")),Qe("click",T,function($){Xe.call(this,e,$)}),Qe("contextmenu",T,function($){Xe.call(this,e,$)}),Qe("dblclick",T,function($){Xe.call(this,e,$)}),xe(i,T),Pr()}var aM=rt("<tr><!></tr>"),oM=rt("<thead><!></thead>");function Bp(i,e){const n=ur(e,["children","$$slots","$$events","$$legacy"]),l=ur(n,["theadClass","defaultRow"]);Dr(e,!1);const p=xt();let v=oe(e,"theadClass",0,"text-xs uppercase"),b=oe(e,"defaultRow",0,!0),c=xt();ot(c,$i("color"));let E=$i("noborder"),T=$i("striped");const B={default:E||T?"":"bg-gray-50 dark:bg-gray-700",blue:"bg-blue-600",green:"bg-green-600",red:"bg-red-600",yellow:"bg-yellow-600",purple:"bg-purple-600",custom:""};let $=ue(c)==="default"?"text-gray-700 dark:text-gray-400":ue(c)==="custom"?"":"text-white  dark:text-white",q=T?"":ue(c)==="default"?"border-gray-700":ue(c)==="custom"?"":`border-${ue(c)}-400`;bt(()=>(ze(v()),ue(c),ze(n)),()=>{ot(p,Ur(v(),$,T&&q,B[ue(c)],n.class))}),gi(),Lr();var Q=oM();let ae;var ie=ct(Q);hr(ie,b,Y=>{var be=aM(),fe=ct(be);cr(fe,Zr(e),{},null),ut(be),xe(Y,be)},Y=>{var be=rr(),fe=mt(be);cr(fe,Zr(e),{},null),xe(Y,be)}),ut(Q),Ct(()=>ae=ji(Q,ae,{...l,class:ue(p)},!0,"")),xe(i,Q),Pr()}var lM=rt("<th><button><!></button></th>"),cM=rt("<th><!></th>");function Ds(i,e){const n=ur(e,["children","$$slots","$$events","$$legacy"]),l=ur(n,["padding","sort","defaultDirection","defaultSort","direction"]);Dr(e,!1);const p=An(),v=()=>Ir(B,"$sorter",p);let b=oe(e,"padding",0,"px-6 py-3"),c=oe(e,"sort",0,null),E=oe(e,"defaultDirection",0,"asc"),T=oe(e,"defaultSort",0,!1),z=oe(e,"direction",12,()=>T()?E():null),B=$i("sorter"),$=Math.random().toString(36).substring(2);T()&&q();function q(){!c()||!B||B.update(ie=>({id:$,sort:c(),sortDirection:(ie==null?void 0:ie.id)===$?-ie.sortDirection:E()==="asc"?1:-1}))}bt(()=>v(),()=>{var ie;z(((ie=v())==null?void 0:ie.id)===$?v().sortDirection===1?"asc":"desc":null)}),gi(),Lr();var Q=rr(),ae=mt(Q);hr(ae,()=>c()&&B,ie=>{var Y=lM();let be;var fe=ct(Y);Ct(()=>kn(fe,Ur("w-full text-left","after:absolute after:pl-3",z()==="asc"&&'after:content-["▲"]',z()==="desc"&&'after:content-["▼"]',b())));var de=ct(fe);cr(de,Zr(e),{},null),ut(fe),ut(Y),Ct(()=>be=ji(Y,be,{...l,class:n.class,"aria-sort":z()?`${z()}ending`:void 0},!0,"")),Qe("click",Y,function(Se){Xe.call(this,e,Se)}),Qe("focus",Y,function(Se){Xe.call(this,e,Se)}),Qe("keydown",Y,function(Se){Xe.call(this,e,Se)}),Qe("keypress",Y,function(Se){Xe.call(this,e,Se)}),Qe("keyup",Y,function(Se){Xe.call(this,e,Se)}),Qe("mouseenter",Y,function(Se){Xe.call(this,e,Se)}),Qe("mouseleave",Y,function(Se){Xe.call(this,e,Se)}),Qe("mouseover",Y,function(Se){Xe.call(this,e,Se)}),Qe("click",fe,q,!1),xe(ie,Y)},ie=>{var Y=cM();let be;var fe=ct(Y);cr(fe,Zr(e),{},null),ut(Y),Ct(()=>be=ji(Y,be,{...l,class:Ur(b(),n.class)},!0,"")),Qe("click",Y,function(de){Xe.call(this,e,de)}),Qe("focus",Y,function(de){Xe.call(this,e,de)}),Qe("keydown",Y,function(de){Xe.call(this,e,de)}),Qe("keypress",Y,function(de){Xe.call(this,e,de)}),Qe("keyup",Y,function(de){Xe.call(this,e,de)}),Qe("mouseenter",Y,function(de){Xe.call(this,e,de)}),Qe("mouseleave",Y,function(de){Xe.call(this,e,de)}),Qe("mouseover",Y,function(de){Xe.call(this,e,de)}),xe(ie,Y)}),xe(i,Q),Pr()}var uM=rt('<div class="hidden tab_content_placeholder"><div><!></div></div>'),hM=rt('<li role="presentation"><button><!></button> <!></li>');function Sf(i,e){var fe;const n=ur(e,["children","$$slots","$$events","$$legacy"]),l=ur(n,["open","title","activeClasses","inactiveClasses","defaultClass","divClass"]);Dr(e,!1);let p=oe(e,"open",4,!1),v=oe(e,"title",0,"Tab title"),b=oe(e,"activeClasses",8,()=>{}),c=oe(e,"inactiveClasses",8,()=>{}),E=oe(e,"defaultClass",0,"inline-block text-sm font-medium text-center disabled:cursor-not-allowed"),T=oe(e,"divClass",0,"");const z=$i("ctx")??{},B=z.selected??hi();function $(de){return B.set(de),{destroy:B.subscribe(Me=>{Me!==de&&p(!1)})}}let q=xt();bt(()=>(ze(E()),ze(p()),ze(b()),ze(c())),()=>{ot(q,Ur(E(),p()?b()??z.activeClasses:c()??z.inactiveClasses,p()&&"active"))}),gi(),Lr();var Q=hM();Ct(()=>kn(Q,Ur("group",n.class)));var ae=ct(Q);let ie;var Y=ct(ae);cr(Y,(fe=e.$$slots)==null?void 0:fe.title,{},de=>{var Se=bs();Ct(()=>Ei(Se,v())),xe(de,Se)}),ut(ae);var be=Ae(Ae(ae,!0));hr(be,p,de=>{var Se=uM(),Me=ct(Se),Ge=ct(Me);cr(Ge,Zr(e),{},null),ut(Me),ut(Se),Ct(()=>kn(Me,T())),Ho(Me,Ee=>$(Ee)),xe(de,Se)}),ut(Q),Ct(()=>ie=ji(ae,ie,{type:"button",role:"tab",...l,class:ue(q)},!0,"")),Qe("click",ae,()=>p(!0),!1),Qe("blur",ae,function(de){Xe.call(this,e,de)}),Qe("click",ae,function(de){Xe.call(this,e,de)}),Qe("contextmenu",ae,function(de){Xe.call(this,e,de)}),Qe("focus",ae,function(de){Xe.call(this,e,de)}),Qe("keydown",ae,function(de){Xe.call(this,e,de)}),Qe("keypress",ae,function(de){Xe.call(this,e,de)}),Qe("keyup",ae,function(de){Xe.call(this,e,de)}),Qe("mouseenter",ae,function(de){Xe.call(this,e,de)}),Qe("mouseleave",ae,function(de){Xe.call(this,e,de)}),Qe("mouseover",ae,function(de){Xe.call(this,e,de)}),xe(i,Q),Pr()}var dM=rt('<div class="h-px bg-gray-200 dark:bg-gray-700"></div>'),fM=rt('<ul><!></ul> <!> <div role="tabpanel" aria-labelledby="id-tab"></div>',1);function pM(i,e){const n=ur(e,["children","$$slots","$$events","$$legacy"]),l=ur(n,["tabStyle","defaultClass","contentClass","divider","activeClasses","inactiveClasses"]);Dr(e,!1);const p=xt();let v=oe(e,"tabStyle",0,"none"),b=oe(e,"defaultClass",0,"flex flex-wrap space-x-2 rtl:space-x-reverse"),c=oe(e,"contentClass",0,"p-4 bg-gray-50 rounded-lg dark:bg-gray-800 mt-4"),E=oe(e,"divider",4,!0),T=oe(e,"activeClasses",0,"p-4 text-primary-600 bg-gray-100 rounded-t-lg dark:bg-gray-800 dark:text-primary-500"),z=oe(e,"inactiveClasses",0,"p-4 text-gray-500 rounded-t-lg hover:text-gray-600 hover:bg-gray-50 dark:text-gray-400 dark:hover:bg-gray-800 dark:hover:text-gray-300");const B={full:"p-4 w-full group-first:rounded-s-lg group-last:rounded-e-lg text-gray-900 bg-gray-100 focus:ring-4 focus:ring-primary-300 focus:outline-none dark:bg-gray-700 dark:text-white",pill:"py-3 px-4 text-white bg-primary-600 rounded-lg",underline:"p-4 text-primary-600 border-b-2 border-primary-600 dark:text-primary-500 dark:border-primary-500",none:""},$={full:"p-4 w-full group-first:rounded-s-lg group-last:rounded-e-lg text-gray-500 dark:text-gray-400 bg-white hover:text-gray-700 hover:bg-gray-50 focus:ring-4 focus:ring-primary-300 focus:outline-none dark:hover:text-white dark:bg-gray-800 dark:hover:bg-gray-700",pill:"py-3 px-4 text-gray-500 rounded-lg hover:text-gray-900 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-800 dark:hover:text-white",underline:"p-4 border-b-2 border-transparent hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300 text-gray-500 dark:text-gray-400",none:""},q={activeClasses:B[v()]||T(),inactiveClasses:$[v()]||z(),selected:hi()};jn("ctx",q);function Q(Se){return{destroy:q.selected.subscribe(Ge=>{Ge&&Se.replaceChildren(Ge)})}}bt(()=>(ze(E()),ze(v())),()=>{E(["full","pill"].includes(v())?!1:E())}),bt(()=>(ze(b()),ze(v()),ze(n)),()=>{ot(p,Ur(b(),v()==="underline"&&"-mb-px",n.class))}),gi(),Lr();var ae=fM(),ie=mt(ae);let Y;var be=ct(ie);cr(be,Zr(e),{get tabStyle(){return v()}},null),ut(ie);var fe=Ae(Ae(ie,!0));hr(fe,E,Se=>{var Ee;var Me=rr(),Ge=mt(Me);cr(Ge,(Ee=e.$$slots)==null?void 0:Ee.divider,{},Ve=>{var De=dM();xe(Ve,De)}),xe(Se,Me)});var de=Ae(Ae(fe,!0));Ct(()=>{Y=ji(ie,Y,{...l,class:ue(p)},!0,""),kn(de,c())}),Ho(de,Se=>Q(Se)),xe(i,ae),Pr()}var mM=ss("<title> </title>"),gM=ss("<desc> </desc>"),yM=ss('<svg><!><!><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" d="m8 10 4 4 4-4"></path></svg>'),_M=ss("<title> </title>"),vM=ss("<desc> </desc>"),bM=ss('<svg><!><!><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" d="m8 10 4 4 4-4"></path></svg>');function xM(i,e){const n=ur(e,["children","$$slots","$$events","$$legacy"]),l=ur(n,["size","role","color","withEvents","title","strokeWidth","desc","ariaLabel"]);Dr(e,!1);const p=$i("iconCtx")??{},v={xs:"w-3 h-3",sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6",xl:"w-8 h-8"};let b=oe(e,"size",8,()=>p.size||"md"),c=oe(e,"role",8,()=>p.role||"img"),E=oe(e,"color",8,()=>p.color||"currentColor"),T=oe(e,"withEvents",8,()=>p.withEvents||!1),z=oe(e,"title",8,()=>({})),B=oe(e,"strokeWidth",8,()=>p.strokeWidth||"2"),$=oe(e,"desc",8,()=>({})),q=`${z().id||""} ${$().id||""}`,Q=xt(!1),ae=oe(e,"ariaLabel",0,"chevron down outline");bt(()=>(ze(z()),ze($())),()=>{z().id||$().id?ot(Q,!0):ot(Q,!1)}),gi(),Lr();var ie=rr(),Y=mt(ie);hr(Y,T,be=>{var fe=yM();let de;var Se=ct(fe);hr(Se,()=>z().id&&z().title,Ee=>{var Ve=mM(),De=ct(Ve);ut(Ve),Ct(()=>{yn(Ve,"id",z().id),Ei(De,z().title)}),xe(Ee,Ve)});var Me=Ae(Se);hr(Me,()=>$().id&&$().desc,Ee=>{var Ve=gM(),De=ct(Ve);ut(Ve),Ct(()=>{yn(Ve,"id",$().id),Ei(De,$().desc)}),xe(Ee,Ve)});var Ge=Ae(Me);ut(fe),Ct(()=>{de=ji(fe,de,{xmlns:"http://www.w3.org/2000/svg",fill:"none",color:E(),...l,class:Ur("shrink-0",v[b()??"md"],n.class),role:c(),"aria-label":ae(),"aria-describedby":ue(Q)?q:void 0,viewBox:"0 0 24 24"},!1,""),yn(Ge,"stroke-width",B())}),Qe("click",fe,function(Ee){Xe.call(this,e,Ee)}),Qe("keydown",fe,function(Ee){Xe.call(this,e,Ee)}),Qe("keyup",fe,function(Ee){Xe.call(this,e,Ee)}),Qe("focus",fe,function(Ee){Xe.call(this,e,Ee)}),Qe("blur",fe,function(Ee){Xe.call(this,e,Ee)}),Qe("mouseenter",fe,function(Ee){Xe.call(this,e,Ee)}),Qe("mouseleave",fe,function(Ee){Xe.call(this,e,Ee)}),Qe("mouseover",fe,function(Ee){Xe.call(this,e,Ee)}),Qe("mouseout",fe,function(Ee){Xe.call(this,e,Ee)}),xe(be,fe)},be=>{var fe=bM();let de;var Se=ct(fe);hr(Se,()=>z().id&&z().title,Ee=>{var Ve=_M(),De=ct(Ve);ut(Ve),Ct(()=>{yn(Ve,"id",z().id),Ei(De,z().title)}),xe(Ee,Ve)});var Me=Ae(Se);hr(Me,()=>$().id&&$().desc,Ee=>{var Ve=vM(),De=ct(Ve);ut(Ve),Ct(()=>{yn(Ve,"id",$().id),Ei(De,$().desc)}),xe(Ee,Ve)});var Ge=Ae(Me);ut(fe),Ct(()=>{de=ji(fe,de,{xmlns:"http://www.w3.org/2000/svg",fill:"none",color:E(),...l,class:Ur("shrink-0",v[b()??"md"],n.class),role:c(),"aria-label":ae(),"aria-describedby":ue(Q)?q:void 0,viewBox:"0 0 24 24"},!1,""),yn(Ge,"stroke-width",B())}),xe(be,fe)}),xe(i,ie),Pr()}var wM=ss("<title> </title>"),SM=ss("<desc> </desc>"),IM=ss('<svg><!><!><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" d="m10 16 4-4-4-4"></path></svg>'),TM=ss("<title> </title>"),kM=ss("<desc> </desc>"),AM=ss('<svg><!><!><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" d="m10 16 4-4-4-4"></path></svg>');function nw(i,e){const n=ur(e,["children","$$slots","$$events","$$legacy"]),l=ur(n,["size","role","color","withEvents","title","strokeWidth","desc","ariaLabel"]);Dr(e,!1);const p=$i("iconCtx")??{},v={xs:"w-3 h-3",sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6",xl:"w-8 h-8"};let b=oe(e,"size",8,()=>p.size||"md"),c=oe(e,"role",8,()=>p.role||"img"),E=oe(e,"color",8,()=>p.color||"currentColor"),T=oe(e,"withEvents",8,()=>p.withEvents||!1),z=oe(e,"title",8,()=>({})),B=oe(e,"strokeWidth",8,()=>p.strokeWidth||"2"),$=oe(e,"desc",8,()=>({})),q=`${z().id||""} ${$().id||""}`,Q=xt(!1),ae=oe(e,"ariaLabel",0,"chevron right outline");bt(()=>(ze(z()),ze($())),()=>{z().id||$().id?ot(Q,!0):ot(Q,!1)}),gi(),Lr();var ie=rr(),Y=mt(ie);hr(Y,T,be=>{var fe=IM();let de;var Se=ct(fe);hr(Se,()=>z().id&&z().title,Ee=>{var Ve=wM(),De=ct(Ve);ut(Ve),Ct(()=>{yn(Ve,"id",z().id),Ei(De,z().title)}),xe(Ee,Ve)});var Me=Ae(Se);hr(Me,()=>$().id&&$().desc,Ee=>{var Ve=SM(),De=ct(Ve);ut(Ve),Ct(()=>{yn(Ve,"id",$().id),Ei(De,$().desc)}),xe(Ee,Ve)});var Ge=Ae(Me);ut(fe),Ct(()=>{de=ji(fe,de,{xmlns:"http://www.w3.org/2000/svg",fill:"none",color:E(),...l,class:Ur("shrink-0",v[b()??"md"],n.class),role:c(),"aria-label":ae(),"aria-describedby":ue(Q)?q:void 0,viewBox:"0 0 24 24"},!1,""),yn(Ge,"stroke-width",B())}),Qe("click",fe,function(Ee){Xe.call(this,e,Ee)}),Qe("keydown",fe,function(Ee){Xe.call(this,e,Ee)}),Qe("keyup",fe,function(Ee){Xe.call(this,e,Ee)}),Qe("focus",fe,function(Ee){Xe.call(this,e,Ee)}),Qe("blur",fe,function(Ee){Xe.call(this,e,Ee)}),Qe("mouseenter",fe,function(Ee){Xe.call(this,e,Ee)}),Qe("mouseleave",fe,function(Ee){Xe.call(this,e,Ee)}),Qe("mouseover",fe,function(Ee){Xe.call(this,e,Ee)}),Qe("mouseout",fe,function(Ee){Xe.call(this,e,Ee)}),xe(be,fe)},be=>{var fe=AM();let de;var Se=ct(fe);hr(Se,()=>z().id&&z().title,Ee=>{var Ve=TM(),De=ct(Ve);ut(Ve),Ct(()=>{yn(Ve,"id",z().id),Ei(De,z().title)}),xe(Ee,Ve)});var Me=Ae(Se);hr(Me,()=>$().id&&$().desc,Ee=>{var Ve=kM(),De=ct(Ve);ut(Ve),Ct(()=>{yn(Ve,"id",$().id),Ei(De,$().desc)}),xe(Ee,Ve)});var Ge=Ae(Me);ut(fe),Ct(()=>{de=ji(fe,de,{xmlns:"http://www.w3.org/2000/svg",fill:"none",color:E(),...l,class:Ur("shrink-0",v[b()??"md"],n.class),role:c(),"aria-label":ae(),"aria-describedby":ue(Q)?q:void 0,viewBox:"0 0 24 24"},!1,""),yn(Ge,"stroke-width",B())}),xe(be,fe)}),xe(i,ie),Pr()}var EM=rt('<div style="text-align: left; margin-top: 2.5%; margin-bottom: 5%; "><h1 class="font-large text-grey-800 text-lg lg:text-lg dark:text-gray-200">Search for metrics to preview and download.</h1></div>');function sw(i){var e=EM();ct(e),ut(e),xe(i,e)}let CM=Date.now();function t_(i){return`${i}-${CM++}`}const r_=Symbol.for("svelte-maplibre");function sd(){return $i(r_)}function MM(i){let e=new WeakMap;return n=>{var b;let l=e.get(n.originalEvent);if(l!==void 0)return l;let v=(b=n.target.queryRenderedFeatures(n.point).find(c=>{var E;return(E=i.get(c.layer.id))==null?void 0:E.interactive}))==null?void 0:b.layer.id;return e.set(n.originalEvent,v),v}}function DM(){let i=new Map;return jn(r_,{map:hi(null),source:ug(null),layer:ug(null),popupTarget:ug(null),cluster:hi(),loadedImages:hi(new Set),minzoom:hi(0),maxzoom:hi(24),layerEvent:hi(null),layerInfo:i,eventTopMost:MM(i)})}function Gv(i){return{subscribe:i.subscribe}}function aw({key:i,setPopupTarget:e=!1,setCluster:n=!1,setMouseEvent:l=!1}){let p=sd(),v=hi(null),b=Gv(v),c={...p,[i]:Gv(v)};if(e&&(c.popupTarget=b),l){let E=hi(null);c.layerEvent=E,p.layerEvent=E}return n&&(c.cluster=hi()),jn(r_,c),{...p,self:v}}function PM(){return aw({key:"source",setCluster:!0})}function ow(i=!0){return aw({key:"layer",setPopupTarget:i,setMouseEvent:i})}var LM=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function zM(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var lw={exports:{}};(function(i,e){(function(n,l){i.exports=l()})(LM,function(){var n,l,p;function v(c,E){if(!n)n=E;else if(!l)l=E;else{var T="var sharedChunk = {}; ("+n+")(sharedChunk); ("+l+")(sharedChunk);",z={};n(z),p=E(z),typeof window<"u"&&(p.workerUrl=window.URL.createObjectURL(new Blob([T],{type:"text/javascript"})))}}v(["exports"],function(c){function E(s,t,a,u){return new(a||(a=Promise))(function(d,g){function _(A){try{I(u.next(A))}catch(M){g(M)}}function x(A){try{I(u.throw(A))}catch(M){g(M)}}function I(A){var M;A.done?d(A.value):(M=A.value,M instanceof a?M:new a(function(L){L(M)})).then(_,x)}I((u=u.apply(s,t||[])).next())})}function T(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}typeof SuppressedError=="function"&&SuppressedError;var z=B;function B(s,t){this.x=s,this.y=t}B.prototype={clone:function(){return new B(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,t){return this.clone()._rotateAround(s,t)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var t=s.x-this.x,a=s.y-this.y;return t*t+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,t){return Math.atan2(this.x*t-this.y*s,this.x*s+this.y*t)},_matMult:function(s){var t=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=t,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var t=Math.cos(s),a=Math.sin(s),u=a*this.x+t*this.y;return this.x=t*this.x-a*this.y,this.y=u,this},_rotateAround:function(s,t){var a=Math.cos(s),u=Math.sin(s),d=t.y+u*(this.x-t.x)+a*(this.y-t.y);return this.x=t.x+a*(this.x-t.x)-u*(this.y-t.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},B.convert=function(s){return s instanceof B?s:Array.isArray(s)?new B(s[0],s[1]):s};var $=T(z),q=Q;function Q(s,t,a,u){this.cx=3*s,this.bx=3*(a-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(u-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=t,this.p2x=a,this.p2y=u}Q.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,t){if(t===void 0&&(t=1e-6),s<0)return 0;if(s>1)return 1;for(var a=s,u=0;u<8;u++){var d=this.sampleCurveX(a)-s;if(Math.abs(d)<t)return a;var g=this.sampleCurveDerivativeX(a);if(Math.abs(g)<1e-6)break;a-=d/g}var _=0,x=1;for(a=s,u=0;u<20&&(d=this.sampleCurveX(a),!(Math.abs(d-s)<t));u++)s>d?_=a:x=a,a=.5*(x-_)+_;return a},solve:function(s,t){return this.sampleCurveY(this.solveCurveX(s,t))}};var ae=T(q);let ie,Y;function be(){return ie==null&&(ie=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ie}function fe(){if(Y==null&&(Y=!1,be())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let u=0;u<5*5;u++){const d=4*u;t.fillStyle=`rgb(${d},${d+1},${d+2})`,t.fillRect(u%5,Math.floor(u/5),1,1)}const a=t.getImageData(0,0,5,5).data;for(let u=0;u<5*5*4;u++)if(u%4!=3&&a[u]!==u){Y=!0;break}}}return Y||!1}function de(s,t,a,u){const d=new ae(s,t,a,u);return function(g){return d.solve(g)}}const Se=de(.25,.1,.25,1);function Me(s,t,a){return Math.min(a,Math.max(t,s))}function Ge(s,t,a){const u=a-t,d=((s-t)%u+u)%u+t;return d===t?a:d}function Ee(s,...t){for(const a of t)for(const u in a)s[u]=a[u];return s}let Ve=1;function De(s,t,a){const u={};for(const d in s)u[d]=t.call(a||this,s[d],d,s);return u}function qe(s,t,a){const u={};for(const d in s)t.call(a||this,s[d],d,s)&&(u[d]=s[d]);return u}function Ze(s){return Array.isArray(s)?s.map(Ze):typeof s=="object"&&s?De(s,Ze):s}const Pe={};function $e(s){Pe[s]||(typeof console<"u"&&console.warn(s),Pe[s]=!0)}function We(s,t,a){return(a.y-s.y)*(t.x-s.x)>(t.y-s.y)*(a.x-s.x)}function Je(s){let t=0;for(let a,u,d=0,g=s.length,_=g-1;d<g;_=d++)a=s[d],u=s[_],t+=(u.x-a.x)*(a.y+u.y);return t}function gt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let Ne=null;function ht(s){return typeof ImageBitmap<"u"&&s instanceof ImageBitmap}const _t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function er(s,t,a,u,d){return E(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const g=new VideoFrame(s,{timestamp:0});try{const _=g==null?void 0:g.format;if(!_||!_.startsWith("BGR")&&!_.startsWith("RGB"))throw new Error(`Unrecognized format ${_}`);const x=_.startsWith("BGR"),I=new Uint8ClampedArray(u*d*4);if(yield g.copyTo(I,function(A,M,L,F,U){const V=4*Math.max(-M,0),Z=(Math.max(0,L)-L)*F*4+V,ee=4*F,ne=Math.max(0,M),ye=Math.max(0,L);return{rect:{x:ne,y:ye,width:Math.min(A.width,M+F)-ne,height:Math.min(A.height,L+U)-ye},layout:[{offset:Z,stride:ee}]}}(s,t,a,u,d)),x)for(let A=0;A<I.length;A+=4){const M=I[A];I[A]=I[A+2],I[A+2]=M}return I}finally{g.close()}})}let Xt,ar,dt,Nt;const or={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(s){const t=requestAnimationFrame(s);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(s,t=0){return this.getImageCanvasContext(s).getImageData(-t,-t,s.width+2*t,s.height+2*t)},getImageCanvasContext(s){const t=window.document.createElement("canvas"),a=t.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return t.width=s.width,t.height=s.height,a.drawImage(s,0,0,s.width,s.height),a},resolveURL:s=>(dt||(dt=document.createElement("a")),dt.href=s,dt.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Nt==null&&(Nt=matchMedia("(prefers-reduced-motion: reduce)")),Nt.matches)}},wt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class je extends Error{constructor(t,a,u,d){super(`AJAXError: ${a} (${t}): ${u}`),this.status=t,this.statusText=a,this.url=u,this.body=d}}const Pt=gt()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,zt=s=>wt.REGISTERED_PROTOCOLS[s.substring(0,s.indexOf("://"))];function dr(s,t){const a=new AbortController,u=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,cache:s.cache,referrer:Pt(),signal:a.signal});let d=!1,g=!1;return s.type==="json"&&u.headers.set("Accept","application/json"),g||fetch(u).then(_=>_.ok?(x=>{(s.type==="arrayBuffer"||s.type==="image"?x.arrayBuffer():s.type==="json"?x.json():x.text()).then(I=>{g||(d=!0,t(null,I,x.headers.get("Cache-Control"),x.headers.get("Expires")))}).catch(I=>{g||t(new Error(I.message))})})(_):_.blob().then(x=>t(new je(_.status,_.statusText,s.url,x)))).catch(_=>{_.code!==20&&t(new Error(_.message))}),{cancel:()=>{g=!0,d||a.abort()}}}const ir=function(s,t){if(/:\/\//.test(s.url)&&!/^https?:|^file:/.test(s.url)){if(gt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,t);if(!gt())return(zt(s.url)||dr)(s,t)}if(!(/^file:/.test(a=s.url)||/^file:/.test(Pt())&&!/^\w+:/.test(a))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return dr(s,t);if(gt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,t,void 0,!0)}var a;return function(u,d){const g=new XMLHttpRequest;g.open(u.method||"GET",u.url,!0),u.type!=="arrayBuffer"&&u.type!=="image"||(g.responseType="arraybuffer");for(const _ in u.headers)g.setRequestHeader(_,u.headers[_]);return u.type==="json"&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials=u.credentials==="include",g.onerror=()=>{d(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){let _=g.response;if(u.type==="json")try{_=JSON.parse(g.response)}catch(x){return d(x)}d(null,_,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else{const _=new Blob([g.response],{type:g.getResponseHeader("Content-Type")});d(new je(g.status,g.statusText,u.url,_))}},g.send(u.body),{cancel:()=>g.abort()}}(s,t)},$r=function(s,t){return ir(Ee(s,{type:"arrayBuffer"}),t)};function br(s){if(!s||s.indexOf("://")<=0||s.indexOf("data:image/")===0||s.indexOf("blob:")===0)return!0;const t=new URL(s),a=window.location;return t.protocol===a.protocol&&t.host===a.host}function pr(s,t,a){a[s]&&a[s].indexOf(t)!==-1||(a[s]=a[s]||[],a[s].push(t))}function Kr(s,t,a){if(a&&a[s]){const u=a[s].indexOf(t);u!==-1&&a[s].splice(u,1)}}class ai{constructor(t,a={}){Ee(this,a),this.type=t}}class Gi extends ai{constructor(t,a={}){super("error",Ee({error:t},a))}}class Mi{on(t,a){return this._listeners=this._listeners||{},pr(t,a,this._listeners),this}off(t,a){return Kr(t,a,this._listeners),Kr(t,a,this._oneTimeListeners),this}once(t,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},pr(t,a,this._oneTimeListeners),this):new Promise(u=>this.once(t,u))}fire(t,a){typeof t=="string"&&(t=new ai(t,a||{}));const u=t.type;if(this.listens(u)){t.target=this;const d=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const x of d)x.call(this,t);const g=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const x of g)Kr(u,x,this._oneTimeListeners),x.call(this,t);const _=this._eventedParent;_&&(Ee(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(t))}else t instanceof Gi&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,a){return this._eventedParent=t,this._eventedParentData=a,this}}var Ce={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const di=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Si(s,t){const a={};for(const u in s)u!=="ref"&&(a[u]=s[u]);return di.forEach(u=>{u in t&&(a[u]=t[u])}),a}function mr(s,t){if(Array.isArray(s)){if(!Array.isArray(t)||s.length!==t.length)return!1;for(let a=0;a<s.length;a++)if(!mr(s[a],t[a]))return!1;return!0}if(typeof s=="object"&&s!==null&&t!==null){if(typeof t!="object"||Object.keys(s).length!==Object.keys(t).length)return!1;for(const a in s)if(!mr(s[a],t[a]))return!1;return!0}return s===t}const $t={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function yi(s,t,a){a.push({command:$t.addSource,args:[s,t[s]]})}function Di(s,t,a){t.push({command:$t.removeSource,args:[s]}),a[s]=!0}function Zi(s,t,a,u){Di(s,a,u),yi(s,t,a)}function on(s,t,a){let u;for(u in s[a])if(Object.prototype.hasOwnProperty.call(s[a],u)&&u!=="data"&&!mr(s[a][u],t[a][u]))return!1;for(u in t[a])if(Object.prototype.hasOwnProperty.call(t[a],u)&&u!=="data"&&!mr(s[a][u],t[a][u]))return!1;return!0}function ln(s,t,a,u,d,g){let _;for(_ in t=t||{},s=s||{})Object.prototype.hasOwnProperty.call(s,_)&&(mr(s[_],t[_])||a.push({command:g,args:[u,_,t[_],d]}));for(_ in t)Object.prototype.hasOwnProperty.call(t,_)&&!Object.prototype.hasOwnProperty.call(s,_)&&(mr(s[_],t[_])||a.push({command:g,args:[u,_,t[_],d]}))}function oi(s){return s.id}function Ki(s,t){return s[t.id]=t,s}class Ke{constructor(t,a,u,d){this.message=(t?`${t}: `:"")+u,d&&(this.identifier=d),a!=null&&a.__line__&&(this.line=a.__line__)}}function cn(s,...t){for(const a of t)for(const u in a)s[u]=a[u];return s}class Xr extends Error{constructor(t,a){super(a),this.message=a,this.key=t}}class zn{constructor(t,a=[]){this.parent=t,this.bindings={};for(const[u,d]of a)this.bindings[u]=d}concat(t){return new zn(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const os={kind:"null"},et={kind:"number"},Jt={kind:"string"},Bt={kind:"boolean"},vn={kind:"color"},ls={kind:"object"},tr={kind:"value"},Js={kind:"collator"},K={kind:"formatted"},R={kind:"padding"},O={kind:"resolvedImage"},j={kind:"variableAnchorOffsetCollection"};function J(s,t){return{kind:"array",itemType:s,N:t}}function te(s){if(s.kind==="array"){const t=te(s.itemType);return typeof s.N=="number"?`array<${t}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${t}>`}return s.kind}const _e=[os,et,Jt,Bt,vn,K,ls,J(tr),R,O,j];function he(s,t){if(t.kind==="error")return null;if(s.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!he(s.itemType,t.itemType))&&(typeof s.N!="number"||s.N===t.N))return null}else{if(s.kind===t.kind)return null;if(s.kind==="value"){for(const a of _e)if(!he(a,t))return null}}return`Expected ${te(s)} but found ${te(t)} instead.`}function se(s,t){return t.some(a=>a.kind===s.kind)}function ge(s,t){return t.some(a=>a==="null"?s===null:a==="array"?Array.isArray(s):a==="object"?s&&!Array.isArray(s)&&typeof s=="object":a===typeof s)}function Le(s,t){return s.kind==="array"&&t.kind==="array"?s.itemType.kind===t.itemType.kind&&typeof s.N=="number":s.kind===t.kind}const Be=.96422,Oe=.82521,Mt=4/29,Ut=6/29,St=3*Ut*Ut,Lt=Ut*Ut*Ut,Vt=Math.PI/180,Nr=180/Math.PI;function Wr(s){return(s%=360)<0&&(s+=360),s}function Cr([s,t,a,u]){let d,g;const _=bn((.2225045*(s=Ar(s))+.7168786*(t=Ar(t))+.0606169*(a=Ar(a)))/1);s===t&&t===a?d=g=_:(d=bn((.4360747*s+.3850649*t+.1430804*a)/Be),g=bn((.0139322*s+.0971045*t+.7141733*a)/Oe));const x=116*_-16;return[x<0?0:x,500*(d-_),200*(_-g),u]}function Ar(s){return s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function bn(s){return s>Lt?Math.pow(s,1/3):s/St+Mt}function ti([s,t,a,u]){let d=(s+16)/116,g=isNaN(t)?d:d+t/500,_=isNaN(a)?d:d-a/200;return d=1*un(d),g=Be*un(g),_=Oe*un(_),[Wi(3.1338561*g-1.6168667*d-.4906146*_),Wi(-.9787684*g+1.9161415*d+.033454*_),Wi(.0719453*g-.2289914*d+1.4052427*_),u]}function Wi(s){return(s=s<=.00304?12.92*s:1.055*Math.pow(s,1/2.4)-.055)<0?0:s>1?1:s}function un(s){return s>Ut?s*s*s:St*(s-Mt)}function cs(s){return parseInt(s.padEnd(2,s),16)/255}function ld(s,t){return bo(t?s/100:s,0,1)}function bo(s,t,a){return Math.min(Math.max(t,s),a)}function xo(s){return!s.some(Number.isNaN)}const rm={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class jr{constructor(t,a,u,d=1,g=!0){this.r=t,this.g=a,this.b=u,this.a=d,g||(this.r*=d,this.g*=d,this.b*=d,d||this.overwriteGetter("rgb",[t,a,u,d]))}static parse(t){if(t instanceof jr)return t;if(typeof t!="string")return;const a=function(u){if((u=u.toLowerCase().trim())==="transparent")return[0,0,0,0];const d=rm[u];if(d){const[_,x,I]=d;return[_/255,x/255,I/255,1]}if(u.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(u)){const _=u.length<6?1:2;let x=1;return[cs(u.slice(x,x+=_)),cs(u.slice(x,x+=_)),cs(u.slice(x,x+=_)),cs(u.slice(x,x+_)||"ff")]}if(u.startsWith("rgb")){const _=u.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[x,I,A,M,L,F,U,V,Z,ee,ne,ye]=_,ce=[M||" ",U||" ",ee].join("");if(ce==="  "||ce==="  /"||ce===",,"||ce===",,,"){const ve=[A,F,Z].join(""),Ie=ve==="%%%"?100:ve===""?255:0;if(Ie){const Fe=[bo(+I/Ie,0,1),bo(+L/Ie,0,1),bo(+V/Ie,0,1),ne?ld(+ne,ye):1];if(xo(Fe))return Fe}}return}}const g=u.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[_,x,I,A,M,L,F,U,V]=g,Z=[I||" ",M||" ",F].join("");if(Z==="  "||Z==="  /"||Z===",,"||Z===",,,"){const ee=[+x,bo(+A,0,100),bo(+L,0,100),U?ld(+U,V):1];if(xo(ee))return function([ne,ye,ce,ve]){function Ie(Fe){const pt=(Fe+ne/30)%12,Tt=ye*Math.min(ce,1-ce);return ce-Tt*Math.max(-1,Math.min(pt-3,9-pt,1))}return ne=Wr(ne),ye/=100,ce/=100,[Ie(0),Ie(8),Ie(4),ve]}(ee)}}}(t);return a?new jr(...a,!1):void 0}get rgb(){const{r:t,g:a,b:u,a:d}=this,g=d||1/0;return this.overwriteGetter("rgb",[t/g,a/g,u/g,d])}get hcl(){return this.overwriteGetter("hcl",function(t){const[a,u,d,g]=Cr(t),_=Math.sqrt(u*u+d*d);return[Math.round(1e4*_)?Wr(Math.atan2(d,u)*Nr):NaN,_,a,g]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Cr(this.rgb))}overwriteGetter(t,a){return Object.defineProperty(this,t,{value:a}),a}toString(){const[t,a,u,d]=this.rgb;return`rgba(${[t,a,u].map(g=>Math.round(255*g)).join(",")},${d})`}}jr.black=new jr(0,0,0,1),jr.white=new jr(1,1,1,1),jr.transparent=new jr(0,0,0,0),jr.red=new jr(1,0,0,1);class hu{constructor(t,a,u){this.sensitivity=t?a?"variant":"case":a?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,a){return this.collator.compare(t,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class $l{constructor(t,a,u,d,g){this.text=t,this.image=a,this.scale=u,this.fontStack=d,this.textColor=g}}class xn{constructor(t){this.sections=t}static fromString(t){return new xn([new $l(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof xn?t:xn.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class Zn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Zn)return t;if(typeof t=="number")return new Zn([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const a of t)if(typeof a!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Zn(t)}}toString(){return JSON.stringify(this.values)}}const im=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class us{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof us)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let a=0;a<t.length;a+=2){const u=t[a],d=t[a+1];if(typeof u!="string"||!im.has(u)||!Array.isArray(d)||d.length!==2||typeof d[0]!="number"||typeof d[1]!="number")return}return new us(t)}}toString(){return JSON.stringify(this.values)}}class hn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new hn({name:t,available:!1}):null}}function Vl(s,t,a,u){return typeof s=="number"&&s>=0&&s<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof a=="number"&&a>=0&&a<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[s,t,a,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[s,t,a,u]:[s,t,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function wo(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof jr||s instanceof hu||s instanceof xn||s instanceof Zn||s instanceof us||s instanceof hn)return!0;if(Array.isArray(s)){for(const t of s)if(!wo(t))return!1;return!0}if(typeof s=="object"){for(const t in s)if(!wo(s[t]))return!1;return!0}return!1}function _i(s){if(s===null)return os;if(typeof s=="string")return Jt;if(typeof s=="boolean")return Bt;if(typeof s=="number")return et;if(s instanceof jr)return vn;if(s instanceof hu)return Js;if(s instanceof xn)return K;if(s instanceof Zn)return R;if(s instanceof us)return j;if(s instanceof hn)return O;if(Array.isArray(s)){const t=s.length;let a;for(const u of s){const d=_i(u);if(a){if(a===d)continue;a=tr;break}a=d}return J(a||tr,t)}return ls}function zr(s){const t=typeof s;return s===null?"":t==="string"||t==="number"||t==="boolean"?String(s):s instanceof jr||s instanceof xn||s instanceof Zn||s instanceof us||s instanceof hn?s.toString():JSON.stringify(s)}class qa{constructor(t,a){this.type=t,this.value=a}static parse(t,a){if(t.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!wo(t[1]))return a.error("invalid value");const u=t[1];let d=_i(u);const g=a.expectedType;return d.kind!=="array"||d.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(d=g),new qa(d,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ii{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const jl={string:Jt,number:et,boolean:Bt,object:ls};class hs{constructor(t,a){this.type=t,this.args=a}static parse(t,a){if(t.length<2)return a.error("Expected at least one argument.");let u,d=1;const g=t[0];if(g==="array"){let x,I;if(t.length>2){const A=t[1];if(typeof A!="string"||!(A in jl)||A==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);x=jl[A],d++}else x=tr;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return a.error('The length argument to "array" must be a positive integer literal',2);I=t[2],d++}u=J(x,I)}else{if(!jl[g])throw new Error(`Types doesn't contain name = ${g}`);u=jl[g]}const _=[];for(;d<t.length;d++){const x=a.parse(t[d],d,tr);if(!x)return null;_.push(x)}return new hs(u,_)}evaluate(t){for(let a=0;a<this.args.length;a++){const u=this.args[a].evaluate(t);if(!he(this.type,_i(u)))return u;if(a===this.args.length-1)throw new Ii(`Expected value to be of type ${te(this.type)}, but found ${te(_i(u))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const du={"to-boolean":Bt,"to-color":vn,"to-number":et,"to-string":Jt};class _a{constructor(t,a){this.type=t,this.args=a}static parse(t,a){if(t.length<2)return a.error("Expected at least one argument.");const u=t[0];if(!du[u])throw new Error(`Can't parse ${u} as it is not part of the known types`);if((u==="to-boolean"||u==="to-string")&&t.length!==2)return a.error("Expected one argument.");const d=du[u],g=[];for(let _=1;_<t.length;_++){const x=a.parse(t[_],_,tr);if(!x)return null;g.push(x)}return new _a(d,g)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let a,u;for(const d of this.args){if(a=d.evaluate(t),u=null,a instanceof jr)return a;if(typeof a=="string"){const g=t.parseColor(a);if(g)return g}else if(Array.isArray(a)&&(u=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:Vl(a[0],a[1],a[2],a[3]),!u))return new jr(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new Ii(u||`Could not parse color from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"padding":{let a;for(const u of this.args){a=u.evaluate(t);const d=Zn.parse(a);if(d)return d}throw new Ii(`Could not parse padding from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"variableAnchorOffsetCollection":{let a;for(const u of this.args){a=u.evaluate(t);const d=us.parse(a);if(d)return d}throw new Ii(`Could not parse variableAnchorOffsetCollection from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"number":{let a=null;for(const u of this.args){if(a=u.evaluate(t),a===null)return 0;const d=Number(a);if(!isNaN(d))return d}throw new Ii(`Could not convert ${JSON.stringify(a)} to number.`)}case"formatted":return xn.fromString(zr(this.args[0].evaluate(t)));case"resolvedImage":return hn.fromString(zr(this.args[0].evaluate(t)));default:return zr(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const cd=["Unknown","Point","LineString","Polygon"];class fu{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?cd[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let a=this._parseColorCache[t];return a||(a=this._parseColorCache[t]=jr.parse(t)),a}}class ql{constructor(t,a,u=[],d,g=new zn,_=[]){this.registry=t,this.path=u,this.key=u.map(x=>`[${x}]`).join(""),this.scope=g,this.errors=_,this.expectedType=d,this._isConstant=a}parse(t,a,u,d,g={}){return a?this.concat(a,u,d)._parse(t,g):this._parse(t,g)}_parse(t,a){function u(d,g,_){return _==="assert"?new hs(g,[d]):_==="coerce"?new _a(g,[d]):d}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=t[0];if(typeof d!="string")return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[d];if(g){let _=g.parse(t,this);if(!_)return null;if(this.expectedType){const x=this.expectedType,I=_.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||I.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||I.kind!=="value"&&I.kind!=="string")if(x.kind!=="padding"||I.kind!=="value"&&I.kind!=="number"&&I.kind!=="array")if(x.kind!=="variableAnchorOffsetCollection"||I.kind!=="value"&&I.kind!=="array"){if(this.checkSubtype(x,I))return null}else _=u(_,x,a.typeAnnotation||"coerce");else _=u(_,x,a.typeAnnotation||"coerce");else _=u(_,x,a.typeAnnotation||"coerce");else _=u(_,x,a.typeAnnotation||"assert")}if(!(_ instanceof qa)&&_.type.kind!=="resolvedImage"&&this._isConstant(_)){const x=new fu;try{_=new qa(_.type,_.evaluate(x))}catch(I){return this.error(I.message),null}}return _}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,a,u){const d=typeof t=="number"?this.path.concat(t):this.path,g=u?this.scope.concat(u):this.scope;return new ql(this.registry,this._isConstant,d,a||null,g,this.errors)}error(t,...a){const u=`${this.key}${a.map(d=>`[${d}]`).join("")}`;this.errors.push(new Xr(u,t))}checkSubtype(t,a){const u=he(t,a);return u&&this.error(u),u}}class Gl{constructor(t,a,u){this.type=Js,this.locale=u,this.caseSensitive=t,this.diacriticSensitive=a}static parse(t,a){if(t.length!==2)return a.error("Expected one argument.");const u=t[1];if(typeof u!="object"||Array.isArray(u))return a.error("Collator options argument must be an object.");const d=a.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,Bt);if(!d)return null;const g=a.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,Bt);if(!g)return null;let _=null;return u.locale&&(_=a.parse(u.locale,1,Jt),!_)?null:new Gl(d,g,_)}evaluate(t){return new hu(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}const va=8192;function pu(s,t){s[0]=Math.min(s[0],t[0]),s[1]=Math.min(s[1],t[1]),s[2]=Math.max(s[2],t[0]),s[3]=Math.max(s[3],t[1])}function il(s,t){return!(s[0]<=t[0]||s[2]>=t[2]||s[1]<=t[1]||s[3]>=t[3])}function ud(s,t){const a=(180+s[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,d=Math.pow(2,t.z);return[Math.round(a*d*va),Math.round(u*d*va)]}function nm(s,t,a){const u=s[0]-t[0],d=s[1]-t[1],g=s[0]-a[0],_=s[1]-a[1];return u*_-g*d==0&&u*g<=0&&d*_<=0}function mu(s,t){let a=!1;for(let _=0,x=t.length;_<x;_++){const I=t[_];for(let A=0,M=I.length;A<M-1;A++){if(nm(s,I[A],I[A+1]))return!1;(d=I[A])[1]>(u=s)[1]!=(g=I[A+1])[1]>u[1]&&u[0]<(g[0]-d[0])*(u[1]-d[1])/(g[1]-d[1])+d[0]&&(a=!a)}}var u,d,g;return a}function gu(s,t){for(let a=0;a<t.length;a++)if(mu(s,t[a]))return!0;return!1}function hd(s,t,a,u){const d=u[0]-a[0],g=u[1]-a[1],_=(s[0]-a[0])*g-d*(s[1]-a[1]),x=(t[0]-a[0])*g-d*(t[1]-a[1]);return _>0&&x<0||_<0&&x>0}function sm(s,t,a){for(const A of a)for(let M=0;M<A.length-1;++M)if((x=[(_=A[M+1])[0]-(g=A[M])[0],_[1]-g[1]])[0]*(I=[(d=t)[0]-(u=s)[0],d[1]-u[1]])[1]-x[1]*I[0]!=0&&hd(u,d,g,_)&&hd(g,_,u,d))return!0;var u,d,g,_,x,I;return!1}function dd(s,t){for(let a=0;a<s.length;++a)if(!mu(s[a],t))return!1;for(let a=0;a<s.length-1;++a)if(sm(s[a],s[a+1],t))return!1;return!0}function fd(s,t){for(let a=0;a<t.length;a++)if(dd(s,t[a]))return!0;return!1}function Zl(s,t,a){const u=[];for(let d=0;d<s.length;d++){const g=[];for(let _=0;_<s[d].length;_++){const x=ud(s[d][_],a);pu(t,x),g.push(x)}u.push(g)}return u}function pd(s,t,a){const u=[];for(let d=0;d<s.length;d++){const g=Zl(s[d],t,a);u.push(g)}return u}function md(s,t,a,u){if(s[0]<a[0]||s[0]>a[2]){const d=.5*u;let g=s[0]-a[0]>d?-u:a[0]-s[0]>d?u:0;g===0&&(g=s[0]-a[2]>d?-u:a[2]-s[0]>d?u:0),s[0]+=g}pu(t,s)}function yu(s,t,a,u){const d=Math.pow(2,u.z)*va,g=[u.x*va,u.y*va],_=[];for(const x of s)for(const I of x){const A=[I.x+g[0],I.y+g[1]];md(A,t,a,d),_.push(A)}return _}function _u(s,t,a,u){const d=Math.pow(2,u.z)*va,g=[u.x*va,u.y*va],_=[];for(const I of s){const A=[];for(const M of I){const L=[M.x+g[0],M.y+g[1]];pu(t,L),A.push(L)}_.push(A)}if(t[2]-t[0]<=d/2){(x=t)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const I of _)for(const A of I)md(A,t,a,d)}var x;return _}class Ga{constructor(t,a){this.type=Bt,this.geojson=t,this.geometries=a}static parse(t,a){if(t.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(wo(t[1])){const u=t[1];if(u.type==="FeatureCollection")for(let d=0;d<u.features.length;++d){const g=u.features[d].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Ga(u,u.features[d].geometry)}else if(u.type==="Feature"){const d=u.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new Ga(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new Ga(u,u)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(a,u){const d=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=a.canonicalID();if(u.type==="Polygon"){const x=Zl(u.coordinates,g,_),I=yu(a.geometry(),d,g,_);if(!il(d,g))return!1;for(const A of I)if(!mu(A,x))return!1}if(u.type==="MultiPolygon"){const x=pd(u.coordinates,g,_),I=yu(a.geometry(),d,g,_);if(!il(d,g))return!1;for(const A of I)if(!gu(A,x))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(a,u){const d=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=a.canonicalID();if(u.type==="Polygon"){const x=Zl(u.coordinates,g,_),I=_u(a.geometry(),d,g,_);if(!il(d,g))return!1;for(const A of I)if(!dd(A,x))return!1}if(u.type==="MultiPolygon"){const x=pd(u.coordinates,g,_),I=_u(a.geometry(),d,g,_);if(!il(d,g))return!1;for(const A of I)if(!fd(A,x))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Wl{constructor(t,a){this.type=a.type,this.name=t,this.boundExpression=a}static parse(t,a){if(t.length!==2||typeof t[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");const u=t[1];return a.scope.has(u)?new Wl(u,a.scope.get(u)):a.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class ds{constructor(t,a,u,d){this.name=t,this.type=a,this._evaluate=u,this.args=d}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,a){const u=t[0],d=ds.definitions[u];if(!d)return a.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(d)?d[0]:d.type,_=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,x=_.filter(([A])=>!Array.isArray(A)||A.length===t.length-1);let I=null;for(const[A,M]of x){I=new ql(a.registry,Hl,a.path,null,a.scope);const L=[];let F=!1;for(let U=1;U<t.length;U++){const V=t[U],Z=Array.isArray(A)?A[U-1]:A.type,ee=I.parse(V,1+L.length,Z);if(!ee){F=!0;break}L.push(ee)}if(!F)if(Array.isArray(A)&&A.length!==L.length)I.error(`Expected ${A.length} arguments, but found ${L.length} instead.`);else{for(let U=0;U<L.length;U++){const V=Array.isArray(A)?A[U]:A.type,Z=L[U];I.concat(U+1).checkSubtype(V,Z.type)}if(I.errors.length===0)return new ds(u,g,M,L)}}if(x.length===1)a.errors.push(...I.errors);else{const A=(x.length?x:_).map(([L])=>{return F=L,Array.isArray(F)?`(${F.map(te).join(", ")})`:`(${te(F.type)}...)`;var F}).join(" | "),M=[];for(let L=1;L<t.length;L++){const F=a.parse(t[L],1+M.length);if(!F)return null;M.push(te(F.type))}a.error(`Expected arguments of type ${A}, but found (${M.join(", ")}) instead.`)}return null}static register(t,a){ds.definitions=a;for(const u in a)t[u]=ds}}function Hl(s){if(s instanceof Wl)return Hl(s.boundExpression);if(s instanceof ds&&s.name==="error"||s instanceof Gl||s instanceof Ga)return!1;const t=s instanceof _a||s instanceof hs;let a=!0;return s.eachChild(u=>{a=t?a&&Hl(u):a&&u instanceof qa}),!!a&&Yl(s)&&Kl(s,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Yl(s){if(s instanceof ds&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof Ga)return!1;let t=!0;return s.eachChild(a=>{t&&!Yl(a)&&(t=!1)}),t}function nl(s){if(s instanceof ds&&s.name==="feature-state")return!1;let t=!0;return s.eachChild(a=>{t&&!nl(a)&&(t=!1)}),t}function Kl(s,t){if(s instanceof ds&&t.indexOf(s.name)>=0)return!1;let a=!0;return s.eachChild(u=>{a&&!Kl(u,t)&&(a=!1)}),a}function So(s,t){const a=s.length-1;let u,d,g=0,_=a,x=0;for(;g<=_;)if(x=Math.floor((g+_)/2),u=s[x],d=s[x+1],u<=t){if(x===a||t<d)return x;g=x+1}else{if(!(u>t))throw new Ii("Input is not a number.");_=x-1}return 0}class ba{constructor(t,a,u){this.type=t,this.input=a,this.labels=[],this.outputs=[];for(const[d,g]of u)this.labels.push(d),this.outputs.push(g)}static parse(t,a){if(t.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return a.error("Expected an even number of arguments.");const u=a.parse(t[1],1,et);if(!u)return null;const d=[];let g=null;a.expectedType&&a.expectedType.kind!=="value"&&(g=a.expectedType);for(let _=1;_<t.length;_+=2){const x=_===1?-1/0:t[_],I=t[_+1],A=_,M=_+1;if(typeof x!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(d.length&&d[d.length-1][0]>=x)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const L=a.parse(I,M,g);if(!L)return null;g=g||L.type,d.push([x,L])}return new ba(g,u,d)}evaluate(t){const a=this.labels,u=this.outputs;if(a.length===1)return u[0].evaluate(t);const d=this.input.evaluate(t);if(d<=a[0])return u[0].evaluate(t);const g=a.length;return d>=a[g-1]?u[g-1].evaluate(t):u[So(a,d)].evaluate(t)}eachChild(t){t(this.input);for(const a of this.outputs)t(a)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Tr(s,t,a){return s+a*(t-s)}function Xl(s,t,a){return s.map((u,d)=>Tr(u,t[d],a))}const Wn={number:Tr,color:function(s,t,a,u="rgb"){switch(u){case"rgb":{const[d,g,_,x]=Xl(s.rgb,t.rgb,a);return new jr(d,g,_,x,!1)}case"hcl":{const[d,g,_,x]=s.hcl,[I,A,M,L]=t.hcl;let F,U;if(isNaN(d)||isNaN(I))isNaN(d)?isNaN(I)?F=NaN:(F=I,_!==1&&_!==0||(U=A)):(F=d,M!==1&&M!==0||(U=g));else{let ye=I-d;I>d&&ye>180?ye-=360:I<d&&d-I>180&&(ye+=360),F=d+a*ye}const[V,Z,ee,ne]=function([ye,ce,ve,Ie]){return ye=isNaN(ye)?0:ye*Vt,ti([ve,Math.cos(ye)*ce,Math.sin(ye)*ce,Ie])}([F,U??Tr(g,A,a),Tr(_,M,a),Tr(x,L,a)]);return new jr(V,Z,ee,ne,!1)}case"lab":{const[d,g,_,x]=ti(Xl(s.lab,t.lab,a));return new jr(d,g,_,x,!1)}}},array:Xl,padding:function(s,t,a){return new Zn(Xl(s.values,t.values,a))},variableAnchorOffsetCollection:function(s,t,a){const u=s.values,d=t.values;if(u.length!==d.length)throw new Ii(`Cannot interpolate values of different length. from: ${s.toString()}, to: ${t.toString()}`);const g=[];for(let _=0;_<u.length;_+=2){if(u[_]!==d[_])throw new Ii(`Cannot interpolate values containing mismatched anchors. from[${_}]: ${u[_]}, to[${_}]: ${d[_]}`);g.push(u[_]);const[x,I]=u[_+1],[A,M]=d[_+1];g.push([Tr(x,A,a),Tr(I,M,a)])}return new us(g)}};class Hn{constructor(t,a,u,d,g){this.type=t,this.operator=a,this.interpolation=u,this.input=d,this.labels=[],this.outputs=[];for(const[_,x]of g)this.labels.push(_),this.outputs.push(x)}static interpolationFactor(t,a,u,d){let g=0;if(t.name==="exponential")g=vu(a,t.base,u,d);else if(t.name==="linear")g=vu(a,1,u,d);else if(t.name==="cubic-bezier"){const _=t.controlPoints;g=new ae(_[0],_[1],_[2],_[3]).solve(vu(a,1,u,d))}return g}static parse(t,a){let[u,d,g,..._]=t;if(!Array.isArray(d)||d.length===0)return a.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const A=d[1];if(typeof A!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:A}}else{if(d[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const A=d.slice(1);if(A.length!==4||A.some(M=>typeof M!="number"||M<0||M>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:A}}}if(t.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(g=a.parse(g,2,et),!g)return null;const x=[];let I=null;u==="interpolate-hcl"||u==="interpolate-lab"?I=vn:a.expectedType&&a.expectedType.kind!=="value"&&(I=a.expectedType);for(let A=0;A<_.length;A+=2){const M=_[A],L=_[A+1],F=A+3,U=A+4;if(typeof M!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(x.length&&x[x.length-1][0]>=M)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',F);const V=a.parse(L,U,I);if(!V)return null;I=I||V.type,x.push([M,V])}return Le(I,et)||Le(I,vn)||Le(I,R)||Le(I,j)||Le(I,J(et))?new Hn(I,u,d,g,x):a.error(`Type ${te(I)} is not interpolatable.`)}evaluate(t){const a=this.labels,u=this.outputs;if(a.length===1)return u[0].evaluate(t);const d=this.input.evaluate(t);if(d<=a[0])return u[0].evaluate(t);const g=a.length;if(d>=a[g-1])return u[g-1].evaluate(t);const _=So(a,d),x=Hn.interpolationFactor(this.interpolation,d,a[_],a[_+1]),I=u[_].evaluate(t),A=u[_+1].evaluate(t);switch(this.operator){case"interpolate":return Wn[this.type.kind](I,A,x);case"interpolate-hcl":return Wn.color(I,A,x,"hcl");case"interpolate-lab":return Wn.color(I,A,x,"lab")}}eachChild(t){t(this.input);for(const a of this.outputs)t(a)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function vu(s,t,a,u){const d=u-a,g=s-a;return d===0?0:t===1?g/d:(Math.pow(t,g)-1)/(Math.pow(t,d)-1)}class Jl{constructor(t,a){this.type=t,this.args=a}static parse(t,a){if(t.length<2)return a.error("Expectected at least one argument.");let u=null;const d=a.expectedType;d&&d.kind!=="value"&&(u=d);const g=[];for(const x of t.slice(1)){const I=a.parse(x,1+g.length,u,void 0,{typeAnnotation:"omit"});if(!I)return null;u=u||I.type,g.push(I)}if(!u)throw new Error("No output type");const _=d&&g.some(x=>he(d,x.type));return new Jl(_?tr:u,g)}evaluate(t){let a,u=null,d=0;for(const g of this.args)if(d++,u=g.evaluate(t),u&&u instanceof hn&&!u.available&&(a||(a=u.name),u=null,d===this.args.length&&(u=a)),u!==null)break;return u}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}class Ql{constructor(t,a){this.type=a.type,this.bindings=[].concat(t),this.result=a}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const a of this.bindings)t(a[1]);t(this.result)}static parse(t,a){if(t.length<4)return a.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const u=[];for(let g=1;g<t.length-1;g+=2){const _=t[g];if(typeof _!="string")return a.error(`Expected string, but found ${typeof _} instead.`,g);if(/[^a-zA-Z0-9_]/.test(_))return a.error("Variable names must contain only alphanumeric characters or '_'.",g);const x=a.parse(t[g+1],g+1);if(!x)return null;u.push([_,x])}const d=a.parse(t[t.length-1],t.length-1,a.expectedType,u);return d?new Ql(u,d):null}outputDefined(){return this.result.outputDefined()}}class bu{constructor(t,a,u){this.type=t,this.index=a,this.input=u}static parse(t,a){if(t.length!==3)return a.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const u=a.parse(t[1],1,et),d=a.parse(t[2],2,J(a.expectedType||tr));return u&&d?new bu(d.type.itemType,u,d):null}evaluate(t){const a=this.index.evaluate(t),u=this.input.evaluate(t);if(a<0)throw new Ii(`Array index out of bounds: ${a} < 0.`);if(a>=u.length)throw new Ii(`Array index out of bounds: ${a} > ${u.length-1}.`);if(a!==Math.floor(a))throw new Ii(`Array index must be an integer, but found ${a} instead.`);return u[a]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class xu{constructor(t,a){this.type=Bt,this.needle=t,this.haystack=a}static parse(t,a){if(t.length!==3)return a.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const u=a.parse(t[1],1,tr),d=a.parse(t[2],2,tr);return u&&d?se(u.type,[Bt,Jt,et,os,tr])?new xu(u,d):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${te(u.type)} instead`):null}evaluate(t){const a=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!u)return!1;if(!ge(a,["boolean","string","number","null"]))throw new Ii(`Expected first argument to be of type boolean, string, number or null, but found ${te(_i(a))} instead.`);if(!ge(u,["string","array"]))throw new Ii(`Expected second argument to be of type array or string, but found ${te(_i(u))} instead.`);return u.indexOf(a)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class ec{constructor(t,a,u){this.type=et,this.needle=t,this.haystack=a,this.fromIndex=u}static parse(t,a){if(t.length<=2||t.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const u=a.parse(t[1],1,tr),d=a.parse(t[2],2,tr);if(!u||!d)return null;if(!se(u.type,[Bt,Jt,et,os,tr]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${te(u.type)} instead`);if(t.length===4){const g=a.parse(t[3],3,et);return g?new ec(u,d,g):null}return new ec(u,d)}evaluate(t){const a=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!ge(a,["boolean","string","number","null"]))throw new Ii(`Expected first argument to be of type boolean, string, number or null, but found ${te(_i(a))} instead.`);if(!ge(u,["string","array"]))throw new Ii(`Expected second argument to be of type array or string, but found ${te(_i(u))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(t);return u.indexOf(a,d)}return u.indexOf(a)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class wu{constructor(t,a,u,d,g,_){this.inputType=t,this.type=a,this.input=u,this.cases=d,this.outputs=g,this.otherwise=_}static parse(t,a){if(t.length<5)return a.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return a.error("Expected an even number of arguments.");let u,d;a.expectedType&&a.expectedType.kind!=="value"&&(d=a.expectedType);const g={},_=[];for(let A=2;A<t.length-1;A+=2){let M=t[A];const L=t[A+1];Array.isArray(M)||(M=[M]);const F=a.concat(A);if(M.length===0)return F.error("Expected at least one branch label.");for(const V of M){if(typeof V!="number"&&typeof V!="string")return F.error("Branch labels must be numbers or strings.");if(typeof V=="number"&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return F.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof V=="number"&&Math.floor(V)!==V)return F.error("Numeric branch labels must be integer values.");if(u){if(F.checkSubtype(u,_i(V)))return null}else u=_i(V);if(g[String(V)]!==void 0)return F.error("Branch labels must be unique.");g[String(V)]=_.length}const U=a.parse(L,A,d);if(!U)return null;d=d||U.type,_.push(U)}const x=a.parse(t[1],1,tr);if(!x)return null;const I=a.parse(t[t.length-1],t.length-1,d);return I?x.type.kind!=="value"&&a.concat(1).checkSubtype(u,x.type)?null:new wu(u,d,x,g,_,I):null}evaluate(t){const a=this.input.evaluate(t);return(_i(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Su{constructor(t,a,u){this.type=t,this.branches=a,this.otherwise=u}static parse(t,a){if(t.length<4)return a.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return a.error("Expected an odd number of arguments.");let u;a.expectedType&&a.expectedType.kind!=="value"&&(u=a.expectedType);const d=[];for(let _=1;_<t.length-1;_+=2){const x=a.parse(t[_],_,Bt);if(!x)return null;const I=a.parse(t[_+1],_+1,u);if(!I)return null;d.push([x,I]),u=u||I.type}const g=a.parse(t[t.length-1],t.length-1,u);if(!g)return null;if(!u)throw new Error("Can't infer output type");return new Su(u,d,g)}evaluate(t){for(const[a,u]of this.branches)if(a.evaluate(t))return u.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[a,u]of this.branches)t(a),t(u);t(this.otherwise)}outputDefined(){return this.branches.every(([t,a])=>a.outputDefined())&&this.otherwise.outputDefined()}}class tc{constructor(t,a,u,d){this.type=t,this.input=a,this.beginIndex=u,this.endIndex=d}static parse(t,a){if(t.length<=2||t.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const u=a.parse(t[1],1,tr),d=a.parse(t[2],2,et);if(!u||!d)return null;if(!se(u.type,[J(tr),Jt,tr]))return a.error(`Expected first argument to be of type array or string, but found ${te(u.type)} instead`);if(t.length===4){const g=a.parse(t[3],3,et);return g?new tc(u.type,u,d,g):null}return new tc(u.type,u,d)}evaluate(t){const a=this.input.evaluate(t),u=this.beginIndex.evaluate(t);if(!ge(a,["string","array"]))throw new Ii(`Expected first argument to be of type array or string, but found ${te(_i(a))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(t);return a.slice(u,d)}return a.slice(u)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function gd(s,t){return s==="=="||s==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function yd(s,t,a,u){return u.compare(t,a)===0}function Io(s,t,a){const u=s!=="=="&&s!=="!=";return class cw{constructor(g,_,x){this.type=Bt,this.lhs=g,this.rhs=_,this.collator=x,this.hasUntypedArgument=g.type.kind==="value"||_.type.kind==="value"}static parse(g,_){if(g.length!==3&&g.length!==4)return _.error("Expected two or three arguments.");const x=g[0];let I=_.parse(g[1],1,tr);if(!I)return null;if(!gd(x,I.type))return _.concat(1).error(`"${x}" comparisons are not supported for type '${te(I.type)}'.`);let A=_.parse(g[2],2,tr);if(!A)return null;if(!gd(x,A.type))return _.concat(2).error(`"${x}" comparisons are not supported for type '${te(A.type)}'.`);if(I.type.kind!==A.type.kind&&I.type.kind!=="value"&&A.type.kind!=="value")return _.error(`Cannot compare types '${te(I.type)}' and '${te(A.type)}'.`);u&&(I.type.kind==="value"&&A.type.kind!=="value"?I=new hs(A.type,[I]):I.type.kind!=="value"&&A.type.kind==="value"&&(A=new hs(I.type,[A])));let M=null;if(g.length===4){if(I.type.kind!=="string"&&A.type.kind!=="string"&&I.type.kind!=="value"&&A.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(M=_.parse(g[3],3,Js),!M)return null}return new cw(I,A,M)}evaluate(g){const _=this.lhs.evaluate(g),x=this.rhs.evaluate(g);if(u&&this.hasUntypedArgument){const I=_i(_),A=_i(x);if(I.kind!==A.kind||I.kind!=="string"&&I.kind!=="number")throw new Ii(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${I.kind}, ${A.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const I=_i(_),A=_i(x);if(I.kind!=="string"||A.kind!=="string")return t(g,_,x)}return this.collator?a(g,_,x,this.collator.evaluate(g)):t(g,_,x)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}}}const am=Io("==",function(s,t,a){return t===a},yd),om=Io("!=",function(s,t,a){return t!==a},function(s,t,a,u){return!yd(0,t,a,u)}),lm=Io("<",function(s,t,a){return t<a},function(s,t,a,u){return u.compare(t,a)<0}),cm=Io(">",function(s,t,a){return t>a},function(s,t,a,u){return u.compare(t,a)>0}),um=Io("<=",function(s,t,a){return t<=a},function(s,t,a,u){return u.compare(t,a)<=0}),hm=Io(">=",function(s,t,a){return t>=a},function(s,t,a,u){return u.compare(t,a)>=0});class Iu{constructor(t,a,u,d,g){this.type=Jt,this.number=t,this.locale=a,this.currency=u,this.minFractionDigits=d,this.maxFractionDigits=g}static parse(t,a){if(t.length!==3)return a.error("Expected two arguments.");const u=a.parse(t[1],1,et);if(!u)return null;const d=t[2];if(typeof d!="object"||Array.isArray(d))return a.error("NumberFormat options argument must be an object.");let g=null;if(d.locale&&(g=a.parse(d.locale,1,Jt),!g))return null;let _=null;if(d.currency&&(_=a.parse(d.currency,1,Jt),!_))return null;let x=null;if(d["min-fraction-digits"]&&(x=a.parse(d["min-fraction-digits"],1,et),!x))return null;let I=null;return d["max-fraction-digits"]&&(I=a.parse(d["max-fraction-digits"],1,et),!I)?null:new Iu(u,g,_,x,I)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class rc{constructor(t){this.type=K,this.sections=t}static parse(t,a){if(t.length<2)return a.error("Expected at least one argument.");const u=t[1];if(!Array.isArray(u)&&typeof u=="object")return a.error("First argument must be an image or text section.");const d=[];let g=!1;for(let _=1;_<=t.length-1;++_){const x=t[_];if(g&&typeof x=="object"&&!Array.isArray(x)){g=!1;let I=null;if(x["font-scale"]&&(I=a.parse(x["font-scale"],1,et),!I))return null;let A=null;if(x["text-font"]&&(A=a.parse(x["text-font"],1,J(Jt)),!A))return null;let M=null;if(x["text-color"]&&(M=a.parse(x["text-color"],1,vn),!M))return null;const L=d[d.length-1];L.scale=I,L.font=A,L.textColor=M}else{const I=a.parse(t[_],1,tr);if(!I)return null;const A=I.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,d.push({content:I,scale:null,font:null,textColor:null})}}return new rc(d)}evaluate(t){return new xn(this.sections.map(a=>{const u=a.content.evaluate(t);return _i(u)===O?new $l("",u,null,null,null):new $l(zr(u),null,a.scale?a.scale.evaluate(t):null,a.font?a.font.evaluate(t).join(","):null,a.textColor?a.textColor.evaluate(t):null)}))}eachChild(t){for(const a of this.sections)t(a.content),a.scale&&t(a.scale),a.font&&t(a.font),a.textColor&&t(a.textColor)}outputDefined(){return!1}}class Tu{constructor(t){this.type=O,this.input=t}static parse(t,a){if(t.length!==2)return a.error("Expected two arguments.");const u=a.parse(t[1],1,Jt);return u?new Tu(u):a.error("No image name provided.")}evaluate(t){const a=this.input.evaluate(t),u=hn.fromString(a);return u&&t.availableImages&&(u.available=t.availableImages.indexOf(a)>-1),u}eachChild(t){t(this.input)}outputDefined(){return!1}}class ku{constructor(t){this.type=et,this.input=t}static parse(t,a){if(t.length!==2)return a.error(`Expected 1 argument, but found ${t.length-1} instead.`);const u=a.parse(t[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${te(u.type)} instead.`):new ku(u):null}evaluate(t){const a=this.input.evaluate(t);if(typeof a=="string"||Array.isArray(a))return a.length;throw new Ii(`Expected value to be of type string or array, but found ${te(_i(a))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const To={"==":am,"!=":om,">":cm,"<":lm,">=":hm,"<=":um,array:hs,at:bu,boolean:hs,case:Su,coalesce:Jl,collator:Gl,format:rc,image:Tu,in:xu,"index-of":ec,interpolate:Hn,"interpolate-hcl":Hn,"interpolate-lab":Hn,length:ku,let:Ql,literal:qa,match:wu,number:hs,"number-format":Iu,object:hs,slice:tc,step:ba,string:hs,"to-boolean":_a,"to-color":_a,"to-number":_a,"to-string":_a,var:Wl,within:Ga};function _d(s,[t,a,u,d]){t=t.evaluate(s),a=a.evaluate(s),u=u.evaluate(s);const g=d?d.evaluate(s):1,_=Vl(t,a,u,g);if(_)throw new Ii(_);return new jr(t/255,a/255,u/255,g,!1)}function vd(s,t){return s in t}function Au(s,t){const a=t[s];return a===void 0?null:a}function Za(s){return{type:s}}function bd(s){return{result:"success",value:s}}function xa(s){return{result:"error",value:s}}function ko(s){return s["property-type"]==="data-driven"||s["property-type"]==="cross-faded-data-driven"}function xd(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function Eu(s){return!!s.expression&&s.expression.interpolated}function Br(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function vi(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function dm(s){return s}function kr(s,t){const a=t.type==="color",u=s.stops&&typeof s.stops[0][0]=="object",d=u||!(u||s.property!==void 0),g=s.type||(Eu(t)?"exponential":"interval");if(a||t.type==="padding"){const M=a?jr.parse:Zn.parse;(s=cn({},s)).stops&&(s.stops=s.stops.map(L=>[L[0],M(L[1])])),s.default=M(s.default?s.default:t.default)}if(s.colorSpace&&(_=s.colorSpace)!=="rgb"&&_!=="hcl"&&_!=="lab")throw new Error(`Unknown color space: "${s.colorSpace}"`);var _;let x,I,A;if(g==="exponential")x=sl;else if(g==="interval")x=fi;else if(g==="categorical"){x=bi,I=Object.create(null);for(const M of s.stops)I[M[0]]=M[1];A=typeof s.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);x=wd}if(u){const M={},L=[];for(let V=0;V<s.stops.length;V++){const Z=s.stops[V],ee=Z[0].zoom;M[ee]===void 0&&(M[ee]={zoom:ee,type:s.type,property:s.property,default:s.default,stops:[]},L.push(ee)),M[ee].stops.push([Z[0].value,Z[1]])}const F=[];for(const V of L)F.push([M[V].zoom,kr(M[V],t)]);const U={name:"linear"};return{kind:"composite",interpolationType:U,interpolationFactor:Hn.interpolationFactor.bind(void 0,U),zoomStops:F.map(V=>V[0]),evaluate:({zoom:V},Z)=>sl({stops:F,base:s.base},t,V).evaluate(V,Z)}}if(d){const M=g==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:Hn.interpolationFactor.bind(void 0,M),zoomStops:s.stops.map(L=>L[0]),evaluate:({zoom:L})=>x(s,t,L,I,A)}}return{kind:"source",evaluate(M,L){const F=L&&L.properties?L.properties[s.property]:void 0;return F===void 0?Wa(s.default,t.default):x(s,t,F,I,A)}}}function Wa(s,t,a){return s!==void 0?s:t!==void 0?t:a!==void 0?a:void 0}function bi(s,t,a,u,d){return Wa(typeof a===d?u[a]:void 0,s.default,t.default)}function fi(s,t,a){if(Br(a)!=="number")return Wa(s.default,t.default);const u=s.stops.length;if(u===1||a<=s.stops[0][0])return s.stops[0][1];if(a>=s.stops[u-1][0])return s.stops[u-1][1];const d=So(s.stops.map(g=>g[0]),a);return s.stops[d][1]}function sl(s,t,a){const u=s.base!==void 0?s.base:1;if(Br(a)!=="number")return Wa(s.default,t.default);const d=s.stops.length;if(d===1||a<=s.stops[0][0])return s.stops[0][1];if(a>=s.stops[d-1][0])return s.stops[d-1][1];const g=So(s.stops.map(M=>M[0]),a),_=function(M,L,F,U){const V=U-F,Z=M-F;return V===0?0:L===1?Z/V:(Math.pow(L,Z)-1)/(Math.pow(L,V)-1)}(a,u,s.stops[g][0],s.stops[g+1][0]),x=s.stops[g][1],I=s.stops[g+1][1],A=Wn[t.type]||dm;return typeof x.evaluate=="function"?{evaluate(...M){const L=x.evaluate.apply(void 0,M),F=I.evaluate.apply(void 0,M);if(L!==void 0&&F!==void 0)return A(L,F,_,s.colorSpace)}}:A(x,I,_,s.colorSpace)}function wd(s,t,a){switch(t.type){case"color":a=jr.parse(a);break;case"formatted":a=xn.fromString(a.toString());break;case"resolvedImage":a=hn.fromString(a.toString());break;case"padding":a=Zn.parse(a);break;default:Br(a)===t.type||t.type==="enum"&&t.values[a]||(a=void 0)}return Wa(a,s.default,t.default)}ds.register(To,{error:[{kind:"error"},[Jt],(s,[t])=>{throw new Ii(t.evaluate(s))}],typeof:[Jt,[tr],(s,[t])=>te(_i(t.evaluate(s)))],"to-rgba":[J(et,4),[vn],(s,[t])=>{const[a,u,d,g]=t.evaluate(s).rgb;return[255*a,255*u,255*d,g]}],rgb:[vn,[et,et,et],_d],rgba:[vn,[et,et,et,et],_d],has:{type:Bt,overloads:[[[Jt],(s,[t])=>vd(t.evaluate(s),s.properties())],[[Jt,ls],(s,[t,a])=>vd(t.evaluate(s),a.evaluate(s))]]},get:{type:tr,overloads:[[[Jt],(s,[t])=>Au(t.evaluate(s),s.properties())],[[Jt,ls],(s,[t,a])=>Au(t.evaluate(s),a.evaluate(s))]]},"feature-state":[tr,[Jt],(s,[t])=>Au(t.evaluate(s),s.featureState||{})],properties:[ls,[],s=>s.properties()],"geometry-type":[Jt,[],s=>s.geometryType()],id:[tr,[],s=>s.id()],zoom:[et,[],s=>s.globals.zoom],"heatmap-density":[et,[],s=>s.globals.heatmapDensity||0],"line-progress":[et,[],s=>s.globals.lineProgress||0],accumulated:[tr,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[et,Za(et),(s,t)=>{let a=0;for(const u of t)a+=u.evaluate(s);return a}],"*":[et,Za(et),(s,t)=>{let a=1;for(const u of t)a*=u.evaluate(s);return a}],"-":{type:et,overloads:[[[et,et],(s,[t,a])=>t.evaluate(s)-a.evaluate(s)],[[et],(s,[t])=>-t.evaluate(s)]]},"/":[et,[et,et],(s,[t,a])=>t.evaluate(s)/a.evaluate(s)],"%":[et,[et,et],(s,[t,a])=>t.evaluate(s)%a.evaluate(s)],ln2:[et,[],()=>Math.LN2],pi:[et,[],()=>Math.PI],e:[et,[],()=>Math.E],"^":[et,[et,et],(s,[t,a])=>Math.pow(t.evaluate(s),a.evaluate(s))],sqrt:[et,[et],(s,[t])=>Math.sqrt(t.evaluate(s))],log10:[et,[et],(s,[t])=>Math.log(t.evaluate(s))/Math.LN10],ln:[et,[et],(s,[t])=>Math.log(t.evaluate(s))],log2:[et,[et],(s,[t])=>Math.log(t.evaluate(s))/Math.LN2],sin:[et,[et],(s,[t])=>Math.sin(t.evaluate(s))],cos:[et,[et],(s,[t])=>Math.cos(t.evaluate(s))],tan:[et,[et],(s,[t])=>Math.tan(t.evaluate(s))],asin:[et,[et],(s,[t])=>Math.asin(t.evaluate(s))],acos:[et,[et],(s,[t])=>Math.acos(t.evaluate(s))],atan:[et,[et],(s,[t])=>Math.atan(t.evaluate(s))],min:[et,Za(et),(s,t)=>Math.min(...t.map(a=>a.evaluate(s)))],max:[et,Za(et),(s,t)=>Math.max(...t.map(a=>a.evaluate(s)))],abs:[et,[et],(s,[t])=>Math.abs(t.evaluate(s))],round:[et,[et],(s,[t])=>{const a=t.evaluate(s);return a<0?-Math.round(-a):Math.round(a)}],floor:[et,[et],(s,[t])=>Math.floor(t.evaluate(s))],ceil:[et,[et],(s,[t])=>Math.ceil(t.evaluate(s))],"filter-==":[Bt,[Jt,tr],(s,[t,a])=>s.properties()[t.value]===a.value],"filter-id-==":[Bt,[tr],(s,[t])=>s.id()===t.value],"filter-type-==":[Bt,[Jt],(s,[t])=>s.geometryType()===t.value],"filter-<":[Bt,[Jt,tr],(s,[t,a])=>{const u=s.properties()[t.value],d=a.value;return typeof u==typeof d&&u<d}],"filter-id-<":[Bt,[tr],(s,[t])=>{const a=s.id(),u=t.value;return typeof a==typeof u&&a<u}],"filter->":[Bt,[Jt,tr],(s,[t,a])=>{const u=s.properties()[t.value],d=a.value;return typeof u==typeof d&&u>d}],"filter-id->":[Bt,[tr],(s,[t])=>{const a=s.id(),u=t.value;return typeof a==typeof u&&a>u}],"filter-<=":[Bt,[Jt,tr],(s,[t,a])=>{const u=s.properties()[t.value],d=a.value;return typeof u==typeof d&&u<=d}],"filter-id-<=":[Bt,[tr],(s,[t])=>{const a=s.id(),u=t.value;return typeof a==typeof u&&a<=u}],"filter->=":[Bt,[Jt,tr],(s,[t,a])=>{const u=s.properties()[t.value],d=a.value;return typeof u==typeof d&&u>=d}],"filter-id->=":[Bt,[tr],(s,[t])=>{const a=s.id(),u=t.value;return typeof a==typeof u&&a>=u}],"filter-has":[Bt,[tr],(s,[t])=>t.value in s.properties()],"filter-has-id":[Bt,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[Bt,[J(Jt)],(s,[t])=>t.value.indexOf(s.geometryType())>=0],"filter-id-in":[Bt,[J(tr)],(s,[t])=>t.value.indexOf(s.id())>=0],"filter-in-small":[Bt,[Jt,J(tr)],(s,[t,a])=>a.value.indexOf(s.properties()[t.value])>=0],"filter-in-large":[Bt,[Jt,J(tr)],(s,[t,a])=>function(u,d,g,_){for(;g<=_;){const x=g+_>>1;if(d[x]===u)return!0;d[x]>u?_=x-1:g=x+1}return!1}(s.properties()[t.value],a.value,0,a.value.length-1)],all:{type:Bt,overloads:[[[Bt,Bt],(s,[t,a])=>t.evaluate(s)&&a.evaluate(s)],[Za(Bt),(s,t)=>{for(const a of t)if(!a.evaluate(s))return!1;return!0}]]},any:{type:Bt,overloads:[[[Bt,Bt],(s,[t,a])=>t.evaluate(s)||a.evaluate(s)],[Za(Bt),(s,t)=>{for(const a of t)if(a.evaluate(s))return!0;return!1}]]},"!":[Bt,[Bt],(s,[t])=>!t.evaluate(s)],"is-supported-script":[Bt,[Jt],(s,[t])=>{const a=s.globals&&s.globals.isSupportedScript;return!a||a(t.evaluate(s))}],upcase:[Jt,[Jt],(s,[t])=>t.evaluate(s).toUpperCase()],downcase:[Jt,[Jt],(s,[t])=>t.evaluate(s).toLowerCase()],concat:[Jt,Za(tr),(s,t)=>t.map(a=>zr(a.evaluate(s))).join("")],"resolved-locale":[Jt,[Js],(s,[t])=>t.evaluate(s).resolvedLocale()]});class Cu{constructor(t,a){var u;this.expression=t,this._warningHistory={},this._evaluator=new fu,this._defaultValue=a?(u=a).type==="color"&&vi(u.default)?new jr(0,0,0,0):u.type==="color"?jr.parse(u.default)||null:u.type==="padding"?Zn.parse(u.default)||null:u.type==="variableAnchorOffsetCollection"?us.parse(u.default)||null:u.default===void 0?null:u.default:null,this._enumValues=a&&a.type==="enum"?a.values:null}evaluateWithoutErrorHandling(t,a,u,d,g,_){return this._evaluator.globals=t,this._evaluator.feature=a,this._evaluator.featureState=u,this._evaluator.canonical=d,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_,this.expression.evaluate(this._evaluator)}evaluate(t,a,u,d,g,_){this._evaluator.globals=t,this._evaluator.feature=a||null,this._evaluator.featureState=u||null,this._evaluator.canonical=d,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_||null;try{const x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new Ii(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(x)} instead.`);return x}catch(x){return this._warningHistory[x.message]||(this._warningHistory[x.message]=!0,typeof console<"u"&&console.warn(x.message)),this._defaultValue}}}function ic(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in To}function nc(s,t){const a=new ql(To,Hl,[],t?function(d){const g={color:vn,string:Jt,number:et,enum:Jt,boolean:Bt,formatted:K,padding:R,resolvedImage:O,variableAnchorOffsetCollection:j};return d.type==="array"?J(g[d.value]||tr,d.length):g[d.type]}(t):void 0),u=a.parse(s,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?bd(new Cu(u,t)):xa(a.errors)}class Mu{constructor(t,a){this.kind=t,this._styleExpression=a,this.isStateDependent=t!=="constant"&&!nl(a.expression)}evaluateWithoutErrorHandling(t,a,u,d,g,_){return this._styleExpression.evaluateWithoutErrorHandling(t,a,u,d,g,_)}evaluate(t,a,u,d,g,_){return this._styleExpression.evaluate(t,a,u,d,g,_)}}class sc{constructor(t,a,u,d){this.kind=t,this.zoomStops=u,this._styleExpression=a,this.isStateDependent=t!=="camera"&&!nl(a.expression),this.interpolationType=d}evaluateWithoutErrorHandling(t,a,u,d,g,_){return this._styleExpression.evaluateWithoutErrorHandling(t,a,u,d,g,_)}evaluate(t,a,u,d,g,_){return this._styleExpression.evaluate(t,a,u,d,g,_)}interpolationFactor(t,a,u){return this.interpolationType?Hn.interpolationFactor(this.interpolationType,t,a,u):0}}function Du(s,t){const a=nc(s,t);if(a.result==="error")return a;const u=a.value.expression,d=Yl(u);if(!d&&!ko(t))return xa([new Xr("","data expressions not supported")]);const g=Kl(u,["zoom"]);if(!g&&!xd(t))return xa([new Xr("","zoom expressions not supported")]);const _=ol(u);return _||g?_ instanceof Xr?xa([_]):_ instanceof Hn&&!Eu(t)?xa([new Xr("",'"interpolate" expressions cannot be used with this property')]):bd(_?new sc(d?"camera":"composite",a.value,_.labels,_ instanceof Hn?_.interpolation:void 0):new Mu(d?"constant":"source",a.value)):xa([new Xr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class al{constructor(t,a){this._parameters=t,this._specification=a,cn(this,kr(this._parameters,this._specification))}static deserialize(t){return new al(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function ol(s){let t=null;if(s instanceof Ql)t=ol(s.result);else if(s instanceof Jl){for(const a of s.args)if(t=ol(a),t)break}else(s instanceof ba||s instanceof Hn)&&s.input instanceof ds&&s.input.name==="zoom"&&(t=s);return t instanceof Xr||s.eachChild(a=>{const u=ol(a);u instanceof Xr?t=u:!t&&u?t=new Xr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&u&&t!==u&&(t=new Xr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function ll(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const t of s.slice(1))if(!ll(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const fm={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Pu(s){if(s==null)return{filter:()=>!0,needGeometry:!1};ll(s)||(s=ac(s));const t=nc(s,fm);if(t.result==="error")throw new Error(t.value.map(a=>`${a.key}: ${a.message}`).join(", "));return{filter:(a,u,d)=>t.value.evaluate(a,u,{},d),needGeometry:Sd(s)}}function pm(s,t){return s<t?-1:s>t?1:0}function Sd(s){if(!Array.isArray(s))return!1;if(s[0]==="within")return!0;for(let t=1;t<s.length;t++)if(Sd(s[t]))return!0;return!1}function ac(s){if(!s)return!0;const t=s[0];return s.length<=1?t!=="any":t==="=="?Lu(s[1],s[2],"=="):t==="!="?cl(Lu(s[1],s[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Lu(s[1],s[2],t):t==="any"?(a=s.slice(1),["any"].concat(a.map(ac))):t==="all"?["all"].concat(s.slice(1).map(ac)):t==="none"?["all"].concat(s.slice(1).map(ac).map(cl)):t==="in"?Id(s[1],s.slice(2)):t==="!in"?cl(Id(s[1],s.slice(2))):t==="has"?Td(s[1]):t==="!has"?cl(Td(s[1])):t!=="within"||s;var a}function Lu(s,t,a){switch(s){case"$type":return[`filter-type-${a}`,t];case"$id":return[`filter-id-${a}`,t];default:return[`filter-${a}`,s,t]}}function Id(s,t){if(t.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(a=>typeof a!=typeof t[0])?["filter-in-large",s,["literal",t.sort(pm)]]:["filter-in-small",s,["literal",t]]}}function Td(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function cl(s){return["!",s]}function oc(s){const t=typeof s;if(t==="number"||t==="boolean"||t==="string"||s==null)return JSON.stringify(s);if(Array.isArray(s)){let d="[";for(const g of s)d+=`${oc(g)},`;return`${d}]`}const a=Object.keys(s).sort();let u="{";for(let d=0;d<a.length;d++)u+=`${JSON.stringify(a[d])}:${oc(s[a[d]])},`;return`${u}}`}function lc(s){let t="";for(const a of di)t+=`/${oc(s[a])}`;return t}function kd(s){const t=s.value;return t?[new Ke(s.key,t,"constants have been deprecated as of v8")]:[]}function Ti(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function Ha(s){if(Array.isArray(s))return s.map(Ha);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const t={};for(const a in s)t[a]=Ha(s[a]);return t}return Ti(s)}function Bn(s){const t=s.key,a=s.value,u=s.valueSpec||{},d=s.objectElementValidators||{},g=s.style,_=s.styleSpec,x=s.validateSpec;let I=[];const A=Br(a);if(A!=="object")return[new Ke(t,a,`object expected, ${A} found`)];for(const M in a){const L=M.split(".")[0],F=u[L]||u["*"];let U;if(d[L])U=d[L];else if(u[L])U=x;else if(d["*"])U=d["*"];else{if(!u["*"]){I.push(new Ke(t,a[M],`unknown property "${M}"`));continue}U=x}I=I.concat(U({key:(t&&`${t}.`)+M,value:a[M],valueSpec:F,style:g,styleSpec:_,object:a,objectKey:M,validateSpec:x},a))}for(const M in u)d[M]||u[M].required&&u[M].default===void 0&&a[M]===void 0&&I.push(new Ke(t,a,`missing required property "${M}"`));return I}function Ao(s){const t=s.value,a=s.valueSpec,u=s.style,d=s.styleSpec,g=s.key,_=s.arrayElementValidator||s.validateSpec;if(Br(t)!=="array")return[new Ke(g,t,`array expected, ${Br(t)} found`)];if(a.length&&t.length!==a.length)return[new Ke(g,t,`array length ${a.length} expected, length ${t.length} found`)];if(a["min-length"]&&t.length<a["min-length"])return[new Ke(g,t,`array length at least ${a["min-length"]} expected, length ${t.length} found`)];let x={type:a.value,values:a.values};d.$version<7&&(x.function=a.function),Br(a.value)==="object"&&(x=a.value);let I=[];for(let A=0;A<t.length;A++)I=I.concat(_({array:t,arrayIndex:A,value:t[A],valueSpec:x,validateSpec:s.validateSpec,style:u,styleSpec:d,key:`${g}[${A}]`}));return I}function ul(s){const t=s.key,a=s.value,u=s.valueSpec;let d=Br(a);return d==="number"&&a!=a&&(d="NaN"),d!=="number"?[new Ke(t,a,`number expected, ${d} found`)]:"minimum"in u&&a<u.minimum?[new Ke(t,a,`${a} is less than the minimum value ${u.minimum}`)]:"maximum"in u&&a>u.maximum?[new Ke(t,a,`${a} is greater than the maximum value ${u.maximum}`)]:[]}function cc(s){const t=s.valueSpec,a=Ti(s.value.type);let u,d,g,_={};const x=a!=="categorical"&&s.value.property===void 0,I=!x,A=Br(s.value.stops)==="array"&&Br(s.value.stops[0])==="array"&&Br(s.value.stops[0][0])==="object",M=Bn({key:s.key,value:s.value,valueSpec:s.styleSpec.function,validateSpec:s.validateSpec,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(U){if(a==="identity")return[new Ke(U.key,U.value,'identity function may not have a "stops" property')];let V=[];const Z=U.value;return V=V.concat(Ao({key:U.key,value:Z,valueSpec:U.valueSpec,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec,arrayElementValidator:L})),Br(Z)==="array"&&Z.length===0&&V.push(new Ke(U.key,Z,"array must have at least one stop")),V},default:function(U){return U.validateSpec({key:U.key,value:U.value,valueSpec:t,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec})}}});return a==="identity"&&x&&M.push(new Ke(s.key,s.value,'missing required property "property"')),a==="identity"||s.value.stops||M.push(new Ke(s.key,s.value,'missing required property "stops"')),a==="exponential"&&s.valueSpec.expression&&!Eu(s.valueSpec)&&M.push(new Ke(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(I&&!ko(s.valueSpec)?M.push(new Ke(s.key,s.value,"property functions not supported")):x&&!xd(s.valueSpec)&&M.push(new Ke(s.key,s.value,"zoom functions not supported"))),a!=="categorical"&&!A||s.value.property!==void 0||M.push(new Ke(s.key,s.value,'"property" property is required')),M;function L(U){let V=[];const Z=U.value,ee=U.key;if(Br(Z)!=="array")return[new Ke(ee,Z,`array expected, ${Br(Z)} found`)];if(Z.length!==2)return[new Ke(ee,Z,`array length 2 expected, length ${Z.length} found`)];if(A){if(Br(Z[0])!=="object")return[new Ke(ee,Z,`object expected, ${Br(Z[0])} found`)];if(Z[0].zoom===void 0)return[new Ke(ee,Z,"object stop key must have zoom")];if(Z[0].value===void 0)return[new Ke(ee,Z,"object stop key must have value")];if(g&&g>Ti(Z[0].zoom))return[new Ke(ee,Z[0].zoom,"stop zoom values must appear in ascending order")];Ti(Z[0].zoom)!==g&&(g=Ti(Z[0].zoom),d=void 0,_={}),V=V.concat(Bn({key:`${ee}[0]`,value:Z[0],valueSpec:{zoom:{}},validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec,objectElementValidators:{zoom:ul,value:F}}))}else V=V.concat(F({key:`${ee}[0]`,value:Z[0],valueSpec:{},validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec},Z));return ic(Ha(Z[1]))?V.concat([new Ke(`${ee}[1]`,Z[1],"expressions are not allowed in function stops.")]):V.concat(U.validateSpec({key:`${ee}[1]`,value:Z[1],valueSpec:t,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec}))}function F(U,V){const Z=Br(U.value),ee=Ti(U.value),ne=U.value!==null?U.value:V;if(u){if(Z!==u)return[new Ke(U.key,ne,`${Z} stop domain type must match previous stop domain type ${u}`)]}else u=Z;if(Z!=="number"&&Z!=="string"&&Z!=="boolean")return[new Ke(U.key,ne,"stop domain value must be a number, string, or boolean")];if(Z!=="number"&&a!=="categorical"){let ye=`number expected, ${Z} found`;return ko(t)&&a===void 0&&(ye+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ke(U.key,ne,ye)]}return a!=="categorical"||Z!=="number"||isFinite(ee)&&Math.floor(ee)===ee?a!=="categorical"&&Z==="number"&&d!==void 0&&ee<d?[new Ke(U.key,ne,"stop domain values must appear in ascending order")]:(d=ee,a==="categorical"&&ee in _?[new Ke(U.key,ne,"stop domain values must be unique")]:(_[ee]=!0,[])):[new Ke(U.key,ne,`integer expected, found ${ee}`)]}}function Ya(s){const t=(s.expressionContext==="property"?Du:nc)(Ha(s.value),s.valueSpec);if(t.result==="error")return t.value.map(u=>new Ke(`${s.key}${u.key}`,s.value,u.message));const a=t.value.expression||t.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!a.outputDefined())return[new Ke(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!nl(a))return[new Ke(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter"&&!nl(a))return[new Ke(s.key,s.value,'"feature-state" data expressions are not supported with filters.')];if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!Kl(a,["zoom","feature-state"]))return[new Ke(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!Yl(a))return[new Ke(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function hl(s){const t=s.key,a=s.value,u=s.valueSpec,d=[];return Array.isArray(u.values)?u.values.indexOf(Ti(a))===-1&&d.push(new Ke(t,a,`expected one of [${u.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(u.values).indexOf(Ti(a))===-1&&d.push(new Ke(t,a,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(a)} found`)),d}function Eo(s){return ll(Ha(s.value))?Ya(cn({},s,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ad(s)}function Ad(s){const t=s.value,a=s.key;if(Br(t)!=="array")return[new Ke(a,t,`array expected, ${Br(t)} found`)];const u=s.styleSpec;let d,g=[];if(t.length<1)return[new Ke(a,t,"filter array must have at least 1 element")];switch(g=g.concat(hl({key:`${a}[0]`,value:t[0],valueSpec:u.filter_operator,style:s.style,styleSpec:s.styleSpec})),Ti(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Ti(t[1])==="$type"&&g.push(new Ke(a,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&g.push(new Ke(a,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(d=Br(t[1]),d!=="string"&&g.push(new Ke(`${a}[1]`,t[1],`string expected, ${d} found`)));for(let _=2;_<t.length;_++)d=Br(t[_]),Ti(t[1])==="$type"?g=g.concat(hl({key:`${a}[${_}]`,value:t[_],valueSpec:u.geometry_type,style:s.style,styleSpec:s.styleSpec})):d!=="string"&&d!=="number"&&d!=="boolean"&&g.push(new Ke(`${a}[${_}]`,t[_],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let _=1;_<t.length;_++)g=g.concat(Ad({key:`${a}[${_}]`,value:t[_],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":d=Br(t[1]),t.length!==2?g.push(new Ke(a,t,`filter array for "${t[0]}" operator must have 2 elements`)):d!=="string"&&g.push(new Ke(`${a}[1]`,t[1],`string expected, ${d} found`));break;case"within":d=Br(t[1]),t.length!==2?g.push(new Ke(a,t,`filter array for "${t[0]}" operator must have 2 elements`)):d!=="object"&&g.push(new Ke(`${a}[1]`,t[1],`object expected, ${d} found`))}return g}function Ed(s,t){const a=s.key,u=s.validateSpec,d=s.style,g=s.styleSpec,_=s.value,x=s.objectKey,I=g[`${t}_${s.layerType}`];if(!I)return[];const A=x.match(/^(.*)-transition$/);if(t==="paint"&&A&&I[A[1]]&&I[A[1]].transition)return u({key:a,value:_,valueSpec:g.transition,style:d,styleSpec:g});const M=s.valueSpec||I[x];if(!M)return[new Ke(a,_,`unknown property "${x}"`)];let L;if(Br(_)==="string"&&ko(M)&&!M.tokens&&(L=/^{([^}]+)}$/.exec(_)))return[new Ke(a,_,`"${x}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(L[1])} }\`.`)];const F=[];return s.layerType==="symbol"&&(x==="text-field"&&d&&!d.glyphs&&F.push(new Ke(a,_,'use of "text-field" requires a style "glyphs" property')),x==="text-font"&&vi(Ha(_))&&Ti(_.type)==="identity"&&F.push(new Ke(a,_,'"text-font" does not support identity functions'))),F.concat(u({key:s.key,value:_,valueSpec:M,style:d,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:x}))}function Cd(s){return Ed(s,"paint")}function Md(s){return Ed(s,"layout")}function Dd(s){let t=[];const a=s.value,u=s.key,d=s.style,g=s.styleSpec;a.type||a.ref||t.push(new Ke(u,a,'either "type" or "ref" is required'));let _=Ti(a.type);const x=Ti(a.ref);if(a.id){const I=Ti(a.id);for(let A=0;A<s.arrayIndex;A++){const M=d.layers[A];Ti(M.id)===I&&t.push(new Ke(u,a.id,`duplicate layer id "${a.id}", previously used at line ${M.id.__line__}`))}}if("ref"in a){let I;["type","source","source-layer","filter","layout"].forEach(A=>{A in a&&t.push(new Ke(u,a[A],`"${A}" is prohibited for ref layers`))}),d.layers.forEach(A=>{Ti(A.id)===x&&(I=A)}),I?I.ref?t.push(new Ke(u,a.ref,"ref cannot reference another ref layer")):_=Ti(I.type):t.push(new Ke(u,a.ref,`ref layer "${x}" not found`))}else if(_!=="background")if(a.source){const I=d.sources&&d.sources[a.source],A=I&&Ti(I.type);I?A==="vector"&&_==="raster"?t.push(new Ke(u,a.source,`layer "${a.id}" requires a raster source`)):A!=="raster-dem"&&_==="hillshade"?t.push(new Ke(u,a.source,`layer "${a.id}" requires a raster-dem source`)):A==="raster"&&_!=="raster"?t.push(new Ke(u,a.source,`layer "${a.id}" requires a vector source`)):A!=="vector"||a["source-layer"]?A==="raster-dem"&&_!=="hillshade"?t.push(new Ke(u,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):_!=="line"||!a.paint||!a.paint["line-gradient"]||A==="geojson"&&I.lineMetrics||t.push(new Ke(u,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Ke(u,a,`layer "${a.id}" must specify a "source-layer"`)):t.push(new Ke(u,a.source,`source "${a.source}" not found`))}else t.push(new Ke(u,a,'missing required property "source"'));return t=t.concat(Bn({key:u,value:a,valueSpec:g.layer,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,objectElementValidators:{"*":()=>[],type:()=>s.validateSpec({key:`${u}.type`,value:a.type,valueSpec:g.layer.type,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,object:a,objectKey:"type"}),filter:Eo,layout:I=>Bn({layer:a,key:I.key,value:I.value,style:I.style,styleSpec:I.styleSpec,validateSpec:I.validateSpec,objectElementValidators:{"*":A=>Md(cn({layerType:_},A))}}),paint:I=>Bn({layer:a,key:I.key,value:I.value,style:I.style,styleSpec:I.styleSpec,validateSpec:I.validateSpec,objectElementValidators:{"*":A=>Cd(cn({layerType:_},A))}})}})),t}function Bs(s){const t=s.value,a=s.key,u=Br(t);return u!=="string"?[new Ke(a,t,`string expected, ${u} found`)]:[]}const dl={promoteId:function({key:s,value:t}){if(Br(t)==="string")return Bs({key:s,value:t});{const a=[];for(const u in t)a.push(...Bs({key:`${s}.${u}`,value:t[u]}));return a}}};function Yn(s){const t=s.value,a=s.key,u=s.styleSpec,d=s.style,g=s.validateSpec;if(!t.type)return[new Ke(a,t,'"type" is required')];const _=Ti(t.type);let x;switch(_){case"vector":case"raster":return x=Bn({key:a,value:t,valueSpec:u[`source_${_.replace("-","_")}`],style:s.style,styleSpec:u,objectElementValidators:dl,validateSpec:g}),x;case"raster-dem":return x=function(I){var A;const M=(A=I.sourceName)!==null&&A!==void 0?A:"",L=I.value,F=I.styleSpec,U=F.source_raster_dem,V=I.style;let Z=[];const ee=Br(L);if(L===void 0)return Z;if(ee!=="object")return Z.push(new Ke("source_raster_dem",L,`object expected, ${ee} found`)),Z;const ne=Ti(L.encoding)==="custom",ye=["redFactor","greenFactor","blueFactor","baseShift"],ce=I.value.encoding?`"${I.value.encoding}"`:"Default";for(const ve in L)!ne&&ye.includes(ve)?Z.push(new Ke(ve,L[ve],`In "${M}": "${ve}" is only valid when "encoding" is set to "custom". ${ce} encoding found`)):U[ve]?Z=Z.concat(I.validateSpec({key:ve,value:L[ve],valueSpec:U[ve],validateSpec:I.validateSpec,style:V,styleSpec:F})):Z.push(new Ke(ve,L[ve],`unknown property "${ve}"`));return Z}({sourceName:a,value:t,style:s.style,styleSpec:u,validateSpec:g}),x;case"geojson":if(x=Bn({key:a,value:t,valueSpec:u.source_geojson,style:d,styleSpec:u,validateSpec:g,objectElementValidators:dl}),t.cluster)for(const I in t.clusterProperties){const[A,M]=t.clusterProperties[I],L=typeof A=="string"?[A,["accumulated"],["get",I]]:A;x.push(...Ya({key:`${a}.${I}.map`,value:M,validateSpec:g,expressionContext:"cluster-map"})),x.push(...Ya({key:`${a}.${I}.reduce`,value:L,validateSpec:g,expressionContext:"cluster-reduce"}))}return x;case"video":return Bn({key:a,value:t,valueSpec:u.source_video,style:d,validateSpec:g,styleSpec:u});case"image":return Bn({key:a,value:t,valueSpec:u.source_image,style:d,validateSpec:g,styleSpec:u});case"canvas":return[new Ke(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return hl({key:`${a}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:d,validateSpec:g,styleSpec:u})}}function fl(s){const t=s.value,a=s.styleSpec,u=a.light,d=s.style;let g=[];const _=Br(t);if(t===void 0)return g;if(_!=="object")return g=g.concat([new Ke("light",t,`object expected, ${_} found`)]),g;for(const x in t){const I=x.match(/^(.*)-transition$/);g=g.concat(I&&u[I[1]]&&u[I[1]].transition?s.validateSpec({key:x,value:t[x],valueSpec:a.transition,validateSpec:s.validateSpec,style:d,styleSpec:a}):u[x]?s.validateSpec({key:x,value:t[x],valueSpec:u[x],validateSpec:s.validateSpec,style:d,styleSpec:a}):[new Ke(x,t[x],`unknown property "${x}"`)])}return g}function Pd(s){const t=s.value,a=s.styleSpec,u=a.terrain,d=s.style;let g=[];const _=Br(t);if(t===void 0)return g;if(_!=="object")return g=g.concat([new Ke("terrain",t,`object expected, ${_} found`)]),g;for(const x in t)g=g.concat(u[x]?s.validateSpec({key:x,value:t[x],valueSpec:u[x],validateSpec:s.validateSpec,style:d,styleSpec:a}):[new Ke(x,t[x],`unknown property "${x}"`)]);return g}function Ld(s){let t=[];const a=s.value,u=s.key;if(Array.isArray(a)){const d=[],g=[];for(const _ in a)a[_].id&&d.includes(a[_].id)&&t.push(new Ke(u,a,`all the sprites' ids must be unique, but ${a[_].id} is duplicated`)),d.push(a[_].id),a[_].url&&g.includes(a[_].url)&&t.push(new Ke(u,a,`all the sprites' URLs must be unique, but ${a[_].url} is duplicated`)),g.push(a[_].url),t=t.concat(Bn({key:`${u}[${_}]`,value:a[_],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:s.validateSpec}));return t}return Bs({key:u,value:a})}const zd={"*":()=>[],array:Ao,boolean:function(s){const t=s.value,a=s.key,u=Br(t);return u!=="boolean"?[new Ke(a,t,`boolean expected, ${u} found`)]:[]},number:ul,color:function(s){const t=s.key,a=s.value,u=Br(a);return u!=="string"?[new Ke(t,a,`color expected, ${u} found`)]:jr.parse(String(a))?[]:[new Ke(t,a,`color expected, "${a}" found`)]},constants:kd,enum:hl,filter:Eo,function:cc,layer:Dd,object:Bn,source:Yn,light:fl,terrain:Pd,string:Bs,formatted:function(s){return Bs(s).length===0?[]:Ya(s)},resolvedImage:function(s){return Bs(s).length===0?[]:Ya(s)},padding:function(s){const t=s.key,a=s.value;if(Br(a)==="array"){if(a.length<1||a.length>4)return[new Ke(t,a,`padding requires 1 to 4 values; ${a.length} values found`)];const u={type:"number"};let d=[];for(let g=0;g<a.length;g++)d=d.concat(s.validateSpec({key:`${t}[${g}]`,value:a[g],validateSpec:s.validateSpec,valueSpec:u}));return d}return ul({key:t,value:a,valueSpec:{}})},variableAnchorOffsetCollection:function(s){const t=s.key,a=s.value,u=Br(a),d=s.styleSpec;if(u!=="array"||a.length<1||a.length%2!=0)return[new Ke(t,a,"variableAnchorOffsetCollection requires a non-empty array of even length")];let g=[];for(let _=0;_<a.length;_+=2)g=g.concat(hl({key:`${t}[${_}]`,value:a[_],valueSpec:d.layout_symbol["text-anchor"]})),g=g.concat(Ao({key:`${t}[${_+1}]`,value:a[_+1],valueSpec:{length:2,value:"number"},validateSpec:s.validateSpec,style:s.style,styleSpec:d}));return g},sprite:Ld};function Qs(s){const t=s.value,a=s.valueSpec,u=s.styleSpec;return s.validateSpec=Qs,a.expression&&vi(Ti(t))?cc(s):a.expression&&ic(Ha(t))?Ya(s):a.type&&zd[a.type]?zd[a.type](s):Bn(cn({},s,{valueSpec:a.type?u[a.type]:a}))}function Bd(s){const t=s.value,a=s.key,u=Bs(s);return u.length||(t.indexOf("{fontstack}")===-1&&u.push(new Ke(a,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&u.push(new Ke(a,t,'"glyphs" url must include a "{range}" token'))),u}function fs(s,t=Ce){let a=[];return a=a.concat(Qs({key:"",value:s,valueSpec:t.$root,styleSpec:t,style:s,validateSpec:Qs,objectElementValidators:{glyphs:Bd,"*":()=>[]}})),s.constants&&(a=a.concat(kd({key:"constants",value:s.constants,style:s,styleSpec:t,validateSpec:Qs}))),uc(a)}function ea(s){return function(t){return s({...t,validateSpec:Qs})}}function uc(s){return[].concat(s).sort((t,a)=>t.line-a.line)}function ta(s){return function(...t){return uc(s.apply(this,t))}}fs.source=ta(ea(Yn)),fs.sprite=ta(ea(Ld)),fs.glyphs=ta(ea(Bd)),fs.light=ta(ea(fl)),fs.terrain=ta(ea(Pd)),fs.layer=ta(ea(Dd)),fs.filter=ta(ea(Eo)),fs.paintProperty=ta(ea(Cd)),fs.layoutProperty=ta(ea(Md));const ra=fs,mm=ra.light,zu=ra.paintProperty,Rd=ra.layoutProperty;function hc(s,t){let a=!1;if(t&&t.length)for(const u of t)s.fire(new Gi(new Error(u.message))),a=!0;return a}class Co{constructor(t,a,u){const d=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const _=new Int32Array(this.arrayBuffer);t=_[0],this.d=(a=_[1])+2*(u=_[2]);for(let I=0;I<this.d*this.d;I++){const A=_[3+I],M=_[3+I+1];d.push(A===M?null:_.subarray(A,M))}const x=_[3+d.length+1];this.keys=_.subarray(_[3+d.length],x),this.bboxes=_.subarray(x),this.insert=this._insertReadonly}else{this.d=a+2*u;for(let _=0;_<this.d*this.d;_++)d.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=t,this.padding=u,this.scale=a/t,this.uid=0;const g=u/a*t;this.min=-g,this.max=t+g}insert(t,a,u,d,g){this._forEachCell(a,u,d,g,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(d),this.bboxes.push(g)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,a,u,d,g,_){this.cells[g].push(_)}query(t,a,u,d,g){const _=this.min,x=this.max;if(t<=_&&a<=_&&x<=u&&x<=d&&!g)return Array.prototype.slice.call(this.keys);{const I=[];return this._forEachCell(t,a,u,d,this._queryCell,I,{},g),I}}_queryCell(t,a,u,d,g,_,x,I){const A=this.cells[g];if(A!==null){const M=this.keys,L=this.bboxes;for(let F=0;F<A.length;F++){const U=A[F];if(x[U]===void 0){const V=4*U;(I?I(L[V+0],L[V+1],L[V+2],L[V+3]):t<=L[V+2]&&a<=L[V+3]&&u>=L[V+0]&&d>=L[V+1])?(x[U]=!0,_.push(M[U])):x[U]=!1}}}}_forEachCell(t,a,u,d,g,_,x,I){const A=this._convertToCellCoord(t),M=this._convertToCellCoord(a),L=this._convertToCellCoord(u),F=this._convertToCellCoord(d);for(let U=A;U<=L;U++)for(let V=M;V<=F;V++){const Z=this.d*V+U;if((!I||I(this._convertFromCellCoord(U),this._convertFromCellCoord(V),this._convertFromCellCoord(U+1),this._convertFromCellCoord(V+1)))&&g.call(this,t,a,u,d,Z,_,x,I))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,a=3+this.cells.length+1+1;let u=0;for(let _=0;_<this.cells.length;_++)u+=this.cells[_].length;const d=new Int32Array(a+u+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;let g=a;for(let _=0;_<t.length;_++){const x=t[_];d[3+_]=g,d.set(x,g),g+=x.length}return d[3+t.length]=g,d.set(this.keys,g),g+=this.keys.length,d[3+t.length+1]=g,d.set(this.bboxes,g),g+=this.bboxes.length,d.buffer}static serialize(t,a){const u=t.toArrayBuffer();return a&&a.push(u),{buffer:u}}static deserialize(t){return new Co(t.buffer)}}const ia={};function yt(s,t,a={}){if(ia[s])throw new Error(`${s} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:s,writeable:!1}),ia[s]={klass:t,omit:a.omit||[],shallow:a.shallow||[]}}yt("Object",Object),yt("TransferableGridIndex",Co),yt("Color",jr),yt("Error",Error),yt("AJAXError",je),yt("ResolvedImage",hn),yt("StylePropertyFunction",al),yt("StyleExpression",Cu,{omit:["_evaluator"]}),yt("ZoomDependentExpression",sc),yt("ZoomConstantExpression",Mu),yt("CompoundExpression",ds,{omit:["_evaluate"]});for(const s in To)To[s]._classRegistryKey||yt(`Expression_${s}`,To[s]);function dc(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function wa(s,t){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob)return s;if(dc(s)||ht(s))return t&&t.push(s),s;if(ArrayBuffer.isView(s)){const a=s;return t&&t.push(a.buffer),a}if(s instanceof ImageData)return t&&t.push(s.data.buffer),s;if(Array.isArray(s)){const a=[];for(const u of s)a.push(wa(u,t));return a}if(typeof s=="object"){const a=s.constructor,u=a._classRegistryKey;if(!u)throw new Error("can't serialize object of unregistered class");if(!ia[u])throw new Error(`${u} is not registered.`);const d=a.serialize?a.serialize(s,t):{};if(a.serialize){if(t&&d===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const g in s){if(!s.hasOwnProperty(g)||ia[u].omit.indexOf(g)>=0)continue;const _=s[g];d[g]=ia[u].shallow.indexOf(g)>=0?_:wa(_,t)}s instanceof Error&&(d.message=s.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(d.$name=u),d}throw new Error("can't serialize object of type "+typeof s)}function Mo(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||dc(s)||ht(s)||ArrayBuffer.isView(s)||s instanceof ImageData)return s;if(Array.isArray(s))return s.map(Mo);if(typeof s=="object"){const t=s.$name||"Object";if(!ia[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:a}=ia[t];if(!a)throw new Error(`can't deserialize unregistered class ${t}`);if(a.deserialize)return a.deserialize(s);const u=Object.create(a.prototype);for(const d of Object.keys(s)){if(d==="$name")continue;const g=s[d];u[d]=ia[t].shallow.indexOf(d)>=0?g:Mo(g)}return u}throw new Error("can't deserialize object of type "+typeof s)}class Fd{constructor(){this.first=!0}update(t,a){const u=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=a):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=a),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=u,!0))}}const ft={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function Bu(s){for(const t of s)if(Fu(t.charCodeAt(0)))return!0;return!1}function Ru(s){for(const t of s)if(!gm(t.charCodeAt(0)))return!1;return!0}function gm(s){return!(ft.Arabic(s)||ft["Arabic Supplement"](s)||ft["Arabic Extended-A"](s)||ft["Arabic Presentation Forms-A"](s)||ft["Arabic Presentation Forms-B"](s))}function Fu(s){return!(s!==746&&s!==747&&(s<4352||!(ft["Bopomofo Extended"](s)||ft.Bopomofo(s)||ft["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||ft["CJK Compatibility Ideographs"](s)||ft["CJK Compatibility"](s)||ft["CJK Radicals Supplement"](s)||ft["CJK Strokes"](s)||!(!ft["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||ft["CJK Unified Ideographs Extension A"](s)||ft["CJK Unified Ideographs"](s)||ft["Enclosed CJK Letters and Months"](s)||ft["Hangul Compatibility Jamo"](s)||ft["Hangul Jamo Extended-A"](s)||ft["Hangul Jamo Extended-B"](s)||ft["Hangul Jamo"](s)||ft["Hangul Syllables"](s)||ft.Hiragana(s)||ft["Ideographic Description Characters"](s)||ft.Kanbun(s)||ft["Kangxi Radicals"](s)||ft["Katakana Phonetic Extensions"](s)||ft.Katakana(s)&&s!==12540||!(!ft["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!ft["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||ft["Unified Canadian Aboriginal Syllabics"](s)||ft["Unified Canadian Aboriginal Syllabics Extended"](s)||ft["Vertical Forms"](s)||ft["Yijing Hexagram Symbols"](s)||ft["Yi Syllables"](s)||ft["Yi Radicals"](s))))}function Od(s){return!(Fu(s)||function(t){return!!(ft["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||ft["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||ft["Letterlike Symbols"](t)||ft["Number Forms"](t)||ft["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||ft["Control Pictures"](t)&&t!==9251||ft["Optical Character Recognition"](t)||ft["Enclosed Alphanumerics"](t)||ft["Geometric Shapes"](t)||ft["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||ft["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||ft["CJK Symbols and Punctuation"](t)||ft.Katakana(t)||ft["Private Use Area"](t)||ft["CJK Compatibility Forms"](t)||ft["Small Form Variants"](t)||ft["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(s))}function Nd(s){return s>=1424&&s<=2303||ft["Arabic Presentation Forms-A"](s)||ft["Arabic Presentation Forms-B"](s)}function Ud(s,t){return!(!t&&Nd(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||ft.Khmer(s))}function ym(s){for(const t of s)if(Nd(t.charCodeAt(0)))return!0;return!1}const Ou="deferred",Nu="loading",Uu="loaded";let $u=null,Rn="unavailable",Sa=null;const pl=function(s){s&&typeof s=="string"&&s.indexOf("NetworkError")>-1&&(Rn="error"),$u&&$u(s)};function Vu(){ml.fire(new ai("pluginStateChange",{pluginStatus:Rn,pluginURL:Sa}))}const ml=new Mi,ju=function(){return Rn},$d=function(){if(Rn!==Ou||!Sa)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Rn=Nu,Vu(),Sa&&$r({url:Sa},s=>{s?pl(s):(Rn=Uu,Vu())})},Kn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Rn===Uu||Kn.applyArabicShaping!=null,isLoading:()=>Rn===Nu,setState(s){if(!gt())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Rn=s.pluginStatus,Sa=s.pluginURL},isParsed(){if(!gt())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Kn.applyArabicShaping!=null&&Kn.processBidirectionalText!=null&&Kn.processStyledBidirectionalText!=null},getPluginURL(){if(!gt())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Sa}};class li{constructor(t,a){this.zoom=t,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.zoomHistory=a.zoomHistory,this.transition=a.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Fd,this.transition={})}isSupportedScript(t){return function(a,u){for(const d of a)if(!Ud(d.charCodeAt(0),u))return!1;return!0}(t,Kn.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,a=t-Math.floor(t),u=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:a+(1-a)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*a}}}class fc{constructor(t,a){this.property=t,this.value=a,this.expression=function(u,d){if(vi(u))return new al(u,d);if(ic(u)){const g=Du(u,d);if(g.result==="error")throw new Error(g.value.map(_=>`${_.key}: ${_.message}`).join(", "));return g.value}{let g=u;return d.type==="color"&&typeof u=="string"?g=jr.parse(u):d.type!=="padding"||typeof u!="number"&&!Array.isArray(u)?d.type==="variableAnchorOffsetCollection"&&Array.isArray(u)&&(g=us.parse(u)):g=Zn.parse(u),{kind:"constant",evaluate:()=>g}}}(a===void 0?t.specification.default:a,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,a,u){return this.property.possiblyEvaluate(this,t,a,u)}}class qu{constructor(t){this.property=t,this.value=new fc(t,void 0)}transitioned(t,a){return new jd(this.property,this.value,a,Ee({},t.transition,this.transition),t.now)}untransitioned(){return new jd(this.property,this.value,null,{},0)}}class Vd{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Ze(this._values[t].value.value)}setValue(t,a){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new qu(this._values[t].property)),this._values[t].value=new fc(this._values[t].property,a===null?void 0:Ze(a))}getTransition(t){return Ze(this._values[t].transition)}setTransition(t,a){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new qu(this._values[t].property)),this._values[t].transition=Ze(a)||void 0}serialize(){const t={};for(const a of Object.keys(this._values)){const u=this.getValue(a);u!==void 0&&(t[a]=u);const d=this.getTransition(a);d!==void 0&&(t[`${a}-transition`]=d)}return t}transitioned(t,a){const u=new qd(this._properties);for(const d of Object.keys(this._values))u._values[d]=this._values[d].transitioned(t,a._values[d]);return u}untransitioned(){const t=new qd(this._properties);for(const a of Object.keys(this._values))t._values[a]=this._values[a].untransitioned();return t}}class jd{constructor(t,a,u,d,g){this.property=t,this.value=a,this.begin=g+d.delay||0,this.end=this.begin+d.duration||0,t.specification.transition&&(d.delay||d.duration)&&(this.prior=u)}possiblyEvaluate(t,a,u){const d=t.now||0,g=this.value.possiblyEvaluate(t,a,u),_=this.prior;if(_){if(d>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(d<this.begin)return _.possiblyEvaluate(t,a,u);{const x=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(t,a,u),g,function(I){if(I<=0)return 0;if(I>=1)return 1;const A=I*I,M=A*I;return 4*(I<.5?M:3*(I-A)+M-.75)}(x))}}return g}}class qd{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,a,u){const d=new pc(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].possiblyEvaluate(t,a,u);return d}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class _m{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return Ze(this._values[t].value)}setValue(t,a){this._values[t]=new fc(this._values[t].property,a===null?void 0:Ze(a))}serialize(){const t={};for(const a of Object.keys(this._values)){const u=this.getValue(a);u!==void 0&&(t[a]=u)}return t}possiblyEvaluate(t,a,u){const d=new pc(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].possiblyEvaluate(t,a,u);return d}}class En{constructor(t,a,u){this.property=t,this.value=a,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,a,u,d){return this.property.evaluate(this.value,this.parameters,t,a,u,d)}}class pc{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Et{constructor(t){this.specification=t}possiblyEvaluate(t,a){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(a)}interpolate(t,a,u){const d=Wn[this.specification.type];return d?d(t,a,u):t}}class Rt{constructor(t,a){this.specification=t,this.overrides=a}possiblyEvaluate(t,a,u,d){return new En(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(a,null,{},u,d)}:t.expression,a)}interpolate(t,a,u){if(t.value.kind!=="constant"||a.value.kind!=="constant")return t;if(t.value.value===void 0||a.value.value===void 0)return new En(this,{kind:"constant",value:void 0},t.parameters);const d=Wn[this.specification.type];if(d){const g=d(t.value.value,a.value.value,u);return new En(this,{kind:"constant",value:g},t.parameters)}return t}evaluate(t,a,u,d,g,_){return t.kind==="constant"?t.value:t.evaluate(a,u,d,g,_)}}class gl extends Rt{possiblyEvaluate(t,a,u,d){if(t.value===void 0)return new En(this,{kind:"constant",value:void 0},a);if(t.expression.kind==="constant"){const g=t.expression.evaluate(a,null,{},u,d),_=t.property.specification.type==="resolvedImage"&&typeof g!="string"?g.name:g,x=this._calculate(_,_,_,a);return new En(this,{kind:"constant",value:x},a)}if(t.expression.kind==="camera"){const g=this._calculate(t.expression.evaluate({zoom:a.zoom-1}),t.expression.evaluate({zoom:a.zoom}),t.expression.evaluate({zoom:a.zoom+1}),a);return new En(this,{kind:"constant",value:g},a)}return new En(this,t.expression,a)}evaluate(t,a,u,d,g,_){if(t.kind==="source"){const x=t.evaluate(a,u,d,g,_);return this._calculate(x,x,x,a)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(a.zoom)-1},u,d),t.evaluate({zoom:Math.floor(a.zoom)},u,d),t.evaluate({zoom:Math.floor(a.zoom)+1},u,d),a):t.value}_calculate(t,a,u,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:t,to:a}:{from:u,to:a}}interpolate(t){return t}}class Gu{constructor(t){this.specification=t}possiblyEvaluate(t,a,u,d){if(t.value!==void 0){if(t.expression.kind==="constant"){const g=t.expression.evaluate(a,null,{},u,d);return this._calculate(g,g,g,a)}return this._calculate(t.expression.evaluate(new li(Math.floor(a.zoom-1),a)),t.expression.evaluate(new li(Math.floor(a.zoom),a)),t.expression.evaluate(new li(Math.floor(a.zoom+1),a)),a)}}_calculate(t,a,u,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:t,to:a}:{from:u,to:a}}interpolate(t){return t}}class Zu{constructor(t){this.specification=t}possiblyEvaluate(t,a,u,d){return!!t.expression.evaluate(a,null,{},u,d)}interpolate(){return!1}}class Ri{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const a in t){const u=t[a];u.specification.overridable&&this.overridableProperties.push(a);const d=this.defaultPropertyValues[a]=new fc(u,void 0),g=this.defaultTransitionablePropertyValues[a]=new qu(u);this.defaultTransitioningPropertyValues[a]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=d.possiblyEvaluate({})}}}yt("DataDrivenProperty",Rt),yt("DataConstantProperty",Et),yt("CrossFadedDataDrivenProperty",gl),yt("CrossFadedProperty",Gu),yt("ColorRampProperty",Zu);const Wu="-transition";class ps extends Mi{constructor(t,a){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),a.layout&&(this._unevaluatedLayout=new _m(a.layout)),a.paint)){this._transitionablePaint=new Vd(a.paint);for(const u in t.paint)this.setPaintProperty(u,t.paint[u],{validate:!1});for(const u in t.layout)this.setLayoutProperty(u,t.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new pc(a.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,a,u={}){a!=null&&this._validate(Rd,`layers.${this.id}.layout.${t}`,t,a,u)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,a):this.visibility=a)}getPaintProperty(t){return t.endsWith(Wu)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,a,u={}){if(a!=null&&this._validate(zu,`layers.${this.id}.paint.${t}`,t,a,u))return!1;if(t.endsWith(Wu))return this._transitionablePaint.setTransition(t.slice(0,-11),a||void 0),!1;{const d=this._transitionablePaint._values[t],g=d.property.specification["property-type"]==="cross-faded-data-driven",_=d.value.isDataDriven(),x=d.value;this._transitionablePaint.setValue(t,a),this._handleSpecialPaintPropertyUpdate(t);const I=this._transitionablePaint._values[t].value;return I.isDataDriven()||_||g||this._handleOverridablePaintPropertyUpdate(t,x,I)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,a,u){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,a){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,a)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),qe(t,(a,u)=>!(a===void 0||u==="layout"&&!Object.keys(a).length||u==="paint"&&!Object.keys(a).length))}_validate(t,a,u,d,g={}){return(!g||g.validate!==!1)&&hc(this,t.call(ra,{key:a,layerType:this.type,objectKey:u,value:d,styleSpec:Ce,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const a=this.paint.get(t);if(a instanceof En&&ko(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}return!1}}const Gd={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ka{constructor(t,a){this._structArray=t,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ki{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,a){return t._trim(),a&&(t.isTransferred=!0,a.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const a=Object.create(this.prototype);return a.arrayBuffer=t.arrayBuffer,a.length=t.length,a.capacity=t.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function xi(s,t=1){let a=0,u=0;return{members:s.map(d=>{const g=Gd[d.type].BYTES_PER_ELEMENT,_=a=Do(a,Math.max(t,g)),x=d.components||1;return u=Math.max(u,g),a+=g*x,{name:d.name,type:d.type,components:x,offset:_}}),size:Do(a,Math.max(u,t)),alignment:t}}function Do(s,t){return Math.ceil(s/t)*t}class yl extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a){const u=this.length;return this.resize(u+1),this.emplace(u,t,a)}emplace(t,a,u){const d=2*t;return this.int16[d+0]=a,this.int16[d+1]=u,t}}yl.prototype.bytesPerElement=4,yt("StructArrayLayout2i4",yl);class _l extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,a,u)}emplace(t,a,u,d){const g=3*t;return this.int16[g+0]=a,this.int16[g+1]=u,this.int16[g+2]=d,t}}_l.prototype.bytesPerElement=6,yt("StructArrayLayout3i6",_l);class Xa extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,u,d){const g=this.length;return this.resize(g+1),this.emplace(g,t,a,u,d)}emplace(t,a,u,d,g){const _=4*t;return this.int16[_+0]=a,this.int16[_+1]=u,this.int16[_+2]=d,this.int16[_+3]=g,t}}Xa.prototype.bytesPerElement=8,yt("StructArrayLayout4i8",Xa);class Hu extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,u,d,g,_){const x=this.length;return this.resize(x+1),this.emplace(x,t,a,u,d,g,_)}emplace(t,a,u,d,g,_,x){const I=6*t;return this.int16[I+0]=a,this.int16[I+1]=u,this.int16[I+2]=d,this.int16[I+3]=g,this.int16[I+4]=_,this.int16[I+5]=x,t}}Hu.prototype.bytesPerElement=12,yt("StructArrayLayout2i4i12",Hu);class Yu extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,u,d,g,_){const x=this.length;return this.resize(x+1),this.emplace(x,t,a,u,d,g,_)}emplace(t,a,u,d,g,_,x){const I=4*t,A=8*t;return this.int16[I+0]=a,this.int16[I+1]=u,this.uint8[A+4]=d,this.uint8[A+5]=g,this.uint8[A+6]=_,this.uint8[A+7]=x,t}}Yu.prototype.bytesPerElement=8,yt("StructArrayLayout2i4ub8",Yu);class Po extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a){const u=this.length;return this.resize(u+1),this.emplace(u,t,a)}emplace(t,a,u){const d=2*t;return this.float32[d+0]=a,this.float32[d+1]=u,t}}Po.prototype.bytesPerElement=8,yt("StructArrayLayout2f8",Po);class Ku extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,u,d,g,_,x,I,A,M){const L=this.length;return this.resize(L+1),this.emplace(L,t,a,u,d,g,_,x,I,A,M)}emplace(t,a,u,d,g,_,x,I,A,M,L){const F=10*t;return this.uint16[F+0]=a,this.uint16[F+1]=u,this.uint16[F+2]=d,this.uint16[F+3]=g,this.uint16[F+4]=_,this.uint16[F+5]=x,this.uint16[F+6]=I,this.uint16[F+7]=A,this.uint16[F+8]=M,this.uint16[F+9]=L,t}}Ku.prototype.bytesPerElement=20,yt("StructArrayLayout10ui20",Ku);class Xu extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,u,d,g,_,x,I,A,M,L,F){const U=this.length;return this.resize(U+1),this.emplace(U,t,a,u,d,g,_,x,I,A,M,L,F)}emplace(t,a,u,d,g,_,x,I,A,M,L,F,U){const V=12*t;return this.int16[V+0]=a,this.int16[V+1]=u,this.int16[V+2]=d,this.int16[V+3]=g,this.uint16[V+4]=_,this.uint16[V+5]=x,this.uint16[V+6]=I,this.uint16[V+7]=A,this.int16[V+8]=M,this.int16[V+9]=L,this.int16[V+10]=F,this.int16[V+11]=U,t}}Xu.prototype.bytesPerElement=24,yt("StructArrayLayout4i4ui4i24",Xu);class Rr extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,a,u)}emplace(t,a,u,d){const g=3*t;return this.float32[g+0]=a,this.float32[g+1]=u,this.float32[g+2]=d,t}}Rr.prototype.bytesPerElement=12,yt("StructArrayLayout3f12",Rr);class m extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const a=this.length;return this.resize(a+1),this.emplace(a,t)}emplace(t,a){return this.uint32[1*t+0]=a,t}}m.prototype.bytesPerElement=4,yt("StructArrayLayout1ul4",m);class r extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,u,d,g,_,x,I,A){const M=this.length;return this.resize(M+1),this.emplace(M,t,a,u,d,g,_,x,I,A)}emplace(t,a,u,d,g,_,x,I,A,M){const L=10*t,F=5*t;return this.int16[L+0]=a,this.int16[L+1]=u,this.int16[L+2]=d,this.int16[L+3]=g,this.int16[L+4]=_,this.int16[L+5]=x,this.uint32[F+3]=I,this.uint16[L+8]=A,this.uint16[L+9]=M,t}}r.prototype.bytesPerElement=20,yt("StructArrayLayout6i1ul2ui20",r);class o extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,u,d,g,_){const x=this.length;return this.resize(x+1),this.emplace(x,t,a,u,d,g,_)}emplace(t,a,u,d,g,_,x){const I=6*t;return this.int16[I+0]=a,this.int16[I+1]=u,this.int16[I+2]=d,this.int16[I+3]=g,this.int16[I+4]=_,this.int16[I+5]=x,t}}o.prototype.bytesPerElement=12,yt("StructArrayLayout2i2i2i12",o);class h extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,u,d,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,a,u,d,g)}emplace(t,a,u,d,g,_){const x=4*t,I=8*t;return this.float32[x+0]=a,this.float32[x+1]=u,this.float32[x+2]=d,this.int16[I+6]=g,this.int16[I+7]=_,t}}h.prototype.bytesPerElement=16,yt("StructArrayLayout2f1f2i16",h);class f extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u,d){const g=this.length;return this.resize(g+1),this.emplace(g,t,a,u,d)}emplace(t,a,u,d,g){const _=12*t,x=3*t;return this.uint8[_+0]=a,this.uint8[_+1]=u,this.float32[x+1]=d,this.float32[x+2]=g,t}}f.prototype.bytesPerElement=12,yt("StructArrayLayout2ub2f12",f);class y extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,a,u)}emplace(t,a,u,d){const g=3*t;return this.uint16[g+0]=a,this.uint16[g+1]=u,this.uint16[g+2]=d,t}}y.prototype.bytesPerElement=6,yt("StructArrayLayout3ui6",y);class w extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u,d,g,_,x,I,A,M,L,F,U,V,Z,ee,ne){const ye=this.length;return this.resize(ye+1),this.emplace(ye,t,a,u,d,g,_,x,I,A,M,L,F,U,V,Z,ee,ne)}emplace(t,a,u,d,g,_,x,I,A,M,L,F,U,V,Z,ee,ne,ye){const ce=24*t,ve=12*t,Ie=48*t;return this.int16[ce+0]=a,this.int16[ce+1]=u,this.uint16[ce+2]=d,this.uint16[ce+3]=g,this.uint32[ve+2]=_,this.uint32[ve+3]=x,this.uint32[ve+4]=I,this.uint16[ce+10]=A,this.uint16[ce+11]=M,this.uint16[ce+12]=L,this.float32[ve+7]=F,this.float32[ve+8]=U,this.uint8[Ie+36]=V,this.uint8[Ie+37]=Z,this.uint8[Ie+38]=ee,this.uint32[ve+10]=ne,this.int16[ce+22]=ye,t}}w.prototype.bytesPerElement=48,yt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",w);class S extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u,d,g,_,x,I,A,M,L,F,U,V,Z,ee,ne,ye,ce,ve,Ie,Fe,pt,Tt,lt,at,it,vt){const nt=this.length;return this.resize(nt+1),this.emplace(nt,t,a,u,d,g,_,x,I,A,M,L,F,U,V,Z,ee,ne,ye,ce,ve,Ie,Fe,pt,Tt,lt,at,it,vt)}emplace(t,a,u,d,g,_,x,I,A,M,L,F,U,V,Z,ee,ne,ye,ce,ve,Ie,Fe,pt,Tt,lt,at,it,vt,nt){const Ye=32*t,Dt=16*t;return this.int16[Ye+0]=a,this.int16[Ye+1]=u,this.int16[Ye+2]=d,this.int16[Ye+3]=g,this.int16[Ye+4]=_,this.int16[Ye+5]=x,this.int16[Ye+6]=I,this.int16[Ye+7]=A,this.uint16[Ye+8]=M,this.uint16[Ye+9]=L,this.uint16[Ye+10]=F,this.uint16[Ye+11]=U,this.uint16[Ye+12]=V,this.uint16[Ye+13]=Z,this.uint16[Ye+14]=ee,this.uint16[Ye+15]=ne,this.uint16[Ye+16]=ye,this.uint16[Ye+17]=ce,this.uint16[Ye+18]=ve,this.uint16[Ye+19]=Ie,this.uint16[Ye+20]=Fe,this.uint16[Ye+21]=pt,this.uint16[Ye+22]=Tt,this.uint32[Dt+12]=lt,this.float32[Dt+13]=at,this.float32[Dt+14]=it,this.uint16[Ye+30]=vt,this.uint16[Ye+31]=nt,t}}S.prototype.bytesPerElement=64,yt("StructArrayLayout8i15ui1ul2f2ui64",S);class k extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const a=this.length;return this.resize(a+1),this.emplace(a,t)}emplace(t,a){return this.float32[1*t+0]=a,t}}k.prototype.bytesPerElement=4,yt("StructArrayLayout1f4",k);class C extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,a,u)}emplace(t,a,u,d){const g=3*t;return this.uint16[6*t+0]=a,this.float32[g+1]=u,this.float32[g+2]=d,t}}C.prototype.bytesPerElement=12,yt("StructArrayLayout1ui2f12",C);class D extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,a,u)}emplace(t,a,u,d){const g=4*t;return this.uint32[2*t+0]=a,this.uint16[g+2]=u,this.uint16[g+3]=d,t}}D.prototype.bytesPerElement=8,yt("StructArrayLayout1ul2ui8",D);class P extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a){const u=this.length;return this.resize(u+1),this.emplace(u,t,a)}emplace(t,a,u){const d=2*t;return this.uint16[d+0]=a,this.uint16[d+1]=u,t}}P.prototype.bytesPerElement=4,yt("StructArrayLayout2ui4",P);class N extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const a=this.length;return this.resize(a+1),this.emplace(a,t)}emplace(t,a){return this.uint16[1*t+0]=a,t}}N.prototype.bytesPerElement=2,yt("StructArrayLayout1ui2",N);class H extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u,d){const g=this.length;return this.resize(g+1),this.emplace(g,t,a,u,d)}emplace(t,a,u,d,g){const _=4*t;return this.float32[_+0]=a,this.float32[_+1]=u,this.float32[_+2]=d,this.float32[_+3]=g,t}}H.prototype.bytesPerElement=16,yt("StructArrayLayout4f16",H);class W extends Ka{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new $(this.anchorPointX,this.anchorPointY)}}W.prototype.size=20;class X extends r{get(t){return new W(this,t)}}yt("CollisionBoxArray",X);class G extends Ka{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}G.prototype.size=48;class pe extends w{get(t){return new G(this,t)}}yt("PlacedSymbolArray",pe);class we extends Ka{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}we.prototype.size=64;class re extends S{get(t){return new we(this,t)}}yt("SymbolInstanceArray",re);class me extends k{getoffsetX(t){return this.float32[1*t+0]}}yt("GlyphOffsetArray",me);class Te extends _l{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}yt("SymbolLineVertexArray",Te);class ke extends Ka{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ke.prototype.size=12;class Re extends C{get(t){return new ke(this,t)}}yt("TextAnchorOffsetArray",Re);class He extends Ka{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}He.prototype.size=8;class Ue extends D{get(t){return new He(this,t)}}yt("FeatureIndexArray",Ue);class tt extends yl{}class It extends yl{}class _r extends yl{}class st extends Hu{}class Ft extends Yu{}class kt extends Po{}class qr extends Ku{}class gr extends Xu{}class nr extends Rr{}class vr extends m{}class Pi extends o{}class ri extends f{}class dn extends y{}class Xi extends P{}const Fi=xi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Xn}=Fi;class ci{constructor(t=[]){this.segments=t}prepareSegment(t,a,u,d){let g=this.segments[this.segments.length-1];return t>ci.MAX_VERTEX_ARRAY_LENGTH&&$e(`Max vertices per segment is ${ci.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!g||g.vertexLength+t>ci.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==d)&&(g={vertexOffset:a.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},d!==void 0&&(g.sortKey=d),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const t of this.segments)for(const a in t.vaos)t.vaos[a].destroy()}static simpleSegment(t,a,u,d){return new ci([{vertexOffset:t,primitiveOffset:a,vertexLength:u,primitiveLength:d,vaos:{},sortKey:0}])}}function Rs(s,t){return 256*(s=Me(Math.floor(s),0,255))+Me(Math.floor(t),0,255)}ci.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,yt("SegmentVector",ci);const Fs=xi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Ia={exports:{}},Ja={exports:{}};Ja.exports=function(s,t){var a,u,d,g,_,x,I,A;for(u=s.length-(a=3&s.length),d=t,_=3432918353,x=461845907,A=0;A<u;)I=255&s.charCodeAt(A)|(255&s.charCodeAt(++A))<<8|(255&s.charCodeAt(++A))<<16|(255&s.charCodeAt(++A))<<24,++A,d=27492+(65535&(g=5*(65535&(d=(d^=I=(65535&(I=(I=(65535&I)*_+(((I>>>16)*_&65535)<<16)&4294967295)<<15|I>>>17))*x+(((I>>>16)*x&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(I=0,a){case 3:I^=(255&s.charCodeAt(A+2))<<16;case 2:I^=(255&s.charCodeAt(A+1))<<8;case 1:d^=I=(65535&(I=(I=(65535&(I^=255&s.charCodeAt(A)))*_+(((I>>>16)*_&65535)<<16)&4294967295)<<15|I>>>17))*x+(((I>>>16)*x&65535)<<16)&4294967295}return d^=s.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0};var Lo=Ja.exports,wn={exports:{}};wn.exports=function(s,t){for(var a,u=s.length,d=t^u,g=0;u>=4;)a=1540483477*(65535&(a=255&s.charCodeAt(g)|(255&s.charCodeAt(++g))<<8|(255&s.charCodeAt(++g))<<16|(255&s.charCodeAt(++g))<<24))+((1540483477*(a>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),u-=4,++g;switch(u){case 3:d^=(255&s.charCodeAt(g+2))<<16;case 2:d^=(255&s.charCodeAt(g+1))<<8;case 1:d=1540483477*(65535&(d^=255&s.charCodeAt(g)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0};var fn=Lo,Cn=wn.exports;Ia.exports=fn,Ia.exports.murmur3=fn,Ia.exports.murmur2=Cn;var Qa=T(Ia.exports);class Li{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,a,u,d){this.ids.push(Ji(t)),this.positions.push(a,u,d)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const a=Ji(t);let u=0,d=this.ids.length-1;for(;u<d;){const _=u+d>>1;this.ids[_]>=a?d=_:u=_+1}const g=[];for(;this.ids[u]===a;)g.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return g}static serialize(t,a){const u=new Float64Array(t.ids),d=new Uint32Array(t.positions);return Fn(u,d,0,u.length-1),a&&a.push(u.buffer,d.buffer),{ids:u,positions:d}}static deserialize(t){const a=new Li;return a.ids=t.ids,a.positions=t.positions,a.indexed=!0,a}}function Ji(s){const t=+s;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Qa(String(s))}function Fn(s,t,a,u){for(;a<u;){const d=s[a+u>>1];let g=a-1,_=u+1;for(;;){do g++;while(s[g]<d);do _--;while(s[_]>d);if(g>=_)break;zi(s,g,_),zi(t,3*g,3*_),zi(t,3*g+1,3*_+1),zi(t,3*g+2,3*_+2)}_-a<u-_?(Fn(s,t,a,_),a=_+1):(Fn(s,t,_+1,u),u=_)}}function zi(s,t,a){const u=s[t];s[t]=s[a],s[a]=u}yt("FeaturePositionMap",Li);class eo{constructor(t,a){this.gl=t.gl,this.location=a}}class mc extends eo{constructor(t,a){super(t,a),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Zd extends eo{constructor(t,a){super(t,a),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Wd extends eo{constructor(t,a){super(t,a),this.current=jr.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const vm=new Float32Array(16);function Ju(s){return[Rs(255*s.r,255*s.g),Rs(255*s.b,255*s.a)]}class Os{constructor(t,a,u){this.value=t,this.uniformNames=a.map(d=>`u_${d}`),this.type=u}setUniform(t,a,u){t.set(u.constantOr(this.value))}getBinding(t,a,u){return this.type==="color"?new Wd(t,a):new mc(t,a)}}class to{constructor(t,a){this.uniformNames=a.map(u=>`u_${u}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,a){this.pixelRatioFrom=a.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=a.tlbr,this.patternTo=t.tlbr}setUniform(t,a,u,d){const g=d==="u_pattern_to"?this.patternTo:d==="u_pattern_from"?this.patternFrom:d==="u_pixel_ratio_to"?this.pixelRatioTo:d==="u_pixel_ratio_from"?this.pixelRatioFrom:null;g&&t.set(g)}getBinding(t,a,u){return u.substr(0,9)==="u_pattern"?new Zd(t,a):new mc(t,a)}}class Ns{constructor(t,a,u,d){this.expression=t,this.type=u,this.maxValue=0,this.paintVertexAttributes=a.map(g=>({name:`a_${g}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(t,a,u,d,g){const _=this.paintVertexArray.length,x=this.expression.evaluate(new li(0),a,{},d,[],g);this.paintVertexArray.resize(t),this._setPaintValue(_,t,x)}updatePaintArray(t,a,u,d){const g=this.expression.evaluate({zoom:0},u,d);this._setPaintValue(t,a,g)}_setPaintValue(t,a,u){if(this.type==="color"){const d=Ju(u);for(let g=t;g<a;g++)this.paintVertexArray.emplace(g,d[0],d[1])}else{for(let d=t;d<a;d++)this.paintVertexArray.emplace(d,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ms{constructor(t,a,u,d,g,_){this.expression=t,this.uniformNames=a.map(x=>`u_${x}_t`),this.type=u,this.useIntegerZoom=d,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=a.map(x=>({name:`a_${x}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(t,a,u,d,g){const _=this.expression.evaluate(new li(this.zoom),a,{},d,[],g),x=this.expression.evaluate(new li(this.zoom+1),a,{},d,[],g),I=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(I,t,_,x)}updatePaintArray(t,a,u,d){const g=this.expression.evaluate({zoom:this.zoom},u,d),_=this.expression.evaluate({zoom:this.zoom+1},u,d);this._setPaintValue(t,a,g,_)}_setPaintValue(t,a,u,d){if(this.type==="color"){const g=Ju(u),_=Ju(d);for(let x=t;x<a;x++)this.paintVertexArray.emplace(x,g[0],g[1],_[0],_[1])}else{for(let g=t;g<a;g++)this.paintVertexArray.emplace(g,u,d);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(d))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,a){const u=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,d=Me(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);t.set(d)}getBinding(t,a,u){return new mc(t,a)}}class Us{constructor(t,a,u,d,g,_){this.expression=t,this.type=a,this.useIntegerZoom=u,this.zoom=d,this.layerId=_,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(t,a,u){const d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(d,t,a.patterns&&a.patterns[this.layerId],u)}updatePaintArray(t,a,u,d,g){this._setPaintValues(t,a,u.patterns&&u.patterns[this.layerId],g)}_setPaintValues(t,a,u,d){if(!d||!u)return;const{min:g,mid:_,max:x}=u,I=d[g],A=d[_],M=d[x];if(I&&A&&M)for(let L=t;L<a;L++)this.zoomInPaintVertexArray.emplace(L,A.tl[0],A.tl[1],A.br[0],A.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],A.pixelRatio,I.pixelRatio),this.zoomOutPaintVertexArray.emplace(L,A.tl[0],A.tl[1],A.br[0],A.br[1],M.tl[0],M.tl[1],M.br[0],M.br[1],A.pixelRatio,M.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Fs.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Fs.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Qu{constructor(t,a,u){this.binders={},this._buffers=[];const d=[];for(const g in t.paint._values){if(!u(g))continue;const _=t.paint.get(g);if(!(_ instanceof En&&ko(_.property.specification)))continue;const x=Pw(g,t.type),I=_.value,A=_.property.specification.type,M=_.property.useIntegerZoom,L=_.property.specification["property-type"],F=L==="cross-faded"||L==="cross-faded-data-driven";if(I.kind==="constant")this.binders[g]=F?new to(I.value,x):new Os(I.value,x,A),d.push(`/u_${g}`);else if(I.kind==="source"||F){const U=h_(g,A,"source");this.binders[g]=F?new Us(I,A,M,a,U,t.id):new Ns(I,x,A,U),d.push(`/a_${g}`)}else{const U=h_(g,A,"composite");this.binders[g]=new ms(I,x,A,M,a,U),d.push(`/z_${g}`)}}this.cacheKey=d.sort().join("")}getMaxValue(t){const a=this.binders[t];return a instanceof Ns||a instanceof ms?a.maxValue:0}populatePaintArrays(t,a,u,d,g){for(const _ in this.binders){const x=this.binders[_];(x instanceof Ns||x instanceof ms||x instanceof Us)&&x.populatePaintArray(t,a,u,d,g)}}setConstantPatternPositions(t,a){for(const u in this.binders){const d=this.binders[u];d instanceof to&&d.setConstantPatternPositions(t,a)}}updatePaintArrays(t,a,u,d,g){let _=!1;for(const x in t){const I=a.getPositions(x);for(const A of I){const M=u.feature(A.index);for(const L in this.binders){const F=this.binders[L];if((F instanceof Ns||F instanceof ms||F instanceof Us)&&F.expression.isStateDependent===!0){const U=d.paint.get(L);F.expression=U.value,F.updatePaintArray(A.start,A.end,M,t[x],g),_=!0}}}}return _}defines(){const t=[];for(const a in this.binders){const u=this.binders[a];(u instanceof Os||u instanceof to)&&t.push(...u.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return t}getBinderAttributes(){const t=[];for(const a in this.binders){const u=this.binders[a];if(u instanceof Ns||u instanceof ms)for(let d=0;d<u.paintVertexAttributes.length;d++)t.push(u.paintVertexAttributes[d].name);else if(u instanceof Us)for(let d=0;d<Fs.members.length;d++)t.push(Fs.members[d].name)}return t}getBinderUniforms(){const t=[];for(const a in this.binders){const u=this.binders[a];if(u instanceof Os||u instanceof to||u instanceof ms)for(const d of u.uniformNames)t.push(d)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,a){const u=[];for(const d in this.binders){const g=this.binders[d];if(g instanceof Os||g instanceof to||g instanceof ms){for(const _ of g.uniformNames)if(a[_]){const x=g.getBinding(t,a[_],_);u.push({name:_,property:d,binding:x})}}}return u}setUniforms(t,a,u,d){for(const{name:g,property:_,binding:x}of a)this.binders[_].setUniform(x,d,u.get(_),g)}updatePaintBuffers(t){this._buffers=[];for(const a in this.binders){const u=this.binders[a];if(t&&u instanceof Us){const d=t.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(u instanceof Ns||u instanceof ms)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}}upload(t){for(const a in this.binders){const u=this.binders[a];(u instanceof Ns||u instanceof ms||u instanceof Us)&&u.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const a=this.binders[t];(a instanceof Ns||a instanceof ms||a instanceof Us)&&a.destroy()}}}class na{constructor(t,a,u=()=>!0){this.programConfigurations={};for(const d of t)this.programConfigurations[d.id]=new Qu(d,a,u);this.needsUpload=!1,this._featureMap=new Li,this._bufferOffset=0}populatePaintArrays(t,a,u,d,g,_){for(const x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(t,a,d,g,_);a.id!==void 0&&this._featureMap.add(a.id,u,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,a,u,d){for(const g of u)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(t,this._featureMap,a,g,d)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Pw(s,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[s]||[s.replace(`${t}-`,"").replace(/-/g,"_")]}function h_(s,t,a){const u={color:{source:Po,composite:H},number:{source:k,composite:Po}},d=function(g){return{"line-pattern":{source:qr,composite:qr},"fill-pattern":{source:qr,composite:qr},"fill-extrusion-pattern":{source:qr,composite:qr}}[g]}(s);return d&&d[a]||u[t][a]}yt("ConstantBinder",Os),yt("CrossFadedConstantBinder",to),yt("SourceExpressionBinder",Ns),yt("CrossFadedCompositeBinder",Us),yt("CompositeExpressionBinder",ms),yt("ProgramConfiguration",Qu,{omit:["_buffers"]}),yt("ProgramConfigurationSet",na);const Hi=8192,bm=Math.pow(2,14)-1,d_=-bm-1;function vl(s){const t=Hi/s.extent,a=s.loadGeometry();for(let u=0;u<a.length;u++){const d=a[u];for(let g=0;g<d.length;g++){const _=d[g],x=Math.round(_.x*t),I=Math.round(_.y*t);_.x=Me(x,d_,bm),_.y=Me(I,d_,bm),(x<_.x||x>_.x+1||I<_.y||I>_.y+1)&&$e("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return a}function bl(s,t){return{type:s.type,id:s.id,properties:s.properties,geometry:t?vl(s):[]}}function Hd(s,t,a,u,d){s.emplaceBack(2*t+(u+1)/2,2*a+(d+1)/2)}class xm{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(a=>a.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new It,this.indexArray=new dn,this.segments=new ci,this.programConfigurations=new na(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(t,a,u){const d=this.layers[0],g=[];let _=null,x=!1;d.type==="circle"&&(_=d.layout.get("circle-sort-key"),x=!_.isConstant());for(const{feature:I,id:A,index:M,sourceLayerIndex:L}of t){const F=this.layers[0]._featureFilter.needGeometry,U=bl(I,F);if(!this.layers[0]._featureFilter.filter(new li(this.zoom),U,u))continue;const V=x?_.evaluate(U,{},u):void 0,Z={id:A,properties:I.properties,type:I.type,sourceLayerIndex:L,index:M,geometry:F?U.geometry:vl(I),patterns:{},sortKey:V};g.push(Z)}x&&g.sort((I,A)=>I.sortKey-A.sortKey);for(const I of g){const{geometry:A,index:M,sourceLayerIndex:L}=I,F=t[M].feature;this.addFeature(I,A,M,u),a.featureIndex.insert(F,A,M,L,this.index)}}update(t,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Xn),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,a,u,d){for(const g of a)for(const _ of g){const x=_.x,I=_.y;if(x<0||x>=Hi||I<0||I>=Hi)continue;const A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),M=A.vertexLength;Hd(this.layoutVertexArray,x,I,-1,-1),Hd(this.layoutVertexArray,x,I,1,-1),Hd(this.layoutVertexArray,x,I,1,1),Hd(this.layoutVertexArray,x,I,-1,1),this.indexArray.emplaceBack(M,M+1,M+2),this.indexArray.emplaceBack(M,M+3,M+2),A.vertexLength+=4,A.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,{},d)}}function f_(s,t){for(let a=0;a<s.length;a++)if(gc(t,s[a]))return!0;for(let a=0;a<t.length;a++)if(gc(s,t[a]))return!0;return!!wm(s,t)}function Lw(s,t,a){return!!gc(s,t)||!!Sm(t,s,a)}function p_(s,t){if(s.length===1)return g_(t,s[0]);for(let a=0;a<t.length;a++){const u=t[a];for(let d=0;d<u.length;d++)if(gc(s,u[d]))return!0}for(let a=0;a<s.length;a++)if(g_(t,s[a]))return!0;for(let a=0;a<t.length;a++)if(wm(s,t[a]))return!0;return!1}function zw(s,t,a){if(s.length>1){if(wm(s,t))return!0;for(let u=0;u<t.length;u++)if(Sm(t[u],s,a))return!0}for(let u=0;u<s.length;u++)if(Sm(s[u],t,a))return!0;return!1}function wm(s,t){if(s.length===0||t.length===0)return!1;for(let a=0;a<s.length-1;a++){const u=s[a],d=s[a+1];for(let g=0;g<t.length-1;g++)if(Bw(u,d,t[g],t[g+1]))return!0}return!1}function Bw(s,t,a,u){return We(s,a,u)!==We(t,a,u)&&We(s,t,a)!==We(s,t,u)}function Sm(s,t,a){const u=a*a;if(t.length===1)return s.distSqr(t[0])<u;for(let d=1;d<t.length;d++)if(m_(s,t[d-1],t[d])<u)return!0;return!1}function m_(s,t,a){const u=t.distSqr(a);if(u===0)return s.distSqr(t);const d=((s.x-t.x)*(a.x-t.x)+(s.y-t.y)*(a.y-t.y))/u;return s.distSqr(d<0?t:d>1?a:a.sub(t)._mult(d)._add(t))}function g_(s,t){let a,u,d,g=!1;for(let _=0;_<s.length;_++){a=s[_];for(let x=0,I=a.length-1;x<a.length;I=x++)u=a[x],d=a[I],u.y>t.y!=d.y>t.y&&t.x<(d.x-u.x)*(t.y-u.y)/(d.y-u.y)+u.x&&(g=!g)}return g}function gc(s,t){let a=!1;for(let u=0,d=s.length-1;u<s.length;d=u++){const g=s[u],_=s[d];g.y>t.y!=_.y>t.y&&t.x<(_.x-g.x)*(t.y-g.y)/(_.y-g.y)+g.x&&(a=!a)}return a}function Rw(s,t,a){const u=a[0],d=a[2];if(s.x<u.x&&t.x<u.x||s.x>d.x&&t.x>d.x||s.y<u.y&&t.y<u.y||s.y>d.y&&t.y>d.y)return!1;const g=We(s,t,a[0]);return g!==We(s,t,a[1])||g!==We(s,t,a[2])||g!==We(s,t,a[3])}function eh(s,t,a){const u=t.paint.get(s).value;return u.kind==="constant"?u.value:a.programConfigurations.get(t.id).getMaxValue(s)}function Yd(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function Kd(s,t,a,u,d){if(!t[0]&&!t[1])return s;const g=$.convert(t)._mult(d);a==="viewport"&&g._rotate(-u);const _=[];for(let x=0;x<s.length;x++)_.push(s[x].sub(g));return _}let y_,__;yt("CircleBucket",xm,{omit:["layers"]});var Fw={get paint(){return __=__||new Ri({"circle-radius":new Rt(Ce.paint_circle["circle-radius"]),"circle-color":new Rt(Ce.paint_circle["circle-color"]),"circle-blur":new Rt(Ce.paint_circle["circle-blur"]),"circle-opacity":new Rt(Ce.paint_circle["circle-opacity"]),"circle-translate":new Et(Ce.paint_circle["circle-translate"]),"circle-translate-anchor":new Et(Ce.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Et(Ce.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Et(Ce.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Rt(Ce.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Rt(Ce.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Rt(Ce.paint_circle["circle-stroke-opacity"])})},get layout(){return y_=y_||new Ri({"circle-sort-key":new Rt(Ce.layout_circle["circle-sort-key"])})}},On=1e-6,yc=typeof Float32Array<"u"?Float32Array:Array;function Im(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function v_(s,t,a){var u=t[0],d=t[1],g=t[2],_=t[3],x=t[4],I=t[5],A=t[6],M=t[7],L=t[8],F=t[9],U=t[10],V=t[11],Z=t[12],ee=t[13],ne=t[14],ye=t[15],ce=a[0],ve=a[1],Ie=a[2],Fe=a[3];return s[0]=ce*u+ve*x+Ie*L+Fe*Z,s[1]=ce*d+ve*I+Ie*F+Fe*ee,s[2]=ce*g+ve*A+Ie*U+Fe*ne,s[3]=ce*_+ve*M+Ie*V+Fe*ye,s[4]=(ce=a[4])*u+(ve=a[5])*x+(Ie=a[6])*L+(Fe=a[7])*Z,s[5]=ce*d+ve*I+Ie*F+Fe*ee,s[6]=ce*g+ve*A+Ie*U+Fe*ne,s[7]=ce*_+ve*M+Ie*V+Fe*ye,s[8]=(ce=a[8])*u+(ve=a[9])*x+(Ie=a[10])*L+(Fe=a[11])*Z,s[9]=ce*d+ve*I+Ie*F+Fe*ee,s[10]=ce*g+ve*A+Ie*U+Fe*ne,s[11]=ce*_+ve*M+Ie*V+Fe*ye,s[12]=(ce=a[12])*u+(ve=a[13])*x+(Ie=a[14])*L+(Fe=a[15])*Z,s[13]=ce*d+ve*I+Ie*F+Fe*ee,s[14]=ce*g+ve*A+Ie*U+Fe*ne,s[15]=ce*_+ve*M+Ie*V+Fe*ye,s}Math.hypot||(Math.hypot=function(){for(var s=0,t=arguments.length;t--;)s+=arguments[t]*arguments[t];return Math.sqrt(s)});var th,Ow=v_;function Xd(s,t,a){var u=t[0],d=t[1],g=t[2],_=t[3];return s[0]=a[0]*u+a[4]*d+a[8]*g+a[12]*_,s[1]=a[1]*u+a[5]*d+a[9]*g+a[13]*_,s[2]=a[2]*u+a[6]*d+a[10]*g+a[14]*_,s[3]=a[3]*u+a[7]*d+a[11]*g+a[15]*_,s}th=new yc(4),yc!=Float32Array&&(th[0]=0,th[1]=0,th[2]=0,th[3]=0);class Nw extends ps{constructor(t){super(t,Fw)}createBucket(t){return new xm(t)}queryRadius(t){const a=t;return eh("circle-radius",this,a)+eh("circle-stroke-width",this,a)+Yd(this.paint.get("circle-translate"))}queryIntersectsFeature(t,a,u,d,g,_,x,I){const A=Kd(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),_.angle,x),M=this.paint.get("circle-radius").evaluate(a,u)+this.paint.get("circle-stroke-width").evaluate(a,u),L=this.paint.get("circle-pitch-alignment")==="map",F=L?A:function(V,Z){return V.map(ee=>b_(ee,Z))}(A,I),U=L?M*x:M;for(const V of d)for(const Z of V){const ee=L?Z:b_(Z,I);let ne=U;const ye=Xd([],[Z.x,Z.y,0,1],I);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ne*=ye[3]/_.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ne*=_.cameraToCenterDistance/ye[3]),Lw(F,ee,ne))return!0}return!1}}function b_(s,t){const a=Xd([],[s.x,s.y,0,1],t);return new $(a[0]/a[3],a[1]/a[3])}class x_ extends xm{}let w_;yt("HeatmapBucket",x_,{omit:["layers"]});var Uw={get paint(){return w_=w_||new Ri({"heatmap-radius":new Rt(Ce.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Rt(Ce.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Et(Ce.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Zu(Ce.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Et(Ce.paint_heatmap["heatmap-opacity"])})}};function Tm(s,{width:t,height:a},u,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==t*a*u)throw new RangeError(`mismatched image size. expected: ${d.length} but got: ${t*a*u}`)}else d=new Uint8Array(t*a*u);return s.width=t,s.height=a,s.data=d,s}function S_(s,{width:t,height:a},u){if(t===s.width&&a===s.height)return;const d=Tm({},{width:t,height:a},u);km(s,d,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,t),height:Math.min(s.height,a)},u),s.width=t,s.height=a,s.data=d.data}function km(s,t,a,u,d,g){if(d.width===0||d.height===0)return t;if(d.width>s.width||d.height>s.height||a.x>s.width-d.width||a.y>s.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>t.width||d.height>t.height||u.x>t.width-d.width||u.y>t.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const _=s.data,x=t.data;if(_===x)throw new Error("srcData equals dstData, so image is already copied");for(let I=0;I<d.height;I++){const A=((a.y+I)*s.width+a.x)*g,M=((u.y+I)*t.width+u.x)*g;for(let L=0;L<d.width*g;L++)x[M+L]=_[A+L]}return t}class rh{constructor(t,a){Tm(this,t,1,a)}resize(t){S_(this,t,1)}clone(){return new rh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,a,u,d,g){km(t,a,u,d,g,1)}}class Is{constructor(t,a){Tm(this,t,4,a)}resize(t){S_(this,t,4)}replace(t,a){a?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Is({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,a,u,d,g){km(t,a,u,d,g,4)}}function I_(s){const t={},a=s.resolution||256,u=s.clips?s.clips.length:1,d=s.image||new Is({width:a,height:u});if(Math.log(a)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${a}`);const g=(_,x,I)=>{t[s.evaluationKey]=I;const A=s.expression.evaluate(t);d.data[_+x+0]=Math.floor(255*A.r/A.a),d.data[_+x+1]=Math.floor(255*A.g/A.a),d.data[_+x+2]=Math.floor(255*A.b/A.a),d.data[_+x+3]=Math.floor(255*A.a)};if(s.clips)for(let _=0,x=0;_<u;++_,x+=4*a)for(let I=0,A=0;I<a;I++,A+=4){const M=I/(a-1),{start:L,end:F}=s.clips[_];g(x,A,L*(1-M)+F*M)}else for(let _=0,x=0;_<a;_++,x+=4)g(0,x,_/(a-1));return d}yt("AlphaImage",rh),yt("RGBAImage",Is);class $w extends ps{createBucket(t){return new x_(t)}constructor(t){super(t,Uw),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=I_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let T_;var Vw={get paint(){return T_=T_||new Ri({"hillshade-illumination-direction":new Et(Ce.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Et(Ce.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Et(Ce.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Et(Ce.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Et(Ce.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Et(Ce.paint_hillshade["hillshade-accent-color"])})}};class jw extends ps{constructor(t){super(t,Vw)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const qw=xi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Gw}=qw;var Am={exports:{}};function Jd(s,t,a){a=a||2;var u,d,g,_,x,I,A,M=t&&t.length,L=M?t[0]*a:s.length,F=k_(s,0,L,a,!0),U=[];if(!F||F.next===F.prev)return U;if(M&&(F=function(Z,ee,ne,ye){var ce,ve,Ie,Fe=[];for(ce=0,ve=ee.length;ce<ve;ce++)(Ie=k_(Z,ee[ce]*ye,ce<ve-1?ee[ce+1]*ye:Z.length,ye,!1))===Ie.next&&(Ie.steiner=!0),Fe.push(Qw(Ie));for(Fe.sort(Kw),ce=0;ce<Fe.length;ce++)ne=Xw(Fe[ce],ne);return ne}(s,t,F,a)),s.length>80*a){u=g=s[0],d=_=s[1];for(var V=a;V<L;V+=a)(x=s[V])<u&&(u=x),(I=s[V+1])<d&&(d=I),x>g&&(g=x),I>_&&(_=I);A=(A=Math.max(g-u,_-d))!==0?32767/A:0}return ih(F,U,a,u,d,A,0),U}function k_(s,t,a,u,d){var g,_;if(d===Mm(s,t,a,u)>0)for(g=t;g<a;g+=u)_=C_(g,s[g],s[g+1],_);else for(g=a-u;g>=t;g-=u)_=C_(g,s[g],s[g+1],_);return _&&Qd(_,_.next)&&(sh(_),_=_.next),_}function xl(s,t){if(!s)return s;t||(t=s);var a,u=s;do if(a=!1,u.steiner||!Qd(u,u.next)&&Oi(u.prev,u,u.next)!==0)u=u.next;else{if(sh(u),(u=t=u.prev)===u.next)break;a=!0}while(a||u!==t);return t}function ih(s,t,a,u,d,g,_){if(s){!_&&g&&function(M,L,F,U){var V=M;do V.z===0&&(V.z=Em(V.x,V.y,L,F,U)),V.prevZ=V.prev,V.nextZ=V.next,V=V.next;while(V!==M);V.prevZ.nextZ=null,V.prevZ=null,function(Z){var ee,ne,ye,ce,ve,Ie,Fe,pt,Tt=1;do{for(ne=Z,Z=null,ve=null,Ie=0;ne;){for(Ie++,ye=ne,Fe=0,ee=0;ee<Tt&&(Fe++,ye=ye.nextZ);ee++);for(pt=Tt;Fe>0||pt>0&&ye;)Fe!==0&&(pt===0||!ye||ne.z<=ye.z)?(ce=ne,ne=ne.nextZ,Fe--):(ce=ye,ye=ye.nextZ,pt--),ve?ve.nextZ=ce:Z=ce,ce.prevZ=ve,ve=ce;ne=ye}ve.nextZ=null,Tt*=2}while(Ie>1)}(V)}(s,u,d,g);for(var x,I,A=s;s.prev!==s.next;)if(x=s.prev,I=s.next,g?Ww(s,u,d,g):Zw(s))t.push(x.i/a|0),t.push(s.i/a|0),t.push(I.i/a|0),sh(s),s=I.next,A=I.next;else if((s=I)===A){_?_===1?ih(s=Hw(xl(s),t,a),t,a,u,d,g,2):_===2&&Yw(s,t,a,u,d,g):ih(xl(s),t,a,u,d,g,1);break}}}function Zw(s){var t=s.prev,a=s,u=s.next;if(Oi(t,a,u)>=0)return!1;for(var d=t.x,g=a.x,_=u.x,x=t.y,I=a.y,A=u.y,M=d<g?d<_?d:_:g<_?g:_,L=x<I?x<A?x:A:I<A?I:A,F=d>g?d>_?d:_:g>_?g:_,U=x>I?x>A?x:A:I>A?I:A,V=u.next;V!==t;){if(V.x>=M&&V.x<=F&&V.y>=L&&V.y<=U&&_c(d,x,g,I,_,A,V.x,V.y)&&Oi(V.prev,V,V.next)>=0)return!1;V=V.next}return!0}function Ww(s,t,a,u){var d=s.prev,g=s,_=s.next;if(Oi(d,g,_)>=0)return!1;for(var x=d.x,I=g.x,A=_.x,M=d.y,L=g.y,F=_.y,U=x<I?x<A?x:A:I<A?I:A,V=M<L?M<F?M:F:L<F?L:F,Z=x>I?x>A?x:A:I>A?I:A,ee=M>L?M>F?M:F:L>F?L:F,ne=Em(U,V,t,a,u),ye=Em(Z,ee,t,a,u),ce=s.prevZ,ve=s.nextZ;ce&&ce.z>=ne&&ve&&ve.z<=ye;){if(ce.x>=U&&ce.x<=Z&&ce.y>=V&&ce.y<=ee&&ce!==d&&ce!==_&&_c(x,M,I,L,A,F,ce.x,ce.y)&&Oi(ce.prev,ce,ce.next)>=0||(ce=ce.prevZ,ve.x>=U&&ve.x<=Z&&ve.y>=V&&ve.y<=ee&&ve!==d&&ve!==_&&_c(x,M,I,L,A,F,ve.x,ve.y)&&Oi(ve.prev,ve,ve.next)>=0))return!1;ve=ve.nextZ}for(;ce&&ce.z>=ne;){if(ce.x>=U&&ce.x<=Z&&ce.y>=V&&ce.y<=ee&&ce!==d&&ce!==_&&_c(x,M,I,L,A,F,ce.x,ce.y)&&Oi(ce.prev,ce,ce.next)>=0)return!1;ce=ce.prevZ}for(;ve&&ve.z<=ye;){if(ve.x>=U&&ve.x<=Z&&ve.y>=V&&ve.y<=ee&&ve!==d&&ve!==_&&_c(x,M,I,L,A,F,ve.x,ve.y)&&Oi(ve.prev,ve,ve.next)>=0)return!1;ve=ve.nextZ}return!0}function Hw(s,t,a){var u=s;do{var d=u.prev,g=u.next.next;!Qd(d,g)&&A_(d,u,u.next,g)&&nh(d,g)&&nh(g,d)&&(t.push(d.i/a|0),t.push(u.i/a|0),t.push(g.i/a|0),sh(u),sh(u.next),u=s=g),u=u.next}while(u!==s);return xl(u)}function Yw(s,t,a,u,d,g){var _=s;do{for(var x=_.next.next;x!==_.prev;){if(_.i!==x.i&&e2(_,x)){var I=E_(_,x);return _=xl(_,_.next),I=xl(I,I.next),ih(_,t,a,u,d,g,0),void ih(I,t,a,u,d,g,0)}x=x.next}_=_.next}while(_!==s)}function Kw(s,t){return s.x-t.x}function Xw(s,t){var a=function(d,g){var _,x=g,I=d.x,A=d.y,M=-1/0;do{if(A<=x.y&&A>=x.next.y&&x.next.y!==x.y){var L=x.x+(A-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(L<=I&&L>M&&(M=L,_=x.x<x.next.x?x:x.next,L===I))return _}x=x.next}while(x!==g);if(!_)return null;var F,U=_,V=_.x,Z=_.y,ee=1/0;x=_;do I>=x.x&&x.x>=V&&I!==x.x&&_c(A<Z?I:M,A,V,Z,A<Z?M:I,A,x.x,x.y)&&(F=Math.abs(A-x.y)/(I-x.x),nh(x,d)&&(F<ee||F===ee&&(x.x>_.x||x.x===_.x&&Jw(_,x)))&&(_=x,ee=F)),x=x.next;while(x!==U);return _}(s,t);if(!a)return t;var u=E_(a,s);return xl(u,u.next),xl(a,a.next)}function Jw(s,t){return Oi(s.prev,s,t.prev)<0&&Oi(t.next,s,s.next)<0}function Em(s,t,a,u,d){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-a)*d|0)|s<<8))|s<<4))|s<<2))|s<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-u)*d|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Qw(s){var t=s,a=s;do(t.x<a.x||t.x===a.x&&t.y<a.y)&&(a=t),t=t.next;while(t!==s);return a}function _c(s,t,a,u,d,g,_,x){return(d-_)*(t-x)>=(s-_)*(g-x)&&(s-_)*(u-x)>=(a-_)*(t-x)&&(a-_)*(g-x)>=(d-_)*(u-x)}function e2(s,t){return s.next.i!==t.i&&s.prev.i!==t.i&&!function(a,u){var d=a;do{if(d.i!==a.i&&d.next.i!==a.i&&d.i!==u.i&&d.next.i!==u.i&&A_(d,d.next,a,u))return!0;d=d.next}while(d!==a);return!1}(s,t)&&(nh(s,t)&&nh(t,s)&&function(a,u){var d=a,g=!1,_=(a.x+u.x)/2,x=(a.y+u.y)/2;do d.y>x!=d.next.y>x&&d.next.y!==d.y&&_<(d.next.x-d.x)*(x-d.y)/(d.next.y-d.y)+d.x&&(g=!g),d=d.next;while(d!==a);return g}(s,t)&&(Oi(s.prev,s,t.prev)||Oi(s,t.prev,t))||Qd(s,t)&&Oi(s.prev,s,s.next)>0&&Oi(t.prev,t,t.next)>0)}function Oi(s,t,a){return(t.y-s.y)*(a.x-t.x)-(t.x-s.x)*(a.y-t.y)}function Qd(s,t){return s.x===t.x&&s.y===t.y}function A_(s,t,a,u){var d=tf(Oi(s,t,a)),g=tf(Oi(s,t,u)),_=tf(Oi(a,u,s)),x=tf(Oi(a,u,t));return d!==g&&_!==x||!(d!==0||!ef(s,a,t))||!(g!==0||!ef(s,u,t))||!(_!==0||!ef(a,s,u))||!(x!==0||!ef(a,t,u))}function ef(s,t,a){return t.x<=Math.max(s.x,a.x)&&t.x>=Math.min(s.x,a.x)&&t.y<=Math.max(s.y,a.y)&&t.y>=Math.min(s.y,a.y)}function tf(s){return s>0?1:s<0?-1:0}function nh(s,t){return Oi(s.prev,s,s.next)<0?Oi(s,t,s.next)>=0&&Oi(s,s.prev,t)>=0:Oi(s,t,s.prev)<0||Oi(s,s.next,t)<0}function E_(s,t){var a=new Cm(s.i,s.x,s.y),u=new Cm(t.i,t.x,t.y),d=s.next,g=t.prev;return s.next=t,t.prev=s,a.next=d,d.prev=a,u.next=a,a.prev=u,g.next=u,u.prev=g,u}function C_(s,t,a,u){var d=new Cm(s,t,a);return u?(d.next=u.next,d.prev=u,u.next.prev=d,u.next=d):(d.prev=d,d.next=d),d}function sh(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Cm(s,t,a){this.i=s,this.x=t,this.y=a,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Mm(s,t,a,u){for(var d=0,g=t,_=a-u;g<a;g+=u)d+=(s[_]-s[g])*(s[g+1]+s[_+1]),_=g;return d}Am.exports=Jd,Am.exports.default=Jd,Jd.deviation=function(s,t,a,u){var d=t&&t.length,g=Math.abs(Mm(s,0,d?t[0]*a:s.length,a));if(d)for(var _=0,x=t.length;_<x;_++)g-=Math.abs(Mm(s,t[_]*a,_<x-1?t[_+1]*a:s.length,a));var I=0;for(_=0;_<u.length;_+=3){var A=u[_]*a,M=u[_+1]*a,L=u[_+2]*a;I+=Math.abs((s[A]-s[L])*(s[M+1]-s[A+1])-(s[A]-s[M])*(s[L+1]-s[A+1]))}return g===0&&I===0?0:Math.abs((I-g)/g)},Jd.flatten=function(s){for(var t=s[0][0].length,a={vertices:[],holes:[],dimensions:t},u=0,d=0;d<s.length;d++){for(var g=0;g<s[d].length;g++)for(var _=0;_<t;_++)a.vertices.push(s[d][g][_]);d>0&&a.holes.push(u+=s[d-1].length)}return a};var M_=T(Am.exports);function t2(s,t,a,u,d){D_(s,t,a,u||s.length-1,d||r2)}function D_(s,t,a,u,d){for(;u>a;){if(u-a>600){var g=u-a+1,_=t-a+1,x=Math.log(g),I=.5*Math.exp(2*x/3),A=.5*Math.sqrt(x*I*(g-I)/g)*(_-g/2<0?-1:1);D_(s,t,Math.max(a,Math.floor(t-_*I/g+A)),Math.min(u,Math.floor(t+(g-_)*I/g+A)),d)}var M=s[t],L=a,F=u;for(ah(s,a,t),d(s[u],M)>0&&ah(s,a,u);L<F;){for(ah(s,L,F),L++,F--;d(s[L],M)<0;)L++;for(;d(s[F],M)>0;)F--}d(s[a],M)===0?ah(s,a,F):ah(s,++F,u),F<=t&&(a=F+1),t<=F&&(u=F-1)}}function ah(s,t,a){var u=s[t];s[t]=s[a],s[a]=u}function r2(s,t){return s<t?-1:s>t?1:0}function Dm(s,t){const a=s.length;if(a<=1)return[s];const u=[];let d,g;for(let _=0;_<a;_++){const x=Je(s[_]);x!==0&&(s[_].area=Math.abs(x),g===void 0&&(g=x<0),g===x<0?(d&&u.push(d),d=[s[_]]):d.push(s[_]))}if(d&&u.push(d),t>1)for(let _=0;_<u.length;_++)u[_].length<=t||(t2(u[_],t,1,u[_].length-1,i2),u[_]=u[_].slice(0,t));return u}function i2(s,t){return t.area-s.area}function Pm(s,t,a){const u=a.patternDependencies;let d=!1;for(const g of t){const _=g.paint.get(`${s}-pattern`);_.isConstant()||(d=!0);const x=_.constantOr(null);x&&(d=!0,u[x.to]=!0,u[x.from]=!0)}return d}function Lm(s,t,a,u,d){const g=d.patternDependencies;for(const _ of t){const x=_.paint.get(`${s}-pattern`).value;if(x.kind!=="constant"){let I=x.evaluate({zoom:u-1},a,{},d.availableImages),A=x.evaluate({zoom:u},a,{},d.availableImages),M=x.evaluate({zoom:u+1},a,{},d.availableImages);I=I&&I.name?I.name:I,A=A&&A.name?A.name:A,M=M&&M.name?M.name:M,g[I]=!0,g[A]=!0,g[M]=!0,a.patterns[_.id]={min:I,mid:A,max:M}}}return a}class zm{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(a=>a.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new _r,this.indexArray=new dn,this.indexArray2=new Xi,this.programConfigurations=new na(t.layers,t.zoom),this.segments=new ci,this.segments2=new ci,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(t,a,u){this.hasPattern=Pm("fill",this.layers,a);const d=this.layers[0].layout.get("fill-sort-key"),g=!d.isConstant(),_=[];for(const{feature:x,id:I,index:A,sourceLayerIndex:M}of t){const L=this.layers[0]._featureFilter.needGeometry,F=bl(x,L);if(!this.layers[0]._featureFilter.filter(new li(this.zoom),F,u))continue;const U=g?d.evaluate(F,{},u,a.availableImages):void 0,V={id:I,properties:x.properties,type:x.type,sourceLayerIndex:M,index:A,geometry:L?F.geometry:vl(x),patterns:{},sortKey:U};_.push(V)}g&&_.sort((x,I)=>x.sortKey-I.sortKey);for(const x of _){const{geometry:I,index:A,sourceLayerIndex:M}=x;if(this.hasPattern){const L=Lm("fill",this.layers,x,this.zoom,a);this.patternFeatures.push(L)}else this.addFeature(x,I,A,u,{});a.featureIndex.insert(t[A].feature,I,A,M,this.index)}}update(t,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,u)}addFeatures(t,a,u){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,a,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Gw),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,a,u,d,g){for(const _ of Dm(a,500)){let x=0;for(const U of _)x+=U.length;const I=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray),A=I.vertexLength,M=[],L=[];for(const U of _){if(U.length===0)continue;U!==_[0]&&L.push(M.length/2);const V=this.segments2.prepareSegment(U.length,this.layoutVertexArray,this.indexArray2),Z=V.vertexLength;this.layoutVertexArray.emplaceBack(U[0].x,U[0].y),this.indexArray2.emplaceBack(Z+U.length-1,Z),M.push(U[0].x),M.push(U[0].y);for(let ee=1;ee<U.length;ee++)this.layoutVertexArray.emplaceBack(U[ee].x,U[ee].y),this.indexArray2.emplaceBack(Z+ee-1,Z+ee),M.push(U[ee].x),M.push(U[ee].y);V.vertexLength+=U.length,V.primitiveLength+=U.length}const F=M_(M,L);for(let U=0;U<F.length;U+=3)this.indexArray.emplaceBack(A+F[U],A+F[U+1],A+F[U+2]);I.vertexLength+=x,I.primitiveLength+=F.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,g,d)}}let P_,L_;yt("FillBucket",zm,{omit:["layers","patternFeatures"]});var n2={get paint(){return L_=L_||new Ri({"fill-antialias":new Et(Ce.paint_fill["fill-antialias"]),"fill-opacity":new Rt(Ce.paint_fill["fill-opacity"]),"fill-color":new Rt(Ce.paint_fill["fill-color"]),"fill-outline-color":new Rt(Ce.paint_fill["fill-outline-color"]),"fill-translate":new Et(Ce.paint_fill["fill-translate"]),"fill-translate-anchor":new Et(Ce.paint_fill["fill-translate-anchor"]),"fill-pattern":new gl(Ce.paint_fill["fill-pattern"])})},get layout(){return P_=P_||new Ri({"fill-sort-key":new Rt(Ce.layout_fill["fill-sort-key"])})}};class s2 extends ps{constructor(t){super(t,n2)}recalculate(t,a){super.recalculate(t,a);const u=this.paint._values["fill-outline-color"];u.value.kind==="constant"&&u.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new zm(t)}queryRadius(){return Yd(this.paint.get("fill-translate"))}queryIntersectsFeature(t,a,u,d,g,_,x){return p_(Kd(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),_.angle,x),d)}isTileClipped(){return!0}}const a2=xi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),o2=xi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:l2}=a2;var zo={},c2=z,z_=vc;function vc(s,t,a,u,d){this.properties={},this.extent=a,this.type=0,this._pbf=s,this._geometry=-1,this._keys=u,this._values=d,s.readFields(u2,this,t)}function u2(s,t,a){s==1?t.id=a.readVarint():s==2?function(u,d){for(var g=u.readVarint()+u.pos;u.pos<g;){var _=d._keys[u.readVarint()],x=d._values[u.readVarint()];d.properties[_]=x}}(a,t):s==3?t.type=a.readVarint():s==4&&(t._geometry=a.pos)}function h2(s){for(var t,a,u=0,d=0,g=s.length,_=g-1;d<g;_=d++)u+=((a=s[_]).x-(t=s[d]).x)*(t.y+a.y);return u}vc.types=["Unknown","Point","LineString","Polygon"],vc.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var t,a=s.readVarint()+s.pos,u=1,d=0,g=0,_=0,x=[];s.pos<a;){if(d<=0){var I=s.readVarint();u=7&I,d=I>>3}if(d--,u===1||u===2)g+=s.readSVarint(),_+=s.readSVarint(),u===1&&(t&&x.push(t),t=[]),t.push(new c2(g,_));else{if(u!==7)throw new Error("unknown command "+u);t&&t.push(t[0].clone())}}return t&&x.push(t),x},vc.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var t=s.readVarint()+s.pos,a=1,u=0,d=0,g=0,_=1/0,x=-1/0,I=1/0,A=-1/0;s.pos<t;){if(u<=0){var M=s.readVarint();a=7&M,u=M>>3}if(u--,a===1||a===2)(d+=s.readSVarint())<_&&(_=d),d>x&&(x=d),(g+=s.readSVarint())<I&&(I=g),g>A&&(A=g);else if(a!==7)throw new Error("unknown command "+a)}return[_,I,x,A]},vc.prototype.toGeoJSON=function(s,t,a){var u,d,g=this.extent*Math.pow(2,a),_=this.extent*s,x=this.extent*t,I=this.loadGeometry(),A=vc.types[this.type];function M(U){for(var V=0;V<U.length;V++){var Z=U[V];U[V]=[360*(Z.x+_)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(Z.y+x)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var L=[];for(u=0;u<I.length;u++)L[u]=I[u][0];M(I=L);break;case 2:for(u=0;u<I.length;u++)M(I[u]);break;case 3:for(I=function(U){var V=U.length;if(V<=1)return[U];for(var Z,ee,ne=[],ye=0;ye<V;ye++){var ce=h2(U[ye]);ce!==0&&(ee===void 0&&(ee=ce<0),ee===ce<0?(Z&&ne.push(Z),Z=[U[ye]]):Z.push(U[ye]))}return Z&&ne.push(Z),ne}(I),u=0;u<I.length;u++)for(d=0;d<I[u].length;d++)M(I[u][d])}I.length===1?I=I[0]:A="Multi"+A;var F={type:"Feature",geometry:{type:A,coordinates:I},properties:this.properties};return"id"in this&&(F.id=this.id),F};var d2=z_,B_=R_;function R_(s,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(f2,this,t),this.length=this._features.length}function f2(s,t,a){s===15?t.version=a.readVarint():s===1?t.name=a.readString():s===5?t.extent=a.readVarint():s===2?t._features.push(a.pos):s===3?t._keys.push(a.readString()):s===4&&t._values.push(function(u){for(var d=null,g=u.readVarint()+u.pos;u.pos<g;){var _=u.readVarint()>>3;d=_===1?u.readString():_===2?u.readFloat():_===3?u.readDouble():_===4?u.readVarint64():_===5?u.readVarint():_===6?u.readSVarint():_===7?u.readBoolean():null}return d}(a))}R_.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var t=this._pbf.readVarint()+this._pbf.pos;return new d2(this._pbf,t,this.extent,this._keys,this._values)};var p2=B_;function m2(s,t,a){if(s===3){var u=new p2(a,a.readVarint()+a.pos);u.length&&(t[u.name]=u)}}zo.VectorTile=function(s,t){this.layers=s.readFields(m2,{},t)},zo.VectorTileFeature=z_,zo.VectorTileLayer=B_;const g2=zo.VectorTileFeature.types,Bm=Math.pow(2,13);function oh(s,t,a,u,d,g,_,x){s.emplaceBack(t,a,2*Math.floor(u*Bm)+_,d*Bm*2,g*Bm*2,Math.round(x))}class Rm{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(a=>a.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new st,this.centroidVertexArray=new tt,this.indexArray=new dn,this.programConfigurations=new na(t.layers,t.zoom),this.segments=new ci,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(t,a,u){this.features=[],this.hasPattern=Pm("fill-extrusion",this.layers,a);for(const{feature:d,id:g,index:_,sourceLayerIndex:x}of t){const I=this.layers[0]._featureFilter.needGeometry,A=bl(d,I);if(!this.layers[0]._featureFilter.filter(new li(this.zoom),A,u))continue;const M={id:g,sourceLayerIndex:x,index:_,geometry:I?A.geometry:vl(d),properties:d.properties,type:d.type,patterns:{}};this.hasPattern?this.features.push(Lm("fill-extrusion",this.layers,M,this.zoom,a)):this.addFeature(M,M.geometry,_,u,{}),a.featureIndex.insert(d,M.geometry,_,x,this.index,!0)}}addFeatures(t,a,u){for(const d of this.features){const{geometry:g}=d;this.addFeature(d,g,d.index,a,u)}}update(t,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,u)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,l2),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,o2.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,a,u,d,g){const _={x:0,y:0,vertexCount:0};for(const x of Dm(a,500)){let I=0;for(const V of x)I+=V.length;let A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const V of x){if(V.length===0||_2(V))continue;let Z=0;for(let ee=0;ee<V.length;ee++){const ne=V[ee];if(ee>=1){const ye=V[ee-1];if(!y2(ne,ye)){A.vertexLength+4>ci.MAX_VERTEX_ARRAY_LENGTH&&(A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ce=ne.sub(ye)._perp()._unit(),ve=ye.dist(ne);Z+ve>32768&&(Z=0),oh(this.layoutVertexArray,ne.x,ne.y,ce.x,ce.y,0,0,Z),oh(this.layoutVertexArray,ne.x,ne.y,ce.x,ce.y,0,1,Z),_.x+=2*ne.x,_.y+=2*ne.y,_.vertexCount+=2,Z+=ve,oh(this.layoutVertexArray,ye.x,ye.y,ce.x,ce.y,0,0,Z),oh(this.layoutVertexArray,ye.x,ye.y,ce.x,ce.y,0,1,Z),_.x+=2*ye.x,_.y+=2*ye.y,_.vertexCount+=2;const Ie=A.vertexLength;this.indexArray.emplaceBack(Ie,Ie+2,Ie+1),this.indexArray.emplaceBack(Ie+1,Ie+2,Ie+3),A.vertexLength+=4,A.primitiveLength+=2}}}}if(A.vertexLength+I>ci.MAX_VERTEX_ARRAY_LENGTH&&(A=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray)),g2[t.type]!=="Polygon")continue;const M=[],L=[],F=A.vertexLength;for(const V of x)if(V.length!==0){V!==x[0]&&L.push(M.length/2);for(let Z=0;Z<V.length;Z++){const ee=V[Z];oh(this.layoutVertexArray,ee.x,ee.y,0,0,1,1,0),_.x+=ee.x,_.y+=ee.y,_.vertexCount+=1,M.push(ee.x),M.push(ee.y)}}const U=M_(M,L);for(let V=0;V<U.length;V+=3)this.indexArray.emplaceBack(F+U[V],F+U[V+2],F+U[V+1]);A.primitiveLength+=U.length/3,A.vertexLength+=I}for(let x=0;x<_.vertexCount;x++)this.centroidVertexArray.emplaceBack(Math.floor(_.x/_.vertexCount),Math.floor(_.y/_.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,g,d)}}function y2(s,t){return s.x===t.x&&(s.x<0||s.x>Hi)||s.y===t.y&&(s.y<0||s.y>Hi)}function _2(s){return s.every(t=>t.x<0)||s.every(t=>t.x>Hi)||s.every(t=>t.y<0)||s.every(t=>t.y>Hi)}let F_;yt("FillExtrusionBucket",Rm,{omit:["layers","features"]});var v2={get paint(){return F_=F_||new Ri({"fill-extrusion-opacity":new Et(Ce["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Rt(Ce["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Et(Ce["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Et(Ce["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new gl(Ce["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Rt(Ce["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Rt(Ce["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Et(Ce["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class b2 extends ps{constructor(t){super(t,v2)}createBucket(t){return new Rm(t)}queryRadius(){return Yd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,a,u,d,g,_,x,I){const A=Kd(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),_.angle,x),M=this.paint.get("fill-extrusion-height").evaluate(a,u),L=this.paint.get("fill-extrusion-base").evaluate(a,u),F=function(V,Z,ee,ne){const ye=[];for(const ce of V){const ve=[ce.x,ce.y,0,1];Xd(ve,ve,Z),ye.push(new $(ve[0]/ve[3],ve[1]/ve[3]))}return ye}(A,I),U=function(V,Z,ee,ne){const ye=[],ce=[],ve=ne[8]*Z,Ie=ne[9]*Z,Fe=ne[10]*Z,pt=ne[11]*Z,Tt=ne[8]*ee,lt=ne[9]*ee,at=ne[10]*ee,it=ne[11]*ee;for(const vt of V){const nt=[],Ye=[];for(const Dt of vt){const At=Dt.x,fr=Dt.y,ui=ne[0]*At+ne[4]*fr+ne[12],pi=ne[1]*At+ne[5]*fr+ne[13],en=ne[2]*At+ne[6]*fr+ne[14],gs=ne[3]*At+ne[7]*fr+ne[15],Nn=en+Fe,Yi=gs+pt,pn=ui+Tt,In=pi+lt,Un=en+at,$n=gs+it,tn=new $((ui+ve)/Yi,(pi+Ie)/Yi);tn.z=Nn/Yi,nt.push(tn);const rn=new $(pn/$n,In/$n);rn.z=Un/$n,Ye.push(rn)}ye.push(nt),ce.push(Ye)}return[ye,ce]}(d,L,M,I);return function(V,Z,ee){let ne=1/0;p_(ee,Z)&&(ne=O_(ee,Z[0]));for(let ye=0;ye<Z.length;ye++){const ce=Z[ye],ve=V[ye];for(let Ie=0;Ie<ce.length-1;Ie++){const Fe=ce[Ie],pt=[Fe,ce[Ie+1],ve[Ie+1],ve[Ie],Fe];f_(ee,pt)&&(ne=Math.min(ne,O_(ee,pt)))}}return ne!==1/0&&ne}(U[0],U[1],F)}}function lh(s,t){return s.x*t.x+s.y*t.y}function O_(s,t){if(s.length===1){let a=0;const u=t[a++];let d;for(;!d||u.equals(d);)if(d=t[a++],!d)return 1/0;for(;a<t.length;a++){const g=t[a],_=s[0],x=d.sub(u),I=g.sub(u),A=_.sub(u),M=lh(x,x),L=lh(x,I),F=lh(I,I),U=lh(A,x),V=lh(A,I),Z=M*F-L*L,ee=(F*U-L*V)/Z,ne=(M*V-L*U)/Z,ye=u.z*(1-ee-ne)+d.z*ee+g.z*ne;if(isFinite(ye))return ye}return 1/0}{let a=1/0;for(const u of t)a=Math.min(a,u.z);return a}}const x2=xi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:w2}=x2,S2=xi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:I2}=S2,T2=zo.VectorTileFeature.types,k2=Math.cos(Math.PI/180*37.5),N_=Math.pow(2,14)/.5;class Fm{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(a=>a.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new Ft,this.layoutVertexArray2=new kt,this.indexArray=new dn,this.programConfigurations=new na(t.layers,t.zoom),this.segments=new ci,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(t,a,u){this.hasPattern=Pm("line",this.layers,a);const d=this.layers[0].layout.get("line-sort-key"),g=!d.isConstant(),_=[];for(const{feature:x,id:I,index:A,sourceLayerIndex:M}of t){const L=this.layers[0]._featureFilter.needGeometry,F=bl(x,L);if(!this.layers[0]._featureFilter.filter(new li(this.zoom),F,u))continue;const U=g?d.evaluate(F,{},u):void 0,V={id:I,properties:x.properties,type:x.type,sourceLayerIndex:M,index:A,geometry:L?F.geometry:vl(x),patterns:{},sortKey:U};_.push(V)}g&&_.sort((x,I)=>x.sortKey-I.sortKey);for(const x of _){const{geometry:I,index:A,sourceLayerIndex:M}=x;if(this.hasPattern){const L=Lm("line",this.layers,x,this.zoom,a);this.patternFeatures.push(L)}else this.addFeature(x,I,A,u,{});a.featureIndex.insert(t[A].feature,I,A,M,this.index)}}update(t,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,u)}addFeatures(t,a,u){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,a,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,I2)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,w2),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,a,u,d,g){const _=this.layers[0].layout,x=_.get("line-join").evaluate(t,{}),I=_.get("line-cap"),A=_.get("line-miter-limit"),M=_.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const L of a)this.addLine(L,t,x,I,A,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,g,d)}addLine(t,a,u,d,g,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ne=0;ne<t.length-1;ne++)this.totalDistance+=t[ne].dist(t[ne+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x=T2[a.type]==="Polygon";let I=t.length;for(;I>=2&&t[I-1].equals(t[I-2]);)I--;let A=0;for(;A<I-1&&t[A].equals(t[A+1]);)A++;if(I<(x?3:2))return;u==="bevel"&&(g=1.05);const M=this.overscaling<=16?15*Hi/(512*this.overscaling):0,L=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray);let F,U,V,Z,ee;this.e1=this.e2=-1,x&&(F=t[I-2],ee=t[A].sub(F)._unit()._perp());for(let ne=A;ne<I;ne++){if(V=ne===I-1?x?t[A+1]:void 0:t[ne+1],V&&t[ne].equals(V))continue;ee&&(Z=ee),F&&(U=F),F=t[ne],ee=V?V.sub(F)._unit()._perp():Z,Z=Z||ee;let ye=Z.add(ee);ye.x===0&&ye.y===0||ye._unit();const ce=Z.x*ee.x+Z.y*ee.y,ve=ye.x*ee.x+ye.y*ee.y,Ie=ve!==0?1/ve:1/0,Fe=2*Math.sqrt(2-2*ve),pt=ve<k2&&U&&V,Tt=Z.x*ee.y-Z.y*ee.x>0;if(pt&&ne>A){const it=F.dist(U);if(it>2*M){const vt=F.sub(F.sub(U)._mult(M/it)._round());this.updateDistance(U,vt),this.addCurrentVertex(vt,Z,0,0,L),U=vt}}const lt=U&&V;let at=lt?u:x?"butt":d;if(lt&&at==="round"&&(Ie<_?at="miter":Ie<=2&&(at="fakeround")),at==="miter"&&Ie>g&&(at="bevel"),at==="bevel"&&(Ie>2&&(at="flipbevel"),Ie<g&&(at="miter")),U&&this.updateDistance(U,F),at==="miter")ye._mult(Ie),this.addCurrentVertex(F,ye,0,0,L);else if(at==="flipbevel"){if(Ie>100)ye=ee.mult(-1);else{const it=Ie*Z.add(ee).mag()/Z.sub(ee).mag();ye._perp()._mult(it*(Tt?-1:1))}this.addCurrentVertex(F,ye,0,0,L),this.addCurrentVertex(F,ye.mult(-1),0,0,L)}else if(at==="bevel"||at==="fakeround"){const it=-Math.sqrt(Ie*Ie-1),vt=Tt?it:0,nt=Tt?0:it;if(U&&this.addCurrentVertex(F,Z,vt,nt,L),at==="fakeround"){const Ye=Math.round(180*Fe/Math.PI/20);for(let Dt=1;Dt<Ye;Dt++){let At=Dt/Ye;if(At!==.5){const ui=At-.5;At+=At*ui*(At-1)*((1.0904+ce*(ce*(3.55645-1.43519*ce)-3.2452))*ui*ui+(.848013+ce*(.215638*ce-1.06021)))}const fr=ee.sub(Z)._mult(At)._add(Z)._unit()._mult(Tt?-1:1);this.addHalfVertex(F,fr.x,fr.y,!1,Tt,0,L)}}V&&this.addCurrentVertex(F,ee,-vt,-nt,L)}else if(at==="butt")this.addCurrentVertex(F,ye,0,0,L);else if(at==="square"){const it=U?1:-1;this.addCurrentVertex(F,ye,it,it,L)}else at==="round"&&(U&&(this.addCurrentVertex(F,Z,0,0,L),this.addCurrentVertex(F,Z,1,1,L,!0)),V&&(this.addCurrentVertex(F,ee,-1,-1,L,!0),this.addCurrentVertex(F,ee,0,0,L)));if(pt&&ne<I-1){const it=F.dist(V);if(it>2*M){const vt=F.add(V.sub(F)._mult(M/it)._round());this.updateDistance(F,vt),this.addCurrentVertex(vt,ee,0,0,L),F=vt}}}}addCurrentVertex(t,a,u,d,g,_=!1){const x=a.y*d-a.x,I=-a.y-a.x*d;this.addHalfVertex(t,a.x+a.y*u,a.y-a.x*u,_,!1,u,g),this.addHalfVertex(t,x,I,_,!0,-d,g),this.distance>N_/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,a,u,d,g,_))}addHalfVertex({x:t,y:a},u,d,g,_,x,I){const A=.5*(this.lineClips?this.scaledDistance*(N_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(g?1:0),(a<<1)+(_?1:0),Math.round(63*u)+128,Math.round(63*d)+128,1+(x===0?0:x<0?-1:1)|(63&A)<<2,A>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const M=I.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),I.primitiveLength++),_?this.e2=M:this.e1=M}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,a){this.distance+=t.dist(a),this.updateScaledDistance()}}let U_,$_;yt("LineBucket",Fm,{omit:["layers","patternFeatures"]});var V_={get paint(){return $_=$_||new Ri({"line-opacity":new Rt(Ce.paint_line["line-opacity"]),"line-color":new Rt(Ce.paint_line["line-color"]),"line-translate":new Et(Ce.paint_line["line-translate"]),"line-translate-anchor":new Et(Ce.paint_line["line-translate-anchor"]),"line-width":new Rt(Ce.paint_line["line-width"]),"line-gap-width":new Rt(Ce.paint_line["line-gap-width"]),"line-offset":new Rt(Ce.paint_line["line-offset"]),"line-blur":new Rt(Ce.paint_line["line-blur"]),"line-dasharray":new Gu(Ce.paint_line["line-dasharray"]),"line-pattern":new gl(Ce.paint_line["line-pattern"]),"line-gradient":new Zu(Ce.paint_line["line-gradient"])})},get layout(){return U_=U_||new Ri({"line-cap":new Et(Ce.layout_line["line-cap"]),"line-join":new Rt(Ce.layout_line["line-join"]),"line-miter-limit":new Et(Ce.layout_line["line-miter-limit"]),"line-round-limit":new Et(Ce.layout_line["line-round-limit"]),"line-sort-key":new Rt(Ce.layout_line["line-sort-key"])})}};class A2 extends Rt{possiblyEvaluate(t,a){return a=new li(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,zoomHistory:a.zoomHistory,transition:a.transition}),super.possiblyEvaluate(t,a)}evaluate(t,a,u,d){return a=Ee({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(t,a,u,d)}}let rf;class E2 extends ps{constructor(t){super(t,V_),this.gradientVersion=0,rf||(rf=new A2(V_.paint.properties["line-width"].specification),rf.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const a=this.gradientExpression();this.stepInterpolant=!!function(u){return u._styleExpression!==void 0}(a)&&a._styleExpression.expression instanceof ba,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,a){super.recalculate(t,a),this.paint._values["line-floorwidth"]=rf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Fm(t)}queryRadius(t){const a=t,u=j_(eh("line-width",this,a),eh("line-gap-width",this,a)),d=eh("line-offset",this,a);return u/2+Math.abs(d)+Yd(this.paint.get("line-translate"))}queryIntersectsFeature(t,a,u,d,g,_,x){const I=Kd(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),_.angle,x),A=x/2*j_(this.paint.get("line-width").evaluate(a,u),this.paint.get("line-gap-width").evaluate(a,u)),M=this.paint.get("line-offset").evaluate(a,u);return M&&(d=function(L,F){const U=[];for(let V=0;V<L.length;V++){const Z=L[V],ee=[];for(let ne=0;ne<Z.length;ne++){const ye=Z[ne-1],ce=Z[ne],ve=Z[ne+1],Ie=ne===0?new $(0,0):ce.sub(ye)._unit()._perp(),Fe=ne===Z.length-1?new $(0,0):ve.sub(ce)._unit()._perp(),pt=Ie._add(Fe)._unit(),Tt=pt.x*Fe.x+pt.y*Fe.y;Tt!==0&&pt._mult(1/Tt),ee.push(pt._mult(F)._add(ce))}U.push(ee)}return U}(d,M*x)),function(L,F,U){for(let V=0;V<F.length;V++){const Z=F[V];if(L.length>=3){for(let ee=0;ee<Z.length;ee++)if(gc(L,Z[ee]))return!0}if(zw(L,Z,U))return!0}return!1}(I,d,A)}isTileClipped(){return!0}}function j_(s,t){return t>0?t+2*s:s}const C2=xi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),M2=xi([{name:"a_projected_pos",components:3,type:"Float32"}],4);xi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const D2=xi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);xi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const q_=xi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),P2=xi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function L2(s,t,a){return s.sections.forEach(u=>{u.text=function(d,g,_){const x=g.layout.get("text-transform").evaluate(_,{});return x==="uppercase"?d=d.toLocaleUpperCase():x==="lowercase"&&(d=d.toLocaleLowerCase()),Kn.applyArabicShaping&&(d=Kn.applyArabicShaping(d)),d}(u.text,t,a)}),s}xi([{name:"triangle",components:3,type:"Uint16"}]),xi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),xi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),xi([{type:"Float32",name:"offsetX"}]),xi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),xi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const ch={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Qi=24,G_=Hr,Z_=function(s,t,a,u,d){var g,_,x=8*d-u-1,I=(1<<x)-1,A=I>>1,M=-7,L=d-1,F=-1,U=s[t+L];for(L+=F,g=U&(1<<-M)-1,U>>=-M,M+=x;M>0;g=256*g+s[t+L],L+=F,M-=8);for(_=g&(1<<-M)-1,g>>=-M,M+=u;M>0;_=256*_+s[t+L],L+=F,M-=8);if(g===0)g=1-A;else{if(g===I)return _?NaN:1/0*(U?-1:1);_+=Math.pow(2,u),g-=A}return(U?-1:1)*_*Math.pow(2,g-u)},W_=function(s,t,a,u,d,g){var _,x,I,A=8*g-d-1,M=(1<<A)-1,L=M>>1,F=d===23?Math.pow(2,-24)-Math.pow(2,-77):0,U=0,V=1,Z=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(x=isNaN(t)?1:0,_=M):(_=Math.floor(Math.log(t)/Math.LN2),t*(I=Math.pow(2,-_))<1&&(_--,I*=2),(t+=_+L>=1?F/I:F*Math.pow(2,1-L))*I>=2&&(_++,I/=2),_+L>=M?(x=0,_=M):_+L>=1?(x=(t*I-1)*Math.pow(2,d),_+=L):(x=t*Math.pow(2,L-1)*Math.pow(2,d),_=0));d>=8;s[a+U]=255&x,U+=V,x/=256,d-=8);for(_=_<<d|x,A+=d;A>0;s[a+U]=255&_,U+=V,_/=256,A-=8);s[a+U-V]|=128*Z};function Hr(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}Hr.Varint=0,Hr.Fixed64=1,Hr.Bytes=2,Hr.Fixed32=5;var Om=4294967296,H_=1/Om,Y_=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ro(s){return s.type===Hr.Bytes?s.readVarint()+s.pos:s.pos+1}function bc(s,t,a){return a?4294967296*t+(s>>>0):4294967296*(t>>>0)+(s>>>0)}function K_(s,t,a){var u=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));a.realloc(u);for(var d=a.pos-1;d>=s;d--)a.buf[d+u]=a.buf[d]}function z2(s,t){for(var a=0;a<s.length;a++)t.writeVarint(s[a])}function B2(s,t){for(var a=0;a<s.length;a++)t.writeSVarint(s[a])}function R2(s,t){for(var a=0;a<s.length;a++)t.writeFloat(s[a])}function F2(s,t){for(var a=0;a<s.length;a++)t.writeDouble(s[a])}function O2(s,t){for(var a=0;a<s.length;a++)t.writeBoolean(s[a])}function N2(s,t){for(var a=0;a<s.length;a++)t.writeFixed32(s[a])}function U2(s,t){for(var a=0;a<s.length;a++)t.writeSFixed32(s[a])}function $2(s,t){for(var a=0;a<s.length;a++)t.writeFixed64(s[a])}function V2(s,t){for(var a=0;a<s.length;a++)t.writeSFixed64(s[a])}function nf(s,t){return(s[t]|s[t+1]<<8|s[t+2]<<16)+16777216*s[t+3]}function xc(s,t,a){s[a]=t,s[a+1]=t>>>8,s[a+2]=t>>>16,s[a+3]=t>>>24}function X_(s,t){return(s[t]|s[t+1]<<8|s[t+2]<<16)+(s[t+3]<<24)}Hr.prototype={destroy:function(){this.buf=null},readFields:function(s,t,a){for(a=a||this.length;this.pos<a;){var u=this.readVarint(),d=u>>3,g=this.pos;this.type=7&u,s(d,t,this),this.pos===g&&this.skip(u)}return t},readMessage:function(s,t){return this.readFields(s,t,this.readVarint()+this.pos)},readFixed32:function(){var s=nf(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=X_(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=nf(this.buf,this.pos)+nf(this.buf,this.pos+4)*Om;return this.pos+=8,s},readSFixed64:function(){var s=nf(this.buf,this.pos)+X_(this.buf,this.pos+4)*Om;return this.pos+=8,s},readFloat:function(){var s=Z_(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=Z_(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var t,a,u=this.buf;return t=127&(a=u[this.pos++]),a<128?t:(t|=(127&(a=u[this.pos++]))<<7,a<128?t:(t|=(127&(a=u[this.pos++]))<<14,a<128?t:(t|=(127&(a=u[this.pos++]))<<21,a<128?t:function(d,g,_){var x,I,A=_.buf;if(x=(112&(I=A[_.pos++]))>>4,I<128||(x|=(127&(I=A[_.pos++]))<<3,I<128)||(x|=(127&(I=A[_.pos++]))<<10,I<128)||(x|=(127&(I=A[_.pos++]))<<17,I<128)||(x|=(127&(I=A[_.pos++]))<<24,I<128)||(x|=(1&(I=A[_.pos++]))<<31,I<128))return bc(d,x,g);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(a=u[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,t=this.pos;return this.pos=s,s-t>=12&&Y_?function(a,u,d){return Y_.decode(a.subarray(u,d))}(this.buf,t,s):function(a,u,d){for(var g="",_=u;_<d;){var x,I,A,M=a[_],L=null,F=M>239?4:M>223?3:M>191?2:1;if(_+F>d)break;F===1?M<128&&(L=M):F===2?(192&(x=a[_+1]))==128&&(L=(31&M)<<6|63&x)<=127&&(L=null):F===3?(I=a[_+2],(192&(x=a[_+1]))==128&&(192&I)==128&&((L=(15&M)<<12|(63&x)<<6|63&I)<=2047||L>=55296&&L<=57343)&&(L=null)):F===4&&(I=a[_+2],A=a[_+3],(192&(x=a[_+1]))==128&&(192&I)==128&&(192&A)==128&&((L=(15&M)<<18|(63&x)<<12|(63&I)<<6|63&A)<=65535||L>=1114112)&&(L=null)),L===null?(L=65533,F=1):L>65535&&(L-=65536,g+=String.fromCharCode(L>>>10&1023|55296),L=56320|1023&L),g+=String.fromCharCode(L),_+=F}return g}(this.buf,t,s)},readBytes:function(){var s=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,s);return this.pos=s,t},readPackedVarint:function(s,t){if(this.type!==Hr.Bytes)return s.push(this.readVarint(t));var a=ro(this);for(s=s||[];this.pos<a;)s.push(this.readVarint(t));return s},readPackedSVarint:function(s){if(this.type!==Hr.Bytes)return s.push(this.readSVarint());var t=ro(this);for(s=s||[];this.pos<t;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==Hr.Bytes)return s.push(this.readBoolean());var t=ro(this);for(s=s||[];this.pos<t;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==Hr.Bytes)return s.push(this.readFloat());var t=ro(this);for(s=s||[];this.pos<t;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==Hr.Bytes)return s.push(this.readDouble());var t=ro(this);for(s=s||[];this.pos<t;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==Hr.Bytes)return s.push(this.readFixed32());var t=ro(this);for(s=s||[];this.pos<t;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==Hr.Bytes)return s.push(this.readSFixed32());var t=ro(this);for(s=s||[];this.pos<t;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==Hr.Bytes)return s.push(this.readFixed64());var t=ro(this);for(s=s||[];this.pos<t;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==Hr.Bytes)return s.push(this.readSFixed64());var t=ro(this);for(s=s||[];this.pos<t;)s.push(this.readSFixed64());return s},skip:function(s){var t=7&s;if(t===Hr.Varint)for(;this.buf[this.pos++]>127;);else if(t===Hr.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Hr.Fixed32)this.pos+=4;else{if(t!==Hr.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(s,t){this.writeVarint(s<<3|t)},realloc:function(s){for(var t=this.length||16;t<this.pos+s;)t*=2;if(t!==this.length){var a=new Uint8Array(t);a.set(this.buf),this.buf=a,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),xc(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),xc(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),xc(this.buf,-1&s,this.pos),xc(this.buf,Math.floor(s*H_),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),xc(this.buf,-1&s,this.pos),xc(this.buf,Math.floor(s*H_),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(t,a){var u,d;if(t>=0?(u=t%4294967296|0,d=t/4294967296|0):(d=~(-t/4294967296),4294967295^(u=~(-t%4294967296))?u=u+1|0:(u=0,d=d+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),function(g,_,x){x.buf[x.pos++]=127&g|128,g>>>=7,x.buf[x.pos++]=127&g|128,g>>>=7,x.buf[x.pos++]=127&g|128,g>>>=7,x.buf[x.pos++]=127&g|128,x.buf[x.pos]=127&(g>>>=7)}(u,0,a),function(g,_){var x=(7&g)<<4;_.buf[_.pos++]|=x|((g>>>=3)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g)))))}(d,a)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var t=this.pos;this.pos=function(u,d,g){for(var _,x,I=0;I<d.length;I++){if((_=d.charCodeAt(I))>55295&&_<57344){if(!x){_>56319||I+1===d.length?(u[g++]=239,u[g++]=191,u[g++]=189):x=_;continue}if(_<56320){u[g++]=239,u[g++]=191,u[g++]=189,x=_;continue}_=x-55296<<10|_-56320|65536,x=null}else x&&(u[g++]=239,u[g++]=191,u[g++]=189,x=null);_<128?u[g++]=_:(_<2048?u[g++]=_>>6|192:(_<65536?u[g++]=_>>12|224:(u[g++]=_>>18|240,u[g++]=_>>12&63|128),u[g++]=_>>6&63|128),u[g++]=63&_|128)}return g}(this.buf,s,this.pos);var a=this.pos-t;a>=128&&K_(t,a,this),this.pos=t-1,this.writeVarint(a),this.pos+=a},writeFloat:function(s){this.realloc(4),W_(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),W_(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var t=s.length;this.writeVarint(t),this.realloc(t);for(var a=0;a<t;a++)this.buf[this.pos++]=s[a]},writeRawMessage:function(s,t){this.pos++;var a=this.pos;s(t,this);var u=this.pos-a;u>=128&&K_(a,u,this),this.pos=a-1,this.writeVarint(u),this.pos+=u},writeMessage:function(s,t,a){this.writeTag(s,Hr.Bytes),this.writeRawMessage(t,a)},writePackedVarint:function(s,t){t.length&&this.writeMessage(s,z2,t)},writePackedSVarint:function(s,t){t.length&&this.writeMessage(s,B2,t)},writePackedBoolean:function(s,t){t.length&&this.writeMessage(s,O2,t)},writePackedFloat:function(s,t){t.length&&this.writeMessage(s,R2,t)},writePackedDouble:function(s,t){t.length&&this.writeMessage(s,F2,t)},writePackedFixed32:function(s,t){t.length&&this.writeMessage(s,N2,t)},writePackedSFixed32:function(s,t){t.length&&this.writeMessage(s,U2,t)},writePackedFixed64:function(s,t){t.length&&this.writeMessage(s,$2,t)},writePackedSFixed64:function(s,t){t.length&&this.writeMessage(s,V2,t)},writeBytesField:function(s,t){this.writeTag(s,Hr.Bytes),this.writeBytes(t)},writeFixed32Field:function(s,t){this.writeTag(s,Hr.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(s,t){this.writeTag(s,Hr.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(s,t){this.writeTag(s,Hr.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(s,t){this.writeTag(s,Hr.Fixed64),this.writeSFixed64(t)},writeVarintField:function(s,t){this.writeTag(s,Hr.Varint),this.writeVarint(t)},writeSVarintField:function(s,t){this.writeTag(s,Hr.Varint),this.writeSVarint(t)},writeStringField:function(s,t){this.writeTag(s,Hr.Bytes),this.writeString(t)},writeFloatField:function(s,t){this.writeTag(s,Hr.Fixed32),this.writeFloat(t)},writeDoubleField:function(s,t){this.writeTag(s,Hr.Fixed64),this.writeDouble(t)},writeBooleanField:function(s,t){this.writeVarintField(s,!!t)}};var Nm=T(G_);const Um=3;function j2(s,t,a){s===1&&a.readMessage(q2,t)}function q2(s,t,a){if(s===3){const{id:u,bitmap:d,width:g,height:_,left:x,top:I,advance:A}=a.readMessage(G2,{});t.push({id:u,bitmap:new rh({width:g+2*Um,height:_+2*Um},d),metrics:{width:g,height:_,left:x,top:I,advance:A}})}}function G2(s,t,a){s===1?t.id=a.readVarint():s===2?t.bitmap=a.readBytes():s===3?t.width=a.readVarint():s===4?t.height=a.readVarint():s===5?t.left=a.readSVarint():s===6?t.top=a.readSVarint():s===7&&(t.advance=a.readVarint())}const J_=Um;function Q_(s){let t=0,a=0;for(const _ of s)t+=_.w*_.h,a=Math.max(a,_.w);s.sort((_,x)=>x.h-_.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),a),h:1/0}];let d=0,g=0;for(const _ of s)for(let x=u.length-1;x>=0;x--){const I=u[x];if(!(_.w>I.w||_.h>I.h)){if(_.x=I.x,_.y=I.y,g=Math.max(g,_.y+_.h),d=Math.max(d,_.x+_.w),_.w===I.w&&_.h===I.h){const A=u.pop();x<u.length&&(u[x]=A)}else _.h===I.h?(I.x+=_.w,I.w-=_.w):_.w===I.w?(I.y+=_.h,I.h-=_.h):(u.push({x:I.x+_.w,y:I.y,w:I.w-_.w,h:_.h}),I.y+=_.h,I.h-=_.h);break}}return{w:d,h:g,fill:t/(d*g)||0}}const Jn=1;class $m{constructor(t,{pixelRatio:a,version:u,stretchX:d,stretchY:g,content:_}){this.paddedRect=t,this.pixelRatio=a,this.stretchX=d,this.stretchY=g,this.content=_,this.version=u}get tl(){return[this.paddedRect.x+Jn,this.paddedRect.y+Jn]}get br(){return[this.paddedRect.x+this.paddedRect.w-Jn,this.paddedRect.y+this.paddedRect.h-Jn]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Jn)/this.pixelRatio,(this.paddedRect.h-2*Jn)/this.pixelRatio]}}class e0{constructor(t,a){const u={},d={};this.haveRenderCallbacks=[];const g=[];this.addImages(t,u,g),this.addImages(a,d,g);const{w:_,h:x}=Q_(g),I=new Is({width:_||1,height:x||1});for(const A in t){const M=t[A],L=u[A].paddedRect;Is.copy(M.data,I,{x:0,y:0},{x:L.x+Jn,y:L.y+Jn},M.data)}for(const A in a){const M=a[A],L=d[A].paddedRect,F=L.x+Jn,U=L.y+Jn,V=M.data.width,Z=M.data.height;Is.copy(M.data,I,{x:0,y:0},{x:F,y:U},M.data),Is.copy(M.data,I,{x:0,y:Z-1},{x:F,y:U-1},{width:V,height:1}),Is.copy(M.data,I,{x:0,y:0},{x:F,y:U+Z},{width:V,height:1}),Is.copy(M.data,I,{x:V-1,y:0},{x:F-1,y:U},{width:1,height:Z}),Is.copy(M.data,I,{x:0,y:0},{x:F+V,y:U},{width:1,height:Z})}this.image=I,this.iconPositions=u,this.patternPositions=d}addImages(t,a,u){for(const d in t){const g=t[d],_={x:0,y:0,w:g.data.width+2*Jn,h:g.data.height+2*Jn};u.push(_),a[d]=new $m(_,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(t,a){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const u in t.updatedImages)this.patchUpdatedImage(this.iconPositions[u],t.getImage(u),a),this.patchUpdatedImage(this.patternPositions[u],t.getImage(u),a)}patchUpdatedImage(t,a,u){if(!t||!a||t.version===a.version)return;t.version=a.version;const[d,g]=t.tl;u.update(a.data,void 0,{x:d,y:g})}}var Bo;yt("ImagePosition",$m),yt("ImageAtlas",e0),c.ai=void 0,(Bo=c.ai||(c.ai={}))[Bo.none=0]="none",Bo[Bo.horizontal=1]="horizontal",Bo[Bo.vertical=2]="vertical",Bo[Bo.horizontalOnly=3]="horizontalOnly";const uh=-17;class hh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,a){const u=new hh;return u.scale=t||1,u.fontStack=a,u}static forImage(t){const a=new hh;return a.imageName=t,a}}class wc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,a){const u=new wc;for(let d=0;d<t.sections.length;d++){const g=t.sections[d];g.image?u.addImageSection(g):u.addTextSection(g,a)}return u}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let a="";for(let u=0;u<t.length;u++){const d=t.charCodeAt(u+1)||null,g=t.charCodeAt(u-1)||null;a+=d&&Od(d)&&!ch[t[u+1]]||g&&Od(g)&&!ch[t[u-1]]||!ch[t[u]]?t[u]:ch[t[u]]}return a}(this.text)}trim(){let t=0;for(let u=0;u<this.text.length&&af[this.text.charCodeAt(u)];u++)t++;let a=this.text.length;for(let u=this.text.length-1;u>=0&&u>=t&&af[this.text.charCodeAt(u)];u--)a--;this.text=this.text.substring(t,a),this.sectionIndex=this.sectionIndex.slice(t,a)}substring(t,a){const u=new wc;return u.text=this.text.substring(t,a),u.sectionIndex=this.sectionIndex.slice(t,a),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,a)=>Math.max(t,this.sections[a].scale),0)}addTextSection(t,a){this.text+=t.text,this.sections.push(hh.forText(t.scale,t.fontStack||a));const u=this.sections.length-1;for(let d=0;d<t.text.length;++d)this.sectionIndex.push(u)}addImageSection(t){const a=t.image?t.image.name:"";if(a.length===0)return void $e("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(hh.forImage(a)),this.sectionIndex.push(this.sections.length-1)):$e("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function sf(s,t,a,u,d,g,_,x,I,A,M,L,F,U,V,Z){const ee=wc.fromFeature(s,d);let ne;L===c.ai.vertical&&ee.verticalizePunctuation();const{processBidirectionalText:ye,processStyledBidirectionalText:ce}=Kn;if(ye&&ee.sections.length===1){ne=[];const Fe=ye(ee.toString(),Vm(ee,A,g,t,u,U,V));for(const pt of Fe){const Tt=new wc;Tt.text=pt,Tt.sections=ee.sections;for(let lt=0;lt<pt.length;lt++)Tt.sectionIndex.push(0);ne.push(Tt)}}else if(ce){ne=[];const Fe=ce(ee.text,ee.sectionIndex,Vm(ee,A,g,t,u,U,V));for(const pt of Fe){const Tt=new wc;Tt.text=pt[0],Tt.sectionIndex=pt[1],Tt.sections=ee.sections,ne.push(Tt)}}else ne=function(Fe,pt){const Tt=[],lt=Fe.text;let at=0;for(const it of pt)Tt.push(Fe.substring(at,it)),at=it;return at<lt.length&&Tt.push(Fe.substring(at,lt.length)),Tt}(ee,Vm(ee,A,g,t,u,U,V));const ve=[],Ie={positionedLines:ve,text:ee.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:L,iconsInText:!1,verticalizable:!1};return function(Fe,pt,Tt,lt,at,it,vt,nt,Ye,Dt,At,fr){let ui=0,pi=uh,en=0,gs=0;const Nn=nt==="right"?1:nt==="left"?0:.5;let Yi=0;for(const tn of at){tn.trim();const rn=tn.getMaxScale(),Mn=(rn-1)*Qi,Vn={positionedGlyphs:[],lineOffset:0};Fe.positionedLines[Yi]=Vn;const Dn=Vn.positionedGlyphs;let Qn=0;if(!tn.length()){pi+=it,++Yi;continue}for(let nn=0;nn<tn.length();nn++){const xr=tn.getSection(nn),Pn=tn.getSectionIndex(nn),Tn=tn.getCharCode(nn);let sn=0,$s=null,sa=null,aa=null,io=Qi;const Vs=!(Ye===c.ai.horizontal||!At&&!Fu(Tn)||At&&(af[Tn]||(pn=Tn,ft.Arabic(pn)||ft["Arabic Supplement"](pn)||ft["Arabic Extended-A"](pn)||ft["Arabic Presentation Forms-A"](pn)||ft["Arabic Presentation Forms-B"](pn))));if(xr.imageName){const ks=lt[xr.imageName];if(!ks)continue;aa=xr.imageName,Fe.iconsInText=Fe.iconsInText||!0,sa=ks.paddedRect;const ts=ks.displaySize;xr.scale=xr.scale*Qi/fr,$s={width:ts[0],height:ts[1],left:Jn,top:-J_,advance:Vs?ts[1]:ts[0]},sn=Mn+(Qi-ts[1]*xr.scale),io=$s.advance;const no=Vs?ts[0]*xr.scale-Qi*rn:ts[1]*xr.scale-Qi*rn;no>0&&no>Qn&&(Qn=no)}else{const ks=Tt[xr.fontStack],ts=ks&&ks[Tn];if(ts&&ts.rect)sa=ts.rect,$s=ts.metrics;else{const no=pt[xr.fontStack],gh=no&&no[Tn];if(!gh)continue;$s=gh.metrics}sn=(rn-xr.scale)*Qi}Vs?(Fe.verticalizable=!0,Dn.push({glyph:Tn,imageName:aa,x:ui,y:pi+sn,vertical:Vs,scale:xr.scale,fontStack:xr.fontStack,sectionIndex:Pn,metrics:$s,rect:sa}),ui+=io*xr.scale+Dt):(Dn.push({glyph:Tn,imageName:aa,x:ui,y:pi+sn,vertical:Vs,scale:xr.scale,fontStack:xr.fontStack,sectionIndex:Pn,metrics:$s,rect:sa}),ui+=$s.advance*xr.scale+Dt)}Dn.length!==0&&(en=Math.max(ui-Dt,en),H2(Dn,0,Dn.length-1,Nn,Qn)),ui=0;const es=it*rn+Qn;Vn.lineOffset=Math.max(Qn,Mn),pi+=es,gs=Math.max(es,gs),++Yi}var pn;const In=pi-uh,{horizontalAlign:Un,verticalAlign:$n}=jm(vt);(function(tn,rn,Mn,Vn,Dn,Qn,es,nn,xr){const Pn=(rn-Mn)*Dn;let Tn=0;Tn=Qn!==es?-nn*Vn-uh:(-Vn*xr+.5)*es;for(const sn of tn)for(const $s of sn.positionedGlyphs)$s.x+=Pn,$s.y+=Tn})(Fe.positionedLines,Nn,Un,$n,en,gs,it,In,at.length),Fe.top+=-$n*In,Fe.bottom=Fe.top+In,Fe.left+=-Un*en,Fe.right=Fe.left+en}(Ie,t,a,u,ne,_,x,I,L,A,F,Z),!function(Fe){for(const pt of Fe)if(pt.positionedGlyphs.length!==0)return!1;return!0}(ve)&&Ie}const af={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Z2={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function t0(s,t,a,u,d,g){if(t.imageName){const _=u[t.imageName];return _?_.displaySize[0]*t.scale*Qi/g+d:0}{const _=a[t.fontStack],x=_&&_[s];return x?x.metrics.advance*t.scale+d:0}}function r0(s,t,a,u){const d=Math.pow(s-t,2);return u?s<t?d/2:2*d:d+Math.abs(a)*a}function W2(s,t,a){let u=0;return s===10&&(u-=1e4),a&&(u+=150),s!==40&&s!==65288||(u+=50),t!==41&&t!==65289||(u+=50),u}function i0(s,t,a,u,d,g){let _=null,x=r0(t,a,d,g);for(const I of u){const A=r0(t-I.x,a,d,g)+I.badness;A<=x&&(_=I,x=A)}return{index:s,x:t,priorBreak:_,badness:x}}function n0(s){return s?n0(s.priorBreak).concat(s.index):[]}function Vm(s,t,a,u,d,g,_){if(g!=="point")return[];if(!s)return[];const x=[],I=function(F,U,V,Z,ee,ne){let ye=0;for(let ce=0;ce<F.length();ce++){const ve=F.getSection(ce);ye+=t0(F.getCharCode(ce),ve,Z,ee,U,ne)}return ye/Math.max(1,Math.ceil(ye/V))}(s,t,a,u,d,_),A=s.text.indexOf("​")>=0;let M=0;for(let F=0;F<s.length();F++){const U=s.getSection(F),V=s.getCharCode(F);if(af[V]||(M+=t0(V,U,u,d,t,_)),F<s.length()-1){const Z=!((L=V)<11904||!(ft["Bopomofo Extended"](L)||ft.Bopomofo(L)||ft["CJK Compatibility Forms"](L)||ft["CJK Compatibility Ideographs"](L)||ft["CJK Compatibility"](L)||ft["CJK Radicals Supplement"](L)||ft["CJK Strokes"](L)||ft["CJK Symbols and Punctuation"](L)||ft["CJK Unified Ideographs Extension A"](L)||ft["CJK Unified Ideographs"](L)||ft["Enclosed CJK Letters and Months"](L)||ft["Halfwidth and Fullwidth Forms"](L)||ft.Hiragana(L)||ft["Ideographic Description Characters"](L)||ft["Kangxi Radicals"](L)||ft["Katakana Phonetic Extensions"](L)||ft.Katakana(L)||ft["Vertical Forms"](L)||ft["Yi Radicals"](L)||ft["Yi Syllables"](L)));(Z2[V]||Z||U.imageName)&&x.push(i0(F+1,M,I,x,W2(V,s.getCharCode(F+1),Z&&A),!1))}}var L;return n0(i0(s.length(),M,I,x,0,!0))}function jm(s){let t=.5,a=.5;switch(s){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:t,verticalAlign:a}}function H2(s,t,a,u,d){if(!u&&!d)return;const g=s[a],_=(s[a].x+g.metrics.advance*g.scale)*u;for(let x=t;x<=a;x++)s[x].x-=_,s[x].y+=d}function Y2(s,t,a){const{horizontalAlign:u,verticalAlign:d}=jm(a),g=t[0]-s.displaySize[0]*u,_=t[1]-s.displaySize[1]*d;return{image:s,top:_,bottom:_+s.displaySize[1],left:g,right:g+s.displaySize[0]}}function s0(s,t,a,u,d,g){const _=s.image;let x;if(_.content){const ee=_.content,ne=_.pixelRatio||1;x=[ee[0]/ne,ee[1]/ne,_.displaySize[0]-ee[2]/ne,_.displaySize[1]-ee[3]/ne]}const I=t.left*g,A=t.right*g;let M,L,F,U;a==="width"||a==="both"?(U=d[0]+I-u[3],L=d[0]+A+u[1]):(U=d[0]+(I+A-_.displaySize[0])/2,L=U+_.displaySize[0]);const V=t.top*g,Z=t.bottom*g;return a==="height"||a==="both"?(M=d[1]+V-u[0],F=d[1]+Z+u[2]):(M=d[1]+(V+Z-_.displaySize[1])/2,F=M+_.displaySize[1]),{image:_,top:M,right:L,bottom:F,left:U,collisionPadding:x}}const dh=255,Ta=128,Ro=dh*Ta;function a0(s,t){const{expression:a}=t;if(a.kind==="constant")return{kind:"constant",layoutSize:a.evaluate(new li(s+1))};if(a.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:d}=a;let g=0;for(;g<u.length&&u[g]<=s;)g++;g=Math.max(0,g-1);let _=g;for(;_<u.length&&u[_]<s+1;)_++;_=Math.min(u.length-1,_);const x=u[g],I=u[_];return a.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:I,interpolationType:d}:{kind:"camera",minZoom:x,maxZoom:I,minSize:a.evaluate(new li(x)),maxSize:a.evaluate(new li(I)),interpolationType:d}}}function qm(s,t,a){let u="never";const d=s.get(t);return d?u=d:s.get(a)&&(u="always"),u}const K2=zo.VectorTileFeature.types,X2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function of(s,t,a,u,d,g,_,x,I,A,M,L,F){const U=x?Math.min(Ro,Math.round(x[0])):0,V=x?Math.min(Ro,Math.round(x[1])):0;s.emplaceBack(t,a,Math.round(32*u),Math.round(32*d),g,_,(U<<1)+(I?1:0),V,16*A,16*M,256*L,256*F)}function Gm(s,t,a){s.emplaceBack(t.x,t.y,a),s.emplaceBack(t.x,t.y,a),s.emplaceBack(t.x,t.y,a),s.emplaceBack(t.x,t.y,a)}function J2(s){for(const t of s.sections)if(ym(t.text))return!0;return!1}class Zm{constructor(t){this.layoutVertexArray=new gr,this.indexArray=new dn,this.programConfigurations=t,this.segments=new ci,this.dynamicLayoutVertexArray=new nr,this.opacityVertexArray=new vr,this.hasVisibleVertices=!1,this.placedSymbolArray=new pe}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,a,u,d){this.isEmpty()||(u&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,C2.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,M2.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,X2,!0),this.opacityVertexBuffer.itemSize=1),(u||d)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}yt("SymbolBuffers",Zm);class Wm{constructor(t,a,u){this.layoutVertexArray=new t,this.layoutAttributes=a,this.indexArray=new u,this.segments=new ci,this.collisionVertexArray=new ri}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,D2.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}yt("CollisionBuffers",Wm);class Sc{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(_=>_.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Im([]),this.placementViewportMatrix=Im([]);const a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=a0(this.zoom,a["text-size"]),this.iconSizeData=a0(this.zoom,a["icon-size"]);const u=this.layers[0].layout,d=u.get("symbol-sort-key"),g=u.get("symbol-z-order");this.canOverlap=qm(u,"text-overlap","text-allow-overlap")!=="never"||qm(u,"icon-overlap","icon-allow-overlap")!=="never"||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&!d.isConstant(),this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,u.get("symbol-placement")==="point"&&(this.writingModes=u.get("text-writing-mode").map(_=>c.ai[_])),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=t.sourceID}createArrays(){this.text=new Zm(new na(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Zm(new na(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new me,this.lineVertexArray=new Te,this.symbolInstances=new re,this.textAnchorOffsets=new Re}calculateGlyphDependencies(t,a,u,d,g){for(let _=0;_<t.length;_++)if(a[t.charCodeAt(_)]=!0,(u||d)&&g){const x=ch[t.charAt(_)];x&&(a[x.charCodeAt(0)]=!0)}}populate(t,a,u){const d=this.layers[0],g=d.layout,_=g.get("text-font"),x=g.get("text-field"),I=g.get("icon-image"),A=(x.value.kind!=="constant"||x.value.value instanceof xn&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(_.value.kind!=="constant"||_.value.value.length>0),M=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,L=g.get("symbol-sort-key");if(this.features=[],!A&&!M)return;const F=a.iconDependencies,U=a.glyphDependencies,V=a.availableImages,Z=new li(this.zoom);for(const{feature:ee,id:ne,index:ye,sourceLayerIndex:ce}of t){const ve=d._featureFilter.needGeometry,Ie=bl(ee,ve);if(!d._featureFilter.filter(Z,Ie,u))continue;let Fe,pt;if(ve||(Ie.geometry=vl(ee)),A){const lt=d.getValueAndResolveTokens("text-field",Ie,u,V),at=xn.factory(lt);J2(at)&&(this.hasRTLText=!0),(!this.hasRTLText||ju()==="unavailable"||this.hasRTLText&&Kn.isParsed())&&(Fe=L2(at,d,Ie))}if(M){const lt=d.getValueAndResolveTokens("icon-image",Ie,u,V);pt=lt instanceof hn?lt:hn.fromString(lt)}if(!Fe&&!pt)continue;const Tt=this.sortFeaturesByKey?L.evaluate(Ie,{},u):void 0;if(this.features.push({id:ne,text:Fe,icon:pt,index:ye,sourceLayerIndex:ce,geometry:Ie.geometry,properties:ee.properties,type:K2[ee.type],sortKey:Tt}),pt&&(F[pt.name]=!0),Fe){const lt=_.evaluate(Ie,{},u).join(","),at=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(c.ai.vertical)>=0;for(const it of Fe.sections)if(it.image)F[it.image.name]=!0;else{const vt=Bu(Fe.toString()),nt=it.fontStack||lt,Ye=U[nt]=U[nt]||{};this.calculateGlyphDependencies(it.text,Ye,at,this.allowVerticalPlacement,vt)}}}g.get("symbol-placement")==="line"&&(this.features=function(ee){const ne={},ye={},ce=[];let ve=0;function Ie(lt){ce.push(ee[lt]),ve++}function Fe(lt,at,it){const vt=ye[lt];return delete ye[lt],ye[at]=vt,ce[vt].geometry[0].pop(),ce[vt].geometry[0]=ce[vt].geometry[0].concat(it[0]),vt}function pt(lt,at,it){const vt=ne[at];return delete ne[at],ne[lt]=vt,ce[vt].geometry[0].shift(),ce[vt].geometry[0]=it[0].concat(ce[vt].geometry[0]),vt}function Tt(lt,at,it){const vt=it?at[0][at[0].length-1]:at[0][0];return`${lt}:${vt.x}:${vt.y}`}for(let lt=0;lt<ee.length;lt++){const at=ee[lt],it=at.geometry,vt=at.text?at.text.toString():null;if(!vt){Ie(lt);continue}const nt=Tt(vt,it),Ye=Tt(vt,it,!0);if(nt in ye&&Ye in ne&&ye[nt]!==ne[Ye]){const Dt=pt(nt,Ye,it),At=Fe(nt,Ye,ce[Dt].geometry);delete ne[nt],delete ye[Ye],ye[Tt(vt,ce[At].geometry,!0)]=At,ce[Dt].geometry=null}else nt in ye?Fe(nt,Ye,it):Ye in ne?pt(nt,Ye,it):(Ie(lt),ne[nt]=ve-1,ye[Ye]=ve-1)}return ce.filter(lt=>lt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ee,ne)=>ee.sortKey-ne.sortKey)}update(t,a,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,a,this.layers,u),this.icon.programConfigurations.updatePaintArrays(t,a,this.layers,u))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,a){const u=this.lineVertexArray.length;if(t.segment!==void 0){let d=t.dist(a[t.segment+1]),g=t.dist(a[t.segment]);const _={};for(let x=t.segment+1;x<a.length;x++)_[x]={x:a[x].x,y:a[x].y,tileUnitDistanceFromAnchor:d},x<a.length-1&&(d+=a[x+1].dist(a[x]));for(let x=t.segment||0;x>=0;x--)_[x]={x:a[x].x,y:a[x].y,tileUnitDistanceFromAnchor:g},x>0&&(g+=a[x-1].dist(a[x]));for(let x=0;x<a.length;x++){const I=_[x];this.lineVertexArray.emplaceBack(I.x,I.y,I.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(t,a,u,d,g,_,x,I,A,M,L,F){const U=t.indexArray,V=t.layoutVertexArray,Z=t.segments.prepareSegment(4*a.length,V,U,this.canOverlap?_.sortKey:void 0),ee=this.glyphOffsetArray.length,ne=Z.vertexLength,ye=this.allowVerticalPlacement&&x===c.ai.vertical?Math.PI/2:0,ce=_.text&&_.text.sections;for(let ve=0;ve<a.length;ve++){const{tl:Ie,tr:Fe,bl:pt,br:Tt,tex:lt,pixelOffsetTL:at,pixelOffsetBR:it,minFontScaleX:vt,minFontScaleY:nt,glyphOffset:Ye,isSDF:Dt,sectionIndex:At}=a[ve],fr=Z.vertexLength,ui=Ye[1];of(V,I.x,I.y,Ie.x,ui+Ie.y,lt.x,lt.y,u,Dt,at.x,at.y,vt,nt),of(V,I.x,I.y,Fe.x,ui+Fe.y,lt.x+lt.w,lt.y,u,Dt,it.x,at.y,vt,nt),of(V,I.x,I.y,pt.x,ui+pt.y,lt.x,lt.y+lt.h,u,Dt,at.x,it.y,vt,nt),of(V,I.x,I.y,Tt.x,ui+Tt.y,lt.x+lt.w,lt.y+lt.h,u,Dt,it.x,it.y,vt,nt),Gm(t.dynamicLayoutVertexArray,I,ye),U.emplaceBack(fr,fr+1,fr+2),U.emplaceBack(fr+1,fr+2,fr+3),Z.vertexLength+=4,Z.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ye[0]),ve!==a.length-1&&At===a[ve+1].sectionIndex||t.programConfigurations.populatePaintArrays(V.length,_,_.index,{},F,ce&&ce[At])}t.placedSymbolArray.emplaceBack(I.x,I.y,ee,this.glyphOffsetArray.length-ee,ne,A,M,I.segment,u?u[0]:0,u?u[1]:0,d[0],d[1],x,0,!1,0,L)}_addCollisionDebugVertex(t,a,u,d,g,_){return a.emplaceBack(0,0),t.emplaceBack(u.x,u.y,d,g,Math.round(_.x),Math.round(_.y))}addCollisionDebugVertices(t,a,u,d,g,_,x){const I=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),A=I.vertexLength,M=g.layoutVertexArray,L=g.collisionVertexArray,F=x.anchorX,U=x.anchorY;this._addCollisionDebugVertex(M,L,_,F,U,new $(t,a)),this._addCollisionDebugVertex(M,L,_,F,U,new $(u,a)),this._addCollisionDebugVertex(M,L,_,F,U,new $(u,d)),this._addCollisionDebugVertex(M,L,_,F,U,new $(t,d)),I.vertexLength+=4;const V=g.indexArray;V.emplaceBack(A,A+1),V.emplaceBack(A+1,A+2),V.emplaceBack(A+2,A+3),V.emplaceBack(A+3,A),I.primitiveLength+=4}addDebugCollisionBoxes(t,a,u,d){for(let g=t;g<a;g++){const _=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(_.x1,_.y1,_.x2,_.y2,d?this.textCollisionBox:this.iconCollisionBox,_.anchorPoint,u)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Wm(Pi,q_.members,Xi),this.iconCollisionBox=new Wm(Pi,q_.members,Xi);for(let t=0;t<this.symbolInstances.length;t++){const a=this.symbolInstances.get(t);this.addDebugCollisionBoxes(a.textBoxStartIndex,a.textBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.iconBoxStartIndex,a.iconBoxEndIndex,a,!1),this.addDebugCollisionBoxes(a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a,!1)}}_deserializeCollisionBoxesForSymbol(t,a,u,d,g,_,x,I,A){const M={};for(let L=a;L<u;L++){const F=t.get(L);M.textBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},M.textFeatureIndex=F.featureIndex;break}for(let L=d;L<g;L++){const F=t.get(L);M.verticalTextBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},M.verticalTextFeatureIndex=F.featureIndex;break}for(let L=_;L<x;L++){const F=t.get(L);M.iconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},M.iconFeatureIndex=F.featureIndex;break}for(let L=I;L<A;L++){const F=t.get(L);M.verticalIconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},M.verticalIconFeatureIndex=F.featureIndex;break}return M}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const u=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,a){const u=t.placedSymbolArray.get(a),d=u.vertexStartIndex+4*u.numGlyphs;for(let g=u.vertexStartIndex;g<d;g+=4)t.indexArray.emplaceBack(g,g+1,g+2),t.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const a=Math.sin(t),u=Math.cos(t),d=[],g=[],_=[];for(let x=0;x<this.symbolInstances.length;++x){_.push(x);const I=this.symbolInstances.get(x);d.push(0|Math.round(a*I.anchorX+u*I.anchorY)),g.push(I.featureIndex)}return _.sort((x,I)=>d[x]-d[I]||g[I]-g[x]),_}addToSortKeyRanges(t,a){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===a?u.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const u=this.symbolInstances.get(a);this.featureSortOrder.push(u.featureIndex),[u.rightJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.leftJustifiedTextSymbolIndex].forEach((d,g,_)=>{d>=0&&_.indexOf(d)===g&&this.addIndicesForPlacedSymbol(this.text,d)}),u.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,u.verticalPlacedTextSymbolIndex),u.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.placedIconSymbolIndex),u.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let o0,l0;yt("SymbolBucket",Sc,{omit:["layers","collisionBoxArray","features","compareText"]}),Sc.MAX_GLYPHS=65535,Sc.addDynamicAttributes=Gm;var Hm={get paint(){return l0=l0||new Ri({"icon-opacity":new Rt(Ce.paint_symbol["icon-opacity"]),"icon-color":new Rt(Ce.paint_symbol["icon-color"]),"icon-halo-color":new Rt(Ce.paint_symbol["icon-halo-color"]),"icon-halo-width":new Rt(Ce.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Rt(Ce.paint_symbol["icon-halo-blur"]),"icon-translate":new Et(Ce.paint_symbol["icon-translate"]),"icon-translate-anchor":new Et(Ce.paint_symbol["icon-translate-anchor"]),"text-opacity":new Rt(Ce.paint_symbol["text-opacity"]),"text-color":new Rt(Ce.paint_symbol["text-color"],{runtimeType:vn,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new Rt(Ce.paint_symbol["text-halo-color"]),"text-halo-width":new Rt(Ce.paint_symbol["text-halo-width"]),"text-halo-blur":new Rt(Ce.paint_symbol["text-halo-blur"]),"text-translate":new Et(Ce.paint_symbol["text-translate"]),"text-translate-anchor":new Et(Ce.paint_symbol["text-translate-anchor"])})},get layout(){return o0=o0||new Ri({"symbol-placement":new Et(Ce.layout_symbol["symbol-placement"]),"symbol-spacing":new Et(Ce.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Et(Ce.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Rt(Ce.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Et(Ce.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Et(Ce.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Et(Ce.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Et(Ce.layout_symbol["icon-ignore-placement"]),"icon-optional":new Et(Ce.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Et(Ce.layout_symbol["icon-rotation-alignment"]),"icon-size":new Rt(Ce.layout_symbol["icon-size"]),"icon-text-fit":new Et(Ce.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Et(Ce.layout_symbol["icon-text-fit-padding"]),"icon-image":new Rt(Ce.layout_symbol["icon-image"]),"icon-rotate":new Rt(Ce.layout_symbol["icon-rotate"]),"icon-padding":new Rt(Ce.layout_symbol["icon-padding"]),"icon-keep-upright":new Et(Ce.layout_symbol["icon-keep-upright"]),"icon-offset":new Rt(Ce.layout_symbol["icon-offset"]),"icon-anchor":new Rt(Ce.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Et(Ce.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Et(Ce.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Et(Ce.layout_symbol["text-rotation-alignment"]),"text-field":new Rt(Ce.layout_symbol["text-field"]),"text-font":new Rt(Ce.layout_symbol["text-font"]),"text-size":new Rt(Ce.layout_symbol["text-size"]),"text-max-width":new Rt(Ce.layout_symbol["text-max-width"]),"text-line-height":new Et(Ce.layout_symbol["text-line-height"]),"text-letter-spacing":new Rt(Ce.layout_symbol["text-letter-spacing"]),"text-justify":new Rt(Ce.layout_symbol["text-justify"]),"text-radial-offset":new Rt(Ce.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Et(Ce.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Rt(Ce.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Rt(Ce.layout_symbol["text-anchor"]),"text-max-angle":new Et(Ce.layout_symbol["text-max-angle"]),"text-writing-mode":new Et(Ce.layout_symbol["text-writing-mode"]),"text-rotate":new Rt(Ce.layout_symbol["text-rotate"]),"text-padding":new Et(Ce.layout_symbol["text-padding"]),"text-keep-upright":new Et(Ce.layout_symbol["text-keep-upright"]),"text-transform":new Rt(Ce.layout_symbol["text-transform"]),"text-offset":new Rt(Ce.layout_symbol["text-offset"]),"text-allow-overlap":new Et(Ce.layout_symbol["text-allow-overlap"]),"text-overlap":new Et(Ce.layout_symbol["text-overlap"]),"text-ignore-placement":new Et(Ce.layout_symbol["text-ignore-placement"]),"text-optional":new Et(Ce.layout_symbol["text-optional"])})}};class c0{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:os,this.defaultValue=t}evaluate(t){if(t.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(t.formattedSection))return a.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}yt("FormatSectionOverride",c0,{omit:["defaultValue"]});class lf extends ps{constructor(t){super(t,Hm)}recalculate(t,a){if(super.recalculate(t,a),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const u=this.layout.get("text-writing-mode");if(u){const d=[];for(const g of u)d.indexOf(g)<0&&d.push(g);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,a,u,d){const g=this.layout.get(t).evaluate(a,{},u,d),_=this._unevaluatedLayout._values[t];return _.isDataDriven()||ic(_.value)||!g?g:function(x,I){return I.replace(/{([^{}]+)}/g,(A,M)=>x&&M in x?String(x[M]):"")}(a.properties,g)}createBucket(t){return new Sc(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of Hm.paint.overridableProperties){if(!lf.hasPaintOverride(this.layout,t))continue;const a=this.paint.get(t),u=new c0(a),d=new Cu(u,a.property.specification);let g=null;g=a.value.kind==="constant"||a.value.kind==="source"?new Mu("source",d):new sc("composite",d,a.value.zoomStops),this.paint._values[t]=new En(a.property,g,a.parameters)}}_handleOverridablePaintPropertyUpdate(t,a,u){return!(!this.layout||a.isDataDriven()||u.isDataDriven())&&lf.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,a){const u=t.get("text-field"),d=Hm.paint.properties[a];let g=!1;const _=x=>{for(const I of x)if(d.overrides&&d.overrides.hasOverride(I))return void(g=!0)};if(u.value.kind==="constant"&&u.value.value instanceof xn)_(u.value.value.sections);else if(u.value.kind==="source"){const x=A=>{g||(A instanceof qa&&_i(A.value)===K?_(A.value.sections):A instanceof rc?_(A.sections):A.eachChild(x))},I=u.value;I._styleExpression&&x(I._styleExpression.expression)}return g}}let u0;var Q2={get paint(){return u0=u0||new Ri({"background-color":new Et(Ce.paint_background["background-color"]),"background-pattern":new Gu(Ce.paint_background["background-pattern"]),"background-opacity":new Et(Ce.paint_background["background-opacity"])})}};class eS extends ps{constructor(t){super(t,Q2)}}let h0;var tS={get paint(){return h0=h0||new Ri({"raster-opacity":new Et(Ce.paint_raster["raster-opacity"]),"raster-hue-rotate":new Et(Ce.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Et(Ce.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Et(Ce.paint_raster["raster-brightness-max"]),"raster-saturation":new Et(Ce.paint_raster["raster-saturation"]),"raster-contrast":new Et(Ce.paint_raster["raster-contrast"]),"raster-resampling":new Et(Ce.paint_raster["raster-resampling"]),"raster-fade-duration":new Et(Ce.paint_raster["raster-fade-duration"])})}};class rS extends ps{constructor(t){super(t,tS)}}class iS extends ps{constructor(t){super(t,{}),this.onAdd=a=>{this.implementation.onAdd&&this.implementation.onAdd(a,a.painter.context.gl)},this.onRemove=a=>{this.implementation.onRemove&&this.implementation.onRemove(a,a.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class nS{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Ym=63710088e-1;class Fo{constructor(t,a){if(isNaN(t)||isNaN(a))throw new Error(`Invalid LngLat object: (${t}, ${a})`);if(this.lng=+t,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Fo(Ge(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const a=Math.PI/180,u=this.lat*a,d=t.lat*a,g=Math.sin(u)*Math.sin(d)+Math.cos(u)*Math.cos(d)*Math.cos((t.lng-this.lng)*a);return Ym*Math.acos(Math.min(g,1))}static convert(t){if(t instanceof Fo)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Fo(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Fo(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const d0=2*Math.PI*Ym;function f0(s){return d0*Math.cos(s*Math.PI/180)}function p0(s){return(180+s)/360}function m0(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function g0(s,t){return s/f0(t)}function y0(s){return 360*s-180}function Km(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}class cf{constructor(t,a,u=0){this.x=+t,this.y=+a,this.z=+u}static fromLngLat(t,a=0){const u=Fo.convert(t);return new cf(p0(u.lng),m0(u.lat),g0(a,u.lat))}toLngLat(){return new Fo(y0(this.x),Km(this.y))}toAltitude(){return this.z*f0(Km(this.y))}meterInMercatorCoordinateUnits(){return 1/d0*(t=Km(this.y),1/Math.cos(t*Math.PI/180));var t}}function _0(s,t,a){var u=2*Math.PI*6378137/256/Math.pow(2,a);return[s*u-2*Math.PI*6378137/2,t*u-2*Math.PI*6378137/2]}class Xm{constructor(t,a,u){if(t<0||t>25||u<0||u>=Math.pow(2,t)||a<0||a>=Math.pow(2,t))throw new Error(`x=${a}, y=${u}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=a,this.y=u,this.key=fh(0,t,t,a,u)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,a,u){const d=(_=this.y,x=this.z,I=_0(256*(g=this.x),256*(_=Math.pow(2,x)-_-1),x),A=_0(256*(g+1),256*(_+1),x),I[0]+","+I[1]+","+A[0]+","+A[1]);var g,_,x,I,A;const M=function(L,F,U){let V,Z="";for(let ee=L;ee>0;ee--)V=1<<ee-1,Z+=(F&V?1:0)+(U&V?2:0);return Z}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(u==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,a>1?"@2x":"").replace(/{quadkey}/g,M).replace(/{bbox-epsg-3857}/g,d)}isChildOf(t){const a=this.z-t.z;return a>0&&t.x===this.x>>a&&t.y===this.y>>a}getTilePoint(t){const a=Math.pow(2,this.z);return new $((t.x*a-this.x)*Hi,(t.y*a-this.y)*Hi)}toString(){return`${this.z}/${this.x}/${this.y}`}}class v0{constructor(t,a){this.wrap=t,this.canonical=a,this.key=fh(t,a.z,a.z,a.x,a.y)}}class Ts{constructor(t,a,u,d,g){if(t<u)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${u}`);this.overscaledZ=t,this.wrap=a,this.canonical=new Xm(u,+d,+g),this.key=fh(a,t,u,d,g)}clone(){return new Ts(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-t;return t>this.canonical.z?new Ts(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ts(t,this.wrap,t,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(t,a){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-t;return t>this.canonical.z?fh(this.wrap*+a,t,this.canonical.z,this.canonical.x,this.canonical.y):fh(this.wrap*+a,t,t,this.canonical.x>>u,this.canonical.y>>u)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const a=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>a&&t.canonical.y===this.canonical.y>>a}children(t){if(this.overscaledZ>=t)return[new Ts(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,u=2*this.canonical.x,d=2*this.canonical.y;return[new Ts(a,this.wrap,a,u,d),new Ts(a,this.wrap,a,u+1,d),new Ts(a,this.wrap,a,u,d+1),new Ts(a,this.wrap,a,u+1,d+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Ts(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Ts(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new v0(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new cf(t.x-this.wrap,t.y))}}function fh(s,t,a,u,d){(s*=2)<0&&(s=-1*s-1);const g=1<<a;return(g*g*s+g*d+u).toString(36)+a.toString(36)+t.toString(36)}yt("CanonicalTileID",Xm),yt("OverscaledTileID",Ts,{omit:["posMatrix"]});class b0{constructor(t,a,u,d=1,g=1,_=1,x=0){if(this.uid=t,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(u&&!["mapbox","terrarium","custom"].includes(u))return void $e(`"${u}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=a.height;const I=this.dim=a.height-2;switch(this.data=new Uint32Array(a.data.buffer),u){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=d,this.greenFactor=g,this.blueFactor=_,this.baseShift=x;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let A=0;A<I;A++)this.data[this._idx(-1,A)]=this.data[this._idx(0,A)],this.data[this._idx(I,A)]=this.data[this._idx(I-1,A)],this.data[this._idx(A,-1)]=this.data[this._idx(A,0)],this.data[this._idx(A,I)]=this.data[this._idx(A,I-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(I,-1)]=this.data[this._idx(I-1,0)],this.data[this._idx(-1,I)]=this.data[this._idx(0,I-1)],this.data[this._idx(I,I)]=this.data[this._idx(I-1,I-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let A=0;A<I;A++)for(let M=0;M<I;M++){const L=this.get(A,M);L>this.max&&(this.max=L),L<this.min&&(this.min=L)}}get(t,a){const u=new Uint8Array(this.data.buffer),d=4*this._idx(t,a);return this.unpack(u[d],u[d+1],u[d+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,a){if(t<-1||t>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(t+1)}unpack(t,a,u){return t*this.redFactor+a*this.greenFactor+u*this.blueFactor-this.baseShift}getPixels(){return new Is({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,a,u){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let d=a*this.dim,g=a*this.dim+this.dim,_=u*this.dim,x=u*this.dim+this.dim;switch(a){case-1:d=g-1;break;case 1:g=d+1}switch(u){case-1:_=x-1;break;case 1:x=_+1}const I=-a*this.dim,A=-u*this.dim;for(let M=_;M<x;M++)for(let L=d;L<g;L++)this.data[this._idx(L,M)]=t.data[this._idx(L+I,M+A)]}}yt("DEMData",b0);class x0{constructor(t){this._stringToNumber={},this._numberToString=[];for(let a=0;a<t.length;a++){const u=t[a];this._stringToNumber[u]=a,this._numberToString[a]=u}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class w0{constructor(t,a,u,d,g){this.type="Feature",this._vectorTileFeature=t,t._z=a,t._x=u,t._y=d,this.properties=t.properties,this.id=g}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const a in this)a!=="_geometry"&&a!=="_vectorTileFeature"&&(t[a]=this[a]);return t}}class S0{constructor(t,a){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Co(Hi,16,0),this.grid3D=new Co(Hi,16,0),this.featureIndexArray=new Ue,this.promoteId=a}insert(t,a,u,d,g,_){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,d,g);const I=_?this.grid3D:this.grid;for(let A=0;A<a.length;A++){const M=a[A],L=[1/0,1/0,-1/0,-1/0];for(let F=0;F<M.length;F++){const U=M[F];L[0]=Math.min(L[0],U.x),L[1]=Math.min(L[1],U.y),L[2]=Math.max(L[2],U.x),L[3]=Math.max(L[3],U.y)}L[0]<Hi&&L[1]<Hi&&L[2]>=0&&L[3]>=0&&I.insert(x,L[0],L[1],L[2],L[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new zo.VectorTile(new Nm(this.rawTileData)).layers,this.sourceLayerCoder=new x0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,a,u,d){this.loadVTLayers();const g=t.params||{},_=Hi/t.tileSize/t.scale,x=Pu(g.filter),I=t.queryGeometry,A=t.queryPadding*_,M=T0(I),L=this.grid.query(M.minX-A,M.minY-A,M.maxX+A,M.maxY+A),F=T0(t.cameraQueryGeometry),U=this.grid3D.query(F.minX-A,F.minY-A,F.maxX+A,F.maxY+A,(ee,ne,ye,ce)=>function(ve,Ie,Fe,pt,Tt){for(const at of ve)if(Ie<=at.x&&Fe<=at.y&&pt>=at.x&&Tt>=at.y)return!0;const lt=[new $(Ie,Fe),new $(Ie,Tt),new $(pt,Tt),new $(pt,Fe)];if(ve.length>2){for(const at of lt)if(gc(ve,at))return!0}for(let at=0;at<ve.length-1;at++)if(Rw(ve[at],ve[at+1],lt))return!0;return!1}(t.cameraQueryGeometry,ee-A,ne-A,ye+A,ce+A));for(const ee of U)L.push(ee);L.sort(sS);const V={};let Z;for(let ee=0;ee<L.length;ee++){const ne=L[ee];if(ne===Z)continue;Z=ne;const ye=this.featureIndexArray.get(ne);let ce=null;this.loadMatchingFeature(V,ye.bucketIndex,ye.sourceLayerIndex,ye.featureIndex,x,g.layers,g.availableImages,a,u,d,(ve,Ie,Fe)=>(ce||(ce=vl(ve)),Ie.queryIntersectsFeature(I,ve,Fe,ce,this.z,t.transform,_,t.pixelPosMatrix)))}return V}loadMatchingFeature(t,a,u,d,g,_,x,I,A,M,L){const F=this.bucketLayerIDs[a];if(_&&!function(ee,ne){for(let ye=0;ye<ee.length;ye++)if(ne.indexOf(ee[ye])>=0)return!0;return!1}(_,F))return;const U=this.sourceLayerCoder.decode(u),V=this.vtLayers[U].feature(d);if(g.needGeometry){const ee=bl(V,!0);if(!g.filter(new li(this.tileID.overscaledZ),ee,this.tileID.canonical))return}else if(!g.filter(new li(this.tileID.overscaledZ),V))return;const Z=this.getId(V,U);for(let ee=0;ee<F.length;ee++){const ne=F[ee];if(_&&_.indexOf(ne)<0)continue;const ye=I[ne];if(!ye)continue;let ce={};Z&&M&&(ce=M.getState(ye.sourceLayer||"_geojsonTileLayer",Z));const ve=Ee({},A[ne]);ve.paint=I0(ve.paint,ye.paint,V,ce,x),ve.layout=I0(ve.layout,ye.layout,V,ce,x);const Ie=!L||L(V,ye,ce);if(!Ie)continue;const Fe=new w0(V,this.z,this.x,this.y,Z);Fe.layer=ve;let pt=t[ne];pt===void 0&&(pt=t[ne]=[]),pt.push({featureIndex:d,feature:Fe,intersectionZ:Ie})}}lookupSymbolFeatures(t,a,u,d,g,_,x,I){const A={};this.loadVTLayers();const M=Pu(g);for(const L of t)this.loadMatchingFeature(A,u,d,L,M,_,x,I,a);return A}hasLayer(t){for(const a of this.bucketLayerIDs)for(const u of a)if(t===u)return!0;return!1}getId(t,a){let u=t.id;return this.promoteId&&(u=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[a]],typeof u=="boolean"&&(u=Number(u))),u}}function I0(s,t,a,u,d){return De(s,(g,_)=>{const x=t instanceof pc?t.get(_):null;return x&&x.evaluate?x.evaluate(a,u,d):x})}function T0(s){let t=1/0,a=1/0,u=-1/0,d=-1/0;for(const g of s)t=Math.min(t,g.x),a=Math.min(a,g.y),u=Math.max(u,g.x),d=Math.max(d,g.y);return{minX:t,minY:a,maxX:u,maxY:d}}function sS(s,t){return t-s}function k0(s,t,a,u,d){const g=[];for(let _=0;_<s.length;_++){const x=s[_];let I;for(let A=0;A<x.length-1;A++){let M=x[A],L=x[A+1];M.x<t&&L.x<t||(M.x<t?M=new $(t,M.y+(t-M.x)/(L.x-M.x)*(L.y-M.y))._round():L.x<t&&(L=new $(t,M.y+(t-M.x)/(L.x-M.x)*(L.y-M.y))._round()),M.y<a&&L.y<a||(M.y<a?M=new $(M.x+(a-M.y)/(L.y-M.y)*(L.x-M.x),a)._round():L.y<a&&(L=new $(M.x+(a-M.y)/(L.y-M.y)*(L.x-M.x),a)._round()),M.x>=u&&L.x>=u||(M.x>=u?M=new $(u,M.y+(u-M.x)/(L.x-M.x)*(L.y-M.y))._round():L.x>=u&&(L=new $(u,M.y+(u-M.x)/(L.x-M.x)*(L.y-M.y))._round()),M.y>=d&&L.y>=d||(M.y>=d?M=new $(M.x+(d-M.y)/(L.y-M.y)*(L.x-M.x),d)._round():L.y>=d&&(L=new $(M.x+(d-M.y)/(L.y-M.y)*(L.x-M.x),d)._round()),I&&M.equals(I[I.length-1])||(I=[M],g.push(I)),I.push(L)))))}}return g}yt("FeatureIndex",S0,{omit:["rawTileData","sourceLayerCoder"]});class Oo extends ${constructor(t,a,u,d){super(t,a),this.angle=u,d!==void 0&&(this.segment=d)}clone(){return new Oo(this.x,this.y,this.angle,this.segment)}}function A0(s,t,a,u,d){if(t.segment===void 0||a===0)return!0;let g=t,_=t.segment+1,x=0;for(;x>-a/2;){if(_--,_<0)return!1;x-=s[_].dist(g),g=s[_]}x+=s[_].dist(s[_+1]),_++;const I=[];let A=0;for(;x<a/2;){const M=s[_],L=s[_+1];if(!L)return!1;let F=s[_-1].angleTo(M)-M.angleTo(L);for(F=Math.abs((F+3*Math.PI)%(2*Math.PI)-Math.PI),I.push({distance:x,angleDelta:F}),A+=F;x-I[0].distance>u;)A-=I.shift().angleDelta;if(A>d)return!1;_++,x+=M.dist(L)}return!0}function E0(s){let t=0;for(let a=0;a<s.length-1;a++)t+=s[a].dist(s[a+1]);return t}function C0(s,t,a){return s?.6*t*a:0}function M0(s,t){return Math.max(s?s.right-s.left:0,t?t.right-t.left:0)}function aS(s,t,a,u,d,g){const _=C0(a,d,g),x=M0(a,u)*g;let I=0;const A=E0(s)/2;for(let M=0;M<s.length-1;M++){const L=s[M],F=s[M+1],U=L.dist(F);if(I+U>A){const V=(A-I)/U,Z=Wn.number(L.x,F.x,V),ee=Wn.number(L.y,F.y,V),ne=new Oo(Z,ee,F.angleTo(L),M);return ne._round(),!_||A0(s,ne,x,_,t)?ne:void 0}I+=U}}function oS(s,t,a,u,d,g,_,x,I){const A=C0(u,g,_),M=M0(u,d),L=M*_,F=s[0].x===0||s[0].x===I||s[0].y===0||s[0].y===I;return t-L<t/4&&(t=L+t/4),D0(s,F?t/2*x%t:(M/2+2*g)*_*x%t,t,A,a,L,F,!1,I)}function D0(s,t,a,u,d,g,_,x,I){const A=g/2,M=E0(s);let L=0,F=t-a,U=[];for(let V=0;V<s.length-1;V++){const Z=s[V],ee=s[V+1],ne=Z.dist(ee),ye=ee.angleTo(Z);for(;F+a<L+ne;){F+=a;const ce=(F-L)/ne,ve=Wn.number(Z.x,ee.x,ce),Ie=Wn.number(Z.y,ee.y,ce);if(ve>=0&&ve<I&&Ie>=0&&Ie<I&&F-A>=0&&F+A<=M){const Fe=new Oo(ve,Ie,ye,V);Fe._round(),u&&!A0(s,Fe,g,u,d)||U.push(Fe)}}L+=ne}return x||U.length||_||(U=D0(s,L/2,a,u,d,g,_,!0,I)),U}yt("Anchor",Oo);const Ic=Jn;function P0(s,t,a,u){const d=[],g=s.image,_=g.pixelRatio,x=g.paddedRect.w-2*Ic,I=g.paddedRect.h-2*Ic,A=s.right-s.left,M=s.bottom-s.top,L=g.stretchX||[[0,x]],F=g.stretchY||[[0,I]],U=(it,vt)=>it+vt[1]-vt[0],V=L.reduce(U,0),Z=F.reduce(U,0),ee=x-V,ne=I-Z;let ye=0,ce=V,ve=0,Ie=Z,Fe=0,pt=ee,Tt=0,lt=ne;if(g.content&&u){const it=g.content;ye=uf(L,0,it[0]),ve=uf(F,0,it[1]),ce=uf(L,it[0],it[2]),Ie=uf(F,it[1],it[3]),Fe=it[0]-ye,Tt=it[1]-ve,pt=it[2]-it[0]-ce,lt=it[3]-it[1]-Ie}const at=(it,vt,nt,Ye)=>{const Dt=hf(it.stretch-ye,ce,A,s.left),At=df(it.fixed-Fe,pt,it.stretch,V),fr=hf(vt.stretch-ve,Ie,M,s.top),ui=df(vt.fixed-Tt,lt,vt.stretch,Z),pi=hf(nt.stretch-ye,ce,A,s.left),en=df(nt.fixed-Fe,pt,nt.stretch,V),gs=hf(Ye.stretch-ve,Ie,M,s.top),Nn=df(Ye.fixed-Tt,lt,Ye.stretch,Z),Yi=new $(Dt,fr),pn=new $(pi,fr),In=new $(pi,gs),Un=new $(Dt,gs),$n=new $(At/_,ui/_),tn=new $(en/_,Nn/_),rn=t*Math.PI/180;if(rn){const Dn=Math.sin(rn),Qn=Math.cos(rn),es=[Qn,-Dn,Dn,Qn];Yi._matMult(es),pn._matMult(es),Un._matMult(es),In._matMult(es)}const Mn=it.stretch+it.fixed,Vn=vt.stretch+vt.fixed;return{tl:Yi,tr:pn,bl:Un,br:In,tex:{x:g.paddedRect.x+Ic+Mn,y:g.paddedRect.y+Ic+Vn,w:nt.stretch+nt.fixed-Mn,h:Ye.stretch+Ye.fixed-Vn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:$n,pixelOffsetBR:tn,minFontScaleX:pt/_/A,minFontScaleY:lt/_/M,isSDF:a}};if(u&&(g.stretchX||g.stretchY)){const it=L0(L,ee,V),vt=L0(F,ne,Z);for(let nt=0;nt<it.length-1;nt++){const Ye=it[nt],Dt=it[nt+1];for(let At=0;At<vt.length-1;At++)d.push(at(Ye,vt[At],Dt,vt[At+1]))}}else d.push(at({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:I+1}));return d}function uf(s,t,a){let u=0;for(const d of s)u+=Math.max(t,Math.min(a,d[1]))-Math.max(t,Math.min(a,d[0]));return u}function L0(s,t,a){const u=[{fixed:-Ic,stretch:0}];for(const[d,g]of s){const _=u[u.length-1];u.push({fixed:d-_.stretch,stretch:_.stretch}),u.push({fixed:d-_.stretch,stretch:_.stretch+(g-d)})}return u.push({fixed:t+Ic,stretch:a}),u}function hf(s,t,a,u){return s/t*a+u}function df(s,t,a,u){return s-t*a/u}class ff{constructor(t,a,u,d,g,_,x,I,A,M){if(this.boxStartIndex=t.length,A){let L=_.top,F=_.bottom;const U=_.collisionPadding;U&&(L-=U[1],F+=U[3]);let V=F-L;V>0&&(V=Math.max(10,V),this.circleDiameter=V)}else{let L=_.top*x-I[0],F=_.bottom*x+I[2],U=_.left*x-I[3],V=_.right*x+I[1];const Z=_.collisionPadding;if(Z&&(U-=Z[0]*x,L-=Z[1]*x,V+=Z[2]*x,F+=Z[3]*x),M){const ee=new $(U,L),ne=new $(V,L),ye=new $(U,F),ce=new $(V,F),ve=M*Math.PI/180;ee._rotate(ve),ne._rotate(ve),ye._rotate(ve),ce._rotate(ve),U=Math.min(ee.x,ne.x,ye.x,ce.x),V=Math.max(ee.x,ne.x,ye.x,ce.x),L=Math.min(ee.y,ne.y,ye.y,ce.y),F=Math.max(ee.y,ne.y,ye.y,ce.y)}t.emplaceBack(a.x,a.y,U,L,V,F,u,d,g)}this.boxEndIndex=t.length}}class lS{constructor(t=[],a=cS){if(this.data=t,this.length=this.data.length,this.compare=a,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:a,compare:u}=this,d=a[t];for(;t>0;){const g=t-1>>1,_=a[g];if(u(d,_)>=0)break;a[t]=_,t=g}a[t]=d}_down(t){const{data:a,compare:u}=this,d=this.length>>1,g=a[t];for(;t<d;){let _=1+(t<<1),x=a[_];const I=_+1;if(I<this.length&&u(a[I],x)<0&&(_=I,x=a[I]),u(x,g)>=0)break;a[t]=x,t=_}a[t]=g}}function cS(s,t){return s<t?-1:s>t?1:0}function uS(s,t=1,a=!1){let u=1/0,d=1/0,g=-1/0,_=-1/0;const x=s[0];for(let U=0;U<x.length;U++){const V=x[U];(!U||V.x<u)&&(u=V.x),(!U||V.y<d)&&(d=V.y),(!U||V.x>g)&&(g=V.x),(!U||V.y>_)&&(_=V.y)}const I=Math.min(g-u,_-d);let A=I/2;const M=new lS([],hS);if(I===0)return new $(u,d);for(let U=u;U<g;U+=I)for(let V=d;V<_;V+=I)M.push(new Tc(U+A,V+A,A,s));let L=function(U){let V=0,Z=0,ee=0;const ne=U[0];for(let ye=0,ce=ne.length,ve=ce-1;ye<ce;ve=ye++){const Ie=ne[ye],Fe=ne[ve],pt=Ie.x*Fe.y-Fe.x*Ie.y;Z+=(Ie.x+Fe.x)*pt,ee+=(Ie.y+Fe.y)*pt,V+=3*pt}return new Tc(Z/V,ee/V,0,U)}(s),F=M.length;for(;M.length;){const U=M.pop();(U.d>L.d||!L.d)&&(L=U,a&&console.log("found best %d after %d probes",Math.round(1e4*U.d)/1e4,F)),U.max-L.d<=t||(A=U.h/2,M.push(new Tc(U.p.x-A,U.p.y-A,A,s)),M.push(new Tc(U.p.x+A,U.p.y-A,A,s)),M.push(new Tc(U.p.x-A,U.p.y+A,A,s)),M.push(new Tc(U.p.x+A,U.p.y+A,A,s)),F+=4)}return a&&(console.log(`num probes: ${F}`),console.log(`best distance: ${L.d}`)),L.p}function hS(s,t){return t.max-s.max}function Tc(s,t,a,u){this.p=new $(s,t),this.h=a,this.d=function(d,g){let _=!1,x=1/0;for(let I=0;I<g.length;I++){const A=g[I];for(let M=0,L=A.length,F=L-1;M<L;F=M++){const U=A[M],V=A[F];U.y>d.y!=V.y>d.y&&d.x<(V.x-U.x)*(d.y-U.y)/(V.y-U.y)+U.x&&(_=!_),x=Math.min(x,m_(d,U,V))}}return(_?1:-1)*Math.sqrt(x)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}var Sn;c.aq=void 0,(Sn=c.aq||(c.aq={}))[Sn.center=1]="center",Sn[Sn.left=2]="left",Sn[Sn.right=3]="right",Sn[Sn.top=4]="top",Sn[Sn.bottom=5]="bottom",Sn[Sn["top-left"]=6]="top-left",Sn[Sn["top-right"]=7]="top-right",Sn[Sn["bottom-left"]=8]="bottom-left",Sn[Sn["bottom-right"]=9]="bottom-right";const No=7,Jm=Number.POSITIVE_INFINITY;function z0(s,t){return t[1]!==Jm?function(a,u,d){let g=0,_=0;switch(u=Math.abs(u),d=Math.abs(d),a){case"top-right":case"top-left":case"top":_=d-No;break;case"bottom-right":case"bottom-left":case"bottom":_=-d+No}switch(a){case"top-right":case"bottom-right":case"right":g=-u;break;case"top-left":case"bottom-left":case"left":g=u}return[g,_]}(s,t[0],t[1]):function(a,u){let d=0,g=0;u<0&&(u=0);const _=u/Math.SQRT2;switch(a){case"top-right":case"top-left":g=_-No;break;case"bottom-right":case"bottom-left":g=-_+No;break;case"bottom":g=-u+No;break;case"top":g=u-No}switch(a){case"top-right":case"bottom-right":d=-_;break;case"top-left":case"bottom-left":d=_;break;case"left":d=u;break;case"right":d=-u}return[d,g]}(s,t[0])}function B0(s,t,a){var u;const d=s.layout,g=(u=d.get("text-variable-anchor-offset"))===null||u===void 0?void 0:u.evaluate(t,{},a);if(g){const x=g.values,I=[];for(let A=0;A<x.length;A+=2){const M=I[A]=x[A],L=x[A+1].map(F=>F*Qi);M.startsWith("top")?L[1]-=No:M.startsWith("bottom")&&(L[1]+=No),I[A+1]=L}return new us(I)}const _=d.get("text-variable-anchor");if(_){let x;x=s._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[d.get("text-radial-offset").evaluate(t,{},a)*Qi,Jm]:d.get("text-offset").evaluate(t,{},a).map(A=>A*Qi);const I=[];for(const A of _)I.push(A,z0(A,x));return new us(I)}return null}function Qm(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function dS(s,t,a,u,d,g,_,x,I,A,M){let L=g.textMaxSize.evaluate(t,{});L===void 0&&(L=_);const F=s.layers[0].layout,U=F.get("icon-offset").evaluate(t,{},M),V=F0(a.horizontal),Z=_/24,ee=s.tilePixelRatio*Z,ne=s.tilePixelRatio*L/24,ye=s.tilePixelRatio*x,ce=s.tilePixelRatio*F.get("symbol-spacing"),ve=F.get("text-padding")*s.tilePixelRatio,Ie=function(Ye,Dt,At,fr=1){const ui=Ye.get("icon-padding").evaluate(Dt,{},At),pi=ui&&ui.values;return[pi[0]*fr,pi[1]*fr,pi[2]*fr,pi[3]*fr]}(F,t,M,s.tilePixelRatio),Fe=F.get("text-max-angle")/180*Math.PI,pt=F.get("text-rotation-alignment")!=="viewport"&&F.get("symbol-placement")!=="point",Tt=F.get("icon-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",lt=F.get("symbol-placement"),at=ce/2,it=F.get("icon-text-fit");let vt;u&&it!=="none"&&(s.allowVerticalPlacement&&a.vertical&&(vt=s0(u,a.vertical,it,F.get("icon-text-fit-padding"),U,Z)),V&&(u=s0(u,V,it,F.get("icon-text-fit-padding"),U,Z)));const nt=(Ye,Dt)=>{Dt.x<0||Dt.x>=Hi||Dt.y<0||Dt.y>=Hi||function(At,fr,ui,pi,en,gs,Nn,Yi,pn,In,Un,$n,tn,rn,Mn,Vn,Dn,Qn,es,nn,xr,Pn,Tn,sn,$s){const sa=At.addToLineVertexArray(fr,ui);let aa,io,Vs,ks,ts=0,no=0,gh=0,$0=0,og=-1,lg=-1;const so={};let V0=Qa("");if(At.allowVerticalPlacement&&pi.vertical){const Ln=Yi.layout.get("text-rotate").evaluate(xr,{},sn)+90;Vs=new ff(pn,fr,In,Un,$n,pi.vertical,tn,rn,Mn,Ln),Nn&&(ks=new ff(pn,fr,In,Un,$n,Nn,Dn,Qn,Mn,Ln))}if(en){const Ln=Yi.layout.get("icon-rotate").evaluate(xr,{}),As=Yi.layout.get("icon-text-fit")!=="none",wl=P0(en,Ln,Tn,As),la=Nn?P0(Nn,Ln,Tn,As):void 0;io=new ff(pn,fr,In,Un,$n,en,Dn,Qn,!1,Ln),ts=4*wl.length;const Sl=At.iconSizeData;let ka=null;Sl.kind==="source"?(ka=[Ta*Yi.layout.get("icon-size").evaluate(xr,{})],ka[0]>Ro&&$e(`${At.layerIds[0]}: Value for "icon-size" is >= ${dh}. Reduce your "icon-size".`)):Sl.kind==="composite"&&(ka=[Ta*Pn.compositeIconSizes[0].evaluate(xr,{},sn),Ta*Pn.compositeIconSizes[1].evaluate(xr,{},sn)],(ka[0]>Ro||ka[1]>Ro)&&$e(`${At.layerIds[0]}: Value for "icon-size" is >= ${dh}. Reduce your "icon-size".`)),At.addSymbols(At.icon,wl,ka,nn,es,xr,c.ai.none,fr,sa.lineStartIndex,sa.lineLength,-1,sn),og=At.icon.placedSymbolArray.length-1,la&&(no=4*la.length,At.addSymbols(At.icon,la,ka,nn,es,xr,c.ai.vertical,fr,sa.lineStartIndex,sa.lineLength,-1,sn),lg=At.icon.placedSymbolArray.length-1)}const j0=Object.keys(pi.horizontal);for(const Ln of j0){const As=pi.horizontal[Ln];if(!aa){V0=Qa(As.text);const la=Yi.layout.get("text-rotate").evaluate(xr,{},sn);aa=new ff(pn,fr,In,Un,$n,As,tn,rn,Mn,la)}const wl=As.positionedLines.length===1;if(gh+=R0(At,fr,As,gs,Yi,Mn,xr,Vn,sa,pi.vertical?c.ai.horizontal:c.ai.horizontalOnly,wl?j0:[Ln],so,og,Pn,sn),wl)break}pi.vertical&&($0+=R0(At,fr,pi.vertical,gs,Yi,Mn,xr,Vn,sa,c.ai.vertical,["vertical"],so,lg,Pn,sn));const mS=aa?aa.boxStartIndex:At.collisionBoxArray.length,gS=aa?aa.boxEndIndex:At.collisionBoxArray.length,yS=Vs?Vs.boxStartIndex:At.collisionBoxArray.length,_S=Vs?Vs.boxEndIndex:At.collisionBoxArray.length,vS=io?io.boxStartIndex:At.collisionBoxArray.length,bS=io?io.boxEndIndex:At.collisionBoxArray.length,xS=ks?ks.boxStartIndex:At.collisionBoxArray.length,wS=ks?ks.boxEndIndex:At.collisionBoxArray.length;let oa=-1;const mf=(Ln,As)=>Ln&&Ln.circleDiameter?Math.max(Ln.circleDiameter,As):As;oa=mf(aa,oa),oa=mf(Vs,oa),oa=mf(io,oa),oa=mf(ks,oa);const q0=oa>-1?1:0;q0&&(oa*=$s/Qi),At.glyphOffsetArray.length>=Sc.MAX_GLYPHS&&$e("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),xr.sortKey!==void 0&&At.addToSortKeyRanges(At.symbolInstances.length,xr.sortKey);const SS=B0(Yi,xr,sn),[IS,TS]=function(Ln,As){const wl=Ln.length,la=As==null?void 0:As.values;if((la==null?void 0:la.length)>0)for(let Sl=0;Sl<la.length;Sl+=2){const ka=la[Sl+1];Ln.emplaceBack(c.aq[la[Sl]],ka[0],ka[1])}return[wl,Ln.length]}(At.textAnchorOffsets,SS);At.symbolInstances.emplaceBack(fr.x,fr.y,so.right>=0?so.right:-1,so.center>=0?so.center:-1,so.left>=0?so.left:-1,so.vertical||-1,og,lg,V0,mS,gS,yS,_S,vS,bS,xS,wS,In,gh,$0,ts,no,q0,0,tn,oa,IS,TS)}(s,Dt,Ye,a,u,d,vt,s.layers[0],s.collisionBoxArray,t.index,t.sourceLayerIndex,s.index,ee,[ve,ve,ve,ve],pt,I,ye,Ie,Tt,U,t,g,A,M,_)};if(lt==="line")for(const Ye of k0(t.geometry,0,0,Hi,Hi)){const Dt=oS(Ye,ce,Fe,a.vertical||V,u,24,ne,s.overscaling,Hi);for(const At of Dt)V&&fS(s,V.text,at,At)||nt(Ye,At)}else if(lt==="line-center"){for(const Ye of t.geometry)if(Ye.length>1){const Dt=aS(Ye,Fe,a.vertical||V,u,24,ne);Dt&&nt(Ye,Dt)}}else if(t.type==="Polygon")for(const Ye of Dm(t.geometry,0)){const Dt=uS(Ye,16);nt(Ye[0],new Oo(Dt.x,Dt.y,0))}else if(t.type==="LineString")for(const Ye of t.geometry)nt(Ye,new Oo(Ye[0].x,Ye[0].y,0));else if(t.type==="Point")for(const Ye of t.geometry)for(const Dt of Ye)nt([Dt],new Oo(Dt.x,Dt.y,0))}function R0(s,t,a,u,d,g,_,x,I,A,M,L,F,U,V){const Z=function(ye,ce,ve,Ie,Fe,pt,Tt,lt){const at=Ie.layout.get("text-rotate").evaluate(pt,{})*Math.PI/180,it=[];for(const vt of ce.positionedLines)for(const nt of vt.positionedGlyphs){if(!nt.rect)continue;const Ye=nt.rect||{};let Dt=J_+1,At=!0,fr=1,ui=0;const pi=(Fe||lt)&&nt.vertical,en=nt.metrics.advance*nt.scale/2;if(lt&&ce.verticalizable&&(ui=vt.lineOffset/2-(nt.imageName?-(Qi-nt.metrics.width*nt.scale)/2:(nt.scale-1)*Qi)),nt.imageName){const nn=Tt[nt.imageName];At=nn.sdf,fr=nn.pixelRatio,Dt=Jn/fr}const gs=Fe?[nt.x+en,nt.y]:[0,0];let Nn=Fe?[0,0]:[nt.x+en+ve[0],nt.y+ve[1]-ui],Yi=[0,0];pi&&(Yi=Nn,Nn=[0,0]);const pn=nt.metrics.isDoubleResolution?2:1,In=(nt.metrics.left-Dt)*nt.scale-en+Nn[0],Un=(-nt.metrics.top-Dt)*nt.scale+Nn[1],$n=In+Ye.w/pn*nt.scale/fr,tn=Un+Ye.h/pn*nt.scale/fr,rn=new $(In,Un),Mn=new $($n,Un),Vn=new $(In,tn),Dn=new $($n,tn);if(pi){const nn=new $(-en,en-uh),xr=-Math.PI/2,Pn=Qi/2-en,Tn=new $(5-uh-Pn,-(nt.imageName?Pn:0)),sn=new $(...Yi);rn._rotateAround(xr,nn)._add(Tn)._add(sn),Mn._rotateAround(xr,nn)._add(Tn)._add(sn),Vn._rotateAround(xr,nn)._add(Tn)._add(sn),Dn._rotateAround(xr,nn)._add(Tn)._add(sn)}if(at){const nn=Math.sin(at),xr=Math.cos(at),Pn=[xr,-nn,nn,xr];rn._matMult(Pn),Mn._matMult(Pn),Vn._matMult(Pn),Dn._matMult(Pn)}const Qn=new $(0,0),es=new $(0,0);it.push({tl:rn,tr:Mn,bl:Vn,br:Dn,tex:Ye,writingMode:ce.writingMode,glyphOffset:gs,sectionIndex:nt.sectionIndex,isSDF:At,pixelOffsetTL:Qn,pixelOffsetBR:es,minFontScaleX:0,minFontScaleY:0})}return it}(0,a,x,d,g,_,u,s.allowVerticalPlacement),ee=s.textSizeData;let ne=null;ee.kind==="source"?(ne=[Ta*d.layout.get("text-size").evaluate(_,{})],ne[0]>Ro&&$e(`${s.layerIds[0]}: Value for "text-size" is >= ${dh}. Reduce your "text-size".`)):ee.kind==="composite"&&(ne=[Ta*U.compositeTextSizes[0].evaluate(_,{},V),Ta*U.compositeTextSizes[1].evaluate(_,{},V)],(ne[0]>Ro||ne[1]>Ro)&&$e(`${s.layerIds[0]}: Value for "text-size" is >= ${dh}. Reduce your "text-size".`)),s.addSymbols(s.text,Z,ne,x,g,_,A,t,I.lineStartIndex,I.lineLength,F,V);for(const ye of M)L[ye]=s.text.placedSymbolArray.length-1;return 4*Z.length}function F0(s){for(const t in s)return s[t];return null}function fS(s,t,a,u){const d=s.compareText;if(t in d){const g=d[t];for(let _=g.length-1;_>=0;_--)if(u.dist(g[_])<a)return!0}else d[t]=[];return d[t].push(u),!1}const O0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class eg{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,u]=new Uint8Array(t,0,2);if(a!==219)throw new Error("Data does not appear to be in a KDBush format.");const d=u>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);const g=O0[15&u];if(!g)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(t,2,1),[x]=new Uint32Array(t,4,1);return new eg(x,_,g,t)}constructor(t,a=64,u=Float64Array,d){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=u,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const g=O0.indexOf(this.ArrayType),_=2*t*this.ArrayType.BYTES_PER_ELEMENT,x=t*this.IndexArrayType.BYTES_PER_ELEMENT,I=(8-x%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${u}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+x+I,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+_+x+I),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+x+I,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=t)}add(t,a){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=t,this.coords[this._pos++]=a,u}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return tg(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,a,u,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:_,nodeSize:x}=this,I=[0,g.length-1,0],A=[];for(;I.length;){const M=I.pop()||0,L=I.pop()||0,F=I.pop()||0;if(L-F<=x){for(let ee=F;ee<=L;ee++){const ne=_[2*ee],ye=_[2*ee+1];ne>=t&&ne<=u&&ye>=a&&ye<=d&&A.push(g[ee])}continue}const U=F+L>>1,V=_[2*U],Z=_[2*U+1];V>=t&&V<=u&&Z>=a&&Z<=d&&A.push(g[U]),(M===0?t<=V:a<=Z)&&(I.push(F),I.push(U-1),I.push(1-M)),(M===0?u>=V:d>=Z)&&(I.push(U+1),I.push(L),I.push(1-M))}return A}within(t,a,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:g,nodeSize:_}=this,x=[0,d.length-1,0],I=[],A=u*u;for(;x.length;){const M=x.pop()||0,L=x.pop()||0,F=x.pop()||0;if(L-F<=_){for(let ee=F;ee<=L;ee++)U0(g[2*ee],g[2*ee+1],t,a)<=A&&I.push(d[ee]);continue}const U=F+L>>1,V=g[2*U],Z=g[2*U+1];U0(V,Z,t,a)<=A&&I.push(d[U]),(M===0?t-u<=V:a-u<=Z)&&(x.push(F),x.push(U-1),x.push(1-M)),(M===0?t+u>=V:a+u>=Z)&&(x.push(U+1),x.push(L),x.push(1-M))}return I}}function tg(s,t,a,u,d,g){if(d-u<=a)return;const _=u+d>>1;N0(s,t,_,u,d,g),tg(s,t,a,u,_-1,1-g),tg(s,t,a,_+1,d,1-g)}function N0(s,t,a,u,d,g){for(;d>u;){if(d-u>600){const A=d-u+1,M=a-u+1,L=Math.log(A),F=.5*Math.exp(2*L/3),U=.5*Math.sqrt(L*F*(A-F)/A)*(M-A/2<0?-1:1);N0(s,t,a,Math.max(u,Math.floor(a-M*F/A+U)),Math.min(d,Math.floor(a+(A-M)*F/A+U)),g)}const _=t[2*a+g];let x=u,I=d;for(ph(s,t,u,a),t[2*d+g]>_&&ph(s,t,u,d);x<I;){for(ph(s,t,x,I),x++,I--;t[2*x+g]<_;)x++;for(;t[2*I+g]>_;)I--}t[2*u+g]===_?ph(s,t,u,I):(I++,ph(s,t,I,d)),I<=a&&(u=I+1),a<=I&&(d=I-1)}}function ph(s,t,a,u){rg(s,a,u),rg(t,2*a,2*u),rg(t,2*a+1,2*u+1)}function rg(s,t,a){const u=s[t];s[t]=s[a],s[a]=u}function U0(s,t,a,u){const d=s-a,g=t-u;return d*d+g*g}var ig;c.bh=void 0,(ig=c.bh||(c.bh={})).create="create",ig.load="load",ig.fullLoad="fullLoad";let pf=null,mh=[];const ng=1e3/60,sg="loadTime",ag="fullLoadTime",pS={mark(s){performance.mark(s)},frame(s){const t=s;pf!=null&&mh.push(t-pf),pf=t},clearMetrics(){pf=null,mh=[],performance.clearMeasures(sg),performance.clearMeasures(ag);for(const s in c.bh)performance.clearMarks(c.bh[s])},getPerformanceMetrics(){performance.measure(sg,c.bh.create,c.bh.load),performance.measure(ag,c.bh.create,c.bh.fullLoad);const s=performance.getEntriesByName(sg)[0].duration,t=performance.getEntriesByName(ag)[0].duration,a=mh.length,u=1/(mh.reduce((g,_)=>g+_,0)/a/1e3),d=mh.filter(g=>g>ng).reduce((g,_)=>g+(_-ng)/ng,0);return{loadTime:s,fullLoadTime:t,fps:u,percentDroppedFrames:d/(a+d)*100,totalFrames:a}}};c.$=function(s,t,a){var u,d,g,_,x,I,A,M,L,F,U,V,Z=a[0],ee=a[1],ne=a[2];return t===s?(s[12]=t[0]*Z+t[4]*ee+t[8]*ne+t[12],s[13]=t[1]*Z+t[5]*ee+t[9]*ne+t[13],s[14]=t[2]*Z+t[6]*ee+t[10]*ne+t[14],s[15]=t[3]*Z+t[7]*ee+t[11]*ne+t[15]):(d=t[1],g=t[2],_=t[3],x=t[4],I=t[5],A=t[6],M=t[7],L=t[8],F=t[9],U=t[10],V=t[11],s[0]=u=t[0],s[1]=d,s[2]=g,s[3]=_,s[4]=x,s[5]=I,s[6]=A,s[7]=M,s[8]=L,s[9]=F,s[10]=U,s[11]=V,s[12]=u*Z+x*ee+L*ne+t[12],s[13]=d*Z+I*ee+F*ne+t[13],s[14]=g*Z+A*ee+U*ne+t[14],s[15]=_*Z+M*ee+V*ne+t[15]),s},c.A=yc,c.B=Wn,c.C=class{constructor(s,t,a){this.receive=u=>{const d=u.data,g=d.id;if(g&&(!d.targetMapId||this.mapId===d.targetMapId))if(d.type==="<cancel>"){delete this.tasks[g];const _=this.cancelCallbacks[g];delete this.cancelCallbacks[g],_&&_()}else gt()||d.mustQueue?(this.tasks[g]=d,this.taskQueue.push(g),this.invoker.trigger()):this.processTask(g,d)},this.process=()=>{if(!this.taskQueue.length)return;const u=this.taskQueue.shift(),d=this.tasks[u];delete this.tasks[u],this.taskQueue.length&&this.invoker.trigger(),d&&this.processTask(u,d)},this.target=s,this.parent=t,this.mapId=a,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new nS(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=gt()?s:window}send(s,t,a,u,d=!1){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(this.callbacks[g]=a);const _=[],x={id:g,type:s,hasCallback:!!a,targetMapId:u,mustQueue:d,sourceMapId:this.mapId,data:wa(t,_)};return this.target.postMessage(x,{transfer:_}),{cancel:()=>{a&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}processTask(s,t){if(t.type==="<response>"){const a=this.callbacks[s];delete this.callbacks[s],a&&(t.error?a(Mo(t.error)):a(null,Mo(t.data)))}else{let a=!1;const u=[],d=t.hasCallback?(x,I)=>{a=!0,delete this.cancelCallbacks[s];const A={id:s,type:"<response>",sourceMapId:this.mapId,error:x?wa(x):null,data:wa(I,u)};this.target.postMessage(A,{transfer:u})}:x=>{a=!0};let g=null;const _=Mo(t.data);if(this.parent[t.type])g=this.parent[t.type](t.sourceMapId,_,d);else if("getWorkerSource"in this.parent){const x=t.type.split(".");g=this.parent.getWorkerSource(t.sourceMapId,x[0],_.source)[x[1]](_,d)}else d(new Error(`Could not find function ${t.type}`));!a&&g&&g.cancel&&(this.cancelCallbacks[s]=g.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},c.D=Et,c.E=Mi,c.F=function(s,t){const a={};for(let u=0;u<t.length;u++){const d=t[u];d in s&&(a[d]=s[d])}return a},c.G=p0,c.H=m0,c.I=$m,c.J=be,c.K=fe,c.L=Fo,c.M=er,c.N=Hi,c.O=Ts,c.P=$,c.Q=xi,c.R=Is,c.S=ci,c.T=Vd,c.U=cf,c.V=class extends Xa{},c.W=Xm,c.X=function(s,t){const a=window.document.createElement("video");a.muted=!0,a.onloadstart=function(){t(null,a)};for(let u=0;u<s.length;u++){const d=window.document.createElement("source");br(s[u])||(a.crossOrigin="Anonymous"),d.src=s[u],a.appendChild(d)}return{cancel:()=>{}}},c.Y=Ke,c.Z=function(){var s=new yc(16);return yc!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},c._=E,c.a=ht,c.a$=class extends N{},c.a0=function(s,t,a){var u=a[0],d=a[1],g=a[2];return s[0]=t[0]*u,s[1]=t[1]*u,s[2]=t[2]*u,s[3]=t[3]*u,s[4]=t[4]*d,s[5]=t[5]*d,s[6]=t[6]*d,s[7]=t[7]*d,s[8]=t[8]*g,s[9]=t[9]*g,s[10]=t[10]*g,s[11]=t[11]*g,s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15],s},c.a1=v_,c.a2=function(){return Ve++},c.a3=X,c.a4=Sc,c.a5=function(){Kn.isLoading()||Kn.isLoaded()||ju()!=="deferred"||$d()},c.a6=Pu,c.a7=bl,c.a8=li,c.a9=w0,c.aA=pl,c.aB=function(s){s=s.slice();const t=Object.create(null);for(let a=0;a<s.length;a++)t[s[a].id]=s[a];for(let a=0;a<s.length;a++)"ref"in s[a]&&(s[a]=Si(s[a],t[s[a].ref]));return s},c.aC=function(s){if(s.type==="custom")return new iS(s);switch(s.type){case"background":return new eS(s);case"circle":return new Nw(s);case"fill":return new s2(s);case"fill-extrusion":return new b2(s);case"heatmap":return new $w(s);case"hillshade":return new jw(s);case"line":return new E2(s);case"raster":return new rS(s);case"symbol":return new lf(s)}},c.aD=Ze,c.aE=function(s,t){if(!s)return[{command:$t.setStyle,args:[t]}];let a=[];try{if(!mr(s.version,t.version))return[{command:$t.setStyle,args:[t]}];mr(s.center,t.center)||a.push({command:$t.setCenter,args:[t.center]}),mr(s.zoom,t.zoom)||a.push({command:$t.setZoom,args:[t.zoom]}),mr(s.bearing,t.bearing)||a.push({command:$t.setBearing,args:[t.bearing]}),mr(s.pitch,t.pitch)||a.push({command:$t.setPitch,args:[t.pitch]}),mr(s.sprite,t.sprite)||a.push({command:$t.setSprite,args:[t.sprite]}),mr(s.glyphs,t.glyphs)||a.push({command:$t.setGlyphs,args:[t.glyphs]}),mr(s.transition,t.transition)||a.push({command:$t.setTransition,args:[t.transition]}),mr(s.light,t.light)||a.push({command:$t.setLight,args:[t.light]});const u={},d=[];(function(_,x,I,A){let M;for(M in x=x||{},_=_||{})Object.prototype.hasOwnProperty.call(_,M)&&(Object.prototype.hasOwnProperty.call(x,M)||Di(M,I,A));for(M in x)Object.prototype.hasOwnProperty.call(x,M)&&(Object.prototype.hasOwnProperty.call(_,M)?mr(_[M],x[M])||(_[M].type==="geojson"&&x[M].type==="geojson"&&on(_,x,M)?I.push({command:$t.setGeoJSONSourceData,args:[M,x[M].data]}):Zi(M,x,I,A)):yi(M,x,I))})(s.sources,t.sources,d,u);const g=[];s.layers&&s.layers.forEach(_=>{u[_.source]?a.push({command:$t.removeLayer,args:[_.id]}):g.push(_)}),a=a.concat(d),function(_,x,I){x=x||[];const A=(_=_||[]).map(oi),M=x.map(oi),L=_.reduce(Ki,{}),F=x.reduce(Ki,{}),U=A.slice(),V=Object.create(null);let Z,ee,ne,ye,ce,ve,Ie;for(Z=0,ee=0;Z<A.length;Z++)ne=A[Z],Object.prototype.hasOwnProperty.call(F,ne)?ee++:(I.push({command:$t.removeLayer,args:[ne]}),U.splice(U.indexOf(ne,ee),1));for(Z=0,ee=0;Z<M.length;Z++)ne=M[M.length-1-Z],U[U.length-1-Z]!==ne&&(Object.prototype.hasOwnProperty.call(L,ne)?(I.push({command:$t.removeLayer,args:[ne]}),U.splice(U.lastIndexOf(ne,U.length-ee),1)):ee++,ve=U[U.length-Z],I.push({command:$t.addLayer,args:[F[ne],ve]}),U.splice(U.length-Z,0,ne),V[ne]=!0);for(Z=0;Z<M.length;Z++)if(ne=M[Z],ye=L[ne],ce=F[ne],!V[ne]&&!mr(ye,ce))if(mr(ye.source,ce.source)&&mr(ye["source-layer"],ce["source-layer"])&&mr(ye.type,ce.type)){for(Ie in ln(ye.layout,ce.layout,I,ne,null,$t.setLayoutProperty),ln(ye.paint,ce.paint,I,ne,null,$t.setPaintProperty),mr(ye.filter,ce.filter)||I.push({command:$t.setFilter,args:[ne,ce.filter]}),mr(ye.minzoom,ce.minzoom)&&mr(ye.maxzoom,ce.maxzoom)||I.push({command:$t.setLayerZoomRange,args:[ne,ce.minzoom,ce.maxzoom]}),ye)Object.prototype.hasOwnProperty.call(ye,Ie)&&Ie!=="layout"&&Ie!=="paint"&&Ie!=="filter"&&Ie!=="metadata"&&Ie!=="minzoom"&&Ie!=="maxzoom"&&(Ie.indexOf("paint.")===0?ln(ye[Ie],ce[Ie],I,ne,Ie.slice(6),$t.setPaintProperty):mr(ye[Ie],ce[Ie])||I.push({command:$t.setLayerProperty,args:[ne,Ie,ce[Ie]]}));for(Ie in ce)Object.prototype.hasOwnProperty.call(ce,Ie)&&!Object.prototype.hasOwnProperty.call(ye,Ie)&&Ie!=="layout"&&Ie!=="paint"&&Ie!=="filter"&&Ie!=="metadata"&&Ie!=="minzoom"&&Ie!=="maxzoom"&&(Ie.indexOf("paint.")===0?ln(ye[Ie],ce[Ie],I,ne,Ie.slice(6),$t.setPaintProperty):mr(ye[Ie],ce[Ie])||I.push({command:$t.setLayerProperty,args:[ne,Ie,ce[Ie]]}))}else I.push({command:$t.removeLayer,args:[ne]}),ve=U[U.lastIndexOf(ne)+1],I.push({command:$t.addLayer,args:[ce,ve]})}(g,t.layers,a)}catch(u){console.warn("Unable to compute style diff:",u),a=[{command:$t.setStyle,args:[t]}]}return a},c.aF=function(s){const t=[],a=s.id;return a===void 0&&t.push({message:`layers.${a}: missing required property "id"`}),s.render===void 0&&t.push({message:`layers.${a}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&t.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),t},c.aG=function s(t,a){if(Array.isArray(t)){if(!Array.isArray(a)||t.length!==a.length)return!1;for(let u=0;u<t.length;u++)if(!s(t[u],a[u]))return!1;return!0}if(typeof t=="object"&&t!==null&&a!==null){if(typeof a!="object"||Object.keys(t).length!==Object.keys(a).length)return!1;for(const u in t)if(!s(t[u],a[u]))return!1;return!0}return t===a},c.aH=De,c.aI=qe,c.aJ=ml,c.aK=function(s){return s({pluginStatus:Rn,pluginURL:Sa}),ml.on("pluginStateChange",s),s},c.aL=class extends eo{constructor(s,t){super(s,t),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},c.aM=mc,c.aN=class extends eo{constructor(s,t){super(s,t),this.current=vm}set(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let t=1;t<16;t++)if(s[t]!==this.current[t]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}},c.aO=Zd,c.aP=class extends eo{constructor(s,t){super(s,t),this.current=[0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))}},c.aQ=class extends eo{constructor(s,t){super(s,t),this.current=[0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))}},c.aR=Wd,c.aS=function(s,t,a,u,d,g,_){var x=1/(t-a),I=1/(u-d),A=1/(g-_);return s[0]=-2*x,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*I,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*A,s[11]=0,s[12]=(t+a)*x,s[13]=(d+u)*I,s[14]=(_+g)*A,s[15]=1,s},c.aT=jr,c.aU=Ow,c.aV=class extends h{},c.aW=P2,c.aX=class extends y{},c.aY=function(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))},c.aZ=I_,c.a_=tt,c.aa=function(s){const t={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,u,d,g)=>{const _=d||g;return t[u]=!_||_.toLowerCase(),""}),t["max-age"]){const a=parseInt(t["max-age"],10);isNaN(a)?delete t["max-age"]:t["max-age"]=a}return t},c.ab=function(s,t){const a=[];for(const u in s)u in t||a.push(u);return a},c.ac=function(s){if(Ne==null){const t=s.navigator?s.navigator.userAgent:null;Ne=!!s.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Ne},c.ad=Me,c.ae=function(s,t,a){var u=Math.sin(a),d=Math.cos(a),g=t[0],_=t[1],x=t[2],I=t[3],A=t[4],M=t[5],L=t[6],F=t[7];return t!==s&&(s[8]=t[8],s[9]=t[9],s[10]=t[10],s[11]=t[11],s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]),s[0]=g*d+A*u,s[1]=_*d+M*u,s[2]=x*d+L*u,s[3]=I*d+F*u,s[4]=A*d-g*u,s[5]=M*d-_*u,s[6]=L*d-x*u,s[7]=F*d-I*u,s},c.af=function(s){var t=new yc(16);return t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t[4]=s[4],t[5]=s[5],t[6]=s[6],t[7]=s[7],t[8]=s[8],t[9]=s[9],t[10]=s[10],t[11]=s[11],t[12]=s[12],t[13]=s[13],t[14]=s[14],t[15]=s[15],t},c.ag=Xd,c.ah=function(s,t){let a=0,u=0;if(s.kind==="constant")u=s.layoutSize;else if(s.kind!=="source"){const{interpolationType:d,minZoom:g,maxZoom:_}=s,x=d?Me(Hn.interpolationFactor(d,t,g,_),0,1):0;s.kind==="camera"?u=Wn.number(s.minSize,s.maxSize,x):a=x}return{uSizeT:a,uSize:u}},c.aj=function(s,{uSize:t,uSizeT:a},{lowerSize:u,upperSize:d}){return s.kind==="source"?u/Ta:s.kind==="composite"?Wn.number(u/Ta,d/Ta,a):t},c.ak=Gm,c.al=function(s,t,a,u){const d=t.y-s.y,g=t.x-s.x,_=u.y-a.y,x=u.x-a.x,I=_*g-x*d;if(I===0)return null;const A=(x*(s.y-a.y)-_*(s.x-a.x))/I;return new $(s.x+A*g,s.y+A*d)},c.am=k0,c.an=f_,c.ao=Im,c.ap=Qi,c.ar=qm,c.as=function(s,t){var a=t[0],u=t[1],d=t[2],g=t[3],_=t[4],x=t[5],I=t[6],A=t[7],M=t[8],L=t[9],F=t[10],U=t[11],V=t[12],Z=t[13],ee=t[14],ne=t[15],ye=a*x-u*_,ce=a*I-d*_,ve=a*A-g*_,Ie=u*I-d*x,Fe=u*A-g*x,pt=d*A-g*I,Tt=M*Z-L*V,lt=M*ee-F*V,at=M*ne-U*V,it=L*ee-F*Z,vt=L*ne-U*Z,nt=F*ne-U*ee,Ye=ye*nt-ce*vt+ve*it+Ie*at-Fe*lt+pt*Tt;return Ye?(s[0]=(x*nt-I*vt+A*it)*(Ye=1/Ye),s[1]=(d*vt-u*nt-g*it)*Ye,s[2]=(Z*pt-ee*Fe+ne*Ie)*Ye,s[3]=(F*Fe-L*pt-U*Ie)*Ye,s[4]=(I*at-_*nt-A*lt)*Ye,s[5]=(a*nt-d*at+g*lt)*Ye,s[6]=(ee*ve-V*pt-ne*ce)*Ye,s[7]=(M*pt-F*ve+U*ce)*Ye,s[8]=(_*vt-x*at+A*Tt)*Ye,s[9]=(u*at-a*vt-g*Tt)*Ye,s[10]=(V*Fe-Z*ve+ne*ye)*Ye,s[11]=(L*ve-M*Fe-U*ye)*Ye,s[12]=(x*lt-_*it-I*Tt)*Ye,s[13]=(a*it-u*lt+d*Tt)*Ye,s[14]=(Z*ce-V*Ie-ee*ye)*Ye,s[15]=(M*Ie-L*ce+F*ye)*Ye,s):null},c.at=Qm,c.au=jm,c.av=eg,c.aw=function(){const s={},t=Ce.$version;for(const a in Ce.$root){const u=Ce.$root[a];if(u.required){let d=null;d=a==="version"?t:u.type==="array"?[]:{},d!=null&&(s[a]=d)}}return s},c.ax=$t,c.ay=Fd,c.az=Pt,c.b=function(s,t){const a=new Blob([new Uint8Array(s)],{type:"image/png"});createImageBitmap(a).then(u=>{t(null,u)}).catch(u=>{t(new Error(`Could not load image because of ${u.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},c.b0=dn,c.b1=function(s,t){var a=s[0],u=s[1],d=s[2],g=s[3],_=s[4],x=s[5],I=s[6],A=s[7],M=s[8],L=s[9],F=s[10],U=s[11],V=s[12],Z=s[13],ee=s[14],ne=s[15],ye=t[0],ce=t[1],ve=t[2],Ie=t[3],Fe=t[4],pt=t[5],Tt=t[6],lt=t[7],at=t[8],it=t[9],vt=t[10],nt=t[11],Ye=t[12],Dt=t[13],At=t[14],fr=t[15];return Math.abs(a-ye)<=On*Math.max(1,Math.abs(a),Math.abs(ye))&&Math.abs(u-ce)<=On*Math.max(1,Math.abs(u),Math.abs(ce))&&Math.abs(d-ve)<=On*Math.max(1,Math.abs(d),Math.abs(ve))&&Math.abs(g-Ie)<=On*Math.max(1,Math.abs(g),Math.abs(Ie))&&Math.abs(_-Fe)<=On*Math.max(1,Math.abs(_),Math.abs(Fe))&&Math.abs(x-pt)<=On*Math.max(1,Math.abs(x),Math.abs(pt))&&Math.abs(I-Tt)<=On*Math.max(1,Math.abs(I),Math.abs(Tt))&&Math.abs(A-lt)<=On*Math.max(1,Math.abs(A),Math.abs(lt))&&Math.abs(M-at)<=On*Math.max(1,Math.abs(M),Math.abs(at))&&Math.abs(L-it)<=On*Math.max(1,Math.abs(L),Math.abs(it))&&Math.abs(F-vt)<=On*Math.max(1,Math.abs(F),Math.abs(vt))&&Math.abs(U-nt)<=On*Math.max(1,Math.abs(U),Math.abs(nt))&&Math.abs(V-Ye)<=On*Math.max(1,Math.abs(V),Math.abs(Ye))&&Math.abs(Z-Dt)<=On*Math.max(1,Math.abs(Z),Math.abs(Dt))&&Math.abs(ee-At)<=On*Math.max(1,Math.abs(ee),Math.abs(At))&&Math.abs(ne-fr)<=On*Math.max(1,Math.abs(ne),Math.abs(fr))},c.b2=function(s,t){return s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=t[3],s[4]=t[4],s[5]=t[5],s[6]=t[6],s[7]=t[7],s[8]=t[8],s[9]=t[9],s[10]=t[10],s[11]=t[11],s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15],s},c.b3=function(s,t,a){return s[0]=t[0]*a[0],s[1]=t[1]*a[1],s[2]=t[2]*a[2],s[3]=t[3]*a[3],s},c.b4=function(s,t){return s[0]*t[0]+s[1]*t[1]+s[2]*t[2]+s[3]*t[3]},c.b5=Ge,c.b6=v0,c.b7=g0,c.b8=function(s,t,a,u,d){var g,_=1/Math.tan(t/2);return s[0]=_/a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=_,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,d!=null&&d!==1/0?(s[10]=(d+u)*(g=1/(u-d)),s[14]=2*d*u*g):(s[10]=-1,s[14]=-2*u),s},c.b9=function(s,t,a){var u=Math.sin(a),d=Math.cos(a),g=t[4],_=t[5],x=t[6],I=t[7],A=t[8],M=t[9],L=t[10],F=t[11];return t!==s&&(s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=t[3],s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]),s[4]=g*d+A*u,s[5]=_*d+M*u,s[6]=x*d+L*u,s[7]=I*d+F*u,s[8]=A*d-g*u,s[9]=M*d-_*u,s[10]=L*d-x*u,s[11]=F*d-I*u,s},c.bA=z,c.bB=G_,c.bC=nc,c.bD=Kn,c.ba=de,c.bb=Se,c.bc=function(s,t){return s[0]=t[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=t[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=t[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},c.bd=class extends _l{},c.be=Ym,c.bf=y0,c.bg=pS,c.bi=je,c.bj=function(s,t,a=!1){if(Rn===Ou||Rn===Nu||Rn===Uu)throw new Error("setRTLTextPlugin cannot be called multiple times.");Sa=or.resolveURL(s),Rn=Ou,$u=t,Vu(),a||$d()},c.bk=ju,c.bl=function(s,t){const a={};for(let d=0;d<s.length;d++){const g=t&&t[s[d].id]||lc(s[d]);t&&(t[s[d].id]=g);let _=a[g];_||(_=a[g]=[]),_.push(s[d])}const u=[];for(const d in a)u.push(a[d]);return u},c.bm=yt,c.bn=x0,c.bo=S0,c.bp=e0,c.bq=function(s){s.bucket.createArrays(),s.bucket.tilePixelRatio=Hi/(512*s.bucket.overscaling),s.bucket.compareText={},s.bucket.iconsNeedLinear=!1;const t=s.bucket.layers[0],a=t.layout,u=t._unevaluatedLayout._values,d={layoutIconSize:u["icon-size"].possiblyEvaluate(new li(s.bucket.zoom+1),s.canonical),layoutTextSize:u["text-size"].possiblyEvaluate(new li(s.bucket.zoom+1),s.canonical),textMaxSize:u["text-size"].possiblyEvaluate(new li(18))};if(s.bucket.textSizeData.kind==="composite"){const{minZoom:A,maxZoom:M}=s.bucket.textSizeData;d.compositeTextSizes=[u["text-size"].possiblyEvaluate(new li(A),s.canonical),u["text-size"].possiblyEvaluate(new li(M),s.canonical)]}if(s.bucket.iconSizeData.kind==="composite"){const{minZoom:A,maxZoom:M}=s.bucket.iconSizeData;d.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new li(A),s.canonical),u["icon-size"].possiblyEvaluate(new li(M),s.canonical)]}const g=a.get("text-line-height")*Qi,_=a.get("text-rotation-alignment")!=="viewport"&&a.get("symbol-placement")!=="point",x=a.get("text-keep-upright"),I=a.get("text-size");for(const A of s.bucket.features){const M=a.get("text-font").evaluate(A,{},s.canonical).join(","),L=I.evaluate(A,{},s.canonical),F=d.layoutTextSize.evaluate(A,{},s.canonical),U=d.layoutIconSize.evaluate(A,{},s.canonical),V={horizontal:{},vertical:void 0},Z=A.text;let ee,ne=[0,0];if(Z){const ve=Z.toString(),Ie=a.get("text-letter-spacing").evaluate(A,{},s.canonical)*Qi,Fe=Ru(ve)?Ie:0,pt=a.get("text-anchor").evaluate(A,{},s.canonical),Tt=B0(t,A,s.canonical);if(!Tt){const nt=a.get("text-radial-offset").evaluate(A,{},s.canonical);ne=nt?z0(pt,[nt*Qi,Jm]):a.get("text-offset").evaluate(A,{},s.canonical).map(Ye=>Ye*Qi)}let lt=_?"center":a.get("text-justify").evaluate(A,{},s.canonical);const at=a.get("symbol-placement"),it=at==="point"?a.get("text-max-width").evaluate(A,{},s.canonical)*Qi:0,vt=()=>{s.bucket.allowVerticalPlacement&&Bu(ve)&&(V.vertical=sf(Z,s.glyphMap,s.glyphPositions,s.imagePositions,M,it,g,pt,"left",Fe,ne,c.ai.vertical,!0,at,F,L))};if(!_&&Tt){const nt=new Set;if(lt==="auto")for(let Dt=0;Dt<Tt.values.length;Dt+=2)nt.add(Qm(Tt.values[Dt]));else nt.add(lt);let Ye=!1;for(const Dt of nt)if(!V.horizontal[Dt])if(Ye)V.horizontal[Dt]=V.horizontal[0];else{const At=sf(Z,s.glyphMap,s.glyphPositions,s.imagePositions,M,it,g,"center",Dt,Fe,ne,c.ai.horizontal,!1,at,F,L);At&&(V.horizontal[Dt]=At,Ye=At.positionedLines.length===1)}vt()}else{lt==="auto"&&(lt=Qm(pt));const nt=sf(Z,s.glyphMap,s.glyphPositions,s.imagePositions,M,it,g,pt,lt,Fe,ne,c.ai.horizontal,!1,at,F,L);nt&&(V.horizontal[lt]=nt),vt(),Bu(ve)&&_&&x&&(V.vertical=sf(Z,s.glyphMap,s.glyphPositions,s.imagePositions,M,it,g,pt,lt,Fe,ne,c.ai.vertical,!1,at,F,L))}}let ye=!1;if(A.icon&&A.icon.name){const ve=s.imageMap[A.icon.name];ve&&(ee=Y2(s.imagePositions[A.icon.name],a.get("icon-offset").evaluate(A,{},s.canonical),a.get("icon-anchor").evaluate(A,{},s.canonical)),ye=!!ve.sdf,s.bucket.sdfIcons===void 0?s.bucket.sdfIcons=ye:s.bucket.sdfIcons!==ye&&$e("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ve.pixelRatio!==s.bucket.pixelRatio||a.get("icon-rotate").constantOr(1)!==0)&&(s.bucket.iconsNeedLinear=!0))}const ce=F0(V.horizontal)||V.vertical;s.bucket.iconsInText=!!ce&&ce.iconsInText,(ce||ee)&&dS(s.bucket,A,V,ee,s.imageMap,d,F,U,ne,ye,s.canonical)}s.showCollisionBoxes&&s.bucket.generateCollisionDebugBuffers()},c.br=Fm,c.bs=zm,c.bt=Rm,c.bu=class{constructor(s){this._marks={start:[s.url,"start"].join("#"),end:[s.url,"end"].join("#"),measure:s.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let s=performance.getEntriesByName(this._marks.measure);return s.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),s=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),s}},c.bv=Nm,c.bw=zo,c.bx=function(s,t,a,u,d){return E(this,void 0,void 0,function*(){if(fe())try{return yield er(s,t,a,u,d)}catch{}return function(g,_,x,I,A){const M=g.width,L=g.height;Xt&&ar||(Xt=new OffscreenCanvas(M,L),ar=Xt.getContext("2d",{willReadFrequently:!0})),Xt.width=M,Xt.height=L,ar.drawImage(g,0,0,M,L);const F=ar.getImageData(_,x,I,A);return ar.clearRect(0,0,M,L),F.data}(s,t,a,u,d)})},c.by=b0,c.bz=T,c.c=wt,c.d=function(s,t){const a=new Image;a.onload=()=>{t(null,a),URL.revokeObjectURL(a.src),a.onload=null,window.requestAnimationFrame(()=>{a.src=_t})},a.onerror=()=>t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const u=new Blob([new Uint8Array(s)],{type:"image/png"});a.src=s.byteLength?URL.createObjectURL(u):_t},c.e=Ee,c.f=function(s,t){return ir(Ee(s,{type:"json"}),t)},c.g=zt,c.h=or,c.i=gt,c.j=Gi,c.k=ai,c.l=$r,c.m=ir,c.n=function(s){return new Nm(s).readFields(j2,[])},c.o=function(s,t,a){if(!s.length)return a(null,[]);let u=s.length;const d=new Array(s.length);let g=null;s.forEach((_,x)=>{t(_,(I,A)=>{I&&(g=I),d[x]=A,--u==0&&a(g,d)})})},c.p=Q_,c.q=rh,c.r=Ri,c.s=br,c.t=mm,c.u=ft,c.v=Ce,c.w=$e,c.x=hc,c.y=ra,c.z=function([s,t,a]){return t+=90,t*=Math.PI/180,a*=Math.PI/180,{x:s*Math.cos(t)*Math.sin(a),y:s*Math.sin(t)*Math.sin(a),z:s*Math.cos(a)}}}),v(["./shared"],function(c){class E{constructor(R){this.keyCache={},R&&this.replace(R)}replace(R){this._layerConfigs={},this._layers={},this.update(R,[])}update(R,O){for(const J of R){this._layerConfigs[J.id]=J;const te=this._layers[J.id]=c.aC(J);te._featureFilter=c.a6(te.filter),this.keyCache[J.id]&&delete this.keyCache[J.id]}for(const J of O)delete this.keyCache[J],delete this._layerConfigs[J],delete this._layers[J];this.familiesBySource={};const j=c.bl(Object.values(this._layerConfigs),this.keyCache);for(const J of j){const te=J.map(Be=>this._layers[Be.id]),_e=te[0];if(_e.visibility==="none")continue;const he=_e.source||"";let se=this.familiesBySource[he];se||(se=this.familiesBySource[he]={});const ge=_e.sourceLayer||"_geojsonTileLayer";let Le=se[ge];Le||(Le=se[ge]=[]),Le.push(te)}}}class T{constructor(R){const O={},j=[];for(const he in R){const se=R[he],ge=O[he]={};for(const Le in se){const Be=se[+Le];if(!Be||Be.bitmap.width===0||Be.bitmap.height===0)continue;const Oe={x:0,y:0,w:Be.bitmap.width+2,h:Be.bitmap.height+2};j.push(Oe),ge[Le]={rect:Oe,metrics:Be.metrics}}}const{w:J,h:te}=c.p(j),_e=new c.q({width:J||1,height:te||1});for(const he in R){const se=R[he];for(const ge in se){const Le=se[+ge];if(!Le||Le.bitmap.width===0||Le.bitmap.height===0)continue;const Be=O[he][ge].rect;c.q.copy(Le.bitmap,_e,{x:0,y:0},{x:Be.x+1,y:Be.y+1},Le.bitmap)}}this.image=_e,this.positions=O}}c.bm("GlyphAtlas",T);class z{constructor(R){this.tileID=new c.O(R.tileID.overscaledZ,R.tileID.wrap,R.tileID.canonical.z,R.tileID.canonical.x,R.tileID.canonical.y),this.uid=R.uid,this.zoom=R.zoom,this.pixelRatio=R.pixelRatio,this.tileSize=R.tileSize,this.source=R.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=R.showCollisionBoxes,this.collectResourceTiming=!!R.collectResourceTiming,this.returnDependencies=!!R.returnDependencies,this.promoteId=R.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(R,O,j,J,te){this.status="parsing",this.data=R,this.collisionBoxArray=new c.a3;const _e=new c.bn(Object.keys(R.layers).sort()),he=new c.bo(this.tileID,this.promoteId);he.bucketLayerIDs=[];const se={},ge={featureIndex:he,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:j},Le=O.familiesBySource[this.source];for(const Cr in Le){const Ar=R.layers[Cr];if(!Ar)continue;Ar.version===1&&c.w(`Vector tile source "${this.source}" layer "${Cr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const bn=_e.encode(Cr),ti=[];for(let Wi=0;Wi<Ar.length;Wi++){const un=Ar.feature(Wi),cs=he.getId(un,Cr);ti.push({feature:un,id:cs,index:Wi,sourceLayerIndex:bn})}for(const Wi of Le[Cr]){const un=Wi[0];un.source!==this.source&&c.w(`layer.source = ${un.source} does not equal this.source = ${this.source}`),un.minzoom&&this.zoom<Math.floor(un.minzoom)||un.maxzoom&&this.zoom>=un.maxzoom||un.visibility!=="none"&&(B(Wi,this.zoom,j),(se[un.id]=un.createBucket({index:he.bucketLayerIDs.length,layers:Wi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:bn,sourceID:this.source})).populate(ti,ge,this.tileID.canonical),he.bucketLayerIDs.push(Wi.map(cs=>cs.id)))}}let Be,Oe,Mt,Ut;const St=c.aH(ge.glyphDependencies,Cr=>Object.keys(Cr).map(Number));this.inFlightDependencies.forEach(Cr=>Cr==null?void 0:Cr.cancel()),this.inFlightDependencies=[];const Lt=++this.dependencySentinel;Object.keys(St).length?this.inFlightDependencies.push(J.send("getGlyphs",{uid:this.uid,stacks:St,source:this.source,tileID:this.tileID,type:"glyphs"},(Cr,Ar)=>{Lt===this.dependencySentinel&&(Be||(Be=Cr,Oe=Ar,Wr.call(this)))})):Oe={};const Vt=Object.keys(ge.iconDependencies);Vt.length?this.inFlightDependencies.push(J.send("getImages",{icons:Vt,source:this.source,tileID:this.tileID,type:"icons"},(Cr,Ar)=>{Lt===this.dependencySentinel&&(Be||(Be=Cr,Mt=Ar,Wr.call(this)))})):Mt={};const Nr=Object.keys(ge.patternDependencies);function Wr(){if(Be)return te(Be);if(Oe&&Mt&&Ut){const Cr=new T(Oe),Ar=new c.bp(Mt,Ut);for(const bn in se){const ti=se[bn];ti instanceof c.a4?(B(ti.layers,this.zoom,j),c.bq({bucket:ti,glyphMap:Oe,glyphPositions:Cr.positions,imageMap:Mt,imagePositions:Ar.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):ti.hasPattern&&(ti instanceof c.br||ti instanceof c.bs||ti instanceof c.bt)&&(B(ti.layers,this.zoom,j),ti.addFeatures(ge,this.tileID.canonical,Ar.patternPositions))}this.status="done",te(null,{buckets:Object.values(se).filter(bn=>!bn.isEmpty()),featureIndex:he,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Cr.image,imageAtlas:Ar,glyphMap:this.returnDependencies?Oe:null,iconMap:this.returnDependencies?Mt:null,glyphPositions:this.returnDependencies?Cr.positions:null})}}Nr.length?this.inFlightDependencies.push(J.send("getImages",{icons:Nr,source:this.source,tileID:this.tileID,type:"patterns"},(Cr,Ar)=>{Lt===this.dependencySentinel&&(Be||(Be=Cr,Ut=Ar,Wr.call(this)))})):Ut={},Wr.call(this)}}function B(K,R,O){const j=new c.a8(R);for(const J of K)J.recalculate(j,O)}function $(K,R){const O=c.l(K.request,(j,J,te,_e)=>{if(j)R(j);else if(J)try{const he=new c.bw.VectorTile(new c.bv(J));R(null,{vectorTile:he,rawData:J,cacheControl:te,expires:_e})}catch(he){const se=new Uint8Array(J);let ge=`Unable to parse the tile at ${K.request.url}, `;ge+=se[0]===31&&se[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${he.messge}`,R(new Error(ge))}});return()=>{O.cancel(),R()}}class q{constructor(R,O,j,J){this.actor=R,this.layerIndex=O,this.availableImages=j,this.loadVectorData=J||$,this.fetching={},this.loading={},this.loaded={}}loadTile(R,O){const j=R.uid;this.loading||(this.loading={});const J=!!(R&&R.request&&R.request.collectResourceTiming)&&new c.bu(R.request),te=this.loading[j]=new z(R);te.abort=this.loadVectorData(R,(_e,he)=>{if(delete this.loading[j],_e||!he)return te.status="done",this.loaded[j]=te,O(_e);const se=he.rawData,ge={};he.expires&&(ge.expires=he.expires),he.cacheControl&&(ge.cacheControl=he.cacheControl);const Le={};if(J){const Be=J.finish();Be&&(Le.resourceTiming=JSON.parse(JSON.stringify(Be)))}te.vectorTile=he.vectorTile,te.parse(he.vectorTile,this.layerIndex,this.availableImages,this.actor,(Be,Oe)=>{if(delete this.fetching[j],Be||!Oe)return O(Be);O(null,c.e({rawTileData:se.slice(0)},Oe,ge,Le))}),this.loaded=this.loaded||{},this.loaded[j]=te,this.fetching[j]={rawTileData:se,cacheControl:ge,resourceTiming:Le}})}reloadTile(R,O){const j=this.loaded,J=R.uid;if(j&&j[J]){const te=j[J];te.showCollisionBoxes=R.showCollisionBoxes,te.status==="parsing"?te.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor,(_e,he)=>{if(_e||!he)return O(_e,he);let se;if(this.fetching[J]){const{rawTileData:ge,cacheControl:Le,resourceTiming:Be}=this.fetching[J];delete this.fetching[J],se=c.e({rawTileData:ge.slice(0)},he,Le,Be)}else se=he;O(null,se)}):te.status==="done"&&(te.vectorTile?te.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor,O):O())}}abortTile(R,O){const j=this.loading,J=R.uid;j&&j[J]&&j[J].abort&&(j[J].abort(),delete j[J]),O()}removeTile(R,O){const j=this.loaded,J=R.uid;j&&j[J]&&delete j[J],O()}}class Q{constructor(){this.loaded={}}loadTile(R,O){return c._(this,void 0,void 0,function*(){const{uid:j,encoding:J,rawImageData:te,redFactor:_e,greenFactor:he,blueFactor:se,baseShift:ge}=R,Le=te.width+2,Be=te.height+2,Oe=c.a(te)?new c.R({width:Le,height:Be},yield c.bx(te,-1,-1,Le,Be)):te,Mt=new c.by(j,Oe,J,_e,he,se,ge);this.loaded=this.loaded||{},this.loaded[j]=Mt,O(null,Mt)})}removeTile(R){const O=this.loaded,j=R.uid;O&&O[j]&&delete O[j]}}function ae(K,R){if(K.length!==0){ie(K[0],R);for(var O=1;O<K.length;O++)ie(K[O],!R)}}function ie(K,R){for(var O=0,j=0,J=0,te=K.length,_e=te-1;J<te;_e=J++){var he=(K[J][0]-K[_e][0])*(K[_e][1]+K[J][1]),se=O+he;j+=Math.abs(O)>=Math.abs(he)?O-se+he:he-se+O,O=se}O+j>=0!=!!R&&K.reverse()}var Y=c.bz(function K(R,O){var j,J=R&&R.type;if(J==="FeatureCollection")for(j=0;j<R.features.length;j++)K(R.features[j],O);else if(J==="GeometryCollection")for(j=0;j<R.geometries.length;j++)K(R.geometries[j],O);else if(J==="Feature")K(R.geometry,O);else if(J==="Polygon")ae(R.coordinates,O);else if(J==="MultiPolygon")for(j=0;j<R.coordinates.length;j++)ae(R.coordinates[j],O);return R});const be=c.bw.VectorTileFeature.prototype.toGeoJSON;var fe={exports:{}},de=c.bA,Se=c.bw.VectorTileFeature,Me=Ge;function Ge(K,R){this.options=R||{},this.features=K,this.length=K.length}function Ee(K,R){this.id=typeof K.id=="number"?K.id:void 0,this.type=K.type,this.rawGeometry=K.type===1?[K.geometry]:K.geometry,this.properties=K.tags,this.extent=R||4096}Ge.prototype.feature=function(K){return new Ee(this.features[K],this.options.extent)},Ee.prototype.loadGeometry=function(){var K=this.rawGeometry;this.geometry=[];for(var R=0;R<K.length;R++){for(var O=K[R],j=[],J=0;J<O.length;J++)j.push(new de(O[J][0],O[J][1]));this.geometry.push(j)}return this.geometry},Ee.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var K=this.geometry,R=1/0,O=-1/0,j=1/0,J=-1/0,te=0;te<K.length;te++)for(var _e=K[te],he=0;he<_e.length;he++){var se=_e[he];R=Math.min(R,se.x),O=Math.max(O,se.x),j=Math.min(j,se.y),J=Math.max(J,se.y)}return[R,j,O,J]},Ee.prototype.toGeoJSON=Se.prototype.toGeoJSON;var Ve=c.bB,De=Me;function qe(K){var R=new Ve;return function(O,j){for(var J in O.layers)j.writeMessage(3,Ze,O.layers[J])}(K,R),R.finish()}function Ze(K,R){var O;R.writeVarintField(15,K.version||1),R.writeStringField(1,K.name||""),R.writeVarintField(5,K.extent||4096);var j={keys:[],values:[],keycache:{},valuecache:{}};for(O=0;O<K.length;O++)j.feature=K.feature(O),R.writeMessage(2,Pe,j);var J=j.keys;for(O=0;O<J.length;O++)R.writeStringField(3,J[O]);var te=j.values;for(O=0;O<te.length;O++)R.writeMessage(4,Ne,te[O])}function Pe(K,R){var O=K.feature;O.id!==void 0&&R.writeVarintField(1,O.id),R.writeMessage(2,$e,K),R.writeVarintField(3,O.type),R.writeMessage(4,gt,O)}function $e(K,R){var O=K.feature,j=K.keys,J=K.values,te=K.keycache,_e=K.valuecache;for(var he in O.properties){var se=O.properties[he],ge=te[he];if(se!==null){ge===void 0&&(j.push(he),te[he]=ge=j.length-1),R.writeVarint(ge);var Le=typeof se;Le!=="string"&&Le!=="boolean"&&Le!=="number"&&(se=JSON.stringify(se));var Be=Le+":"+se,Oe=_e[Be];Oe===void 0&&(J.push(se),_e[Be]=Oe=J.length-1),R.writeVarint(Oe)}}}function We(K,R){return(R<<3)+(7&K)}function Je(K){return K<<1^K>>31}function gt(K,R){for(var O=K.loadGeometry(),j=K.type,J=0,te=0,_e=O.length,he=0;he<_e;he++){var se=O[he],ge=1;j===1&&(ge=se.length),R.writeVarint(We(1,ge));for(var Le=j===3?se.length-1:se.length,Be=0;Be<Le;Be++){Be===1&&j!==1&&R.writeVarint(We(2,Le-1));var Oe=se[Be].x-J,Mt=se[Be].y-te;R.writeVarint(Je(Oe)),R.writeVarint(Je(Mt)),J+=Oe,te+=Mt}j===3&&R.writeVarint(We(7,1))}}function Ne(K,R){var O=typeof K;O==="string"?R.writeStringField(1,K):O==="boolean"?R.writeBooleanField(7,K):O==="number"&&(K%1!=0?R.writeDoubleField(3,K):K<0?R.writeSVarintField(6,K):R.writeVarintField(5,K))}fe.exports=qe,fe.exports.fromVectorTileJs=qe,fe.exports.fromGeojsonVt=function(K,R){R=R||{};var O={};for(var j in K)O[j]=new De(K[j].features,R),O[j].name=j,O[j].version=R.version,O[j].extent=R.extent;return qe({layers:O})},fe.exports.GeoJSONWrapper=De;var ht=c.bz(fe.exports);const _t={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:K=>K},er=Math.fround||(Xt=new Float32Array(1),K=>(Xt[0]=+K,Xt[0]));var Xt;const ar=3,dt=5,Nt=6;class or{constructor(R){this.options=Object.assign(Object.create(_t),R),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(R){const{log:O,minZoom:j,maxZoom:J}=this.options;O&&console.time("total time");const te=`prepare ${R.length} points`;O&&console.time(te),this.points=R;const _e=[];for(let se=0;se<R.length;se++){const ge=R[se];if(!ge.geometry)continue;const[Le,Be]=ge.geometry.coordinates,Oe=er(Pt(Le)),Mt=er(zt(Be));_e.push(Oe,Mt,1/0,se,-1,1),this.options.reduce&&_e.push(0)}let he=this.trees[J+1]=this._createTree(_e);O&&console.timeEnd(te);for(let se=J;se>=j;se--){const ge=+Date.now();he=this.trees[se]=this._createTree(this._cluster(he,se)),O&&console.log("z%d: %d clusters in %dms",se,he.numItems,+Date.now()-ge)}return O&&console.timeEnd("total time"),this}getClusters(R,O){let j=((R[0]+180)%360+360)%360-180;const J=Math.max(-90,Math.min(90,R[1]));let te=R[2]===180?180:((R[2]+180)%360+360)%360-180;const _e=Math.max(-90,Math.min(90,R[3]));if(R[2]-R[0]>=360)j=-180,te=180;else if(j>te){const Be=this.getClusters([j,J,180,_e],O),Oe=this.getClusters([-180,J,te,_e],O);return Be.concat(Oe)}const he=this.trees[this._limitZoom(O)],se=he.range(Pt(j),zt(_e),Pt(te),zt(J)),ge=he.data,Le=[];for(const Be of se){const Oe=this.stride*Be;Le.push(ge[Oe+dt]>1?wt(ge,Oe,this.clusterProps):this.points[ge[Oe+ar]])}return Le}getChildren(R){const O=this._getOriginId(R),j=this._getOriginZoom(R),J="No cluster with the specified id.",te=this.trees[j];if(!te)throw new Error(J);const _e=te.data;if(O*this.stride>=_e.length)throw new Error(J);const he=this.options.radius/(this.options.extent*Math.pow(2,j-1)),se=te.within(_e[O*this.stride],_e[O*this.stride+1],he),ge=[];for(const Le of se){const Be=Le*this.stride;_e[Be+4]===R&&ge.push(_e[Be+dt]>1?wt(_e,Be,this.clusterProps):this.points[_e[Be+ar]])}if(ge.length===0)throw new Error(J);return ge}getLeaves(R,O,j){const J=[];return this._appendLeaves(J,R,O=O||10,j=j||0,0),J}getTile(R,O,j){const J=this.trees[this._limitZoom(R)],te=Math.pow(2,R),{extent:_e,radius:he}=this.options,se=he/_e,ge=(j-se)/te,Le=(j+1+se)/te,Be={features:[]};return this._addTileFeatures(J.range((O-se)/te,ge,(O+1+se)/te,Le),J.data,O,j,te,Be),O===0&&this._addTileFeatures(J.range(1-se/te,ge,1,Le),J.data,te,j,te,Be),O===te-1&&this._addTileFeatures(J.range(0,ge,se/te,Le),J.data,-1,j,te,Be),Be.features.length?Be:null}getClusterExpansionZoom(R){let O=this._getOriginZoom(R)-1;for(;O<=this.options.maxZoom;){const j=this.getChildren(R);if(O++,j.length!==1)break;R=j[0].properties.cluster_id}return O}_appendLeaves(R,O,j,J,te){const _e=this.getChildren(O);for(const he of _e){const se=he.properties;if(se&&se.cluster?te+se.point_count<=J?te+=se.point_count:te=this._appendLeaves(R,se.cluster_id,j,J,te):te<J?te++:R.push(he),R.length===j)break}return te}_createTree(R){const O=new c.av(R.length/this.stride|0,this.options.nodeSize,Float32Array);for(let j=0;j<R.length;j+=this.stride)O.add(R[j],R[j+1]);return O.finish(),O.data=R,O}_addTileFeatures(R,O,j,J,te,_e){for(const he of R){const se=he*this.stride,ge=O[se+dt]>1;let Le,Be,Oe;if(ge)Le=je(O,se,this.clusterProps),Be=O[se],Oe=O[se+1];else{const St=this.points[O[se+ar]];Le=St.properties;const[Lt,Vt]=St.geometry.coordinates;Be=Pt(Lt),Oe=zt(Vt)}const Mt={type:1,geometry:[[Math.round(this.options.extent*(Be*te-j)),Math.round(this.options.extent*(Oe*te-J))]],tags:Le};let Ut;Ut=ge||this.options.generateId?O[se+ar]:this.points[O[se+ar]].id,Ut!==void 0&&(Mt.id=Ut),_e.features.push(Mt)}}_limitZoom(R){return Math.max(this.options.minZoom,Math.min(Math.floor(+R),this.options.maxZoom+1))}_cluster(R,O){const{radius:j,extent:J,reduce:te,minPoints:_e}=this.options,he=j/(J*Math.pow(2,O)),se=R.data,ge=[],Le=this.stride;for(let Be=0;Be<se.length;Be+=Le){if(se[Be+2]<=O)continue;se[Be+2]=O;const Oe=se[Be],Mt=se[Be+1],Ut=R.within(se[Be],se[Be+1],he),St=se[Be+dt];let Lt=St;for(const Vt of Ut){const Nr=Vt*Le;se[Nr+2]>O&&(Lt+=se[Nr+dt])}if(Lt>St&&Lt>=_e){let Vt,Nr=Oe*St,Wr=Mt*St,Cr=-1;const Ar=((Be/Le|0)<<5)+(O+1)+this.points.length;for(const bn of Ut){const ti=bn*Le;if(se[ti+2]<=O)continue;se[ti+2]=O;const Wi=se[ti+dt];Nr+=se[ti]*Wi,Wr+=se[ti+1]*Wi,se[ti+4]=Ar,te&&(Vt||(Vt=this._map(se,Be,!0),Cr=this.clusterProps.length,this.clusterProps.push(Vt)),te(Vt,this._map(se,ti)))}se[Be+4]=Ar,ge.push(Nr/Lt,Wr/Lt,1/0,Ar,-1,Lt),te&&ge.push(Cr)}else{for(let Vt=0;Vt<Le;Vt++)ge.push(se[Be+Vt]);if(Lt>1)for(const Vt of Ut){const Nr=Vt*Le;if(!(se[Nr+2]<=O)){se[Nr+2]=O;for(let Wr=0;Wr<Le;Wr++)ge.push(se[Nr+Wr])}}}}return ge}_getOriginId(R){return R-this.points.length>>5}_getOriginZoom(R){return(R-this.points.length)%32}_map(R,O,j){if(R[O+dt]>1){const _e=this.clusterProps[R[O+Nt]];return j?Object.assign({},_e):_e}const J=this.points[R[O+ar]].properties,te=this.options.map(J);return j&&te===J?Object.assign({},te):te}}function wt(K,R,O){return{type:"Feature",id:K[R+ar],properties:je(K,R,O),geometry:{type:"Point",coordinates:[(j=K[R],360*(j-.5)),dr(K[R+1])]}};var j}function je(K,R,O){const j=K[R+dt],J=j>=1e4?`${Math.round(j/1e3)}k`:j>=1e3?Math.round(j/100)/10+"k":j,te=K[R+Nt],_e=te===-1?{}:Object.assign({},O[te]);return Object.assign(_e,{cluster:!0,cluster_id:K[R+ar],point_count:j,point_count_abbreviated:J})}function Pt(K){return K/360+.5}function zt(K){const R=Math.sin(K*Math.PI/180),O=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return O<0?0:O>1?1:O}function dr(K){const R=(180-360*K)*Math.PI/180;return 360*Math.atan(Math.exp(R))/Math.PI-90}function ir(K,R,O,j){for(var J,te=j,_e=O-R>>1,he=O-R,se=K[R],ge=K[R+1],Le=K[O],Be=K[O+1],Oe=R+3;Oe<O;Oe+=3){var Mt=$r(K[Oe],K[Oe+1],se,ge,Le,Be);if(Mt>te)J=Oe,te=Mt;else if(Mt===te){var Ut=Math.abs(Oe-_e);Ut<he&&(J=Oe,he=Ut)}}te>j&&(J-R>3&&ir(K,R,J,j),K[J+2]=te,O-J>3&&ir(K,J,O,j))}function $r(K,R,O,j,J,te){var _e=J-O,he=te-j;if(_e!==0||he!==0){var se=((K-O)*_e+(R-j)*he)/(_e*_e+he*he);se>1?(O=J,j=te):se>0&&(O+=_e*se,j+=he*se)}return(_e=K-O)*_e+(he=R-j)*he}function br(K,R,O,j){var J={id:K===void 0?null:K,type:R,geometry:O,tags:j,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(te){var _e=te.geometry,he=te.type;if(he==="Point"||he==="MultiPoint"||he==="LineString")pr(te,_e);else if(he==="Polygon"||he==="MultiLineString")for(var se=0;se<_e.length;se++)pr(te,_e[se]);else if(he==="MultiPolygon")for(se=0;se<_e.length;se++)for(var ge=0;ge<_e[se].length;ge++)pr(te,_e[se][ge])}(J),J}function pr(K,R){for(var O=0;O<R.length;O+=3)K.minX=Math.min(K.minX,R[O]),K.minY=Math.min(K.minY,R[O+1]),K.maxX=Math.max(K.maxX,R[O]),K.maxY=Math.max(K.maxY,R[O+1])}function Kr(K,R,O,j){if(R.geometry){var J=R.geometry.coordinates,te=R.geometry.type,_e=Math.pow(O.tolerance/((1<<O.maxZoom)*O.extent),2),he=[],se=R.id;if(O.promoteId?se=R.properties[O.promoteId]:O.generateId&&(se=j||0),te==="Point")ai(J,he);else if(te==="MultiPoint")for(var ge=0;ge<J.length;ge++)ai(J[ge],he);else if(te==="LineString")Gi(J,he,_e,!1);else if(te==="MultiLineString"){if(O.lineMetrics){for(ge=0;ge<J.length;ge++)Gi(J[ge],he=[],_e,!1),K.push(br(se,"LineString",he,R.properties));return}Mi(J,he,_e,!1)}else if(te==="Polygon")Mi(J,he,_e,!0);else{if(te!=="MultiPolygon"){if(te==="GeometryCollection"){for(ge=0;ge<R.geometry.geometries.length;ge++)Kr(K,{id:se,geometry:R.geometry.geometries[ge],properties:R.properties},O,j);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ge=0;ge<J.length;ge++){var Le=[];Mi(J[ge],Le,_e,!0),he.push(Le)}}K.push(br(se,te,he,R.properties))}}function ai(K,R){R.push(Ce(K[0])),R.push(di(K[1])),R.push(0)}function Gi(K,R,O,j){for(var J,te,_e=0,he=0;he<K.length;he++){var se=Ce(K[he][0]),ge=di(K[he][1]);R.push(se),R.push(ge),R.push(0),he>0&&(_e+=j?(J*ge-se*te)/2:Math.sqrt(Math.pow(se-J,2)+Math.pow(ge-te,2))),J=se,te=ge}var Le=R.length-3;R[2]=1,ir(R,0,Le,O),R[Le+2]=1,R.size=Math.abs(_e),R.start=0,R.end=R.size}function Mi(K,R,O,j){for(var J=0;J<K.length;J++){var te=[];Gi(K[J],te,O,j),R.push(te)}}function Ce(K){return K/360+.5}function di(K){var R=Math.sin(K*Math.PI/180),O=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return O<0?0:O>1?1:O}function Si(K,R,O,j,J,te,_e,he){if(j/=R,te>=(O/=R)&&_e<j)return K;if(_e<O||te>=j)return null;for(var se=[],ge=0;ge<K.length;ge++){var Le=K[ge],Be=Le.geometry,Oe=Le.type,Mt=J===0?Le.minX:Le.minY,Ut=J===0?Le.maxX:Le.maxY;if(Mt>=O&&Ut<j)se.push(Le);else if(!(Ut<O||Mt>=j)){var St=[];if(Oe==="Point"||Oe==="MultiPoint")mr(Be,St,O,j,J);else if(Oe==="LineString")$t(Be,St,O,j,J,!1,he.lineMetrics);else if(Oe==="MultiLineString")Di(Be,St,O,j,J,!1);else if(Oe==="Polygon")Di(Be,St,O,j,J,!0);else if(Oe==="MultiPolygon")for(var Lt=0;Lt<Be.length;Lt++){var Vt=[];Di(Be[Lt],Vt,O,j,J,!0),Vt.length&&St.push(Vt)}if(St.length){if(he.lineMetrics&&Oe==="LineString"){for(Lt=0;Lt<St.length;Lt++)se.push(br(Le.id,Oe,St[Lt],Le.tags));continue}Oe!=="LineString"&&Oe!=="MultiLineString"||(St.length===1?(Oe="LineString",St=St[0]):Oe="MultiLineString"),Oe!=="Point"&&Oe!=="MultiPoint"||(Oe=St.length===3?"Point":"MultiPoint"),se.push(br(Le.id,Oe,St,Le.tags))}}}return se.length?se:null}function mr(K,R,O,j,J){for(var te=0;te<K.length;te+=3){var _e=K[te+J];_e>=O&&_e<=j&&(R.push(K[te]),R.push(K[te+1]),R.push(K[te+2]))}}function $t(K,R,O,j,J,te,_e){for(var he,se,ge=yi(K),Le=J===0?on:ln,Be=K.start,Oe=0;Oe<K.length-3;Oe+=3){var Mt=K[Oe],Ut=K[Oe+1],St=K[Oe+2],Lt=K[Oe+3],Vt=K[Oe+4],Nr=J===0?Mt:Ut,Wr=J===0?Lt:Vt,Cr=!1;_e&&(he=Math.sqrt(Math.pow(Mt-Lt,2)+Math.pow(Ut-Vt,2))),Nr<O?Wr>O&&(se=Le(ge,Mt,Ut,Lt,Vt,O),_e&&(ge.start=Be+he*se)):Nr>j?Wr<j&&(se=Le(ge,Mt,Ut,Lt,Vt,j),_e&&(ge.start=Be+he*se)):Zi(ge,Mt,Ut,St),Wr<O&&Nr>=O&&(se=Le(ge,Mt,Ut,Lt,Vt,O),Cr=!0),Wr>j&&Nr<=j&&(se=Le(ge,Mt,Ut,Lt,Vt,j),Cr=!0),!te&&Cr&&(_e&&(ge.end=Be+he*se),R.push(ge),ge=yi(K)),_e&&(Be+=he)}var Ar=K.length-3;Mt=K[Ar],Ut=K[Ar+1],St=K[Ar+2],(Nr=J===0?Mt:Ut)>=O&&Nr<=j&&Zi(ge,Mt,Ut,St),Ar=ge.length-3,te&&Ar>=3&&(ge[Ar]!==ge[0]||ge[Ar+1]!==ge[1])&&Zi(ge,ge[0],ge[1],ge[2]),ge.length&&R.push(ge)}function yi(K){var R=[];return R.size=K.size,R.start=K.start,R.end=K.end,R}function Di(K,R,O,j,J,te){for(var _e=0;_e<K.length;_e++)$t(K[_e],R,O,j,J,te,!1)}function Zi(K,R,O,j){K.push(R),K.push(O),K.push(j)}function on(K,R,O,j,J,te){var _e=(te-R)/(j-R);return K.push(te),K.push(O+(J-O)*_e),K.push(1),_e}function ln(K,R,O,j,J,te){var _e=(te-O)/(J-O);return K.push(R+(j-R)*_e),K.push(te),K.push(1),_e}function oi(K,R){for(var O=[],j=0;j<K.length;j++){var J,te=K[j],_e=te.type;if(_e==="Point"||_e==="MultiPoint"||_e==="LineString")J=Ki(te.geometry,R);else if(_e==="MultiLineString"||_e==="Polygon"){J=[];for(var he=0;he<te.geometry.length;he++)J.push(Ki(te.geometry[he],R))}else if(_e==="MultiPolygon")for(J=[],he=0;he<te.geometry.length;he++){for(var se=[],ge=0;ge<te.geometry[he].length;ge++)se.push(Ki(te.geometry[he][ge],R));J.push(se)}O.push(br(te.id,_e,J,te.tags))}return O}function Ki(K,R){var O=[];O.size=K.size,K.start!==void 0&&(O.start=K.start,O.end=K.end);for(var j=0;j<K.length;j+=3)O.push(K[j]+R,K[j+1],K[j+2]);return O}function Ke(K,R){if(K.transformed)return K;var O,j,J,te=1<<K.z,_e=K.x,he=K.y;for(O=0;O<K.features.length;O++){var se=K.features[O],ge=se.geometry,Le=se.type;if(se.geometry=[],Le===1)for(j=0;j<ge.length;j+=2)se.geometry.push(cn(ge[j],ge[j+1],R,te,_e,he));else for(j=0;j<ge.length;j++){var Be=[];for(J=0;J<ge[j].length;J+=2)Be.push(cn(ge[j][J],ge[j][J+1],R,te,_e,he));se.geometry.push(Be)}}return K.transformed=!0,K}function cn(K,R,O,j,J,te){return[Math.round(O*(K*j-J)),Math.round(O*(R*j-te))]}function Xr(K,R,O,j,J){for(var te=R===J.maxZoom?0:J.tolerance/((1<<R)*J.extent),_e={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:O,y:j,z:R,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},he=0;he<K.length;he++){_e.numFeatures++,zn(_e,K[he],te,J);var se=K[he].minX,ge=K[he].minY,Le=K[he].maxX,Be=K[he].maxY;se<_e.minX&&(_e.minX=se),ge<_e.minY&&(_e.minY=ge),Le>_e.maxX&&(_e.maxX=Le),Be>_e.maxY&&(_e.maxY=Be)}return _e}function zn(K,R,O,j){var J=R.geometry,te=R.type,_e=[];if(te==="Point"||te==="MultiPoint")for(var he=0;he<J.length;he+=3)_e.push(J[he]),_e.push(J[he+1]),K.numPoints++,K.numSimplified++;else if(te==="LineString")os(_e,J,K,O,!1,!1);else if(te==="MultiLineString"||te==="Polygon")for(he=0;he<J.length;he++)os(_e,J[he],K,O,te==="Polygon",he===0);else if(te==="MultiPolygon")for(var se=0;se<J.length;se++){var ge=J[se];for(he=0;he<ge.length;he++)os(_e,ge[he],K,O,!0,he===0)}if(_e.length){var Le=R.tags||null;if(te==="LineString"&&j.lineMetrics){for(var Be in Le={},R.tags)Le[Be]=R.tags[Be];Le.mapbox_clip_start=J.start/J.size,Le.mapbox_clip_end=J.end/J.size}var Oe={geometry:_e,type:te==="Polygon"||te==="MultiPolygon"?3:te==="LineString"||te==="MultiLineString"?2:1,tags:Le};R.id!==null&&(Oe.id=R.id),K.features.push(Oe)}}function os(K,R,O,j,J,te){var _e=j*j;if(j>0&&R.size<(J?_e:j))O.numPoints+=R.length/3;else{for(var he=[],se=0;se<R.length;se+=3)(j===0||R[se+2]>_e)&&(O.numSimplified++,he.push(R[se]),he.push(R[se+1])),O.numPoints++;J&&function(ge,Le){for(var Be=0,Oe=0,Mt=ge.length,Ut=Mt-2;Oe<Mt;Ut=Oe,Oe+=2)Be+=(ge[Oe]-ge[Ut])*(ge[Oe+1]+ge[Ut+1]);if(Be>0===Le)for(Oe=0,Mt=ge.length;Oe<Mt/2;Oe+=2){var St=ge[Oe],Lt=ge[Oe+1];ge[Oe]=ge[Mt-2-Oe],ge[Oe+1]=ge[Mt-1-Oe],ge[Mt-2-Oe]=St,ge[Mt-1-Oe]=Lt}}(he,te),K.push(he)}}function et(K,R){var O=(R=this.options=function(J,te){for(var _e in te)J[_e]=te[_e];return J}(Object.create(this.options),R)).debug;if(O&&console.time("preprocess data"),R.maxZoom<0||R.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(R.promoteId&&R.generateId)throw new Error("promoteId and generateId cannot be used together.");var j=function(J,te){var _e=[];if(J.type==="FeatureCollection")for(var he=0;he<J.features.length;he++)Kr(_e,J.features[he],te,he);else Kr(_e,J.type==="Feature"?J:{geometry:J},te);return _e}(K,R);this.tiles={},this.tileCoords=[],O&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",R.indexMaxZoom,R.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),j=function(J,te){var _e=te.buffer/te.extent,he=J,se=Si(J,1,-1-_e,_e,0,-1,2,te),ge=Si(J,1,1-_e,2+_e,0,-1,2,te);return(se||ge)&&(he=Si(J,1,-_e,1+_e,0,-1,2,te)||[],se&&(he=oi(se,1).concat(he)),ge&&(he=he.concat(oi(ge,-1)))),he}(j,R),j.length&&this.splitTile(j,0,0,0),O&&(j.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Jt(K,R,O){return 32*((1<<K)*O+R)+K}function Bt(K,R){return R?K.properties[R]:K.id}function vn(K,R){if(K==null)return!0;if(K.type==="Feature")return Bt(K,R)!=null;if(K.type==="FeatureCollection"){const O=new Set;for(const j of K.features){const J=Bt(j,R);if(J==null||O.has(J))return!1;O.add(J)}return!0}return!1}function ls(K,R){const O=new Map;if(K!=null)if(K.type==="Feature")O.set(Bt(K,R),K);else for(const j of K.features)O.set(Bt(j,R),j);return O}et.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},et.prototype.splitTile=function(K,R,O,j,J,te,_e){for(var he=[K,R,O,j],se=this.options,ge=se.debug;he.length;){j=he.pop(),O=he.pop(),R=he.pop(),K=he.pop();var Le=1<<R,Be=Jt(R,O,j),Oe=this.tiles[Be];if(!Oe&&(ge>1&&console.time("creation"),Oe=this.tiles[Be]=Xr(K,R,O,j,se),this.tileCoords.push({z:R,x:O,y:j}),ge)){ge>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",R,O,j,Oe.numFeatures,Oe.numPoints,Oe.numSimplified),console.timeEnd("creation"));var Mt="z"+R;this.stats[Mt]=(this.stats[Mt]||0)+1,this.total++}if(Oe.source=K,J){if(R===se.maxZoom||R===J)continue;var Ut=1<<J-R;if(O!==Math.floor(te/Ut)||j!==Math.floor(_e/Ut))continue}else if(R===se.indexMaxZoom||Oe.numPoints<=se.indexMaxPoints)continue;if(Oe.source=null,K.length!==0){ge>1&&console.time("clipping");var St,Lt,Vt,Nr,Wr,Cr,Ar=.5*se.buffer/se.extent,bn=.5-Ar,ti=.5+Ar,Wi=1+Ar;St=Lt=Vt=Nr=null,Wr=Si(K,Le,O-Ar,O+ti,0,Oe.minX,Oe.maxX,se),Cr=Si(K,Le,O+bn,O+Wi,0,Oe.minX,Oe.maxX,se),K=null,Wr&&(St=Si(Wr,Le,j-Ar,j+ti,1,Oe.minY,Oe.maxY,se),Lt=Si(Wr,Le,j+bn,j+Wi,1,Oe.minY,Oe.maxY,se),Wr=null),Cr&&(Vt=Si(Cr,Le,j-Ar,j+ti,1,Oe.minY,Oe.maxY,se),Nr=Si(Cr,Le,j+bn,j+Wi,1,Oe.minY,Oe.maxY,se),Cr=null),ge>1&&console.timeEnd("clipping"),he.push(St||[],R+1,2*O,2*j),he.push(Lt||[],R+1,2*O,2*j+1),he.push(Vt||[],R+1,2*O+1,2*j),he.push(Nr||[],R+1,2*O+1,2*j+1)}}},et.prototype.getTile=function(K,R,O){var j=this.options,J=j.extent,te=j.debug;if(K<0||K>24)return null;var _e=1<<K,he=Jt(K,R=(R%_e+_e)%_e,O);if(this.tiles[he])return Ke(this.tiles[he],J);te>1&&console.log("drilling down to z%d-%d-%d",K,R,O);for(var se,ge=K,Le=R,Be=O;!se&&ge>0;)ge--,Le=Math.floor(Le/2),Be=Math.floor(Be/2),se=this.tiles[Jt(ge,Le,Be)];return se&&se.source?(te>1&&console.log("found parent tile z%d-%d-%d",ge,Le,Be),te>1&&console.time("drilling down"),this.splitTile(se.source,ge,Le,Be,K,R,O),te>1&&console.timeEnd("drilling down"),this.tiles[he]?Ke(this.tiles[he],J):null):null};class tr extends q{constructor(R,O,j,J){super(R,O,j),this._dataUpdateable=new Map,this.loadGeoJSON=(te,_e)=>{const{promoteId:he}=te;if(te.request)return c.f(te.request,(se,ge,Le,Be)=>{this._dataUpdateable=vn(ge,he)?ls(ge,he):void 0,_e(se,ge,Le,Be)});if(typeof te.data=="string")try{const se=JSON.parse(te.data);this._dataUpdateable=vn(se,he)?ls(se,he):void 0,_e(null,se)}catch{_e(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`))}else te.dataDiff?this._dataUpdateable?(function(se,ge,Le){var Be,Oe,Mt,Ut;if(ge.removeAll&&se.clear(),ge.remove)for(const St of ge.remove)se.delete(St);if(ge.add)for(const St of ge.add){const Lt=Bt(St,Le);Lt!=null&&se.set(Lt,St)}if(ge.update)for(const St of ge.update){let Lt=se.get(St.id);if(Lt==null)continue;const Vt=!St.removeAllProperties&&(((Be=St.removeProperties)===null||Be===void 0?void 0:Be.length)>0||((Oe=St.addOrUpdateProperties)===null||Oe===void 0?void 0:Oe.length)>0);if((St.newGeometry||St.removeAllProperties||Vt)&&(Lt=Object.assign({},Lt),se.set(St.id,Lt),Vt&&(Lt.properties=Object.assign({},Lt.properties))),St.newGeometry&&(Lt.geometry=St.newGeometry),St.removeAllProperties)Lt.properties={};else if(((Mt=St.removeProperties)===null||Mt===void 0?void 0:Mt.length)>0)for(const Nr of St.removeProperties)Object.prototype.hasOwnProperty.call(Lt.properties,Nr)&&delete Lt.properties[Nr];if(((Ut=St.addOrUpdateProperties)===null||Ut===void 0?void 0:Ut.length)>0)for(const{key:Nr,value:Wr}of St.addOrUpdateProperties)Lt.properties[Nr]=Wr}}(this._dataUpdateable,te.dataDiff,he),_e(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):_e(new Error(`Cannot update existing geojson data in ${te.source}`)):_e(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,J&&(this.loadGeoJSON=J)}loadGeoJSONTile(R,O){const j=R.tileID.canonical;if(!this._geoJSONIndex)return O(null,null);const J=this._geoJSONIndex.getTile(j.z,j.x,j.y);if(!J)return O(null,null);const te=new class{constructor(he){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=c.N,this.length=he.length,this._features=he}feature(he){return new class{constructor(se){this._feature=se,this.extent=c.N,this.type=se.type,this.properties=se.tags,"id"in se&&!isNaN(se.id)&&(this.id=parseInt(se.id,10))}loadGeometry(){if(this._feature.type===1){const se=[];for(const ge of this._feature.geometry)se.push([new c.P(ge[0],ge[1])]);return se}{const se=[];for(const ge of this._feature.geometry){const Le=[];for(const Be of ge)Le.push(new c.P(Be[0],Be[1]));se.push(Le)}return se}}toGeoJSON(se,ge,Le){return be.call(this,se,ge,Le)}}(this._features[he])}}(J.features);let _e=ht(te);_e.byteOffset===0&&_e.byteLength===_e.buffer.byteLength||(_e=new Uint8Array(_e)),O(null,{vectorTile:te,rawData:_e.buffer})}loadData(R,O){var j;(j=this._pendingRequest)===null||j===void 0||j.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const J=!!(R&&R.request&&R.request.collectResourceTiming)&&new c.bu(R.request);this._pendingCallback=O,this._pendingRequest=this.loadGeoJSON(R,(te,_e)=>{if(delete this._pendingCallback,delete this._pendingRequest,te||!_e)return O(te);if(typeof _e!="object")return O(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`));{Y(_e,!0);try{if(R.filter){const se=c.bC(R.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(se.result==="error")throw new Error(se.value.map(Le=>`${Le.key}: ${Le.message}`).join(", "));_e={type:"FeatureCollection",features:_e.features.filter(Le=>se.value.evaluate({zoom:0},Le))}}this._geoJSONIndex=R.cluster?new or(function({superclusterOptions:se,clusterProperties:ge}){if(!ge||!se)return se;const Le={},Be={},Oe={accumulated:null,zoom:0},Mt={properties:null},Ut=Object.keys(ge);for(const St of Ut){const[Lt,Vt]=ge[St],Nr=c.bC(Vt),Wr=c.bC(typeof Lt=="string"?[Lt,["accumulated"],["get",St]]:Lt);Le[St]=Nr.value,Be[St]=Wr.value}return se.map=St=>{Mt.properties=St;const Lt={};for(const Vt of Ut)Lt[Vt]=Le[Vt].evaluate(Oe,Mt);return Lt},se.reduce=(St,Lt)=>{Mt.properties=Lt;for(const Vt of Ut)Oe.accumulated=St[Vt],St[Vt]=Be[Vt].evaluate(Oe,Mt)},se}(R)).load(_e.features):function(se,ge){return new et(se,ge)}(_e,R.geojsonVtOptions)}catch(se){return O(se)}this.loaded={};const he={};if(J){const se=J.finish();se&&(he.resourceTiming={},he.resourceTiming[R.source]=JSON.parse(JSON.stringify(se)))}O(null,he)}})}reloadTile(R,O){const j=this.loaded;return j&&j[R.uid]?super.reloadTile(R,O):this.loadTile(R,O)}removeSource(R,O){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),O()}getClusterExpansionZoom(R,O){try{O(null,this._geoJSONIndex.getClusterExpansionZoom(R.clusterId))}catch(j){O(j)}}getClusterChildren(R,O){try{O(null,this._geoJSONIndex.getChildren(R.clusterId))}catch(j){O(j)}}getClusterLeaves(R,O){try{O(null,this._geoJSONIndex.getLeaves(R.clusterId,R.limit,R.offset))}catch(j){O(j)}}}class Js{constructor(R){this.self=R,this.actor=new c.C(R,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:q,geojson:tr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(O,j)=>{if(this.workerSourceTypes[O])throw new Error(`Worker source with name "${O}" already registered.`);this.workerSourceTypes[O]=j},this.self.registerRTLTextPlugin=O=>{if(c.bD.isParsed())throw new Error("RTL text plugin already registered.");c.bD.applyArabicShaping=O.applyArabicShaping,c.bD.processBidirectionalText=O.processBidirectionalText,c.bD.processStyledBidirectionalText=O.processStyledBidirectionalText}}setReferrer(R,O){this.referrer=O}setImages(R,O,j){this.availableImages[R]=O;for(const J in this.workerSources[R]){const te=this.workerSources[R][J];for(const _e in te)te[_e].availableImages=O}j()}setLayers(R,O,j){this.getLayerIndex(R).replace(O),j()}updateLayers(R,O,j){this.getLayerIndex(R).update(O.layers,O.removedIds),j()}loadTile(R,O,j){this.getWorkerSource(R,O.type,O.source).loadTile(O,j)}loadDEMTile(R,O,j){this.getDEMWorkerSource(R,O.source).loadTile(O,j)}reloadTile(R,O,j){this.getWorkerSource(R,O.type,O.source).reloadTile(O,j)}abortTile(R,O,j){this.getWorkerSource(R,O.type,O.source).abortTile(O,j)}removeTile(R,O,j){this.getWorkerSource(R,O.type,O.source).removeTile(O,j)}removeDEMTile(R,O){this.getDEMWorkerSource(R,O.source).removeTile(O)}removeSource(R,O,j){if(!this.workerSources[R]||!this.workerSources[R][O.type]||!this.workerSources[R][O.type][O.source])return;const J=this.workerSources[R][O.type][O.source];delete this.workerSources[R][O.type][O.source],J.removeSource!==void 0?J.removeSource(O,j):j()}loadWorkerSource(R,O,j){try{this.self.importScripts(O.url),j()}catch(J){j(J.toString())}}syncRTLPluginState(R,O,j){try{c.bD.setState(O);const J=c.bD.getPluginURL();if(c.bD.isLoaded()&&!c.bD.isParsed()&&J!=null){this.self.importScripts(J);const te=c.bD.isParsed();j(te?void 0:new Error(`RTL Text Plugin failed to import scripts from ${J}`),te)}}catch(J){j(J.toString())}}getAvailableImages(R){let O=this.availableImages[R];return O||(O=[]),O}getLayerIndex(R){let O=this.layerIndexes[R];return O||(O=this.layerIndexes[R]=new E),O}getWorkerSource(R,O,j){return this.workerSources[R]||(this.workerSources[R]={}),this.workerSources[R][O]||(this.workerSources[R][O]={}),this.workerSources[R][O][j]||(this.workerSources[R][O][j]=new this.workerSourceTypes[O]({send:(J,te,_e)=>{this.actor.send(J,te,_e,R)}},this.getLayerIndex(R),this.getAvailableImages(R))),this.workerSources[R][O][j]}getDEMWorkerSource(R,O){return this.demWorkerSources[R]||(this.demWorkerSources[R]={}),this.demWorkerSources[R][O]||(this.demWorkerSources[R][O]=new Q),this.demWorkerSources[R][O]}}return c.i()&&(self.worker=new Js(self)),Js}),v(["./shared"],function(c){var E="3.6.2";class T{static testProp(r){if(!T.docStyle)return r[0];for(let o=0;o<r.length;o++)if(r[o]in T.docStyle)return r[o];return r[0]}static create(r,o,h){const f=window.document.createElement(r);return o!==void 0&&(f.className=o),h&&h.appendChild(f),f}static createNS(r,o){return window.document.createElementNS(r,o)}static disableDrag(){T.docStyle&&T.selectProp&&(T.userSelect=T.docStyle[T.selectProp],T.docStyle[T.selectProp]="none")}static enableDrag(){T.docStyle&&T.selectProp&&(T.docStyle[T.selectProp]=T.userSelect)}static setTransform(r,o){r.style[T.transformProp]=o}static addEventListener(r,o,h,f={}){r.addEventListener(o,h,"passive"in f?f:f.capture)}static removeEventListener(r,o,h,f={}){r.removeEventListener(o,h,"passive"in f?f:f.capture)}static suppressClickInternal(r){r.preventDefault(),r.stopPropagation(),window.removeEventListener("click",T.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",T.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",T.suppressClickInternal,!0)},0)}static mousePos(r,o){const h=r.getBoundingClientRect();return new c.P(o.clientX-h.left-r.clientLeft,o.clientY-h.top-r.clientTop)}static touchPos(r,o){const h=r.getBoundingClientRect(),f=[];for(let y=0;y<o.length;y++)f.push(new c.P(o[y].clientX-h.left-r.clientLeft,o[y].clientY-h.top-r.clientTop));return f}static mouseButton(r){return r.button}static remove(r){r.parentNode&&r.parentNode.removeChild(r)}}T.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,T.selectProp=T.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),T.transformProp=T.testProp(["transform","WebkitTransform"]);const z={supported:!1,testSupport:function(m){!q&&$&&(Q?ae(m):B=m)}};let B,$,q=!1,Q=!1;function ae(m){const r=m.createTexture();m.bindTexture(m.TEXTURE_2D,r);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,$),m.isContextLost())return;z.supported=!0}catch{}m.deleteTexture(r),q=!0}var ie,Y;typeof document<"u"&&($=document.createElement("img"),$.onload=function(){B&&ae(B),B=null,Q=!0},$.onerror=function(){q=!0,B=null},$.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(m){let r,o,h,f;m.resetRequestQueue=()=>{r=[],o=0,h=0,f={}},m.addThrottleControl=C=>{const D=h++;return f[D]=C,D},m.removeThrottleControl=C=>{delete f[C],S()},m.getImage=(C,D,P=!0)=>{z.supported&&(C.headers||(C.headers={}),C.headers.accept="image/webp,*/*");const N={requestParameters:C,supportImageRefresh:P,callback:D,cancelled:!1,completed:!1,cancel:()=>{N.completed||N.cancelled||(N.cancelled=!0,N.innerRequest&&(N.innerRequest.cancel(),o--),S())}};return r.push(N),S(),N};const y=C=>{const{requestParameters:D,supportImageRefresh:P,callback:N}=C;return c.e(D,{type:"image"}),(P!==!1||c.i()||c.g(D.url)||D.headers&&!Object.keys(D.headers).reduce((H,W)=>H&&W==="accept",!0)?c.m:k)(D,(H,W,X,G)=>{w(C,N,H,W,X,G)})},w=(C,D,P,N,H,W)=>{P?D(P):N instanceof HTMLImageElement||c.a(N)?D(null,N):N&&((X,G)=>{typeof createImageBitmap=="function"?c.b(X,G):c.d(X,G)})(N,(X,G)=>{X!=null?D(X):G!=null&&D(null,G,{cacheControl:H,expires:W})}),C.cancelled||(C.completed=!0,o--,S())},S=()=>{const C=(()=>{const D=Object.keys(f);let P=!1;if(D.length>0){for(const N of D)if(P=f[N](),P)break}return P})()?c.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let D=o;D<C&&r.length>0;D++){const P=r.shift();if(P.cancelled){D--;continue}const N=y(P);o++,P.innerRequest=N}},k=(C,D)=>{const P=new Image,N=C.url;let H=!1;const W=C.credentials;return W&&W==="include"?P.crossOrigin="use-credentials":(W&&W==="same-origin"||!c.s(N))&&(P.crossOrigin="anonymous"),P.fetchPriority="high",P.onload=()=>{D(null,P),P.onerror=P.onload=null},P.onerror=()=>{H||D(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),P.onerror=P.onload=null},P.src=N,{cancel:()=>{H=!0,P.src=""}}}}(ie||(ie={})),ie.resetRequestQueue(),function(m){m.Glyphs="Glyphs",m.Image="Image",m.Source="Source",m.SpriteImage="SpriteImage",m.SpriteJSON="SpriteJSON",m.Style="Style",m.Tile="Tile",m.Unknown="Unknown"}(Y||(Y={}));class be{constructor(r){this._transformRequestFn=r}transformRequest(r,o){return this._transformRequestFn&&this._transformRequestFn(r,o)||{url:r}}normalizeSpriteURL(r,o,h){const f=function(y){const w=y.match(fe);if(!w)throw new Error(`Unable to parse URL "${y}"`);return{protocol:w[1],authority:w[2],path:w[3]||"/",params:w[4]?w[4].split("&"):[]}}(r);return f.path+=`${o}${h}`,function(y){const w=y.params.length?`?${y.params.join("&")}`:"";return`${y.protocol}://${y.authority}${y.path}${w}`}(f)}setTransformRequest(r){this._transformRequestFn=r}}const fe=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function de(m){var r=new c.A(3);return r[0]=m[0],r[1]=m[1],r[2]=m[2],r}var Se,Me=function(m,r,o){return m[0]=r[0]-o[0],m[1]=r[1]-o[1],m[2]=r[2]-o[2],m};Se=new c.A(3),c.A!=Float32Array&&(Se[0]=0,Se[1]=0,Se[2]=0);var Ge=function(m){var r=m[0],o=m[1];return r*r+o*o};function Ee(m){const r=[];if(typeof m=="string")r.push({id:"default",url:m});else if(m&&m.length>0){const o=[];for(const{id:h,url:f}of m){const y=`${h}${f}`;o.indexOf(y)===-1&&(o.push(y),r.push({id:h,url:f}))}}return r}function Ve(m,r,o,h,f){if(h)return void m(h);if(f!==Object.values(r).length||f!==Object.values(o).length)return;const y={};for(const w in r){y[w]={};const S=c.h.getImageCanvasContext(o[w]),k=r[w];for(const C in k){const{width:D,height:P,x:N,y:H,sdf:W,pixelRatio:X,stretchX:G,stretchY:pe,content:we}=k[C];y[w][C]={data:null,pixelRatio:X,sdf:W,stretchX:G,stretchY:pe,content:we,spriteData:{width:D,height:P,x:N,y:H,context:S}}}}m(null,y)}(function(){var m=new c.A(2);c.A!=Float32Array&&(m[0]=0,m[1]=0)})();class De{constructor(r,o,h,f){this.context=r,this.format=h,this.texture=r.gl.createTexture(),this.update(o,f)}update(r,o,h){const{width:f,height:y}=r,w=!(this.size&&this.size[0]===f&&this.size[1]===y||h),{context:S}=this,{gl:k}=S;if(this.useMipmap=!!(o&&o.useMipmap),k.bindTexture(k.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===k.RGBA&&(!o||o.premultiply!==!1)),w)this.size=[f,y],r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||c.a(r)?k.texImage2D(k.TEXTURE_2D,0,this.format,this.format,k.UNSIGNED_BYTE,r):k.texImage2D(k.TEXTURE_2D,0,this.format,f,y,0,this.format,k.UNSIGNED_BYTE,r.data);else{const{x:C,y:D}=h||{x:0,y:0};r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||c.a(r)?k.texSubImage2D(k.TEXTURE_2D,0,C,D,k.RGBA,k.UNSIGNED_BYTE,r):k.texSubImage2D(k.TEXTURE_2D,0,C,D,f,y,k.RGBA,k.UNSIGNED_BYTE,r.data)}this.useMipmap&&this.isSizePowerOfTwo()&&k.generateMipmap(k.TEXTURE_2D)}bind(r,o,h){const{context:f}=this,{gl:y}=f;y.bindTexture(y.TEXTURE_2D,this.texture),h!==y.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(h=y.LINEAR),r!==this.filter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,r),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,h||r),this.filter=r),o!==this.wrap&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,o),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}function qe(m){const{userImage:r}=m;return!!(r&&r.render&&r.render())&&(m.data.replace(new Uint8Array(r.data.buffer)),!0)}class Ze extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:o,callback:h}of this.requestors)this._notify(o,h);this.requestors=[]}}getImage(r){const o=this.images[r];if(o&&!o.data&&o.spriteData){const h=o.spriteData;o.data=new c.R({width:h.width,height:h.height},h.context.getImageData(h.x,h.y,h.width,h.height).data),o.spriteData=null}return o}addImage(r,o){if(this.images[r])throw new Error(`Image id ${r} already exist, use updateImage instead`);this._validate(r,o)&&(this.images[r]=o)}_validate(r,o){let h=!0;const f=o.data||o.spriteData;return this._validateStretch(o.stretchX,f&&f.width)||(this.fire(new c.j(new Error(`Image "${r}" has invalid "stretchX" value`))),h=!1),this._validateStretch(o.stretchY,f&&f.height)||(this.fire(new c.j(new Error(`Image "${r}" has invalid "stretchY" value`))),h=!1),this._validateContent(o.content,o)||(this.fire(new c.j(new Error(`Image "${r}" has invalid "content" value`))),h=!1),h}_validateStretch(r,o){if(!r)return!0;let h=0;for(const f of r){if(f[0]<h||f[1]<f[0]||o<f[1])return!1;h=f[1]}return!0}_validateContent(r,o){if(!r)return!0;if(r.length!==4)return!1;const h=o.spriteData,f=h&&h.width||o.data.width,y=h&&h.height||o.data.height;return!(r[0]<0||f<r[0]||r[1]<0||y<r[1]||r[2]<0||f<r[2]||r[3]<0||y<r[3]||r[2]<r[0]||r[3]<r[1])}updateImage(r,o,h=!0){const f=this.getImage(r);if(h&&(f.data.width!==o.data.width||f.data.height!==o.data.height))throw new Error(`size mismatch between old image (${f.data.width}x${f.data.height}) and new image (${o.data.width}x${o.data.height}).`);o.version=f.version+1,this.images[r]=o,this.updatedImages[r]=!0}removeImage(r){const o=this.images[r];delete this.images[r],delete this.patterns[r],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,o){let h=!0;if(!this.isLoaded())for(const f of r)this.images[f]||(h=!1);this.isLoaded()||h?this._notify(r,o):this.requestors.push({ids:r,callback:o})}_notify(r,o){const h={};for(const f of r){let y=this.getImage(f);y||(this.fire(new c.k("styleimagemissing",{id:f})),y=this.getImage(f)),y?h[f]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,hasRenderCallback:!!(y.userImage&&y.userImage.render)}:c.w(`Image "${f}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}o(null,h)}getPixelSize(){const{width:r,height:o}=this.atlasImage;return{width:r,height:o}}getPattern(r){const o=this.patterns[r],h=this.getImage(r);if(!h)return null;if(o&&o.position.version===h.version)return o.position;if(o)o.position.version=h.version;else{const f={w:h.data.width+2,h:h.data.height+2,x:0,y:0},y=new c.I(f,h);this.patterns[r]={bin:f,position:y}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const o=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new De(r,this.atlasImage,o.RGBA),this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const y in this.patterns)r.push(this.patterns[y].bin);const{w:o,h}=c.p(r),f=this.atlasImage;f.resize({width:o||1,height:h||1});for(const y in this.patterns){const{bin:w}=this.patterns[y],S=w.x+1,k=w.y+1,C=this.getImage(y).data,D=C.width,P=C.height;c.R.copy(C,f,{x:0,y:0},{x:S,y:k},{width:D,height:P}),c.R.copy(C,f,{x:0,y:P-1},{x:S,y:k-1},{width:D,height:1}),c.R.copy(C,f,{x:0,y:0},{x:S,y:k+P},{width:D,height:1}),c.R.copy(C,f,{x:D-1,y:0},{x:S-1,y:k},{width:1,height:P}),c.R.copy(C,f,{x:0,y:0},{x:S+D,y:k},{width:1,height:P})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const o of r){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;const h=this.getImage(o);h||c.w(`Image with ID: "${o}" was not found`),qe(h)&&this.updateImage(o,h)}}}const Pe=1e20;function $e(m,r,o,h,f,y,w,S,k){for(let C=r;C<r+h;C++)We(m,o*y+C,y,f,w,S,k);for(let C=o;C<o+f;C++)We(m,C*y+r,1,h,w,S,k)}function We(m,r,o,h,f,y,w){y[0]=0,w[0]=-Pe,w[1]=Pe,f[0]=m[r];for(let S=1,k=0,C=0;S<h;S++){f[S]=m[r+S*o];const D=S*S;do{const P=y[k];C=(f[S]-f[P]+D-P*P)/(S-P)/2}while(C<=w[k]&&--k>-1);k++,y[k]=S,w[k]=C,w[k+1]=Pe}for(let S=0,k=0;S<h;S++){for(;w[k+1]<S;)k++;const C=y[k],D=S-C;m[r+S*o]=f[C]+D*D}}class Je{constructor(r,o){this.requestManager=r,this.localIdeographFontFamily=o,this.entries={}}setURL(r){this.url=r}getGlyphs(r,o){const h=[];for(const f in r)for(const y of r[f])h.push({stack:f,id:y});c.o(h,({stack:f,id:y},w)=>{let S=this.entries[f];S||(S=this.entries[f]={glyphs:{},requests:{},ranges:{}});let k=S.glyphs[y];if(k!==void 0)return void w(null,{stack:f,id:y,glyph:k});if(k=this._tinySDF(S,f,y),k)return S.glyphs[y]=k,void w(null,{stack:f,id:y,glyph:k});const C=Math.floor(y/256);if(256*C>65535)return void w(new Error("glyphs > 65535 not supported"));if(S.ranges[C])return void w(null,{stack:f,id:y,glyph:k});if(!this.url)return void w(new Error("glyphsUrl is not set"));let D=S.requests[C];D||(D=S.requests[C]=[],Je.loadGlyphRange(f,C,this.url,this.requestManager,(P,N)=>{if(N){for(const H in N)this._doesCharSupportLocalGlyph(+H)||(S.glyphs[+H]=N[+H]);S.ranges[C]=!0}for(const H of D)H(P,N);delete S.requests[C]})),D.push((P,N)=>{P?w(P):N&&w(null,{stack:f,id:y,glyph:N[y]||null})})},(f,y)=>{if(f)o(f);else if(y){const w={};for(const{stack:S,id:k,glyph:C}of y)(w[S]||(w[S]={}))[k]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics};o(null,w)}})}_doesCharSupportLocalGlyph(r){return!!this.localIdeographFontFamily&&(c.u["CJK Unified Ideographs"](r)||c.u["Hangul Syllables"](r)||c.u.Hiragana(r)||c.u.Katakana(r))}_tinySDF(r,o,h){const f=this.localIdeographFontFamily;if(!f||!this._doesCharSupportLocalGlyph(h))return;let y=r.tinySDF;if(!y){let S="400";/bold/i.test(o)?S="900":/medium/i.test(o)?S="500":/light/i.test(o)&&(S="200"),y=r.tinySDF=new Je.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:f,fontWeight:S})}const w=y.draw(String.fromCharCode(h));return{id:h,bitmap:new c.q({width:w.width||60,height:w.height||60},w.data),metrics:{width:w.glyphWidth/2||24,height:w.glyphHeight/2||24,left:w.glyphLeft/2+.5||0,top:w.glyphTop/2-27.5||-8,advance:w.glyphAdvance/2||24,isDoubleResolution:!0}}}}Je.loadGlyphRange=function(m,r,o,h,f){const y=256*r,w=y+255,S=h.transformRequest(o.replace("{fontstack}",m).replace("{range}",`${y}-${w}`),Y.Glyphs);c.l(S,(k,C)=>{if(k)f(k);else if(C){const D={};for(const P of c.n(C))D[P.id]=P;f(null,D)}})},Je.TinySDF=class{constructor({fontSize:m=24,buffer:r=3,radius:o=8,cutoff:h=.25,fontFamily:f="sans-serif",fontWeight:y="normal",fontStyle:w="normal"}={}){this.buffer=r,this.cutoff=h,this.radius=o;const S=this.size=m+4*r,k=this._createCanvas(S),C=this.ctx=k.getContext("2d",{willReadFrequently:!0});C.font=`${w} ${y} ${m}px ${f}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(m){const r=document.createElement("canvas");return r.width=r.height=m,r}draw(m){const{width:r,actualBoundingBoxAscent:o,actualBoundingBoxDescent:h,actualBoundingBoxLeft:f,actualBoundingBoxRight:y}=this.ctx.measureText(m),w=Math.ceil(o),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-f))),k=Math.min(this.size-this.buffer,w+Math.ceil(h)),C=S+2*this.buffer,D=k+2*this.buffer,P=Math.max(C*D,0),N=new Uint8ClampedArray(P),H={data:N,width:C,height:D,glyphWidth:S,glyphHeight:k,glyphTop:w,glyphLeft:0,glyphAdvance:r};if(S===0||k===0)return H;const{ctx:W,buffer:X,gridInner:G,gridOuter:pe}=this;W.clearRect(X,X,S,k),W.fillText(m,X,X+w);const we=W.getImageData(X,X,S,k);pe.fill(Pe,0,P),G.fill(0,0,P);for(let re=0;re<k;re++)for(let me=0;me<S;me++){const Te=we.data[4*(re*S+me)+3]/255;if(Te===0)continue;const ke=(re+X)*C+me+X;if(Te===1)pe[ke]=0,G[ke]=Pe;else{const Re=.5-Te;pe[ke]=Re>0?Re*Re:0,G[ke]=Re<0?Re*Re:0}}$e(pe,0,0,C,D,C,this.f,this.v,this.z),$e(G,X,X,S,k,C,this.f,this.v,this.z);for(let re=0;re<P;re++){const me=Math.sqrt(pe[re])-Math.sqrt(G[re]);N[re]=Math.round(255-255*(me/this.radius+this.cutoff))}return H}};class gt{constructor(){this.specification=c.v.light.position}possiblyEvaluate(r,o){return c.z(r.expression.evaluate(o))}interpolate(r,o,h){return{x:c.B.number(r.x,o.x,h),y:c.B.number(r.y,o.y,h),z:c.B.number(r.z,o.z,h)}}}let Ne;class ht extends c.E{constructor(r){super(),Ne=Ne||new c.r({anchor:new c.D(c.v.light.anchor),position:new gt,color:new c.D(c.v.light.color),intensity:new c.D(c.v.light.intensity)}),this._transitionable=new c.T(Ne),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,o={}){if(!this._validate(c.t,r,o))for(const h in r){const f=r[h];h.endsWith("-transition")?this._transitionable.setTransition(h.slice(0,-11),f):this._transitionable.setValue(h,f)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,o,h){return(!h||h.validate!==!1)&&c.x(this,r.call(c.y,c.e({value:o,style:{glyphs:!0,sprite:!0},styleSpec:c.v})))}}class _t{constructor(r,o){this.width=r,this.height=o,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(r,o){const h=r.join(",")+String(o);return this.dashEntry[h]||(this.dashEntry[h]=this.addDash(r,o)),this.dashEntry[h]}getDashRanges(r,o,h){const f=[];let y=r.length%2==1?-r[r.length-1]*h:0,w=r[0]*h,S=!0;f.push({left:y,right:w,isDash:S,zeroLength:r[0]===0});let k=r[0];for(let C=1;C<r.length;C++){S=!S;const D=r[C];y=k*h,k+=D,w=k*h,f.push({left:y,right:w,isDash:S,zeroLength:D===0})}return f}addRoundDash(r,o,h){const f=o/2;for(let y=-h;y<=h;y++){const w=this.width*(this.nextRow+h+y);let S=0,k=r[S];for(let C=0;C<this.width;C++){C/k.right>1&&(k=r[++S]);const D=Math.abs(C-k.left),P=Math.abs(C-k.right),N=Math.min(D,P);let H;const W=y/h*(f+1);if(k.isDash){const X=f-Math.abs(W);H=Math.sqrt(N*N+X*X)}else H=f-Math.sqrt(N*N+W*W);this.data[w+C]=Math.max(0,Math.min(255,H+128))}}}addRegularDash(r){for(let S=r.length-1;S>=0;--S){const k=r[S],C=r[S+1];k.zeroLength?r.splice(S,1):C&&C.isDash===k.isDash&&(C.left=k.left,r.splice(S,1))}const o=r[0],h=r[r.length-1];o.isDash===h.isDash&&(o.left=h.left-this.width,h.right=o.right+this.width);const f=this.width*this.nextRow;let y=0,w=r[y];for(let S=0;S<this.width;S++){S/w.right>1&&(w=r[++y]);const k=Math.abs(S-w.left),C=Math.abs(S-w.right),D=Math.min(k,C);this.data[f+S]=Math.max(0,Math.min(255,(w.isDash?D:-D)+128))}}addDash(r,o){const h=o?7:0,f=2*h+1;if(this.nextRow+f>this.height)return c.w("LineAtlas out of space"),null;let y=0;for(let S=0;S<r.length;S++)y+=r[S];if(y!==0){const S=this.width/y,k=this.getDashRanges(r,this.width,S);o?this.addRoundDash(k,S,h):this.addRegularDash(k)}const w={y:(this.nextRow+h+.5)/this.height,height:2*h/this.height,width:y};return this.nextRow+=f,this.dirty=!0,w}bind(r){const o=r.gl;this.texture?(o.bindTexture(o.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,o.texSubImage2D(o.TEXTURE_2D,0,0,0,this.width,this.height,o.ALPHA,o.UNSIGNED_BYTE,this.data))):(this.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.ALPHA,this.width,this.height,0,o.ALPHA,o.UNSIGNED_BYTE,this.data))}}class er{constructor(r,o,h){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=h;const f=this.workerPool.acquire(h);for(let y=0;y<f.length;y++){const w=new c.C(f[y],o,h);w.name=`Worker ${y}`,this.actors.push(w)}if(!this.actors.length)throw new Error("No actors found")}broadcast(r,o,h){c.o(this.actors,(f,y)=>{f.send(r,o,y)},h=h||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(r=!0){this.actors.forEach(o=>{o.remove()}),this.actors=[],r&&this.workerPool.release(this.id)}}function Xt(m,r,o){const h=function(f,y){if(f)return o(f);if(y){const w=c.F(c.e(y,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);y.vector_layers&&(w.vectorLayers=y.vector_layers,w.vectorLayerIds=w.vectorLayers.map(S=>S.id)),o(null,w)}};return m.url?c.f(r.transformRequest(m.url,Y.Source),h):c.h.frame(()=>h(null,m))}class ar{constructor(r,o){r&&(o?this.setSouthWest(r).setNorthEast(o):Array.isArray(r)&&(r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1])))}setNorthEast(r){return this._ne=r instanceof c.L?new c.L(r.lng,r.lat):c.L.convert(r),this}setSouthWest(r){return this._sw=r instanceof c.L?new c.L(r.lng,r.lat):c.L.convert(r),this}extend(r){const o=this._sw,h=this._ne;let f,y;if(r instanceof c.L)f=r,y=r;else{if(!(r instanceof ar))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(ar.convert(r)):this.extend(c.L.convert(r)):r&&("lng"in r||"lon"in r)&&"lat"in r?this.extend(c.L.convert(r)):this;if(f=r._sw,y=r._ne,!f||!y)return this}return o||h?(o.lng=Math.min(f.lng,o.lng),o.lat=Math.min(f.lat,o.lat),h.lng=Math.max(y.lng,h.lng),h.lat=Math.max(y.lat,h.lat)):(this._sw=new c.L(f.lng,f.lat),this._ne=new c.L(y.lng,y.lat)),this}getCenter(){return new c.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.L(this.getWest(),this.getNorth())}getSouthEast(){return new c.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:o,lat:h}=c.L.convert(r);let f=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&f}static convert(r){return r instanceof ar?r:r&&new ar(r)}static fromLngLat(r,o=0){const h=360*o/40075017,f=h/Math.cos(Math.PI/180*r.lat);return new ar(new c.L(r.lng-f,r.lat-h),new c.L(r.lng+f,r.lat+h))}}class dt{constructor(r,o,h){this.bounds=ar.convert(this.validateBounds(r)),this.minzoom=o||0,this.maxzoom=h||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const o=Math.pow(2,r.z),h=Math.floor(c.G(this.bounds.getWest())*o),f=Math.floor(c.H(this.bounds.getNorth())*o),y=Math.ceil(c.G(this.bounds.getEast())*o),w=Math.ceil(c.H(this.bounds.getSouth())*o);return r.x>=h&&r.x<y&&r.y>=f&&r.y<w}}class Nt extends c.E{constructor(r,o,h,f){if(super(),this.load=()=>{this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Xt(this._options,this.map._requestManager,(y,w)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),y?this.fire(new c.j(y)):w&&(c.e(this,w),w.bounds&&(this.tileBounds=new dt(w.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>c.e({},this._options),this.id=r,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.F(o,["url","scheme","tileSize","promoteId"])),this._options=c.e({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f)}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}setSourceProperty(r){this._tileJSONRequest&&this._tileJSONRequest.cancel(),r(),this.load()}setTiles(r){return this.setSourceProperty(()=>{this._options.tiles=r}),this}setUrl(r){return this.setSourceProperty(()=>{this.url=r,this._options.url=r}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(r,o){const h=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f={request:this.map._requestManager.transformRequest(h,Y.Tile),uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function y(w,S){return delete r.request,r.aborted?o(null):w&&w.status!==404?o(w):(S&&S.resourceTiming&&(r.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&S&&r.setExpiryData(S),r.loadVectorData(S,this.map.painter),o(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}f.request.collectResourceTiming=this._collectResourceTiming,r.actor&&r.state!=="expired"?r.state==="loading"?r.reloadCallback=o:r.request=r.actor.send("reloadTile",f,y.bind(this)):(r.actor=this.dispatcher.getActor(),r.request=r.actor.send("loadTile",f,y.bind(this)))}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id},void 0)}unloadTile(r){r.unloadVectorData(),r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class or extends c.E{constructor(r,o,h,f){super(),this.id=r,this.dispatcher=h,this.setEventedParent(f),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},o),c.e(this,c.F(o,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Xt(this._options,this.map._requestManager,(r,o)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new c.j(r)):o&&(c.e(this,o),o.bounds&&(this.tileBounds=new dt(o.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(r){this._tileJSONRequest&&this._tileJSONRequest.cancel(),r(),this.load()}setTiles(r){return this.setSourceProperty(()=>{this._options.tiles=r}),this}serialize(){return c.e({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,o){const h=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);r.request=ie.getImage(this.map._requestManager.transformRequest(h,Y.Tile),(f,y,w)=>{if(delete r.request,r.aborted)r.state="unloaded",o(null);else if(f)r.state="errored",o(f);else if(y){this.map._refreshExpiredTiles&&w&&r.setExpiryData(w);const S=this.map.painter.context,k=S.gl;r.texture=this.map.painter.getTileTexture(y.width),r.texture?r.texture.update(y,{useMipmap:!0}):(r.texture=new De(S,y,k.RGBA,{useMipmap:!0}),r.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST),S.extTextureFilterAnisotropic&&k.texParameterf(k.TEXTURE_2D,S.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,S.extTextureFilterAnisotropicMax)),r.state="loaded",o(null)}},this.map._refreshExpiredTiles)}abortTile(r,o){r.request&&(r.request.cancel(),delete r.request),o()}unloadTile(r,o){r.texture&&this.map.painter.saveTileTexture(r.texture),o()}hasTransition(){return!1}}class wt extends or{constructor(r,o,h,f){super(r,o,h,f),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox",this.redFactor=o.redFactor,this.greenFactor=o.greenFactor,this.blueFactor=o.blueFactor,this.baseShift=o.baseShift}loadTile(r,o){const h=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f=this.map._requestManager.transformRequest(h,Y.Tile);function y(w,S){w&&(r.state="errored",o(w)),S&&(r.dem=S,r.needsHillshadePrepare=!0,r.needsTerrainPrepare=!0,r.state="loaded",o(null))}r.neighboringTiles=this._getNeighboringTiles(r.tileID),r.request=ie.getImage(f,(w,S,k)=>c._(this,void 0,void 0,function*(){if(delete r.request,r.aborted)r.state="unloaded",o(null);else if(w)r.state="errored",o(w);else if(S){this.map._refreshExpiredTiles&&r.setExpiryData(k);const C=c.a(S)&&c.J()?S:yield function(P){return c._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&c.K()){const N=P.width+2,H=P.height+2;try{return new c.R({width:N,height:H},yield c.M(P,-1,-1,N,H))}catch{}}return c.h.getImageData(P,1)})}(S),D={uid:r.uid,coord:r.tileID,source:this.id,rawImageData:C,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};r.actor&&r.state!=="expired"||(r.actor=this.dispatcher.getActor(),r.actor.send("loadDEMTile",D,y))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(r){const o=r.canonical,h=Math.pow(2,o.z),f=(o.x-1+h)%h,y=o.x===0?r.wrap-1:r.wrap,w=(o.x+1+h)%h,S=o.x+1===h?r.wrap+1:r.wrap,k={};return k[new c.O(r.overscaledZ,y,o.z,f,o.y).key]={backfilled:!1},k[new c.O(r.overscaledZ,S,o.z,w,o.y).key]={backfilled:!1},o.y>0&&(k[new c.O(r.overscaledZ,y,o.z,f,o.y-1).key]={backfilled:!1},k[new c.O(r.overscaledZ,r.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},k[new c.O(r.overscaledZ,S,o.z,w,o.y-1).key]={backfilled:!1}),o.y+1<h&&(k[new c.O(r.overscaledZ,y,o.z,f,o.y+1).key]={backfilled:!1},k[new c.O(r.overscaledZ,r.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},k[new c.O(r.overscaledZ,S,o.z,w,o.y+1).key]={backfilled:!1}),k}unloadTile(r){r.demTexture&&this.map.painter.saveTileTexture(r.demTexture),r.fbo&&(r.fbo.destroy(),delete r.fbo),r.dem&&delete r.dem,delete r.neighboringTiles,r.state="unloaded",r.actor&&r.actor.send("removeDEMTile",{uid:r.uid,source:this.id})}}class je extends c.E{constructor(r,o,h,f){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>c.e({},this._options,{type:this.type,data:this._data}),this.id=r,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=h.getActor(),this.setEventedParent(f),this._data=o.data,this._options=c.e({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const y=c.N/this.tileSize;this.workerOptions=c.e({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*y,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*y,extent:c.N,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:c.N,radius:(o.clusterRadius||50)*y,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(r){this.map=r,this.load()}setData(r){return this._data=r,this._updateWorkerData(),this}updateData(r){return this._updateWorkerData(r),this}setClusterOptions(r){return this.workerOptions.cluster=r.cluster,r&&(r.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=r.clusterRadius),r.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=r.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(r,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:r,source:this.id},o),this}getClusterChildren(r,o){return this.actor.send("geojson.getClusterChildren",{clusterId:r,source:this.id},o),this}getClusterLeaves(r,o,h,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:r,limit:o,offset:h},f),this}_updateWorkerData(r){const o=c.e({},this.workerOptions);r?o.dataDiff=r:typeof this._data=="string"?(o.request=this.map._requestManager.transformRequest(c.h.resolveURL(this._data),Y.Source),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new c.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,o,(h,f)=>{if(this._pendingLoads--,this._removed||f&&f.abandoned)return void this.fire(new c.k("dataabort",{dataType:"source"}));let y=null;if(f&&f.resourceTiming&&f.resourceTiming[this.id]&&(y=f.resourceTiming[this.id].slice(0)),h)return void this.fire(new c.j(h));const w={dataType:"source"};this._collectResourceTiming&&y&&y.length>0&&c.e(w,{resourceTiming:y}),this.fire(new c.k("data",Object.assign(Object.assign({},w),{sourceDataType:"metadata"}))),this.fire(new c.k("data",Object.assign(Object.assign({},w),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(r,o){const h=r.actor?"reloadTile":"loadTile";r.actor=this.actor;const f={type:this.type,uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};r.request=this.actor.send(h,f,(y,w)=>(delete r.request,r.unloadVectorData(),r.aborted?o(null):y?o(y):(r.loadVectorData(w,this.map.painter,h==="reloadTile"),o(null))))}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.aborted=!0}unloadTile(r){r.unloadVectorData(),this.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var Pt=c.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class zt extends c.E{constructor(r,o,h,f){super(),this.load=(y,w)=>{this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=ie.getImage(this.map._requestManager.transformRequest(this.url,Y.Image),(S,k)=>{this._request=null,this._loaded=!0,S?this.fire(new c.j(S)):k&&(this.image=k,y&&(this.coordinates=y),w&&w(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const y=this.map.painter.context,w=y.gl;this.boundsBuffer||(this.boundsBuffer=y.createVertexBuffer(this._boundsArray,Pt.members)),this.boundsSegments||(this.boundsSegments=c.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new De(y,this.image,w.RGBA),this.texture.bind(w.LINEAR,w.CLAMP_TO_EDGE));let S=!1;for(const k in this.tiles){const C=this.tiles[k];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,S=!0)}S&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=r,this.dispatcher=h,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(f),this.options=o}loaded(){return this._loaded}updateImage(r){return r.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=r.url,this.load(r.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(r){this.coordinates=r;const o=r.map(c.U.fromLngLat);this.tileID=function(f){let y=1/0,w=1/0,S=-1/0,k=-1/0;for(const N of f)y=Math.min(y,N.x),w=Math.min(w,N.y),S=Math.max(S,N.x),k=Math.max(k,N.y);const C=Math.max(S-y,k-w),D=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),P=Math.pow(2,D);return new c.W(D,Math.floor((y+S)/2*P),Math.floor((w+k)/2*P))}(o),this.minzoom=this.maxzoom=this.tileID.z;const h=o.map(f=>this.tileID.getTilePoint(f)._round());return this._boundsArray=new c.V,this._boundsArray.emplaceBack(h[0].x,h[0].y,0,0),this._boundsArray.emplaceBack(h[1].x,h[1].y,c.N,0),this._boundsArray.emplaceBack(h[3].x,h[3].y,0,c.N),this._boundsArray.emplaceBack(h[2].x,h[2].y,c.N,c.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(r,o){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},o(null)):(r.state="errored",o(null))}hasTransition(){return!1}}class dr extends zt{constructor(r,o,h,f){super(r,o,h,f),this.load=()=>{this._loaded=!1;const y=this.options;this.urls=[];for(const w of y.urls)this.urls.push(this.map._requestManager.transformRequest(w,Y.Source).url);c.X(this.urls,(w,S)=>{this._loaded=!0,w?this.fire(new c.j(w)):S&&(this.video=S,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const y=this.map.painter.context,w=y.gl;this.boundsBuffer||(this.boundsBuffer=y.createVertexBuffer(this._boundsArray,Pt.members)),this.boundsSegments||(this.boundsSegments=c.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(w.LINEAR,w.CLAMP_TO_EDGE),w.texSubImage2D(w.TEXTURE_2D,0,0,0,w.RGBA,w.UNSIGNED_BYTE,this.video)):(this.texture=new De(y,this.video,w.RGBA),this.texture.bind(w.LINEAR,w.CLAMP_TO_EDGE));let S=!1;for(const k in this.tiles){const C=this.tiles[k];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,S=!0)}S&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=o}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(r){if(this.video){const o=this.video.seekable;r<o.start(0)||r>o.end(0)?this.fire(new c.j(new c.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=r}}getVideo(){return this.video}onAdd(r){this.map||(this.map=r,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class ir extends zt{constructor(r,o,h,f){super(r,o,h,f),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let y=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,y=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,y=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const w=this.map.painter.context,S=w.gl;this.boundsBuffer||(this.boundsBuffer=w.createVertexBuffer(this._boundsArray,Pt.members)),this.boundsSegments||(this.boundsSegments=c.S.simpleSegment(0,0,4,2)),this.texture?(y||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new De(w,this.canvas,S.RGBA,{premultiply:!0});let k=!1;for(const C in this.tiles){const D=this.tiles[C];D.state!=="loaded"&&(D.state="loaded",D.texture=this.texture,k=!0)}k&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(w=>typeof w!="number"))||this.fire(new c.j(new c.Y(`sources.${r}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.j(new c.Y(`sources.${r}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new c.j(new c.Y(`sources.${r}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new c.j(new c.Y(`sources.${r}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.j(new c.Y(`sources.${r}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}getCanvas(){return this.canvas}onAdd(r){this.map=r,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const r of[this.canvas.width,this.canvas.height])if(isNaN(r)||r<=0)return!0;return!1}}const $r={},br=m=>{switch(m){case"geojson":return je;case"image":return zt;case"raster":return or;case"raster-dem":return wt;case"vector":return Nt;case"video":return dr;case"canvas":return ir}return $r[m]};function pr(m,r){const o=c.Z();return c.$(o,o,[1,1,0]),c.a0(o,o,[.5*m.width,.5*m.height,1]),c.a1(o,o,m.calculatePosMatrix(r.toUnwrapped()))}function Kr(m,r,o,h,f,y){const w=function(P,N,H){if(P)for(const W of P){const X=N[W];if(X&&X.source===H&&X.type==="fill-extrusion")return!0}else for(const W in N){const X=N[W];if(X.source===H&&X.type==="fill-extrusion")return!0}return!1}(f&&f.layers,r,m.id),S=y.maxPitchScaleFactor(),k=m.tilesIn(h,S,w);k.sort(ai);const C=[];for(const P of k)C.push({wrappedTileID:P.tileID.wrapped().key,queryResults:P.tile.queryRenderedFeatures(r,o,m._state,P.queryGeometry,P.cameraQueryGeometry,P.scale,f,y,S,pr(m.transform,P.tileID))});const D=function(P){const N={},H={};for(const W of P){const X=W.queryResults,G=W.wrappedTileID,pe=H[G]=H[G]||{};for(const we in X){const re=X[we],me=pe[we]=pe[we]||{},Te=N[we]=N[we]||[];for(const ke of re)me[ke.featureIndex]||(me[ke.featureIndex]=!0,Te.push(ke))}}return N}(C);for(const P in D)D[P].forEach(N=>{const H=N.feature,W=m.getFeatureState(H.layer["source-layer"],H.id);H.source=H.layer.source,H.layer["source-layer"]&&(H.sourceLayer=H.layer["source-layer"]),H.state=W});return D}function ai(m,r){const o=m.tileID,h=r.tileID;return o.overscaledZ-h.overscaledZ||o.canonical.y-h.canonical.y||o.wrap-h.wrap||o.canonical.x-h.canonical.x}class Gi{constructor(r,o){this.timeAdded=0,this.fadeEndTime=0,this.tileID=r,this.uid=c.a2(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(r){const o=r+this.timeAdded;o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(r){this.demTexture&&r.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(r,o,h){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(f,y){const w={};if(!y)return w;for(const S of f){const k=S.layerIds.map(C=>y.getLayer(C)).filter(Boolean);if(k.length!==0){S.layers=k,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(C=>k.filter(D=>D.id===C)[0]));for(const C of k)w[C.id]=S}}return w}(r.buckets,o.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const y=this.buckets[f];if(y instanceof c.a4){if(this.hasSymbolBuckets=!0,!h)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const y=this.buckets[f];if(y instanceof c.a4&&y.hasRTLText){this.hasRTLText=!0,c.a5();break}}this.queryPadding=0;for(const f in this.buckets){const y=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(f).queryRadius(y))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage)}else this.collisionBoxArray=new c.a3}unloadVectorData(){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(r){return this.buckets[r.id]}upload(r){for(const h in this.buckets){const f=this.buckets[h];f.uploadPending()&&f.upload(r)}const o=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new De(r,this.imageAtlas.image,o.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new De(r,this.glyphAtlasImage,o.ALPHA),this.glyphAtlasImage=null)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,o,h,f,y,w,S,k,C,D){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:f,cameraQueryGeometry:y,scale:w,tileSize:this.tileSize,pixelPosMatrix:D,transform:k,params:S,queryPadding:this.queryPadding*C},r,o,h):{}}querySourceFeatures(r,o){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const f=h.loadVTLayers(),y=o&&o.sourceLayer?o.sourceLayer:"",w=f._geojsonTileLayer||f[y];if(!w)return;const S=c.a6(o&&o.filter),{z:k,x:C,y:D}=this.tileID.canonical,P={z:k,x:C,y:D};for(let N=0;N<w.length;N++){const H=w.feature(N);if(S.needGeometry){const G=c.a7(H,!0);if(!S.filter(new c.a8(this.tileID.overscaledZ),G,this.tileID.canonical))continue}else if(!S.filter(new c.a8(this.tileID.overscaledZ),H))continue;const W=h.getId(H,y),X=new c.a9(H,k,C,D,W);X.tile=P,r.push(X)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const o=this.expirationTime;if(r.cacheControl){const h=c.aa(r.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const h=Date.now();let f=!1;if(this.expirationTime>h)f=!1;else if(o)if(this.expirationTime<o)f=!0;else{const y=this.expirationTime-o;y?this.expirationTime=h+Math.max(y,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(r,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(r).length===0)return;const h=this.latestFeatureIndex.loadVTLayers();for(const f in this.buckets){if(!o.style.hasLayer(f))continue;const y=this.buckets[f],w=y.layers[0].sourceLayer||"_geojsonTileLayer",S=h[w],k=r[w];if(!S||!k||Object.keys(k).length===0)continue;y.update(k,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});const C=o&&o.style&&o.style.getLayer(f);C&&(this.queryPadding=Math.max(this.queryPadding,C.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<c.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=c.h.now()+r}setDependencies(r,o){const h={};for(const f of o)h[f]=!0;this.dependencies[r]=h}hasDependency(r,o){for(const h of r){const f=this.dependencies[h];if(f){for(const y of o)if(f[y])return!0}}return!1}}class Mi{constructor(r,o){this.max=r,this.onRemove=o,this.reset()}reset(){for(const r in this.data)for(const o of this.data[r])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(r,o,h){const f=r.wrapped().key;this.data[f]===void 0&&(this.data[f]=[]);const y={value:o,timeout:void 0};if(h!==void 0&&(y.timeout=setTimeout(()=>{this.remove(r,y)},h)),this.data[f].push(y),this.order.push(f),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const o=this.data[r].shift();return o.timeout&&clearTimeout(o.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),o.value}getByKey(r){const o=this.data[r];return o?o[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,o){if(!this.has(r))return this;const h=r.wrapped().key,f=o===void 0?0:this.data[h].indexOf(o),y=this.data[h][f];return this.data[h].splice(f,1),y.timeout&&clearTimeout(y.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(y.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(r){const o=[];for(const h in this.data)for(const f of this.data[h])r(f.value)||o.push(f);for(const h of o)this.remove(h.value.tileID,h)}}class Ce{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,o,h){const f=String(o);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][f]=this.stateChanges[r][f]||{},c.e(this.stateChanges[r][f],h),this.deletedStates[r]===null){this.deletedStates[r]={};for(const y in this.state[r])y!==f&&(this.deletedStates[r][y]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][f]===null){this.deletedStates[r][f]={};for(const y in this.state[r][f])h[y]||(this.deletedStates[r][f][y]=null)}else for(const y in h)this.deletedStates[r]&&this.deletedStates[r][f]&&this.deletedStates[r][f][y]===null&&delete this.deletedStates[r][f][y]}removeFeatureState(r,o,h){if(this.deletedStates[r]===null)return;const f=String(o);if(this.deletedStates[r]=this.deletedStates[r]||{},h&&o!==void 0)this.deletedStates[r][f]!==null&&(this.deletedStates[r][f]=this.deletedStates[r][f]||{},this.deletedStates[r][f][h]=null);else if(o!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][f])for(h in this.deletedStates[r][f]={},this.stateChanges[r][f])this.deletedStates[r][f][h]=null;else this.deletedStates[r][f]=null;else this.deletedStates[r]=null}getState(r,o){const h=String(o),f=c.e({},(this.state[r]||{})[h],(this.stateChanges[r]||{})[h]);if(this.deletedStates[r]===null)return{};if(this.deletedStates[r]){const y=this.deletedStates[r][o];if(y===null)return{};for(const w in y)delete f[w]}return f}initializeTileState(r,o){r.setFeatureState(this.state,o)}coalesceChanges(r,o){const h={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const y={};for(const w in this.stateChanges[f])this.state[f][w]||(this.state[f][w]={}),c.e(this.state[f][w],this.stateChanges[f][w]),y[w]=this.state[f][w];h[f]=y}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const y={};if(this.deletedStates[f]===null)for(const w in this.state[f])y[w]={},this.state[f][w]={};else for(const w in this.deletedStates[f]){if(this.deletedStates[f][w]===null)this.state[f][w]={};else for(const S of Object.keys(this.deletedStates[f][w]))delete this.state[f][w][S];y[w]=this.state[f][w]}h[f]=h[f]||{},c.e(h[f],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(const f in r)r[f].setFeatureState(h,o)}}class di extends c.E{constructor(r,o,h){super(),this.id=r,this.dispatcher=h,this.on("data",f=>{f.dataType==="source"&&f.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&f.dataType==="source"&&f.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((f,y,w,S)=>{const k=new(br(y.type))(f,y,w,S);if(k.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${k.id}`);return k})(r,o,h,this),this._tiles={},this._cache=new Mi(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ce,this._didEmitContent=!1,this._updated=!1}onAdd(r){this.map=r,this._maxTileCacheSize=r?r._maxTileCacheSize:null,this._maxTileCacheZoomLevels=r?r._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(r)}onRemove(r){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(r)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const r in this._tiles){const o=this._tiles[r];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(r,o){return this._source.loadTile(r,o)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,()=>{})}_abortTile(r){this._source.abortTile&&this._source.abortTile(r,()=>{}),this._source.fire(new c.k("dataabort",{tile:r,coord:r.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const h=this._tiles[o];h.upload(r),h.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(r=>r.tileID).sort(Si).map(r=>r.key)}getRenderableIds(r){const o=[];for(const h in this._tiles)this._isIdRenderable(h,r)&&o.push(this._tiles[h]);return r?o.sort((h,f)=>{const y=h.tileID,w=f.tileID,S=new c.P(y.canonical.x,y.canonical.y)._rotate(this.transform.angle),k=new c.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle);return y.overscaledZ-w.overscaledZ||k.y-S.y||k.x-S.x}).map(h=>h.tileID.key):o.map(h=>h.tileID).sort(Si).map(h=>h.key)}hasRenderableParent(r){const o=this.findLoadedParent(r,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(r,o){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(o||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(r,"reloading")}}_reloadTile(r,o){const h=this._tiles[r];h&&(h.state!=="loading"&&(h.state=o),this._loadTile(h,this._tileLoaded.bind(this,h,r,o)))}_tileLoaded(r,o,h,f){if(f)return r.state="errored",void(f.status!==404?this._source.fire(new c.j(f,{tile:r})):this.update(this.transform,this.terrain));r.timeAdded=c.h.now(),h==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(o,r),this.getSource().type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),r.aborted||this._source.fire(new c.k("data",{dataType:"source",tile:r,coord:r.tileID}))}_backfillDEM(r){const o=this.getRenderableIds();for(let f=0;f<o.length;f++){const y=o[f];if(r.neighboringTiles&&r.neighboringTiles[y]){const w=this.getTileByID(y);h(r,w),h(w,r)}}function h(f,y){f.needsHillshadePrepare=!0,f.needsTerrainPrepare=!0;let w=y.tileID.canonical.x-f.tileID.canonical.x;const S=y.tileID.canonical.y-f.tileID.canonical.y,k=Math.pow(2,f.tileID.canonical.z),C=y.tileID.key;w===0&&S===0||Math.abs(S)>1||(Math.abs(w)>1&&(Math.abs(w+k)===1?w+=k:Math.abs(w-k)===1&&(w-=k)),y.dem&&f.dem&&(f.dem.backfillBorder(y.dem,w,S),f.neighboringTiles&&f.neighboringTiles[C]&&(f.neighboringTiles[C].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,o,h,f){for(const y in this._tiles){let w=this._tiles[y];if(f[y]||!w.hasData()||w.tileID.overscaledZ<=o||w.tileID.overscaledZ>h)continue;let S=w.tileID;for(;w&&w.tileID.overscaledZ>o+1;){const C=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[C.key],w&&w.hasData()&&(S=C)}let k=S;for(;k.overscaledZ>o;)if(k=k.scaledTo(k.overscaledZ-1),r[k.key]){f[S.key]=S;break}}}findLoadedParent(r,o){if(r.key in this._loadedParentTiles){const h=this._loadedParentTiles[r.key];return h&&h.tileID.overscaledZ>=o?h:null}for(let h=r.overscaledZ-1;h>=o;h--){const f=r.scaledTo(h),y=this._getLoadedTile(f);if(y)return y}}_getLoadedTile(r){const o=this._tiles[r.key];return o&&o.hasData()?o:this._cache.getByKey(r.wrapped().key)}updateCacheSize(r){const o=Math.ceil(r.width/this._source.tileSize)+1,h=Math.ceil(r.height/this._source.tileSize)+1,f=Math.floor(o*h*(this._maxTileCacheZoomLevels===null?c.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,f):f;this._cache.setMaxSize(y)}handleWrapJump(r){const o=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,o){const h={};for(const f in this._tiles){const y=this._tiles[f];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+o),h[y.tileID.key]=y}this._tiles=h;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(f,this._tiles[f])}}update(r,o){if(this.transform=r,this.terrain=o,!this._sourceLoaded||this._paused)return;let h;this.updateCacheSize(r),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(D=>new c.O(D.canonical.z,D.wrap,D.canonical.z,D.canonical.x,D.canonical.y)):(h=r.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:o}),this._source.hasTile&&(h=h.filter(D=>this._source.hasTile(D)))):h=[];const f=r.coveringZoomLevel(this._source),y=Math.max(f-di.maxOverzooming,this._source.minzoom),w=Math.max(f+di.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const D={};for(const P of h)if(P.canonical.z>this._source.minzoom){const N=P.scaledTo(P.canonical.z-1);D[N.key]=N;const H=P.scaledTo(Math.max(this._source.minzoom,Math.min(P.canonical.z,5)));D[H.key]=H}h=h.concat(Object.values(D))}const S=h.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,S&&this.fire(new c.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const k=this._updateRetainedTiles(h,f);if(mr(this._source.type)){const D={},P={},N=Object.keys(k),H=c.h.now();for(const W of N){const X=k[W],G=this._tiles[W];if(!G||G.fadeEndTime!==0&&G.fadeEndTime<=H)continue;const pe=this.findLoadedParent(X,y);pe&&(this._addTile(pe.tileID),D[pe.tileID.key]=pe.tileID),P[W]=X}this._retainLoadedChildren(P,f,w,k);for(const W in D)k[W]||(this._coveredTiles[W]=!0,k[W]=D[W]);if(o){const W={},X={};for(const G of h)this._tiles[G.key].hasData()?W[G.key]=G:X[G.key]=G;for(const G in X){const pe=X[G].children(this._source.maxzoom);this._tiles[pe[0].key]&&this._tiles[pe[1].key]&&this._tiles[pe[2].key]&&this._tiles[pe[3].key]&&(W[pe[0].key]=k[pe[0].key]=pe[0],W[pe[1].key]=k[pe[1].key]=pe[1],W[pe[2].key]=k[pe[2].key]=pe[2],W[pe[3].key]=k[pe[3].key]=pe[3],delete X[G])}for(const G in X){const pe=this.findLoadedParent(X[G],this._source.minzoom);if(pe){W[pe.tileID.key]=k[pe.tileID.key]=pe.tileID;for(const we in W)W[we].isChildOf(pe.tileID)&&delete W[we]}}for(const G in this._tiles)W[G]||(this._coveredTiles[G]=!0)}}for(const D in k)this._tiles[D].clearFadeHold();const C=c.ab(this._tiles,k);for(const D of C){const P=this._tiles[D];P.hasSymbolBuckets&&!P.holdingForFade()?P.setHoldDuration(this.map._fadeDuration):P.hasSymbolBuckets&&!P.symbolFadeFinished()||this._removeTile(D)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(r)}_updateRetainedTiles(r,o){const h={},f={},y=Math.max(o-di.maxOverzooming,this._source.minzoom),w=Math.max(o+di.maxUnderzooming,this._source.minzoom),S={};for(const k of r){const C=this._addTile(k);h[k.key]=k,C.hasData()||o<this._source.maxzoom&&(S[k.key]=k)}this._retainLoadedChildren(S,o,w,h);for(const k of r){let C=this._tiles[k.key];if(C.hasData())continue;if(o+1>this._source.maxzoom){const P=k.children(this._source.maxzoom)[0],N=this.getTile(P);if(N&&N.hasData()){h[P.key]=P;continue}}else{const P=k.children(this._source.maxzoom);if(h[P[0].key]&&h[P[1].key]&&h[P[2].key]&&h[P[3].key])continue}let D=C.wasRequested();for(let P=k.overscaledZ-1;P>=y;--P){const N=k.scaledTo(P);if(f[N.key])break;if(f[N.key]=!0,C=this.getTile(N),!C&&D&&(C=this._addTile(N)),C){const H=C.hasData();if((D||H)&&(h[N.key]=N),D=C.wasRequested(),H)break}}}return h}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const o=[];let h,f=this._tiles[r].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){h=this._loadedParentTiles[f.key];break}o.push(f.key);const y=f.scaledTo(f.overscaledZ-1);if(h=this._getLoadedTile(y),h)break;f=y}for(const y of o)this._loadedParentTiles[y]=h}}_addTile(r){let o=this._tiles[r.key];if(o)return o;o=this._cache.getAndRemove(r),o&&(this._setTileReloadTimer(r.key,o),o.tileID=r,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,o)));const h=o;return o||(o=new Gi(r,this._source.tileSize*r.overscaleFactor()),this._loadTile(o,this._tileLoaded.bind(this,o,r.key,o.state))),o.uses++,this._tiles[r.key]=o,h||this._source.fire(new c.k("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o}_setTileReloadTimer(r,o){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const h=o.getExpiryTimeout();h&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},h))}_removeTile(r){const o=this._tiles[r];o&&(o.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),o.uses>0||(o.hasData()&&o.state!=="reloading"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(r);this._cache.reset()}tilesIn(r,o,h){const f=[],y=this.transform;if(!y)return f;const w=h?y.getCameraQueryGeometry(r):r,S=r.map(W=>y.pointCoordinate(W,this.terrain)),k=w.map(W=>y.pointCoordinate(W,this.terrain)),C=this.getIds();let D=1/0,P=1/0,N=-1/0,H=-1/0;for(const W of k)D=Math.min(D,W.x),P=Math.min(P,W.y),N=Math.max(N,W.x),H=Math.max(H,W.y);for(let W=0;W<C.length;W++){const X=this._tiles[C[W]];if(X.holdingForFade())continue;const G=X.tileID,pe=Math.pow(2,y.zoom-X.tileID.overscaledZ),we=o*X.queryPadding*c.N/X.tileSize/pe,re=[G.getTilePoint(new c.U(D,P)),G.getTilePoint(new c.U(N,H))];if(re[0].x-we<c.N&&re[0].y-we<c.N&&re[1].x+we>=0&&re[1].y+we>=0){const me=S.map(ke=>G.getTilePoint(ke)),Te=k.map(ke=>G.getTilePoint(ke));f.push({tile:X,tileID:G,queryGeometry:me,cameraQueryGeometry:Te,scale:pe})}}return f}getVisibleCoordinates(r){const o=this.getRenderableIds(r).map(h=>this._tiles[h].tileID);for(const h of o)h.posMatrix=this.transform.calculatePosMatrix(h.toUnwrapped());return o}hasTransition(){if(this._source.hasTransition())return!0;if(mr(this._source.type)){const r=c.h.now();for(const o in this._tiles)if(this._tiles[o].fadeEndTime>=r)return!0}return!1}setFeatureState(r,o,h){this._state.updateState(r=r||"_geojsonTileLayer",o,h)}removeFeatureState(r,o,h){this._state.removeFeatureState(r=r||"_geojsonTileLayer",o,h)}getFeatureState(r,o){return this._state.getState(r=r||"_geojsonTileLayer",o)}setDependencies(r,o,h){const f=this._tiles[r];f&&f.setDependencies(o,h)}reloadTilesForDependencies(r,o){for(const h in this._tiles)this._tiles[h].hasDependency(r,o)&&this._reloadTile(h,"reloading");this._cache.filter(h=>!h.hasDependency(r,o))}}function Si(m,r){const o=Math.abs(2*m.wrap)-+(m.wrap<0),h=Math.abs(2*r.wrap)-+(r.wrap<0);return m.overscaledZ-r.overscaledZ||h-o||r.canonical.y-m.canonical.y||r.canonical.x-m.canonical.x}function mr(m){return m==="raster"||m==="image"||m==="video"}di.maxOverzooming=10,di.maxUnderzooming=3;const $t="mapboxgl_preloaded_worker_pool";class yi{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<yi.workerCount;)this.workers.push(new Worker(c.c.WORKER_URL));return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[$t]}numActive(){return Object.keys(this.active).length}}const Di=Math.floor(c.h.hardwareConcurrency/2);let Zi;function on(){return Zi||(Zi=new yi),Zi}yi.workerCount=c.ac(globalThis)?Math.max(Math.min(Di,3),1):1;class ln{constructor(r,o){this.reset(r,o)}reset(r,o){this.points=r||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=c.ad(r,0,1);let o=1,h=this._distances[o];const f=r*this.paddedLength+this.padding;for(;h<f&&o<this._distances.length;)h=this._distances[++o];const y=o-1,w=this._distances[y],S=h-w,k=S>0?(f-w)/S:0;return this.points[y].mult(1-k).add(this.points[o].mult(k))}}function oi(m,r){let o=!0;return m==="always"||m!=="never"&&r!=="never"||(o=!1),o}class Ki{constructor(r,o,h){const f=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(r/h),this.yCellCount=Math.ceil(o/h);for(let w=0;w<this.xCellCount*this.yCellCount;w++)f.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=o,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,o,h,f,y){this._forEachCell(o,h,f,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(f),this.bboxes.push(y)}insertCircle(r,o,h,f){this._forEachCell(o-f,h-f,o+f,h+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(o),this.circles.push(h),this.circles.push(f)}_insertBoxCell(r,o,h,f,y,w){this.boxCells[y].push(w)}_insertCircleCell(r,o,h,f,y,w){this.circleCells[y].push(w)}_query(r,o,h,f,y,w,S){if(h<0||r>this.width||f<0||o>this.height)return[];const k=[];if(r<=0&&o<=0&&this.width<=h&&this.height<=f){if(y)return[{key:null,x1:r,y1:o,x2:h,y2:f}];for(let C=0;C<this.boxKeys.length;C++)k.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const D=this.circles[3*C],P=this.circles[3*C+1],N=this.circles[3*C+2];k.push({key:this.circleKeys[C],x1:D-N,y1:P-N,x2:D+N,y2:P+N})}}else this._forEachCell(r,o,h,f,this._queryCell,k,{hitTest:y,overlapMode:w,seenUids:{box:{},circle:{}}},S);return k}query(r,o,h,f){return this._query(r,o,h,f,!1,null)}hitTest(r,o,h,f,y,w){return this._query(r,o,h,f,!0,y,w).length>0}hitTestCircle(r,o,h,f,y){const w=r-h,S=r+h,k=o-h,C=o+h;if(S<0||w>this.width||C<0||k>this.height)return!1;const D=[];return this._forEachCell(w,k,S,C,this._queryCellCircle,D,{hitTest:!0,overlapMode:f,circle:{x:r,y:o,radius:h},seenUids:{box:{},circle:{}}},y),D.length>0}_queryCell(r,o,h,f,y,w,S,k){const{seenUids:C,hitTest:D,overlapMode:P}=S,N=this.boxCells[y];if(N!==null){const W=this.bboxes;for(const X of N)if(!C.box[X]){C.box[X]=!0;const G=4*X,pe=this.boxKeys[X];if(r<=W[G+2]&&o<=W[G+3]&&h>=W[G+0]&&f>=W[G+1]&&(!k||k(pe))&&(!D||!oi(P,pe.overlapMode))&&(w.push({key:pe,x1:W[G],y1:W[G+1],x2:W[G+2],y2:W[G+3]}),D))return!0}}const H=this.circleCells[y];if(H!==null){const W=this.circles;for(const X of H)if(!C.circle[X]){C.circle[X]=!0;const G=3*X,pe=this.circleKeys[X];if(this._circleAndRectCollide(W[G],W[G+1],W[G+2],r,o,h,f)&&(!k||k(pe))&&(!D||!oi(P,pe.overlapMode))){const we=W[G],re=W[G+1],me=W[G+2];if(w.push({key:pe,x1:we-me,y1:re-me,x2:we+me,y2:re+me}),D)return!0}}}return!1}_queryCellCircle(r,o,h,f,y,w,S,k){const{circle:C,seenUids:D,overlapMode:P}=S,N=this.boxCells[y];if(N!==null){const W=this.bboxes;for(const X of N)if(!D.box[X]){D.box[X]=!0;const G=4*X,pe=this.boxKeys[X];if(this._circleAndRectCollide(C.x,C.y,C.radius,W[G+0],W[G+1],W[G+2],W[G+3])&&(!k||k(pe))&&!oi(P,pe.overlapMode))return w.push(!0),!0}}const H=this.circleCells[y];if(H!==null){const W=this.circles;for(const X of H)if(!D.circle[X]){D.circle[X]=!0;const G=3*X,pe=this.circleKeys[X];if(this._circlesCollide(W[G],W[G+1],W[G+2],C.x,C.y,C.radius)&&(!k||k(pe))&&!oi(P,pe.overlapMode))return w.push(!0),!0}}}_forEachCell(r,o,h,f,y,w,S,k){const C=this._convertToXCellCoord(r),D=this._convertToYCellCoord(o),P=this._convertToXCellCoord(h),N=this._convertToYCellCoord(f);for(let H=C;H<=P;H++)for(let W=D;W<=N;W++)if(y.call(this,r,o,h,f,this.xCellCount*W+H,w,S,k))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,o,h,f,y,w){const S=f-r,k=y-o,C=h+w;return C*C>S*S+k*k}_circleAndRectCollide(r,o,h,f,y,w,S){const k=(w-f)/2,C=Math.abs(r-(f+k));if(C>k+h)return!1;const D=(S-y)/2,P=Math.abs(o-(y+D));if(P>D+h)return!1;if(C<=k||P<=D)return!0;const N=C-k,H=P-D;return N*N+H*H<=h*h}}function Ke(m,r,o,h,f){const y=c.Z();return r?(c.a0(y,y,[1/f,1/f,1]),o||c.ae(y,y,h.angle)):c.a1(y,h.labelPlaneMatrix,m),y}function cn(m,r,o,h,f){if(r){const y=c.af(m);return c.a0(y,y,[f,f,1]),o||c.ae(y,y,-h.angle),y}return h.glCoordMatrix}function Xr(m,r,o){let h;o?(h=[m.x,m.y,o(m.x,m.y),1],c.ag(h,h,r)):(h=[m.x,m.y,0,1],J(h,h,r));const f=h[3];return{point:new c.P(h[0]/f,h[1]/f),signedDistanceFromCamera:f}}function zn(m,r){return .5+m/r*.5}function os(m,r){const o=m[0]/m[3],h=m[1]/m[3];return o>=-r[0]&&o<=r[0]&&h>=-r[1]&&h<=r[1]}function et(m,r,o,h,f,y,w,S,k,C){const D=h?m.textSizeData:m.iconSizeData,P=c.ah(D,o.transform.zoom),N=[256/o.width*2+1,256/o.height*2+1],H=h?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;H.clear();const W=m.lineVertexArray,X=h?m.text.placedSymbolArray:m.icon.placedSymbolArray,G=o.transform.width/o.transform.height;let pe=!1;for(let we=0;we<X.length;we++){const re=X.get(we);if(re.hidden||re.writingMode===c.ai.vertical&&!pe){j(re.numGlyphs,H);continue}let me;if(pe=!1,C?(me=[re.anchorX,re.anchorY,C(re.anchorX,re.anchorY),1],c.ag(me,me,r)):(me=[re.anchorX,re.anchorY,0,1],J(me,me,r)),!os(me,N)){j(re.numGlyphs,H);continue}const Te=zn(o.transform.cameraToCenterDistance,me[3]),ke=c.aj(D,P,re),Re=w?ke/Te:ke*Te,He=new c.P(re.anchorX,re.anchorY),Ue=Xr(He,f,C).point,tt={projections:{},offsets:{}},It=vn(re,Re,!1,S,r,f,y,m.glyphOffsetArray,W,H,Ue,He,tt,G,k,C);pe=It.useVertical,(It.notEnoughRoom||pe||It.needsFlipping&&vn(re,Re,!0,S,r,f,y,m.glyphOffsetArray,W,H,Ue,He,tt,G,k,C).notEnoughRoom)&&j(re.numGlyphs,H)}h?m.text.dynamicLayoutVertexBuffer.updateData(H):m.icon.dynamicLayoutVertexBuffer.updateData(H)}function Jt(m,r,o,h,f,y,w,S,k,C,D,P,N){const H=S.glyphStartIndex+S.numGlyphs,W=S.lineStartIndex,X=S.lineStartIndex+S.lineLength,G=r.getoffsetX(S.glyphStartIndex),pe=r.getoffsetX(H-1),we=R(m*G,o,h,f,y,w,S.segment,W,X,k,C,D,P,N);if(!we)return null;const re=R(m*pe,o,h,f,y,w,S.segment,W,X,k,C,D,P,N);return re?{first:we,last:re}:null}function Bt(m,r,o,h){return m===c.ai.horizontal&&Math.abs(o.y-r.y)>Math.abs(o.x-r.x)*h?{useVertical:!0}:(m===c.ai.vertical?r.y<o.y:r.x>o.x)?{needsFlipping:!0}:null}function vn(m,r,o,h,f,y,w,S,k,C,D,P,N,H,W,X){const G=r/24,pe=m.lineOffsetX*G,we=m.lineOffsetY*G;let re;if(m.numGlyphs>1){const me=m.glyphStartIndex+m.numGlyphs,Te=m.lineStartIndex,ke=m.lineStartIndex+m.lineLength,Re=Jt(G,S,pe,we,o,D,P,m,k,y,N,W,X);if(!Re)return{notEnoughRoom:!0};const He=Xr(Re.first.point,w,X).point,Ue=Xr(Re.last.point,w,X).point;if(h&&!o){const tt=Bt(m.writingMode,He,Ue,H);if(tt)return tt}re=[Re.first];for(let tt=m.glyphStartIndex+1;tt<me-1;tt++)re.push(R(G*S.getoffsetX(tt),pe,we,o,D,P,m.segment,Te,ke,k,y,N,W,X));re.push(Re.last)}else{if(h&&!o){const Te=Xr(P,f,X).point,ke=m.lineStartIndex+m.segment+1,Re=new c.P(k.getx(ke),k.gety(ke)),He=Xr(Re,f,X),Ue=He.signedDistanceFromCamera>0?He.point:ls(P,Re,Te,1,f,X),tt=Bt(m.writingMode,Te,Ue,H);if(tt)return tt}const me=R(G*S.getoffsetX(m.glyphStartIndex),pe,we,o,D,P,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,k,y,N,W,X);if(!me)return{notEnoughRoom:!0};re=[me]}for(const me of re)c.ak(C,me.point,me.angle);return{}}function ls(m,r,o,h,f,y){const w=Xr(m.add(m.sub(r)._unit()),f,y).point,S=o.sub(w);return o.add(S._mult(h/S.mag()))}function tr(m,r){const{projectionCache:o,lineVertexArray:h,labelPlaneMatrix:f,tileAnchorPoint:y,distanceFromAnchor:w,getElevation:S,previousVertex:k,direction:C,absOffsetX:D}=r;if(o.projections[m])return o.projections[m];const P=new c.P(h.getx(m),h.gety(m)),N=Xr(P,f,S);if(N.signedDistanceFromCamera>0)return o.projections[m]=N.point,N.point;const H=m-C;return ls(w===0?y:new c.P(h.getx(H),h.gety(H)),P,k,D-w+1,f,S)}function Js(m,r,o){return m._unit()._perp()._mult(r*o)}function K(m,r,o,h,f,y,w,S){const{projectionCache:k,direction:C}=S;if(k.offsets[m])return k.offsets[m];const D=o.add(r);if(m+C<h||m+C>=f)return k.offsets[m]=D,D;const P=tr(m+C,S),N=Js(P.sub(o),w,C),H=o.add(N),W=P.add(N);return k.offsets[m]=c.al(y,D,H,W)||D,k.offsets[m]}function R(m,r,o,h,f,y,w,S,k,C,D,P,N,H){const W=h?m-r:m+r;let X=W>0?1:-1,G=0;h&&(X*=-1,G=Math.PI),X<0&&(G+=Math.PI);let pe,we,re=X>0?S+w:S+w+1,me=f,Te=f,ke=0,Re=0;const He=Math.abs(W),Ue=[];let tt;for(;ke+Re<=He;){if(re+=X,re<S||re>=k)return null;ke+=Re,Te=me,we=pe;const st={projectionCache:P,lineVertexArray:C,labelPlaneMatrix:D,tileAnchorPoint:y,distanceFromAnchor:ke,getElevation:H,previousVertex:Te,direction:X,absOffsetX:He};if(me=tr(re,st),o===0)Ue.push(Te),tt=me.sub(Te);else{let Ft;const kt=me.sub(Te);Ft=kt.mag()===0?Js(tr(re+X,st).sub(me),o,X):Js(kt,o,X),we||(we=Te.add(Ft)),pe=K(re,Ft,me,S,k,we,o,st),Ue.push(we),tt=pe.sub(we)}Re=tt.mag()}const It=tt._mult((He-ke)/Re)._add(we||Te),_r=G+Math.atan2(me.y-Te.y,me.x-Te.x);return Ue.push(It),{point:It,angle:N?_r:0,path:Ue}}const O=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function j(m,r){for(let o=0;o<m;o++){const h=r.length;r.resize(h+4),r.float32.set(O,3*h)}}function J(m,r,o){const h=r[0],f=r[1];return m[0]=o[0]*h+o[4]*f+o[12],m[1]=o[1]*h+o[5]*f+o[13],m[3]=o[3]*h+o[7]*f+o[15],m}const te=100;class _e{constructor(r,o=new Ki(r.width+200,r.height+200,25),h=new Ki(r.width+200,r.height+200,25)){this.transform=r,this.grid=o,this.ignoredGrid=h,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+te,this.screenBottomBoundary=r.height+te,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(r,o,h,f,y,w){const S=this.projectAndGetPerspectiveRatio(f,r.anchorPointX,r.anchorPointY,w),k=h*S.perspectiveRatio,C=r.x1*k+S.point.x,D=r.y1*k+S.point.y,P=r.x2*k+S.point.x,N=r.y2*k+S.point.y;return!this.isInsideGrid(C,D,P,N)||o!=="always"&&this.grid.hitTest(C,D,P,N,o,y)||S.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[C,D,P,N],offscreen:this.isOffscreen(C,D,P,N)}}placeCollisionCircles(r,o,h,f,y,w,S,k,C,D,P,N,H,W){const X=[],G=new c.P(o.anchorX,o.anchorY),pe=Xr(G,w,W),we=zn(this.transform.cameraToCenterDistance,pe.signedDistanceFromCamera),re=(D?y/we:y*we)/c.ap,me=Xr(G,S,W).point,Te=Jt(re,f,o.lineOffsetX*re,o.lineOffsetY*re,!1,me,G,o,h,S,{projections:{},offsets:{}},!1,W);let ke=!1,Re=!1,He=!0;if(Te){const Ue=.5*N*we+H,tt=new c.P(-100,-100),It=new c.P(this.screenRightBoundary,this.screenBottomBoundary),_r=new ln,st=Te.first,Ft=Te.last;let kt=[];for(let nr=st.path.length-1;nr>=1;nr--)kt.push(st.path[nr]);for(let nr=1;nr<Ft.path.length;nr++)kt.push(Ft.path[nr]);const qr=2.5*Ue;if(k){const nr=kt.map(vr=>Xr(vr,k,W));kt=nr.some(vr=>vr.signedDistanceFromCamera<=0)?[]:nr.map(vr=>vr.point)}let gr=[];if(kt.length>0){const nr=kt[0].clone(),vr=kt[0].clone();for(let Pi=1;Pi<kt.length;Pi++)nr.x=Math.min(nr.x,kt[Pi].x),nr.y=Math.min(nr.y,kt[Pi].y),vr.x=Math.max(vr.x,kt[Pi].x),vr.y=Math.max(vr.y,kt[Pi].y);gr=nr.x>=tt.x&&vr.x<=It.x&&nr.y>=tt.y&&vr.y<=It.y?[kt]:vr.x<tt.x||nr.x>It.x||vr.y<tt.y||nr.y>It.y?[]:c.am([kt],tt.x,tt.y,It.x,It.y)}for(const nr of gr){_r.reset(nr,.25*Ue);let vr=0;vr=_r.length<=.5*Ue?1:Math.ceil(_r.paddedLength/qr)+1;for(let Pi=0;Pi<vr;Pi++){const ri=Pi/Math.max(vr-1,1),dn=_r.lerp(ri),Xi=dn.x+te,Fi=dn.y+te;X.push(Xi,Fi,Ue,0);const Xn=Xi-Ue,ci=Fi-Ue,Rs=Xi+Ue,Fs=Fi+Ue;if(He=He&&this.isOffscreen(Xn,ci,Rs,Fs),Re=Re||this.isInsideGrid(Xn,ci,Rs,Fs),r!=="always"&&this.grid.hitTestCircle(Xi,Fi,Ue,r,P)&&(ke=!0,!C))return{circles:[],offscreen:!1,collisionDetected:ke}}}}return{circles:!C&&ke||!Re||we<this.perspectiveRatioCutoff?[]:X,offscreen:He,collisionDetected:ke}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let h=1/0,f=1/0,y=-1/0,w=-1/0;for(const D of r){const P=new c.P(D.x+te,D.y+te);h=Math.min(h,P.x),f=Math.min(f,P.y),y=Math.max(y,P.x),w=Math.max(w,P.y),o.push(P)}const S=this.grid.query(h,f,y,w).concat(this.ignoredGrid.query(h,f,y,w)),k={},C={};for(const D of S){const P=D.key;if(k[P.bucketInstanceId]===void 0&&(k[P.bucketInstanceId]={}),k[P.bucketInstanceId][P.featureIndex])continue;const N=[new c.P(D.x1,D.y1),new c.P(D.x2,D.y1),new c.P(D.x2,D.y2),new c.P(D.x1,D.y2)];c.an(o,N)&&(k[P.bucketInstanceId][P.featureIndex]=!0,C[P.bucketInstanceId]===void 0&&(C[P.bucketInstanceId]=[]),C[P.bucketInstanceId].push(P.featureIndex))}return C}insertCollisionBox(r,o,h,f,y,w){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:y,collisionGroupID:w,overlapMode:o},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,o,h,f,y,w){const S=h?this.ignoredGrid:this.grid,k={bucketInstanceId:f,featureIndex:y,collisionGroupID:w,overlapMode:o};for(let C=0;C<r.length;C+=4)S.insertCircle(k,r[C],r[C+1],r[C+2])}projectAndGetPerspectiveRatio(r,o,h,f){let y;return f?(y=[o,h,f(o,h),1],c.ag(y,y,r)):(y=[o,h,0,1],J(y,y,r)),{point:new c.P((y[0]/y[3]+1)/2*this.transform.width+te,(-y[1]/y[3]+1)/2*this.transform.height+te),perspectiveRatio:.5+this.transform.cameraToCenterDistance/y[3]*.5}}isOffscreen(r,o,h,f){return h<te||r>=this.screenRightBoundary||f<te||o>this.screenBottomBoundary}isInsideGrid(r,o,h,f){return h>=0&&r<this.gridRightBoundary&&f>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const r=c.ao([]);return c.$(r,r,[-100,-100,0]),r}}function he(m,r,o){return r*(c.N/(m.tileSize*Math.pow(2,o-m.tileID.overscaledZ)))}class se{constructor(r,o,h,f){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?o:-o))):f&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class ge{constructor(r,o,h,f,y){this.text=new se(r?r.text:null,o,h,y),this.icon=new se(r?r.icon:null,o,f,y)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Le{constructor(r,o,h){this.text=r,this.icon=o,this.skipFade=h}}class Be{constructor(){this.invProjMatrix=c.Z(),this.viewportMatrix=c.Z(),this.circles=[]}}class Oe{constructor(r,o,h,f,y){this.bucketInstanceId=r,this.featureIndex=o,this.sourceLayerIndex=h,this.bucketIndex=f,this.tileID=y}}class Mt{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const o=++this.maxGroupID;this.collisionGroups[r]={ID:o,predicate:h=>h.collisionGroupID===o}}return this.collisionGroups[r]}}function Ut(m,r,o,h,f){const{horizontalAlign:y,verticalAlign:w}=c.au(m);return new c.P(-(y-.5)*r+h[0]*f,-(w-.5)*o+h[1]*f)}function St(m,r,o,h,f,y){const{x1:w,x2:S,y1:k,y2:C,anchorPointX:D,anchorPointY:P}=m,N=new c.P(r,o);return h&&N._rotate(f?y:-y),{x1:w+N.x,y1:k+N.y,x2:S+N.x,y2:C+N.y,anchorPointX:D,anchorPointY:P}}class Lt{constructor(r,o,h,f,y){this.transform=r.clone(),this.terrain=o,this.collisionIndex=new _e(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new Mt(f),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,o,h,f){const y=h.getBucket(o),w=h.latestFeatureIndex;if(!y||!w||o.id!==y.layerIds[0])return;const S=h.collisionBoxArray,k=y.layers[0].layout,C=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),D=h.tileSize/c.N,P=this.transform.calculatePosMatrix(h.tileID.toUnwrapped()),N=k.get("text-pitch-alignment")==="map",H=k.get("text-rotation-alignment")==="map",W=he(h,1,this.transform.zoom),X=Ke(P,N,H,this.transform,W);let G=null;if(N){const we=cn(P,N,H,this.transform,W);G=c.a1([],this.transform.labelPlaneMatrix,we)}this.retainedQueryData[y.bucketInstanceId]=new Oe(y.bucketInstanceId,w,y.sourceLayerIndex,y.index,h.tileID);const pe={bucket:y,layout:k,posMatrix:P,textLabelPlaneMatrix:X,labelToScreenMatrix:G,scale:C,textPixelRatio:D,holdingForFade:h.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:c.ah(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(f)for(const we of y.sortKeyRanges){const{sortKey:re,symbolInstanceStart:me,symbolInstanceEnd:Te}=we;r.push({sortKey:re,symbolInstanceStart:me,symbolInstanceEnd:Te,parameters:pe})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:pe})}attemptAnchorPlacement(r,o,h,f,y,w,S,k,C,D,P,N,H,W,X,G){const pe=c.aq[r.textAnchor],we=[r.textOffset0,r.textOffset1],re=Ut(pe,h,f,we,y),me=this.collisionIndex.placeCollisionBox(St(o,re.x,re.y,w,S,this.transform.angle),P,k,C,D.predicate,G);if((!X||this.collisionIndex.placeCollisionBox(St(X,re.x,re.y,w,S,this.transform.angle),P,k,C,D.predicate,G).box.length!==0)&&me.box.length>0){let Te;if(this.prevPlacement&&this.prevPlacement.variableOffsets[N.crossTileID]&&this.prevPlacement.placements[N.crossTileID]&&this.prevPlacement.placements[N.crossTileID].text&&(Te=this.prevPlacement.variableOffsets[N.crossTileID].anchor),N.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[N.crossTileID]={textOffset:we,width:h,height:f,anchor:pe,textBoxScale:y,prevAnchor:Te},this.markUsedJustification(H,pe,N,W),H.allowVerticalPlacement&&(this.markUsedOrientation(H,W,N),this.placedOrientations[N.crossTileID]=W),{shift:re,placedGlyphBoxes:me}}}placeLayerBucketPart(r,o,h){const{bucket:f,layout:y,posMatrix:w,textLabelPlaneMatrix:S,labelToScreenMatrix:k,textPixelRatio:C,holdingForFade:D,collisionBoxArray:P,partiallyEvaluatedTextSize:N,collisionGroup:H}=r.parameters,W=y.get("text-optional"),X=y.get("icon-optional"),G=c.ar(y,"text-overlap","text-allow-overlap"),pe=G==="always",we=c.ar(y,"icon-overlap","icon-allow-overlap"),re=we==="always",me=y.get("text-rotation-alignment")==="map",Te=y.get("text-pitch-alignment")==="map",ke=y.get("icon-text-fit")!=="none",Re=y.get("symbol-z-order")==="viewport-y",He=pe&&(re||!f.hasIconData()||X),Ue=re&&(pe||!f.hasTextData()||W);!f.collisionArrays&&P&&f.deserializeCollisionBoxes(P);const tt=this.retainedQueryData[f.bucketInstanceId].tileID,It=this.terrain?(st,Ft)=>this.terrain.getElevation(tt,st,Ft):null,_r=(st,Ft)=>{var kt,qr;if(o[st.crossTileID])return;if(D)return void(this.placements[st.crossTileID]=new Le(!1,!1,!1));let gr=!1,nr=!1,vr=!0,Pi=null,ri={box:null,offscreen:null},dn={box:null,offscreen:null},Xi=null,Fi=null,Xn=null,ci=0,Rs=0,Fs=0;Ft.textFeatureIndex?ci=Ft.textFeatureIndex:st.useRuntimeCollisionCircles&&(ci=st.featureIndex),Ft.verticalTextFeatureIndex&&(Rs=Ft.verticalTextFeatureIndex);const Ia=Ft.textBox;if(Ia){const wn=Li=>{let Ji=c.ai.horizontal;if(f.allowVerticalPlacement&&!Li&&this.prevPlacement){const Fn=this.prevPlacement.placedOrientations[st.crossTileID];Fn&&(this.placedOrientations[st.crossTileID]=Fn,Ji=Fn,this.markUsedOrientation(f,Ji,st))}return Ji},fn=(Li,Ji)=>{if(f.allowVerticalPlacement&&st.numVerticalGlyphVertices>0&&Ft.verticalTextBox){for(const Fn of f.writingModes)if(Fn===c.ai.vertical?(ri=Ji(),dn=ri):ri=Li(),ri&&ri.box&&ri.box.length)break}else ri=Li()},Cn=st.textAnchorOffsetStartIndex,Qa=st.textAnchorOffsetEndIndex;if(Qa===Cn){const Li=(Ji,Fn)=>{const zi=this.collisionIndex.placeCollisionBox(Ji,G,C,w,H.predicate,It);return zi&&zi.box&&zi.box.length&&(this.markUsedOrientation(f,Fn,st),this.placedOrientations[st.crossTileID]=Fn),zi};fn(()=>Li(Ia,c.ai.horizontal),()=>{const Ji=Ft.verticalTextBox;return f.allowVerticalPlacement&&st.numVerticalGlyphVertices>0&&Ji?Li(Ji,c.ai.vertical):{box:null,offscreen:null}}),wn(ri&&ri.box&&ri.box.length)}else{let Li=c.aq[(qr=(kt=this.prevPlacement)===null||kt===void 0?void 0:kt.variableOffsets[st.crossTileID])===null||qr===void 0?void 0:qr.anchor];const Ji=(zi,eo,mc)=>{const Zd=zi.x2-zi.x1,Wd=zi.y2-zi.y1,vm=st.textBoxScale,Ju=ke&&we==="never"?eo:null;let Os={box:[],offscreen:!1},to=G==="never"?1:2,Ns="never";Li&&to++;for(let ms=0;ms<to;ms++){for(let Us=Cn;Us<Qa;Us++){const Qu=f.textAnchorOffsets.get(Us);if(Li&&Qu.textAnchor!==Li)continue;const na=this.attemptAnchorPlacement(Qu,zi,Zd,Wd,vm,me,Te,C,w,H,Ns,st,f,mc,Ju,It);if(na&&(Os=na.placedGlyphBoxes,Os&&Os.box&&Os.box.length))return gr=!0,Pi=na.shift,Os}Li?Li=null:Ns=G}return Os};fn(()=>Ji(Ia,Ft.iconBox,c.ai.horizontal),()=>{const zi=Ft.verticalTextBox;return f.allowVerticalPlacement&&!(ri&&ri.box&&ri.box.length)&&st.numVerticalGlyphVertices>0&&zi?Ji(zi,Ft.verticalIconBox,c.ai.vertical):{box:null,offscreen:null}}),ri&&(gr=ri.box,vr=ri.offscreen);const Fn=wn(ri&&ri.box);if(!gr&&this.prevPlacement){const zi=this.prevPlacement.variableOffsets[st.crossTileID];zi&&(this.variableOffsets[st.crossTileID]=zi,this.markUsedJustification(f,zi.anchor,st,Fn))}}}if(Xi=ri,gr=Xi&&Xi.box&&Xi.box.length>0,vr=Xi&&Xi.offscreen,st.useRuntimeCollisionCircles){const wn=f.text.placedSymbolArray.get(st.centerJustifiedTextSymbolIndex),fn=c.aj(f.textSizeData,N,wn),Cn=y.get("text-padding");Fi=this.collisionIndex.placeCollisionCircles(G,wn,f.lineVertexArray,f.glyphOffsetArray,fn,w,S,k,h,Te,H.predicate,st.collisionCircleDiameter,Cn,It),Fi.circles.length&&Fi.collisionDetected&&!h&&c.w("Collisions detected, but collision boxes are not shown"),gr=pe||Fi.circles.length>0&&!Fi.collisionDetected,vr=vr&&Fi.offscreen}if(Ft.iconFeatureIndex&&(Fs=Ft.iconFeatureIndex),Ft.iconBox){const wn=fn=>{const Cn=ke&&Pi?St(fn,Pi.x,Pi.y,me,Te,this.transform.angle):fn;return this.collisionIndex.placeCollisionBox(Cn,we,C,w,H.predicate,It)};dn&&dn.box&&dn.box.length&&Ft.verticalIconBox?(Xn=wn(Ft.verticalIconBox),nr=Xn.box.length>0):(Xn=wn(Ft.iconBox),nr=Xn.box.length>0),vr=vr&&Xn.offscreen}const Ja=W||st.numHorizontalGlyphVertices===0&&st.numVerticalGlyphVertices===0,Lo=X||st.numIconVertices===0;if(Ja||Lo?Lo?Ja||(nr=nr&&gr):gr=nr&&gr:nr=gr=nr&&gr,gr&&Xi&&Xi.box&&this.collisionIndex.insertCollisionBox(Xi.box,G,y.get("text-ignore-placement"),f.bucketInstanceId,dn&&dn.box&&Rs?Rs:ci,H.ID),nr&&Xn&&this.collisionIndex.insertCollisionBox(Xn.box,we,y.get("icon-ignore-placement"),f.bucketInstanceId,Fs,H.ID),Fi&&(gr&&this.collisionIndex.insertCollisionCircles(Fi.circles,G,y.get("text-ignore-placement"),f.bucketInstanceId,ci,H.ID),h)){const wn=f.bucketInstanceId;let fn=this.collisionCircleArrays[wn];fn===void 0&&(fn=this.collisionCircleArrays[wn]=new Be);for(let Cn=0;Cn<Fi.circles.length;Cn+=4)fn.circles.push(Fi.circles[Cn+0]),fn.circles.push(Fi.circles[Cn+1]),fn.circles.push(Fi.circles[Cn+2]),fn.circles.push(Fi.collisionDetected?1:0)}if(st.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(f.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[st.crossTileID]=new Le(gr||He,nr||Ue,vr||f.justReloaded),o[st.crossTileID]=!0};if(Re){if(r.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const st=f.getSortedSymbolIndexes(this.transform.angle);for(let Ft=st.length-1;Ft>=0;--Ft){const kt=st[Ft];_r(f.symbolInstances.get(kt),f.collisionArrays[kt])}}else for(let st=r.symbolInstanceStart;st<r.symbolInstanceEnd;st++)_r(f.symbolInstances.get(st),f.collisionArrays[st]);if(h&&f.bucketInstanceId in this.collisionCircleArrays){const st=this.collisionCircleArrays[f.bucketInstanceId];c.as(st.invProjMatrix,w),st.viewportMatrix=this.collisionIndex.getViewportMatrix()}f.justReloaded=!1}markUsedJustification(r,o,h,f){let y;y=f===c.ai.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[c.at(o)];const w=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];for(const S of w)S>=0&&(r.text.placedSymbolArray.get(S).crossTileID=y>=0&&S!==y?0:h.crossTileID)}markUsedOrientation(r,o,h){const f=o===c.ai.horizontal||o===c.ai.horizontalOnly?o:0,y=o===c.ai.vertical?o:0,w=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];for(const S of w)r.text.placedSymbolArray.get(S).placedOrientation=f;h.verticalPlacedTextSymbolIndex&&(r.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let h=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const f=o?o.symbolFadeChange(r):1,y=o?o.opacities:{},w=o?o.variableOffsets:{},S=o?o.placedOrientations:{};for(const k in this.placements){const C=this.placements[k],D=y[k];D?(this.opacities[k]=new ge(D,f,C.text,C.icon),h=h||C.text!==D.text.placed||C.icon!==D.icon.placed):(this.opacities[k]=new ge(null,f,C.text,C.icon,C.skipFade),h=h||C.text||C.icon)}for(const k in y){const C=y[k];if(!this.opacities[k]){const D=new ge(C,f,!1,!1);D.isHidden()||(this.opacities[k]=D,h=h||C.text.placed||C.icon.placed)}}for(const k in w)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=w[k]);for(const k in S)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=S[k]);if(o&&o.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");h?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:r)}updateLayerOpacities(r,o){const h={};for(const f of o){const y=f.getBucket(r);y&&f.latestFeatureIndex&&r.id===y.layerIds[0]&&this.updateBucketOpacities(y,h,f.collisionBoxArray)}}updateBucketOpacities(r,o,h){r.hasTextData()&&(r.text.opacityVertexArray.clear(),r.text.hasVisibleVertices=!1),r.hasIconData()&&(r.icon.opacityVertexArray.clear(),r.icon.hasVisibleVertices=!1),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const f=r.layers[0],y=f.layout,w=new ge(null,0,!1,!1,!0),S=y.get("text-allow-overlap"),k=y.get("icon-allow-overlap"),C=f._unevaluatedLayout.hasValue("text-variable-anchor")||f._unevaluatedLayout.hasValue("text-variable-anchor-offset"),D=y.get("text-rotation-alignment")==="map",P=y.get("text-pitch-alignment")==="map",N=y.get("icon-text-fit")!=="none",H=new ge(null,0,S&&(k||!r.hasIconData()||y.get("icon-optional")),k&&(S||!r.hasTextData()||y.get("text-optional")),!0);!r.collisionArrays&&h&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(h);const W=(X,G,pe)=>{for(let we=0;we<G/4;we++)X.opacityVertexArray.emplaceBack(pe);X.hasVisibleVertices=X.hasVisibleVertices||pe!==cs};for(let X=0;X<r.symbolInstances.length;X++){const G=r.symbolInstances.get(X),{numHorizontalGlyphVertices:pe,numVerticalGlyphVertices:we,crossTileID:re}=G;let me=this.opacities[re];o[re]?me=w:me||(me=H,this.opacities[re]=me),o[re]=!0;const Te=G.numIconVertices>0,ke=this.placedOrientations[G.crossTileID],Re=ke===c.ai.vertical,He=ke===c.ai.horizontal||ke===c.ai.horizontalOnly;if(pe>0||we>0){const Ue=un(me.text);W(r.text,pe,Re?cs:Ue),W(r.text,we,He?cs:Ue);const tt=me.text.isHidden();[G.rightJustifiedTextSymbolIndex,G.centerJustifiedTextSymbolIndex,G.leftJustifiedTextSymbolIndex].forEach(st=>{st>=0&&(r.text.placedSymbolArray.get(st).hidden=tt||Re?1:0)}),G.verticalPlacedTextSymbolIndex>=0&&(r.text.placedSymbolArray.get(G.verticalPlacedTextSymbolIndex).hidden=tt||He?1:0);const It=this.variableOffsets[G.crossTileID];It&&this.markUsedJustification(r,It.anchor,G,ke);const _r=this.placedOrientations[G.crossTileID];_r&&(this.markUsedJustification(r,"left",G,_r),this.markUsedOrientation(r,_r,G))}if(Te){const Ue=un(me.icon),tt=!(N&&G.verticalPlacedIconSymbolIndex&&Re);G.placedIconSymbolIndex>=0&&(W(r.icon,G.numIconVertices,tt?Ue:cs),r.icon.placedSymbolArray.get(G.placedIconSymbolIndex).hidden=me.icon.isHidden()),G.verticalPlacedIconSymbolIndex>=0&&(W(r.icon,G.numVerticalIconVertices,tt?cs:Ue),r.icon.placedSymbolArray.get(G.verticalPlacedIconSymbolIndex).hidden=me.icon.isHidden())}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const Ue=r.collisionArrays[X];if(Ue){let tt=new c.P(0,0);if(Ue.textBox||Ue.verticalTextBox){let _r=!0;if(C){const st=this.variableOffsets[re];st?(tt=Ut(st.anchor,st.width,st.height,st.textOffset,st.textBoxScale),D&&tt._rotate(P?this.transform.angle:-this.transform.angle)):_r=!1}Ue.textBox&&Vt(r.textCollisionBox.collisionVertexArray,me.text.placed,!_r||Re,tt.x,tt.y),Ue.verticalTextBox&&Vt(r.textCollisionBox.collisionVertexArray,me.text.placed,!_r||He,tt.x,tt.y)}const It=!!(!He&&Ue.verticalIconBox);Ue.iconBox&&Vt(r.iconCollisionBox.collisionVertexArray,me.icon.placed,It,N?tt.x:0,N?tt.y:0),Ue.verticalIconBox&&Vt(r.iconCollisionBox.collisionVertexArray,me.icon.placed,!It,N?tt.x:0,N?tt.y:0)}}}if(r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.text.opacityVertexArray.length!==r.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${r.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${r.text.layoutVertexArray.length}) / 4`);if(r.icon.opacityVertexArray.length!==r.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${r.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${r.icon.layoutVertexArray.length}) / 4`);if(r.bucketInstanceId in this.collisionCircleArrays){const X=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=X.invProjMatrix,r.placementViewportMatrix=X.viewportMatrix,r.collisionCircleArray=X.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,o){const h=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*h>r}setStale(){this.stale=!0}}function Vt(m,r,o,h,f){m.emplaceBack(r?1:0,o?1:0,h||0,f||0),m.emplaceBack(r?1:0,o?1:0,h||0,f||0),m.emplaceBack(r?1:0,o?1:0,h||0,f||0),m.emplaceBack(r?1:0,o?1:0,h||0,f||0)}const Nr=Math.pow(2,25),Wr=Math.pow(2,24),Cr=Math.pow(2,17),Ar=Math.pow(2,16),bn=Math.pow(2,9),ti=Math.pow(2,8),Wi=Math.pow(2,1);function un(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const r=m.placed?1:0,o=Math.floor(127*m.opacity);return o*Nr+r*Wr+o*Cr+r*Ar+o*bn+r*ti+o*Wi+r}const cs=0;class ld{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&!r.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,o,h,f,y){const w=this._bucketParts;for(;this._currentTileIndex<r.length;)if(o.getBucketParts(w,f,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((S,k)=>S.sortKey-k.sortKey));this._currentPartIndex<w.length;)if(o.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,h),this._currentPartIndex++,y())return!0;return!1}}class bo{constructor(r,o,h,f,y,w,S,k){this.placement=new Lt(r,o,w,S,k),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(r,o,h){const f=c.h.now(),y=()=>!this._forceFullPlacement&&c.h.now()-f>2;for(;this._currentPlacementIndex>=0;){const w=o[r[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=S)&&(!w.maxzoom||w.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new ld(w)),this._inProgressLayer.continuePlacement(h[w.source],this.placement,this._showCollisionBoxes,w,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const xo=512/c.N/2;class rm{constructor(r,o,h){this.tileID=r,this.bucketInstanceId=h,this._symbolsByKey={};const f=new Map;for(let y=0;y<o.length;y++){const w=o.get(y),S=w.key,k=f.get(S);k?k.push(w):f.set(S,[w])}for(const[y,w]of f){const S={positions:w.map(k=>({x:Math.floor(k.anchorX*xo),y:Math.floor(k.anchorY*xo)})),crossTileIDs:w.map(k=>k.crossTileID)};if(S.positions.length>128){const k=new c.av(S.positions.length,16,Uint16Array);for(const{x:C,y:D}of S.positions)k.add(C,D);k.finish(),delete S.positions,S.index=k}this._symbolsByKey[y]=S}}getScaledCoordinates(r,o){const{x:h,y:f,z:y}=this.tileID.canonical,{x:w,y:S,z:k}=o.canonical,C=xo/Math.pow(2,k-y),D=(S*c.N+r.anchorY)*C,P=f*c.N*xo;return{x:Math.floor((w*c.N+r.anchorX)*C-h*c.N*xo),y:Math.floor(D-P)}}findMatches(r,o,h){const f=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z);for(let y=0;y<r.length;y++){const w=r.get(y);if(w.crossTileID)continue;const S=this._symbolsByKey[w.key];if(!S)continue;const k=this.getScaledCoordinates(w,o);if(S.index){const C=S.index.range(k.x-f,k.y-f,k.x+f,k.y+f).sort();for(const D of C){const P=S.crossTileIDs[D];if(!h[P]){h[P]=!0,w.crossTileID=P;break}}}else if(S.positions)for(let C=0;C<S.positions.length;C++){const D=S.positions[C],P=S.crossTileIDs[C];if(Math.abs(D.x-k.x)<=f&&Math.abs(D.y-k.y)<=f&&!h[P]){h[P]=!0,w.crossTileID=P;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:r})=>r)}}class jr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class hu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const o=Math.round((r-this.lng)/360);if(o!==0)for(const h in this.indexes){const f=this.indexes[h],y={};for(const w in f){const S=f[w];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+o),y[S.tileID.key]=S}this.indexes[h]=y}this.lng=r}addBucket(r,o,h){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let y=0;y<o.symbolInstances.length;y++)o.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const f=this.usedCrossTileIDs[r.overscaledZ];for(const y in this.indexes){const w=this.indexes[y];if(Number(y)>r.overscaledZ)for(const S in w){const k=w[S];k.tileID.isChildOf(r)&&k.findMatches(o.symbolInstances,r,f)}else{const S=w[r.scaledTo(Number(y)).key];S&&S.findMatches(o.symbolInstances,r,f)}}for(let y=0;y<o.symbolInstances.length;y++){const w=o.symbolInstances.get(y);w.crossTileID||(w.crossTileID=h.generate(),f[w.crossTileID]=!0)}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new rm(r,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(r,o){for(const h of o.getCrossTileIDsLists())for(const f of h)delete this.usedCrossTileIDs[r][f]}removeStaleBuckets(r){let o=!1;for(const h in this.indexes){const f=this.indexes[h];for(const y in f)r[f[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,f[y]),delete f[y],o=!0)}return o}}class $l{constructor(){this.layerIndexes={},this.crossTileIDs=new jr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,o,h){let f=this.layerIndexes[r.id];f===void 0&&(f=this.layerIndexes[r.id]=new hu);let y=!1;const w={};f.handleWrapJump(h);for(const S of o){const k=S.getBucket(r);k&&r.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),f.addBucket(S.tileID,k,this.crossTileIDs)&&(y=!0),w[k.bucketInstanceId]=!0)}return f.removeStaleBuckets(w)&&(y=!0),y}pruneUnusedLayers(r){const o={};r.forEach(h=>{o[h]=!0});for(const h in this.layerIndexes)o[h]||delete this.layerIndexes[h]}}const xn=(m,r)=>c.x(m,r&&r.filter(o=>o.identifier!=="source.canvas")),Zn=c.F(c.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),im=c.F(c.ax,["setCenter","setZoom","setBearing","setPitch"]),us=c.aw();class hn extends c.E{constructor(r,o={}){super(),this.map=r,this.dispatcher=new er(on(),this,r._getMapId()),this.imageManager=new Ze,this.imageManager.setEventedParent(this),this.glyphManager=new Je(r._requestManager,o.localIdeographFontFamily),this.lineAtlas=new _t(256,512),this.crossTileSymbolIndex=new $l,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new c.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",c.az());const h=this;this._rtlTextPluginCallback=hn.registerForPluginStateChange(f=>{h.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:f.pluginStatus,pluginURL:f.pluginURL},(y,w)=>{if(c.aA(y),w&&w.every(S=>S))for(const S in h.sourceCaches){const k=h.sourceCaches[S].getSource().type;k!=="vector"&&k!=="geojson"||h.sourceCaches[S].reload()}})}),this.on("data",f=>{if(f.dataType!=="source"||f.sourceDataType!=="metadata")return;const y=this.sourceCaches[f.sourceId];if(!y)return;const w=y.getSource();if(w&&w.vectorLayerIds)for(const S in this._layers){const k=this._layers[S];k.source===w.id&&this._validateLayer(k)}})}loadURL(r,o={},h){this.fire(new c.k("dataloading",{dataType:"style"})),o.validate=typeof o.validate!="boolean"||o.validate;const f=this.map._requestManager.transformRequest(r,Y.Style);this._request=c.f(f,(y,w)=>{this._request=null,y?this.fire(new c.j(y)):w&&this._load(w,o,h)})}loadJSON(r,o={},h){this.fire(new c.k("dataloading",{dataType:"style"})),this._request=c.h.frame(()=>{this._request=null,o.validate=o.validate!==!1,this._load(r,o,h)})}loadEmpty(){this.fire(new c.k("dataloading",{dataType:"style"})),this._load(us,{validate:!1})}_load(r,o,h){var f;const y=o.transformStyle?o.transformStyle(h,r):r;if(!o.validate||!xn(this,c.y(y))){this._loaded=!0,this.stylesheet=y;for(const w in y.sources)this.addSource(w,y.sources[w],{validate:!1});y.sprite?this._loadSprite(y.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(y.glyphs),this._createLayers(),this.light=new ht(this.stylesheet.light),this.map.setTerrain((f=this.stylesheet.terrain)!==null&&f!==void 0?f:null),this.fire(new c.k("data",{dataType:"style"})),this.fire(new c.k("style.load"))}}_createLayers(){const r=c.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",r),this._order=r.map(o=>o.id),this._layers={},this._serializedLayers=null;for(const o of r){const h=c.aC(o);h.setEventedParent(this,{layer:{id:o.id}}),this._layers[o.id]=h}}_loadSprite(r,o=!1,h=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(f,y,w,S){const k=Ee(f),C=k.length,D=w>1?"@2x":"",P={},N={},H={};for(const{id:W,url:X}of k){const G=y.transformRequest(y.normalizeSpriteURL(X,D,".json"),Y.SpriteJSON),pe=`${W}_${G.url}`;P[pe]=c.f(G,(me,Te)=>{delete P[pe],N[W]=Te,Ve(S,N,H,me,C)});const we=y.transformRequest(y.normalizeSpriteURL(X,D,".png"),Y.SpriteImage),re=`${W}_${we.url}`;P[re]=ie.getImage(we,(me,Te)=>{delete P[re],H[W]=Te,Ve(S,N,H,me,C)})}return{cancel(){for(const W of Object.values(P))W.cancel()}}}(r,this.map._requestManager,this.map.getPixelRatio(),(f,y)=>{if(this._spriteRequest=null,f)this.fire(new c.j(f));else if(y)for(const w in y){this._spritesImagesIds[w]=[];const S=this._spritesImagesIds[w]?this._spritesImagesIds[w].filter(k=>!(k in y)):[];for(const k of S)this.imageManager.removeImage(k),this._changedImages[k]=!0;for(const k in y[w]){const C=w==="default"?k:`${w}:${k}`;this._spritesImagesIds[w].push(C),C in this.imageManager.images?this.imageManager.updateImage(C,y[w][k],!1):this.imageManager.addImage(C,y[w][k]),o&&(this._changedImages[C]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),o&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.k("data",{dataType:"style"})),h&&h(f)})}_unloadSprite(){for(const r of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(r),this._changedImages[r]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}_validateLayer(r){const o=this.sourceCaches[r.source];if(!o)return;const h=r.sourceLayer;if(!h)return;const f=o.getSource();(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(h)===-1)&&this.fire(new c.j(new Error(`Source layer "${h}" does not exist on source "${f.id}" as specified by style layer "${r.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this.sourceCaches)if(!this.sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(r){const o=this._serializedAllLayers();if(!r||r.length===0)return Object.values(o);const h=[];for(const f of r)o[f]&&h.push(o[f]);return h}_serializedAllLayers(){let r=this._serializedLayers;if(r)return r;r=this._serializedLayers={};const o=Object.keys(this._layers);for(const h of o){const f=this._layers[h];f.type!=="custom"&&(r[h]=f.serialize())}return r}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const r in this.sourceCaches)if(this.sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(r){if(!this._loaded)return;const o=this._changed;if(this._changed){const f=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(f.length||y.length)&&this._updateWorkerLayers(f,y);for(const w in this._updatedSources){const S=this._updatedSources[w];if(S==="reload")this._reloadSource(w);else{if(S!=="clear")throw new Error(`Invalid action ${S}`);this._clearSource(w)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(r);this.light.updateTransitions(r),this._resetUpdates()}const h={};for(const f in this.sourceCaches){const y=this.sourceCaches[f];h[f]=y.used,y.used=!1}for(const f of this._order){const y=this._layers[f];y.recalculate(r,this._availableImages),!y.isHidden(r.zoom)&&y.source&&(this.sourceCaches[y.source].used=!0)}for(const f in h){const y=this.sourceCaches[f];h[f]!==y.used&&y.fire(new c.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:f}))}this.light.recalculate(r),this.z=r.zoom,o&&this.fire(new c.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(r,o){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(r),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(r,o={}){this._checkLoaded();const h=this.serialize();if(r=o.transformStyle?o.transformStyle(h,r):r,xn(this,c.y(r)))return!1;(r=c.aD(r)).layers=c.aB(r.layers);const f=c.aE(h,r).filter(w=>!(w.command in im));if(f.length===0)return!1;const y=f.filter(w=>!(w.command in Zn));if(y.length>0)throw new Error(`Unimplemented: ${y.map(w=>w.command).join(", ")}.`);for(const w of f)w.command!=="setTransition"&&this[w.command].apply(this,w.args);return this.stylesheet=r,this._serializedLayers=null,!0}addImage(r,o){if(this.getImage(r))return this.fire(new c.j(new Error(`An image named "${r}" already exists.`)));this.imageManager.addImage(r,o),this._afterImageUpdated(r)}updateImage(r,o){this.imageManager.updateImage(r,o)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){if(!this.getImage(r))return this.fire(new c.j(new Error(`An image named "${r}" does not exist.`)));this.imageManager.removeImage(r),this._afterImageUpdated(r)}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(r,o,h={}){if(this._checkLoaded(),this.sourceCaches[r]!==void 0)throw new Error(`Source "${r}" already exists.`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(c.y.source,`sources.${r}`,o,null,h))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const f=this.sourceCaches[r]=new di(r,o,this.dispatcher);f.style=this,f.setEventedParent(this,()=>({isSourceLoaded:f.loaded(),source:f.serialize(),sourceId:r})),f.onAdd(this.map),this._changed=!0}removeSource(r){if(this._checkLoaded(),this.sourceCaches[r]===void 0)throw new Error("There is no source with this ID");for(const h in this._layers)if(this._layers[h].source===r)return this.fire(new c.j(new Error(`Source "${r}" cannot be removed while layer "${h}" is using it.`)));const o=this.sourceCaches[r];delete this.sourceCaches[r],delete this._updatedSources[r],o.fire(new c.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:r})),o.setEventedParent(null),o.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(r,o){if(this._checkLoaded(),this.sourceCaches[r]===void 0)throw new Error(`There is no source with this ID=${r}`);const h=this.sourceCaches[r].getSource();if(h.type!=="geojson")throw new Error(`geojsonSource.type is ${h.type}, which is !== 'geojson`);h.setData(o),this._changed=!0}getSource(r){return this.sourceCaches[r]&&this.sourceCaches[r].getSource()}addLayer(r,o,h={}){this._checkLoaded();const f=r.id;if(this.getLayer(f))return void this.fire(new c.j(new Error(`Layer "${f}" already exists on this map.`)));let y;if(r.type==="custom"){if(xn(this,c.aF(r)))return;y=c.aC(r)}else{if("source"in r&&typeof r.source=="object"&&(this.addSource(f,r.source),r=c.aD(r),r=c.e(r,{source:f})),this._validate(c.y.layer,`layers.${f}`,r,{arrayIndex:-1},h))return;y=c.aC(r),this._validateLayer(y),y.setEventedParent(this,{layer:{id:f}})}const w=o?this._order.indexOf(o):this._order.length;if(o&&w===-1)this.fire(new c.j(new Error(`Cannot add layer "${f}" before non-existing layer "${o}".`)));else{if(this._order.splice(w,0,f),this._layerOrderChanged=!0,this._layers[f]=y,this._removedLayers[f]&&y.source&&y.type!=="custom"){const S=this._removedLayers[f];delete this._removedLayers[f],S.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",this.sourceCaches[y.source].pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map)}}moveLayer(r,o){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new c.j(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===o)return;const h=this._order.indexOf(r);this._order.splice(h,1);const f=o?this._order.indexOf(o):this._order.length;o&&f===-1?this.fire(new c.j(new Error(`Cannot move layer "${r}" before non-existing layer "${o}".`))):(this._order.splice(f,0,r),this._layerOrderChanged=!0)}removeLayer(r){this._checkLoaded();const o=this._layers[r];if(!o)return void this.fire(new c.j(new Error(`Cannot remove non-existing layer "${r}".`)));o.setEventedParent(null);const h=this._order.indexOf(r);this._order.splice(h,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=o,delete this._layers[r],this._serializedLayers&&delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],o.onRemove&&o.onRemove(this.map)}getLayer(r){return this._layers[r]}getLayersOrder(){return[...this._order]}hasLayer(r){return r in this._layers}setLayerZoomRange(r,o,h){this._checkLoaded();const f=this.getLayer(r);f?f.minzoom===o&&f.maxzoom===h||(o!=null&&(f.minzoom=o),h!=null&&(f.maxzoom=h),this._updateLayer(f)):this.fire(new c.j(new Error(`Cannot set the zoom range of non-existing layer "${r}".`)))}setFilter(r,o,h={}){this._checkLoaded();const f=this.getLayer(r);if(f){if(!c.aG(f.filter,o))return o==null?(f.filter=void 0,void this._updateLayer(f)):void(this._validate(c.y.filter,`layers.${f.id}.filter`,o,null,h)||(f.filter=c.aD(o),this._updateLayer(f)))}else this.fire(new c.j(new Error(`Cannot filter non-existing layer "${r}".`)))}getFilter(r){return c.aD(this.getLayer(r).filter)}setLayoutProperty(r,o,h,f={}){this._checkLoaded();const y=this.getLayer(r);y?c.aG(y.getLayoutProperty(o),h)||(y.setLayoutProperty(o,h,f),this._updateLayer(y)):this.fire(new c.j(new Error(`Cannot style non-existing layer "${r}".`)))}getLayoutProperty(r,o){const h=this.getLayer(r);if(h)return h.getLayoutProperty(o);this.fire(new c.j(new Error(`Cannot get style of non-existing layer "${r}".`)))}setPaintProperty(r,o,h,f={}){this._checkLoaded();const y=this.getLayer(r);y?c.aG(y.getPaintProperty(o),h)||(y.setPaintProperty(o,h,f)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new c.j(new Error(`Cannot style non-existing layer "${r}".`)))}getPaintProperty(r,o){return this.getLayer(r).getPaintProperty(o)}setFeatureState(r,o){this._checkLoaded();const h=r.source,f=r.sourceLayer,y=this.sourceCaches[h];if(y===void 0)return void this.fire(new c.j(new Error(`The source '${h}' does not exist in the map's style.`)));const w=y.getSource().type;w==="geojson"&&f?this.fire(new c.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):w!=="vector"||f?(r.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),y.setFeatureState(f,r.id,o)):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(r,o){this._checkLoaded();const h=r.source,f=this.sourceCaches[h];if(f===void 0)return void this.fire(new c.j(new Error(`The source '${h}' does not exist in the map's style.`)));const y=f.getSource().type,w=y==="vector"?r.sourceLayer:void 0;y!=="vector"||w?o&&typeof r.id!="string"&&typeof r.id!="number"?this.fire(new c.j(new Error("A feature id is required to remove its specific state property."))):f.removeFeatureState(w,r.id,o):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(r){this._checkLoaded();const o=r.source,h=r.sourceLayer,f=this.sourceCaches[o];if(f!==void 0)return f.getSource().type!=="vector"||h?(r.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),f.getFeatureState(h,r.id)):void this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.j(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const r=c.aH(this.sourceCaches,y=>y.serialize()),o=this._serializeByIds(this._order),h=this.map.getTerrain()||void 0,f=this.stylesheet;return c.aI({version:f.version,name:f.name,metadata:f.metadata,light:f.light,center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch,sprite:f.sprite,glyphs:f.glyphs,transition:f.transition,sources:r,layers:o,terrain:h},y=>y!==void 0)}_updateLayer(r){this._updatedLayers[r.id]=!0,r.source&&!this._updatedSources[r.source]&&this.sourceCaches[r.source].getSource().type!=="raster"&&(this._updatedSources[r.source]="reload",this.sourceCaches[r.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(r){const o=w=>this._layers[w].type==="fill-extrusion",h={},f=[];for(let w=this._order.length-1;w>=0;w--){const S=this._order[w];if(o(S)){h[S]=w;for(const k of r){const C=k[S];if(C)for(const D of C)f.push(D)}}}f.sort((w,S)=>S.intersectionZ-w.intersectionZ);const y=[];for(let w=this._order.length-1;w>=0;w--){const S=this._order[w];if(o(S))for(let k=f.length-1;k>=0;k--){const C=f[k].feature;if(h[C.layer.id]<w)break;y.push(C),f.pop()}else for(const k of r){const C=k[S];if(C)for(const D of C)y.push(D.feature)}}return y}queryRenderedFeatures(r,o,h){o&&o.filter&&this._validate(c.y.filter,"queryRenderedFeatures.filter",o.filter,null,o);const f={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new c.j(new Error("parameters.layers must be an Array."))),[];for(const S of o.layers){const k=this._layers[S];if(!k)return this.fire(new c.j(new Error(`The layer '${S}' does not exist in the map's style and cannot be queried for features.`))),[];f[k.source]=!0}}const y=[];o.availableImages=this._availableImages;const w=this._serializedAllLayers();for(const S in this.sourceCaches)o.layers&&!f[S]||y.push(Kr(this.sourceCaches[S],this._layers,w,r,o,h));return this.placement&&y.push(function(S,k,C,D,P,N,H){const W={},X=N.queryRenderedSymbols(D),G=[];for(const pe of Object.keys(X).map(Number))G.push(H[pe]);G.sort(ai);for(const pe of G){const we=pe.featureIndex.lookupSymbolFeatures(X[pe.bucketInstanceId],k,pe.bucketIndex,pe.sourceLayerIndex,P.filter,P.layers,P.availableImages,S);for(const re in we){const me=W[re]=W[re]||[],Te=we[re];Te.sort((ke,Re)=>{const He=pe.featureSortOrder;if(He){const Ue=He.indexOf(ke.featureIndex);return He.indexOf(Re.featureIndex)-Ue}return Re.featureIndex-ke.featureIndex});for(const ke of Te)me.push(ke)}}for(const pe in W)W[pe].forEach(we=>{const re=we.feature,me=C[S[pe].source].getFeatureState(re.layer["source-layer"],re.id);re.source=re.layer.source,re.layer["source-layer"]&&(re.sourceLayer=re.layer["source-layer"]),re.state=me});return W}(this._layers,w,this.sourceCaches,r,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(r,o){o&&o.filter&&this._validate(c.y.filter,"querySourceFeatures.filter",o.filter,null,o);const h=this.sourceCaches[r];return h?function(f,y){const w=f.getRenderableIds().map(C=>f.getTileByID(C)),S=[],k={};for(let C=0;C<w.length;C++){const D=w[C],P=D.tileID.canonical.key;k[P]||(k[P]=!0,D.querySourceFeatures(S,y))}return S}(h,o):[]}addSourceType(r,o,h){return br(r)?h(new Error(`A source type called "${r}" already exists.`)):(((f,y)=>{$r[f]=y})(r,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:o.workerSourceURL},h):h(null,null))}getLight(){return this.light.getLight()}setLight(r,o={}){this._checkLoaded();const h=this.light.getLight();let f=!1;for(const w in r)if(!c.aG(r[w],h[w])){f=!0;break}if(!f)return;const y={now:c.h.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(r,o),this.light.updateTransitions(y)}_validate(r,o,h,f,y={}){return(!y||y.validate!==!1)&&xn(this,r.call(c.y,c.e({key:o,style:this.serialize(),value:h,styleSpec:c.v},f)))}_remove(r=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),c.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this.sourceCaches){const h=this.sourceCaches[o];h.setEventedParent(null),h.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(r)}_clearSource(r){this.sourceCaches[r].clearTiles()}_reloadSource(r){this.sourceCaches[r].resume(),this.sourceCaches[r].reload()}_updateSources(r){for(const o in this.sourceCaches)this.sourceCaches[o].update(r,this.map.terrain)}_generateCollisionBoxes(){for(const r in this.sourceCaches)this._reloadSource(r)}_updatePlacement(r,o,h,f,y=!1){let w=!1,S=!1;const k={};for(const C of this._order){const D=this._layers[C];if(D.type!=="symbol")continue;if(!k[D.source]){const N=this.sourceCaches[D.source];k[D.source]=N.getRenderableIds(!0).map(H=>N.getTileByID(H)).sort((H,W)=>W.tileID.overscaledZ-H.tileID.overscaledZ||(H.tileID.isLessThan(W.tileID)?-1:1))}const P=this.crossTileSymbolIndex.addLayer(D,k[D.source],r.center.lng);w=w||P}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((y=y||this._layerOrderChanged||h===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(c.h.now(),r.zoom))&&(this.pauseablePlacement=new bo(r,this.map.terrain,this._order,y,o,h,f,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(c.h.now()),S=!0),w&&this.pauseablePlacement.placement.setStale()),S||w)for(const C of this._order){const D=this._layers[C];D.type==="symbol"&&this.placement.updateLayerOpacities(D,k[D.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(c.h.now())}_releaseSymbolFadeTiles(){for(const r in this.sourceCaches)this.sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,o,h){this.imageManager.getImages(o.icons,h),this._updateTilesForChangedImages();const f=this.sourceCaches[o.source];f&&f.setDependencies(o.tileID.key,o.type,o.icons)}getGlyphs(r,o,h){this.glyphManager.getGlyphs(o.stacks,h);const f=this.sourceCaches[o.source];f&&f.setDependencies(o.tileID.key,o.type,[""])}getResource(r,o,h){return c.m(o,h)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(r,o={}){this._checkLoaded(),r&&this._validate(c.y.glyphs,"glyphs",r,null,o)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=r,this.glyphManager.entries={},this.glyphManager.setURL(r))}addSprite(r,o,h={},f){this._checkLoaded();const y=[{id:r,url:o}],w=[...Ee(this.stylesheet.sprite),...y];this._validate(c.y.sprite,"sprite",w,null,h)||(this.stylesheet.sprite=w,this._loadSprite(y,!0,f))}removeSprite(r){this._checkLoaded();const o=Ee(this.stylesheet.sprite);if(o.find(h=>h.id===r)){if(this._spritesImagesIds[r])for(const h of this._spritesImagesIds[r])this.imageManager.removeImage(h),this._changedImages[h]=!0;o.splice(o.findIndex(h=>h.id===r),1),this.stylesheet.sprite=o.length>0?o:void 0,delete this._spritesImagesIds[r],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}else this.fire(new c.j(new Error(`Sprite "${r}" doesn't exists on this map.`)))}getSprite(){return Ee(this.stylesheet.sprite)}setSprite(r,o={},h){this._checkLoaded(),r&&this._validate(c.y.sprite,"sprite",r,null,o)||(this.stylesheet.sprite=r,r?this._loadSprite(r,!0,h):(this._unloadSprite(),h&&h(null)))}}hn.registerForPluginStateChange=c.aK;var Vl=c.Q([{name:"a_pos",type:"Int16",components:2}]),wo="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const _i={prelude:zr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:zr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:zr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:zr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:zr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:zr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:zr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:zr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:zr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:zr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:zr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:zr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:zr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:zr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:zr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:zr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:zr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:zr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:zr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:zr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:zr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:zr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:zr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:zr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:zr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:zr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:zr("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",wo),terrainDepth:zr("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",wo),terrainCoords:zr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",wo)};function zr(m,r){const o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=r.match(/attribute ([\w]+) ([\w]+)/g),f=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=r.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=y?y.concat(f):f,S={};return{fragmentSource:m=m.replace(o,(k,C,D,P,N)=>(S[N]=!0,C==="define"?`
#ifndef HAS_UNIFORM_u_${N}
varying ${D} ${P} ${N};
#else
uniform ${D} ${P} u_${N};
#endif
`:`
#ifdef HAS_UNIFORM_u_${N}
    ${D} ${P} ${N} = u_${N};
#endif
`)),vertexSource:r=r.replace(o,(k,C,D,P,N)=>{const H=P==="float"?"vec2":"vec4",W=N.match(/color/)?"color":H;return S[N]?C==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
attribute ${D} ${H} a_${N};
varying ${D} ${P} ${N};
#else
uniform ${D} ${P} u_${N};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = a_${N};
#else
    ${D} ${P} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = unpack_mix_${W}(a_${N}, u_${N}_t);
#else
    ${D} ${P} ${N} = u_${N};
#endif
`:C==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
attribute ${D} ${H} a_${N};
#else
uniform ${D} ${P} u_${N};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${D} ${P} ${N} = a_${N};
#else
    ${D} ${P} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${D} ${P} ${N} = unpack_mix_${W}(a_${N}, u_${N}_t);
#else
    ${D} ${P} ${N} = u_${N};
#endif
`}),staticAttributes:h,staticUniforms:w}}class qa{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(r,o,h,f,y,w,S,k,C){this.context=r;let D=this.boundPaintVertexBuffers.length!==f.length;for(let P=0;!D&&P<f.length;P++)this.boundPaintVertexBuffers[P]!==f[P]&&(D=!0);!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==h||D||this.boundIndexBuffer!==y||this.boundVertexOffset!==w||this.boundDynamicVertexBuffer!==S||this.boundDynamicVertexBuffer2!==k||this.boundDynamicVertexBuffer3!==C?this.freshBind(o,h,f,y,w,S,k,C):(r.bindVertexArray.set(this.vao),S&&S.bind(),y&&y.dynamicDraw&&y.bind(),k&&k.bind(),C&&C.bind())}freshBind(r,o,h,f,y,w,S,k){const C=r.numAttributes,D=this.context,P=D.gl;this.vao&&this.destroy(),this.vao=D.createVertexArray(),D.bindVertexArray.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=f,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=S,this.boundDynamicVertexBuffer3=k,o.enableAttributes(P,r);for(const N of h)N.enableAttributes(P,r);w&&w.enableAttributes(P,r),S&&S.enableAttributes(P,r),k&&k.enableAttributes(P,r),o.bind(),o.setVertexAttribPointers(P,r,y);for(const N of h)N.bind(),N.setVertexAttribPointers(P,r,y);w&&(w.bind(),w.setVertexAttribPointers(P,r,y)),f&&f.bind(),S&&(S.bind(),S.setVertexAttribPointers(P,r,y)),k&&(k.bind(),k.setVertexAttribPointers(P,r,y)),D.currentNumAttributes=C}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Ii(m){const r=[];for(let o=0;o<m.length;o++){if(m[o]===null)continue;const h=m[o].split(" ");r.push(h.pop())}return r}class jl{constructor(r,o,h,f,y,w){const S=r.gl;this.program=S.createProgram();const k=Ii(o.staticAttributes),C=h?h.getBinderAttributes():[],D=k.concat(C),P=_i.prelude.staticUniforms?Ii(_i.prelude.staticUniforms):[],N=o.staticUniforms?Ii(o.staticUniforms):[],H=h?h.getBinderUniforms():[],W=P.concat(N).concat(H),X=[];for(const ke of W)X.indexOf(ke)<0&&X.push(ke);const G=h?h.defines():[];y&&G.push("#define OVERDRAW_INSPECTOR;"),w&&G.push("#define TERRAIN3D;");const pe=G.concat(_i.prelude.fragmentSource,o.fragmentSource).join(`
`),we=G.concat(_i.prelude.vertexSource,o.vertexSource).join(`
`),re=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);if(S.shaderSource(re,pe),S.compileShader(re),!S.getShaderParameter(re,S.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${S.getShaderInfoLog(re)}`);S.attachShader(this.program,re);const me=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);if(S.shaderSource(me,we),S.compileShader(me),!S.getShaderParameter(me,S.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${S.getShaderInfoLog(me)}`);S.attachShader(this.program,me),this.attributes={};const Te={};this.numAttributes=D.length;for(let ke=0;ke<this.numAttributes;ke++)D[ke]&&(S.bindAttribLocation(this.program,ke,D[ke]),this.attributes[D[ke]]=ke);if(S.linkProgram(this.program),!S.getProgramParameter(this.program,S.LINK_STATUS))throw new Error(`Program failed to link: ${S.getProgramInfoLog(this.program)}`);S.deleteShader(me),S.deleteShader(re);for(let ke=0;ke<X.length;ke++){const Re=X[ke];if(Re&&!Te[Re]){const He=S.getUniformLocation(this.program,Re);He&&(Te[Re]=He)}}this.fixedUniforms=f(r,Te),this.terrainUniforms=((ke,Re)=>({u_depth:new c.aL(ke,Re.u_depth),u_terrain:new c.aL(ke,Re.u_terrain),u_terrain_dim:new c.aM(ke,Re.u_terrain_dim),u_terrain_matrix:new c.aN(ke,Re.u_terrain_matrix),u_terrain_unpack:new c.aO(ke,Re.u_terrain_unpack),u_terrain_exaggeration:new c.aM(ke,Re.u_terrain_exaggeration)}))(r,Te),this.binderUniforms=h?h.getUniforms(r,Te):[]}draw(r,o,h,f,y,w,S,k,C,D,P,N,H,W,X,G,pe,we){const re=r.gl;if(this.failedToCreate)return;if(r.program.set(this.program),r.setDepthMode(h),r.setStencilMode(f),r.setColorMode(y),r.setCullFace(w),k){r.activeTexture.set(re.TEXTURE2),re.bindTexture(re.TEXTURE_2D,k.depthTexture),r.activeTexture.set(re.TEXTURE3),re.bindTexture(re.TEXTURE_2D,k.texture);for(const Te in this.terrainUniforms)this.terrainUniforms[Te].set(k[Te])}for(const Te in this.fixedUniforms)this.fixedUniforms[Te].set(S[Te]);X&&X.setUniforms(r,this.binderUniforms,H,{zoom:W});let me=0;switch(o){case re.LINES:me=2;break;case re.TRIANGLES:me=3;break;case re.LINE_STRIP:me=1}for(const Te of N.get()){const ke=Te.vaos||(Te.vaos={});(ke[C]||(ke[C]=new qa)).bind(r,this,D,X?X.getPaintVertexBuffers():[],P,Te.vertexOffset,G,pe,we),re.drawElements(o,Te.primitiveLength*me,re.UNSIGNED_SHORT,Te.primitiveOffset*me*2)}}}function hs(m,r,o){const h=1/he(o,1,r.transform.tileZoom),f=Math.pow(2,o.tileID.overscaledZ),y=o.tileSize*Math.pow(2,r.transform.tileZoom)/f,w=y*(o.tileID.canonical.x+o.tileID.wrap*f),S=y*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[h,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[w>>16,S>>16],u_pixel_coord_lower:[65535&w,65535&S]}}const du=(m,r,o,h)=>{const f=r.style.light,y=f.properties.get("position"),w=[y.x,y.y,y.z],S=function(){var C=new c.A(9);return c.A!=Float32Array&&(C[1]=0,C[2]=0,C[3]=0,C[5]=0,C[6]=0,C[7]=0),C[0]=1,C[4]=1,C[8]=1,C}();f.properties.get("anchor")==="viewport"&&function(C,D){var P=Math.sin(D),N=Math.cos(D);C[0]=N,C[1]=P,C[2]=0,C[3]=-P,C[4]=N,C[5]=0,C[6]=0,C[7]=0,C[8]=1}(S,-r.transform.angle),function(C,D,P){var N=D[0],H=D[1],W=D[2];C[0]=N*P[0]+H*P[3]+W*P[6],C[1]=N*P[1]+H*P[4]+W*P[7],C[2]=N*P[2]+H*P[5]+W*P[8]}(w,w,S);const k=f.properties.get("color");return{u_matrix:m,u_lightpos:w,u_lightintensity:f.properties.get("intensity"),u_lightcolor:[k.r,k.g,k.b],u_vertical_gradient:+o,u_opacity:h}},_a=(m,r,o,h,f,y,w)=>c.e(du(m,r,o,h),hs(y,r,w),{u_height_factor:-Math.pow(2,f.overscaledZ)/w.tileSize/8}),cd=m=>({u_matrix:m}),fu=(m,r,o,h)=>c.e(cd(m),hs(o,r,h)),ql=(m,r)=>({u_matrix:m,u_world:r}),Gl=(m,r,o,h,f)=>c.e(fu(m,r,o,h),{u_world:f}),va=(m,r,o,h)=>{const f=m.transform;let y,w;if(h.paint.get("circle-pitch-alignment")==="map"){const S=he(o,1,f.zoom);y=!0,w=[S,S]}else y=!1,w=f.pixelsToGLUnits;return{u_camera_to_center_distance:f.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_matrix:m.translatePosMatrix(r.posMatrix,o,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_pitch_with_map:+y,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:w}},pu=(m,r,o)=>{const h=he(o,1,r.zoom),f=Math.pow(2,r.zoom-o.tileID.overscaledZ),y=o.tileID.overscaleFactor();return{u_matrix:m,u_camera_to_center_distance:r.cameraToCenterDistance,u_pixels_to_tile_units:h,u_extrude_scale:[r.pixelsToGLUnits[0]/(h*f),r.pixelsToGLUnits[1]/(h*f)],u_overscale_factor:y}},il=(m,r,o=1)=>({u_matrix:m,u_color:r,u_overlay:0,u_overlay_scale:o}),ud=m=>({u_matrix:m}),nm=(m,r,o,h)=>({u_matrix:m,u_extrude_scale:he(r,1,o),u_intensity:h});function mu(m,r){const o=Math.pow(2,r.canonical.z),h=r.canonical.y;return[new c.U(0,h/o).toLngLat().lat,new c.U(0,(h+1)/o).toLngLat().lat]}const gu=(m,r,o,h)=>{const f=m.transform;return{u_matrix:Zl(m,r,o,h),u_ratio:1/he(r,1,f.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},hd=(m,r,o,h,f)=>c.e(gu(m,r,o,f),{u_image:0,u_image_height:h}),sm=(m,r,o,h,f)=>{const y=m.transform,w=fd(r,y);return{u_matrix:Zl(m,r,o,f),u_texsize:r.imageAtlasTexture.size,u_ratio:1/he(r,1,y.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[w,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},dd=(m,r,o,h,f,y)=>{const w=m.lineAtlas,S=fd(r,m.transform),k=o.layout.get("line-cap")==="round",C=w.getDash(h.from,k),D=w.getDash(h.to,k),P=C.width*f.fromScale,N=D.width*f.toScale;return c.e(gu(m,r,o,y),{u_patternscale_a:[S/P,-C.height/2],u_patternscale_b:[S/N,-D.height/2],u_sdfgamma:w.width/(256*Math.min(P,N)*m.pixelRatio)/2,u_image:0,u_tex_y_a:C.y,u_tex_y_b:D.y,u_mix:f.t})};function fd(m,r){return 1/he(m,1,r.tileZoom)}function Zl(m,r,o,h){return m.translatePosMatrix(h?h.posMatrix:r.tileID.posMatrix,r,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const pd=(m,r,o,h,f)=>{return{u_matrix:m,u_tl_parent:r,u_scale_parent:o,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*f.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:f.paint.get("raster-brightness-min"),u_brightness_high:f.paint.get("raster-brightness-max"),u_saturation_factor:(w=f.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(y=f.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:md(f.paint.get("raster-hue-rotate"))};var y,w};function md(m){m*=Math.PI/180;const r=Math.sin(m),o=Math.cos(m);return[(2*o+1)/3,(-Math.sqrt(3)*r-o+1)/3,(Math.sqrt(3)*r-o+1)/3]}const yu=(m,r,o,h,f,y,w,S,k,C)=>{const D=f.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:D.cameraToCenterDistance,u_pitch:D.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:D.width/D.height,u_fade_change:f.options.fadeDuration?f.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:w,u_coord_matrix:S,u_is_text:+k,u_pitch_with_map:+h,u_texsize:C,u_texture:0}},_u=(m,r,o,h,f,y,w,S,k,C,D)=>{const P=f.transform;return c.e(yu(m,r,o,h,f,y,w,S,k,C),{u_gamma_scale:h?Math.cos(P._pitch)*P.cameraToCenterDistance:1,u_device_pixel_ratio:f.pixelRatio,u_is_halo:+D})},Ga=(m,r,o,h,f,y,w,S,k,C)=>c.e(_u(m,r,o,h,f,y,w,S,!0,k,!0),{u_texsize_icon:C,u_texture_icon:1}),Wl=(m,r,o)=>({u_matrix:m,u_opacity:r,u_color:o}),ds=(m,r,o,h,f,y)=>c.e(function(w,S,k,C){const D=k.imageManager.getPattern(w.from.toString()),P=k.imageManager.getPattern(w.to.toString()),{width:N,height:H}=k.imageManager.getPixelSize(),W=Math.pow(2,C.tileID.overscaledZ),X=C.tileSize*Math.pow(2,k.transform.tileZoom)/W,G=X*(C.tileID.canonical.x+C.tileID.wrap*W),pe=X*C.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:D.tl,u_pattern_br_a:D.br,u_pattern_tl_b:P.tl,u_pattern_br_b:P.br,u_texsize:[N,H],u_mix:S.t,u_pattern_size_a:D.displaySize,u_pattern_size_b:P.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/he(C,1,k.transform.tileZoom),u_pixel_coord_upper:[G>>16,pe>>16],u_pixel_coord_lower:[65535&G,65535&pe]}}(h,y,o,f),{u_matrix:m,u_opacity:r}),Hl={fillExtrusion:(m,r)=>({u_matrix:new c.aN(m,r.u_matrix),u_lightpos:new c.aP(m,r.u_lightpos),u_lightintensity:new c.aM(m,r.u_lightintensity),u_lightcolor:new c.aP(m,r.u_lightcolor),u_vertical_gradient:new c.aM(m,r.u_vertical_gradient),u_opacity:new c.aM(m,r.u_opacity)}),fillExtrusionPattern:(m,r)=>({u_matrix:new c.aN(m,r.u_matrix),u_lightpos:new c.aP(m,r.u_lightpos),u_lightintensity:new c.aM(m,r.u_lightintensity),u_lightcolor:new c.aP(m,r.u_lightcolor),u_vertical_gradient:new c.aM(m,r.u_vertical_gradient),u_height_factor:new c.aM(m,r.u_height_factor),u_image:new c.aL(m,r.u_image),u_texsize:new c.aQ(m,r.u_texsize),u_pixel_coord_upper:new c.aQ(m,r.u_pixel_coord_upper),u_pixel_coord_lower:new c.aQ(m,r.u_pixel_coord_lower),u_scale:new c.aP(m,r.u_scale),u_fade:new c.aM(m,r.u_fade),u_opacity:new c.aM(m,r.u_opacity)}),fill:(m,r)=>({u_matrix:new c.aN(m,r.u_matrix)}),fillPattern:(m,r)=>({u_matrix:new c.aN(m,r.u_matrix),u_image:new c.aL(m,r.u_image),u_texsize:new c.aQ(m,r.u_texsize),u_pixel_coord_upper:new c.aQ(m,r.u_pixel_coord_upper),u_pixel_coord_lower:new c.aQ(m,r.u_pixel_coord_lower),u_scale:new c.aP(m,r.u_scale),u_fade:new c.aM(m,r.u_fade)}),fillOutline:(m,r)=>({u_matrix:new c.aN(m,r.u_matrix),u_world:new c.aQ(m,r.u_world)}),fillOutlinePattern:(m,r)=>({u_matrix:new c.aN(m,r.u_matrix),u_world:new c.aQ(m,r.u_world),u_image:new c.aL(m,r.u_image),u_texsize:new c.aQ(m,r.u_texsize),u_pixel_coord_upper:new c.aQ(m,r.u_pixel_coord_upper),u_pixel_coord_lower:new c.aQ(m,r.u_pixel_coord_lower),u_scale:new c.aP(m,r.u_scale),u_fade:new c.aM(m,r.u_fade)}),circle:(m,r)=>({u_camera_to_center_distance:new c.aM(m,r.u_camera_to_center_distance),u_scale_with_map:new c.aL(m,r.u_scale_with_map),u_pitch_with_map:new c.aL(m,r.u_pitch_with_map),u_extrude_scale:new c.aQ(m,r.u_extrude_scale),u_device_pixel_ratio:new c.aM(m,r.u_device_pixel_ratio),u_matrix:new c.aN(m,r.u_matrix)}),collisionBox:(m,r)=>({u_matrix:new c.aN(m,r.u_matrix),u_camera_to_center_distance:new c.aM(m,r.u_camera_to_center_distance),u_pixels_to_tile_units:new c.aM(m,r.u_pixels_to_tile_units),u_extrude_scale:new c.aQ(m,r.u_extrude_scale),u_overscale_factor:new c.aM(m,r.u_overscale_factor)}),collisionCircle:(m,r)=>({u_matrix:new c.aN(m,r.u_matrix),u_inv_matrix:new c.aN(m,r.u_inv_matrix),u_camera_to_center_distance:new c.aM(m,r.u_camera_to_center_distance),u_viewport_size:new c.aQ(m,r.u_viewport_size)}),debug:(m,r)=>({u_color:new c.aR(m,r.u_color),u_matrix:new c.aN(m,r.u_matrix),u_overlay:new c.aL(m,r.u_overlay),u_overlay_scale:new c.aM(m,r.u_overlay_scale)}),clippingMask:(m,r)=>({u_matrix:new c.aN(m,r.u_matrix)}),heatmap:(m,r)=>({u_extrude_scale:new c.aM(m,r.u_extrude_scale),u_intensity:new c.aM(m,r.u_intensity),u_matrix:new c.aN(m,r.u_matrix)}),heatmapTexture:(m,r)=>({u_matrix:new c.aN(m,r.u_matrix),u_world:new c.aQ(m,r.u_world),u_image:new c.aL(m,r.u_image),u_color_ramp:new c.aL(m,r.u_color_ramp),u_opacity:new c.aM(m,r.u_opacity)}),hillshade:(m,r)=>({u_matrix:new c.aN(m,r.u_matrix),u_image:new c.aL(m,r.u_image),u_latrange:new c.aQ(m,r.u_latrange),u_light:new c.aQ(m,r.u_light),u_shadow:new c.aR(m,r.u_shadow),u_highlight:new c.aR(m,r.u_highlight),u_accent:new c.aR(m,r.u_accent)}),hillshadePrepare:(m,r)=>({u_matrix:new c.aN(m,r.u_matrix),u_image:new c.aL(m,r.u_image),u_dimension:new c.aQ(m,r.u_dimension),u_zoom:new c.aM(m,r.u_zoom),u_unpack:new c.aO(m,r.u_unpack)}),line:(m,r)=>({u_matrix:new c.aN(m,r.u_matrix),u_ratio:new c.aM(m,r.u_ratio),u_device_pixel_ratio:new c.aM(m,r.u_device_pixel_ratio),u_units_to_pixels:new c.aQ(m,r.u_units_to_pixels)}),lineGradient:(m,r)=>({u_matrix:new c.aN(m,r.u_matrix),u_ratio:new c.aM(m,r.u_ratio),u_device_pixel_ratio:new c.aM(m,r.u_device_pixel_ratio),u_units_to_pixels:new c.aQ(m,r.u_units_to_pixels),u_image:new c.aL(m,r.u_image),u_image_height:new c.aM(m,r.u_image_height)}),linePattern:(m,r)=>({u_matrix:new c.aN(m,r.u_matrix),u_texsize:new c.aQ(m,r.u_texsize),u_ratio:new c.aM(m,r.u_ratio),u_device_pixel_ratio:new c.aM(m,r.u_device_pixel_ratio),u_image:new c.aL(m,r.u_image),u_units_to_pixels:new c.aQ(m,r.u_units_to_pixels),u_scale:new c.aP(m,r.u_scale),u_fade:new c.aM(m,r.u_fade)}),lineSDF:(m,r)=>({u_matrix:new c.aN(m,r.u_matrix),u_ratio:new c.aM(m,r.u_ratio),u_device_pixel_ratio:new c.aM(m,r.u_device_pixel_ratio),u_units_to_pixels:new c.aQ(m,r.u_units_to_pixels),u_patternscale_a:new c.aQ(m,r.u_patternscale_a),u_patternscale_b:new c.aQ(m,r.u_patternscale_b),u_sdfgamma:new c.aM(m,r.u_sdfgamma),u_image:new c.aL(m,r.u_image),u_tex_y_a:new c.aM(m,r.u_tex_y_a),u_tex_y_b:new c.aM(m,r.u_tex_y_b),u_mix:new c.aM(m,r.u_mix)}),raster:(m,r)=>({u_matrix:new c.aN(m,r.u_matrix),u_tl_parent:new c.aQ(m,r.u_tl_parent),u_scale_parent:new c.aM(m,r.u_scale_parent),u_buffer_scale:new c.aM(m,r.u_buffer_scale),u_fade_t:new c.aM(m,r.u_fade_t),u_opacity:new c.aM(m,r.u_opacity),u_image0:new c.aL(m,r.u_image0),u_image1:new c.aL(m,r.u_image1),u_brightness_low:new c.aM(m,r.u_brightness_low),u_brightness_high:new c.aM(m,r.u_brightness_high),u_saturation_factor:new c.aM(m,r.u_saturation_factor),u_contrast_factor:new c.aM(m,r.u_contrast_factor),u_spin_weights:new c.aP(m,r.u_spin_weights)}),symbolIcon:(m,r)=>({u_is_size_zoom_constant:new c.aL(m,r.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aL(m,r.u_is_size_feature_constant),u_size_t:new c.aM(m,r.u_size_t),u_size:new c.aM(m,r.u_size),u_camera_to_center_distance:new c.aM(m,r.u_camera_to_center_distance),u_pitch:new c.aM(m,r.u_pitch),u_rotate_symbol:new c.aL(m,r.u_rotate_symbol),u_aspect_ratio:new c.aM(m,r.u_aspect_ratio),u_fade_change:new c.aM(m,r.u_fade_change),u_matrix:new c.aN(m,r.u_matrix),u_label_plane_matrix:new c.aN(m,r.u_label_plane_matrix),u_coord_matrix:new c.aN(m,r.u_coord_matrix),u_is_text:new c.aL(m,r.u_is_text),u_pitch_with_map:new c.aL(m,r.u_pitch_with_map),u_texsize:new c.aQ(m,r.u_texsize),u_texture:new c.aL(m,r.u_texture)}),symbolSDF:(m,r)=>({u_is_size_zoom_constant:new c.aL(m,r.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aL(m,r.u_is_size_feature_constant),u_size_t:new c.aM(m,r.u_size_t),u_size:new c.aM(m,r.u_size),u_camera_to_center_distance:new c.aM(m,r.u_camera_to_center_distance),u_pitch:new c.aM(m,r.u_pitch),u_rotate_symbol:new c.aL(m,r.u_rotate_symbol),u_aspect_ratio:new c.aM(m,r.u_aspect_ratio),u_fade_change:new c.aM(m,r.u_fade_change),u_matrix:new c.aN(m,r.u_matrix),u_label_plane_matrix:new c.aN(m,r.u_label_plane_matrix),u_coord_matrix:new c.aN(m,r.u_coord_matrix),u_is_text:new c.aL(m,r.u_is_text),u_pitch_with_map:new c.aL(m,r.u_pitch_with_map),u_texsize:new c.aQ(m,r.u_texsize),u_texture:new c.aL(m,r.u_texture),u_gamma_scale:new c.aM(m,r.u_gamma_scale),u_device_pixel_ratio:new c.aM(m,r.u_device_pixel_ratio),u_is_halo:new c.aL(m,r.u_is_halo)}),symbolTextAndIcon:(m,r)=>({u_is_size_zoom_constant:new c.aL(m,r.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aL(m,r.u_is_size_feature_constant),u_size_t:new c.aM(m,r.u_size_t),u_size:new c.aM(m,r.u_size),u_camera_to_center_distance:new c.aM(m,r.u_camera_to_center_distance),u_pitch:new c.aM(m,r.u_pitch),u_rotate_symbol:new c.aL(m,r.u_rotate_symbol),u_aspect_ratio:new c.aM(m,r.u_aspect_ratio),u_fade_change:new c.aM(m,r.u_fade_change),u_matrix:new c.aN(m,r.u_matrix),u_label_plane_matrix:new c.aN(m,r.u_label_plane_matrix),u_coord_matrix:new c.aN(m,r.u_coord_matrix),u_is_text:new c.aL(m,r.u_is_text),u_pitch_with_map:new c.aL(m,r.u_pitch_with_map),u_texsize:new c.aQ(m,r.u_texsize),u_texsize_icon:new c.aQ(m,r.u_texsize_icon),u_texture:new c.aL(m,r.u_texture),u_texture_icon:new c.aL(m,r.u_texture_icon),u_gamma_scale:new c.aM(m,r.u_gamma_scale),u_device_pixel_ratio:new c.aM(m,r.u_device_pixel_ratio),u_is_halo:new c.aL(m,r.u_is_halo)}),background:(m,r)=>({u_matrix:new c.aN(m,r.u_matrix),u_opacity:new c.aM(m,r.u_opacity),u_color:new c.aR(m,r.u_color)}),backgroundPattern:(m,r)=>({u_matrix:new c.aN(m,r.u_matrix),u_opacity:new c.aM(m,r.u_opacity),u_image:new c.aL(m,r.u_image),u_pattern_tl_a:new c.aQ(m,r.u_pattern_tl_a),u_pattern_br_a:new c.aQ(m,r.u_pattern_br_a),u_pattern_tl_b:new c.aQ(m,r.u_pattern_tl_b),u_pattern_br_b:new c.aQ(m,r.u_pattern_br_b),u_texsize:new c.aQ(m,r.u_texsize),u_mix:new c.aM(m,r.u_mix),u_pattern_size_a:new c.aQ(m,r.u_pattern_size_a),u_pattern_size_b:new c.aQ(m,r.u_pattern_size_b),u_scale_a:new c.aM(m,r.u_scale_a),u_scale_b:new c.aM(m,r.u_scale_b),u_pixel_coord_upper:new c.aQ(m,r.u_pixel_coord_upper),u_pixel_coord_lower:new c.aQ(m,r.u_pixel_coord_lower),u_tile_units_to_pixels:new c.aM(m,r.u_tile_units_to_pixels)}),terrain:(m,r)=>({u_matrix:new c.aN(m,r.u_matrix),u_texture:new c.aL(m,r.u_texture),u_ele_delta:new c.aM(m,r.u_ele_delta)}),terrainDepth:(m,r)=>({u_matrix:new c.aN(m,r.u_matrix),u_ele_delta:new c.aM(m,r.u_ele_delta)}),terrainCoords:(m,r)=>({u_matrix:new c.aN(m,r.u_matrix),u_texture:new c.aL(m,r.u_texture),u_terrain_coords_id:new c.aM(m,r.u_terrain_coords_id),u_ele_delta:new c.aM(m,r.u_ele_delta)})};class Yl{constructor(r,o,h){this.context=r;const f=r.gl;this.buffer=f.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const o=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const nl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Kl{constructor(r,o,h,f){this.length=o.length,this.attributes=h,this.itemSize=o.bytesPerElement,this.dynamicDraw=f,this.context=r;const y=r.gl;this.buffer=y.createBuffer(),r.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){if(r.length!==this.length)throw new Error(`Length of new data is ${r.length}, which doesn't match current length of ${this.length}`);const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,o){for(let h=0;h<this.attributes.length;h++){const f=o.attributes[this.attributes[h].name];f!==void 0&&r.enableVertexAttribArray(f)}}setVertexAttribPointers(r,o,h){for(let f=0;f<this.attributes.length;f++){const y=this.attributes[f],w=o.attributes[y.name];w!==void 0&&r.vertexAttribPointer(w,y.components,r[nl[y.type]],!1,this.itemSize,y.offset+this.itemSize*(h||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const So=new WeakMap;function ba(m){var r;if(So.has(m))return So.get(m);{const o=(r=m.getParameter(m.VERSION))===null||r===void 0?void 0:r.startsWith("WebGL 2.0");return So.set(m,o),o}}class Tr{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Xl extends Tr{getDefault(){return c.aT.transparent}set(r){const o=this.current;(r.r!==o.r||r.g!==o.g||r.b!==o.b||r.a!==o.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Wn extends Tr{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class Hn extends Tr{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class vu extends Tr{getDefault(){return[!0,!0,!0,!0]}set(r){const o=this.current;(r[0]!==o[0]||r[1]!==o[1]||r[2]!==o[2]||r[3]!==o[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Jl extends Tr{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class Ql extends Tr{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class bu extends Tr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const o=this.current;(r.func!==o.func||r.ref!==o.ref||r.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class xu extends Tr{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const o=this.current;(r[0]!==o[0]||r[1]!==o[1]||r[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class ec extends Tr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const o=this.gl;r?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=r,this.dirty=!1}}class wu extends Tr{getDefault(){return[0,1]}set(r){const o=this.current;(r[0]!==o[0]||r[1]!==o[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class Su extends Tr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const o=this.gl;r?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=r,this.dirty=!1}}class tc extends Tr{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class gd extends Tr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const o=this.gl;r?o.enable(o.BLEND):o.disable(o.BLEND),this.current=r,this.dirty=!1}}class yd extends Tr{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const o=this.current;(r[0]!==o[0]||r[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class Io extends Tr{getDefault(){return c.aT.transparent}set(r){const o=this.current;(r.r!==o.r||r.g!==o.g||r.b!==o.b||r.a!==o.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class am extends Tr{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class om extends Tr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const o=this.gl;r?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=r,this.dirty=!1}}class lm extends Tr{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class cm extends Tr{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class um extends Tr{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class hm extends Tr{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Iu extends Tr{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const o=this.current;(r[0]!==o[0]||r[1]!==o[1]||r[2]!==o[2]||r[3]!==o[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class rc extends Tr{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class Tu extends Tr{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class ku extends Tr{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class To extends Tr{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class _d extends Tr{getDefault(){return null}set(r){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class vd extends Tr{getDefault(){return null}set(r){var o;if(r===this.current&&!this.dirty)return;const h=this.gl;ba(h)?h.bindVertexArray(r):(o=h.getExtension("OES_vertex_array_object"))===null||o===void 0||o.bindVertexArrayOES(r),this.current=r,this.dirty=!1}}class Au extends Tr{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class Za extends Tr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class bd extends Tr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class xa extends Tr{constructor(r,o){super(r),this.context=r,this.parent=o}getDefault(){return null}}class ko extends xa{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class xd extends xa{set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Eu extends xa{set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Br{constructor(r,o,h,f,y){this.context=r,this.width=o,this.height=h;const w=r.gl,S=this.framebuffer=w.createFramebuffer();if(this.colorAttachment=new ko(r,S),f)this.depthAttachment=y?new Eu(r,S):new xd(r,S);else if(y)throw new Error("Stencil cannot be setted without depth");if(w.checkFramebufferStatus(w.FRAMEBUFFER)!==w.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const r=this.context.gl,o=this.colorAttachment.get();if(o&&r.deleteTexture(o),this.depthAttachment){const h=this.depthAttachment.get();h&&r.deleteRenderbuffer(h)}r.deleteFramebuffer(this.framebuffer)}}class vi{constructor(r,o,h){this.blendFunction=r,this.blendColor=o,this.mask=h}}vi.Replace=[1,0],vi.disabled=new vi(vi.Replace,c.aT.transparent,[!1,!1,!1,!1]),vi.unblended=new vi(vi.Replace,c.aT.transparent,[!0,!0,!0,!0]),vi.alphaBlended=new vi([1,771],c.aT.transparent,[!0,!0,!0,!0]);class dm{constructor(r){var o,h;if(this.gl=r,this.clearColor=new Xl(this),this.clearDepth=new Wn(this),this.clearStencil=new Hn(this),this.colorMask=new vu(this),this.depthMask=new Jl(this),this.stencilMask=new Ql(this),this.stencilFunc=new bu(this),this.stencilOp=new xu(this),this.stencilTest=new ec(this),this.depthRange=new wu(this),this.depthTest=new Su(this),this.depthFunc=new tc(this),this.blend=new gd(this),this.blendFunc=new yd(this),this.blendColor=new Io(this),this.blendEquation=new am(this),this.cullFace=new om(this),this.cullFaceSide=new lm(this),this.frontFace=new cm(this),this.program=new um(this),this.activeTexture=new hm(this),this.viewport=new Iu(this),this.bindFramebuffer=new rc(this),this.bindRenderbuffer=new Tu(this),this.bindTexture=new ku(this),this.bindVertexBuffer=new To(this),this.bindElementBuffer=new _d(this),this.bindVertexArray=new vd(this),this.pixelStoreUnpack=new Au(this),this.pixelStoreUnpackPremultiplyAlpha=new Za(this),this.pixelStoreUnpackFlipY=new bd(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),ba(r)){this.HALF_FLOAT=r.HALF_FLOAT;const f=r.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(o=r.RGBA16F)!==null&&o!==void 0?o:f==null?void 0:f.RGBA16F_EXT,this.RGB16F=(h=r.RGB16F)!==null&&h!==void 0?h:f==null?void 0:f.RGB16F_EXT,r.getExtension("EXT_color_buffer_float")}else{r.getExtension("EXT_color_buffer_half_float"),r.getExtension("OES_texture_half_float_linear");const f=r.getExtension("OES_texture_half_float");this.HALF_FLOAT=f==null?void 0:f.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,o){return new Yl(this,r,o)}createVertexBuffer(r,o,h){return new Kl(this,r,o,h)}createRenderbuffer(r,o,h){const f=this.gl,y=f.createRenderbuffer();return this.bindRenderbuffer.set(y),f.renderbufferStorage(f.RENDERBUFFER,r,o,h),this.bindRenderbuffer.set(null),y}createFramebuffer(r,o,h,f){return new Br(this,r,o,h,f)}clear({color:r,depth:o,stencil:h}){const f=this.gl;let y=0;r&&(y|=f.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(y|=f.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),h!==void 0&&(y|=f.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),f.clear(y)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){c.aG(r.blendFunction,vi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}createVertexArray(){var r;return ba(this.gl)?this.gl.createVertexArray():(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.createVertexArrayOES()}deleteVertexArray(r){var o;return ba(this.gl)?this.gl.deleteVertexArray(r):(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.deleteVertexArrayOES(r)}unbindVAO(){this.bindVertexArray.set(null)}}class kr{constructor(r,o,h){this.func=r,this.mask=o,this.range=h}}kr.ReadOnly=!1,kr.ReadWrite=!0,kr.disabled=new kr(519,kr.ReadOnly,[0,1]);const Wa=7680;class bi{constructor(r,o,h,f,y,w){this.test=r,this.ref=o,this.mask=h,this.fail=f,this.depthFail=y,this.pass=w}}bi.disabled=new bi({func:519,mask:0},0,0,Wa,Wa,Wa);class fi{constructor(r,o,h){this.enable=r,this.mode=o,this.frontFace=h}}let sl;function wd(m,r,o,h,f,y,w){const S=m.context,k=S.gl,C=m.useProgram("collisionBox"),D=[];let P=0,N=0;for(let re=0;re<h.length;re++){const me=h[re],Te=r.getTile(me),ke=Te.getBucket(o);if(!ke)continue;let Re=me.posMatrix;f[0]===0&&f[1]===0||(Re=m.translatePosMatrix(me.posMatrix,Te,f,y));const He=w?ke.textCollisionBox:ke.iconCollisionBox,Ue=ke.collisionCircleArray;if(Ue.length>0){const tt=c.Z(),It=Re;c.aU(tt,ke.placementInvProjMatrix,m.transform.glCoordMatrix),c.aU(tt,tt,ke.placementViewportMatrix),D.push({circleArray:Ue,circleOffset:N,transform:It,invTransform:tt,coord:me}),P+=Ue.length/4,N=P}He&&C.draw(S,k.LINES,kr.disabled,bi.disabled,m.colorModeForRenderPass(),fi.disabled,pu(Re,m.transform,Te),m.style.map.terrain&&m.style.map.terrain.getTerrainData(me),o.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,null,m.transform.zoom,null,null,He.collisionVertexBuffer)}if(!w||!D.length)return;const H=m.useProgram("collisionCircle"),W=new c.aV;W.resize(4*P),W._trim();let X=0;for(const re of D)for(let me=0;me<re.circleArray.length/4;me++){const Te=4*me,ke=re.circleArray[Te+0],Re=re.circleArray[Te+1],He=re.circleArray[Te+2],Ue=re.circleArray[Te+3];W.emplace(X++,ke,Re,He,Ue,0),W.emplace(X++,ke,Re,He,Ue,1),W.emplace(X++,ke,Re,He,Ue,2),W.emplace(X++,ke,Re,He,Ue,3)}(!sl||sl.length<2*P)&&(sl=function(re){const me=2*re,Te=new c.aX;Te.resize(me),Te._trim();for(let ke=0;ke<me;ke++){const Re=6*ke;Te.uint16[Re+0]=4*ke+0,Te.uint16[Re+1]=4*ke+1,Te.uint16[Re+2]=4*ke+2,Te.uint16[Re+3]=4*ke+2,Te.uint16[Re+4]=4*ke+3,Te.uint16[Re+5]=4*ke+0}return Te}(P));const G=S.createIndexBuffer(sl,!0),pe=S.createVertexBuffer(W,c.aW.members,!0);for(const re of D){const me={u_matrix:re.transform,u_inv_matrix:re.invTransform,u_camera_to_center_distance:(we=m.transform).cameraToCenterDistance,u_viewport_size:[we.width,we.height]};H.draw(S,k.TRIANGLES,kr.disabled,bi.disabled,m.colorModeForRenderPass(),fi.disabled,me,m.style.map.terrain&&m.style.map.terrain.getTerrainData(re.coord),o.id,pe,G,c.S.simpleSegment(0,2*re.circleOffset,re.circleArray.length,re.circleArray.length/2),null,m.transform.zoom,null,null,null)}var we;pe.destroy(),G.destroy()}fi.disabled=new fi(!1,1029,2305),fi.backCCW=new fi(!0,1029,2305);const Cu=c.ao(new Float32Array(16));function ic(m,r,o,h,f,y){const{horizontalAlign:w,verticalAlign:S}=c.au(m);return new c.P((-(w-.5)*r/f+h[0])*y,(-(S-.5)*o/f+h[1])*y)}function nc(m,r,o,h,f,y,w,S,k,C,D){const P=m.text.placedSymbolArray,N=m.text.dynamicLayoutVertexArray,H=m.icon.dynamicLayoutVertexArray,W={};N.clear();for(let X=0;X<P.length;X++){const G=P.get(X),pe=G.hidden||!G.crossTileID||m.allowVerticalPlacement&&!G.placedOrientation?null:h[G.crossTileID];if(pe){const we=new c.P(G.anchorX,G.anchorY),re=Xr(we,o?w:y,D),me=zn(f.cameraToCenterDistance,re.signedDistanceFromCamera);let Te=c.aj(m.textSizeData,k,G)*me/c.ap;o&&(Te*=m.tilePixelRatio/S);const{width:ke,height:Re,anchor:He,textOffset:Ue,textBoxScale:tt}=pe,It=ic(He,ke,Re,Ue,tt,Te),_r=o?Xr(we.add(It),y,D).point:re.point.add(r?It.rotate(-f.angle):It),st=m.allowVerticalPlacement&&G.placedOrientation===c.ai.vertical?Math.PI/2:0;for(let Ft=0;Ft<G.numGlyphs;Ft++)c.ak(N,_r,st);C&&G.associatedIconIndex>=0&&(W[G.associatedIconIndex]={shiftedAnchor:_r,angle:st})}else j(G.numGlyphs,N)}if(C){H.clear();const X=m.icon.placedSymbolArray;for(let G=0;G<X.length;G++){const pe=X.get(G);if(pe.hidden)j(pe.numGlyphs,H);else{const we=W[G];if(we)for(let re=0;re<pe.numGlyphs;re++)c.ak(H,we.shiftedAnchor,we.angle);else j(pe.numGlyphs,H)}}m.icon.dynamicLayoutVertexBuffer.updateData(H)}m.text.dynamicLayoutVertexBuffer.updateData(N)}function Mu(m,r,o){return o.iconsInText&&r?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function sc(m,r,o,h,f,y,w,S,k,C,D,P){const N=m.context,H=N.gl,W=m.transform,X=S==="map",G=k==="map",pe=S!=="viewport"&&o.layout.get("symbol-placement")!=="point",we=X&&!G&&!pe,re=!o.layout.get("symbol-sort-key").isConstant();let me=!1;const Te=m.depthModeForSublayer(0,kr.ReadOnly),ke=o._unevaluatedLayout.hasValue("text-variable-anchor")||o._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Re=[];for(const He of h){const Ue=r.getTile(He),tt=Ue.getBucket(o);if(!tt)continue;const It=f?tt.text:tt.icon;if(!It||!It.segments.get().length||!It.hasVisibleVertices)continue;const _r=It.programConfigurations.get(o.id),st=f||tt.sdfIcons,Ft=f?tt.textSizeData:tt.iconSizeData,kt=G||W.pitch!==0,qr=m.useProgram(Mu(st,f,tt),_r),gr=c.ah(Ft,W.zoom),nr=m.style.map.terrain&&m.style.map.terrain.getTerrainData(He);let vr,Pi,ri,dn,Xi=[0,0],Fi=null;if(f)Pi=Ue.glyphAtlasTexture,ri=H.LINEAR,vr=Ue.glyphAtlasTexture.size,tt.iconsInText&&(Xi=Ue.imageAtlasTexture.size,Fi=Ue.imageAtlasTexture,dn=kt||m.options.rotating||m.options.zooming||Ft.kind==="composite"||Ft.kind==="camera"?H.LINEAR:H.NEAREST);else{const Li=o.layout.get("icon-size").constantOr(0)!==1||tt.iconsNeedLinear;Pi=Ue.imageAtlasTexture,ri=st||m.options.rotating||m.options.zooming||Li||kt?H.LINEAR:H.NEAREST,vr=Ue.imageAtlasTexture.size}const Xn=he(Ue,1,m.transform.zoom),ci=Ke(He.posMatrix,G,X,m.transform,Xn),Rs=cn(He.posMatrix,G,X,m.transform,Xn),Fs=ke&&tt.hasTextData(),Ia=o.layout.get("icon-text-fit")!=="none"&&Fs&&tt.hasIconData();if(pe){const Li=m.style.map.terrain?(Fn,zi)=>m.style.map.terrain.getElevation(He,Fn,zi):null,Ji=o.layout.get("text-rotation-alignment")==="map";et(tt,He.posMatrix,m,f,ci,Rs,G,C,Ji,Li)}const Ja=m.translatePosMatrix(He.posMatrix,Ue,y,w),Lo=pe||f&&ke||Ia?Cu:ci,wn=m.translatePosMatrix(Rs,Ue,y,w,!0),fn=st&&o.paint.get(f?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Cn;Cn=st?tt.iconsInText?Ga(Ft.kind,gr,we,G,m,Ja,Lo,wn,vr,Xi):_u(Ft.kind,gr,we,G,m,Ja,Lo,wn,f,vr,!0):yu(Ft.kind,gr,we,G,m,Ja,Lo,wn,f,vr);const Qa={program:qr,buffers:It,uniformValues:Cn,atlasTexture:Pi,atlasTextureIcon:Fi,atlasInterpolation:ri,atlasInterpolationIcon:dn,isSDF:st,hasHalo:fn};if(re&&tt.canOverlap){me=!0;const Li=It.segments.get();for(const Ji of Li)Re.push({segments:new c.S([Ji]),sortKey:Ji.sortKey,state:Qa,terrainData:nr})}else Re.push({segments:It.segments,sortKey:0,state:Qa,terrainData:nr})}me&&Re.sort((He,Ue)=>He.sortKey-Ue.sortKey);for(const He of Re){const Ue=He.state;if(N.activeTexture.set(H.TEXTURE0),Ue.atlasTexture.bind(Ue.atlasInterpolation,H.CLAMP_TO_EDGE),Ue.atlasTextureIcon&&(N.activeTexture.set(H.TEXTURE1),Ue.atlasTextureIcon&&Ue.atlasTextureIcon.bind(Ue.atlasInterpolationIcon,H.CLAMP_TO_EDGE)),Ue.isSDF){const tt=Ue.uniformValues;Ue.hasHalo&&(tt.u_is_halo=1,Du(Ue.buffers,He.segments,o,m,Ue.program,Te,D,P,tt,He.terrainData)),tt.u_is_halo=0}Du(Ue.buffers,He.segments,o,m,Ue.program,Te,D,P,Ue.uniformValues,He.terrainData)}}function Du(m,r,o,h,f,y,w,S,k,C){const D=h.context;f.draw(D,D.gl.TRIANGLES,y,w,S,fi.disabled,k,C,o.id,m.layoutVertexBuffer,m.indexBuffer,r,o.paint,h.transform.zoom,m.programConfigurations.get(o.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function al(m,r,o,h,f){if(!o||!h||!h.imageAtlas)return;const y=h.imageAtlas.patternPositions;let w=y[o.to.toString()],S=y[o.from.toString()];if(!w&&S&&(w=S),!S&&w&&(S=w),!w||!S){const k=f.getPaintProperty(r);w=y[k],S=y[k]}w&&S&&m.setConstantPatternPositions(w,S)}function ol(m,r,o,h,f,y,w){const S=m.context.gl,k="fill-pattern",C=o.paint.get(k),D=C&&C.constantOr(1),P=o.getCrossfadeParameters();let N,H,W,X,G;w?(H=D&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",N=S.LINES):(H=D?"fillPattern":"fill",N=S.TRIANGLES);const pe=C.constantOr(null);for(const we of h){const re=r.getTile(we);if(D&&!re.patternsLoaded())continue;const me=re.getBucket(o);if(!me)continue;const Te=me.programConfigurations.get(o.id),ke=m.useProgram(H,Te),Re=m.style.map.terrain&&m.style.map.terrain.getTerrainData(we);D&&(m.context.activeTexture.set(S.TEXTURE0),re.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),Te.updatePaintBuffers(P)),al(Te,k,pe,re,o);const He=Re?we:null,Ue=m.translatePosMatrix(He?He.posMatrix:we.posMatrix,re,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(w){X=me.indexBuffer2,G=me.segments2;const tt=[S.drawingBufferWidth,S.drawingBufferHeight];W=H==="fillOutlinePattern"&&D?Gl(Ue,m,P,re,tt):ql(Ue,tt)}else X=me.indexBuffer,G=me.segments,W=D?fu(Ue,m,P,re):cd(Ue);ke.draw(m.context,N,f,m.stencilModeForClipping(we),y,fi.disabled,W,Re,o.id,me.layoutVertexBuffer,X,G,o.paint,m.transform.zoom,Te)}}function ll(m,r,o,h,f,y,w){const S=m.context,k=S.gl,C="fill-extrusion-pattern",D=o.paint.get(C),P=D.constantOr(1),N=o.getCrossfadeParameters(),H=o.paint.get("fill-extrusion-opacity"),W=D.constantOr(null);for(const X of h){const G=r.getTile(X),pe=G.getBucket(o);if(!pe)continue;const we=m.style.map.terrain&&m.style.map.terrain.getTerrainData(X),re=pe.programConfigurations.get(o.id),me=m.useProgram(P?"fillExtrusionPattern":"fillExtrusion",re);P&&(m.context.activeTexture.set(k.TEXTURE0),G.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),re.updatePaintBuffers(N)),al(re,C,W,G,o);const Te=m.translatePosMatrix(X.posMatrix,G,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),ke=o.paint.get("fill-extrusion-vertical-gradient"),Re=P?_a(Te,m,ke,H,X,N,G):du(Te,m,ke,H);me.draw(S,S.gl.TRIANGLES,f,y,w,fi.backCCW,Re,we,o.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,o.paint,m.transform.zoom,re,m.style.map.terrain&&pe.centroidVertexBuffer)}}function fm(m,r,o,h,f,y,w){const S=m.context,k=S.gl,C=o.fbo;if(!C)return;const D=m.useProgram("hillshade"),P=m.style.map.terrain&&m.style.map.terrain.getTerrainData(r);S.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,C.colorAttachment.get()),D.draw(S,k.TRIANGLES,f,y,w,fi.disabled,((N,H,W,X)=>{const G=W.paint.get("hillshade-shadow-color"),pe=W.paint.get("hillshade-highlight-color"),we=W.paint.get("hillshade-accent-color");let re=W.paint.get("hillshade-illumination-direction")*(Math.PI/180);W.paint.get("hillshade-illumination-anchor")==="viewport"&&(re-=N.transform.angle);const me=!N.options.moving;return{u_matrix:X?X.posMatrix:N.transform.calculatePosMatrix(H.tileID.toUnwrapped(),me),u_image:0,u_latrange:mu(0,H.tileID),u_light:[W.paint.get("hillshade-exaggeration"),re],u_shadow:G,u_highlight:pe,u_accent:we}})(m,o,h,P?r:null),P,h.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}function Pu(m,r,o,h,f,y){const w=m.context,S=w.gl,k=r.dem;if(k&&k.data){const C=k.dim,D=k.stride,P=k.getPixels();if(w.activeTexture.set(S.TEXTURE1),w.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||m.getTileTexture(D),r.demTexture){const H=r.demTexture;H.update(P,{premultiply:!1}),H.bind(S.NEAREST,S.CLAMP_TO_EDGE)}else r.demTexture=new De(w,P,S.RGBA,{premultiply:!1}),r.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);w.activeTexture.set(S.TEXTURE0);let N=r.fbo;if(!N){const H=new De(w,{width:C,height:C,data:null},S.RGBA);H.bind(S.LINEAR,S.CLAMP_TO_EDGE),N=r.fbo=w.createFramebuffer(C,C,!0,!1),N.colorAttachment.set(H.texture)}w.bindFramebuffer.set(N.framebuffer),w.viewport.set([0,0,C,C]),m.useProgram("hillshadePrepare").draw(w,S.TRIANGLES,h,f,y,fi.disabled,((H,W)=>{const X=W.stride,G=c.Z();return c.aS(G,0,c.N,-c.N,0,0,1),c.$(G,G,[0,-c.N,0]),{u_matrix:G,u_image:1,u_dimension:[X,X],u_zoom:H.overscaledZ,u_unpack:W.getUnpackVector()}})(r.tileID,k),null,o.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments),r.needsHillshadePrepare=!1}}function pm(m,r,o,h,f,y){const w=h.paint.get("raster-fade-duration");if(!y&&w>0){const S=c.h.now(),k=(S-m.timeAdded)/w,C=r?(S-r.timeAdded)/w:-1,D=o.getSource(),P=f.coveringZoomLevel({tileSize:D.tileSize,roundZoom:D.roundZoom}),N=!r||Math.abs(r.tileID.overscaledZ-P)>Math.abs(m.tileID.overscaledZ-P),H=N&&m.refreshedUponExpiration?1:c.ad(N?k:1-C,0,1);return m.refreshedUponExpiration&&k>=1&&(m.refreshedUponExpiration=!1),r?{opacity:1,mix:1-H}:{opacity:H,mix:0}}return{opacity:1,mix:0}}const Sd=new c.aT(1,0,0,1),ac=new c.aT(0,1,0,1),Lu=new c.aT(0,0,1,1),Id=new c.aT(1,0,1,1),Td=new c.aT(0,1,1,1);function cl(m,r,o,h){lc(m,0,r+o/2,m.transform.width,o,h)}function oc(m,r,o,h){lc(m,r-o/2,0,o,m.transform.height,h)}function lc(m,r,o,h,f,y){const w=m.context,S=w.gl;S.enable(S.SCISSOR_TEST),S.scissor(r*m.pixelRatio,o*m.pixelRatio,h*m.pixelRatio,f*m.pixelRatio),w.clear({color:y}),S.disable(S.SCISSOR_TEST)}function kd(m,r,o){const h=m.context,f=h.gl,y=o.posMatrix,w=m.useProgram("debug"),S=kr.disabled,k=bi.disabled,C=m.colorModeForRenderPass(),D="$debug",P=m.style.map.terrain&&m.style.map.terrain.getTerrainData(o);h.activeTexture.set(f.TEXTURE0);const N=r.getTileByID(o.key).latestRawTileData,H=Math.floor((N&&N.byteLength||0)/1024),W=r.getTile(o).tileSize,X=512/Math.min(W,512)*(o.overscaledZ/m.transform.zoom)*.5;let G=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(G+=` => ${o.overscaledZ}`),function(pe,we){pe.initDebugOverlayCanvas();const re=pe.debugOverlayCanvas,me=pe.context.gl,Te=pe.debugOverlayCanvas.getContext("2d");Te.clearRect(0,0,re.width,re.height),Te.shadowColor="white",Te.shadowBlur=2,Te.lineWidth=1.5,Te.strokeStyle="white",Te.textBaseline="top",Te.font="bold 36px Open Sans, sans-serif",Te.fillText(we,5,5),Te.strokeText(we,5,5),pe.debugOverlayTexture.update(re),pe.debugOverlayTexture.bind(me.LINEAR,me.CLAMP_TO_EDGE)}(m,`${G} ${H}kB`),w.draw(h,f.TRIANGLES,S,k,vi.alphaBlended,fi.disabled,il(y,c.aT.transparent,X),null,D,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),w.draw(h,f.LINE_STRIP,S,k,C,fi.disabled,il(y,c.aT.red),P,D,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function Ti(m,r,o){const h=m.context,f=h.gl,y=m.colorModeForRenderPass(),w=new kr(f.LEQUAL,kr.ReadWrite,m.depthRangeFor3D),S=m.useProgram("terrain"),k=r.getTerrainMesh();h.bindFramebuffer.set(null),h.viewport.set([0,0,m.width,m.height]);for(const C of o){const D=m.renderToTexture.getTexture(C),P=r.getTerrainData(C.tileID);h.activeTexture.set(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,D.texture);const N={u_matrix:m.transform.calculatePosMatrix(C.tileID.toUnwrapped()),u_texture:0,u_ele_delta:r.getMeshFrameDelta(m.transform.zoom)};S.draw(h,f.TRIANGLES,w,bi.disabled,y,fi.backCCW,N,P,"terrain",k.vertexBuffer,k.indexBuffer,k.segments)}}class Ha{constructor(r,o){this.context=new dm(r),this.transform=o,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.Z(),renderTime:0},this.setup(),this.numSublayers=di.maxUnderzooming+di.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new $l}resize(r,o,h){if(this.width=Math.floor(r*h),this.height=Math.floor(o*h),this.pixelRatio=h,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style._order)this.style._layers[f].resize()}setup(){const r=this.context,o=new c.a_;o.emplaceBack(0,0),o.emplaceBack(c.N,0),o.emplaceBack(0,c.N),o.emplaceBack(c.N,c.N),this.tileExtentBuffer=r.createVertexBuffer(o,Vl.members),this.tileExtentSegments=c.S.simpleSegment(0,0,4,2);const h=new c.a_;h.emplaceBack(0,0),h.emplaceBack(c.N,0),h.emplaceBack(0,c.N),h.emplaceBack(c.N,c.N),this.debugBuffer=r.createVertexBuffer(h,Vl.members),this.debugSegments=c.S.simpleSegment(0,0,4,5);const f=new c.V;f.emplaceBack(0,0,0,0),f.emplaceBack(c.N,0,c.N,0),f.emplaceBack(0,c.N,0,c.N),f.emplaceBack(c.N,c.N,c.N,c.N),this.rasterBoundsBuffer=r.createVertexBuffer(f,Pt.members),this.rasterBoundsSegments=c.S.simpleSegment(0,0,4,2);const y=new c.a_;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(y,Vl.members),this.viewportSegments=c.S.simpleSegment(0,0,4,2);const w=new c.a$;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=r.createIndexBuffer(w);const S=new c.b0;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(S);const k=this.context.gl;this.stencilClearMode=new bi({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO)}clearStencil(){const r=this.context,o=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const h=c.Z();c.aS(h,0,this.width,this.height,0,0,1),c.a0(h,h,[o.drawingBufferWidth,o.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(r,o.TRIANGLES,kr.disabled,this.stencilClearMode,vi.disabled,fi.disabled,ud(h),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(r,o){if(this.currentStencilSource===r.source||!r.isTileClipped()||!o||!o.length)return;this.currentStencilSource=r.source;const h=this.context,f=h.gl;this.nextStencilID+o.length>256&&this.clearStencil(),h.setColorMode(vi.disabled),h.setDepthMode(kr.disabled);const y=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const w of o){const S=this._tileClippingMaskIDs[w.key]=this.nextStencilID++,k=this.style.map.terrain&&this.style.map.terrain.getTerrainData(w);y.draw(h,f.TRIANGLES,kr.disabled,new bi({func:f.ALWAYS,mask:0},S,255,f.KEEP,f.KEEP,f.REPLACE),vi.disabled,fi.disabled,ud(w.posMatrix),k,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,o=this.context.gl;return new bi({func:o.NOTEQUAL,mask:255},r,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(r){const o=this.context.gl;return new bi({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(r){const o=this.context.gl,h=r.sort((w,S)=>S.overscaledZ-w.overscaledZ),f=h[h.length-1].overscaledZ,y=h[0].overscaledZ-f+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const w={};for(let S=0;S<y;S++)w[S+f]=new bi({func:o.GEQUAL,mask:255},S+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=y,[w,h]}return[{[f]:bi.disabled},h]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new vi([r.CONSTANT_COLOR,r.ONE],new c.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?vi.unblended:vi.alphaBlended}depthModeForSublayer(r,o,h){if(!this.opaquePassEnabledForLayer())return kr.disabled;const f=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new kr(h||this.context.gl.LEQUAL,o,[f,f])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,o){this.style=r,this.options=o,this.lineAtlas=r.lineAtlas,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(c.h.now()),this.imageManager.beginFrame();const h=this.style._order,f=this.style.sourceCaches,y={},w={},S={};for(const k in f){const C=f[k];C.used&&C.prepare(this.context),y[k]=C.getVisibleCoordinates(),w[k]=y[k].slice().reverse(),S[k]=C.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let k=0;k<h.length;k++)if(this.style._layers[h[k]].is3D()){this.opaquePassCutoff=k;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const k=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!c.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||k.length)&&(c.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(C,D){const P=C.context,N=P.gl,H=vi.unblended,W=new kr(N.LEQUAL,kr.ReadWrite,[0,1]),X=D.getTerrainMesh(),G=D.sourceCache.getRenderableTiles(),pe=C.useProgram("terrainDepth");P.bindFramebuffer.set(D.getFramebuffer("depth").framebuffer),P.viewport.set([0,0,C.width/devicePixelRatio,C.height/devicePixelRatio]),P.clear({color:c.aT.transparent,depth:1});for(const we of G){const re=D.getTerrainData(we.tileID),me={u_matrix:C.transform.calculatePosMatrix(we.tileID.toUnwrapped()),u_ele_delta:D.getMeshFrameDelta(C.transform.zoom)};pe.draw(P,N.TRIANGLES,W,bi.disabled,H,fi.backCCW,me,re,"terrain",X.vertexBuffer,X.indexBuffer,X.segments)}P.bindFramebuffer.set(null),P.viewport.set([0,0,C.width,C.height])}(this,this.style.map.terrain),function(C,D){const P=C.context,N=P.gl,H=vi.unblended,W=new kr(N.LEQUAL,kr.ReadWrite,[0,1]),X=D.getTerrainMesh(),G=D.getCoordsTexture(),pe=D.sourceCache.getRenderableTiles(),we=C.useProgram("terrainCoords");P.bindFramebuffer.set(D.getFramebuffer("coords").framebuffer),P.viewport.set([0,0,C.width/devicePixelRatio,C.height/devicePixelRatio]),P.clear({color:c.aT.transparent,depth:1}),D.coordsIndex=[];for(const re of pe){const me=D.getTerrainData(re.tileID);P.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,G.texture);const Te={u_matrix:C.transform.calculatePosMatrix(re.tileID.toUnwrapped()),u_terrain_coords_id:(255-D.coordsIndex.length)/255,u_texture:0,u_ele_delta:D.getMeshFrameDelta(C.transform.zoom)};we.draw(P,N.TRIANGLES,W,bi.disabled,H,fi.backCCW,Te,me,"terrain",X.vertexBuffer,X.indexBuffer,X.segments),D.coordsIndex.push(re.tileID.key)}P.bindFramebuffer.set(null),P.viewport.set([0,0,C.width,C.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const k of h){const C=this.style._layers[k];if(!C.hasOffscreenPass()||C.isHidden(this.transform.zoom))continue;const D=w[C.source];(C.type==="custom"||D.length)&&this.renderLayer(this,f[C.source],C,D)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:o.showOverdrawInspector?c.aT.black:c.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.depthRangeFor3D=[0,1-(r._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){const k=this.style._layers[h[this.currentLayer]],C=f[k.source],D=y[k.source];this._renderTileClippingMasks(k,D),this.renderLayer(this,C,k,D)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){const k=this.style._layers[h[this.currentLayer]],C=f[k.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(k))continue;const D=(k.type==="symbol"?S:w)[k.source];this._renderTileClippingMasks(k,y[k.source]),this.renderLayer(this,C,k,D)}if(this.options.showTileBoundaries){const k=function(C,D){let P=null;const N=Object.values(C._layers).flatMap(G=>G.source&&!G.isHidden(D)?[C.sourceCaches[G.source]]:[]),H=N.filter(G=>G.getSource().type==="vector"),W=N.filter(G=>G.getSource().type!=="vector"),X=G=>{(!P||P.getSource().maxzoom<G.getSource().maxzoom)&&(P=G)};return H.forEach(G=>X(G)),P||W.forEach(G=>X(G)),P}(this.style,this.transform.zoom);k&&function(C,D,P){for(let N=0;N<P.length;N++)kd(C,D,P[N])}(this,k,k.getVisibleCoordinates())}this.options.showPadding&&function(k){const C=k.transform.padding;cl(k,k.transform.height-(C.top||0),3,Sd),cl(k,C.bottom||0,3,ac),oc(k,C.left||0,3,Lu),oc(k,k.transform.width-(C.right||0),3,Id);const D=k.transform.centerPoint;(function(P,N,H,W){lc(P,N-1,H-10,2,20,W),lc(P,N-10,H-1,20,2,W)})(k,D.x,k.transform.height-D.y,Td)}(this),this.context.setDefault()}renderLayer(r,o,h,f){if(!h.isHidden(this.transform.zoom)&&(h.type==="background"||h.type==="custom"||(f||[]).length))switch(this.id=h.id,h.type){case"symbol":(function(y,w,S,k,C){if(y.renderPass!=="translucent")return;const D=bi.disabled,P=y.colorModeForRenderPass();(S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(N,H,W,X,G,pe,we){const re=H.transform,me=G==="map",Te=pe==="map";for(const ke of N){const Re=X.getTile(ke),He=Re.getBucket(W);if(!He||!He.text||!He.text.segments.get().length)continue;const Ue=c.ah(He.textSizeData,re.zoom),tt=he(Re,1,H.transform.zoom),It=Ke(ke.posMatrix,Te,me,H.transform,tt),_r=W.layout.get("icon-text-fit")!=="none"&&He.hasIconData();if(Ue){const st=Math.pow(2,re.zoom-Re.tileID.overscaledZ);nc(He,me,Te,we,re,It,ke.posMatrix,st,Ue,_r,H.style.map.terrain?(Ft,kt)=>H.style.map.terrain.getElevation(ke,Ft,kt):null)}}}(k,y,S,w,S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),C),S.paint.get("icon-opacity").constantOr(1)!==0&&sc(y,w,S,k,!1,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),S.layout.get("icon-rotation-alignment"),S.layout.get("icon-pitch-alignment"),S.layout.get("icon-keep-upright"),D,P),S.paint.get("text-opacity").constantOr(1)!==0&&sc(y,w,S,k,!0,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.layout.get("text-keep-upright"),D,P),w.map.showCollisionBoxes&&(wd(y,w,S,k,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),!0),wd(y,w,S,k,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),!1))})(r,o,h,f,this.style.placement.variableOffsets);break;case"circle":(function(y,w,S,k){if(y.renderPass!=="translucent")return;const C=S.paint.get("circle-opacity"),D=S.paint.get("circle-stroke-width"),P=S.paint.get("circle-stroke-opacity"),N=!S.layout.get("circle-sort-key").isConstant();if(C.constantOr(1)===0&&(D.constantOr(1)===0||P.constantOr(1)===0))return;const H=y.context,W=H.gl,X=y.depthModeForSublayer(0,kr.ReadOnly),G=bi.disabled,pe=y.colorModeForRenderPass(),we=[];for(let re=0;re<k.length;re++){const me=k[re],Te=w.getTile(me),ke=Te.getBucket(S);if(!ke)continue;const Re=ke.programConfigurations.get(S.id),He=y.useProgram("circle",Re),Ue=ke.layoutVertexBuffer,tt=ke.indexBuffer,It=y.style.map.terrain&&y.style.map.terrain.getTerrainData(me),_r={programConfiguration:Re,program:He,layoutVertexBuffer:Ue,indexBuffer:tt,uniformValues:va(y,me,Te,S),terrainData:It};if(N){const st=ke.segments.get();for(const Ft of st)we.push({segments:new c.S([Ft]),sortKey:Ft.sortKey,state:_r})}else we.push({segments:ke.segments,sortKey:0,state:_r})}N&&we.sort((re,me)=>re.sortKey-me.sortKey);for(const re of we){const{programConfiguration:me,program:Te,layoutVertexBuffer:ke,indexBuffer:Re,uniformValues:He,terrainData:Ue}=re.state;Te.draw(H,W.TRIANGLES,X,G,pe,fi.disabled,He,Ue,S.id,ke,Re,re.segments,S.paint,y.transform.zoom,me)}})(r,o,h,f);break;case"heatmap":(function(y,w,S,k){if(S.paint.get("heatmap-opacity")!==0)if(y.renderPass==="offscreen"){const C=y.context,D=C.gl,P=bi.disabled,N=new vi([D.ONE,D.ONE],c.aT.transparent,[!0,!0,!0,!0]);(function(H,W,X){const G=H.gl;H.activeTexture.set(G.TEXTURE1),H.viewport.set([0,0,W.width/4,W.height/4]);let pe=X.heatmapFbo;if(pe)G.bindTexture(G.TEXTURE_2D,pe.colorAttachment.get()),H.bindFramebuffer.set(pe.framebuffer);else{const we=G.createTexture();G.bindTexture(G.TEXTURE_2D,we),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MAG_FILTER,G.LINEAR),pe=X.heatmapFbo=H.createFramebuffer(W.width/4,W.height/4,!1,!1),function(re,me,Te,ke){var Re,He;const Ue=re.gl,tt=(Re=re.HALF_FLOAT)!==null&&Re!==void 0?Re:Ue.UNSIGNED_BYTE,It=(He=re.RGBA16F)!==null&&He!==void 0?He:Ue.RGBA;Ue.texImage2D(Ue.TEXTURE_2D,0,It,me.width/4,me.height/4,0,Ue.RGBA,tt,null),ke.colorAttachment.set(Te)}(H,W,we,pe)}})(C,y,S),C.clear({color:c.aT.transparent});for(let H=0;H<k.length;H++){const W=k[H];if(w.hasRenderableParent(W))continue;const X=w.getTile(W),G=X.getBucket(S);if(!G)continue;const pe=G.programConfigurations.get(S.id),we=y.useProgram("heatmap",pe),{zoom:re}=y.transform;we.draw(C,D.TRIANGLES,kr.disabled,P,N,fi.disabled,nm(W.posMatrix,X,re,S.paint.get("heatmap-intensity")),null,S.id,G.layoutVertexBuffer,G.indexBuffer,G.segments,S.paint,y.transform.zoom,pe)}C.viewport.set([0,0,y.width,y.height])}else y.renderPass==="translucent"&&(y.context.setColorMode(y.colorModeForRenderPass()),function(C,D){const P=C.context,N=P.gl,H=D.heatmapFbo;if(!H)return;P.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,H.colorAttachment.get()),P.activeTexture.set(N.TEXTURE1);let W=D.colorRampTexture;W||(W=D.colorRampTexture=new De(P,D.colorRamp,N.RGBA)),W.bind(N.LINEAR,N.CLAMP_TO_EDGE),C.useProgram("heatmapTexture").draw(P,N.TRIANGLES,kr.disabled,bi.disabled,C.colorModeForRenderPass(),fi.disabled,((X,G,pe,we)=>{const re=c.Z();c.aS(re,0,X.width,X.height,0,0,1);const me=X.context.gl;return{u_matrix:re,u_world:[me.drawingBufferWidth,me.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:G.paint.get("heatmap-opacity")}})(C,D),null,D.id,C.viewportBuffer,C.quadTriangleIndexBuffer,C.viewportSegments,D.paint,C.transform.zoom)}(y,S))})(r,o,h,f);break;case"line":(function(y,w,S,k){if(y.renderPass!=="translucent")return;const C=S.paint.get("line-opacity"),D=S.paint.get("line-width");if(C.constantOr(1)===0||D.constantOr(1)===0)return;const P=y.depthModeForSublayer(0,kr.ReadOnly),N=y.colorModeForRenderPass(),H=S.paint.get("line-dasharray"),W=S.paint.get("line-pattern"),X=W.constantOr(1),G=S.paint.get("line-gradient"),pe=S.getCrossfadeParameters(),we=X?"linePattern":H?"lineSDF":G?"lineGradient":"line",re=y.context,me=re.gl;let Te=!0;for(const ke of k){const Re=w.getTile(ke);if(X&&!Re.patternsLoaded())continue;const He=Re.getBucket(S);if(!He)continue;const Ue=He.programConfigurations.get(S.id),tt=y.context.program.get(),It=y.useProgram(we,Ue),_r=Te||It.program!==tt,st=y.style.map.terrain&&y.style.map.terrain.getTerrainData(ke),Ft=W.constantOr(null);if(Ft&&Re.imageAtlas){const gr=Re.imageAtlas,nr=gr.patternPositions[Ft.to.toString()],vr=gr.patternPositions[Ft.from.toString()];nr&&vr&&Ue.setConstantPatternPositions(nr,vr)}const kt=st?ke:null,qr=X?sm(y,Re,S,pe,kt):H?dd(y,Re,S,H,pe,kt):G?hd(y,Re,S,He.lineClipsArray.length,kt):gu(y,Re,S,kt);if(X)re.activeTexture.set(me.TEXTURE0),Re.imageAtlasTexture.bind(me.LINEAR,me.CLAMP_TO_EDGE),Ue.updatePaintBuffers(pe);else if(H&&(_r||y.lineAtlas.dirty))re.activeTexture.set(me.TEXTURE0),y.lineAtlas.bind(re);else if(G){const gr=He.gradients[S.id];let nr=gr.texture;if(S.gradientVersion!==gr.version){let vr=256;if(S.stepInterpolant){const Pi=w.getSource().maxzoom,ri=ke.canonical.z===Pi?Math.ceil(1<<y.transform.maxZoom-ke.canonical.z):1;vr=c.ad(c.aY(He.maxLineLength/c.N*1024*ri),256,re.maxTextureSize)}gr.gradient=c.aZ({expression:S.gradientExpression(),evaluationKey:"lineProgress",resolution:vr,image:gr.gradient||void 0,clips:He.lineClipsArray}),gr.texture?gr.texture.update(gr.gradient):gr.texture=new De(re,gr.gradient,me.RGBA),gr.version=S.gradientVersion,nr=gr.texture}re.activeTexture.set(me.TEXTURE0),nr.bind(S.stepInterpolant?me.NEAREST:me.LINEAR,me.CLAMP_TO_EDGE)}It.draw(re,me.TRIANGLES,P,y.stencilModeForClipping(ke),N,fi.disabled,qr,st,S.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,S.paint,y.transform.zoom,Ue,He.layoutVertexBuffer2),Te=!1}})(r,o,h,f);break;case"fill":(function(y,w,S,k){const C=S.paint.get("fill-color"),D=S.paint.get("fill-opacity");if(D.constantOr(1)===0)return;const P=y.colorModeForRenderPass(),N=S.paint.get("fill-pattern"),H=y.opaquePassEnabledForLayer()&&!N.constantOr(1)&&C.constantOr(c.aT.transparent).a===1&&D.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===H){const W=y.depthModeForSublayer(1,y.renderPass==="opaque"?kr.ReadWrite:kr.ReadOnly);ol(y,w,S,k,W,P,!1)}if(y.renderPass==="translucent"&&S.paint.get("fill-antialias")){const W=y.depthModeForSublayer(S.getPaintProperty("fill-outline-color")?2:0,kr.ReadOnly);ol(y,w,S,k,W,P,!0)}})(r,o,h,f);break;case"fill-extrusion":(function(y,w,S,k){const C=S.paint.get("fill-extrusion-opacity");if(C!==0&&y.renderPass==="translucent"){const D=new kr(y.context.gl.LEQUAL,kr.ReadWrite,y.depthRangeFor3D);if(C!==1||S.paint.get("fill-extrusion-pattern").constantOr(1))ll(y,w,S,k,D,bi.disabled,vi.disabled),ll(y,w,S,k,D,y.stencilModeFor3D(),y.colorModeForRenderPass());else{const P=y.colorModeForRenderPass();ll(y,w,S,k,D,bi.disabled,P)}}})(r,o,h,f);break;case"hillshade":(function(y,w,S,k){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const C=y.context,D=y.depthModeForSublayer(0,kr.ReadOnly),P=y.colorModeForRenderPass(),[N,H]=y.renderPass==="translucent"?y.stencilConfigForOverlap(k):[{},k];for(const W of H){const X=w.getTile(W);X.needsHillshadePrepare!==void 0&&X.needsHillshadePrepare&&y.renderPass==="offscreen"?Pu(y,X,S,D,bi.disabled,P):y.renderPass==="translucent"&&fm(y,W,X,S,D,N[W.overscaledZ],P)}C.viewport.set([0,0,y.width,y.height])})(r,o,h,f);break;case"raster":(function(y,w,S,k){if(y.renderPass!=="translucent"||S.paint.get("raster-opacity")===0||!k.length)return;const C=y.context,D=C.gl,P=w.getSource(),N=y.useProgram("raster"),H=y.colorModeForRenderPass(),[W,X]=P instanceof zt?[{},k]:y.stencilConfigForOverlap(k),G=X[X.length-1].overscaledZ,pe=!y.options.moving;for(const we of X){const re=y.depthModeForSublayer(we.overscaledZ-G,S.paint.get("raster-opacity")===1?kr.ReadWrite:kr.ReadOnly,D.LESS),me=w.getTile(we);me.registerFadeDuration(S.paint.get("raster-fade-duration"));const Te=w.findLoadedParent(we,0),ke=pm(me,Te,w,S,y.transform,y.style.map.terrain);let Re,He;const Ue=S.paint.get("raster-resampling")==="nearest"?D.NEAREST:D.LINEAR;C.activeTexture.set(D.TEXTURE0),me.texture.bind(Ue,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST),C.activeTexture.set(D.TEXTURE1),Te?(Te.texture.bind(Ue,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST),Re=Math.pow(2,Te.tileID.overscaledZ-me.tileID.overscaledZ),He=[me.tileID.canonical.x*Re%1,me.tileID.canonical.y*Re%1]):me.texture.bind(Ue,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST);const tt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(we),It=tt?we:null,_r=It?It.posMatrix:y.transform.calculatePosMatrix(we.toUnwrapped(),pe),st=pd(_r,He||[0,0],Re||1,ke,S);P instanceof zt?N.draw(C,D.TRIANGLES,re,bi.disabled,H,fi.disabled,st,tt,S.id,P.boundsBuffer,y.quadTriangleIndexBuffer,P.boundsSegments):N.draw(C,D.TRIANGLES,re,W[we.overscaledZ],H,fi.disabled,st,tt,S.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}})(r,o,h,f);break;case"background":(function(y,w,S,k){const C=S.paint.get("background-color"),D=S.paint.get("background-opacity");if(D===0)return;const P=y.context,N=P.gl,H=y.transform,W=H.tileSize,X=S.paint.get("background-pattern");if(y.isPatternMissing(X))return;const G=!X&&C.a===1&&D===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==G)return;const pe=bi.disabled,we=y.depthModeForSublayer(0,G==="opaque"?kr.ReadWrite:kr.ReadOnly),re=y.colorModeForRenderPass(),me=y.useProgram(X?"backgroundPattern":"background"),Te=k||H.coveringTiles({tileSize:W,terrain:y.style.map.terrain});X&&(P.activeTexture.set(N.TEXTURE0),y.imageManager.bind(y.context));const ke=S.getCrossfadeParameters();for(const Re of Te){const He=k?Re.posMatrix:y.transform.calculatePosMatrix(Re.toUnwrapped()),Ue=X?ds(He,D,y,X,{tileID:Re,tileSize:W},ke):Wl(He,D,C),tt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Re);me.draw(P,N.TRIANGLES,we,pe,re,fi.disabled,Ue,tt,S.id,y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}})(r,0,h,f);break;case"custom":(function(y,w,S){const k=y.context,C=S.implementation;if(y.renderPass==="offscreen"){const D=C.prerender;D&&(y.setCustomLayerDefaults(),k.setColorMode(y.colorModeForRenderPass()),D.call(C,k.gl,y.transform.customLayerMatrix()),k.setDirty(),y.setBaseState())}else if(y.renderPass==="translucent"){y.setCustomLayerDefaults(),k.setColorMode(y.colorModeForRenderPass()),k.setStencilMode(bi.disabled);const D=C.renderingMode==="3d"?new kr(y.context.gl.LEQUAL,kr.ReadWrite,y.depthRangeFor3D):y.depthModeForSublayer(0,kr.ReadOnly);k.setDepthMode(D),C.render(k.gl,y.transform.customLayerMatrix()),k.setDirty(),y.setBaseState(),k.bindFramebuffer.set(null)}})(r,0,h)}}translatePosMatrix(r,o,h,f,y){if(!h[0]&&!h[1])return r;const w=y?f==="map"?this.transform.angle:0:f==="viewport"?-this.transform.angle:0;if(w){const C=Math.sin(w),D=Math.cos(w);h=[h[0]*D-h[1]*C,h[0]*C+h[1]*D]}const S=[y?h[0]:he(o,h[0],this.transform.zoom),y?h[1]:he(o,h[1],this.transform.zoom),0],k=new Float32Array(16);return c.$(k,r,S),k}saveTileTexture(r){const o=this._tileTextures[r.size[0]];o?o.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const o=this._tileTextures[r];return o&&o.length>0?o.pop():null}isPatternMissing(r){if(!r)return!1;if(!r.from||!r.to)return!0;const o=this.imageManager.getPattern(r.from.toString()),h=this.imageManager.getPattern(r.to.toString());return!o||!h}useProgram(r,o){this.cache=this.cache||{};const h=r+(o?o.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[h]||(this.cache[h]=new jl(this.context,_i[r],o,Hl[r],this._showOverdrawInspector,this.style.map.terrain)),this.cache[h]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new De(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:r,drawingBufferHeight:o}=this.context.gl;return this.width!==r||this.height!==o}}class Bn{constructor(r,o){this.points=r,this.planes=o}static fromInvProjectionMatrix(r,o,h){const f=Math.pow(2,h),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const k=1/(S=c.ag([],S,r))[3]/o*f;return c.b3(S,S,[k,k,1/S[3],k])}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const k=function(N,H){var W=H[0],X=H[1],G=H[2],pe=W*W+X*X+G*G;return pe>0&&(pe=1/Math.sqrt(pe)),N[0]=H[0]*pe,N[1]=H[1]*pe,N[2]=H[2]*pe,N}([],function(N,H,W){var X=H[0],G=H[1],pe=H[2],we=W[0],re=W[1],me=W[2];return N[0]=G*me-pe*re,N[1]=pe*we-X*me,N[2]=X*re-G*we,N}([],Me([],y[S[0]],y[S[1]]),Me([],y[S[2]],y[S[1]]))),C=-((D=k)[0]*(P=y[S[1]])[0]+D[1]*P[1]+D[2]*P[2]);var D,P;return k.concat(C)});return new Bn(y,w)}}class Ao{constructor(r,o){this.min=r,this.max=o,this.center=function(h,f,y){return h[0]=.5*f[0],h[1]=.5*f[1],h[2]=.5*f[2],h}([],function(h,f,y){return h[0]=f[0]+y[0],h[1]=f[1]+y[1],h[2]=f[2]+y[2],h}([],this.min,this.max))}quadrant(r){const o=[r%2==0,r<2],h=de(this.min),f=de(this.max);for(let y=0;y<o.length;y++)h[y]=o[y]?this.min[y]:this.center[y],f[y]=o[y]?this.center[y]:this.max[y];return f[2]=this.max[2],new Ao(h,f)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}intersects(r){const o=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let h=!0;for(let f=0;f<r.planes.length;f++){const y=r.planes[f];let w=0;for(let S=0;S<o.length;S++)c.b4(y,o[S])>=0&&w++;if(w===0)return 0;w!==o.length&&(h=!1)}if(h)return 2;for(let f=0;f<3;f++){let y=Number.MAX_VALUE,w=-Number.MAX_VALUE;for(let S=0;S<r.points.length;S++){const k=r.points[S][f]-this.min[f];y=Math.min(y,k),w=Math.max(w,k)}if(w<0||y>this.max[f]-this.min[f])return 0}return 1}}class ul{constructor(r=0,o=0,h=0,f=0){if(isNaN(r)||r<0||isNaN(o)||o<0||isNaN(h)||h<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=o,this.left=h,this.right=f}interpolate(r,o,h){return o.top!=null&&r.top!=null&&(this.top=c.B.number(r.top,o.top,h)),o.bottom!=null&&r.bottom!=null&&(this.bottom=c.B.number(r.bottom,o.bottom,h)),o.left!=null&&r.left!=null&&(this.left=c.B.number(r.left,o.left,h)),o.right!=null&&r.right!=null&&(this.right=c.B.number(r.right,o.right,h)),this}getCenter(r,o){const h=c.ad((this.left+r-this.right)/2,0,r),f=c.ad((this.top+o-this.bottom)/2,0,o);return new c.P(h,f)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new ul(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class cc{constructor(r,o,h,f,y){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=y===void 0||!!y,this._minZoom=r||0,this._maxZoom=o||22,this._minPitch=h??0,this._maxPitch=f??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new c.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ul,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const r=new cc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return r.apply(this),r}apply(r){this.tileSize=r.tileSize,this.latRange=r.latRange,this.width=r.width,this.height=r.height,this._center=r._center,this._elevation=r._elevation,this._minEleveationForCurrentTile=r._minEleveationForCurrentTile,this.zoom=r.zoom,this.angle=r.angle,this._fov=r._fov,this._pitch=r._pitch,this._unmodified=r._unmodified,this._edgeInsets=r._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(r){const o=-c.b5(r,-180,180)*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=function(){var h=new c.A(4);return c.A!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h}(),function(h,f,y){var w=f[0],S=f[1],k=f[2],C=f[3],D=Math.sin(y),P=Math.cos(y);h[0]=w*P+k*D,h[1]=S*P+C*D,h[2]=w*-D+k*P,h[3]=S*-D+C*P}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const o=c.ad(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=r/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(r){const o=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._zoom=o,this.tileZoom=Math.max(0,Math.floor(o)),this.scale=this.zoomScale(o),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(r){r!==this._elevation&&(this._elevation=r,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,o,h){this._unmodified=!1,this._edgeInsets.interpolate(r,o,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const o=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(r){const o=[new c.b6(0,r)];if(this._renderWorldCopies){const h=this.pointCoordinate(new c.P(0,0)),f=this.pointCoordinate(new c.P(this.width,0)),y=this.pointCoordinate(new c.P(this.width,this.height)),w=this.pointCoordinate(new c.P(0,this.height)),S=Math.floor(Math.min(h.x,f.x,y.x,w.x)),k=Math.floor(Math.max(h.x,f.x,y.x,w.x)),C=1;for(let D=S-C;D<=k+C;D++)D!==0&&o.push(new c.b6(D,r))}return o}coveringTiles(r){var o,h;let f=this.coveringZoomLevel(r);const y=f;if(r.minzoom!==void 0&&f<r.minzoom)return[];r.maxzoom!==void 0&&f>r.maxzoom&&(f=r.maxzoom);const w=this.pointCoordinate(this.getCameraPoint()),S=c.U.fromLngLat(this.center),k=Math.pow(2,f),C=[k*w.x,k*w.y,0],D=[k*S.x,k*S.y,0],P=Bn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f);let N=r.minzoom||0;!r.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(N=f);const H=r.terrain?2/Math.min(this.tileSize,r.tileSize)*this.tileSize:3,W=re=>({aabb:new Ao([re*k,0,0],[(re+1)*k,k,0]),zoom:0,x:0,y:0,wrap:re,fullyVisible:!1}),X=[],G=[],pe=f,we=r.reparseOverscaled?y:f;if(this._renderWorldCopies)for(let re=1;re<=3;re++)X.push(W(-re)),X.push(W(re));for(X.push(W(0));X.length>0;){const re=X.pop(),me=re.x,Te=re.y;let ke=re.fullyVisible;if(!ke){const It=re.aabb.intersects(P);if(It===0)continue;ke=It===2}const Re=r.terrain?C:D,He=re.aabb.distanceX(Re),Ue=re.aabb.distanceY(Re),tt=Math.max(Math.abs(He),Math.abs(Ue));if(re.zoom===pe||tt>H+(1<<pe-re.zoom)-2&&re.zoom>=N){const It=pe-re.zoom,_r=C[0]-.5-(me<<It),st=C[1]-.5-(Te<<It);G.push({tileID:new c.O(re.zoom===pe?we:re.zoom,re.wrap,re.zoom,me,Te),distanceSq:Ge([D[0]-.5-me,D[1]-.5-Te]),tileDistanceToCamera:Math.sqrt(_r*_r+st*st)})}else for(let It=0;It<4;It++){const _r=(me<<1)+It%2,st=(Te<<1)+(It>>1),Ft=re.zoom+1;let kt=re.aabb.quadrant(It);if(r.terrain){const qr=new c.O(Ft,re.wrap,Ft,_r,st),gr=r.terrain.getMinMaxElevation(qr),nr=(o=gr.minElevation)!==null&&o!==void 0?o:this.elevation,vr=(h=gr.maxElevation)!==null&&h!==void 0?h:this.elevation;kt=new Ao([kt.min[0],kt.min[1],nr],[kt.max[0],kt.max[1],vr])}X.push({aabb:kt,zoom:Ft,x:_r,y:st,wrap:re.wrap,fullyVisible:ke})}}return G.sort((re,me)=>re.distanceSq-me.distanceSq).map(re=>re.tileID)}resize(r,o){this.width=r,this.height=o,this.pixelsToGLUnits=[2/r,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const o=c.ad(r.lat,-this.maxValidLatitude,this.maxValidLatitude);return new c.P(c.G(r.lng)*this.worldSize,c.H(o)*this.worldSize)}unproject(r){return new c.U(r.x/this.worldSize,r.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(r){const o=this.pointLocation(this.centerPoint,r),h=r.getElevationForLngLatZoom(o,this.tileZoom);if(!(this.elevation-h))return;const f=this.getCameraPosition(),y=c.U.fromLngLat(f.lngLat,f.altitude),w=c.U.fromLngLat(o,h),S=y.x-w.x,k=y.y-w.y,C=y.z-w.z,D=Math.sqrt(S*S+k*k+C*C),P=this.scaleZoom(this.cameraToCenterDistance/D/this.tileSize);this._elevation=h,this._center=o,this.zoom=P}setLocationAtPoint(r,o){const h=this.pointCoordinate(o),f=this.pointCoordinate(this.centerPoint),y=this.locationCoordinate(r),w=new c.U(y.x-(h.x-f.x),y.y-(h.y-f.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(r,o){return o?this.coordinatePoint(this.locationCoordinate(r),o.getElevationForLngLatZoom(r,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(r))}pointLocation(r,o){return this.coordinateLocation(this.pointCoordinate(r,o))}locationCoordinate(r){return c.U.fromLngLat(r)}coordinateLocation(r){return r&&r.toLngLat()}pointCoordinate(r,o){if(o){const N=o.pointCoordinate(r);if(N!=null)return N}const h=[r.x,r.y,0,1],f=[r.x,r.y,1,1];c.ag(h,h,this.pixelMatrixInverse),c.ag(f,f,this.pixelMatrixInverse);const y=h[3],w=f[3],S=h[1]/y,k=f[1]/w,C=h[2]/y,D=f[2]/w,P=C===D?0:(0-C)/(D-C);return new c.U(c.B.number(h[0]/y,f[0]/w,P)/this.worldSize,c.B.number(S,k,P)/this.worldSize)}coordinatePoint(r,o=0,h=this.pixelMatrix){const f=[r.x*this.worldSize,r.y*this.worldSize,o,1];return c.ag(f,f,h),new c.P(f[0]/f[3],f[1]/f[3])}getBounds(){const r=Math.max(0,this.height/2-this.getHorizon());return new ar().extend(this.pointLocation(new c.P(0,r))).extend(this.pointLocation(new c.P(this.width,r))).extend(this.pointLocation(new c.P(this.width,this.height))).extend(this.pointLocation(new c.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new ar([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(r){r?(this.lngRange=[r.getWest(),r.getEast()],this.latRange=[r.getSouth(),r.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(r,o=!1){const h=r.key,f=o?this._alignedPosMatrixCache:this._posMatrixCache;if(f[h])return f[h];const y=r.canonical,w=this.worldSize/this.zoomScale(y.z),S=y.x+Math.pow(2,y.z)*r.wrap,k=c.ao(new Float64Array(16));return c.$(k,k,[S*w,y.y*w,0]),c.a0(k,k,[w/c.N,w/c.N,1]),c.a1(k,o?this.alignedProjMatrix:this.projMatrix,k),f[h]=new Float32Array(k),f[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let r,o,h,f,y=-90,w=90,S=-180,k=180;const C=this.size,D=this._unmodified;if(this.latRange){const H=this.latRange;y=c.H(H[1])*this.worldSize,w=c.H(H[0])*this.worldSize,r=w-y<C.y?C.y/(w-y):0}if(this.lngRange){const H=this.lngRange;S=c.b5(c.G(H[0])*this.worldSize,0,this.worldSize),k=c.b5(c.G(H[1])*this.worldSize,0,this.worldSize),k<S&&(k+=this.worldSize),o=k-S<C.x?C.x/(k-S):0}const P=this.point,N=Math.max(o||0,r||0);if(N)return this.center=this.unproject(new c.P(o?(k+S)/2:P.x,r?(w+y)/2:P.y)),this.zoom+=this.scaleZoom(N),this._unmodified=D,void(this._constraining=!1);if(this.latRange){const H=P.y,W=C.y/2;H-W<y&&(f=y+W),H+W>w&&(f=w-W)}if(this.lngRange){const H=(S+k)/2,W=c.b5(P.x,H-this.worldSize/2,H+this.worldSize/2),X=C.x/2;W-X<S&&(h=S+X),W+X>k&&(h=k-X)}h===void 0&&f===void 0||(this.center=this.unproject(new c.P(h!==void 0?h:P.x,f!==void 0?f:P.y)).wrap()),this._unmodified=D,this._constraining=!1}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,o=this.point.x,h=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=c.b7(1,this.center.lat)*this.worldSize;let f=c.ao(new Float64Array(16));c.a0(f,f,[this.width/2,-this.height/2,1]),c.$(f,f,[1,-1,0]),this.labelPlaneMatrix=f,f=c.ao(new Float64Array(16)),c.a0(f,f,[1,-1,1]),c.$(f,f,[-1,-1,0]),c.a0(f,f,[2/this.width,2/this.height,1]),this.glCoordMatrix=f;const y=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),w=Math.min(this.elevation,this._minEleveationForCurrentTile),S=y-w*this._pixelPerMeter/Math.cos(this._pitch),k=w<0?S:y,C=Math.PI/2+this._pitch,D=this._fov*(.5+r.y/this.height),P=Math.sin(D)*k/Math.sin(c.ad(Math.PI-C-D,.01,Math.PI-.01)),N=this.getHorizon(),H=2*Math.atan(N/this.cameraToCenterDistance)*(.5+r.y/(2*N)),W=Math.sin(H)*k/Math.sin(c.ad(Math.PI-C-H,.01,Math.PI-.01)),X=Math.min(P,W),G=1.01*(Math.cos(Math.PI/2-this._pitch)*X+k),pe=this.height/50;f=new Float64Array(16),c.b8(f,this._fov,this.width/this.height,pe,G),f[8]=2*-r.x/this.width,f[9]=2*r.y/this.height,c.a0(f,f,[1,-1,1]),c.$(f,f,[0,0,-this.cameraToCenterDistance]),c.b9(f,f,this._pitch),c.ae(f,f,this.angle),c.$(f,f,[-o,-h,0]),this.mercatorMatrix=c.a0([],f,[this.worldSize,this.worldSize,this.worldSize]),c.a0(f,f,[1,1,this._pixelPerMeter]),this.pixelMatrix=c.a1(new Float64Array(16),this.labelPlaneMatrix,f),c.$(f,f,[0,0,-this.elevation]),this.projMatrix=f,this.invProjMatrix=c.as([],f),this.pixelMatrix3D=c.a1(new Float64Array(16),this.labelPlaneMatrix,f);const we=this.width%2/2,re=this.height%2/2,me=Math.cos(this.angle),Te=Math.sin(this.angle),ke=o-Math.round(o)+me*we+Te*re,Re=h-Math.round(h)+me*re+Te*we,He=new Float64Array(f);if(c.$(He,He,[ke>.5?ke-1:ke,Re>.5?Re-1:Re,0]),this.alignedProjMatrix=He,f=c.as(new Float64Array(16),this.pixelMatrix),!f)throw new Error("failed to invert matrix");this.pixelMatrixInverse=f,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const r=this.pointCoordinate(new c.P(0,0)),o=[r.x*this.worldSize,r.y*this.worldSize,0,1];return c.ag(o,o,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(0,r))}getCameraQueryGeometry(r){const o=this.getCameraPoint();if(r.length===1)return[r[0],o];{let h=o.x,f=o.y,y=o.x,w=o.y;for(const S of r)h=Math.min(h,S.x),f=Math.min(f,S.y),y=Math.max(y,S.x),w=Math.max(w,S.y);return[new c.P(h,f),new c.P(y,f),new c.P(y,w),new c.P(h,w),new c.P(h,f)]}}}function Ya(m,r){let o,h=!1,f=null,y=null;const w=()=>{f=null,h&&(m.apply(y,o),f=setTimeout(w,r),h=!1)};return(...S)=>(h=!0,y=this,o=S,f||w(),f)}class hl{constructor(r){this._getCurrentHash=()=>{const o=window.location.hash.replace("#","");if(this._hashName){let h;return o.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(h=f)}),(h&&h[1]||"").split("/")}return o.split("/")},this._onHashChange=()=>{const o=this._getCurrentHash();if(o.length>=3&&!o.some(h=>isNaN(h))){const h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:h,pitch:+(o[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const o=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,o)}catch{}},this._updateHash=Ya(this._updateHashUnthrottled,300),this._hashName=r&&encodeURIComponent(r)}addTo(r){return this._map=r,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(r){const o=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,f=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,f),w=Math.round(o.lng*y)/y,S=Math.round(o.lat*y)/y,k=this._map.getBearing(),C=this._map.getPitch();let D="";if(D+=r?`/${w}/${S}/${h}`:`${h}/${S}/${w}`,(k||C)&&(D+="/"+Math.round(10*k)/10),C&&(D+=`/${Math.round(C)}`),this._hashName){const P=this._hashName;let N=!1;const H=window.location.hash.slice(1).split("&").map(W=>{const X=W.split("=")[0];return X===P?(N=!0,`${X}=${D}`):W}).filter(W=>W);return N||H.push(`${P}=${D}`),`#${H.join("&")}`}return`#${D}`}}const Eo={linearity:.3,easing:c.ba(0,0,.3,1)},Ad=c.e({deceleration:2500,maxSpeed:1400},Eo),Ed=c.e({deceleration:20,maxSpeed:1400},Eo),Cd=c.e({deceleration:1e3,maxSpeed:360},Eo),Md=c.e({deceleration:1e3,maxSpeed:90},Eo);class Dd{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:c.h.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,o=c.h.now();for(;r.length>0&&o-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const o={zoom:0,bearing:0,pitch:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)o.zoom+=y.zoomDelta||0,o.bearing+=y.bearingDelta||0,o.pitch+=y.pitchDelta||0,y.panDelta&&o.pan._add(y.panDelta),y.around&&(o.around=y.around),y.pinchAround&&(o.pinchAround=y.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,f={};if(o.pan.mag()){const y=dl(o.pan.mag(),h,c.e({},Ad,r||{}));f.offset=o.pan.mult(y.amount/o.pan.mag()),f.center=this._map.transform.center,Bs(f,y)}if(o.zoom){const y=dl(o.zoom,h,Ed);f.zoom=this._map.transform.zoom+y.amount,Bs(f,y)}if(o.bearing){const y=dl(o.bearing,h,Cd);f.bearing=this._map.transform.bearing+c.ad(y.amount,-179,179),Bs(f,y)}if(o.pitch){const y=dl(o.pitch,h,Md);f.pitch=this._map.transform.pitch+y.amount,Bs(f,y)}if(f.zoom||f.bearing){const y=o.pinchAround===void 0?o.around:o.pinchAround;f.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),c.e(f,{noMoveStart:!0})}}function Bs(m,r){(!m.duration||m.duration<r.duration)&&(m.duration=r.duration,m.easing=r.easing)}function dl(m,r,o){const{maxSpeed:h,linearity:f,deceleration:y}=o,w=c.ad(m*f/(r/1e3),-h,h),S=Math.abs(w)/(y*f);return{easing:o.easing,duration:1e3*S,amount:w*(S/2)}}class Yn extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,o,h,f={}){const y=T.mousePos(o.getCanvasContainer(),h),w=o.unproject(y);super(r,c.e({point:y,lngLat:w,originalEvent:h},f)),this._defaultPrevented=!1,this.target=o}}class fl extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,o,h){const f=r==="touchend"?h.changedTouches:h.touches,y=T.touchPos(o.getCanvasContainer(),f),w=y.map(k=>o.unproject(k)),S=y.reduce((k,C,D,P)=>k.add(C.div(P.length)),new c.P(0,0));super(r,{points:y,point:S,lngLats:w,lngLat:o.unproject(S),originalEvent:h}),this._defaultPrevented=!1}}class Pd extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,o,h){super(r,{originalEvent:h}),this._defaultPrevented=!1}}class Ld{constructor(r,o){this._map=r,this._clickTolerance=o.clickTolerance}reset(){delete this._mousedownPos}wheel(r){return this._firePreventable(new Pd(r.type,this._map,r))}mousedown(r,o){return this._mousedownPos=o,this._firePreventable(new Yn(r.type,this._map,r))}mouseup(r){this._map.fire(new Yn(r.type,this._map,r))}click(r,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||this._map.fire(new Yn(r.type,this._map,r))}dblclick(r){return this._firePreventable(new Yn(r.type,this._map,r))}mouseover(r){this._map.fire(new Yn(r.type,this._map,r))}mouseout(r){this._map.fire(new Yn(r.type,this._map,r))}touchstart(r){return this._firePreventable(new fl(r.type,this._map,r))}touchmove(r){this._map.fire(new fl(r.type,this._map,r))}touchend(r){this._map.fire(new fl(r.type,this._map,r))}touchcancel(r){this._map.fire(new fl(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class zd{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(r){this._map.fire(new Yn(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Yn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._ignoreContextMenu||this._map.fire(new Yn(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qs{constructor(r){this._map=r}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(r){return this.transform.pointLocation(c.P.convert(r),this._map.terrain)}}class Bd{constructor(r,o){this._map=r,this._tr=new Qs(r),this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,o){this.isEnabled()&&r.shiftKey&&r.button===0&&(T.disableDrag(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(r,o){if(!this._active)return;const h=o;if(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)return;const f=this._startPos;this._lastPos=h,this._box||(this._box=T.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",r));const y=Math.min(f.x,h.x),w=Math.max(f.x,h.x),S=Math.min(f.y,h.y),k=Math.max(f.y,h.y);T.setTransform(this._box,`translate(${y}px,${S}px)`),this._box.style.width=w-y+"px",this._box.style.height=k-S+"px"}mouseupWindow(r,o){if(!this._active||r.button!==0)return;const h=this._startPos,f=o;if(this.reset(),T.suppressClick(),h.x!==f.x||h.y!==f.y)return this._map.fire(new c.k("boxzoomend",{originalEvent:r})),{cameraAnimation:y=>y.fitScreenCoordinates(h,f,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",r)}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(T.remove(this._box),this._box=null),T.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(r,o){return this._map.fire(new c.k(r,{originalEvent:o}))}}function fs(m,r){if(m.length!==r.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${r.length}`);const o={};for(let h=0;h<m.length;h++)o[m[h].identifier]=r[h];return o}class ea{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(r,o,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=r.timeStamp),h.length===this.numTouches&&(this.centroid=function(f){const y=new c.P(0,0);for(const w of f)y._add(w);return y.div(f.length)}(o),this.touches=fs(h,o)))}touchmove(r,o,h){if(this.aborted||!this.centroid)return;const f=fs(h,o);for(const y in this.touches){const w=f[y];(!w||w.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(r,o,h){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){const f=!this.aborted&&this.centroid;if(this.reset(),f)return f}}}class uc{constructor(r){this.singleTap=new ea(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(r,o,h){this.singleTap.touchstart(r,o,h)}touchmove(r,o,h){this.singleTap.touchmove(r,o,h)}touchend(r,o,h){const f=this.singleTap.touchend(r,o,h);if(f){const y=r.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(f)<30;if(y&&w||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}}}class ta{constructor(r){this._tr=new Qs(r),this._zoomIn=new uc({numTouches:1,numTaps:2}),this._zoomOut=new uc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,o,h){this._zoomIn.touchstart(r,o,h),this._zoomOut.touchstart(r,o,h)}touchmove(r,o,h){this._zoomIn.touchmove(r,o,h),this._zoomOut.touchmove(r,o,h)}touchend(r,o,h){const f=this._zoomIn.touchend(r,o,h),y=this._zoomOut.touchend(r,o,h),w=this._tr;return f?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:w.zoom+1,around:w.unproject(f)},{originalEvent:r})}):y?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:w.zoom-1,around:w.unproject(y)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ra{constructor(r){this._enabled=!!r.enable,this._moveStateManager=r.moveStateManager,this._clickTolerance=r.clickTolerance||1,this._moveFunction=r.move,this._activateOnStart=!!r.activateOnStart,r.assignEvents(this),this.reset()}reset(r){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(r)}_move(...r){const o=this._moveFunction(...r);if(o.bearingDelta||o.pitchDelta||o.around||o.panDelta)return this._active=!0,o}dragStart(r,o){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(r)&&(this._moveStateManager.startMove(r),this._lastPoint=o.length?o[0]:o,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(r,o){if(!this.isEnabled())return;const h=this._lastPoint;if(!h)return;if(r.preventDefault(),!this._moveStateManager.isValidMoveEvent(r))return void this.reset(r);const f=o.length?o[0]:o;return!this._moved&&f.dist(h)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=f,this._move(h,f))}dragEnd(r){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(r)&&(this._moved&&T.suppressClick(),this.reset(r))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const mm={0:1,2:2};class zu{constructor(r){this._correctEvent=r.checkCorrectEvent}startMove(r){const o=T.mouseButton(r);this._eventButton=o}endMove(r){delete this._eventButton}isValidStartEvent(r){return this._correctEvent(r)}isValidMoveEvent(r){return!function(o,h){const f=mm[h];return o.buttons===void 0||(o.buttons&f)!==f}(r,this._eventButton)}isValidEndEvent(r){return T.mouseButton(r)===this._eventButton}}class Rd{constructor(){this._firstTouch=void 0}_isOneFingerTouch(r){return r.targetTouches.length===1}_isSameTouchEvent(r){return r.targetTouches[0].identifier===this._firstTouch}startMove(r){this._firstTouch=r.targetTouches[0].identifier}endMove(r){delete this._firstTouch}isValidStartEvent(r){return this._isOneFingerTouch(r)}isValidMoveEvent(r){return this._isOneFingerTouch(r)&&this._isSameTouchEvent(r)}isValidEndEvent(r){return this._isOneFingerTouch(r)&&this._isSameTouchEvent(r)}}const hc=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=function(r){r.preventDefault()}},Co=({enable:m,clickTolerance:r,bearingDegreesPerPixelMoved:o=.8})=>{const h=new zu({checkCorrectEvent:f=>T.mouseButton(f)===0&&f.ctrlKey||T.mouseButton(f)===2});return new ra({clickTolerance:r,move:(f,y)=>({bearingDelta:(y.x-f.x)*o}),moveStateManager:h,enable:m,assignEvents:hc})},ia=({enable:m,clickTolerance:r,pitchDegreesPerPixelMoved:o=-.5})=>{const h=new zu({checkCorrectEvent:f=>T.mouseButton(f)===0&&f.ctrlKey||T.mouseButton(f)===2});return new ra({clickTolerance:r,move:(f,y)=>({pitchDelta:(y.y-f.y)*o}),moveStateManager:h,enable:m,assignEvents:hc})};class yt{constructor(r,o){this._minTouches=r.cooperativeGestures?2:1,this._clickTolerance=r.clickTolerance||1,this._map=o,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(r,o,h){return this._calculateTransform(r,o,h)}touchmove(r,o,h){if(this._map._cooperativeGestures&&(this._minTouches===2&&h.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(r,!1,h.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(h.length<this._minTouches))return r.preventDefault(),this._calculateTransform(r,o,h)}touchend(r,o,h){this._calculateTransform(r,o,h),this._active&&h.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,o,h){h.length>0&&(this._active=!0);const f=fs(h,o),y=new c.P(0,0),w=new c.P(0,0);let S=0;for(const C in f){const D=f[C],P=this._touches[C];P&&(y._add(D),w._add(D.sub(P)),S++,f[C]=D)}if(this._touches=f,S<this._minTouches||!w.mag())return;const k=w.div(S);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(S),panDelta:k}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dc{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(r,o,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([o[0],o[1]]))}touchmove(r,o,h){if(!this._firstTwoTouches)return;r.preventDefault();const[f,y]=this._firstTwoTouches,w=wa(h,o,f),S=wa(h,o,y);if(!w||!S)return;const k=this._aroundCenter?null:w.add(S).div(2);return this._move([w,S],k,r)}touchend(r,o,h){if(!this._firstTwoTouches)return;const[f,y]=this._firstTwoTouches,w=wa(h,o,f),S=wa(h,o,y);w&&S||(this._active&&T.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function wa(m,r,o){for(let h=0;h<m.length;h++)if(m[h].identifier===o)return r[h]}function Mo(m,r){return Math.log(m/r)/Math.LN2}class Fd extends dc{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,o){const h=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(Mo(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Mo(this._distance,h),pinchAround:o}}}function ft(m,r){return 180*m.angleWith(r)/Math.PI}class Bu extends dc{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,o){const h=this._vector;if(this._vector=r[0].sub(r[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ft(this._vector,h),pinchAround:o}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const o=25/(Math.PI*this._minDiameter)*360,h=ft(r,this._startVector);return Math.abs(h)<o}}function Ru(m){return Math.abs(m.y)>Math.abs(m.x)}class gm extends dc{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(r,o,h){super.touchstart(r,o,h),this._currentTouchCount=h.length}_start(r){this._lastPoints=r,Ru(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,o,h){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const f=r[0].sub(this._lastPoints[0]),y=r[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(f,y,h.timeStamp),this._valid?(this._lastPoints=r,this._active=!0,{pitchDelta:(f.y+y.y)/2*-.5}):void 0}gestureBeginsVertically(r,o,h){if(this._valid!==void 0)return this._valid;const f=r.mag()>=2,y=o.mag()>=2;if(!f&&!y)return;if(!f||!y)return this._firstMove===void 0&&(this._firstMove=h),h-this._firstMove<100&&void 0;const w=r.y>0==o.y>0;return Ru(r)&&Ru(o)&&w}}const Fu={panStep:100,bearingStep:15,pitchStep:10};class Od{constructor(r){this._tr=new Qs(r);const o=Fu;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let o=0,h=0,f=0,y=0,w=0;switch(r.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:r.shiftKey?h=-1:(r.preventDefault(),y=-1);break;case 39:r.shiftKey?h=1:(r.preventDefault(),y=1);break;case 38:r.shiftKey?f=1:(r.preventDefault(),w=-1);break;case 40:r.shiftKey?f=-1:(r.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(h=0,f=0),{cameraAnimation:S=>{const k=this._tr;S.easeTo({duration:300,easeId:"keyboardHandler",easing:Nd,zoom:o?Math.round(k.zoom)+o*(r.shiftKey?2:1):k.zoom,bearing:k.bearing+h*this._bearingStep,pitch:k.pitch+f*this._pitchStep,offset:[-y*this._panStep,-w*this._panStep],center:k.center},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Nd(m){return m*(2-m)}const Ud=4.000244140625;class ym{constructor(r,o){this._onTimeout=h=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(h)},this._map=r,this._tr=new Qs(r),this._el=r.getCanvasContainer(),this._triggerRenderFrame=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!r[this._map._metaKey])return;r.preventDefault()}let o=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const h=c.h.now(),f=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,o!==0&&o%Ud==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(f*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),r.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=r,this._delta-=o,this._active||this._start(r)),r.preventDefault()}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=T.mousePos(this._el,r),h=this._tr;this._around=c.L.convert(this._aroundCenter?h.center:h.unproject(o)),this._aroundPoint=h.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._tr.transform;if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>Ud?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&k!==0&&(k=1/k);const C=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):r.scale;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(C*k))),this._type==="wheel"&&(this._startZoom=r.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const o=typeof this._targetZoom=="number"?this._targetZoom:r.zoom,h=this._startZoom,f=this._easing;let y,w=!1;if(this._type==="wheel"&&h&&f){const S=Math.min((c.h.now()-this._lastWheelEventTime)/200,1),k=f(S);y=c.B.number(h,o,k),S<1?this._frameId||(this._frameId=!0):w=!0}else y=o,w=!0;return this._active=!0,w&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!w,zoomDelta:y-r.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let o=c.bb;if(this._prevEase){const h=this._prevEase,f=(c.h.now()-h.start)/h.duration,y=h.easing(f+.01)-h.easing(f),w=.27/Math.sqrt(y*y+1e-4)*.01,S=Math.sqrt(.0729-w*w);o=c.ba(w,S,.25,1)}return this._prevEase={start:c.h.now(),duration:r,easing:o},o}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Ou{constructor(r,o){this._clickZoom=r,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Nu{constructor(r){this._tr=new Qs(r),this.reset()}reset(){this._active=!1}dblclick(r,o){return r.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:this._tr.zoom+(r.shiftKey?-1:1),around:this._tr.unproject(o)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Uu{constructor(){this._tap=new uc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(r,o,h){if(!this._swipePoint)if(this._tapTime){const f=o[0],y=r.timeStamp-this._tapTime<500,w=this._tapPoint.dist(f)<30;y&&w?h.length>0&&(this._swipePoint=f,this._swipeTouch=h[0].identifier):this.reset()}else this._tap.touchstart(r,o,h)}touchmove(r,o,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const f=o[0],y=f.y-this._swipePoint.y;return this._swipePoint=f,r.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(r,o,h)}touchend(r,o,h){if(this._tapTime)this._swipePoint&&h.length===0&&this.reset();else{const f=this._tap.touchend(r,o,h);f&&(this._tapTime=r.timeStamp,this._tapPoint=f)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $u{constructor(r,o,h){this._el=r,this._mousePan=o,this._touchPan=h}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Rn{constructor(r,o,h){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=o,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Sa{constructor(r,o,h,f){this._el=r,this._touchZoom=o,this._touchRotate=h,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const pl=m=>m.zoom||m.drag||m.pitch||m.rotate;class Vu extends c.k{}function ml(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class ju{constructor(r,o){this.handleWindowEvent=f=>{this.handleEvent(f,`${f.type}Window`)},this.handleEvent=(f,y)=>{if(f.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const w=f.type==="renderFrame"?void 0:f,S={needsRenderFrame:!1},k={},C={},D=f.touches,P=D?this._getMapTouches(D):void 0,N=P?T.touchPos(this._el,P):T.mousePos(this._el,f);for(const{handlerName:X,handler:G,allowed:pe}of this._handlers){if(!G.isEnabled())continue;let we;this._blockedByActive(C,pe,X)?G.reset():G[y||f.type]&&(we=G[y||f.type](f,N,P),this.mergeHandlerResult(S,k,we,X,w),we&&we.needsRenderFrame&&this._triggerRenderFrame()),(we||G.isActive())&&(C[X]=G)}const H={};for(const X in this._previousActiveHandlers)C[X]||(H[X]=w);this._previousActiveHandlers=C,(Object.keys(H).length||ml(S))&&(this._changes.push([S,k,H]),this._triggerRenderFrame()),(Object.keys(C).length||ml(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:W}=S;W&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],W(this._map))},this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Dd(r),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(o);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[window,"blur",void 0]];for(const[f,y,w]of this._listeners)T.addEventListener(f,y,f===document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[r,o,h]of this._listeners)T.removeEventListener(r,o,r===document?this.handleWindowEvent:this.handleEvent,h)}_addDefaultHandlers(r){const o=this._map,h=o.getCanvasContainer();this._add("mapEvent",new Ld(o,r));const f=o.boxZoom=new Bd(o,r);this._add("boxZoom",f),r.interactive&&r.boxZoom&&f.enable();const y=new ta(o),w=new Nu(o);o.doubleClickZoom=new Ou(w,y),this._add("tapZoom",y),this._add("clickZoom",w),r.interactive&&r.doubleClickZoom&&o.doubleClickZoom.enable();const S=new Uu;this._add("tapDragZoom",S);const k=o.touchPitch=new gm(o);this._add("touchPitch",k),r.interactive&&r.touchPitch&&o.touchPitch.enable(r.touchPitch);const C=Co(r),D=ia(r);o.dragRotate=new Rn(r,C,D),this._add("mouseRotate",C,["mousePitch"]),this._add("mousePitch",D,["mouseRotate"]),r.interactive&&r.dragRotate&&o.dragRotate.enable();const P=(({enable:pe,clickTolerance:we})=>{const re=new zu({checkCorrectEvent:me=>T.mouseButton(me)===0&&!me.ctrlKey});return new ra({clickTolerance:we,move:(me,Te)=>({around:Te,panDelta:Te.sub(me)}),activateOnStart:!0,moveStateManager:re,enable:pe,assignEvents:hc})})(r),N=new yt(r,o);o.dragPan=new $u(h,P,N),this._add("mousePan",P),this._add("touchPan",N,["touchZoom","touchRotate"]),r.interactive&&r.dragPan&&o.dragPan.enable(r.dragPan);const H=new Bu,W=new Fd;o.touchZoomRotate=new Sa(h,W,H,S),this._add("touchRotate",H,["touchPan","touchZoom"]),this._add("touchZoom",W,["touchPan","touchRotate"]),r.interactive&&r.touchZoomRotate&&o.touchZoomRotate.enable(r.touchZoomRotate);const X=o.scrollZoom=new ym(o,()=>this._triggerRenderFrame());this._add("scrollZoom",X,["mousePan"]),r.interactive&&r.scrollZoom&&o.scrollZoom.enable(r.scrollZoom);const G=o.keyboard=new Od(o);this._add("keyboard",G),r.interactive&&r.keyboard&&o.keyboard.enable(),this._add("blockableMapEvent",new zd(o))}_add(r,o,h){this._handlers.push({handlerName:r,handler:o,allowed:h}),this._handlersById[r]=o}stop(r){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!pl(this._eventsInProgress)||this.isZooming()}_blockedByActive(r,o,h){for(const f in r)if(f!==h&&(!o||o.indexOf(f)<0))return!0;return!1}_getMapTouches(r){const o=[];for(const h of r)this._el.contains(h.target)&&o.push(h);return o}mergeHandlerResult(r,o,h,f,y){if(!h)return;c.e(r,h);const w={handlerName:f,originalEvent:h.originalEvent||y};h.zoomDelta!==void 0&&(o.zoom=w),h.panDelta!==void 0&&(o.drag=w),h.pitchDelta!==void 0&&(o.pitch=w),h.bearingDelta!==void 0&&(o.rotate=w)}_applyChanges(){const r={},o={},h={};for(const[f,y,w]of this._changes)f.panDelta&&(r.panDelta=(r.panDelta||new c.P(0,0))._add(f.panDelta)),f.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+f.zoomDelta),f.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+f.bearingDelta),f.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+f.pitchDelta),f.around!==void 0&&(r.around=f.around),f.pinchAround!==void 0&&(r.pinchAround=f.pinchAround),f.noInertia&&(r.noInertia=f.noInertia),c.e(o,y),c.e(h,w);this._updateMapTransform(r,o,h),this._changes=[]}_updateMapTransform(r,o,h){const f=this._map,y=f._getTransformForUpdate(),w=f.terrain;if(!(ml(r)||w&&this._terrainMovement))return this._fireEvents(o,h,!0);let{panDelta:S,zoomDelta:k,bearingDelta:C,pitchDelta:D,around:P,pinchAround:N}=r;N!==void 0&&(P=N),f._stop(!0),P=P||f.transform.centerPoint;const H=y.pointLocation(S?P.sub(S):P);C&&(y.bearing+=C),D&&(y.pitch+=D),k&&(y.zoom+=k),w?this._terrainMovement||!o.drag&&!o.zoom?o.drag&&this._terrainMovement?y.center=y.pointLocation(y.centerPoint.sub(S)):y.setLocationAtPoint(H,P):(this._terrainMovement=!0,this._map._elevationFreeze=!0,y.setLocationAtPoint(H,P),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,y.recalculateZoom(f.terrain)})):y.setLocationAtPoint(H,P),f._applyUpdatedTransform(y),this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(o,h,!0)}_fireEvents(r,o,h){const f=pl(this._eventsInProgress),y=pl(r),w={};for(const D in r){const{originalEvent:P}=r[D];this._eventsInProgress[D]||(w[`${D}start`]=P),this._eventsInProgress[D]=r[D]}!f&&y&&this._fireEvent("movestart",y.originalEvent);for(const D in w)this._fireEvent(D,w[D]);y&&this._fireEvent("move",y.originalEvent);for(const D in r){const{originalEvent:P}=r[D];this._fireEvent(D,P)}const S={};let k;for(const D in this._eventsInProgress){const{handlerName:P,originalEvent:N}=this._eventsInProgress[D];this._handlersById[P].isActive()||(delete this._eventsInProgress[D],k=o[P]||N,S[`${D}end`]=k)}for(const D in S)this._fireEvent(D,S[D]);const C=pl(this._eventsInProgress);if(h&&(f||y)&&!C){this._updatingCamera=!0;const D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),P=N=>N!==0&&-this._bearingSnap<N&&N<this._bearingSnap;!D||!D.essential&&c.h.prefersReducedMotion?(this._map.fire(new c.k("moveend",{originalEvent:k})),P(this._map.getBearing())&&this._map.resetNorth()):(P(D.bearing||this._map.getBearing())&&(D.bearing=0),D.freezeElevation=!0,this._map.easeTo(D,{originalEvent:k})),this._updatingCamera=!1}}_fireEvent(r,o){this._map.fire(new c.k(r,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{delete this._frameId,this.handleEvent(new Vu("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class $d extends c.E{constructor(r,o){super(),this._renderFrameCallback=()=>{const h=Math.min((c.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=o.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new c.L(this.transform.center.lng,this.transform.center.lat)}setCenter(r,o){return this.jumpTo({center:r},o)}panBy(r,o,h){return r=c.P.convert(r).mult(-1),this.panTo(this.transform.center,c.e({offset:r},o),h)}panTo(r,o,h){return this.easeTo(c.e({center:r},o),h)}getZoom(){return this.transform.zoom}setZoom(r,o){return this.jumpTo({zoom:r},o),this}zoomTo(r,o,h){return this.easeTo(c.e({zoom:r},o),h)}zoomIn(r,o){return this.zoomTo(this.getZoom()+1,r,o),this}zoomOut(r,o){return this.zoomTo(this.getZoom()-1,r,o),this}getBearing(){return this.transform.bearing}setBearing(r,o){return this.jumpTo({bearing:r},o),this}getPadding(){return this.transform.padding}setPadding(r,o){return this.jumpTo({padding:r},o),this}rotateTo(r,o,h){return this.easeTo(c.e({bearing:r},o),h)}resetNorth(r,o){return this.rotateTo(0,c.e({duration:1e3},r),o),this}resetNorthPitch(r,o){return this.easeTo(c.e({bearing:0,pitch:0,duration:1e3},r),o),this}snapToNorth(r,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,o):this}getPitch(){return this.transform.pitch}setPitch(r,o){return this.jumpTo({pitch:r},o),this}cameraForBounds(r,o){r=ar.convert(r);const h=o&&o.bearing||0;return this._cameraForBoxAndBearing(r.getNorthWest(),r.getSouthEast(),h,o)}_cameraForBoxAndBearing(r,o,h,f){const y={top:0,bottom:0,right:0,left:0};if(typeof(f=c.e({padding:y,offset:[0,0],maxZoom:this.transform.maxZoom},f)).padding=="number"){const Te=f.padding;f.padding={top:Te,bottom:Te,right:Te,left:Te}}f.padding=c.e(y,f.padding);const w=this.transform,S=w.padding,k=w.project(c.L.convert(r)),C=w.project(c.L.convert(o)),D=k.rotate(-h*Math.PI/180),P=C.rotate(-h*Math.PI/180),N=new c.P(Math.max(D.x,P.x),Math.max(D.y,P.y)),H=new c.P(Math.min(D.x,P.x),Math.min(D.y,P.y)),W=N.sub(H),X=(w.width-(S.left+S.right+f.padding.left+f.padding.right))/W.x,G=(w.height-(S.top+S.bottom+f.padding.top+f.padding.bottom))/W.y;if(G<0||X<0)return void c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const pe=Math.min(w.scaleZoom(w.scale*Math.min(X,G)),f.maxZoom),we=c.P.convert(f.offset),re=new c.P((f.padding.left-f.padding.right)/2,(f.padding.top-f.padding.bottom)/2).rotate(h*Math.PI/180),me=we.add(re).mult(w.scale/w.zoomScale(pe));return{center:w.unproject(k.add(C).div(2).sub(me)),zoom:pe,bearing:h}}fitBounds(r,o,h){return this._fitInternal(this.cameraForBounds(r,o),o,h)}fitScreenCoordinates(r,o,h,f,y){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(c.P.convert(r)),this.transform.pointLocation(c.P.convert(o)),h,f),f,y)}_fitInternal(r,o,h){return r?(delete(o=c.e(r,o)).padding,o.linear?this.easeTo(o,h):this.flyTo(o,h)):this}jumpTo(r,o){this.stop();const h=this._getTransformForUpdate();let f=!1,y=!1,w=!1;return"zoom"in r&&h.zoom!==+r.zoom&&(f=!0,h.zoom=+r.zoom),r.center!==void 0&&(h.center=c.L.convert(r.center)),"bearing"in r&&h.bearing!==+r.bearing&&(y=!0,h.bearing=+r.bearing),"pitch"in r&&h.pitch!==+r.pitch&&(w=!0,h.pitch=+r.pitch),r.padding==null||h.isPaddingEqual(r.padding)||(h.padding=r.padding),this._applyUpdatedTransform(h),this.fire(new c.k("movestart",o)).fire(new c.k("move",o)),f&&this.fire(new c.k("zoomstart",o)).fire(new c.k("zoom",o)).fire(new c.k("zoomend",o)),y&&this.fire(new c.k("rotatestart",o)).fire(new c.k("rotate",o)).fire(new c.k("rotateend",o)),w&&this.fire(new c.k("pitchstart",o)).fire(new c.k("pitch",o)).fire(new c.k("pitchend",o)),this.fire(new c.k("moveend",o))}calculateCameraOptionsFromTo(r,o,h,f=0){const y=c.U.fromLngLat(r,o),w=c.U.fromLngLat(h,f),S=w.x-y.x,k=w.y-y.y,C=w.z-y.z,D=Math.hypot(S,k,C);if(D===0)throw new Error("Can't calculate camera options with same From and To");const P=Math.hypot(S,k),N=this.transform.scaleZoom(this.transform.cameraToCenterDistance/D/this.transform.tileSize),H=180*Math.atan2(S,-k)/Math.PI;let W=180*Math.acos(P/D)/Math.PI;return W=C<0?90-W:90+W,{center:w.toLngLat(),zoom:N,pitch:W,bearing:H}}easeTo(r,o){this._stop(!1,r.easeId),((r=c.e({offset:[0,0],duration:500,easing:c.bb},r)).animate===!1||!r.essential&&c.h.prefersReducedMotion)&&(r.duration=0);const h=this._getTransformForUpdate(),f=this.getZoom(),y=this.getBearing(),w=this.getPitch(),S=this.getPadding(),k="zoom"in r?+r.zoom:f,C="bearing"in r?this._normalizeBearing(r.bearing,y):y,D="pitch"in r?+r.pitch:w,P="padding"in r?r.padding:h.padding,N=c.P.convert(r.offset);let H=h.centerPoint.add(N);const W=h.pointLocation(H),X=c.L.convert(r.center||W);this._normalizeCenter(X);const G=h.project(W),pe=h.project(X).sub(G),we=h.zoomScale(k-f);let re,me;r.around&&(re=c.L.convert(r.around),me=h.locationPoint(re));const Te={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||k!==f,this._rotating=this._rotating||y!==C,this._pitching=this._pitching||D!==w,this._padding=!h.isPaddingEqual(P),this._easeId=r.easeId,this._prepareEase(o,r.noMoveStart,Te),this.terrain&&this._prepareElevation(X),this._ease(ke=>{if(this._zooming&&(h.zoom=c.B.number(f,k,ke)),this._rotating&&(h.bearing=c.B.number(y,C,ke)),this._pitching&&(h.pitch=c.B.number(w,D,ke)),this._padding&&(h.interpolatePadding(S,P,ke),H=h.centerPoint.add(N)),this.terrain&&!r.freezeElevation&&this._updateElevation(ke),re)h.setLocationAtPoint(re,me);else{const Re=h.zoomScale(h.zoom-f),He=k>f?Math.min(2,we):Math.max(.5,we),Ue=Math.pow(He,1-ke),tt=h.unproject(G.add(pe.mult(ke*Ue)).mult(Re));h.setLocationAtPoint(h.renderWorldCopies?tt.wrap():tt,H)}this._applyUpdatedTransform(h),this._fireMoveEvents(o)},ke=>{this.terrain&&this._finalizeElevation(),this._afterEase(o,ke)},r),this}_prepareEase(r,o,h={}){this._moving=!0,o||h.moving||this.fire(new c.k("movestart",r)),this._zooming&&!h.zooming&&this.fire(new c.k("zoomstart",r)),this._rotating&&!h.rotating&&this.fire(new c.k("rotatestart",r)),this._pitching&&!h.pitching&&this.fire(new c.k("pitchstart",r))}_prepareElevation(r){this._elevationCenter=r,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(r){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const o=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(r<1&&o!==this._elevationTarget){const h=this._elevationTarget-this._elevationStart;this._elevationStart+=r*(h-(o-(h*r+this._elevationStart))/(1-r)),this._elevationTarget=o}this.transform.elevation=c.B.number(this._elevationStart,this._elevationTarget,r)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(r){if(!this.transformCameraUpdate)return;const o=r.clone(),{center:h,zoom:f,pitch:y,bearing:w,elevation:S}=this.transformCameraUpdate(o);h&&(o.center=h),f!==void 0&&(o.zoom=f),y!==void 0&&(o.pitch=y),w!==void 0&&(o.bearing=w),S!==void 0&&(o.elevation=S),this.transform.apply(o)}_fireMoveEvents(r){this.fire(new c.k("move",r)),this._zooming&&this.fire(new c.k("zoom",r)),this._rotating&&this.fire(new c.k("rotate",r)),this._pitching&&this.fire(new c.k("pitch",r))}_afterEase(r,o){if(this._easeId&&o&&this._easeId===o)return;delete this._easeId;const h=this._zooming,f=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,h&&this.fire(new c.k("zoomend",r)),f&&this.fire(new c.k("rotateend",r)),y&&this.fire(new c.k("pitchend",r)),this.fire(new c.k("moveend",r))}flyTo(r,o){if(!r.essential&&c.h.prefersReducedMotion){const kt=c.F(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(kt,o)}this.stop(),r=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.bb},r);const h=this._getTransformForUpdate(),f=this.getZoom(),y=this.getBearing(),w=this.getPitch(),S=this.getPadding(),k="zoom"in r?c.ad(+r.zoom,h.minZoom,h.maxZoom):f,C="bearing"in r?this._normalizeBearing(r.bearing,y):y,D="pitch"in r?+r.pitch:w,P="padding"in r?r.padding:h.padding,N=h.zoomScale(k-f),H=c.P.convert(r.offset);let W=h.centerPoint.add(H);const X=h.pointLocation(W),G=c.L.convert(r.center||X);this._normalizeCenter(G);const pe=h.project(X),we=h.project(G).sub(pe);let re=r.curve;const me=Math.max(h.width,h.height),Te=me/N,ke=we.mag();if("minZoom"in r){const kt=c.ad(Math.min(r.minZoom,f,k),h.minZoom,h.maxZoom),qr=me/h.zoomScale(kt-f);re=Math.sqrt(qr/ke*2)}const Re=re*re;function He(kt){const qr=(Te*Te-me*me+(kt?-1:1)*Re*Re*ke*ke)/(2*(kt?Te:me)*Re*ke);return Math.log(Math.sqrt(qr*qr+1)-qr)}function Ue(kt){return(Math.exp(kt)-Math.exp(-kt))/2}function tt(kt){return(Math.exp(kt)+Math.exp(-kt))/2}const It=He(!1);let _r=function(kt){return tt(It)/tt(It+re*kt)},st=function(kt){return me*((tt(It)*(Ue(qr=It+re*kt)/tt(qr))-Ue(It))/Re)/ke;var qr},Ft=(He(!0)-It)/re;if(Math.abs(ke)<1e-6||!isFinite(Ft)){if(Math.abs(me-Te)<1e-6)return this.easeTo(r,o);const kt=Te<me?-1:1;Ft=Math.abs(Math.log(Te/me))/re,st=function(){return 0},_r=function(qr){return Math.exp(kt*re*qr)}}return r.duration="duration"in r?+r.duration:1e3*Ft/("screenSpeed"in r?+r.screenSpeed/re:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0),this._zooming=!0,this._rotating=y!==C,this._pitching=D!==w,this._padding=!h.isPaddingEqual(P),this._prepareEase(o,!1),this.terrain&&this._prepareElevation(G),this._ease(kt=>{const qr=kt*Ft,gr=1/_r(qr);h.zoom=kt===1?k:f+h.scaleZoom(gr),this._rotating&&(h.bearing=c.B.number(y,C,kt)),this._pitching&&(h.pitch=c.B.number(w,D,kt)),this._padding&&(h.interpolatePadding(S,P,kt),W=h.centerPoint.add(H)),this.terrain&&!r.freezeElevation&&this._updateElevation(kt);const nr=kt===1?G:h.unproject(pe.add(we.mult(st(qr))).mult(gr));h.setLocationAtPoint(h.renderWorldCopies?nr.wrap():nr,W),this._applyUpdatedTransform(h),this._fireMoveEvents(o)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(o)},r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const h=this._onEaseEnd;delete this._onEaseEnd,h.call(this,o)}if(!r){const h=this.handlers;h&&h.stop(!1)}return this}_ease(r,o,h){h.animate===!1||h.duration===0?(r(1),o()):(this._easeStart=c.h.now(),this._easeOptions=h,this._onEaseFrame=r,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(r,o){r=c.b5(r,-180,180);const h=Math.abs(r-o);return Math.abs(r-360-o)<h&&(r-=360),Math.abs(r+360-o)<h&&(r+=360),r}_normalizeCenter(r){const o=this.transform;if(!o.renderWorldCopies||o.lngRange)return;const h=r.lng-o.center.lng;r.lng+=h>180?-360:h<-180?360:0}queryTerrainElevation(r){return this.terrain?this.terrain.getElevationForLngLatZoom(c.L.convert(r),this.transform.tileZoom)-this.transform.elevation:null}}class Kn{constructor(r={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=o=>{!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"&&o.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=r}getDefaultPosition(){return"bottom-right"}onAdd(r){return this._map=r,this._compact=this.options&&this.options.compact,this._container=T.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=T.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=T.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){T.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(r,o){const h=this._map._getUIString(`AttributionControl.${o}`);r.title=h,r.setAttribute("aria-label",h)}_updateAttributions(){if(!this._map.style)return;let r=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=r.concat(this.options.customAttribution.map(f=>typeof f!="string"?"":f)):typeof this.options.customAttribution=="string"&&r.push(this.options.customAttribution)),this._map.style.stylesheet){const f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}const o=this._map.style.sourceCaches;for(const f in o){const y=o[f];if(y.used||y.usedForTerrain){const w=y.getSource();w.attribution&&r.indexOf(w.attribution)<0&&r.push(w.attribution)}}r=r.filter(f=>String(f).trim()),r.sort((f,y)=>f.length-y.length),r=r.filter((f,y)=>{for(let w=y+1;w<r.length;w++)if(r[w].indexOf(f)>=0)return!1;return!0});const h=r.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,r.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class li{constructor(r={}){this._updateCompact=()=>{const o=this._container.children;if(o.length){const h=o[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&h.classList.add("maplibregl-compact"):h.classList.remove("maplibregl-compact")}},this.options=r}getDefaultPosition(){return"bottom-left"}onAdd(r){this._map=r,this._compact=this.options&&this.options.compact,this._container=T.create("div","maplibregl-ctrl");const o=T.create("a","maplibregl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://maplibre.org/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){T.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class fc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const o=++this._id;return this._queue.push({callback:r,id:o,cancelled:!1}),o}remove(r){const o=this._currentlyRunning,h=o?this._queue.concat(o):this._queue;for(const f of h)if(f.id===r)return void(f.cancelled=!0)}run(r=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const o=this._currentlyRunning=this._queue;this._queue=[];for(const h of o)if(!h.cancelled&&(h.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const qu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Vd=c.Q([{name:"a_pos3d",type:"Int16",components:3}]);class jd extends c.E{constructor(r){super(),this.sourceCache=r,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,r.usedForTerrain=!0,r.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(r,o){this.sourceCache.update(r,o),this._renderableTilesKeys=[];const h={};for(const f of r.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:o}))h[f.key]=!0,this._renderableTilesKeys.push(f.key),this._tiles[f.key]||(f.posMatrix=new Float64Array(16),c.aS(f.posMatrix,0,c.N,0,c.N,0,1),this._tiles[f.key]=new Gi(f,this.tileSize));for(const f in this._tiles)h[f]||delete this._tiles[f]}freeRtt(r){for(const o in this._tiles){const h=this._tiles[o];(!r||h.tileID.equals(r)||h.tileID.isChildOf(r)||r.isChildOf(h.tileID))&&(h.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(r=>this.getTileByID(r))}getTileByID(r){return this._tiles[r]}getTerrainCoords(r){const o={};for(const h of this._renderableTilesKeys){const f=this._tiles[h].tileID;if(f.canonical.equals(r.canonical)){const y=r.clone();y.posMatrix=new Float64Array(16),c.aS(y.posMatrix,0,c.N,0,c.N,0,1),o[h]=y}else if(f.canonical.isChildOf(r.canonical)){const y=r.clone();y.posMatrix=new Float64Array(16);const w=f.canonical.z-r.canonical.z,S=f.canonical.x-(f.canonical.x>>w<<w),k=f.canonical.y-(f.canonical.y>>w<<w),C=c.N>>w;c.aS(y.posMatrix,0,C,0,C,0,1),c.$(y.posMatrix,y.posMatrix,[-S*C,-k*C,0]),o[h]=y}else if(r.canonical.isChildOf(f.canonical)){const y=r.clone();y.posMatrix=new Float64Array(16);const w=r.canonical.z-f.canonical.z,S=r.canonical.x-(r.canonical.x>>w<<w),k=r.canonical.y-(r.canonical.y>>w<<w),C=c.N>>w;c.aS(y.posMatrix,0,c.N,0,c.N,0,1),c.$(y.posMatrix,y.posMatrix,[S*C,k*C,0]),c.a0(y.posMatrix,y.posMatrix,[1/2**w,1/2**w,0]),o[h]=y}}return o}getSourceTile(r,o){const h=this.sourceCache._source;let f=r.overscaledZ-this.deltaZoom;if(f>h.maxzoom&&(f=h.maxzoom),f<h.minzoom)return null;this._sourceTileCache[r.key]||(this._sourceTileCache[r.key]=r.scaledTo(f).key);let y=this.sourceCache.getTileByID(this._sourceTileCache[r.key]);if((!y||!y.dem)&&o)for(;f>=h.minzoom&&(!y||!y.dem);)y=this.sourceCache.getTileByID(r.scaledTo(f--).key);return y}tilesAfterTime(r=Date.now()){return Object.values(this._tiles).filter(o=>o.timeAdded>=r)}}class qd{constructor(r,o,h){this.painter=r,this.sourceCache=new jd(o),this.options=h,this.exaggeration=typeof h.exaggeration=="number"?h.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(r,o,h,f=c.N){var y;if(!(o>=0&&o<f&&h>=0&&h<f))return 0;const w=this.getTerrainData(r),S=(y=w.tile)===null||y===void 0?void 0:y.dem;if(!S)return 0;const k=function(W,X,G){var pe=X[0],we=X[1];return W[0]=G[0]*pe+G[4]*we+G[12],W[1]=G[1]*pe+G[5]*we+G[13],W}([],[o/f*c.N,h/f*c.N],w.u_terrain_matrix),C=[k[0]*S.dim,k[1]*S.dim],D=Math.floor(C[0]),P=Math.floor(C[1]),N=C[0]-D,H=C[1]-P;return S.get(D,P)*(1-N)*(1-H)+S.get(D+1,P)*N*(1-H)+S.get(D,P+1)*(1-N)*H+S.get(D+1,P+1)*N*H}getElevationForLngLatZoom(r,o){const{tileID:h,mercatorX:f,mercatorY:y}=this._getOverscaledTileIDFromLngLatZoom(r,o);return this.getElevation(h,f%c.N,y%c.N,c.N)}getElevation(r,o,h,f=c.N){return this.getDEMElevation(r,o,h,f)*this.exaggeration}getTerrainData(r){if(!this._emptyDemTexture){const f=this.painter.context,y=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new De(f,y,f.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new De(f,new c.R({width:1,height:1}),f.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.ao([])}const o=this.sourceCache.getSourceTile(r,!0);if(o&&o.dem&&(!o.demTexture||o.needsTerrainPrepare)){const f=this.painter.context;o.demTexture=this.painter.getTileTexture(o.dem.stride),o.demTexture?o.demTexture.update(o.dem.getPixels(),{premultiply:!1}):o.demTexture=new De(f,o.dem.getPixels(),f.gl.RGBA,{premultiply:!1}),o.demTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),o.needsTerrainPrepare=!1}const h=o&&o+o.tileID.key+r.key;if(h&&!this._demMatrixCache[h]){const f=this.sourceCache.sourceCache._source.maxzoom;let y=r.canonical.z-o.tileID.canonical.z;r.overscaledZ>r.canonical.z&&(r.canonical.z>=f?y=r.canonical.z-f:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const w=r.canonical.x-(r.canonical.x>>y<<y),S=r.canonical.y-(r.canonical.y>>y<<y),k=c.bc(new Float64Array(16),[1/(c.N<<y),1/(c.N<<y),0]);c.$(k,k,[w*c.N,S*c.N,0]),this._demMatrixCache[r.key]={matrix:k,coord:r}}return{u_depth:2,u_terrain:3,u_terrain_dim:o&&o.dem&&o.dem.dim||1,u_terrain_matrix:h?this._demMatrixCache[r.key].matrix:this._emptyDemMatrix,u_terrain_unpack:o&&o.dem&&o.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(o&&o.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:o}}getFramebuffer(r){const o=this.painter,h=o.width/devicePixelRatio,f=o.height/devicePixelRatio;return!this._fbo||this._fbo.width===h&&this._fbo.height===f||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new De(o.context,{width:h,height:f,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new De(o.context,{width:h,height:f,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=o.context.createFramebuffer(h,f,!0,!1),this._fbo.depthAttachment.set(o.context.createRenderbuffer(o.context.gl.DEPTH_COMPONENT16,h,f))),this._fbo.colorAttachment.set(r==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const r=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const o=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let y=0,w=0;y<this._coordsTextureSize;y++)for(let S=0;S<this._coordsTextureSize;S++,w+=4)o[w+0]=255&S,o[w+1]=255&y,o[w+2]=S>>8<<4|y>>8,o[w+3]=0;const h=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(o.buffer)),f=new De(r,h,r.gl.RGBA,{premultiply:!1});return f.bind(r.gl.NEAREST,r.gl.CLAMP_TO_EDGE),this._coordsTexture=f,f}pointCoordinate(r){const o=new Uint8Array(4),h=this.painter.context,f=h.gl;h.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),f.readPixels(r.x,this.painter.height/devicePixelRatio-r.y-1,1,1,f.RGBA,f.UNSIGNED_BYTE,o),h.bindFramebuffer.set(null);const y=o[0]+(o[2]>>4<<8),w=o[1]+((15&o[2])<<8),S=this.coordsIndex[255-o[3]],k=S&&this.sourceCache.getTileByID(S);if(!k)return null;const C=this._coordsTextureSize,D=(1<<k.tileID.canonical.z)*C;return new c.U(this._allowMercatorOverflow(r,(k.tileID.canonical.x*C+y)/D),(k.tileID.canonical.y*C+w)/D,this.getElevation(k.tileID,y,w,C))}getTerrainMesh(){if(this._mesh)return this._mesh;const r=this.painter.context,o=new c.bd,h=new c.b0,f=this.meshSize,y=c.N/f,w=f*f;for(let P=0;P<=f;P++)for(let N=0;N<=f;N++)o.emplaceBack(N*y,P*y,0);for(let P=0;P<w;P+=f+1)for(let N=0;N<f;N++)h.emplaceBack(N+P,f+N+P+1,f+N+P+2),h.emplaceBack(N+P,f+N+P+2,N+P+1);const S=o.length,k=S+2*(f+1);for(const P of[0,1])for(let N=0;N<=f;N++)for(const H of[0,1])o.emplaceBack(N*y,P*c.N,H);for(let P=0;P<2*f;P+=2)h.emplaceBack(k+P,k+P+1,k+P+3),h.emplaceBack(k+P,k+P+3,k+P+2),h.emplaceBack(S+P,S+P+3,S+P+1),h.emplaceBack(S+P,S+P+2,S+P+3);const C=o.length,D=C+2*(f+1);for(const P of[0,1])for(let N=0;N<=f;N++)for(const H of[0,1])o.emplaceBack(P*c.N,N*y,H);for(let P=0;P<2*f;P+=2)h.emplaceBack(C+P,C+P+1,C+P+3),h.emplaceBack(C+P,C+P+3,C+P+2),h.emplaceBack(D+P,D+P+3,D+P+1),h.emplaceBack(D+P,D+P+2,D+P+3);return this._mesh={indexBuffer:r.createIndexBuffer(h),vertexBuffer:r.createVertexBuffer(o,Vd.members),segments:c.S.simpleSegment(0,0,o.length,h.length)},this._mesh}getMeshFrameDelta(r){return 2*Math.PI*c.be/Math.pow(2,r)/5}getMinTileElevationForLngLatZoom(r,o){var h;const{tileID:f}=this._getOverscaledTileIDFromLngLatZoom(r,o);return(h=this.getMinMaxElevation(f).minElevation)!==null&&h!==void 0?h:0}getMinMaxElevation(r){const o=this.getTerrainData(r).tile,h={minElevation:null,maxElevation:null};return o&&o.dem&&(h.minElevation=o.dem.min*this.exaggeration,h.maxElevation=o.dem.max*this.exaggeration),h}_getOverscaledTileIDFromLngLatZoom(r,o){const h=c.U.fromLngLat(r.wrap()),f=(1<<o)*c.N,y=h.x*f,w=h.y*f,S=Math.floor(y/c.N),k=Math.floor(w/c.N);return{tileID:new c.O(o,0,o,S,k),mercatorX:y,mercatorY:w}}_allowMercatorOverflow(r,o){const h=r.x<this.painter.width/2;let f=c.bf(o);const y=this.painter.transform.center.lng;return h&&Math.sign(f)>0&&Math.sign(y)<0||!h&&Math.sign(f)<0&&Math.sign(y)>0?(f=360*Math.sign(y)+f,c.G(f)):o}}class _m{constructor(r,o,h){this._context=r,this._size=o,this._tileSize=h,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const r of this._objects)r.texture.destroy(),r.fbo.destroy()}_createObject(r){const o=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),h=new De(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return h.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),o.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),o.colorAttachment.set(h.texture),{id:r,fbo:o,texture:h,stamp:-1,inUse:!1}}getObjectForId(r){return this._objects[r]}useObject(r){r.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(o=>r.id!==o),this._recentlyUsed.push(r.id)}stampObject(r){r.stamp=++this._stamp}getOrCreateFreeObject(){for(const o of this._recentlyUsed)if(!this._objects[o].inUse)return this._objects[o];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const r=this._createObject(this._objects.length);return this._objects.push(r),r}freeObject(r){r.inUse=!1}freeAllObjects(){for(const r of this._objects)this.freeObject(r)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(r=>!r.inUse)===!1}}const En={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class pc{constructor(r,o){this.painter=r,this.terrain=o,this.pool=new _m(r.context,30,o.sourceCache.tileSize*o.qualityFactor)}destruct(){this.pool.destruct()}getTexture(r){return this.pool.getObjectForId(r.rtt[this._stacks.length-1].id).texture}prepareForRender(r,o){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=r._order.filter(h=>!r._layers[h].isHidden(o)),this._coordsDescendingInv={};for(const h in r.sourceCaches){this._coordsDescendingInv[h]={};const f=r.sourceCaches[h].getVisibleCoordinates();for(const y of f){const w=this.terrain.sourceCache.getTerrainCoords(y);for(const S in w)this._coordsDescendingInv[h][S]||(this._coordsDescendingInv[h][S]=[]),this._coordsDescendingInv[h][S].push(w[S])}}this._coordsDescendingInvStr={};for(const h of r._order){const f=r._layers[h],y=f.source;if(En[f.type]&&!this._coordsDescendingInvStr[y]){this._coordsDescendingInvStr[y]={};for(const w in this._coordsDescendingInv[y])this._coordsDescendingInvStr[y][w]=this._coordsDescendingInv[y][w].map(S=>S.key).sort().join()}}for(const h of this._renderableTiles)for(const f in this._coordsDescendingInvStr){const y=this._coordsDescendingInvStr[f][h.tileID.key];y&&y!==h.rttCoords[f]&&(h.rtt=[])}}renderLayer(r){if(r.isHidden(this.painter.transform.zoom))return!1;const o=r.type,h=this.painter,f=this._renderableLayerIds[this._renderableLayerIds.length-1]===r.id;if(En[o]&&(this._prevType&&En[this._prevType]||this._stacks.push([]),this._prevType=o,this._stacks[this._stacks.length-1].push(r.id),!f))return!0;if(En[this._prevType]||En[o]&&f){this._prevType=o;const y=this._stacks.length-1,w=this._stacks[y]||[];for(const S of this._renderableTiles){if(this.pool.isFull()&&(Ti(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(S),S.rtt[y]){const C=this.pool.getObjectForId(S.rtt[y].id);if(C.stamp===S.rtt[y].stamp){this.pool.useObject(C);continue}}const k=this.pool.getOrCreateFreeObject();this.pool.useObject(k),this.pool.stampObject(k),S.rtt[y]={id:k.id,stamp:k.stamp},h.context.bindFramebuffer.set(k.fbo.framebuffer),h.context.clear({color:c.aT.transparent,stencil:0}),h.currentStencilSource=void 0;for(let C=0;C<w.length;C++){const D=h.style._layers[w[C]],P=D.source?this._coordsDescendingInv[D.source][S.tileID.key]:[S.tileID];h.context.viewport.set([0,0,k.fbo.width,k.fbo.height]),h._renderTileClippingMasks(D,P),h.renderLayer(h,h.style.sourceCaches[D.source],D,P),D.source&&(S.rttCoords[D.source]=this._coordsDescendingInvStr[D.source][S.tileID.key])}}return Ti(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),En[o]}return!1}}const Et=E,Rt={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},gl=m=>{m.touchstart=m.dragStart,m.touchmoveWindow=m.dragMove,m.touchend=m.dragEnd},Gu={showCompass:!0,showZoom:!0,visualizePitch:!1};class Zu{constructor(r,o,h=!1){this.mousedown=w=>{this.startMouse(c.e({},w,{ctrlKey:!0,preventDefault:()=>w.preventDefault()}),T.mousePos(this.element,w)),T.addEventListener(window,"mousemove",this.mousemove),T.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=w=>{this.moveMouse(w,T.mousePos(this.element,w))},this.mouseup=w=>{this.mouseRotate.dragEnd(w),this.mousePitch&&this.mousePitch.dragEnd(w),this.offTemp()},this.touchstart=w=>{w.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=T.touchPos(this.element,w.targetTouches)[0],this.startTouch(w,this._startPos),T.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),T.addEventListener(window,"touchend",this.touchend))},this.touchmove=w=>{w.targetTouches.length!==1?this.reset():(this._lastPos=T.touchPos(this.element,w.targetTouches)[0],this.moveTouch(w,this._lastPos))},this.touchend=w=>{w.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const f=r.dragRotate._mouseRotate.getClickTolerance(),y=r.dragRotate._mousePitch.getClickTolerance();this.element=o,this.mouseRotate=Co({clickTolerance:f,enable:!0}),this.touchRotate=(({enable:w,clickTolerance:S,bearingDegreesPerPixelMoved:k=.8})=>{const C=new Rd;return new ra({clickTolerance:S,move:(D,P)=>({bearingDelta:(P.x-D.x)*k}),moveStateManager:C,enable:w,assignEvents:gl})})({clickTolerance:f,enable:!0}),this.map=r,h&&(this.mousePitch=ia({clickTolerance:y,enable:!0}),this.touchPitch=(({enable:w,clickTolerance:S,pitchDegreesPerPixelMoved:k=-.5})=>{const C=new Rd;return new ra({clickTolerance:S,move:(D,P)=>({pitchDelta:(P.y-D.y)*k}),moveStateManager:C,enable:w,assignEvents:gl})})({clickTolerance:y,enable:!0})),T.addEventListener(o,"mousedown",this.mousedown),T.addEventListener(o,"touchstart",this.touchstart,{passive:!1}),T.addEventListener(o,"touchcancel",this.reset)}startMouse(r,o){this.mouseRotate.dragStart(r,o),this.mousePitch&&this.mousePitch.dragStart(r,o),T.disableDrag()}startTouch(r,o){this.touchRotate.dragStart(r,o),this.touchPitch&&this.touchPitch.dragStart(r,o),T.disableDrag()}moveMouse(r,o){const h=this.map,{bearingDelta:f}=this.mouseRotate.dragMove(r,o)||{};if(f&&h.setBearing(h.getBearing()+f),this.mousePitch){const{pitchDelta:y}=this.mousePitch.dragMove(r,o)||{};y&&h.setPitch(h.getPitch()+y)}}moveTouch(r,o){const h=this.map,{bearingDelta:f}=this.touchRotate.dragMove(r,o)||{};if(f&&h.setBearing(h.getBearing()+f),this.touchPitch){const{pitchDelta:y}=this.touchPitch.dragMove(r,o)||{};y&&h.setPitch(h.getPitch()+y)}}off(){const r=this.element;T.removeEventListener(r,"mousedown",this.mousedown),T.removeEventListener(r,"touchstart",this.touchstart,{passive:!1}),T.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),T.removeEventListener(window,"touchend",this.touchend),T.removeEventListener(r,"touchcancel",this.reset),this.offTemp()}offTemp(){T.enableDrag(),T.removeEventListener(window,"mousemove",this.mousemove),T.removeEventListener(window,"mouseup",this.mouseup),T.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),T.removeEventListener(window,"touchend",this.touchend)}}let Ri;function Wu(m,r,o){if(m=new c.L(m.lng,m.lat),r){const h=new c.L(m.lng-360,m.lat),f=new c.L(m.lng+360,m.lat),y=o.locationPoint(m).distSqr(r);o.locationPoint(h).distSqr(r)<y?m=h:o.locationPoint(f).distSqr(r)<y&&(m=f)}for(;Math.abs(m.lng-o.center.lng)>180;){const h=o.locationPoint(m);if(h.x>=0&&h.y>=0&&h.x<=o.width&&h.y<=o.height)break;m.lng>o.center.lng?m.lng-=360:m.lng+=360}return m}const ps={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Gd(m,r,o){const h=m.classList;for(const f in ps)h.remove(`maplibregl-${o}-anchor-${f}`);h.add(`maplibregl-${o}-anchor-${r}`)}class Ka extends c.E{constructor(r){if(super(),this._onKeyPress=o=>{const h=o.code,f=o.charCode||o.keyCode;h!=="Space"&&h!=="Enter"&&f!==32&&f!==13||this.togglePopup()},this._onMapClick=o=>{const h=o.originalEvent.target,f=this._element;this._popup&&(h===f||f.contains(h))&&this.togglePopup()},this._update=o=>{if(!this._map)return;const h=this._map.loaded()&&!this._map.isMoving();((o==null?void 0:o.type)==="terrain"||(o==null?void 0:o.type)==="render"&&!h)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=Wu(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let f="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?f=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(f=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let y="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?y="rotateX(0deg)":this._pitchAlignment==="map"&&(y=`rotateX(${this._map.getPitch()}deg)`),o&&o.type!=="moveend"||(this._pos=this._pos.round()),T.setTransform(this._element,`${ps[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${y} ${f}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const w=this._map.unproject(this._pos),S=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=w.distanceTo(this._lngLat)>20*S?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=o=>{if(!this._isDragging){const h=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.k("dragstart"))),this.fire(new c.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.k("dragend")),this._state="inactive"},this._addDragHandler=o=>{this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment!=="auto"?r.pitchAlignment:this._rotationAlignment,r&&r.element)this._element=r.element,this._offset=c.P.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=T.create("div"),this._element.setAttribute("aria-label","Map marker");const o=T.createNS("http://www.w3.org/2000/svg","svg"),h=41,f=27;o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height",`${h}px`),o.setAttributeNS(null,"width",`${f}px`),o.setAttributeNS(null,"viewBox",`0 0 ${f} ${h}`);const y=T.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd");const w=T.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"fill-rule","nonzero");const S=T.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"transform","translate(3.0, 29.0)"),S.setAttributeNS(null,"fill","#000000");const k=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const pe of k){const we=T.createNS("http://www.w3.org/2000/svg","ellipse");we.setAttributeNS(null,"opacity","0.04"),we.setAttributeNS(null,"cx","10.5"),we.setAttributeNS(null,"cy","5.80029008"),we.setAttributeNS(null,"rx",pe.rx),we.setAttributeNS(null,"ry",pe.ry),S.appendChild(we)}const C=T.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill",this._color);const D=T.createNS("http://www.w3.org/2000/svg","path");D.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),C.appendChild(D);const P=T.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"opacity","0.25"),P.setAttributeNS(null,"fill","#000000");const N=T.createNS("http://www.w3.org/2000/svg","path");N.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),P.appendChild(N);const H=T.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"transform","translate(6.0, 7.0)"),H.setAttributeNS(null,"fill","#FFFFFF");const W=T.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"transform","translate(8.0, 8.0)");const X=T.createNS("http://www.w3.org/2000/svg","circle");X.setAttributeNS(null,"fill","#000000"),X.setAttributeNS(null,"opacity","0.25"),X.setAttributeNS(null,"cx","5.5"),X.setAttributeNS(null,"cy","5.5"),X.setAttributeNS(null,"r","5.4999962");const G=T.createNS("http://www.w3.org/2000/svg","circle");G.setAttributeNS(null,"fill","#FFFFFF"),G.setAttributeNS(null,"cx","5.5"),G.setAttributeNS(null,"cy","5.5"),G.setAttributeNS(null,"r","5.4999962"),W.appendChild(X),W.appendChild(G),w.appendChild(S),w.appendChild(C),w.appendChild(P),w.appendChild(H),w.appendChild(W),o.appendChild(w),o.setAttributeNS(null,"height",h*this._scale+"px"),o.setAttributeNS(null,"width",f*this._scale+"px"),this._element.appendChild(o),this._offset=c.P.convert(r&&r.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",o=>{o.preventDefault()}),this._element.addEventListener("mousedown",o=>{o.preventDefault()}),Gd(this._element,this._anchor,"marker"),r&&r.className)for(const o of r.className.split(" "))this._element.classList.add(o);this._popup=null}addTo(r){return this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._update),r.on("moveend",this._update),r.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),T.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=c.L.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const f=Math.abs(13.5)/Math.SQRT2;r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(38.1-13.5+f)],"bottom-right":[-f,-1*(38.1-13.5+f)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?r.remove():r.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(r){return this._offset=c.P.convert(r),this._update(),this}addClassName(r){this._element.classList.add(r)}removeClassName(r){this._element.classList.remove(r)}toggleClassName(r){return this._element.classList.toggle(r)}setDraggable(r){return this._draggable=!!r,this._map&&(r?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r&&r!=="auto"?r:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const ki={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let xi=0,Do=!1;const yl={maxWidth:100,unit:"metric"};function _l(m,r,o){const h=o&&o.maxWidth||100,f=m._container.clientHeight/2,y=m.unproject([0,f]),w=m.unproject([h,f]),S=y.distanceTo(w);if(o&&o.unit==="imperial"){const k=3.2808*S;k>5280?Xa(r,h,k/5280,m._getUIString("ScaleControl.Miles")):Xa(r,h,k,m._getUIString("ScaleControl.Feet"))}else o&&o.unit==="nautical"?Xa(r,h,S/1852,m._getUIString("ScaleControl.NauticalMiles")):S>=1e3?Xa(r,h,S/1e3,m._getUIString("ScaleControl.Kilometers")):Xa(r,h,S,m._getUIString("ScaleControl.Meters"))}function Xa(m,r,o,h){const f=function(y){const w=Math.pow(10,`${Math.floor(y)}`.length-1);let S=y/w;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(k){const C=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*C)/C}(S),w*S}(o);m.style.width=r*(f/o)+"px",m.innerHTML=`${f}&nbsp;${h}`}const Hu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Yu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Po(m){if(m){if(typeof m=="number"){const r=Math.round(Math.abs(m)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,m),"top-left":new c.P(r,r),"top-right":new c.P(-r,r),bottom:new c.P(0,-m),"bottom-left":new c.P(r,-r),"bottom-right":new c.P(-r,-r),left:new c.P(m,0),right:new c.P(-m,0)}}if(m instanceof c.P||Array.isArray(m)){const r=c.P.convert(m);return{center:r,top:r,"top-left":r,"top-right":r,bottom:r,"bottom-left":r,"bottom-right":r,left:r,right:r}}return{center:c.P.convert(m.center||[0,0]),top:c.P.convert(m.top||[0,0]),"top-left":c.P.convert(m["top-left"]||[0,0]),"top-right":c.P.convert(m["top-right"]||[0,0]),bottom:c.P.convert(m.bottom||[0,0]),"bottom-left":c.P.convert(m["bottom-left"]||[0,0]),"bottom-right":c.P.convert(m["bottom-right"]||[0,0]),left:c.P.convert(m.left||[0,0]),right:c.P.convert(m.right||[0,0])}}return Po(new c.P(0,0))}const Ku={extend:(m,...r)=>c.e(m,...r),run(m){m()},logToElement(m,r=!1,o="log"){const h=window.document.getElementById(o);h&&(r&&(h.innerHTML=""),h.innerHTML+=`<br>${m}`)}},Xu=E;class Rr{static get version(){return Xu}static get workerCount(){return yi.workerCount}static set workerCount(r){yi.workerCount=r}static get maxParallelImageRequests(){return c.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(r){c.c.MAX_PARALLEL_IMAGE_REQUESTS=r}static get workerUrl(){return c.c.WORKER_URL}static set workerUrl(r){c.c.WORKER_URL=r}static addProtocol(r,o){c.c.REGISTERED_PROTOCOLS[r]=o}static removeProtocol(r){delete c.c.REGISTERED_PROTOCOLS[r]}}return Rr.Map=class extends $d{constructor(m){if(c.bg.mark(c.bh.create),(m=c.e({},Rt,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new cc(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),{bearingSnap:m.bearingSnap}),this._cooperativeGesturesOnWheel=r=>{this._onCooperativeGesture(r,r[this._metaKey],1)},this._contextLost=r=>{r.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new c.k("webglcontextlost",{originalEvent:r}))},this._contextRestored=r=>{this._setupPainter(),this.resize(),this._update(),this.fire(new c.k("webglcontextrestored",{originalEvent:r}))},this._onMapScroll=r=>{if(r.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=m.interactive,this._cooperativeGestures=m.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=m.maxTileCacheSize,this._maxTileCacheZoomLevels=m.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._crossSourceCollisions=m.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=m.collectResourceTiming,this._renderTaskQueue=new fc,this._controls=[],this._mapId=c.a2(),this._locale=c.e({},qu,m.locale),this._clickTolerance=m.clickTolerance,this._overridePixelRatio=m.pixelRatio,this._maxCanvasSize=m.maxCanvasSize,this.transformCameraUpdate=m.transformCameraUpdate,this._imageQueueHandle=ie.addThrottleControl(()=>this.isMoving()),this._requestManager=new be(m.transformRequest),typeof m.container=="string"){if(this._container=document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(m.maxBounds&&this.setMaxBounds(m.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let r=!1;const o=Ya(h=>{this._trackResize&&!this._removed&&this.resize(h)._update()},50);this._resizeObserver=new ResizeObserver(h=>{r?o(h):r=!0}),this._resizeObserver.observe(this._container)}this.handlers=new ju(this,m),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=m.hash&&new hl(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,c.e({},m.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=m.localIdeographFontFamily,this._validateStyle=m.validateStyle,m.style&&this.setStyle(m.style,{localIdeographFontFamily:m.localIdeographFontFamily}),m.attributionControl&&this.addControl(new Kn({customAttribution:m.customAttribution})),m.maplibreLogo&&this.addControl(new li,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new c.k(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new c.k(`${r.dataType}dataloading`,r))}),this.on("dataabort",r=>{this.fire(new c.k("sourcedataabort",r))})}_getMapId(){return this._mapId}addControl(m,r){if(r===void 0&&(r=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new c.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=m.onAdd(this);this._controls.push(m);const h=this._controlPositions[r];return r.indexOf("bottom")!==-1?h.insertBefore(o,h.firstChild):h.appendChild(o),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new c.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(m);return r>-1&&this._controls.splice(r,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}calculateCameraOptionsFromTo(m,r,o,h){return h==null&&this.terrain&&(h=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(m,r,o,h)}resize(m){var r;const o=this._containerDimensions(),h=o[0],f=o[1],y=this._getClampedPixelRatio(h,f);if(this._resizeCanvas(h,f,y),this.painter.resize(h,f,y),this.painter.overLimit()){const S=this.painter.context.gl;this._maxCanvasSize=[S.drawingBufferWidth,S.drawingBufferHeight];const k=this._getClampedPixelRatio(h,f);this._resizeCanvas(h,f,k),this.painter.resize(h,f,k)}this.transform.resize(h,f),(r=this._requestedCameraState)===null||r===void 0||r.resize(h,f);const w=!this._moving;return w&&(this.stop(),this.fire(new c.k("movestart",m)).fire(new c.k("move",m))),this.fire(new c.k("resize",m)),w&&this.fire(new c.k("moveend",m)),this}_getClampedPixelRatio(m,r){const{0:o,1:h}=this._maxCanvasSize,f=this.getPixelRatio(),y=m*f,w=r*f;return Math.min(y>o?o/y:1,w>h?h/w:1)*f}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(ar.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(m){return this._cooperativeGestures=m,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(m){return this.transform.locationPoint(c.L.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.pointLocation(c.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,r,o){if(m==="mouseenter"||m==="mouseover"){let h=!1;return{layer:r,listener:o,delegates:{mousemove:y=>{const w=this.getLayer(r)?this.queryRenderedFeatures(y.point,{layers:[r]}):[];w.length?h||(h=!0,o.call(this,new Yn(m,this,y.originalEvent,{features:w}))):h=!1},mouseout:()=>{h=!1}}}}if(m==="mouseleave"||m==="mouseout"){let h=!1;return{layer:r,listener:o,delegates:{mousemove:w=>{(this.getLayer(r)?this.queryRenderedFeatures(w.point,{layers:[r]}):[]).length?h=!0:h&&(h=!1,o.call(this,new Yn(m,this,w.originalEvent)))},mouseout:w=>{h&&(h=!1,o.call(this,new Yn(m,this,w.originalEvent)))}}}}{const h=f=>{const y=this.getLayer(r)?this.queryRenderedFeatures(f.point,{layers:[r]}):[];y.length&&(f.features=y,o.call(this,f),delete f.features)};return{layer:r,listener:o,delegates:{[m]:h}}}}on(m,r,o){if(o===void 0)return super.on(m,r);const h=this._createDelegatedListener(m,r,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(h);for(const f in h.delegates)this.on(f,h.delegates[f]);return this}once(m,r,o){if(o===void 0)return super.once(m,r);const h=this._createDelegatedListener(m,r,o);for(const f in h.delegates)this.once(f,h.delegates[f]);return this}off(m,r,o){return o===void 0?super.off(m,r):(this._delegatedListeners&&this._delegatedListeners[m]&&(h=>{const f=this._delegatedListeners[m];for(let y=0;y<f.length;y++){const w=f[y];if(w.layer===r&&w.listener===o){for(const S in w.delegates)this.off(S,w.delegates[S]);return f.splice(y,1),this}}})(),this)}queryRenderedFeatures(m,r){if(!this.style)return[];let o;const h=m instanceof c.P||Array.isArray(m),f=h?m:[[0,0],[this.transform.width,this.transform.height]];if(r=r||(h?{}:m)||{},f instanceof c.P||typeof f[0]=="number")o=[c.P.convert(f)];else{const y=c.P.convert(f[0]),w=c.P.convert(f[1]);o=[y,new c.P(w.x,y.y),w,new c.P(y.x,w.y),y]}return this.style.queryRenderedFeatures(o,r,this.transform)}querySourceFeatures(m,r){return this.style.querySourceFeatures(m,r)}setStyle(m,r){return(r=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._updateStyle(m,r))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const r=this._locale[m];if(r==null)throw new Error(`Missing UI string '${m}'`);return r}_updateStyle(m,r){if(r.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(m,r));const o=this.style&&r.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new hn(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,r,o):this.style.loadJSON(m,r,o),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new hn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,r){if(typeof m=="string"){const o=this._requestManager.transformRequest(m,Y.Style);c.f(o,(h,f)=>{h?this.fire(new c.j(h)):f&&this._updateDiff(f,r)})}else typeof m=="object"&&this._updateDiff(m,r)}_updateDiff(m,r){try{this.style.setState(m,r)&&this._update(!0)}catch(o){c.w(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(m,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(m,r){return this._lazyInitEmptyStyle(),this.style.addSource(m,r),this._update(!0)}isSourceLoaded(m){const r=this.style&&this.style.sourceCaches[m];if(r!==void 0)return r.loaded();this.fire(new c.j(new Error(`There is no source with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){const r=this.style.sourceCaches[m.source];if(!r)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);for(const o in this.style._layers){const h=this.style._layers[o];h.type==="hillshade"&&h.source===m.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new qd(this.painter,r,m),this.painter.renderToTexture=new pc(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=o=>{o.dataType==="style"?this.terrain.sourceCache.freeRtt():o.dataType==="source"&&o.tile&&(o.sourceId!==m.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(o.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new c.k("terrain",{terrain:m})),this}getTerrain(){var m,r;return(r=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&r!==void 0?r:null}areTilesLoaded(){const m=this.style&&this.style.sourceCaches;for(const r in m){const o=m[r]._tiles;for(const h in o){const f=o[h];if(f.state!=="loaded"&&f.state!=="errored")return!1}}return!0}addSourceType(m,r,o){return this._lazyInitEmptyStyle(),this.style.addSourceType(m,r,o)}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,r,o={}){const{pixelRatio:h=1,sdf:f=!1,stretchX:y,stretchY:w,content:S}=o;if(this._lazyInitEmptyStyle(),!(r instanceof HTMLImageElement||c.a(r))){if(r.width===void 0||r.height===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:k,height:C,data:D}=r,P=r;return this.style.addImage(m,{data:new c.R({width:k,height:C},new Uint8Array(D)),pixelRatio:h,stretchX:y,stretchY:w,content:S,sdf:f,version:0,userImage:P}),P.onAdd&&P.onAdd(this,m),this}}{const{width:k,height:C,data:D}=c.h.getImageData(r);this.style.addImage(m,{data:new c.R({width:k,height:C},D),pixelRatio:h,stretchX:y,stretchY:w,content:S,sdf:f,version:0})}}updateImage(m,r){const o=this.style.getImage(m);if(!o)return this.fire(new c.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const h=r instanceof HTMLImageElement||c.a(r)?c.h.getImageData(r):r,{width:f,height:y,data:w}=h;if(f===void 0||y===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(f!==o.data.width||y!==o.data.height)return this.fire(new c.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const S=!(r instanceof HTMLImageElement||c.a(r));return o.data.replace(w,S),this.style.updateImage(m,o),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new c.j(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,r){ie.getImage(this._requestManager.transformRequest(m,Y.Image),r)}listImages(){return this.style.listImages()}addLayer(m,r){return this._lazyInitEmptyStyle(),this.style.addLayer(m,r),this._update(!0)}moveLayer(m,r){return this.style.moveLayer(m,r),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,r,o){return this.style.setLayerZoomRange(m,r,o),this._update(!0)}setFilter(m,r,o={}){return this.style.setFilter(m,r,o),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,r,o,h={}){return this.style.setPaintProperty(m,r,o,h),this._update(!0)}getPaintProperty(m,r){return this.style.getPaintProperty(m,r)}setLayoutProperty(m,r,o,h={}){return this.style.setLayoutProperty(m,r,o,h),this._update(!0)}getLayoutProperty(m,r){return this.style.getLayoutProperty(m,r)}setGlyphs(m,r={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,r),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,r,o={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,r,o,h=>{h||this._update(!0)}),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,r={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,r,o=>{o||this._update(!0)}),this}setLight(m,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,r),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(m,r){return this.style.setFeatureState(m,r),this._update()}removeFeatureState(m,r){return this.style.removeFeatureState(m,r),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,r=0;return this._container&&(m=this._container.clientWidth||400,r=this._container.clientHeight||300),[m,r]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map");const r=this._canvasContainer=T.create("div","maplibregl-canvas-container",m);this._interactive&&r.classList.add("maplibregl-interactive"),this._canvas=T.create("canvas","maplibregl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const o=this._containerDimensions(),h=this._getClampedPixelRatio(o[0],o[1]);this._resizeCanvas(o[0],o[1],h);const f=this._controlContainer=T.create("div","maplibregl-control-container",m),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{y[w]=T.create("div",`maplibregl-ctrl-${w} `,f)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=T.create("div","maplibregl-cooperative-gesture-screen",this._container);let m=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(m=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${m}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){T.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(m,r,o){this._canvas.width=Math.floor(o*m),this._canvas.height=Math.floor(o*r),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${r}px`}_setupPainter(){const m={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let r=null;this._canvas.addEventListener("webglcontextcreationerror",h=>{r={requestedAttributes:m},h&&(r.statusMessage=h.statusMessage,r.type=h.type)},{once:!0});const o=this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m);if(!o){const h="Failed to initialize WebGL";throw r?(r.message=h,new Error(JSON.stringify(r))):new Error(h)}this.painter=new Ha(o,this.transform),z.testSupport(o)}_onCooperativeGesture(m,r,o){return!r&&o<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){const r=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let o=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const f=this.transform.zoom,y=c.h.now();this.style.zoomHistory.update(f,y);const w=new c.a8(f,{now:y,fadeDuration:r,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),S=w.crossFadingFactor();S===1&&S===this._crossFadingFactor||(o=!0,this._crossFadingFactor=S),this.style.update(w)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,r,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:r,showPadding:this.showPadding}),this.fire(new c.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.bg.mark(c.bh.load),this.fire(new c.k("load"))),this.style&&(this.style.hasTransitions()||o)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const h=this._sourcesDirty||this._styleDirty||this._placementDirty;return h||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.k("idle")),!this._loaded||this._fullyLoaded||h||(this._fullyLoaded=!0,c.bg.mark(c.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ie.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();const r=this.painter.context.gl.getExtension("WEBGL_lose_context");r&&r.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),T.remove(this._canvasContainer),T.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),c.bg.clearMetrics(),this._removed=!0,this.fire(new c.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=c.h.frame(m=>{c.bg.frame(m),this._frame=null,this._render(m)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return Et}getCameraTargetElevation(){return this.transform.elevation}},Rr.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{const r=this._map.getZoom(),o=r===this._map.getMaxZoom(),h=r===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())},this._rotateCompassArrow=()=>{const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=r},this._setButtonTitle=(r,o)=>{const h=this._map._getUIString(`NavigationControl.${o}`);r.title=h,r.setAttribute("aria-label",h)},this.options=c.e({},Gu,m),this._container=T.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",r=>this._map.zoomIn({},{originalEvent:r})),T.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",r=>this._map.zoomOut({},{originalEvent:r})),T.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",r=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:r}):this._map.resetNorth({},{originalEvent:r})}),this._compassIcon=T.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Zu(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){T.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,r){const o=T.create("button",m,this._container);return o.type="button",o.addEventListener("click",r),o}},Rr.GeolocateControl=class extends c.E{constructor(m){super(),this._onSuccess=r=>{if(this._map){if(this._isOutOfMapMaxBounds(r))return this._setErrorState(),this.fire(new c.k("outofmaxbounds",r)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=r,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(r),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(r),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.k("geolocate",r)),this._finish()}},this._updateCamera=r=>{const o=new c.L(r.coords.longitude,r.coords.latitude),h=r.coords.accuracy,f=this._map.getBearing(),y=c.e({bearing:f},this.options.fitBoundsOptions),w=ar.fromLngLat(o,h);this._map.fitBounds(w,y,{geolocateSource:!0})},this._updateMarker=r=>{if(r){const o=new c.L(r.coords.longitude,r.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=r.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=r=>{if(this._map){if(this.options.trackUserLocation)if(r.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(r.code===3&&Do)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.k("error",r)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=r=>{if(this._map){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=T.create("button","maplibregl-ctrl-geolocate",this._container),T.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",r===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=T.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ka({element:this._dotElement}),this._circleElement=T.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ka({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.k("trackuserlocationend")))})}},this.options=c.e({},ki,m)}onAdd(m){return this._map=m,this._container=T.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(r,o=!1){Ri===void 0||o?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(h=>{Ri=h.state!=="denied",r(Ri)}).catch(()=>{Ri=!!window.navigator.geolocation,r(Ri)}):(Ri=!!window.navigator.geolocation,r(Ri)):r(Ri)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),T.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,xi=0,Do=!1}_isOutOfMapMaxBounds(m){const r=this._map.getMaxBounds(),o=m.coords;return r&&(o.longitude<r.getWest()||o.longitude>r.getEast()||o.latitude<r.getSouth()||o.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const m=this._map.getBounds(),r=m.getSouthEast(),o=m.getNorthEast(),h=r.distanceTo(o),f=Math.ceil(this._accuracy/(h/this._map._container.clientHeight)*2);this._circleElement.style.width=`${f}px`,this._circleElement.style.height=`${f}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":xi--,Do=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),xi++,xi>1?(m={maximumAge:6e5,timeout:0},Do=!0):(m=this.options.positionOptions,Do=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},Rr.AttributionControl=Kn,Rr.LogoControl=li,Rr.ScaleControl=class{constructor(m){this._onMove=()=>{_l(this._map,this._container,this.options)},this.setUnit=r=>{this.options.unit=r,_l(this._map,this._container,this.options)},this.options=c.e({},yl,m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=T.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){T.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},Rr.FullscreenControl=class extends c.E{constructor(m={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=T.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){T.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const m=this._fullscreenButton=T.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);T.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new c.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},Rr.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=m}onAdd(m){return this._map=m,this._container=T.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=T.create("button","maplibregl-ctrl-terrain",this._container),T.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){T.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},Rr.Popup=class extends c.E{constructor(m){super(),this.remove=()=>(this._content&&T.remove(this._content),this._container&&(T.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new c.k("close")),this),this._onMouseUp=r=>{this._update(r.point)},this._onMouseMove=r=>{this._update(r.point)},this._onDrag=r=>{this._update(r.point)},this._update=r=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=T.create("div","maplibregl-popup",this._map.getContainer()),this._tip=T.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const w of this.options.className.split(" "))this._container.classList.add(w);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Wu(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!r)return;const o=this._pos=this._trackPointer&&r?r:this._map.project(this._lngLat);let h=this.options.anchor;const f=Po(this.options.offset);if(!h){const w=this._container.offsetWidth,S=this._container.offsetHeight;let k;k=o.y+f.bottom.y<S?["top"]:o.y>this._map.transform.height-S?["bottom"]:[],o.x<w/2?k.push("left"):o.x>this._map.transform.width-w/2&&k.push("right"),h=k.length===0?"bottom":k.join("-")}const y=o.add(f[h]).round();T.setTransform(this._container,`${ps[h]} translate(${y.x}px,${y.y}px)`),Gd(this._container,h,"popup")},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(Hu),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=c.L.convert(m),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const r=document.createDocumentFragment(),o=document.createElement("body");let h;for(o.innerHTML=m;h=o.firstChild,h;)r.appendChild(h);return this.setDOMContent(r)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=T.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){this._container&&this._container.classList.add(m)}removeClassName(m){this._container&&this._container.classList.remove(m)}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}_createCloseButton(){this.options.closeButton&&(this._closeButton=T.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Yu);m&&m.focus()}},Rr.Marker=Ka,Rr.Style=hn,Rr.LngLat=c.L,Rr.LngLatBounds=ar,Rr.Point=c.P,Rr.MercatorCoordinate=c.U,Rr.Evented=c.E,Rr.AJAXError=c.bi,Rr.config=c.c,Rr.CanvasSource=ir,Rr.GeoJSONSource=je,Rr.ImageSource=zt,Rr.RasterDEMTileSource=wt,Rr.RasterTileSource=or,Rr.VectorTileSource=Nt,Rr.VideoSource=dr,Rr.setRTLTextPlugin=c.bj,Rr.getRTLTextPluginStatus=c.bk,Rr.prewarm=function(){on().acquire($t)},Rr.clearPrewarmedResources=function(){const m=Zi;m&&(m.isPreloaded()&&m.numActive()===1?(m.release($t),Zi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},Ku.extend(Rr,{isSafari:c.ac,getPerformanceMetrics:c.bg.getPerformanceMetrics}),Rr});var b=p;return b})})(lw);var BM=lw.exports;const Nl=zM(BM);function Zv(i){let e;return n=>{if(n)for(let l in n){let p=e==null?void 0:e[l],v=n[l];p!==v&&i(l,v,p)}else if(e)for(let l in e)i(l,void 0,e[l]);e=n}}function RM(i,...e){let n=[i];for(let l of e)if(l)Array.isArray(l)&&l[0]===i?n.push(...l.slice(1)):n.push(l);else continue;if(n.length!==1)return n.length===2?n[1]:n}function FM(i){return i===!0?["has","point_count"]:i===!1?["!",["has","point_count"]]:void 0}var i_=OM;function OM(i){var e,n,l;if(i){if(Array.isArray(i)){for(e=[],n=i.length,l=0;l<n;l++){var p=i[l];p!=null&&e.push(p)}return e}if(typeof i=="object"){e={};var v=Object.keys(i);for(n=v.length,l=0;l<n;l++){var b=v[l],c=i[b];c!=null&&(e[b]=c)}return e}}}function NM(i,e){Dr(e,!1);const n=An(),l=()=>Ir(_t,"$minZoomContext",n),p=()=>Ir(er,"$maxZoomContext",n),v=()=>Ir(ht,"$layer",n),b=()=>Ir(gt,"$map",n),c=()=>Ir(Ne,"$sourceName",n),E=xt(),T=xt(),z=xt(),B=xt(),$=xt(),q=xt(),Q=xt();let ae=oe(e,"id",8,()=>t_("layer")),ie=oe(e,"source",8,()=>{}),Y=oe(e,"sourceLayer",8,()=>{}),be=oe(e,"beforeId",8,()=>{}),fe=oe(e,"beforeLayerType",8,()=>{}),de=oe(e,"type"),Se=oe(e,"paint",8,()=>{}),Me=oe(e,"layout",8,()=>{}),Ge=oe(e,"filter",8,()=>{}),Ee=oe(e,"applyToClusters",8,()=>{}),Ve=oe(e,"minzoom",8,()=>{}),De=oe(e,"maxzoom",8,()=>{}),qe=oe(e,"manageHoverState",0,!1),Ze=oe(e,"hovered",4,null),Pe=oe(e,"interactive",0,!0),$e=oe(e,"hoverCursor",8,()=>{}),We=oe(e,"eventsIfTopMost",0,!1);const Je=Yh(),{map:gt,source:Ne,self:ht,minzoom:_t,maxzoom:er,eventTopMost:Xt,layerInfo:ar}=ow();au(()=>{var je;v()&&b()&&(ar.delete(v()),(je=b())==null||je.removeLayer(v()))});let dt=xt(void 0),Nt=xt(!0);bt(()=>ze(Ee()),()=>{ot(E,FM(Ee()))}),bt(()=>(ue(E),ze(Ge())),()=>{ot(T,RM("all",ue(E),Ge()))}),bt(()=>(ze(Ve()),l()),()=>{ot(z,Ve()??l())}),bt(()=>(ze(De()),p()),()=>{ot(B,De()??p())}),bt(()=>(ze(ie()),c()),()=>{ot($,ie()||c())}),bt(()=>(b(),v(),ze(ae()),ue($),ze(Pe()),ze(We()),ze(be()),ze(fe()),ze(de()),ze(Y()),ue(T),ze(Se()),ze(Me()),ue(z),ue(B),ze($e()),ze(qe()),ue(dt)),()=>{if(b()&&v()!==ae()&&ue($)){let je=function(zt){var br,pr;if(!Pe()||!v()||!b()||We()&&Xt(zt)!==v())return;let dr=zt.features??[],ir=(pr=(br=dr[0])==null?void 0:br.properties)==null?void 0:pr.cluster_id,$r={event:zt,map:b(),clusterId:ir,layer:v(),source:ue($),features:dr};Je(zt.type,$r)};v()&&ar.delete(v());let Pt=be();if(!be()&&fe()){let zt=b().getStyle().layers,dr=typeof fe()=="function"?fe():$r=>$r.type===fe(),ir=zt==null?void 0:zt.find(dr);ir&&(Pt=ir.id)}Bi(ht,ae()),b().addLayer(i_({id:v(),type:de(),source:ue($),"source-layer":Y(),filter:ue(T),paint:Se(),layout:Me(),minzoom:ue(z),maxzoom:ue(B)}),Pt),ot(Nt,!0),b().on("click",v(),je),b().on("dblclick",v(),je),b().on("contextmenu",v(),je),b().on("mouseenter",v(),zt=>{var br,pr;if(!Pe()||!v()||!b()||We()&&Xt(zt)!==v())return;$e()&&(b().getCanvas().style.cursor=$e());let dr=zt.features??[];Ze(dr[0]??null);let ir=(pr=(br=dr[0])==null?void 0:br.properties)==null?void 0:pr.cluster_id,$r={event:zt,map:b(),clusterId:ir,layer:v(),source:ue($),features:dr};Je("mouseenter",$r)}),b().on("mousemove",v(),zt=>{var br,pr,Kr,ai,Gi,Mi;if(!Pe())return;if(We()&&Xt(zt)!==v()){Ze(null),qe()&&ue(dt)!==void 0&&((br=b())==null||br.setFeatureState({source:ue($),sourceLayer:Y(),id:ue(dt)},{hover:!1}),ot(dt,void 0));return}b().getCanvas().style.cursor=$e();let dr=zt.features??[],ir=(Kr=(pr=dr[0])==null?void 0:pr.properties)==null?void 0:Kr.cluster_id,$r=(ai=dr[0])==null?void 0:ai.id;$r!==ue(dt)&&(qe()&&(ue(dt)!==void 0&&((Gi=b())==null||Gi.setFeatureState({source:ue($),id:ue(dt),sourceLayer:Y()},{hover:!1})),(Mi=b())==null||Mi.setFeatureState({source:ue($),id:$r,sourceLayer:Y()},{hover:!0})),ot(dt,$r),Ze(dr[0]??null)),Je("mousemove",{event:zt,map:b(),clusterId:ir,layer:v(),source:ue($),features:dr})}),b().on("mouseleave",v(),zt=>{var dr;if(!(!Pe()||!v()||!b())){if($e()&&(b().getCanvas().style.cursor=""),Ze(null),qe()&&ue(dt)!==void 0){const ir={source:ue($),id:ue(dt),sourceLayer:Y()};(dr=b())==null||dr.setFeatureState(ir,{hover:!1}),ot(dt,void 0)}Je("mouseleave",{map:b(),layer:v(),source:ue($)})}})}}),bt(()=>(v(),ze(Pe())),()=>{v()&&ar.set(v(),{interactive:Pe()})}),bt(()=>(v(),b()),()=>{ot(q,v()?Zv((je,Pt)=>{var zt;return(zt=b())==null?void 0:zt.setPaintProperty(v(),je,Pt)}):void 0)}),bt(()=>(v(),b()),()=>{ot(Q,v()?Zv((je,Pt)=>{var zt;return(zt=b())==null?void 0:zt.setLayoutProperty(v(),je,Pt)}):void 0)}),bt(()=>(ue(q),ze(Se())),()=>{var je;(je=ue(q))==null||je(Se())}),bt(()=>(ue(Q),ze(Me())),()=>{var je;(je=ue(Q))==null||je(Me())}),bt(()=>(v(),b(),ue(z),ue(B)),()=>{var je;v()&&((je=b())==null||je.setLayerZoomRange(v(),ue(z),ue(B)))}),bt(()=>(v(),ue(Nt),b(),ue(T)),()=>{var je;v()&&(ue(Nt)?ot(Nt,!1):(je=b())==null||je.setFilter(v(),ue(T)))}),gi(),Lr();var or=rr(),wt=mt(or);hr(wt,v,je=>{var Pt=rr(),zt=mt(Pt);bb(zt,v,dr=>{var ir=rr(),$r=mt(ir);cr($r,Zr(e),{},null),xe(dr,ir)}),xe(je,Pt)}),xe(i,or),Pr()}function UM(i,e){Dr(e,!1);let n=oe(e,"id",8,()=>t_("fill")),l=oe(e,"source",8,()=>{}),p=oe(e,"sourceLayer",8,()=>{}),v=oe(e,"beforeId",8,()=>{}),b=oe(e,"beforeLayerType",8,()=>{}),c=oe(e,"paint"),E=oe(e,"layout",8,()=>{}),T=oe(e,"filter",8,()=>{}),z=oe(e,"minzoom",8,()=>{}),B=oe(e,"maxzoom",8,()=>{}),$=oe(e,"hoverCursor",8,()=>{}),q=oe(e,"manageHoverState",0,!1),Q=oe(e,"hovered",4,null),ae=oe(e,"eventsIfTopMost",0,!1),ie=oe(e,"interactive",0,!0);Lr(),NM(i,{get id(){return n()},type:"fill",get source(){return l()},get sourceLayer(){return p()},get beforeId(){return v()},get beforeLayerType(){return b()},get paint(){return c()},get layout(){return E()},get filter(){return T()},get minzoom(){return z()},get maxzoom(){return B()},get hoverCursor(){return $()},get manageHoverState(){return q()},get eventsIfTopMost(){return ae()},get interactive(){return ie()},get hovered(){return Q()},set hovered(Y){Q(Y)},$$events:{click(Y){Xe.call(this,e,Y)},dblclick(Y){Xe.call(this,e,Y)},contextmenu(Y){Xe.call(this,e,Y)},mouseenter(Y){Xe.call(this,e,Y)},mousemove(Y){Xe.call(this,e,Y)},mouseleave(Y){Xe.call(this,e,Y)}},children:(Y,be)=>{var fe=rr(),de=mt(fe);cr(de,Zr(e),{},null),xe(Y,fe)},$$slots:{default:!0},$$legacy:!0}),Pr()}function $M(i,e){Dr(e,!1);const n=An(),l=()=>Ir(p,"$map",n),{map:p}=sd();let v=oe(e,"position",0,"top-left"),b=oe(e,"container",8,()=>{}),c=xt(null);au(()=>{var E;(E=l())!=null&&E.loaded()&&ue(c)&&l().removeControl(ue(c))}),bt(()=>(l(),ue(c),ze(b()),ze(v())),()=>{if(l()&&!ue(c)){let E;typeof b()=="string"?E=document.querySelector(b())??void 0:E=b(),ot(c,new Nl.FullscreenControl({container:E})),l().addControl(ue(c),v())}}),gi(),Lr(),Pr()}function VM(i,e,n,l,p){let v=!1;i.getSource(e)&&(v=!0,i.removeSource(e));const b=()=>{l(e)&&(i.addSource(e,n),p())};if(v){const c=()=>{e&&(i.getSource(e)?setTimeout(c,1):b())};c()}else b()}function jM(i,e,n){tI().then(()=>{let l=rI(i);if(!l)return;l.getSource(e)===n&&l.removeSource(e)})}function qM(i,e){Dr(e,!1);const n=An(),l=()=>Ir(p,"$map",n),{map:p}=sd();let v=oe(e,"position",0,"top-left"),b=oe(e,"positionOptions",8,()=>{}),c=oe(e,"fitBoundsOptions",8,()=>{}),E=oe(e,"trackUserLocation",0,!1),T=oe(e,"showAccuracyCircle",0,!0),z=oe(e,"showUserLocation",0,!0),B=xt(null);au(()=>{var $;($=l())!=null&&$.loaded()&&ue(B)&&l().removeControl(ue(B))}),bt(()=>(l(),ue(B),ze(b()),ze(c()),ze(E()),ze(T()),ze(z()),ze(v())),()=>{l()&&!ue(B)&&(ot(B,new Nl.GeolocateControl({positionOptions:b(),fitBoundsOptions:c(),trackUserLocation:E(),showAccuracyCircle:T(),showUserLocation:z()})),l().addControl(ue(B),v()))}),gi(),Lr(),Pr()}function GM(i,e){Dr(e,!1);const n=An(),l=()=>Ir(T,"$map",n),p=()=>Ir(z,"$source",n);let v=oe(e,"data"),b=oe(e,"idCol"),c=oe(e,"sourceLayer",8,()=>{}),E=xt(new Set);const{map:T,source:z}=ow();bt(()=>(ze(v()),l(),p(),ze(b()),ue(E),ze(c())),()=>{if(v()&&l()&&p()){let B=new Set;for(const $ of v()){const q=$[b()];if(!q)continue;ue(E).delete(q),B.add(q);const Q={id:q,source:p(),sourceLayer:c()},ae=l().getFeatureState(Q);let ie=!1;for(const Y of Object.keys($))if(ae[Y]!==$[Y]){ie=!0;break}ie&&l().setFeatureState(Q,$)}for(const $ of ue(E)){const q={id:$,source:p(),sourceLayer:c()},Q=l().getFeatureState(q);for(const ae of Object.keys(Q))l().removeFeatureState(q,ae)}ot(E,B)}}),gi(),Lr(),Pr()}function ZM(i){let e=i.getCenter(),n=Math.round(i.getZoom()*100)/100,l=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),p=Math.pow(10,l),v=Math.round(e.lat*p)/p,b=Math.round(e.lng*p)/p,c=`${n}/${v}/${b}`,E=i.getBearing(),T=i.getPitch();return(E||T)&&(c+=`/${Math.round(E*10)/10}`),T&&(c+=`/${Math.round(T)}`),`#${c}`}function WM(i){return i.replace("#","").split("/").map(parseFloat)}var If=n_;function n_(i,e){return i===e||i!==i&&e!==e?!0:typeof i!=typeof e||{}.toString.call(i)!={}.toString.call(e)||i!==Object(i)||!i?!1:Array.isArray(i)?Wv(i,e):{}.toString.call(i)=="[object Set]"?Wv(Array.from(i),Array.from(e)):{}.toString.call(i)=="[object Object]"?YM(i,e):HM(i,e)}function HM(i,e){return i.toString()===e.toString()}function Wv(i,e){var n=i.length;if(n!=e.length)return!1;for(var l=0;l<n;l++)if(!n_(i[l],e[l]))return!1;return!0}function YM(i,e){var n=Object.keys(i),l=n.length;if(l!=Object.keys(e).length)return!1;for(var p=0;p<l;p++){var v=n[p];if(!(e.hasOwnProperty(v)&&n_(i[v],e[v])))return!1}return!0}function KM(i,e){Dr(e,!1);const n=An(),l=()=>Ir(p,"$map",n),{map:p}=sd();let v=oe(e,"position",0,"top-left"),b=oe(e,"showCompass",0,!0),c=oe(e,"showZoom",0,!0),E=oe(e,"visualizePitch",0,!1),T=xt(null);au(()=>{var z;(z=l())!=null&&z.loaded()&&ue(T)&&l().removeControl(ue(T))}),bt(()=>(l(),ue(T),ze(b()),ze(c()),ze(E()),ze(v())),()=>{l()&&!ue(T)&&(ot(T,new Nl.NavigationControl({showCompass:b(),showZoom:c(),visualizePitch:E()})),l().addControl(ue(T),v()))}),gi(),Lr(),Pr()}function XM(i,e){Dr(e,!1);const n=An(),l=()=>Ir(p,"$map",n),{map:p}=sd();let v=oe(e,"position",0,"bottom-left"),b=oe(e,"maxWidth",8,()=>{}),c=oe(e,"unit",0,"metric"),E=xt(null);au(()=>{var T;(T=l())!=null&&T.loaded()&&ue(E)&&l().removeControl(ue(E))}),bt(()=>(l(),ue(E),ze(b()),ze(c()),ze(v())),()=>{l()&&!ue(E)&&(ot(E,new Nl.ScaleControl({maxWidth:b(),unit:c()})),l().addControl(ue(E),v()))}),gi(),Lr(),Pr()}var JM=rt("<!> <!> <!> <!>",1),QM=rt("<!> <!>",1),e3=rt("<div><!></div>");function t3(i,e){Dr(e,!1);const n=An(),l=()=>Ir(We,"$mapInstance",n),p=()=>Ir(Je,"$loadedImages",n),v=xt(),b=xt();let c=oe(e,"map",4,null),E=oe(e,"class",8,()=>{}),T=oe(e,"style"),z=oe(e,"diffStyleUpdates",0,!1),B=oe(e,"center",12,()=>{}),$=oe(e,"zoom",12,()=>{}),q=oe(e,"pitch",4,0),Q=oe(e,"bearing",4,0),ae=oe(e,"bounds",12,()=>{}),ie=oe(e,"hash",0,!1),Y=oe(e,"loaded",4,!1),be=oe(e,"minZoom",0,0),fe=oe(e,"maxZoom",0,22),de=oe(e,"zoomOnDoubleClick",0,!0),Se=oe(e,"interactive",0,!0),Me=oe(e,"attributionControl",0,!0),Ge=oe(e,"cooperativeGestures",0,!1),Ee=oe(e,"preserveDrawingBuffer",0,!1),Ve=oe(e,"maxBounds",8,()=>{}),De=oe(e,"images",8,()=>[]),qe=oe(e,"standardControls",0,!1),Ze=oe(e,"filterLayers",8,()=>{}),Pe=oe(e,"transformRequest",8,()=>{});const $e=Yh(),{map:We,loadedImages:Je}=DM();let gt=new Set;function Ne(wt){var je;(je=l())!=null&&je.loaded()&&("url"in wt?(gt.add(wt.id),l().loadImage(wt.url,(Pt,zt)=>{var dr;gt.delete(wt.id),Pt?$e("error",Pt):zt&&((dr=l())==null||dr.addImage(wt.id,zt,wt.options),p().add(wt.id),Bi(Je,p()))})):(l().addImage(wt.id,wt.data,wt.options),p().add(wt.id),Bi(Je,p())))}let ht=xt(void 0),_t=xt(void 0),er=xt(void 0),Xt=xt(void 0);function ar(wt){if(ie()){let je=WM(window.location.hash);je.length>=3&&($(je[0]),B([je[2],je[1]])),je.length==5&&(Q(je[3]),q(je[4]))}return Bi(We,new Nl.Map(i_({container:wt,style:T(),center:B(),zoom:$(),pitch:q(),bearing:Q(),minZoom:be(),maxZoom:fe(),interactive:Se(),preserveDrawingBuffer:Ee(),maxBounds:Ve(),bounds:ae(),attributionControl:Me(),transformRequest:Pe(),cooperativeGestures:Ge()}))),l().on("load",je=>{Y(!0),$e("load",l())}),l().on("error",je=>$e("error",{...je,map:l()})),l().on("movestart",je=>$e("movestart",{...je,map:l()})),l().on("moveend",je=>{if(B(je.target.getCenter()),$(je.target.getZoom()),ae(je.target.getBounds()),$e("moveend",{...je,map:l()}),ie()){let Pt=window.location.href.replace(/(#.+)?$/,ZM(l()));window.history.replaceState(window.history.state,"",Pt)}}),l().on("zoomstart",je=>$e("zoomstart",{...je,map:l()})),l().on("zoom",je=>{$(je.target.getZoom()),$e("zoom",{...je,map:l()})}),l().on("zoomend",je=>{$(je.target.getZoom()),$e("zoomend",{...je,map:l()})}),l().on("style.load",()=>{if(l()){const je=l().getStyle();if(ot(ht,je.layers.map(Pt=>Pt.id)),ot(_t,Object.keys(je.sources)),ue(Xt))for(const[Pt,zt]of Object.entries(ue(Xt)))l().addSource(Pt,zt);if(ue(er))for(const Pt of ue(er))l().addLayer(Pt)}}),l().on("styledata",je=>{if(l()&&Ze()){const Pt=l().getStyle().layers;if(Pt)for(let zt of Pt)Ze()(zt)||l().setLayoutProperty(zt.id,"visibility","none")}$e("styledata",{...je,map:l()})}),{destroy(){var je;Y(!1),(je=l())==null||je.remove(),Bi(We,null)}}}let dt=xt(T());bt(()=>ze(qe()),()=>{ot(v,typeof qe()=="boolean"?void 0:qe())}),bt(()=>l(),()=>{c(l())}),bt(()=>(ze(Y()),l(),ze(De())),()=>{var wt;if(Y()&&((wt=l())!=null&&wt.loaded()))for(let je of De())!gt.has(je.id)&&!l().hasImage(je.id)&&Ne(je)}),bt(()=>(ze(De()),p()),()=>{ot(b,De().every(wt=>p().has(wt.id)))}),bt(()=>(l(),ze(T()),ue(dt),ue(ht),ue(_t),ze(z())),()=>{if(l()&&!If(T(),ue(dt))){const wt=l().getStyle();if(ue(ht)&&ot(er,wt.layers.filter(je=>!ue(ht).includes(je.id))),ue(_t)){const je=Object.keys(wt.sources).filter(Pt=>!ue(_t).includes(Pt));ot(Xt,{});for(const Pt of je)Lh(Xt,ue(Xt)[Pt]=wt.sources[Pt])}ot(dt,T()),l().setStyle(T(),{diff:z()})}}),bt(()=>(ze(B()),l()),()=>{var wt,je;B()&&!If(B(),(wt=l())==null?void 0:wt.getCenter())&&((je=l())==null||je.panTo(B()))}),bt(()=>(ze($()),l()),()=>{var wt,je;$()&&!If($(),(wt=l())==null?void 0:wt.getZoom())&&((je=l())==null||je.zoomTo($()))}),bt(()=>(ze(ae()),l()),()=>{var wt,je;ae()&&!If(ae(),(wt=l())==null?void 0:wt.getBounds())&&((je=l())==null||je.fitBounds(ae()))}),bt(()=>(ze(de()),l()),()=>{var wt,je;de()?(wt=l())==null||wt.doubleClickZoom.enable():(je=l())==null||je.doubleClickZoom.disable()}),gi(),Lr();var Nt=e3(),or=ct(Nt);hr(or,()=>l()&&Y(),wt=>{var je=QM(),Pt=mt(je);hr(Pt,qe,dr=>{var ir=JM(),$r=mt(ir);KM($r,{get position(){return ue(v)},$$legacy:!0});var br=Ae(Ae($r,!0));qM(br,{get position(){return ue(v)},fitBoundsOptions:{maxZoom:12},$$legacy:!0});var pr=Ae(Ae(br,!0));$M(pr,{get position(){return ue(v)},$$legacy:!0});var Kr=Ae(Ae(pr,!0));XM(Kr,{get position(){return ue(v)},$$legacy:!0}),xe(dr,ir)});var zt=Ae(Ae(Pt,!0));cr(zt,Zr(e),{get map(){return l()},get loadedImages(){return p()},get allImagesLoaded(){return ue(b)}},null),xe(wt,je)}),ut(Nt),Ct(()=>{kn(Nt,`${E()??""} svelte-p00lfq`),dI(Nt,"expand-map",!E())}),Ho(Nt,wt=>ar(wt)),xe(i,Nt),Pr()}const r3=Math.sqrt(50),i3=Math.sqrt(10),n3=Math.sqrt(2);function Rp(i,e,n){const l=(e-i)/Math.max(0,n),p=Math.floor(Math.log10(l)),v=l/Math.pow(10,p),b=v>=r3?10:v>=i3?5:v>=n3?2:1;let c,E,T;return p<0?(T=Math.pow(10,-p)/b,c=Math.round(i*T),E=Math.round(e*T),c/T<i&&++c,E/T>e&&--E,T=-T):(T=Math.pow(10,p)*b,c=Math.round(i/T),E=Math.round(e/T),c*T<i&&++c,E*T>e&&--E),E<c&&.5<=n&&n<2?Rp(i,e,n*2):[c,E,T]}function s3(i,e,n){if(e=+e,i=+i,n=+n,!(n>0))return[];if(i===e)return[i];const l=e<i,[p,v,b]=l?Rp(e,i,n):Rp(i,e,n);if(!(v>=p))return[];const c=v-p+1,E=new Array(c);if(l)if(b<0)for(let T=0;T<c;++T)E[T]=(v-T)/-b;else for(let T=0;T<c;++T)E[T]=(v-T)*b;else if(b<0)for(let T=0;T<c;++T)E[T]=(p+T)/-b;else for(let T=0;T<c;++T)E[T]=(p+T)*b;return E}function ny(i,e,n){return e=+e,i=+i,n=+n,Rp(i,e,n)[2]}function a3(i,e,n){e=+e,i=+i,n=+n;const l=e<i,p=l?ny(e,i,n):ny(i,e,n);return(l?-1:1)*(p<0?1/-p:p)}var ns=(i,e,n)=>new Promise((l,p)=>{var v=E=>{try{c(n.next(E))}catch(T){p(T)}},b=E=>{try{c(n.throw(E))}catch(T){p(T)}},c=E=>E.done?l(E.value):Promise.resolve(E.value).then(v,b);c((n=n.apply(i,e)).next())}),Ps=Uint8Array,Bh=Uint16Array,o3=Int32Array,uw=new Ps([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),hw=new Ps([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),l3=new Ps([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),dw=function(i,e){for(var n=new Bh(31),l=0;l<31;++l)n[l]=e+=1<<i[l-1];for(var p=new o3(n[30]),l=1;l<30;++l)for(var v=n[l];v<n[l+1];++v)p[v]=v-n[l]<<5|l;return{b:n,r:p}},fw=dw(uw,2),pw=fw.b,c3=fw.r;pw[28]=258,c3[258]=28;var u3=dw(hw,0),h3=u3.b,mw=new Bh(32768);for(Yr=0;Yr<32768;++Yr)oo=(Yr&43690)>>1|(Yr&21845)<<1,oo=(oo&52428)>>2|(oo&13107)<<2,oo=(oo&61680)>>4|(oo&3855)<<4,mw[Yr]=((oo&65280)>>8|(oo&255)<<8)>>1;var oo,Yr,Rh=function(i,e,n){for(var l=i.length,p=0,v=new Bh(e);p<l;++p)i[p]&&++v[i[p]-1];var b=new Bh(e);for(p=1;p<e;++p)b[p]=b[p-1]+v[p-1]<<1;var c;{c=new Bh(1<<e);var E=15-e;for(p=0;p<l;++p)if(i[p])for(var T=p<<4|i[p],z=e-i[p],B=b[i[p]-1]++<<z,$=B|(1<<z)-1;B<=$;++B)c[mw[B]>>E]=T}return c},ad=new Ps(288);for(Yr=0;Yr<144;++Yr)ad[Yr]=8;var Yr;for(Yr=144;Yr<256;++Yr)ad[Yr]=9;var Yr;for(Yr=256;Yr<280;++Yr)ad[Yr]=7;var Yr;for(Yr=280;Yr<288;++Yr)ad[Yr]=8;var Yr,gw=new Ps(32);for(Yr=0;Yr<32;++Yr)gw[Yr]=5;var Yr,d3=Rh(ad,9),f3=Rh(gw,5),kg=function(i){for(var e=i[0],n=1;n<i.length;++n)i[n]>e&&(e=i[n]);return e},ca=function(i,e,n){var l=e/8|0;return(i[l]|i[l+1]<<8)>>(e&7)&n},Ag=function(i,e){var n=e/8|0;return(i[n]|i[n+1]<<8|i[n+2]<<16)>>(e&7)},p3=function(i){return(i+7)/8|0},m3=function(i,e,n){(n==null||n>i.length)&&(n=i.length);var l=new Ps(n-e);return l.set(i.subarray(e,n)),l},g3=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Cs=function(i,e,n){var l=new Error(e||g3[i]);if(l.code=i,Error.captureStackTrace&&Error.captureStackTrace(l,Cs),!n)throw l;return l},s_=function(i,e,n,l){var p=i.length,v=0;if(!p||e.f&&!e.l)return n||new Ps(0);var b=!n||e.i!=2,c=e.i;n||(n=new Ps(p*3));var E=function(zt){var dr=n.length;if(zt>dr){var ir=new Ps(Math.max(dr*2,zt));ir.set(n),n=ir}},T=e.f||0,z=e.p||0,B=e.b||0,$=e.l,q=e.d,Q=e.m,ae=e.n,ie=p*8;do{if(!$){T=ca(i,z,1);var Y=ca(i,z+1,3);if(z+=3,Y)if(Y==1)$=d3,q=f3,Q=9,ae=5;else if(Y==2){var Se=ca(i,z,31)+257,Me=ca(i,z+10,15)+4,Ge=Se+ca(i,z+5,31)+1;z+=14;for(var Ee=new Ps(Ge),Ve=new Ps(19),De=0;De<Me;++De)Ve[l3[De]]=ca(i,z+De*3,7);z+=Me*3;for(var qe=kg(Ve),Ze=(1<<qe)-1,Pe=Rh(Ve,qe),De=0;De<Ge;){var $e=Pe[ca(i,z,Ze)];z+=$e&15;var be=$e>>4;if(be<16)Ee[De++]=be;else{var We=0,Je=0;for(be==16?(Je=3+ca(i,z,3),z+=2,We=Ee[De-1]):be==17?(Je=3+ca(i,z,7),z+=3):be==18&&(Je=11+ca(i,z,127),z+=7);Je--;)Ee[De++]=We}}var gt=Ee.subarray(0,Se),Ne=Ee.subarray(Se);Q=kg(gt),ae=kg(Ne),$=Rh(gt,Q),q=Rh(Ne,ae)}else Cs(1);else{var be=p3(z)+4,fe=i[be-4]|i[be-3]<<8,de=be+fe;if(de>p){c&&Cs(0);break}b&&E(B+fe),n.set(i.subarray(be,de),B),e.b=B+=fe,e.p=z=de*8,e.f=T;continue}if(z>ie){c&&Cs(0);break}}b&&E(B+131072);for(var ht=(1<<Q)-1,_t=(1<<ae)-1,er=z;;er=z){var We=$[Ag(i,z)&ht],Xt=We>>4;if(z+=We&15,z>ie){c&&Cs(0);break}if(We||Cs(2),Xt<256)n[B++]=Xt;else if(Xt==256){er=z,$=null;break}else{var ar=Xt-254;if(Xt>264){var De=Xt-257,dt=uw[De];ar=ca(i,z,(1<<dt)-1)+pw[De],z+=dt}var Nt=q[Ag(i,z)&_t],or=Nt>>4;Nt||Cs(3),z+=Nt&15;var Ne=h3[or];if(or>3){var dt=hw[or];Ne+=Ag(i,z)&(1<<dt)-1,z+=dt}if(z>ie){c&&Cs(0);break}b&&E(B+131072);var wt=B+ar;if(B<Ne){var je=v-Ne,Pt=Math.min(Ne,wt);for(je+B<0&&Cs(3);B<Pt;++B)n[B]=l[je+B]}for(;B<wt;B+=4)n[B]=n[B-Ne],n[B+1]=n[B+1-Ne],n[B+2]=n[B+2-Ne],n[B+3]=n[B+3-Ne];B=wt}}e.l=$,e.p=er,e.b=B,e.f=T,$&&(T=1,e.m=Q,e.d=q,e.n=ae)}while(!T);return B==n.length?n:m3(n,0,B)},y3=new Ps(0),_3=function(i){(i[0]!=31||i[1]!=139||i[2]!=8)&&Cs(6,"invalid gzip data");var e=i[3],n=10;e&4&&(n+=(i[10]|i[11]<<8)+2);for(var l=(e>>3&1)+(e>>4&1);l>0;l-=!i[n++]);return n+(e&2)},v3=function(i){var e=i.length;return(i[e-4]|i[e-3]<<8|i[e-2]<<16|i[e-1]<<24)>>>0},b3=function(i,e){return((i[0]&15)!=8||i[0]>>4>7||(i[0]<<8|i[1])%31)&&Cs(6,"invalid zlib data"),(i[1]>>5&1)==+!e&&Cs(6,"invalid zlib data: "+(i[1]&32?"need":"unexpected")+" dictionary"),(i[1]>>3&4)+2};function x3(i,e){return s_(i,{i:2},e,e)}function w3(i,e){var n=_3(i);return n+8>i.length&&Cs(6,"invalid gzip data"),s_(i.subarray(n,-8),{i:2},new Ps(v3(i)),e)}function S3(i,e){return s_(i.subarray(b3(i,e),-4),{i:2},e,e)}function sy(i,e){return i[0]==31&&i[1]==139&&i[2]==8?w3(i,e):(i[0]&15)!=8||i[0]>>4>7||(i[0]<<8|i[1])%31?x3(i,e):S3(i,e)}var I3=typeof TextDecoder<"u"&&new TextDecoder,T3=0;try{I3.decode(y3,{stream:!0}),T3=1}catch{}var yw=(i,e)=>i*Math.pow(2,e),xh=(i,e)=>Math.floor(i/Math.pow(2,e)),Fp=(i,e)=>yw(i.getUint16(e+1,!0),8)+i.getUint8(e),_w=(i,e)=>yw(i.getUint32(e+2,!0),16)+i.getUint16(e,!0),k3=(i,e,n,l,p)=>{if(i!=l.getUint8(p))return i-l.getUint8(p);const v=Fp(l,p+1);if(e!=v)return e-v;const b=Fp(l,p+4);return n!=b?n-b:0},A3=(i,e,n,l)=>{const p=vw(i,e|128,n,l);return p?{z:e,x:n,y:l,offset:p[0],length:p[1],is_dir:!0}:null},Hv=(i,e,n,l)=>{const p=vw(i,e,n,l);return p?{z:e,x:n,y:l,offset:p[0],length:p[1],is_dir:!1}:null},vw=(i,e,n,l)=>{let p=0,v=i.byteLength/17-1;for(;p<=v;){const b=v+p>>1,c=k3(e,n,l,i,b*17);if(c>0)p=b+1;else if(c<0)v=b-1;else return[_w(i,b*17+7),i.getUint32(b*17+13,!0)]}return null},E3=(i,e)=>i.is_dir&&!e.is_dir?1:!i.is_dir&&e.is_dir?-1:i.z!==e.z?i.z-e.z:i.x!==e.x?i.x-e.x:i.y-e.y,bw=(i,e)=>{const n=i.getUint8(e*17);return{z:n&127,x:Fp(i,e*17+1),y:Fp(i,e*17+4),offset:_w(i,e*17+7),length:i.getUint32(e*17+13,!0),is_dir:n>>7===1}},Yv=i=>{const e=[],n=new DataView(i);for(let l=0;l<n.byteLength/17;l++)e.push(bw(n,l));return C3(e)},C3=i=>{i.sort(E3);const e=new ArrayBuffer(17*i.length),n=new Uint8Array(e);for(let l=0;l<i.length;l++){const p=i[l];let v=p.z;p.is_dir&&(v=v|128),n[l*17]=v,n[l*17+1]=p.x&255,n[l*17+2]=p.x>>8&255,n[l*17+3]=p.x>>16&255,n[l*17+4]=p.y&255,n[l*17+5]=p.y>>8&255,n[l*17+6]=p.y>>16&255,n[l*17+7]=p.offset&255,n[l*17+8]=xh(p.offset,8)&255,n[l*17+9]=xh(p.offset,16)&255,n[l*17+10]=xh(p.offset,24)&255,n[l*17+11]=xh(p.offset,32)&255,n[l*17+12]=xh(p.offset,48)&255,n[l*17+13]=p.length&255,n[l*17+14]=p.length>>8&255,n[l*17+15]=p.length>>16&255,n[l*17+16]=p.length>>24&255}return e},M3=(i,e)=>{if(i.byteLength<17)return null;const n=i.byteLength/17,l=bw(i,n-1);if(l.is_dir){const p=l.z,v=e.z-p,b=Math.trunc(e.x/(1<<v)),c=Math.trunc(e.y/(1<<v));return{z:p,x:b,y:c}}return null};function D3(i){return ns(this,null,function*(){const e=yield i.getBytes(0,512e3),n=new DataView(e.data),l=n.getUint32(4,!0),p=n.getUint16(8,!0),v=new TextDecoder("utf-8"),b=JSON.parse(v.decode(new DataView(e.data,10,l)));let c=0;b.compression==="gzip"&&(c=2);let E=0;"minzoom"in b&&(E=+b.minzoom);let T=0;"maxzoom"in b&&(T=+b.maxzoom);let z=0,B=0,$=0,q=-180,Q=-85,ae=180,ie=85;if(b.bounds){const be=b.bounds.split(",");q=+be[0],Q=+be[1],ae=+be[2],ie=+be[3]}if(b.center){const be=b.center.split(",");z=+be[0],B=+be[1],$=+be[2]}return{specVersion:n.getUint16(2,!0),rootDirectoryOffset:10+l,rootDirectoryLength:p*17,jsonMetadataOffset:10,jsonMetadataLength:l,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:c,tileType:1,minZoom:E,maxZoom:T,minLon:q,minLat:Q,maxLon:ae,maxLat:ie,centerZoom:$,centerLon:z,centerLat:B,etag:e.etag}})}function P3(i,e,n,l,p,v,b){return ns(this,null,function*(){let c=yield n.getArrayBuffer(e,i.rootDirectoryOffset,i.rootDirectoryLength,i);i.specVersion===1&&(c=Yv(c));const E=Hv(new DataView(c),l,p,v);if(E){let B=(yield e.getBytes(E.offset,E.length,b)).data;const $=new DataView(B);return $.getUint8(0)==31&&$.getUint8(1)==139&&(B=sy(new Uint8Array(B))),{data:B}}const T=M3(new DataView(c),{z:l,x:p,y:v});if(T){const z=A3(new DataView(c),T.z,T.x,T.y);if(z){let B=yield n.getArrayBuffer(e,z.offset,z.length,i);i.specVersion===1&&(B=Yv(B));const $=Hv(new DataView(B),l,p,v);if($){let Q=(yield e.getBytes($.offset,$.length,b)).data;const ae=new DataView(Q);return ae.getUint8(0)==31&&ae.getUint8(1)==139&&(Q=sy(new Uint8Array(Q))),{data:Q}}}}})}var xw={getHeader:D3,getZxy:P3},L3=class{constructor(){this.tile=(i,e)=>{if(i.type=="json"){const n=i.url.substr(10);let l=this.tiles.get(n);return l||(l=new Kv(n),this.tiles.set(n,l)),l.getHeader().then(p=>{const v={tiles:[i.url+"/{z}/{x}/{y}"],minzoom:p.minZoom,maxzoom:p.maxZoom,bounds:[p.minLon,p.minLat,p.maxLon,p.maxLat]};e(null,v,null,null)}).catch(p=>{e(p,null,null,null)}),{cancel:()=>{}}}else{const n=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),l=i.url.match(n);if(!l)throw new Error("Invalid PMTiles protocol URL");const p=l[1];let v=this.tiles.get(p);v||(v=new Kv(p),this.tiles.set(p,v));const b=l[2],c=l[3],E=l[4],T=new AbortController,z=T.signal;let B=()=>{T.abort()};return v.getHeader().then($=>{v.getZxy(+b,+c,+E,z).then(q=>{q?e(null,new Uint8Array(q.data),q.cacheControl,q.expires):$.tileType==1?e(null,new Uint8Array,null,null):e(null,null,null,null)}).catch(q=>{q.name!=="AbortError"&&e(q,null,null,null)})}),{cancel:B}}},this.tiles=new Map}add(i){this.tiles.set(i.source.getKey(),i)}get(i){return this.tiles.get(i)}};function Ac(i,e){return(e>>>0)*4294967296+(i>>>0)}function z3(i,e){const n=e.buf;let l,p;if(p=n[e.pos++],l=(p&112)>>4,p<128||(p=n[e.pos++],l|=(p&127)<<3,p<128)||(p=n[e.pos++],l|=(p&127)<<10,p<128)||(p=n[e.pos++],l|=(p&127)<<17,p<128)||(p=n[e.pos++],l|=(p&127)<<24,p<128)||(p=n[e.pos++],l|=(p&1)<<31,p<128))return Ac(i,l);throw new Error("Expected varint not more than 10 bytes")}function wh(i){const e=i.buf;let n,l;return l=e[i.pos++],n=l&127,l<128||(l=e[i.pos++],n|=(l&127)<<7,l<128)||(l=e[i.pos++],n|=(l&127)<<14,l<128)||(l=e[i.pos++],n|=(l&127)<<21,l<128)?n:(l=e[i.pos],n|=(l&15)<<28,z3(n,i))}function B3(i,e,n,l){if(l==0){n==1&&(e[0]=i-1-e[0],e[1]=i-1-e[1]);const p=e[0];e[0]=e[1],e[1]=p}}var R3=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function F3(i,e,n){if(i>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Math.pow(2,i)-1||n>Math.pow(2,i)-1)throw Error("tile x/y outside zoom level bounds");const l=R3[i],p=Math.pow(2,i);let v=0,b=0,c=0;const E=[e,n];let T=p/2;for(;T>0;)v=(E[0]&T)>0?1:0,b=(E[1]&T)>0?1:0,c+=T*T*(3*v^b),B3(T,E,v,b),T=T/2;return l+c}function ww(i,e){return ns(this,null,function*(){if(e===1||e===0)return i;if(e===2){if(typeof globalThis.DecompressionStream>"u")return sy(new Uint8Array(i));{let l=new Response(i).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(l).arrayBuffer()}}else throw Error("Compression method not supported")})}var O3=127;function N3(i,e){let n=0,l=i.length-1;for(;n<=l;){const p=l+n>>1,v=e-i[p].tileId;if(v>0)n=p+1;else if(v<0)l=p-1;else return i[p]}return l>=0&&(i[l].runLength===0||e-i[l].tileId<i[l].runLength)?i[l]:null}var U3=class{constructor(i,e=new Headers){this.url=i,this.customHeaders=e}getKey(){return this.url}setHeaders(i){this.customHeaders=i}getBytes(i,e,n){return ns(this,null,function*(){let l;n||(l=new AbortController,n=l.signal);const p=new Headers(this.customHeaders);p.set("Range","bytes="+i+"-"+(i+e-1));let v=yield fetch(this.url,{signal:n,headers:p});if(v.status===416&&i===0){const E=v.headers.get("Content-Range");if(!E||!E.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const T=+E.substr(8);v=yield fetch(this.url,{signal:n,headers:{Range:"bytes=0-"+(T-1)}})}if(v.status>=300)throw Error("Bad response code: "+v.status);const b=v.headers.get("Content-Length");if(v.status===200&&(!b||+b>e))throw l&&l.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield v.arrayBuffer(),etag:v.headers.get("ETag")||void 0,cacheControl:v.headers.get("Cache-Control")||void 0,expires:v.headers.get("Expires")||void 0}})}};function ua(i,e){const n=i.getUint32(e+4,!0),l=i.getUint32(e+0,!0);return n*Math.pow(2,32)+l}function $3(i,e){const n=new DataView(i),l=n.getUint8(7);if(l>3)throw Error(`Archive is spec version ${l} but this library supports up to spec version 3`);return{specVersion:l,rootDirectoryOffset:ua(n,8),rootDirectoryLength:ua(n,16),jsonMetadataOffset:ua(n,24),jsonMetadataLength:ua(n,32),leafDirectoryOffset:ua(n,40),leafDirectoryLength:ua(n,48),tileDataOffset:ua(n,56),tileDataLength:ua(n,64),numAddressedTiles:ua(n,72),numTileEntries:ua(n,80),numTileContents:ua(n,88),clustered:n.getUint8(96)===1,internalCompression:n.getUint8(97),tileCompression:n.getUint8(98),tileType:n.getUint8(99),minZoom:n.getUint8(100),maxZoom:n.getUint8(101),minLon:n.getInt32(102,!0)/1e7,minLat:n.getInt32(106,!0)/1e7,maxLon:n.getInt32(110,!0)/1e7,maxLat:n.getInt32(114,!0)/1e7,centerZoom:n.getUint8(118),centerLon:n.getInt32(119,!0)/1e7,centerLat:n.getInt32(123,!0)/1e7,etag:e}}function Sw(i){const e={buf:new Uint8Array(i),pos:0},n=wh(e),l=[];let p=0;for(let v=0;v<n;v++){const b=wh(e);l.push({tileId:p+b,offset:0,length:0,runLength:1}),p+=b}for(let v=0;v<n;v++)l[v].runLength=wh(e);for(let v=0;v<n;v++)l[v].length=wh(e);for(let v=0;v<n;v++){const b=wh(e);b===0&&v>0?l[v].offset=l[v-1].offset+l[v-1].length:l[v].offset=b-1}return l}function V3(i){const e=new DataView(i);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var $c=class extends Error{};function j3(i,e,n,l){return ns(this,null,function*(){const p=yield i.getBytes(0,16384);if(new DataView(p.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(V3(p.data)<3)return[yield xw.getHeader(i)];const b=p.data.slice(0,O3);let c=p.etag;l&&p.etag!=l&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+i.getKey()),c=void 0);const E=$3(b,c);if(n){const T=p.data.slice(E.rootDirectoryOffset,E.rootDirectoryOffset+E.rootDirectoryLength),z=i.getKey()+"|"+(E.etag||"")+"|"+E.rootDirectoryOffset+"|"+E.rootDirectoryLength,B=Sw(yield e(T,E.internalCompression));return[E,[z,B.length,B]]}return[E,void 0]})}function q3(i,e,n,l,p){return ns(this,null,function*(){const v=yield i.getBytes(n,l);if(p.etag&&p.etag!==v.etag)throw new $c(v.etag);const b=yield e(v.data,p.internalCompression),c=Sw(b);if(c.length===0)throw new Error("Empty directory is invalid");return c})}var G3=class{constructor(i=100,e=!0,n=ww){this.cache=new Map,this.maxCacheEntries=i,this.counter=1,this.prefetch=e,this.decompress=n}getHeader(i,e){return ns(this,null,function*(){const n=i.getKey();if(this.cache.has(n))return this.cache.get(n).lastUsed=this.counter++,yield this.cache.get(n).data;const l=new Promise((p,v)=>{j3(i,this.decompress,this.prefetch,e).then(b=>{b[1]&&this.cache.set(b[1][0],{lastUsed:this.counter++,data:Promise.resolve(b[1][2])}),p(b[0]),this.prune()}).catch(b=>{v(b)})});return this.cache.set(n,{lastUsed:this.counter++,data:l}),l})}getDirectory(i,e,n,l){return ns(this,null,function*(){const p=i.getKey()+"|"+(l.etag||"")+"|"+e+"|"+n;if(this.cache.has(p))return this.cache.get(p).lastUsed=this.counter++,yield this.cache.get(p).data;const v=new Promise((b,c)=>{q3(i,this.decompress,e,n,l).then(E=>{b(E),this.prune()}).catch(E=>{c(E)})});return this.cache.set(p,{lastUsed:this.counter++,data:v}),v})}getArrayBuffer(i,e,n,l){return ns(this,null,function*(){const p=i.getKey()+"|"+(l.etag||"")+"|"+e+"|"+n;if(this.cache.has(p))return this.cache.get(p).lastUsed=this.counter++,yield this.cache.get(p).data;const v=new Promise((b,c)=>{i.getBytes(e,n).then(E=>{if(l.etag&&l.etag!==E.etag)throw new $c(E.etag);b(E.data),this.cache.has(p),this.prune()}).catch(E=>{c(E)})});return this.cache.set(p,{lastUsed:this.counter++,data:v}),v})}prune(){if(this.cache.size>=this.maxCacheEntries){let i=1/0,e;this.cache.forEach((n,l)=>{n.lastUsed<i&&(i=n.lastUsed,e=l)}),e&&this.cache.delete(e)}}invalidate(i,e){return ns(this,null,function*(){this.cache.delete(i.getKey()),yield this.getHeader(i,e)})}},Kv=class{constructor(i,e,n){typeof i=="string"?this.source=new U3(i):this.source=i,n?this.decompress=n:this.decompress=ww,e?this.cache=e:this.cache=new G3}getHeader(){return ns(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(i,e,n,l){return ns(this,null,function*(){const p=F3(i,e,n),v=yield this.cache.getHeader(this.source);if(v.specVersion<3)return xw.getZxy(v,this.source,this.cache,i,e,n,l);if(i<v.minZoom||i>v.maxZoom)return;let b=v.rootDirectoryOffset,c=v.rootDirectoryLength;for(let E=0;E<=3;E++){const T=yield this.cache.getDirectory(this.source,b,c,v),z=N3(T,p);if(z)if(z.runLength>0){const B=yield this.source.getBytes(v.tileDataOffset+z.offset,z.length,l);if(v.etag&&v.etag!==B.etag)throw new $c(B.etag);return{data:yield this.decompress(B.data,v.tileCompression),cacheControl:B.cacheControl,expires:B.expires}}else b=v.leafDirectoryOffset+z.offset,c=z.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(i,e,n,l){return ns(this,null,function*(){try{return yield this.getZxyAttempt(i,e,n,l)}catch(p){if(p instanceof $c)return this.cache.invalidate(this.source,p.message),yield this.getZxyAttempt(i,e,n,l);throw p}})}getMetadataAttempt(){return ns(this,null,function*(){const i=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(i.jsonMetadataOffset,i.jsonMetadataLength);if(i.etag&&i.etag!==e.etag)throw new $c(e.etag);const n=yield this.decompress(e.data,i.internalCompression),l=new TextDecoder("utf-8");return JSON.parse(l.decode(n))})}getMetadata(){return ns(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(i){if(i instanceof $c)return this.cache.invalidate(this.source,i.message),yield this.getMetadataAttempt();throw i}})}};function Z3(i,e){Dr(e,!1);const n=An(),l=()=>Ir(T,"$map",n),p=()=>Ir(z,"$source",n);let v=oe(e,"id",8,()=>t_("vector")),b=oe(e,"url",0,null),c=oe(e,"tiles",0,null),E=oe(e,"promoteId",0,null);if(b()&&b().includes("pmtiles://")&&!Nl.config.REGISTERED_PROTOCOLS.hasOwnProperty("pmtiles")){let Q=new L3;Nl.addProtocol("pmtiles",Q.tile)}const{map:T,self:z}=PM();let B=xt();au(()=>{p()&&l()&&(jM(T,p(),ue(B)),Bi(z,null),ot(B,void 0))}),bt(()=>(l(),p(),ze(v()),ze(b()),ze(c()),ze(E())),()=>{l()&&p()!==v()&&(Bi(z,v()),VM(l(),p(),i_({type:"vector",url:b(),tiles:c(),promoteId:E()}),Q=>l()&&Q===p(),()=>{var Q;p()&&ot(B,(Q=l())==null?void 0:Q.getSource(p()))}))}),bt(()=>(l(),ze(v())),()=>{var Q;(Q=l())==null||Q.on("style.load",()=>{var ae;ot(B,(ae=l())==null?void 0:ae.getSource(v()))})}),gi(),Lr();var $=rr(),q=mt($);hr(q,p,Q=>{var ae=rr(),ie=mt(ae);bb(ie,p,Y=>{var be=rr(),fe=mt(be);cr(fe,Zr(e),{},null),xe(Y,be)}),xe(Q,ae)}),xe(i,$),Pr()}var W3=rt("<!> <!>",1);function a_(i,e){Dr(e,!1);const n=An(),l=()=>Ir(qy,"$previewMetricMapColors",n);let p=xt(!0),v=xt(),b=oe(e,"mapInstance",4);Gy.subscribe(z=>{ot(v,z),ot(p,!1),setTimeout(()=>ot(p,!0),0)});function c(z){b(z.detail.map)}Lr();var E=rr(),T=mt(E);hr(T,()=>ue(p),z=>{Wo(t3(z,{style:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",standardControls:!0,center:[0,53],zoom:2,$$events:{load:c},children:(B,$)=>{Z3(B,{get url(){return ue(v)},promoteId:"GEO_ID",children:(q,Q)=>{var ae=W3(),ie=mt(ae);UM(ie,{paint:{"fill-color":["coalesce",["feature-state","color"],"#102020"],"fill-opacity":.7},sourceLayer:"geoms",manageHoverState:!0,$$legacy:!0});var Y=Ae(Ae(ie,!0));GM(Y,{get data(){return l()},idCol:"GEO_ID",sourceLayer:"geoms",$$legacy:!0}),xe(q,ae)},$$slots:{default:!0},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0}),B=>b(B),()=>b())}),xe(i,E),Pr()}var H3=rt('<div><h2 class="font-large text-lg text-gray-500 lg:text-xl dark:text-gray-500"><p>Pick country...</p></h2> <!></div>'),Y3=rt('<div slot="sidebar"><div><!> <!> <!></div></div>'),K3=rt('<div slot="map"><!></div>');function X3(i,e){Dr(e,!1);const n=An(),l=()=>Ir(Ap,"$selectedCountry",n),p=()=>Ir(Kg,"$countries",n);function v(c){Bi(Ap,c),console.log("Selected country: ",l()),Bi(Kp,{kind:"level"})}let b=xt();Kh(async()=>{Bi(qy,[]),Bi(Pl,[]),Bi(Ep,[])}),Lr(),my(i,{$$slots:{sidebar:(c,E)=>{var T=Y3(),z=ct(T),B=ct(z);sw(B);var $=Ae(Ae(B,!0));da($,{children:(Q,ae)=>{var ie=H3(),Y=ct(ie);ct(Y),ut(Y);var be=Ae(Ae(Y,!0));nw(be,{color:"grey",size:"lg",class:"text-grey ms-2 h-6 w-6 dark:text-gray-500",$$legacy:!0}),ut(ie),xe(Q,ie)},$$slots:{default:!0},$$legacy:!0});var q=Ae(Ae($,!0));Qy(q,{placement:"right-start",children:(Q,ae)=>{var ie=rr(),Y=mt(ie);Fa(Y,1,p,Ra,(be,fe,de)=>{e_(be,{$$events:{click:()=>v(Ni(fe).country_name_short_en)},children:(Se,Me)=>{Or();var Ge=bs();Ct(()=>Ei(Ge,Ni(fe).country_name_short_en)),xe(Se,Ge)},$$slots:{default:!0},$$legacy:!0})}),xe(Q,ie)},$$slots:{default:!0},$$legacy:!0}),ut(z),ut(T),xe(c,T)},map:(c,E)=>{var T=K3(),z=ct(T);a_(z,{get mapInstance(){return ue(b)},set mapInstance(B){ot(b,B)},$$legacy:!0}),ut(T),xe(c,T)}},$$legacy:!0}),Pr()}function J3(i){return new Worker(""+new URL("../workers/rust_worker-BnFFgvex.js",import.meta.url).href,{type:"module",name:i==null?void 0:i.name})}function Q3(i){return new Worker(""+new URL("../workers/duckdb_worker-DqZfXcIA.js",import.meta.url).href,{type:"module",name:i==null?void 0:i.name})}var eD=rt('<div id="search-input-cont" class="svelte-s9ylj0"><input type="text" id="search-field" placeholder="Enter Search Term" autocomplete="off" class="svelte-s9ylj0"></div>');function Xv(i,e){let n=oe(e,"searchTerm",4);var l=eD(),p=ct(l);fy(p),ut(l),py(p,n,v=>n(v)),Qe("input",p,function(v){Xe.call(this,e,v)}),xe(i,l)}var tD=rt("ID",1),rD=rt("Name",1),iD=rt("Column",1),nD=rt("Year",1),sD=rt("Selected metrics",1),aD=rt("<!> <!> <!> <!> <!>",1),oD=rt("Remove",1),lD=rt("<!> <!> <!> <!> <!>",1),cD=rt("<!> <!>",1),uD=rt("<div><!></div>");function hD(i,e){Dr(e,!1);const n=An(),l=()=>Ir(Pl,"$selectedMetricsList",n);function p(c){console.log(c);const E=l().indexOf(c);E>-1&&l().splice(E,1),Bi(Pl,[...l()])}Lr();var v=uD(),b=ct(v);Pp(b,{children:(c,E)=>{var T=cD(),z=mt(T);Bp(z,{children:($,q)=>{var Q=aD(),ae=mt(Q);Ds(ae,{children:(de,Se)=>{Or();var Me=tD();xe(de,Me)},$$slots:{default:!0},$$legacy:!0});var ie=Ae(Ae(ae,!0));Ds(ie,{children:(de,Se)=>{Or();var Me=rD();xe(de,Me)},$$slots:{default:!0},$$legacy:!0});var Y=Ae(Ae(ie,!0));Ds(Y,{children:(de,Se)=>{Or();var Me=iD();xe(de,Me)},$$slots:{default:!0},$$legacy:!0});var be=Ae(Ae(Y,!0));Ds(be,{children:(de,Se)=>{Or();var Me=nD();xe(de,Me)},$$slots:{default:!0},$$legacy:!0});var fe=Ae(Ae(be,!0));Ds(fe,{children:(de,Se)=>{Or();var Me=sD();xe(de,Me)},$$slots:{default:!0},$$legacy:!0}),xe($,Q)},$$slots:{default:!0},$$legacy:!0});var B=Ae(Ae(z,!0));Lp(B,{tableBodyClass:"divide-y",children:($,q)=>{var Q=rr(),ae=mt(Q);Fa(ae,1,l,Ra,(ie,Y,be)=>{zp(ie,{children:(fe,de)=>{var Se=lD(),Me=mt(Se);Hs(Me,{children:(qe,Ze)=>{Or();var Pe=bs();Ct(()=>Ei(Pe,Ni(Y).metric_id.slice(0,8))),xe(qe,Pe)},$$slots:{default:!0},$$legacy:!0});var Ge=Ae(Ae(Me,!0));Hs(Ge,{class:"max-w-md whitespace-normal break-words border-b border-gray-200 px-2 py-2",children:(qe,Ze)=>{Or();var Pe=bs();Ct(()=>Ei(Pe,Ni(Y).metric_human_readable_name)),xe(qe,Pe)},$$slots:{default:!0},$$legacy:!0});var Ee=Ae(Ae(Ge,!0));Hs(Ee,{children:(qe,Ze)=>{Or();var Pe=bs();Ct(()=>Ei(Pe,Ni(Y).metric_parquet_column_name)),xe(qe,Pe)},$$slots:{default:!0},$$legacy:!0});var Ve=Ae(Ae(Ee,!0));Hs(Ve,{children:(qe,Ze)=>{Or();var Pe=bs();Ct(()=>Ei(Pe,Ni(Y).source_data_release_collection_period_start.slice(0,4))),xe(qe,Pe)},$$slots:{default:!0},$$legacy:!0});var De=Ae(Ae(Ve,!0));Hs(De,{children:(qe,Ze)=>{da(qe,{color:"light",$$events:{click:()=>p(Ni(Y))},children:(Pe,$e)=>{Or();var We=oD();xe(Pe,We)},$$slots:{default:!0},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0}),xe(fe,Se)},$$slots:{default:!0},$$legacy:!0})}),xe($,Q)},$$slots:{default:!0},$$legacy:!0}),xe(c,T)},$$slots:{default:!0},$$legacy:!0}),ut(v),xe(i,v),Pr()}function dD(i,e){switch(arguments.length){case 0:break;case 1:{typeof i=="function"?this.interpolator(i):this.range(i);break}default:{this.domain(i),typeof e=="function"?this.interpolator(e):this.range(e);break}}return this}function o_(i,e,n){i.prototype=e.prototype=n,n.constructor=i}function Iw(i,e){var n=Object.create(i.prototype);for(var l in e)n[l]=e[l];return n}function od(){}var Zh=.7,Op=1/Zh,Yc="\\s*([+-]?\\d+)\\s*",Wh="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Oa="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",fD=/^#([0-9a-f]{3,8})$/,pD=new RegExp(`^rgb\\(${Yc},${Yc},${Yc}\\)$`),mD=new RegExp(`^rgb\\(${Oa},${Oa},${Oa}\\)$`),gD=new RegExp(`^rgba\\(${Yc},${Yc},${Yc},${Wh}\\)$`),yD=new RegExp(`^rgba\\(${Oa},${Oa},${Oa},${Wh}\\)$`),_D=new RegExp(`^hsl\\(${Wh},${Oa},${Oa}\\)$`),vD=new RegExp(`^hsla\\(${Wh},${Oa},${Oa},${Wh}\\)$`),Jv={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};o_(od,Hh,{copy(i){return Object.assign(new this.constructor,this,i)},displayable(){return this.rgb().displayable()},hex:Qv,formatHex:Qv,formatHex8:bD,formatHsl:xD,formatRgb:eb,toString:eb});function Qv(){return this.rgb().formatHex()}function bD(){return this.rgb().formatHex8()}function xD(){return Tw(this).formatHsl()}function eb(){return this.rgb().formatRgb()}function Hh(i){var e,n;return i=(i+"").trim().toLowerCase(),(e=fD.exec(i))?(n=e[1].length,e=parseInt(e[1],16),n===6?tb(e):n===3?new xs(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Tf(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Tf(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=pD.exec(i))?new xs(e[1],e[2],e[3],1):(e=mD.exec(i))?new xs(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=gD.exec(i))?Tf(e[1],e[2],e[3],e[4]):(e=yD.exec(i))?Tf(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=_D.exec(i))?nb(e[1],e[2]/100,e[3]/100,1):(e=vD.exec(i))?nb(e[1],e[2]/100,e[3]/100,e[4]):Jv.hasOwnProperty(i)?tb(Jv[i]):i==="transparent"?new xs(NaN,NaN,NaN,0):null}function tb(i){return new xs(i>>16&255,i>>8&255,i&255,1)}function Tf(i,e,n,l){return l<=0&&(i=e=n=NaN),new xs(i,e,n,l)}function wD(i){return i instanceof od||(i=Hh(i)),i?(i=i.rgb(),new xs(i.r,i.g,i.b,i.opacity)):new xs}function ay(i,e,n,l){return arguments.length===1?wD(i):new xs(i,e,n,l??1)}function xs(i,e,n,l){this.r=+i,this.g=+e,this.b=+n,this.opacity=+l}o_(xs,ay,Iw(od,{brighter(i){return i=i==null?Op:Math.pow(Op,i),new xs(this.r*i,this.g*i,this.b*i,this.opacity)},darker(i){return i=i==null?Zh:Math.pow(Zh,i),new xs(this.r*i,this.g*i,this.b*i,this.opacity)},rgb(){return this},clamp(){return new xs(zl(this.r),zl(this.g),zl(this.b),Np(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:rb,formatHex:rb,formatHex8:SD,formatRgb:ib,toString:ib}));function rb(){return`#${Ml(this.r)}${Ml(this.g)}${Ml(this.b)}`}function SD(){return`#${Ml(this.r)}${Ml(this.g)}${Ml(this.b)}${Ml((isNaN(this.opacity)?1:this.opacity)*255)}`}function ib(){const i=Np(this.opacity);return`${i===1?"rgb(":"rgba("}${zl(this.r)}, ${zl(this.g)}, ${zl(this.b)}${i===1?")":`, ${i})`}`}function Np(i){return isNaN(i)?1:Math.max(0,Math.min(1,i))}function zl(i){return Math.max(0,Math.min(255,Math.round(i)||0))}function Ml(i){return i=zl(i),(i<16?"0":"")+i.toString(16)}function nb(i,e,n,l){return l<=0?i=e=n=NaN:n<=0||n>=1?i=e=NaN:e<=0&&(i=NaN),new fa(i,e,n,l)}function Tw(i){if(i instanceof fa)return new fa(i.h,i.s,i.l,i.opacity);if(i instanceof od||(i=Hh(i)),!i)return new fa;if(i instanceof fa)return i;i=i.rgb();var e=i.r/255,n=i.g/255,l=i.b/255,p=Math.min(e,n,l),v=Math.max(e,n,l),b=NaN,c=v-p,E=(v+p)/2;return c?(e===v?b=(n-l)/c+(n<l)*6:n===v?b=(l-e)/c+2:b=(e-n)/c+4,c/=E<.5?v+p:2-v-p,b*=60):c=E>0&&E<1?0:b,new fa(b,c,E,i.opacity)}function ID(i,e,n,l){return arguments.length===1?Tw(i):new fa(i,e,n,l??1)}function fa(i,e,n,l){this.h=+i,this.s=+e,this.l=+n,this.opacity=+l}o_(fa,ID,Iw(od,{brighter(i){return i=i==null?Op:Math.pow(Op,i),new fa(this.h,this.s,this.l*i,this.opacity)},darker(i){return i=i==null?Zh:Math.pow(Zh,i),new fa(this.h,this.s,this.l*i,this.opacity)},rgb(){var i=this.h%360+(this.h<0)*360,e=isNaN(i)||isNaN(this.s)?0:this.s,n=this.l,l=n+(n<.5?n:1-n)*e,p=2*n-l;return new xs(Eg(i>=240?i-240:i+120,p,l),Eg(i,p,l),Eg(i<120?i+240:i-120,p,l),this.opacity)},clamp(){return new fa(sb(this.h),kf(this.s),kf(this.l),Np(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const i=Np(this.opacity);return`${i===1?"hsl(":"hsla("}${sb(this.h)}, ${kf(this.s)*100}%, ${kf(this.l)*100}%${i===1?")":`, ${i})`}`}}));function sb(i){return i=(i||0)%360,i<0?i+360:i}function kf(i){return Math.max(0,Math.min(1,i||0))}function Eg(i,e,n){return(i<60?e+(n-e)*i/60:i<180?n:i<240?e+(n-e)*(240-i)/60:e)*255}const l_=i=>()=>i;function TD(i,e){return function(n){return i+n*e}}function kD(i,e,n){return i=Math.pow(i,n),e=Math.pow(e,n)-i,n=1/n,function(l){return Math.pow(i+l*e,n)}}function AD(i){return(i=+i)==1?kw:function(e,n){return n-e?kD(e,n,i):l_(isNaN(e)?n:e)}}function kw(i,e){var n=e-i;return n?TD(i,n):l_(isNaN(i)?e:i)}const ab=function i(e){var n=AD(e);function l(p,v){var b=n((p=ay(p)).r,(v=ay(v)).r),c=n(p.g,v.g),E=n(p.b,v.b),T=kw(p.opacity,v.opacity);return function(z){return p.r=b(z),p.g=c(z),p.b=E(z),p.opacity=T(z),p+""}}return l.gamma=i,l}(1);function ED(i,e){e||(e=[]);var n=i?Math.min(e.length,i.length):0,l=e.slice(),p;return function(v){for(p=0;p<n;++p)l[p]=i[p]*(1-v)+e[p]*v;return l}}function CD(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function MD(i,e){var n=e?e.length:0,l=i?Math.min(n,i.length):0,p=new Array(l),v=new Array(n),b;for(b=0;b<l;++b)p[b]=c_(i[b],e[b]);for(;b<n;++b)v[b]=e[b];return function(c){for(b=0;b<l;++b)v[b]=p[b](c);return v}}function DD(i,e){var n=new Date;return i=+i,e=+e,function(l){return n.setTime(i*(1-l)+e*l),n}}function oy(i,e){return i=+i,e=+e,function(n){return i*(1-n)+e*n}}function PD(i,e){var n={},l={},p;(i===null||typeof i!="object")&&(i={}),(e===null||typeof e!="object")&&(e={});for(p in e)p in i?n[p]=c_(i[p],e[p]):l[p]=e[p];return function(v){for(p in n)l[p]=n[p](v);return l}}var ly=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Cg=new RegExp(ly.source,"g");function LD(i){return function(){return i}}function zD(i){return function(e){return i(e)+""}}function BD(i,e){var n=ly.lastIndex=Cg.lastIndex=0,l,p,v,b=-1,c=[],E=[];for(i=i+"",e=e+"";(l=ly.exec(i))&&(p=Cg.exec(e));)(v=p.index)>n&&(v=e.slice(n,v),c[b]?c[b]+=v:c[++b]=v),(l=l[0])===(p=p[0])?c[b]?c[b]+=p:c[++b]=p:(c[++b]=null,E.push({i:b,x:oy(l,p)})),n=Cg.lastIndex;return n<e.length&&(v=e.slice(n),c[b]?c[b]+=v:c[++b]=v),c.length<2?E[0]?zD(E[0].x):LD(e):(e=E.length,function(T){for(var z=0,B;z<e;++z)c[(B=E[z]).i]=B.x(T);return c.join("")})}function c_(i,e){var n=typeof e,l;return e==null||n==="boolean"?l_(e):(n==="number"?oy:n==="string"?(l=Hh(e))?(e=l,ab):BD:e instanceof Hh?ab:e instanceof Date?DD:CD(e)?ED:Array.isArray(e)?MD:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?PD:oy)(i,e)}function RD(i,e){return i=+i,e=+e,function(n){return Math.round(i*(1-n)+e*n)}}function Aw(i){return i}function FD(i){return Math.abs(i=Math.round(i))>=1e21?i.toLocaleString("en").replace(/,/g,""):i.toString(10)}function Up(i,e){if((n=(i=e?i.toExponential(e-1):i.toExponential()).indexOf("e"))<0)return null;var n,l=i.slice(0,n);return[l.length>1?l[0]+l.slice(2):l,+i.slice(n+1)]}function su(i){return i=Up(Math.abs(i)),i?i[1]:NaN}function OD(i,e){return function(n,l){for(var p=n.length,v=[],b=0,c=i[0],E=0;p>0&&c>0&&(E+c+1>l&&(c=Math.max(1,l-E)),v.push(n.substring(p-=c,p+c)),!((E+=c+1)>l));)c=i[b=(b+1)%i.length];return v.reverse().join(e)}}function ND(i){return function(e){return e.replace(/[0-9]/g,function(n){return i[+n]})}}var UD=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function $p(i){if(!(e=UD.exec(i)))throw new Error("invalid format: "+i);var e;return new u_({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}$p.prototype=u_.prototype;function u_(i){this.fill=i.fill===void 0?" ":i.fill+"",this.align=i.align===void 0?">":i.align+"",this.sign=i.sign===void 0?"-":i.sign+"",this.symbol=i.symbol===void 0?"":i.symbol+"",this.zero=!!i.zero,this.width=i.width===void 0?void 0:+i.width,this.comma=!!i.comma,this.precision=i.precision===void 0?void 0:+i.precision,this.trim=!!i.trim,this.type=i.type===void 0?"":i.type+""}u_.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function $D(i){e:for(var e=i.length,n=1,l=-1,p;n<e;++n)switch(i[n]){case".":l=p=n;break;case"0":l===0&&(l=n),p=n;break;default:if(!+i[n])break e;l>0&&(l=0);break}return l>0?i.slice(0,l)+i.slice(p+1):i}var Ew;function VD(i,e){var n=Up(i,e);if(!n)return i+"";var l=n[0],p=n[1],v=p-(Ew=Math.max(-8,Math.min(8,Math.floor(p/3)))*3)+1,b=l.length;return v===b?l:v>b?l+new Array(v-b+1).join("0"):v>0?l.slice(0,v)+"."+l.slice(v):"0."+new Array(1-v).join("0")+Up(i,Math.max(0,e+v-1))[0]}function ob(i,e){var n=Up(i,e);if(!n)return i+"";var l=n[0],p=n[1];return p<0?"0."+new Array(-p).join("0")+l:l.length>p+1?l.slice(0,p+1)+"."+l.slice(p+1):l+new Array(p-l.length+2).join("0")}const lb={"%":(i,e)=>(i*100).toFixed(e),b:i=>Math.round(i).toString(2),c:i=>i+"",d:FD,e:(i,e)=>i.toExponential(e),f:(i,e)=>i.toFixed(e),g:(i,e)=>i.toPrecision(e),o:i=>Math.round(i).toString(8),p:(i,e)=>ob(i*100,e),r:ob,s:VD,X:i=>Math.round(i).toString(16).toUpperCase(),x:i=>Math.round(i).toString(16)};function cb(i){return i}var ub=Array.prototype.map,hb=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function jD(i){var e=i.grouping===void 0||i.thousands===void 0?cb:OD(ub.call(i.grouping,Number),i.thousands+""),n=i.currency===void 0?"":i.currency[0]+"",l=i.currency===void 0?"":i.currency[1]+"",p=i.decimal===void 0?".":i.decimal+"",v=i.numerals===void 0?cb:ND(ub.call(i.numerals,String)),b=i.percent===void 0?"%":i.percent+"",c=i.minus===void 0?"−":i.minus+"",E=i.nan===void 0?"NaN":i.nan+"";function T(B){B=$p(B);var $=B.fill,q=B.align,Q=B.sign,ae=B.symbol,ie=B.zero,Y=B.width,be=B.comma,fe=B.precision,de=B.trim,Se=B.type;Se==="n"?(be=!0,Se="g"):lb[Se]||(fe===void 0&&(fe=12),de=!0,Se="g"),(ie||$==="0"&&q==="=")&&(ie=!0,$="0",q="=");var Me=ae==="$"?n:ae==="#"&&/[boxX]/.test(Se)?"0"+Se.toLowerCase():"",Ge=ae==="$"?l:/[%p]/.test(Se)?b:"",Ee=lb[Se],Ve=/[defgprs%]/.test(Se);fe=fe===void 0?6:/[gprs]/.test(Se)?Math.max(1,Math.min(21,fe)):Math.max(0,Math.min(20,fe));function De(qe){var Ze=Me,Pe=Ge,$e,We,Je;if(Se==="c")Pe=Ee(qe)+Pe,qe="";else{qe=+qe;var gt=qe<0||1/qe<0;if(qe=isNaN(qe)?E:Ee(Math.abs(qe),fe),de&&(qe=$D(qe)),gt&&+qe==0&&Q!=="+"&&(gt=!1),Ze=(gt?Q==="("?Q:c:Q==="-"||Q==="("?"":Q)+Ze,Pe=(Se==="s"?hb[8+Ew/3]:"")+Pe+(gt&&Q==="("?")":""),Ve){for($e=-1,We=qe.length;++$e<We;)if(Je=qe.charCodeAt($e),48>Je||Je>57){Pe=(Je===46?p+qe.slice($e+1):qe.slice($e))+Pe,qe=qe.slice(0,$e);break}}}be&&!ie&&(qe=e(qe,1/0));var Ne=Ze.length+qe.length+Pe.length,ht=Ne<Y?new Array(Y-Ne+1).join($):"";switch(be&&ie&&(qe=e(ht+qe,ht.length?Y-Pe.length:1/0),ht=""),q){case"<":qe=Ze+qe+Pe+ht;break;case"=":qe=Ze+ht+qe+Pe;break;case"^":qe=ht.slice(0,Ne=ht.length>>1)+Ze+qe+Pe+ht.slice(Ne);break;default:qe=ht+Ze+qe+Pe;break}return v(qe)}return De.toString=function(){return B+""},De}function z(B,$){var q=T((B=$p(B),B.type="f",B)),Q=Math.max(-8,Math.min(8,Math.floor(su($)/3)))*3,ae=Math.pow(10,-Q),ie=hb[8+Q/3];return function(Y){return q(ae*Y)+ie}}return{format:T,formatPrefix:z}}var Af,Cw,Mw;qD({thousands:",",grouping:[3],currency:["$",""]});function qD(i){return Af=jD(i),Cw=Af.format,Mw=Af.formatPrefix,Af}function GD(i){return Math.max(0,-su(Math.abs(i)))}function ZD(i,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(su(e)/3)))*3-su(Math.abs(i)))}function WD(i,e){return i=Math.abs(i),e=Math.abs(e)-i,Math.max(0,su(e)-su(i))+1}function HD(i,e,n,l){var p=a3(i,e,n),v;switch(l=$p(l??",f"),l.type){case"s":{var b=Math.max(Math.abs(i),Math.abs(e));return l.precision==null&&!isNaN(v=ZD(p,b))&&(l.precision=v),Mw(l,b)}case"":case"e":case"g":case"p":case"r":{l.precision==null&&!isNaN(v=WD(p,Math.max(Math.abs(i),Math.abs(e))))&&(l.precision=v-(l.type==="e"));break}case"f":case"%":{l.precision==null&&!isNaN(v=GD(p))&&(l.precision=v-(l.type==="%")*2);break}}return Cw(l)}function YD(i){var e=i.domain;return i.ticks=function(n){var l=e();return s3(l[0],l[l.length-1],n??10)},i.tickFormat=function(n,l){var p=e();return HD(p[0],p[p.length-1],n??10,l)},i.nice=function(n){n==null&&(n=10);var l=e(),p=0,v=l.length-1,b=l[p],c=l[v],E,T,z=10;for(c<b&&(T=b,b=c,c=T,T=p,p=v,v=T);z-- >0;){if(T=ny(b,c,n),T===E)return l[p]=b,l[v]=c,e(l);if(T>0)b=Math.floor(b/T)*T,c=Math.ceil(c/T)*T;else if(T<0)b=Math.ceil(b*T)/T,c=Math.floor(c*T)/T;else break;E=T}return i},i}function KD(){var i=0,e=1,n,l,p,v,b=Aw,c=!1,E;function T(B){return B==null||isNaN(B=+B)?E:b(p===0?.5:(B=(v(B)-n)*p,c?Math.max(0,Math.min(1,B)):B))}T.domain=function(B){return arguments.length?([i,e]=B,n=v(i=+i),l=v(e=+e),p=n===l?0:1/(l-n),T):[i,e]},T.clamp=function(B){return arguments.length?(c=!!B,T):c},T.interpolator=function(B){return arguments.length?(b=B,T):b};function z(B){return function($){var q,Q;return arguments.length?([q,Q]=$,b=B(q,Q),T):[b(0),b(1)]}}return T.range=z(c_),T.rangeRound=z(RD),T.unknown=function(B){return arguments.length?(E=B,T):E},function(B){return v=B,n=B(i),l=B(e),p=n===l?0:1/(l-n),T}}function XD(i,e){return e.domain(i.domain()).interpolator(i.interpolator()).clamp(i.clamp()).unknown(i.unknown())}function Dw(){var i=YD(KD()(Aw));return i.copy=function(){return XD(i,Dw())},dD.apply(i,arguments)}function em(i){for(var e=i.length/6|0,n=new Array(e),l=0;l<e;)n[l]="#"+i.slice(l*6,++l*6);return n}function tm(i){var e=i.length;return function(n){return i[Math.max(0,Math.min(e-1,Math.floor(n*e)))]}}const JD=tm(em("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725"));tm(em("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf"));tm(em("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4"));tm(em("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));var QD=rt("GEO_ID",1),eP=rt("<!> <!>",1),tP=rt("<!> <!>",1),rP=rt("<div><!></div>");function iP(i,e){Dr(e,!1);const n=An(),l=()=>Ir(Bv,"$previewMetricMap",n),p=()=>Ir(Ep,"$previewedMetricsList",n),v=()=>Ir(Gy,"$tileUrl",n),b=()=>Ir(Pl,"$selectedMetricsList",n);function c(z){console.log("Set preview metric map: ",z),Bv.set(z);let B=l().metric_parquet_column_name;const $=Math.min(...p().map(ae=>Number(ae[B]))),q=Math.max(...p().map(ae=>Number(ae[B]))),Q=Dw(JD).domain([$,q]);console.log("min:",$),console.log("max:",q),Bi(qy,p().map(ae=>("color"in ae&&delete ae.color,{...ae,color:Q(Number(ae[B]))}))),console.log(v())}Lr();var E=rP(),T=ct(E);Pp(T,{children:(z,B)=>{var $=tP(),q=mt($);Bp(q,{children:(ae,ie)=>{var Y=eP(),be=mt(Y);Ds(be,{children:(de,Se)=>{Or();var Me=QD();xe(de,Me)},$$slots:{default:!0},$$legacy:!0});var fe=Ae(Ae(be,!0));Fa(fe,1,b,Ra,(de,Se,Me)=>{Ds(de,{children:(Ge,Ee)=>{da(Ge,{size:"xs",color:"light",$$events:{click:()=>c(Ni(Se))},children:(Ve,De)=>{Or();var qe=bs();Ct(()=>Ei(qe,Ni(Se).metric_parquet_column_name)),xe(Ve,qe)},$$slots:{default:!0},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0})}),xe(ae,Y)},$$slots:{default:!0},$$legacy:!0});var Q=Ae(Ae(q,!0));Lp(Q,{children:(ae,ie)=>{var Y=rr(),be=mt(Y);Fa(be,1,()=>p().slice(0,10),Ra,(fe,de,Se)=>{zp(fe,{children:(Me,Ge)=>{var Ee=rr(),Ve=mt(Ee);Fa(Ve,1,()=>Object.keys(Ni(de)).map(function(De){return String(Ni(de)[De])}),Ra,(De,qe,Ze)=>{Hs(De,{class:"justified",children:(Pe,$e)=>{Or();var We=bs();Ct(()=>Ei(We,Ni(qe))),xe(Pe,We)},$$slots:{default:!0},$$legacy:!0})}),xe(Me,Ee)},$$slots:{default:!0},$$legacy:!0})}),xe(ae,Y)},$$slots:{default:!0},$$legacy:!0}),xe(z,$)},$$slots:{default:!0},$$legacy:!0}),ut(E),xe(i,E),Pr()}var nP=rt("Home",1),sP=rt("Selected metrics and Preview",1),aP=rt("Name",1),oP=rt("Year",1),lP=rt("Selected metrics",1),cP=rt("<!> <!> <!>",1),uP=rt("Add",1),hP=rt("<!> <!> <!>",1),dP=rt("<!> <!>",1),fP=rt('<div slot="sidebar"><div style="text-align: left; margin-top: 2.5%; margin-bottom: 5%; "><!> <!></div> <section id="query-section" style="text-align: left; margin-top: 2.5%; margin-bottom: 5%; "><!></section> <section id="&lt;results-table"><!></section></div>'),pP=rt('<p class="text-sm text-gray-500 dark:text-gray-400"><b>Selected metrics</b></p> <!>',1),mP=rt('<p class="text-sm text-gray-500 dark:text-gray-400"><b>Preview of selected metrics <button>(view selected on map)</button></b></p> <!>',1),gP=rt("Name",1),yP=rt("Year",1),_P=rt("Selected metrics",1),vP=rt("<!> <!> <!>",1),bP=rt("Add",1),xP=rt("<!> <!> <!>",1),wP=rt("<!> <!>",1),SP=rt('<section id="query-section" style="text-align: left; margin-top: 2.5%; margin-bottom: 5%; "><!></section> <section id="&lt;results-table"><!></section>',1),IP=rt("<span>Bounding Box (left, bottom, right, top)</span>"),TP=rt("Get from map",1),kP=rt("<!> <!>",1),AP=rt(" <!>",1),EP=rt("Output format: <!> <!>",1),CP=rt("Copy",1),MP=rt("<!> <!>",1),DP=rt("Popgetter CLI command <!>",1),PP=rt('<div class="pt-8"><div style="text-align: left; margin-top: 0.5%; margin-bottom: 0.5%; "><!> <!></div> <div style="text-align: left; margin-top: 0.5%; margin-bottom: 0.5%; "><!></div></div> <div style="text-align: left; margin-top: 0.5%; margin-bottom: 0.5%; "><!></div>',1),LP=rt("<!> <!> <!> <!>",1),zP=rt("<!> <!>",1),BP=rt('<div slot="map"><!> <div><!></div></div>');function RP(i,e){Dr(e,!1);const n=An(),l=()=>Ir(Yg,"$rustBackend",n),p=()=>Ir(U1,"$duckdbBackend",n),v=()=>Ir(Pl,"$selectedMetricsList",n),b=()=>Ir(Ep,"$previewedMetricsList",n),c=()=>Ir(Xg,"$selectedLevel",n),E=()=>Ir(Ap,"$selectedCountry",n),T=["geojson","csv","geojsonseq"];let z=xt("csv"),B=xt(""),$=xt(!1),q={y:320,duration:200,easing:KC};async function Q($e){try{console.log($e),await l().isLoaded()||await l().initialise();let We=await l().downloadDataRequestMetricsSql($e);console.log(We),await p().isLoaded()||await p().initialise();const Je=await p().getMetrics(We);return console.log(Je),Je}catch(We){window.alert(`Failed to download: ${We}`)}}Kh(async()=>{});async function ae(){const $e=v().map(Ne=>({MetricId:{id:Ne.metric_id}}));console.log($e);let We={region:[],metrics:$e,years:[]};const Je=await Q(We);Bi(Ep,Je),await l().isLoaded()||await l().initialise();try{let Ne=await l().downloadDataRequestGeomsPmtiles(We);console.log(Ne),Bi(Gy,Ne)}catch(Ne){window.alert(`Failed to get tile URL: ${Ne}`)}console.log(b().slice(0,10))}function ie(){let $e=v().map(gt=>`--id ${gt.metric_id}`).join(" "),We="--output-format "+ue(z),Je=ue(B)===""?"":"--bbox "+ue(B);return["popgetter","data",$e,We,Je].join(" ")}function Y($e){console.log($e),v().indexOf($e)===-1?v().push($e):console.log("Not added"),Bi(Pl,[...v()])}function be($e){console.log($e);const We=v().indexOf($e);We>-1&&v().splice(We,1),Bi(Pl,[...v()])}async function fe($e,We){try{return await l().isLoaded()||await l().initialise(),await l().search($e,We)}catch(Je){window.alert(`Failed to search: ${Je}`)}}let de=xt();function Se(){if(ue(de)){const $e=ue(de).getBounds().toArray();return console.log("Bounding Box:",$e),[$e.getWest(),$e.getSouth(),$e.getEast(),$e.getNorth()].map(Je=>Number(Je.toFixed(6)).toString()).join(",")}else return console.error("Map instance is not yet initialized."),""}let Me=xt(""),Ge={},Ee=[],Ve=xt([]);async function De(){Ge={metric_id:[],text:[{text:ue(Me),context:["Hxl","HumanReadableName","Description"],config:{match_type:"Regex",case_sensitivity:"Insensitive"}}],geometry_level:{value:c(),config:{match_type:"Exact",case_sensitivity:"Insensitive"}},year_range:[],country:{value:E(),config:{match_type:"Regex",case_sensitivity:"Insensitive"}},region_spec:[]},console.log(Ge),Ee=await fe(Ge,0),ot(Ve,Ee.slice(0,10)),console.log(Ee)}function qe($e,We){let Je;return function(...gt){clearTimeout(Je),Je=setTimeout(()=>{$e.apply(this,gt)},We)}}const Ze=qe(De,300);async function Pe(){}return Lr(),my(i,{$$slots:{sidebar:($e,We)=>{var Je=fP(),gt=ct(Je),Ne=ct(gt);da(Ne,{color:"light",$$events:{click:()=>Bi(Kp,{kind:"title"})},children:(dt,Nt)=>{Or();var or=nP();xe(dt,or)},$$slots:{default:!0},$$legacy:!0});var ht=Ae(Ae(Ne,!0));da(ht,{color:"light",$$events:{click:()=>ot($,!1)},children:(dt,Nt)=>{Or();var or=sP();xe(dt,or)},$$slots:{default:!0},$$legacy:!0}),ut(gt);var _t=Ae(Ae(gt,!0)),er=ct(_t);Xv(er,{get searchTerm(){return ue(Me)},set searchTerm(dt){ot(Me,dt)},$$events:{input:Ze},$$legacy:!0}),ut(_t);var Xt=Ae(Ae(_t,!0)),ar=ct(Xt);Pp(ar,{children:(dt,Nt)=>{var or=dP(),wt=mt(or);Bp(wt,{children:(Pt,zt)=>{var dr=cP(),ir=mt(dr);Ds(ir,{children:(pr,Kr)=>{Or();var ai=aP();xe(pr,ai)},$$slots:{default:!0},$$legacy:!0});var $r=Ae(Ae(ir,!0));Ds($r,{children:(pr,Kr)=>{Or();var ai=oP();xe(pr,ai)},$$slots:{default:!0},$$legacy:!0});var br=Ae(Ae($r,!0));Ds(br,{children:(pr,Kr)=>{Or();var ai=lP();xe(pr,ai)},$$slots:{default:!0},$$legacy:!0}),xe(Pt,dr)},$$slots:{default:!0},$$legacy:!0});var je=Ae(Ae(wt,!0));Lp(je,{tableBodyClass:"divide-y",children:(Pt,zt)=>{var dr=rr(),ir=mt(dr);Fa(ir,1,()=>ue(Ve),Ra,($r,br,pr)=>{zp($r,{children:(Kr,ai)=>{var Gi=hP(),Mi=mt(Gi);Hs(Mi,{class:"max-w-md whitespace-normal break-words border-b border-gray-200 px-2 py-2",children:(Si,mr)=>{Or();var $t=bs();Ct(()=>Ei($t,Ni(br).metric_human_readable_name)),xe(Si,$t)},$$slots:{default:!0},$$legacy:!0});var Ce=Ae(Ae(Mi,!0));Hs(Ce,{children:(Si,mr)=>{Or();var $t=bs();Ct(()=>Ei($t,Ni(br).source_data_release_collection_period_start.slice(0,4))),xe(Si,$t)},$$slots:{default:!0},$$legacy:!0});var di=Ae(Ae(Ce,!0));Hs(di,{children:(Si,mr)=>{da(Si,{color:"light",$$events:{click:()=>Y(Ni(br))},children:($t,yi)=>{Or();var Di=uP();xe($t,Di)},$$slots:{default:!0},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0}),xe(Kr,Gi)},$$slots:{default:!0},$$legacy:!0})}),xe(Pt,dr)},$$slots:{default:!0},$$legacy:!0}),xe(dt,or)},$$slots:{default:!0},$$legacy:!0}),ut(Xt),ut(Je),xe($e,Je)},map:($e,We)=>{var Je=BP(),gt=ct(Je);a_(gt,{get mapInstance(){return ue(de)},set mapInstance(_t){ot(de,_t)},$$legacy:!0});var Ne=Ae(Ae(gt,!0)),ht=ct(Ne);eC(ht,{placement:"top",position:"absolute",transitionType:"fly",width:"w-full",activateClickOutside:!1,transitionParams:q,backdrop:!1,get hidden(){return ue($)},set hidden(_t){ot($,_t)},id:"sidebar8",children:(_t,er)=>{var Xt=zP(),ar=mt(Xt);W1(ar,{class:"mb-4 dark:text-white",$$events:{click:()=>ot($,!0)},$$legacy:!0});var dt=Ae(Ae(ar,!0));pM(dt,{children:(Nt,or)=>{var wt=LP(),je=mt(wt);Sf(je,{open:!0,title:"Selected Metrics",children:(ir,$r)=>{var br=pP(),pr=mt(br);ct(pr),ut(pr);var Kr=Ae(Ae(pr,!0));hD(Kr,{$$legacy:!0}),xe(ir,br)},$$slots:{default:!0},$$legacy:!0});var Pt=Ae(Ae(je,!0));Sf(Pt,{title:"Preview",$$events:{click:()=>ae()},children:(ir,$r)=>{var br=mP(),pr=mt(br),Kr=ct(pr),ai=Ae(ct(Kr)),Gi=_b(()=>()=>Pe());ut(Kr),ut(pr);var Mi=Ae(Ae(pr,!0));iP(Mi,{$$legacy:!0}),Qe("click",ai,function(...Ce){var di;return(di=ue(Gi))==null?void 0:di.apply(this,Ce)},!1),xe(ir,br)},$$slots:{default:!0},$$legacy:!0});var zt=Ae(Ae(Pt,!0));Sf(zt,{title:"Advanced Search",$$events:{click:()=>ae()},children:(ir,$r)=>{var br=SP(),pr=mt(br),Kr=ct(pr);Xv(Kr,{get searchTerm(){return ue(Me)},set searchTerm(Mi){ot(Me,Mi)},$$events:{input:Ze},$$legacy:!0}),ut(pr);var ai=Ae(Ae(pr,!0)),Gi=ct(ai);Pp(Gi,{children:(Mi,Ce)=>{var di=wP(),Si=mt(di);Bp(Si,{children:($t,yi)=>{var Di=vP(),Zi=mt(Di);Ds(Zi,{children:(oi,Ki)=>{Or();var Ke=gP();xe(oi,Ke)},$$slots:{default:!0},$$legacy:!0});var on=Ae(Ae(Zi,!0));Ds(on,{children:(oi,Ki)=>{Or();var Ke=yP();xe(oi,Ke)},$$slots:{default:!0},$$legacy:!0});var ln=Ae(Ae(on,!0));Ds(ln,{children:(oi,Ki)=>{Or();var Ke=_P();xe(oi,Ke)},$$slots:{default:!0},$$legacy:!0}),xe($t,Di)},$$slots:{default:!0},$$legacy:!0});var mr=Ae(Ae(Si,!0));Lp(mr,{tableBodyClass:"divide-y",children:($t,yi)=>{var Di=rr(),Zi=mt(Di);Fa(Zi,1,()=>ue(Ve),Ra,(on,ln,oi)=>{zp(on,{children:(Ki,Ke)=>{var cn=xP(),Xr=mt(cn);Hs(Xr,{class:"max-w-md whitespace-normal break-words border-b border-gray-200 px-2 py-2",children:(et,Jt)=>{Or();var Bt=bs();Ct(()=>Ei(Bt,Ni(ln).metric_human_readable_name)),xe(et,Bt)},$$slots:{default:!0},$$legacy:!0});var zn=Ae(Ae(Xr,!0));Hs(zn,{children:(et,Jt)=>{Or();var Bt=bs();Ct(()=>Ei(Bt,Ni(ln).source_data_release_collection_period_start.slice(0,4))),xe(et,Bt)},$$slots:{default:!0},$$legacy:!0});var os=Ae(Ae(zn,!0));Hs(os,{children:(et,Jt)=>{da(et,{color:"light",$$events:{click:()=>Y(Ni(ln))},children:(Bt,vn)=>{Or();var ls=bP();xe(Bt,ls)},$$slots:{default:!0},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0}),xe(Ki,cn)},$$slots:{default:!0},$$legacy:!0})}),xe($t,Di)},$$slots:{default:!0},$$legacy:!0}),xe(Mi,di)},$$slots:{default:!0},$$legacy:!0}),ut(ai),xe(ir,br)},$$slots:{default:!0},$$legacy:!0});var dr=Ae(Ae(zt,!0));Sf(dr,{title:"Download",$$events:{click:()=>ae()},children:(ir,$r)=>{var br=PP(),pr=mt(br),Kr=ct(pr),ai=ct(Kr);Tg(ai,{class:"space-y-2",children:(mr,$t)=>{var yi=IP();xe(mr,yi)},$$slots:{default:!0},$$legacy:!0});var Gi=Ae(Ae(ai,!0));Ov(Gi,{class:"w-full",children:(mr,$t)=>{var yi=kP(),Di=mt(yi);qv(Di,{id:"bbox",type:"text",placeholder:"",get value(){return ue(B)},set value(on){ot(B,on)},$$legacy:!0});var Zi=Ae(Ae(Di,!0));da(Zi,{color:"light",class:"w-80",$$events:{click:()=>Se()},children:(on,ln)=>{Or();var oi=TP();xe(on,oi)},$$slots:{default:!0},$$legacy:!0}),xe(mr,yi)},$$slots:{default:!0},$$legacy:!0}),ut(Kr);var Mi=Ae(Ae(Kr,!0)),Ce=ct(Mi);Tg(Ce,{class:"space-y-2",children:(mr,$t)=>{Or();var yi=EP(),Di=Ae(mt(yi,!0));da(Di,{color:"light",children:(on,ln)=>{Or();var oi=AP(),Ki=mt(oi,!0),Ke=Ae(Ki);xM(Ke,{class:"ms-2 h-6 w-6",$$legacy:!0}),Ct(()=>Ei(Ki,`${ue(z)??""} `)),xe(on,oi)},$$slots:{default:!0},$$legacy:!0});var Zi=Ae(Ae(Di,!0));Qy(Zi,{children:(on,ln)=>{var oi=rr(),Ki=mt(oi);Fa(Ki,1,()=>T,Ra,(Ke,cn,Xr)=>{e_(Ke,{$$events:{click:()=>ot(z,Ni(cn))},children:(zn,os)=>{Or();var et=bs();Ct(()=>Ei(et,Ni(cn))),xe(zn,et)},$$slots:{default:!0},$$legacy:!0})}),xe(on,oi)},$$slots:{default:!0},$$legacy:!0}),xe(mr,yi)},$$slots:{default:!0},$$legacy:!0}),ut(Mi),ut(pr);var di=Ae(Ae(pr,!0)),Si=ct(di);Tg(Si,{class:"space-y-2",children:(mr,$t)=>{Or();var yi=DP(),Di=Ae(mt(yi,!0));Ov(Di,{class:"w-full",children:(Zi,on)=>{var ln=MP(),oi=mt(ln),Ki=Kc(ie);qv(oi,{id:"popgetter-data-cli",readonly:!0,get value(){return ue(Ki)},$$legacy:!0});var Ke=Ae(Ae(oi,!0));da(Ke,{color:"light","data-copy-to-clipboard-target":"popgetter-data-cli",$$events:{click:()=>{console.log(ie()),navigator.clipboard.writeText(ie())}},children:(cn,Xr)=>{Or();var zn=CP();xe(cn,zn)},$$slots:{default:!0},$$legacy:!0}),xe(Zi,ln)},$$slots:{default:!0},$$legacy:!0}),xe(mr,yi)},$$slots:{default:!0},$$legacy:!0}),ut(di),xe(ir,br)},$$slots:{default:!0},$$legacy:!0}),xe(Nt,wt)},$$slots:{default:!0},$$legacy:!0}),xe(_t,Xt)},$$slots:{default:!0},$$legacy:!0}),ut(Ne),ut(Je),xe($e,Je)}},$$legacy:!0}),vI(e,"remove",be),Pr({remove:be})}var FP=rt('<div><h2 class="font-large text-lg text-gray-500 lg:text-xl dark:text-gray-500"><p>Pick geometry level...</p></h2> <!></div>'),OP=rt('<li class="rounded p-2 hover:bg-gray-100 dark:hover:bg-gray-600"><!></li>'),NP=rt('<div slot="sidebar"><div><!> <!> <!></div></div>'),UP=rt('<div slot="map"><!></div>');function $P(i,e){Dr(e,!1);const n=An(),l=()=>Ir(Xg,"$selectedLevel",n),p=()=>Ir(Ap,"$selectedCountry",n),v={"United States":["tract","county","block_group"],Scotland:["OutputArea2011","CouncilArea2011","DataZone2011"],"Northern Ireland":["LGD14","DZ21","SDZ21"],"England and Wales":["msoa","lsoa","rgn","oa","ctry","ltla"],Belgium:["statistical_sector","municipality"]};let b=xt([]);function c(T){Bi(Xg,T),console.log("Selected country: ",p()),console.log("Selected level: ",l()),Bi(Kp,{kind:"download"})}let E=xt();Kh(async()=>{try{ot(b,v[p()+""]),console.log(ue(b));return}catch(T){window.alert(`Failed to get levels: ${T}`)}}),Lr(),my(i,{$$slots:{sidebar:(T,z)=>{var B=NP(),$=ct(B),q=ct($);sw(q);var Q=Ae(Ae(q,!0));da(Q,{children:(ie,Y)=>{var be=FP(),fe=ct(be);ct(fe),ut(fe);var de=Ae(Ae(fe,!0));nw(de,{color:"grey",size:"lg",class:"text-grey ms-2 h-6 w-6 dark:text-gray-500",$$legacy:!0}),ut(be),xe(ie,be)},$$slots:{default:!0},$$legacy:!0});var ae=Ae(Ae(Q,!0));Qy(ae,{children:(ie,Y)=>{var be=rr(),fe=mt(be);Fa(fe,1,()=>ue(b),Ra,(de,Se,Me)=>{var Ge=OP(),Ee=ct(Ge);e_(Ee,{$$events:{click:()=>c(Ni(Se))},children:(Ve,De)=>{Or();var qe=bs();Ct(()=>Ei(qe,Ni(Se))),xe(Ve,qe)},$$slots:{default:!0},$$legacy:!0}),ut(Ge),xe(de,Ge)}),xe(ie,be)},$$slots:{default:!0},$$legacy:!0}),ut($),ut(B),xe(T,B)},map:(T,z)=>{var B=UP(),$=ct(B);a_($,{get mapInstance(){return ue(E)},set mapInstance(q){ot(E,q)},$$legacy:!0}),ut(B),xe(T,B)}},$$legacy:!0}),Pr()}var VP=rt('<div slot="left"><h1 class="lg:text-6s md:text-5s mb-4 text-4xl font-extrabold leading-none tracking-tight text-gray-900 dark:text-gray-900">Popgetter browser</h1> <div></div></div>'),jP=rt('<div slot="main" style="position:relative; width: 100%; height: 100vh;"><!></div>');function QP(i,e){Dr(e,!1);const n=An(),l=()=>Ir(Yg,"$rustBackend",n),p=()=>Ir(Kg,"$countries",n),v=()=>Ir(Dg,"$sidebarContents",n),b=()=>Ir(Kp,"$mode",n);let c=xt(!1);Kh(async()=>{const T=Pg(new J3);let z=await new T;Yg.set(z);const B=Pg(new Q3);let $=await new B;U1.set($),await l().isLoaded()||await l().initialise(),Bi(Kg,await l().getCountries()),console.log(p()),ot(c,!0)});let E=xt();bt(()=>(ue(E),v()),()=>{ue(E)&&v()&&(Lh(E,ue(E).innerHTML=""),ue(E).appendChild(v()))}),gi(),Lr(),xI(i,{$$slots:{left:(T,z)=>{var B=VP(),$=ct(B),q=Ae(Ae($,!0));Wo(q,Q=>ot(E,Q),()=>ue(E)),ut(B),xe(T,B)},main:(T,z)=>{var B=jP(),$=ct(B);hr($,()=>ue(c),q=>{var Q=rr(),ae=mt(Q);hr(ae,()=>b().kind=="title",ie=>{X3(ie,{$$legacy:!0})},ie=>{var Y=rr(),be=mt(Y);hr(be,()=>b().kind=="level",fe=>{$P(fe,{$$legacy:!0})},fe=>{var de=rr(),Se=mt(de);hr(Se,()=>b().kind=="download",Me=>{RP(Me,{$$legacy:!0})},null,!0),xe(fe,de)},!0),xe(ie,Y)}),xe(q,Q)},q=>{JC(q,{$$legacy:!0})}),ut(B),xe(T,B)}},$$legacy:!0}),Pr()}export{QP as component};
